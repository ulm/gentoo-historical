<?xml version='1.0' encoding="UTF-8"?>

<mainpage id="performance">
<title>Gentoo Linux Performance Metrics</title>
<author title="Author"><mail link="drobbins@gentoo.org">Daniel Robbins</mail></author>
<version>1.2</version>
<date>8 Oct 2003</date>

<chapter>
<section>
<title>Gentoo Linux... performance?</title>
<body>
<p>People have often wondered what kind of performance improvement (if any) Gentoo Linux provides over
other Linux distributions. This section is intended to give you an idea of the various factors
that can affect application performance.
</p>
</body>
</section>
<section>
<title>HispaLinux 2003: Gentoo Linux 1.4 vs. Mandrake 9.1 load-times</title>
<body>
<p>On 23 Sep 2003, <b>Jose Alberto Suarez Lopez</b> gave a presentation at <uri
link="http://congreso.hispalinux.es/edicion/2003/presentacion/">HispaLinux
2003</uri> where he demonstrated the load-time performance of the official
<i>Gentoo Linux 1.4</i> release.  To compare load-time performance, he used <i>Mandrake
9.1</i>.</p>

<note>Jose originally thought that Mandrake 9.1 used prelink by default. This
is not the case, and corrections have been made to this document to reflect this.</note>

<p>These benchmarks compare Mandrake 9.1 against Gentoo Linux 1.4 in both a
un-prelinked (default) and pre-linked state. For the "Gentoo with prelink" test, prelinking was performed as per
the steps of the <uri
link="http://www.gentoo.org/doc/en/prelink-howto.xml">Gentoo Prelinking
Guide</uri> and only the applications being tested were pre-linked.
</p>

<p>Here is an overview of the operating systems benchmarked for the load-time test:
<ul>
<li><b>Mandrake 9.1</b> (<b>no prelink</b>, default kernel)</li>
<li><b>Gentoo Linux 1.4 for Pentium III</b> (official prebuilt "GRP" packages from CD, <b>no prelink</b>, gaming-sources-2.4.20-r3)</li>
<li><b>Gentoo Linux 1.4 for Pentium III</b> (official prebuilt "GRP" packages from CD, <b>with prelink</b>, gaming-sources-2.4.20-r3)</li>
</ul>
</p>

<p>The Gentoo Linux 1.4 for Pentium III release uses the following packages:
<ul>
<li>binutils-2.14.90.0.6-r2</li>
<li>gcc-3.2.3-r1</li>
<li>glibc-2.3.2-r1</li>
<li>compilation flags: -O3 -march=pentium3 -fprefetch-loop-arrays -funroll-loops</li>
</ul>
</p>

<p>Here is an overview of the system used for the load-time test:
<ul>
<li>Pentium III Coppermine 733Mhz</li>
<li>128MB RAM</li>
<li>1461 BogoMIPS (not an authoritative performance measure but people seem to like to know this :)</li>
</ul>
</p>

<p>To perform the test, three applications (<b>Mozilla 1.4x</b>, <b>NetBeans
3.5x</b> and <b>Kmail</b> (Gentoo version was a newer 3.1.3 version that came
with the release) were repeatedly loaded. Initial load speed as well as
subsequent load speed was recorded.</p> </body> </section>

<section>
<title>HispaLinux 2003: Load time results</title>
<body>
<note>In these tests, the first column lists initial load time. The second and third columns
list the time required to load the application the second and third time respectively.</note>

<p><b>Test 1: Mandrake 9.1 without prelink</b>

<table>
<tr><th></th><th>1st run</th><th>2nd run</th><th>3rd run</th></tr>
<tr><th>Mozilla</th><ti>5.34s</ti><ti>5.45s</ti><ti>5.32s</ti></tr>
<tr><th>NetBeans</th><ti>38.37s</ti><ti>14.58s</ti><ti>20.43s</ti></tr>
<tr><th>Kmail</th><ti>0.42s</ti><ti>0.42s</ti><ti>0.46s</ti></tr>
</table>
</p>

<p><b>Test 2: Gentoo Linux 1.4 for Pentium III without prelink</b>

<table>
<tr><th></th><th>1st run</th><th>2nd run</th><th>3rd run</th></tr>
<tr><th>Mozilla</th><ti>2.88s</ti><ti>2.82s</ti><ti>2.88s</ti></tr>
<tr><th>NetBeans</th><ti>18.98s</ti><ti>18.35s</ti><ti>18.51s</ti></tr>
<tr><th>Kmail</th><ti>0.39s</ti><ti>0.97s</ti><ti>0.33s</ti></tr>
</table>
</p>

<p><b>Test 3: Gentoo Linux 1.4 for Pentium III with prelink</b>

<table>
<tr><th></th><th>1st run</th><th>2nd run</th><th>3rd run</th></tr>
<tr><th>Mozilla</th><ti><b>2.8s</b></ti><ti><b>2.78s</b></ti><ti><b>2.82s</b></ti></tr>
<tr><th>NetBeans</th><ti>n/a</ti><ti>n/a</ti><ti>n/a</ti></tr>
<tr><th>Kmail</th><ti><b>0.03s</b></ti><ti><b>0.02s</b></ti><ti><b>0.01s</b></ti></tr>
</table>

<note>The NetBeans test was not performed for Test 3 since NetBeans itself is
not prelinkable. Also, <i>only the tested applications (rather than the entire
system) were prelinked.</i> Prelinking the entire system shouldn't negatively
impact these performance numbers, and could theoretically improve them if external
binaries are loaded.</note>

</p>
</body>
</section>
<section>
<title>HispaLinux 2003: Load-time conclusion</title>
<body>
<p>Here are the conclusions of the load-time test:</p>
<ul>
<li><b>Mozilla loads nearly twice as fast under Gentoo Linux 1.4 for Pentium III</b> (both initial and subsequent loads)</li>
<li>Initial load time for NetBeans under Gentoo is over twice as fast as on Mandrake 9.1</li>
<li>Subsequent load time for NetBeans seems about even for both Gentoo and Mandrake</li>
<li><b>With prelink, Kmail loads over 10 times faster than Gentoo Linux without prelink or Mandrake 9.1 without prelink</b></li>
</ul>

<p>To be completely fair, here are some things to understand about this test:</p>
<ul>
<li>Can you conclude that "Gentoo is faster than Mandrake?" <b>No.</b> This is a limited test. It is likely that
Mandrake is faster for some things. <b>Also, we tested load-time performance only.</b></li>
<li>Can you conclude that "Mandrake is faster than Gentoo?" <b>No.</b> Since we have been able to demonstrate
that there are at least a few things that Gentoo does faster. <b>Again, only load-time performance was
tested, and doesn't necessarily correlate with application runtime performance.</b></li>
<li>"I installed distro X and it is a lot slower/faster than expected!" This is very possible, and can
be due to driver and kernel differences. Often, preemptive and low-latency patches reduce CPU performance
while helping interactive response. Sometimes, certain kernels behave poorly on certain hardware. 
You may be loading many more things into RAM with your new install than with the old install, or the
new install's applications may eat up more RAM.</li>
</ul>

<p><b>What can be gleaned from these results?</b> For one, the default
optimizations of Gentoo Linux 1.4 for Pentium III appear to make a 
significant difference in "real world" application load-time performance with
Mozilla. The initial load-time speed delta could be explained by Mandrake
having more services loaded, thus requiring some paging out to virtual memory.
However, second and third load-time speed deltas also show a performance
improvement. This points to lowered CPU usage. To confirm, we would need
to get hard numbers of <path>mozilla-bin</path>'s CPU usage during load time (rather than load time itself) from each system,
do a detailed comparison of libraries and compiler toolchains used, as well as optimization settings.
Binary applications like NetBeans cannot benefit as much from any optimizations
used on the system,
although initial load-time for binary applications does seem to be
a lot better under Gentoo Linux. It is not clear why. Possibly kernel differences
or possibly because more free RAM is initially available on Gentoo as compared
to Mandrake. This latter explanation is likely due to the fact that the 2nd and 3rd
test numbers are more or less the same.</p>

<p>In addition, KDE C++ applications like Kmail seem to show a huge load-time
peformance improvement when prelinked -- <i>over 10 times faster than without prelink</i>. Prelinking seems to be very
beneficial for improving load-time performance for KDE apps, although Mozilla
shows negligible improvement. Could this be due to Mozilla's internal
architecture which prevents it from being able to benefit significantly from
being pre-linked?  Or did our tester mistakenly try to prelink
<path>/usr/bin/mozilla</path> instead of of
<path>/usr/lib/mozilla/mozilla-bin</path>?  Only time (and another load-time
performance test) will tell! :)</p>

<p><b>Gentoo Linux tries to deliver the best performance possible in 
several ways.</b> First and most important, we
try our best to offer the latest and best free software technologies to our
users, including the latest compiler toolchains. Newer compilers produce faster
code, so by getting these tools into your hands sooner, we can often deliver
better performance.  It's important to understand that there is no magic
involved except getting the latest free software improvements to you in a
timely manner.</p>

<p><b>Here's the second way we attempt to maximize the performance of Gentoo.</b> <i>The official
Gentoo Linux 1.4 release ships with pre-built binary packages</i> that have been
optimized for specific CPU models. We've chosen optimizations that perform well
and are very stable.</p>

<p>
For example, <uri link="http://store.gentoo.org/index.php?item=16&amp;action=viewitem">Gentoo Linux for
Pentium III</uri> was used in this test, which runs very fast on Pentium III and higher
processors, but will not run on Pentium II or "lower" processors. It takes full advantage
of the Pentium III's instruction set, including MMX and SSE instructions.</p>

<p>
<b>By providing
tailored builds for each CPU model, you are able to use the full instruction set
of your CPU and receive the best possible system performance.</b> For x86
systems, we currently offer 1.4 builds for <uri link="http://store.gentoo.org/index.php?item=13&amp;action=viewitem">x86</uri> (generic PC), <uri link="http://store.gentoo.org/index.php?item=14&amp;action=viewitem">i686</uri> (Pentium
Pro and higher), <uri link="http://store.gentoo.org/index.php?item=16&amp;action=viewitem">Pentium III</uri>, <uri link="http://store.gentoo.org/index.php?item=17&amp;action=viewitem">Pentium 4</uri> and <uri link="http://store.gentoo.org/index.php?item=18&amp;action=viewitem">Athlon XP</uri> systems. In addition,
we provide an easy way for users who wish to "build Gentoo from scratch" so that they can optimize and configure Gentoo Linux
as needed.
</p>

<p>The third way Gentoo can offer improved performance is that the default install 
is "opt in" rather than "opt out." That is, your system will only have the applications
installed that you actually need. This can lower RAM usage which can result in lower
CPU and VM usage and an overall faster system.</p>

<p>If you'd like to purchase Gentoo Linux, please visit <uri
link="http://store.gentoo.org">The Gentoo Store</uri>. Gentoo can also be downloaded
from our various <uri link="http://www.gentoo.org/main/en/mirrors.xml">mirrors</uri>.</p>

</body>
</section>
</chapter>
</mainpage>
