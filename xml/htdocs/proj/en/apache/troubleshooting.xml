<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="apache-troubleshooting.xml" lang="en">
<title>Troubleshooting Apache</title>

<author title="Author">
  <mail link="vericgar@gentoo.org">Michael Stewart</mail>
</author>
<author title="Author">
  <mail link="beu@gentoo.org">Elfyn McBratney</mail>
</author>

<abstract>
This document covers a number of ways to figure out how to fix your Apache 
installation when things are working correctly.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>
<version>1.0</version>
<date>2005-05-30</date>

<chapter>
<title>Apache is returning zero-length pages or segfaulting</title>
<section>
<body>

<p>
This usually happens after an upgrade, usually because binary compatibility 
broke in APR (which may happen for a number for reasons). To fix this, you need
to rebuild the Apache tool stack:
</p>

<pre caption="Rebuilding the Apache tool stack">
<comment>(make sure you do these in order, it's very important!)</comment>

<comment>(first, we have to remove the currently installed apache)</comment>
# <i>emerge -aCv '=net-www/apache-2*'</i>

<comment>(then we rebuild the tool stack)</comment>
# <i>emerge -av '=dev-libs/apr-0*' '=dev-libs/apr-util-0*'</i>

<comment>(then we reinstall apache)</comment>
# <i>emerge -av '=net-www/apache-2*'</i>

<comment>(determine any packages that depend on apache)</comment>
$ <i>equery depends net-www/apache</i>
[ Searching for packages depending on net-www/apache... ]
dev-php/phpsysinfo-2.3-r2
dev-php/phpsysinfo-2.1-r2
dev-php/mod_php-4.3.11-r2
net-www/mod_layout-4.0.1a-r1
www-servers/gorg-0.5

<comment>(then rebuild any modules you have installed)</comment>
# <i>emerge -av '=dev-php/mod_php-4.3.11-r2' '=net-www/mod_layout-4.0.1.a-r1'</i>
</pre>

<p>
You should now have a working Apache installation. If you don't see the <uri 
link="#getting-help">Getting Help</uri> section.
</p>

</body>
</section>
</chapter>


<chapter>
<title>configure: error: changes in the environment can compromise the build</title>
<section>
<body>

<p>
If you get this error, then you probably have unneeded spaces in your CFLAGS in <path>/etc/make.conf</path>. The fix is simple, remove the extra spaces:
</p>

<pre caption="Example of changes to /etc/make.conf">
<comment>(before the change)</comment>
CFLAGS="-O2 -mcpu=pentium3 -march=pentium3  -pipe"

<comment>(after the change - notice the removal of the space)</comment>
CFLAGS="-O2 -mcpu=pentium3 -march=pentium3 -pipe"
</pre>

</body>
</section>
</chapter>


<chapter>
<title>Address already in use: make_sock: could not bind to address 0.0.0.0:443</title>
<section>
<body>

<p>
This error occurs when starting up, and is caused by having multiple Listen directives in your configuration that are incompatible. To solve this problem, you should grep your configuration for Listen and fix each occurance.
</p>

<pre caption="Finding all Listen directives">
<comment>(Make sure you are in the configuration directory)</comment>
# <i>cd /etc/apache2/</i>

<comment>(List all listen directives)</comment>
# <i>grep Listen httpd.conf vhosts.d/*.conf modules.d/*.conf</i>
</pre>

<p>
What you are looking for is conflicts in what Apache is trying to bind to. For example, if there is a <c>Listen 80</c> in httpd.conf and then there is a <c>Listen 10.0.0.15:80</c> in another file, then Apache will not be able to start. This is because Apache first binds to port 80 on all IP addresses for the machine, and then tries to bind to port 80 on IP address 10.0.0.15 and fails because port 80 is already in use.
</p>

<p>
The recommended configuration is that you should have a single <c>Listen 80</c> (this is in the default httpd.conf) so that you bind to all addresses by default for the standard http port, and then for every SSL VirtualHost you run, create a seperate absolute Listen directive (such as <c>Listen 10.0.0.15:443</c>.
</p>


</body>
</section>
</chapter>


<chapter id="getting-help">
<title>Getting Help</title>
<section>
<body>

<p>
If none of the above was any use to you, or if you have other questions, feel 
free to stop by our IRC channel, <path>#gentoo-apache</path> on 
<path>irc.freenode.net</path>. Or you may also file a bug on <uri 
link="http://bugs.gentoo.org">Gentoo's Bugzilla</uri>.
</p>

</body>
</section>
</chapter>

</guide>
