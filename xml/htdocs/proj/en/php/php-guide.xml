<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/php/Attic/php-guide.xml,v 1.1 2010/04/23 23:42:19 mabi Exp $ -->

<guide link="php-guide.xml" lang="en">
<title>Upgrading PHP</title>

<author title="Author">
 <mail link="akorthaus@web.de">Andreas Korthaus</mail>
 <mail link="mabi@gentoo.org">Matti Bickel</mail>
</author>

<abstract>
	This document describes how PHP is set up in Gentoo.
</abstract>


<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.0</version>
<date>2010-04-22</date>

<chapter>
<title>PHP package</title>
<section>
<title>Basic PHP Packages Consolidated</title>
<body>

<p>
	There is only one php package (as opposed to one package for each SAPI like
	cgi, cli or apache). You can enable the SAPIs you want via USE flags in
	<c>dev-lang/php</c>. A list of available SAPIs is included below.
	You can combine them as you wish, but obviously you need at least one of
	them to make any use of your php installation.
</p>

<p>
To choose the SAPI you want, use these USE flags:
</p>

<ul>
  <li><c>cgi</c> - builds &amp; installs <path>/usr/bin/php-cgi</path></li>
  <li><c>cli</c> - builds &amp; installs <path>/usr/bin/php</path></li>
  <li><c>apache2</c> - builds &amp; installs <c>mod_php</c> for Apache 2.0</li>
</ul>

<note>
	There are requests to add <c>fpm</c> as a SAPI. The Gentoo PHP team will
	support this as soon as the PHP project includes this SAPI in an upstream
	release of php (most likely php-5.4).
</note>
 
</body>
</section>

<section>
<title>Portage Categories</title>
<body>

<p>
The PHP package have been moved from <c>dev-php</c> to <c>dev-lang/php</c>. 
You can find PECL extensions and other packages depending on the version of PHP
in the <c>dev-php5</c> category. All version independent packages can be found
in the <c>dev-php</c> category. This was introduced to support the parallel use
of PHP4 and PHP5 and will continue with a <c>dev-php6</c> category once the PHP
project releases a new major version.
</p>

</body>
</section>

<section>
<title>Directories and configuration files</title>
<body>

<ul>
  <li>The PHP package installs its contents into <path>/usr/lib/php5</path>
	  (the Apache modules go into the right place for Apache).</li>
  <li>The PEAR packages and other PHP libraries go into <path>/usr/share/php</path> (was 
	  <path>/usr/lib/php</path> before).</li>
  <li>PECL packages will no longer add configuration directives by adding them 
	  to the <path>php.ini</path> configuration file, but add a 
	  <path>[PACKAGE].ini</path> file to the <path>/etc/php/[SAPI]/ext</path> 
	  directory.</li>
</ul>

</body>
</section>

<section>
<title>Symlinking of PHP binaries</title>
<body>

	<p> The PHP package will create symlinks in <path>/usr/bin</path> for the
		version of PHP you installed most recently. Currently, your choice is
		restricted to PHP major version 5. However, the Gentoo PHP team may
		allow a more fine grained slotting or introduce PHP6 to the tree. You
		can then <uri link="#doc_chap3_sect5">use the php-select tool</uri>
		from <c>app-admin/php-toolkit</c> to change the symlinks.  </p>

</body>
</section>
</chapter>


<chapter>
<title>Configuration</title>

<section>
<title>USE flags</title>
<body>
	<p>
		For a list of recommended USE flags look at <uri
			link="http://overlays.gentoo.org/proj/php/wiki/CommonQuestions">
			Recommend USE flags</uri>. For a list of USE flags available for
		PHP have a look at the <uri
			link="http://overlays.gentoo.org/proj/php/wiki/NewUseFlags">USE
			flags table</uri> from overlay wiki.
	</p>
</body>
</section>

<section>
<title>Configuration files</title>
<body>

<p>
The Gentoo PHP Package stores configuration in <path>/etc/php</path>, which
contains one subdirectory for each SAPI for each PHP version (only PHP5 for
now):
</p>

<pre caption="list PHP config directories">
$ <i>ls -1 /etc/php</i>
apache2-php5
cli-php5
cgi-php5
</pre>

<p> Every subdirectory contains an own <path>php.ini</path>, but external
	(shared) extension are now kept in their own
	<path>/etc/php/{apach2,cli,cgi}-php5/ext</path> directory. To enable/
	disable shared extensions, symlinks from <path>/etc/php/*/ext-active</path>
	are used. If you want to enable an extension, create a symlink in
	<path>/etc/php/*/ext-active</path> to the corresponding
	<path>[EXTENSION].ini</path> file in <path>/etc/php/*/ext/</path>. If you
	want to disable an extension, remove the symlink.  </p>

<note> If you install PHP as an Apache module, make sure to restart Apache
	after installation and configuration.  </note>

</body>
</section>

<section>
<title>Configure Apache to work with PHP5</title>
<body>

	<p> To configure Apache to load your PHP5 module (mod_php), you have to add
		<c>-D PHP5</c> to <c>APACHE2_OPTS</c> variable in
		<path>/etc/conf.d/apache2</path>.  </p>

<pre caption="Configure Apache to load mod_php">
<comment>(settings for PHP5)</comment>
<i>APACHE2_OPTS="-D PHP5"</i>
</pre>

<note>You can not use two different PHP modules with Apache at the same time.</note>

</body>
</section>
</chapter>

<chapter>
<title>Support / Getting Help</title>
<section>
<body>

<p> If you run into problems with the new Gentoo PHP packages, here's where you
	can get help: </p>

<ul>
  <li>
    <uri link="http://overlays.gentoo.org/proj/php/wiki/CommonQuestions">Common
    Questions</uri> about PHP on Gentoo
  </li>
  <li>
    <uri link="http://overlays.gentoo.org/proj/php/">Development-Page of the PHP
    Overlay</uri>
  </li>
  <li>
    #gentoo-php on irc.freenode.net; this is the chatroom where the overlay's
    regular authors hang out. We'd love to see you there!
  </li>
  <li>
    <uri link="http://forums.gentoo.org/">Gentoo Forums</uri> are a popular
    place to ask for help. There are plenty of other Gentoo users reading the
    Forums round the clock, making it a great place to get help in a hurry.
  </li>
</ul>

<p> On the <uri link="http://overlays.gentoo.org/proj/php/">Development-Page</uri>
	you'll find a lot of documentation and <uri
	link="http://git.overlays.gentoo.org/gitweb/?p=proj/php.git">our git
	repository</uri> provides a test ground for packages, which will be moved
	to the official Portage tree later.  </p>

</body>
</section>
</chapter>
</guide>
