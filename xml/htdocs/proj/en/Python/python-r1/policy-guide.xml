<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/Python/python-r1/policy-guide.xml,v 1.4 2013/01/02 19:54:33 mgorny Exp $ -->

<guide lang="en">
<title>python-r1 Policy Guide</title>

<author title="Author">
	<mail link="mgorny@gentoo.org">Michał Górny</mail>
</author>

<author title="Editor">
	<mail link="idella4@gentoo.org">Ian Delaney</mail>
</author>

<abstract>
	This guide lists the rules and policies for maintaining Python
	packages.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/3.0/ -->
<license version="3.0"/>

<version>3</version>
<date>2012-12-26</date>

<chapter id="Common_policies">
	<title>Common policies</title>

	<section id="cp_State_of_Python_implementation_support_in_Gentoo">
		<title>State of Python implementation support in Gentoo</title>

		<body>
			<p>
				The Python implementations supported by the python-r1 suite can
				be divided into four groups:
			</p>

			<ol>
				<li>
					Current stable implementations — the implementations which
					are enabled by the default value of <c>PYTHON_TARGETS</c>. All
					Python packages are supposed to support at least one.
				</li>

				<li>
					Supported implementations — the new versions being tested
					as well as the old ones still being supported. Developers
					are encouraged to ensure support for those implementations
					and apply the necessary patches.
				</li>

				<li>
					Unsupported implementations — the implementations which
					are still in the tree but their maintenance is undesirably
					resource consuming. Developers are not expected to support
					those packages by patching, and can drop them
					from <c>PYTHON_COMPAT</c> at will.
				</li>

				<li>
					Deprecated implementations — the implementations being phased
					out. Developers should not add those implementations
					to <c>PYTHON_COMPAT</c> without prior request from user
					and discussion with the Python team.
				</li>
			</ol>

			<p>
				The state of Python implementations is listed in the following
				table:
			</p>

			<table>
				<tr><th>Implementation</th><th>State</th></tr>
				<tr><ti>CPython 2.5</ti><ti>unsupported</ti></tr>
				<tr><ti>CPython 2.6</ti><ti>supported</ti></tr>
				<tr><ti>CPython 2.7</ti><ti>current stable</ti></tr>
				<tr><ti>CPython 3.1</ti><ti>supported</ti></tr>
				<tr><ti>CPython 3.2</ti><ti>current stable</ti></tr>
				<tr><ti>CPython 3.3</ti><ti>supported</ti></tr>
				<tr><ti>PyPy 1.8</ti><ti>deprecated</ti></tr>
				<tr><ti>PyPy 1.9</ti><ti>supported</ti></tr>
				<tr><ti>PyPy 2.0</ti><ti>supported</ti></tr>
				<tr><ti>Jython 2.5</ti><ti>deprecated</ti></tr>
			</table>

		</body>
	</section>

	<section id="cp_Adding_implementations_to_PYTHON_COMPAT">
		<title>Adding implementations to PYTHON_COMPAT</title>

		<body>
			<p>
				The <c>PYTHON_COMPAT</c> variable should be treated
				with respect similar to that given for <c>KEYWORDS</c>.
				No implementation should ever be listed without prior testing.
			</p>

			<p>
				Any developer is allowed to enable additional implementations
				in an ebuild of his own accord or upon a user's request.
				However, the package should be tested with an adequate level
				of scrutiny on at least one of the keyworded architectures.
				The testing may involve running a test suite, testing
				the package's Python scripts, or a basic subset of package's
				API.
			</p>

			<p>
				The list of enabled implementations in stable packages must
				not be changed. Therefore, if a package is stable, it should
				be revision-bumped, the new implementation added to the new,
				non-stable ebuild.
			</p>

			<p>
				When a Python package is being submitted for stabilization, some
				of the supported implementations may lack stable keywords.
				In that case, the ebuild should be revision-bumped
				and the conflicting Python implementations removed
				from the ebuild being stabilized.
			</p>

			<p>
				When a new Python package is being added to a repository, it
				must be tested with at least both current stable
				implementations. Developers are encouraged to test additional
				Python implementations. The deprecated implementations must
				not be added without prior permission from the Python team.
			</p>
		</body>
	</section>

	<section id="cp_Use_of_virtual_packages">
		<title>Use of virtual packages</title>

		<body>
			<p>
				The virtual packages are used mostly to provide a consistent way
				of depending on Python packages. They serve as a replacement
				for dependencies which would normally need to be made conditional
				upon a particular set of Python implementations.
			</p>

			<pre caption='Example benefit of virtual packages'>
<comment># Non-virtual solution</comment>
<var>RDEPEND</var>="
	<ident>python_targets_python2_5?</ident> ( <const>dev-python/argparse[python_targets_python2_5]</const> )
	<ident>python_targets_python2_6?</ident> ( <const>dev-python/argparse[python_targets_python2_6]</const> )
	<ident>python_targets_jython2_5?</ident> ( <const>dev-python/argparse[python_targets_jython2_5]</const> )"

<comment># Virtual solution</comment>
<var>RDEPEND</var>="<const>virtual/python-argparse[${PYTHON_USEDEP}]</const>"</pre>

			<p>
				The Python ebuilds should use virtuals whenever they need
				to express a dependency which varies through enabled Python
				implementations. The following table lists all virtual packages
				available to date and cases when they can be replaced
				with direct dependencies:
			</p>

			<table>
				<tr>
					<th>Virtual</th>
					<th>Description</th>
					<th>Alternatives</th>
				</tr>

				<tr>
					<ti><c>virtual/python-argparse</c></ti>
					<ti>
						Provides the <c>argparse</c> module (built-in since
						python2.7).
					</ti>
					<ti>
						Packages which do not support Python 2.5 nor 2.6 do not need
						to depend on <c>argparse</c> at all (it is built-in).
					</ti>
				</tr>
			</table>
		</body>
	</section>
</chapter>

<!-- vim:se tw=72 ts=2 sts=2 sw=2 :-->
</guide>
