<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/en/2005.0-upgrade-amd64.xml">
<title>AMD64 2005.0 Upgrade Guide</title>
<author title="Author">
  <mail link="gerrynjr@gentoo.org">Gerald J. Normandin Jr.</mail>
</author>
<author title="Author">
  <mail link="eradicator@gentoo.org">Eradicator</mail>
</author>
<abstract>
This guide will show you how to upgrade from 2004.3 and 2004.3 with lib64 to 2005.0
</abstract>
<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>1.0</version>
<date>13 Jan 05</date>

<chapter>
<title>Howto Upgrade an AMD64 installation.</title>
<section>
<body>
<p>
Multilib is now required with the release of 2005.0. This guide will show you how to upgrade a prior installation to a system that uses our new profile and the new multilib. There are two ways of upgrading: the easy and scripted way, or the longer way by hand.
</p>
<note>Please replace mirror:// with your respective mirror.</note>
<pre>
<codenote>For example</codenote>
# <i>wget http://gentoo.osuosl.org/releases/amd64/2005.0/profile_update/Makefile-profile_update-2005.0</i>
</pre>
</body>
</section>
</chapter>
<chapter>
<title>The Easy, Scripted Way</title>
<section>
<body>
<pre>
# <i>mkdir /usr/tmp/profile-update</i>
# <i>cd /usr/tmp/profile-update</i>
# <i>wget mirror://gentoo/releases/amd64/2005.0/profile_update/Makefile-profile_update-2005.0</i>
# <i>lynx -source mirror://gentoo/releases/amd64/2005.0/profile_update/Makefile-profile_update-2005.0.md5sum | md5sum -c -</i>
<codenote>The Makefile can be edited to add your own mirror server</codenote>
# <i>make -f Makefile-profile_update-2005.0</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>
</body>
</section>	
</chapter>
<chapter> 
<title>Upgrading by hand</title>
<section>
<body>
<p>
If you currently have USE=-multilib, you need to set multilib in USE and re-emerge gcc. 
</p>
<pre>
# <i>nano /etc/make.conf</i>
<codenote>remove -mutilib from USEflags</codenote>

# <i>emerge gcc</i>
</pre>
<p>
Additionally, portage, gcc-config, distcc (if used) and a merge of linux-headers greater than version 2.6.8.1 is needed. This will allow the system to take full advantage of multilib.
</p>
<pre>
# <i>emerge -v '>=sys-apps/portage-2.0.51-r9'</i>
# <i>emerge -v '>=sys-devel/gcc-config-1.3.9'</i>
# <i>emerge -v '>=sys-devel/distcc-2.18.3-r1'</i>
# <i>emerge unmerge linux26-headers</i>
# <i>emerge -v '>=linux-headers-2.6.8.1-r4'</i>
</pre>
<p>
Since Gentoo 2005.0 utilizes mutilib by default, we no longer use the *-emul libraries, and sys-lib/glibc provides it's own 32 bit libraries. We then need to unmerge emul-linux-x86-glibc and prep the filesystem.
</p>
<pre>
# <i>emerge unmerge emul-linux-x86-glibc</i>
# <i>rm /lib32 /usr/lib32 /usr/X11R6/lib32</i>
# <i>emerge -v baselayout</i>
# <i>cp /emul/linux/x86/lib32/libsandbox.so /lib32</i>
# <i>env-update</i>
</pre>
<p>
We are now ready to actually upgrade the profile to 2005.0
</p>
<pre>
# <i>rm /etc/make.profile</i>
# <i>ln -s /usr/portage/profiles/default-linux/amd64/2005.0 /etc/make.profile</i>
</pre>
</body>
</section>
<section> 
<title>Upgrading glibc</title>
<body>
<p>
Glibc must now be upgraded so the 32 bit version of glibc is also compiled to work with multilib. The downloading of a few binary packages is required to just kickstart the compile of the 32 bit glibc.
</p>
<pre>
# <i>cd /usr/tmp</i>
# <i>wget mirror://gentoo/releases/amd64/2005.0/profile_update/glibc-2.3.4.20040808-r1-lib32.tar.bz2</i>
# <i>lynx -source mirror://gentoo/releases/amd64/2005.0/profile_update/glibc-2.3.4.20040808-r1.tar.bz2.md5sum | md5sum -c -</i>
<codenote>Checking the validity of the download</codenote>
# <i>cd /</i>
# <i>tar xjf /usr/tmp/glibc-2.3.4.20040808-r1-lib32.tar.bz2</i>
# <i>emerge -O -v glibc</i>
</pre>
<warn>You MUST do every step after the profile switch even if you 
already have that version (or later) installed.  The newer version of 
glibc is currently masked on 2005.0 because it hasn't been updated yet 
to build both 32bit and 64bit libs.  I hope to get this done in the next 
few days, but no promises yet.
</warn>
<note>
linux-headers is masked in the main package.mask still, so unmask it 
yourself. linux26-headers-2.6.8.1-r3 will probably work, but I noticed 
it doesn't get the headers in asm-i386/mach-*/, but my updated 
multilib.eclass method does for linux-headers.
</note>
<warn>
USE=multilib is now required.  If you don't have it set, you won't be 
able to emerge anything, so please remove -multilib from your USE if you 
had it set.
</warn>
</body>
</section>
</chapter>
</guide>
