<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/base/amd64/Attic/install-software.xml,v 1.10 2004/06/14 21:58:39 kugelfang Exp $ -->
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The context of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommonds.org/licenses/by-sa/1.0 -->

<sections>

<section>
	<title>Available Kernels</title>
<subsection>
	<title>On The LiveCD</title>
<body>
<p>
There are three kernels available on the LiveCD to boot from.  Select the one that is appropriate for you hardware:
</p>
<ul>
	<li><c>gentoo</c> - The "default" kernel, used by uni-processor computers</li>
	<li><c>smp</c> - The same as <c>gentoo</c>, except for multi-processor Opteron computers</li>
	<li><c>emachines</c> - For use with eMachines Mobile Athlon64 laptops</li>
</ul>
<p>
The <c>emachines</c> kernel passes several special parameters to the kernel, like <c>pci=noacpi noapic</c> and has USB statically compiled into the kernel. It also includes relaxed AML in ACPI.
</p>
</body>
</subsection>
<subsection>
	<title>Using The Right Kernel Sources</title>
<body>
<impo>Use <path>sys-kernel/gentoo-dev-sources</path> line of kernels! It
has AMD64-specific patches, as well as additional enhancements. We will not be
able to support you if you use another source.</impo>
</body>
</subsection>
<subsection>
	<title>Building A Kernel For An eMachine Laptop</title>
<body>
<p>
When configuring the kernel for use on an eMachines Mobile Athlon64 laptop,  you <e>must</e> compile USB support into the kernel.  Otherwise, you will receive errors about an "unknown keypress' from <path>atkbd.c</path>. Disabling USB support does not work.
</p>
<p>
You also must pass the kernel parameters <c>pci=noacpi noapic</c> to the kernel on an eMachines Mobile Athlon64 laptop.
</p>
</body>
</subsection>
<subsection>
	<title>Current Kernel Patches</title>
<body>
<p>
 Please view the currently submitted kernel patches that Gentoo users have found
necessary/useful here:
<uri>http://www.gentoo.org/cgi-bin/viewcvs.cgi/src/kernel/genpatches/?root=gentoo</uri>. These patches are
already included in gentoo-dev-sources, so you needn't apply these yourself.
 </p>
 </body>
 </subsection>
 <subsection>
	<title>2.4.x Kernel Officially Deprecated</title>
<body>
<p>
<b>The 2.4.x kernel line is officially deprecated for AMD64.</b> As of 2.4.23-pre7, devfs
has been disabled (hardcoded in kernel), stating memory corruption as the
reason.  We at Gentoo have not experienced any such problems, but 2.4 is not a
good solution on Gentoo without devfs.
</p>
</body>
</subsection>
</section>

<section><title>Kernel Panics At Boot</title>
<body>
<p>
If you're having kernel panics on boot, please try passing <c>idle=poll</c> as a
boot option. There is a problem with many BIOS's out there and seems to mainly
affect VIA chipset motherboards. You should only try passing that boot option
<e>after</e> updating to the latest BIOS available by your motherboard
manufacturer. You may also be able to solve this by disabling Legacy USB support
in your BIOS. If you are forced to use the <c>idle=poll</c> option, please
contact your motherboard manufacturer/BIOS vendor for a fix for the CPU Errata
#93.
</p>
<p>
For a little more info on this topic, see these mailing list archives:
</p>
<ul>
	<li><uri>http://lists.suse.com/archive/suse-AMD64/2003-Dec/0031.html</uri></li>
	<li><uri>http://lists.suse.com/archive/suse-AMD64/2003-Dec/0034.html</uri></li>
</ul>
<p>
And you can see it's not a Gentoo-specific problem!
</p>
</body>
</section>

<section><title>LiveCD Lockups At Shutdown</title>
<body>
<p>
Sometimes, the LiveCD will not shutdown or reboot properly after "Remounting
remaining filesystems readonly". This is a bug that also happens on x86.  Just
reboot the computer the hard way and it should cause no problems.
</p>
</body>
</section>
 
<section><title>Filesystem Support</title>
<body>
<p>
We strongly recommend sticking with ext2/3 for now. We have had random reported
problems with reiserfs on AMD64 and have heard of major problems with running
JFS on 64-bit systems (which definately seems odd considering it was designed
for 64-bit systems initially).
</p>
<table>
<tr>
 	<th>Filesystem:</th>
	<th>Status:</th>
</tr>
<tr>
	<ti>ext2</ti>
	<ti>STABLE</ti>
</tr>
<tr>
	<ti>ext3</ti>
	<ti>STABLE</ti>
</tr>
<tr>
	<ti>XFS</ti>
	<ti>UNSTABLE (See Bug #43971)</ti>
</tr>
<tr>
	<ti>JFS</ti>
	<ti>UNSTABLE</ti>
</tr>
<tr>
	<ti>reiserfs</ti>
	<ti>UNSTABLE</ti>
</tr>
</table>
<p>
 Please report any problems with any filesystem to me on AMD64.  Also let me
know if you have success with one that is marked as bad here. 
</p>
<note>The reiserfs problems only appear to happen when you copy files
from a reiserfs partition to an ext3 partition, e.g. copying a kernel to
<path>/boot</path>. It causes a kernel panic. This has been reported by many
people.</note>
</body>
</section>
 
<section><title>The Bootloader: Using grub-static</title>
<body>
<p>
Grub will not build in a pure 64-bit environment. We have also experienced
problems building GRUB when using the <c>-m32</c> CFLAGS on AMD64. Currently,
the best solution is to install the pre-compiled, 32-bit static version of
GRUB. It can be installed by following these steps, then continuing on with GRUB
as described in the x86 install guide.
</p>
<pre>
emerge grub-static
cp -Rpv /usr/share/grub/i386-pc/* /boot/grub
</pre>
</body>
</section>
 
<section><title>Many Packages Are Still Masked</title>
<body>
<p>
Many packages which are unmasked on other architectures are still masked on
AMD64. This doesn't mean that they don't work. It simply means that no Gentoo
developer has been able to test them on an AMD64 machine. Please test masked
applications and <uri link="http://bugs.gentoo.org">submit a bug report</uri>
letting the developers know whether a package works or not.
</p>
</body>
</section>

<section><title>XFCE Not Included On GRP CD</title>
<body>
<p>
XFCE is currently considered in testing for AMD64 (keyworded <c>~amd64</c>).  Therefore, it was not included on the GRP CD.  If you would like to install XFCE, set <c>ACCEPT_KEYWORDS="~amd64"</c> and merge XFCE from sources.
</p>
<pre>
ACCEPT_KEYWORDS="~amd64" emerge xfce
</pre>
</body>
</section>

<section><title>Packages That Don't Work</title>
<body>
<p>
Don't currently work: 
</p>
<ul>
	<li>Firebird (the database, NOT the browser)</li>
</ul>
<p>
Things that won't work in 64-bit mode, but WILL work in 32-bit mode (assuming
app-emulation/emul-linux-x86-baselibs and friends are installed):
</p>
<ul>
	<li>Any program that uses 32-bit dlls from windows (such as mplayer/xine support
	for some proprietary formats)</li>
	<li>Any programs that require 32-bit assembly</li>
</ul>
</body>
</section>

<section><title>Java Support</title>
<body>
<p>
Blackdown released a native 64-bit Java for Linux on AMD64. It is a
release candidate so do not expect it to be perfect. It is in portage as
<path>blackdown-jdk-1.4.2_rc1</path> and <path>blackdown-jre-1.4.2_rc1</path>.
Previous to this we required the 32-bit emul libraries to be installed in order
to use java.
</p>
<p>
Some people have noted that the 64-bit Java VM is slower than the 32-bit Java
VM. Juergen Kreileder of Blackdown was kind enough to respond:
</p>
<pre>
Actually the 64-bit VM is faster than the 32-bit VM in allmost all
benchmarks.

The difference they see is more likely to come from the different
VMs:
The i386 version comes with the HotSpot Client VM and the HotSpot
Server VM, the Client VM gets used by default.  The AMD64 version
only comes with the Server VM, the Client VM has not been ported yet.

In general the Server VM is the faster VM.  Its compiler does more
optimizations and is more aggressive than the Client VM's compiler.
It usually generates much better code.
The downside is that doing this optimizations takes CPU time and
memory.  Because of this running GUI code in the Client VM often
is faster (at least initially) than running it in the Server VM.

In other words: It's not fair to compare i386-client with
AMD64-server.  You have to compare i386-server (ie. "java -server
...") with AMD64-server.
</pre>
<p>
Also, he answered a question about a potential timeline that the client VM
might be accomplished in:
</p>
<pre>
It won't be in the final 1.4.2 release.  It's unlikely for 1.5.0 (both
Sun and Blackdown), Sun is happy with the Server VM port and not
really interested in getting the Client VM ported (the other 64-bit
VMs, for IA64 &amp; SPARC64, are Server VM-only too).  And it's just too
much work (I'd estimate 10-13 man weeks) to do it without payment.
</pre>
<p>
So if you're going to run benchmarks, to be fair, run java -server on both
arches, and don't expect the client vm to be done anytime too soon. ;-)
</p>
</body>
</section>
 
<section><title>Installing OpenOffice</title>
<body>
<p>
OpenOffice 1.1.0 does not compile properly on AMD64 systems at this time.  You must merge the openoffice-bin package in order to use OpenOffice on Gentoo/AMD64.
</p>
<note>
You must <c>multilib</c> in your USE flags and you must have emerged gcc as well as portage with this flags in order to install Openoffice-bin correctly.
</note>
<warn>
You can also do <c>FEATURES="-sandbox" emerge openoffice-bin</c> in case you don't want to recompile gcc and portage, but by this you disable a security mechanism developed to protect your system.
</warn>
</body>
</section>

<section><title>Installing Xine-lib</title>
<body>
<p>
xine-lib may fail to merge if nvidia-glx is already installed and XFree86 4.3 is in use (4.3.99.902-r2 is not affected). To work around this, perform the following steps:
</p>
<pre>
emerge -C nvidia-glx
emerge xine-lib
emerge nvidia-glx
</pre>
<note><c>x11-base/xFree-4.*</c> is deprecated on amd64. Please use <c>x11-base/xorg-x11</c></note>
</body>
</section>

<section><title>Properly Setting CFLAGS</title>
<body>
<p>
The name of the CPU is "k8", but you don't need to put it as a -march=k8 since
there is only one x86-64 CPU out there anyways. GCC version before 3.4 will not
recognize -march=k8 and will FAIL if it is set. 
</p>
<pre caption="gcc-3.3 CFLAGS">
...
CFLAGS="-O2 -pipe"
...
</pre>
<pre caption="gcc-3.4 CFLAGS">
...
CFLAGS="-march=k8 -O2 -pipe"
...
</pre>
<note>
<c>-march=k8</c> equals <c>-march=athlon64</c> equals <c>-march=opteron</c>.
</note>
<p>
There used to be issues with the lack of <c>-fPIC</c> being specified when
building shared objects, the reasoning is in this mailing list post: 
 <uri link="http://www.x86-64.org/lists/discuss/msg02621.html">Porting to
Hammer</uri> -- scan down to "Shared libraries must be compiled with -fPIC". If
you find any packages that complain about needing <c>-fPIC</c> to run/link
properly, please notify us immediately, as we need to update that package.
Please do not specify <c>-fPIC</c> in your global CFLAGS as that is not an
acceptable solution and just a workaround.
</p>
<p>
Please do not add <c>-m32</c> to your USE flags, as you do not want to compile
the system in 32-bit mode, and by default Gentoo does not support compiling
32-bit binaries. Use of the <c>-m64</c> flag is irrelevant as the compiler
defaults to 64-bit mode and could have negative effects on code that may supply
<c>-m32</c> internally to compile 32-bit assembly (such as newer releases of
grub will do).
</p>
<warn>Don't use <c>-Os</c>. This has been known to prevent parts of KDE 3.2.0 from compiling.</warn>
</body>
</section>
 
<section><title>USE Flags That Are Ignored</title>
<body>
<p>
The <c>mmx</c>, <c>3dnow</c>, <c>sse</c> and <c>sse2</c> USE flags are ignored
on AMD64, since all AMD64 processors support those instruction sets. The are
ignored because they enable 32bit assembly optimisation for some packages.
</p>
</body>
</section>
 
<section><title>Reporting Bugs And Submitting Patches</title>
<body>
<p>
If you an application that you've had problems with, have a patch to solve
problems, or want to report a successful build so we can mark it as such in
portage, please post a bug report on <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>.
</p>
<note>You may also CC: <mail link="amd64@gentoo.org">amd64@gentoo.org</mail> if you wish.</note>
<note>To submit a patch, you must first submit a bug report, then go back to
the bug report and select "Create a new attachment".</note>
</body>
</section>

</sections>
