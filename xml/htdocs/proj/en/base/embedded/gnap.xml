<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/proj/en/base/embedded/gnap.xml">
<title>Gentoo Network APpliance</title>
<author title="Author">
  <mail link="koon@gentoo.org">Thierry Carrez</mail>
</author>

<abstract>
This document is the GNAP entry page. It describes the features of the
current and future GNAP releases.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.8</version>

<date>August 10, 2005</date>

<chapter>
<title>Introduction to GNAP</title>
<section>
<title>What is GNAP ?</title>
<body>

<p>
The acronym GNAP stands for Gentoo Network APpliance. It's an easy way to build
Gentoo-based network appliance systems, ready for use in old PCs or embedded
devices without the need for a full installation.
</p>

<p>
Using GNAP, you can build in a few minutes target systems geared toward network
services like routing, firewalling, traffic profiling, VPN and network
monitoring, that will run directly from a LiveCD or a disk device (including
CompactFlash cards or DiskOnModules).
</p>

<p>
Specific configuration files are added to the LiveCD or disk to customize its
behaviour. Those systems can run stateless, making them easy to restart,
and impossible to permanently compromise. They can also save their modified
configuration so that they don't need to be rebuilt all the time.
</p>

</body>
</section>
<section>
<title>But why GNAP ?</title>
<body>

<p>
I had a bunch of old PCs with fragile components, and wanted to use them as
internal routers and firewalls. I wanted to be able to easily switch PCs in
case of failure. Using removable media with a burned-on configuration is the
most flexible way I found. When it fails, just put the media on another
machine. I started by using
<uri link="http://leaf.sourceforge.net/mod.php?mod=userpage&amp;menu=910&amp;page_id=36">LEAF Bering-uClibc</uri>
floppy-based firewalls but was quickly
undermined by problems: media fragility, difficulty to automate creation of
floppies and lack of easy extensibility.
I switched to LEAF Bering-uClibc
<uri link="http://leaf.sourceforge.net/doc/guide/bubooting.html#id2572755">CDROM-based configurations</uri>,
with a web-based automated ISO generation. This solved most of the
problems but the extensibility problems remain, and maintaining the web-app
was becoming a nightmare.
</p>

<p>
I finally chose to leverage Gentoo
<uri link="http://www.gentoo.org/proj/en/releng/catalyst/">Catalyst</uri>
power to build custom LiveCDs,
solving both the extensibility problem and the non-standard solution
maintenance. The idea was to have a generic LiveCD core that I could build once
and use everywhere, and burn on the CD a specific configuration overlay to
customize the appliance role. This simplifies CD generation as you don't have
to go through the whole Catalyst process to customize a specific LiveCD.
</p>

</body>
</section>
<section>
<title>Fast to build, easy to maintain up to date</title>
<body>

<p>
To create a GNAP system, use the provided GNAP Core and create configuration
overlays detailing your specific needs. Using the <c>gnap_overlay</c> script,
in a few seconds your overlays are combined to the GNAP Core to produce a new
LiveCD ISO file. Burn this file to a CD, put it inside an old box (no hard
disk or mouse needed), and boot. Alternatively, use the same script to
initialize a disk device with a complete bootable filesystem, put the disk in
its target environment, and boot.
</p>

<p>
To completely update a GNAP configuration, just modify your saved overlay and
combine it to the latest GNAP Core to produce an updated GNAP system.
Reboot the appliance with the new system. You're done.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Documentation</title>
<section>
<title>GNAP User Guide</title>
<body>

<p>
The <uri link="gnap-userguide.xml">GNAP User Guide</uri> covers everything
you need to know to produce and customize GNAP systems. Read it and start
using GNAP today !
</p>

</body>
</section>
<section>
<title>GNAP Advanced User Guide</title>
<body>

<p>
The <uri link="gnap-advancedguide.xml">GNAP Advanced User Guide</uri> gives
information for power users that want to further customize and modify what
their GNAP systems can do. You should be familiar with GNAP systems and Gentoo
systems in general before reading this guide.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Standard features</title>
<section>
<body>

<ul>
<li>Stripped down system with squashfs compressed filesystem (13Mb)</li>
<li>hardened-sources 2.6 kernel</li>
<li>GRsec kernel security patch enabled, including PaX address
    randomization</li>
<li>Small footprint executables with PIE/SSP security protection
    (Gentoo uclibc/x86/hardened profile)</li>
<li>Features supported as configuration options: Dropbear (SSH server),
    Shorewall/FireHOL (iptables firewall helpers), traffic control using
    cbqinit or htbinit, OpenVPN, OpenNTPD (time synchronisation), DNSMasq
    (DNS relay and DHCP server), RP-PPPOE</li>
<li>Utilities: Watch network traffic flow using iftop or tcpdump</li>
<li>Standard Extensions: boa HTTP server, rrdtool graph backend</li>
</ul>

</body>
</section>
</chapter>
<chapter>
<title>Resources</title>
<section>
<title>CVS and Bugs database</title>
<body>

<p>
GNAP CVS repository can be browsed
<uri link="http://www.gentoo.org/cgi-bin/viewcvs.cgi/embedded/gnap/?root=gentoo-projects">here</uri>.
</p>

<p>
GNAP uses <uri link="http://bugs.gentoo.org/">Gentoo Bugzilla</uri> as its
bugsystem. Please put "GNAP" in the bug title and assign the bug directly to
koon@gentoo.org.
</p>

</body>
</section>
<section>
<title>Communication channels</title>
<body>

<p>
The GNAP project is part of Gentoo Linux's Embedded Project and shares
communication channels with it. You can
<uri link="http://www.gentoo.org/main/en/lists.xml">subscribe</uri> to the
<e>gentoo-embedded@gentoo.org</e> mailing-list or discuss on the
<e>#gentoo-embedded</e> official
<uri link="http://www.gentoo.org/main/en/irc.xml">IRC channel</uri>.
</p>

<p>
A GNAP-specific IRC channel has also be created for GNAP users to meet, it is
located at <e>#gentoo-gnap</e> on FreeNode.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Changelog</title>

<section>
<title>GNAP 1.8 (2005/08/10)</title>
<body>

<ul>
<li>New feature to automate configuration changes backup (bug #86241). See the
    <c>RW_SYNC</c> option in <path>overlay.conf</path>, which replaces the
    <c>RW_OVERLAY</c> option (deprecated)</li>
<li>GNAP kernel now supports n_hdlc line discipline to use with synchronous
    PPP (bug #99115), and vfat filesystems as r/w overlays</li>
<li>Support to specify account password initialization (chpasswd) and services
    to start (services_start) as files on the target filesystem</li>
<li>Support for customizable baudrate on the serial console</li>
<li>Possibility to use genkernel-built packages (minkernpackage,
    modulespackage) as GNAP extensions</li>
<li><c>gnap_make</c> now starts from Portage snapshot files rather than
    requiring a Catalyst snapshot stage. A reduced Portage snapshot is now
    shipped in the gnap-dev package to facilitate GNAP rebuild</li>
<li>Easier filesystem customization using <path>root_overlay/</path> in
    <c>gnap_make</c></li>
<li>Support for distcc building, in case you have uclibc-powered systems to use
    as build partners...</li>
<li>The rrdtool backend, which was a standard core feature, has been moved to
    a standard extension. Use <c>gnap_remaster -e rrdtool</c> to rebuild the
    core with that extension included</li>
<li>20050808 portage snapshot compatibility, including zlib security fixes</li>
<li>GNAP now uses udev as its device manager, anticipating devfs removal in
    future kernels</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.7.1 (2005/06/23)</title>
<body>

<ul>
<li>Bug #96050: Building extensions with multiple packages was resulting
    in a failure (patch from BaSS)</li>
<li><c>gnap_overlay</c> option <c>-s</c> (use serial console) was not properly
    supported</li>
<li>20050621 portage snapshot compatibility</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.7 (2005/05/31)</title>
<body>

<ul>
<li>Bug #92239: It was impossible to use multiple overlays (<c>-o</c> option)
    in <c>gnap_overlay</c> (patch from Paul Smith)</li>
<li>GNAP now supports overlays from a r/w partition at boot time, allowing
    to save configuration changes back to a floppy or a CF partition. See the
    <c>RW_OVERLAY</c> option in <path>overlay.conf</path></li>
<li>GNAP now supports the concept of "extensions", making it easier to
    extand GNAP functionality. The <c>gnap-ext</c> package contains
    standard prebuilt extensions and the new <c>gnap_remaster</c> tool you
    can use to add extensions to a core. <c>gnap_make</c> has been extended
    to allow building your own extensions (<c>-t extensions</c> option),
    without requiring a complete core rebuild</li>
<li>The boa HTTP server, which was a standard core feature, has been moved to
    a standard extension. Use <c>gnap_remaster -e boa</c> to rebuild the core
    with that extension included</li>
<li>More features, but always slimmer: GNAP 1.7 is 9% smaller than GNAP
    1.5</li>
<li>20050529 portage snapshot compatibility, including OpenVPN 2.0</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.6 (2005/05/17)</title>
<body>

<ul>
<li>DHCP was in fact not working since a few versions. It's back, and it's
    automatically used when no /etc/conf.d/net file is overlaid</li>
<li>In Disk mode, console was only appearing on the serial port. It now
    appears by default on the default console and can be swicthed to use
    serial using the new <c>-s</c> option</li>
<li><c>gnap_make</c> has a new <c>-o</c> option to specify a portage overlay
    to use in your snapshots (patch from Nick Lemberger)</li>
<li>20050515 portage snapshot compatibility</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.5.1 (2005/04/20)</title>
<body>

<ul>
<li>GNAP is now available in Portage directly</li>
<li><c>gnap_overlay</c> disk-mode was not working in 1.5</li>
<li><c>gnap_overlay</c> was warning about ISO overwrite even if there wasn't
    a file with the same name</li>
<li>20050419 portage snapshot compatibility</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.5 (2005/04/06)</title>
<body>

<ul>
<li><c>gnap_make</c> and <c>gnap_overlay</c> have been extensively rewritten
    for prettier output, better warnings and handling of errors and
    position-independant parameters support</li>
<li>Now includes man pages and support for installation from Portage</li>
<li>Support for multiple overlay directories and using tar.bz2 files
    (conflets) as overlay sources</li>
<li>No more "/etc/init.d/serial missing" warnings during boot</li>
<li>20050404 portage snapshot, including a dnsmasq security update</li>
<li>6.5 % smaller than version 1.2 core file !</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.2.1 (2005/03/21)</title>
<body>

<ul>
<li>hardened-dev-sources-2.6.11-r1 with recent GRSEC security fixes</li>
<li><c>gnap_make</c> now creates the necessary temporary directories under
    <path>/var/tmp/catalyst</path> at first run.</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.2 (2005/02/15)</title>
<body>

<ul>
<li>hardened-dev-sources-2.6.10</li>
<li>RP-PPPOE is now supported (see USE_PPPOE option in
    overlay.conf)</li>
<li>Support for the FireHOL iptables script, in addition to Shorewall (see
    FW_TYPE option in overlay.conf)</li>
<li>A minimal firewall is started before the network and the shorewall/firehol
    script, allowing full protection while still enabling any Shorewall
    configuration options</li>
<li>Support for the htbinit traffic control script, in addition to cbqinit
    (see the USE_TC and TC_TYPE options in overlay.conf)</li>
<li>iputils (ping, tracepath...), which was unavailable in 1.1, is back !</li>
<li><c>gnap_overlay</c> now ignores <path>CVS/</path> subdirectories,
    allowing you to use CVS to control versions on your overlay files without
    bringing unnecessary fat into your GNAP system</li>
<li>More features, less fat: GNAP 1.2 core is 5% smaller than GNAP 1.1</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.1 (2005/01/06)</title>
<body>

<ul>
<li>Boa (HTTP server) is now supported (see USE_HTTP option in
    overlay.conf)</li>
<li>rrdtool can be used to store and graph statistics</li>
<li>Boot speedups (new baselayout scripts, possibility to use "dash" as the
    SHOREWALL_SHELL)</li>
<li>OpenNTPD now support "-s" option in /etc/conf.d/ntpd to set time at
    startup</li>
<li>Shorewall is now started before the network for full protection</li>
<li>OpenSSH has been replaced by Dropbear to make GNAP even smaller despite
    all those new features</li>
<li>A README.upgrading file has been added to the gnap-tools to help in
    upgrading existing configurations</li>
</ul>

</body>
</section>
<section>
<title>GNAP 1.0 (2004/12/03)</title>
<body>

<ul>
<li>DNSMasq (DNS relay and DHCP server) is now supported (see USE_DNSDHCP
    option in overlay.conf)</li>
<li>GNAP uses recent (~x86) baselayout
    (supports iproute2-style network configuration)</li>
<li>Speedups in overlaying (one single pass to add all services)</li>
<li>14% smaller (now fits a 16Mb CF card)</li>
<li>No more "CONFIG_HOTPLUG not enabled" error</li>
<li>Replaced buggy ntpd by smaller and nicer OpenNTPD</li>
</ul>

</body>
</section>
</chapter>
</guide>
