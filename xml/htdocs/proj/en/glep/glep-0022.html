<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Docutils 0.3.0: http://docutils.sourceforge.net/" />
  <title>GLEP 22 -- New "keyword" system to incorporate various userlands/kernels/archs</title>
  <link rel="stylesheet" href="tools/glep.css" type="text/css" />
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="http://www.gentoo.org/" title="Gentoo Linux Home Page">
<img src="http://www.gentoo.org/images/gentoo-new.gif" alt="[Gentoo]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="http://www.gentoo.org/">Gentoo Linux Home</a></b>]
[<b><a href="http://www.gentoo.org/proj/en/glep">GLEP Index</a></b>]
[<b><a href="http://www.gentoo.org/proj/en/glep/glep-0022.txt">GLEP Source</a></b>]
</td></tr></table>
<div class="document">
<table class="rfc2822 field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">GLEP:</th><td class="field-body">22</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">New &quot;keyword&quot; system to incorporate various userlands/kernels/archs</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">1.1</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference" href="http://www.gentoo.org/cgi-bin/viewcvs.cgi/xml/htdocs/proj/en/glep/glep-0022.txt?cvsroot=gentoo">2004/03/07 02:20:32</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Grant Goodyear &lt;g2boojum&#32;&#97;t&#32;gentoo.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference" href="glep-0002.html">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">6-Mar-2004</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">6-Mar-2004</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#credits" id="id14" name="id14">Credits</a></li>
<li><a class="reference" href="#abstract" id="id15" name="id15">Abstract</a></li>
<li><a class="reference" href="#motivation" id="id16" name="id16">Motivation</a></li>
<li><a class="reference" href="#specification" id="id17" name="id17">Specification</a><ul>
<li><a class="reference" href="#new-variables" id="id18" name="id18">New Variables</a></li>
<li><a class="reference" href="#reasonable-defaults" id="id19" name="id19">Reasonable Defaults</a></li>
<li><a class="reference" href="#profiles" id="id20" name="id20">Profiles</a></li>
</ul>
</li>
<li><a class="reference" href="#rationale" id="id21" name="id21">Rationale</a></li>
<li><a class="reference" href="#implementation" id="id22" name="id22">Implementation</a></li>
<li><a class="reference" href="#backwards-compatibility" id="id23" name="id23">Backwards Compatibility</a></li>
<li><a class="reference" href="#id1" id="id24" name="id24">References</a></li>
<li><a class="reference" href="#copyright" id="id25" name="id25">Copyright</a></li>
</ul>
</div>
<div class="section" id="credits">
<h1><a class="toc-backref" href="#id14" name="credits">Credits</a></h1>
<p>This GLEP originated from the concerns that Daniel Robbins had with
the <em>x86obsd</em> keyword, and his desire to make the KEYWORDS variable more
&quot;feature-rich&quot;.  Drobbins' original idea was that we should 
allow compound 
keywords such as gnu/x86, gnu/ppc, and macos/ppc (which would be explicit
versions of the more familiar x86, ppc, and macos keywords).  Method noted
that userland/arch failed to capture the full range of possibilities (what 
about a GNU userland on a BSD kernel+libc?), and
the issue has languished due to a lack of reasonable solutions.</p>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id15" name="abstract">Abstract</a></h1>
<p>As Gentoo branches out to support non-Linux and non-GNU systems (such
as Hurd or the *BSDs), the potential for an &quot;explosion&quot; of possible
keywords becomes rather large, since each 
new userland/kernel/arch/whatever
combination would require a new keyword.  
This GLEP proposes replacing the current
KEYWORDS variable with four variables, ARCH, USERNAME, KERNEL, and LIBC,
along with sensible defaults to keep the new system manageable.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id16" name="motivation">Motivation</a></h1>
<p>Since the beginning, Gentoo Linux has been conceived as a &quot;metadistribution&quot;
that combines remarkable flexibility with sensible defaults and exceptional
maintainablilty.  The goal of the <a class="reference" href="http://www.gentoo.org/proj/en/gentoo-alt/index.xml">Gentoo-Alt</a> <a class="footnote-reference" href="#id2" id="id3" name="id3">[1]</a> project has been to extend that
flexibility to include systems other than GNU/Linux.  For example, the author
of this GLEP has been working to create a <a class="reference" href="http://www.gentoo.org/proj/en/gentoo-alt/bsd/index.xml">version</a> <a class="footnote-reference" href="#id8" id="id9" name="id9">[3]</a> of Gentoo that uses 
<a class="reference" href="http://www.openbsd.com">OpenBSD</a> <a class="footnote-reference" href="#id5" id="id6" name="id6">[2]</a> as the underlying kernel, userland, and libc.  <a class="reference" href="http://www.openbsd.com">OpenBSD</a> <a class="footnote-reference" href="#id5" id="id7" name="id7">[2]</a> supports
a variety of different architectures, so, in principle, we would need a new
<em>openbsd-arch</em> keyword for each supported architecture.  In fact, the situation 
is even more complicated, because the <a class="reference" href="http://www.gentoo.org/proj/en/gentoo-alt/index.xml">Gentoo-Alt</a> <a class="footnote-reference" href="#id2" id="id4" name="id4">[1]</a> project would eventually
like
to support the option of &quot;mixing-and-matching&quot; GNU/*BSD/whatever userlands
and libcs irrespective of the underlying kernel. (<a class="reference" href="http://www.debian.org">Debian</a> <a class="footnote-reference" href="#id10" id="id11" name="id11">[4]</a>, for example
has a similar BSD <a class="reference" href="http://www.debian.org/ports/netbsd/">project</a> <a class="footnote-reference" href="#id12" id="id13" name="id13">[5]</a>, except that they have replaced the 
BSD userland with a GNU userland.)  The net result is that we would need 
keywords that specified all possible permutations of arch, userland, kernel
and libc.  Not fun.</p>
</div>
<div class="section" id="specification">
<h1><a class="toc-backref" href="#id17" name="specification">Specification</a></h1>
<div class="section" id="new-variables">
<h2><a class="toc-backref" href="#id18" name="new-variables">New Variables</a></h2>
<p>I suggest that we replace the single KEYWORDS variable in ebuilds
with four separate variables: ARCH, USERLAND, LIBC, and KERNEL.</p>
<blockquote>
<dl>
<dt>ARCH: </dt>
<dd>x86, amd64, cobalt, mips64, arm, hppa, ia64, ppc64, sparc</dd>
<dt>USERLAND: </dt>
<dd>gnu, bsd</dd>
<dt>LIBC: </dt>
<dd>glibc, openbsd, freebsd, netbsd, macosx</dd>
<dt>KERNEL: </dt>
<dd>linux, selinux, openbsd, freebsd, netbsd, macosx</dd>
</dl>
</blockquote>
<p>(The above examples are not meant to be complete.  Hurd, for example
is not included because I know very little about Hurd.)
For each variable the standard &quot;-,-*,~&quot; prefixes would be allowed.
Similarly, <cite>/etc/make.conf</cite> would have ACCEPT_ARCH, ACCEPT_USERLAND,
ACCEPT_LIBC, and ACCEPT_KERNEL variables.</p>
</div>
<div class="section" id="reasonable-defaults">
<h2><a class="toc-backref" href="#id19" name="reasonable-defaults">Reasonable Defaults</a></h2>
<p>To keep this system manageable, we need sensible defaults. An ebuild
that has missing USERLAND, KERNEL, or LIBC variables is provided 
with implicit USERLAND=&quot;gnu&quot;, KERNEL=&quot;linux&quot;, and/or LIBC=&quot;glibc&quot;
variables.  However, once a variable is explicitly added (such as 
KERNEL=&quot;openbsd&quot;), the default is no longer assumed.  That is,
one would need KERNEL=&quot;openbsd linux&quot; if the ebuild is stable on
both openbsd and linux kernels.</p>
<p>The ARCH variable, on the other hand, does <em>not</em> have a default, per se.
Instead, if no ARCH variable exists then portage would automatically
add the ebuild's KEYWORD entries to ARCH.  Thus, all current ebuilds
would still work without changes, allowing for a gradual transition
to the new system as the new variables are needed.</p>
</div>
<div class="section" id="profiles">
<h2><a class="toc-backref" href="#id20" name="profiles">Profiles</a></h2>
<p>Along with an explosion of keywords comes a concomitant explosion
of potential profiles.  The good news is that profiles show up only
in a single directory, so an explosion there is easier to contain.
I suggest an arch-kernel-userland-libc-version naming scheme, with
the kernel-userland-libc terms defaulting to linux-gnu-glibc if
absent.  (Yes, Chemists do tend to be fond of systematic naming
systems.)</p>
<p>One drawback to having a large number of profiles is that maintainance
becomes a significant problem.  In fact, one could reasonably argue
that the current number of profiles is already too many to be
easily maintained.  One proposal that has been raised to simplify
matters is the idea of stackable, or cascading, profiles, so that
only differences between profiles would have to be maintained.</p>
</div>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id21" name="rationale">Rationale</a></h1>
<p>The proposed new &quot;keywording&quot; system is far from elegant, which is
a substantial drawback.  On the other hand, it is simple, it requires
relatively minor changes (albeit ones that eventually would impact
every ebuild in the portage tree), and the changes can be implemented
gradually over time.</p>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id22" name="implementation">Implementation</a></h1>
<p>Implementation of this GLEP would divide into adding
Portage functionality to support the new system and 
modifying ebuilds to 
comply with the new system.
The Portage support involves hacking Portage 
to assemble and check a four-state 
arch-userland-kernel-libc variable instead of the simpler
KEYWORD variable.  One might quibble over algorithmic issues, but
the actual concept is pretty straightforward.  Rewriting ebuilds,
on the other hand, is a massive undertaking.  Fortunately, it is
also a process that can be done over whatever length of time is
required, since &quot;legacy&quot; ebuilds should work with no changes.</p>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id23" name="backwards-compatibility">Backwards Compatibility</a></h1>
<p>Backwards compatibility has already been addressed in some detail,
with the stated goal being a system that would leave all current
ebuilds in a still-functioning state after the portage modifications
have been made.  However, we are already using an ARCH variable for
some arcane purpose in Portage, and that issue would still need to
be resolved.</p>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#id24" name="id1">References</a></h1>
<table class="footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a name="id2">[1]</a></td><td><em>(<a class="fn-backref" href="#id3">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> <a class="reference" href="http://www.gentoo.org/proj/en/gentoo-alt/index.xml">http://www.gentoo.org/proj/en/gentoo-alt/index.xml</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a name="id5">[2]</a></td><td><em>(<a class="fn-backref" href="#id6">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> <a class="reference" href="http://www.openbsd.com">http://www.openbsd.com</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9" name="id8">[3]</a></td><td><a class="reference" href="http://www.gentoo.org/proj/en/gentoo-alt/bsd/index.xml">http://www.gentoo.org/proj/en/gentoo-alt/bsd/index.xml</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11" name="id10">[4]</a></td><td><a class="reference" href="http://www.debian.org">http://www.debian.org</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13" name="id12">[5]</a></td><td><a class="reference" href="http://www.debian.org/ports/netbsd/">http://www.debian.org/ports/netbsd/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id25" name="copyright">Copyright</a></h1>
<p>This document is licensed under the Creative Commons - Attribution / Share
Alike license. (<a class="reference" href="http://creativecommons.org/licenses/by-sa/1.0">http://creativecommons.org/licenses/by-sa/1.0</a>)</p>
</div>
</div>

<hr class="footer"/>
<div class="footer">
<a class="reference" href="glep-0022.txt">View document source</a>.
Generated on: 2004-03-07 02:20 UTC.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.
</div>
</body>
</html>

