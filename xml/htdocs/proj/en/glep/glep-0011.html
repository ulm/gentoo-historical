<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/peps/pep-0001.html for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Docutils 0.3.0: http://docutils.sourceforge.net/" />
  <title>GLEP 11 -- Web Application Installation</title>
  <link rel="stylesheet" href="tools/glep.css" type="text/css" />
</head>
<body bgcolor="white">
<table class="navigation" cellpadding="0" cellspacing="0"
       width="100%" border="0">
<tr><td class="navicon" width="150" height="35">
<a href="http://www.gentoo.org/" title="Gentoo Linux Home Page">
<img src="http://www.gentoo.org/images/gentoo-new.gif" alt="[Gentoo]"
 border="0" width="150" height="35" /></a></td>
<td class="textlinks" align="left">
[<b><a href="http://www.gentoo.org/">Gentoo Linux Home</a></b>]
[<b><a href="http://www.gentoo.org/proj/en/glep">GLEP Index</a></b>]
[<b><a href="http://www.gentoo.org/proj/en/glep/glep-0011.txt">GLEP Source</a></b>]
</td></tr></table>
<div class="document">
<table class="rfc2822 field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">GLEP:</th><td class="field-body">11</td>
</tr>
<tr class="field"><th class="field-name">Title:</th><td class="field-body">Web Application Installation</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">1.1</td>
</tr>
<tr class="field"><th class="field-name">Last-Modified:</th><td class="field-body"><a class="reference" href="http://www.gentoo.org/cgi-bin/viewcvs.cgi/xml/htdocs/proj/en/glep/glep-0011.txt?cvsroot=gentoo">2003/08/07 19:02:40</a></td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Troy Dack &lt;tad&#32;&#97;t&#32;gentoo.org&gt;</td>
</tr>
<tr class="field"><th class="field-name">Discussions-To:</th><td class="field-body"><a class="reference" href="mailto:gentoo-dev&#64;gentoo.org?subject=PEP%2011">gentoo-dev&#32;&#97;t&#32;gentoo.org</a></td>
</tr>
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Type:</th><td class="field-body">Standards Track</td>
</tr>
<tr class="field"><th class="field-name">Content-Type:</th><td class="field-body"><a class="reference" href="glep-0002.html">text/x-rst</a></td>
</tr>
<tr class="field"><th class="field-name">Created:</th><td class="field-body">02 August 2003</td>
</tr>
<tr class="field"><th class="field-name">Post-History:</th><td class="field-body">07 Aug 2003</td>
</tr>
</tbody>
</table>
<hr />
<div class="contents topic" id="contents">
<p class="topic-title"><a name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#credits" id="id5" name="id5">Credits</a></li>
<li><a class="reference" href="#definitions" id="id6" name="id6">Definitions</a></li>
<li><a class="reference" href="#conventions" id="id7" name="id7">Conventions</a></li>
<li><a class="reference" href="#abstract" id="id8" name="id8">Abstract</a></li>
<li><a class="reference" href="#motivation" id="id9" name="id9">Motivation</a></li>
<li><a class="reference" href="#rationale" id="id10" name="id10">Rationale</a></li>
<li><a class="reference" href="#implementation" id="id11" name="id11">Implementation</a><ul>
<li><a class="reference" href="#web-server" id="id12" name="id12">1. Web Server</a><ul>
<li><a class="reference" href="#default-document-root" id="id13" name="id13">1.1 Default Document Root</a></li>
<li><a class="reference" href="#apache-2" id="id14" name="id14">1.2 Apache 2</a></li>
</ul>
</li>
<li><a class="reference" href="#virtual-host-flexibility" id="id15" name="id15">2. Virtual Host Flexibility</a><ul>
<li><a class="reference" href="#new-vhost-use-flag" id="id16" name="id16">2.1 New &quot;vhost&quot; USE Flag</a></li>
<li><a class="reference" href="#vhost-configuration-tool" id="id17" name="id17">2.2 VHost Configuration Tool</a></li>
</ul>
</li>
<li><a class="reference" href="#application-installation-location" id="id18" name="id18">3. Application Installation Location</a><ul>
<li><a class="reference" href="#single-host-installation" id="id19" name="id19">3.1 Single Host Installation</a></li>
<li><a class="reference" href="#virtual-host-installation" id="id20" name="id20">3.2 Virtual Host Installation</a></li>
</ul>
</li>
<li><a class="reference" href="#application-configuration" id="id21" name="id21">4. Application Configuration</a><ul>
<li><a class="reference" href="#virtual-host-support" id="id22" name="id22">4.1 Virtual Host Support</a></li>
</ul>
</li>
<li><a class="reference" href="#application-permissions" id="id23" name="id23">5. Application Permissions</a></li>
</ul>
</li>
<li><a class="reference" href="#backwards-compatibility" id="id24" name="id24">Backwards Compatibility</a></li>
<li><a class="reference" href="#references" id="id25" name="id25">References</a></li>
<li><a class="reference" href="#copyright" id="id26" name="id26">Copyright</a></li>
</ul>
</div>
<div class="section" id="credits">
<h1><a class="toc-backref" href="#id5" name="credits">Credits</a></h1>
<p>Based on comments posted to gentoo-dev mailing list <a class="footnote-reference" href="#webapppost1" id="id1" name="id1">[1]</a>
<a class="footnote-reference" href="#webapppost2" id="id2" name="id2">[2]</a> <a class="footnote-reference" href="#webapppost3" id="id3" name="id3">[3]</a> by:</p>
<blockquote>
Stuart Herbert &lt;<a class="reference" href="mailto:stuart&#64;gentoo.org">stuart&#64;gentoo.org</a>&gt;, Max Kalika &lt;<a class="reference" href="mailto:max&#64;gentoo.org">max&#64;gentoo.org</a>&gt;,
Robin H.Johnson &lt;<a class="reference" href="mailto:robbat2&#64;gentoo.org">robbat2&#64;gentoo.org</a>&gt; and others</blockquote>
</div>
<div class="section" id="definitions">
<h1><a class="toc-backref" href="#id6" name="definitions">Definitions</a></h1>
<blockquote>
<dl>
<dt><em>Web Application</em></dt>
<dd>an application that requires a web server to function and interacts with
the user via a browser</dd>
<dt><em>Web Application Instance</em></dt>
<dd>An apparent install of the Web Application that is served up via the
webserver. There may be any number of instances per Web Application.
This is a major use for web applications. Our Gentoo Zope setup
already provides instances and can be used for some concepts on this
matter.</dd>
<dt><em>Web Application Setup Program</em></dt>
<dd>A script similar in function to zope-config that sets up instances.</dd>
<dt><em>Document Root</em></dt>
<dd>a location in the file system that forms the main document tree visible from
the web</dd>
</dl>
</blockquote>
</div>
<div class="section" id="conventions">
<h1><a class="toc-backref" href="#id7" name="conventions">Conventions</a></h1>
<blockquote>
<p>When describing the location of a directory in the file system it
wil be shown <em>with</em> a trailing slash, eg:</p>
<pre class="literal-block">
/foo/bar/
</pre>
<p>When describing the location of a specific file (irrespective of any
file extention) it will shown <em>with out</em> a trailing slash, eg:</p>
<pre class="literal-block">
/foo/blah
</pre>
</blockquote>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id8" name="abstract">Abstract</a></h1>
<p>To define where and how web based applications should be installed by Gentoo.</p>
</div>
<div class="section" id="motivation">
<h1><a class="toc-backref" href="#id9" name="motivation">Motivation</a></h1>
<p>Currently there is no standard defined regarding the installation of web
based applicaitons in Gentoo.  This leads to ebuild authors creating a
variety of methods to determine:</p>
<blockquote>
<ul class="simple">
<li>where the application should be installed</li>
<li>what user and permissions the application should be given</li>
<li>where any configuration files related to the application should be
installed.</li>
</ul>
</blockquote>
<p>Due to a lack of standard install method configuration files are at
risk of being overwritten during upgrade, potentially causing system
administrators down tine as they have to reconfigure web applications
after an upgrade.</p>
</div>
<div class="section" id="rationale">
<h1><a class="toc-backref" href="#id10" name="rationale">Rationale</a></h1>
<p>A discussion on the gentoo-dev mailing list <a class="footnote-reference" href="#webapppost1" id="id4" name="id4">[1]</a> raised the
following points regarding how Gentoo handles the installation of web based
applications:</p>
<blockquote>
<ol class="arabic">
<li><p class="first">Gentoo installed web applications (eg: horde, phpbb, cacti,
phpmysql) should not be installed in the Document Root of a web server.</p>
</li>
<li><p class="first">Web applications should not have their configuration files installed
under the Document Root of a web server.</p>
<blockquote>
<ol class="lowerroman simple">
<li>Web Application must be slotted by their major version numbers to
further avoid downtime when true configuration changes are required.</li>
</ol>
</blockquote>
</li>
<li><p class="first">Web applications should not be owned by the same user as the web server.</p>
</li>
<li><p class="first">It should be easily possible to have multiple instances of a web
application without any duplication of source files.</p>
</li>
<li><p class="first">It should be immediately apparent how to control instances of a web
application.</p>
</li>
</ol>
</blockquote>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#id11" name="implementation">Implementation</a></h1>
<p>Max Kalika &lt;<a class="reference" href="mailto:max&#64;gentoo.org">max&#64;gentoo.org</a>&gt; stated that he has a preliminary eclass that
implements a good deal of this GLEP.</p>
<p>Stuart Herbert &lt;<a class="reference" href="mailto:stuart&#64;gentoo.org">stuart&#64;gentoo.org</a>&gt; has committed:</p>
<pre class="literal-block">
webapp-apache.eclass
</pre>
<p>to CVS, this is a stop-gap measure whilst this GLEP is being finalised.</p>
<div class="section" id="web-server">
<h2><a class="toc-backref" href="#id12" name="web-server">1. Web Server</a></h2>
<p>A common default web server will have to be selected and ebuild authors should
ensure that their applications contain configuration directives suitable for
that server.  Given the popularity of the Apache web server it is suggested
that Apache be selected as the Gentoo default web server.</p>
<p>Whilst it is acknowledged that other web servers do exist and are used, there
has to be an assumption made somewhere that people who choose to use something
other than the default have enough knowledge to adapt configurations
accordingly.</p>
<div class="section" id="default-document-root">
<h3><a class="toc-backref" href="#id13" name="default-document-root">1.1 Default Document Root</a></h3>
<p>To ensure the greatest flexibility when installing applications the following
<em>Document Root</em> locations are to be used:</p>
<blockquote>
<ul>
<li><p class="first">For single host installations:</p>
<pre class="literal-block">
/var/www/localhost/htdocs/
</pre>
</li>
<li><p class="first">For multiple virtual host installastions:</p>
<pre class="literal-block">
/var/www/&lt;fully qualified domain name&gt;/htdocs/
eg:
        /var/www/www.gentoo.org/htdocs/
</pre>
</li>
</ul>
</blockquote>
</div>
<div class="section" id="apache-2">
<h3><a class="toc-backref" href="#id14" name="apache-2">1.2 Apache 2</a></h3>
<p>All web application .ebuild will honour any USE flags that are intended to
add support for Apache 2 as well as supporting Apache 1 installations.</p>
</div>
</div>
<div class="section" id="virtual-host-flexibility">
<h2><a class="toc-backref" href="#id15" name="virtual-host-flexibility">2. Virtual Host Flexibility</a></h2>
<p>In a similar vein to Gentoo's Zope scripts, namely zope-config, we
should be able to have multiple instances of a single web application
without duplicating all of the files.</p>
<p>This also allows system administrators to control where web applications
will appear on their system, as well as to customize a file in a single
instance of a web application without effecting the original material.</p>
<p>This is easily acheived thru use of Apache configuration directivies and
symlinks. For PHP instances, see <a class="reference" href="http://tavi.sourceforge.net/VirtualHosts">http://tavi.sourceforge.net/VirtualHosts</a>
for some details.</p>
<p>The primary idea here is that to the web-application, it appears that
all of it's configuration and files are in the instance directory, but
the files are physicalled located elsewhere.</p>
<div class="section" id="new-vhost-use-flag">
<h3><a class="toc-backref" href="#id16" name="new-vhost-use-flag">2.1 New &quot;vhost&quot; USE Flag</a></h3>
<p>To enable support for multiple virtual host installations a new USE flag is
to be added to Portage. The use flag will be:</p>
<pre class="literal-block">
vhost
</pre>
<p>When <em>vhost</em> is _set_ the installation location and configuration for the web
application will be effected, see below for more details.</p>
</div>
<div class="section" id="vhost-configuration-tool">
<h3><a class="toc-backref" href="#id17" name="vhost-configuration-tool">2.2 VHost Configuration Tool</a></h3>
<p>To assist administration of multiple virtual hosts a &quot;VHost Configuration Tool&quot;
needs to be developed and implemented.  Initial discussion and regarding the VHost
Config tool can be found at <a class="reference" href="http://article.gmane.org/gmane.linux.gentoo.devel/10874">http://article.gmane.org/gmane.linux.gentoo.devel/10874</a>.</p>
<p>The VHost Configuration Utility will need to be a seperate package, maintained by Gentoo.
Apache .ebuilds will require the VHost Config tool as a dependency (DEPEND).</p>
<p>&lt;&lt; TO BE EXPANDED UPON &gt;&gt;</p>
</div>
</div>
<div class="section" id="application-installation-location">
<h2><a class="toc-backref" href="#id18" name="application-installation-location">3. Application Installation Location</a></h2>
<p>The current accepted standard Document Root in Gentoo is /home/httpd.  The
discussion suggest that this is not the best location to install web based
applications.</p>
<p>Web applications should be installed outside of the Document Root using the following
defaults:</p>
<blockquote>
<ul>
<li><p class="first">for files to be served to clients:</p>
<pre class="literal-block">
/usr/share/webapps/${PF}/

/usr/share/webapps/${PF}/public_html/ for files served by the web server

/usr/share/webapps/${PF}/cgi-bin/ for CGI-BIN files
</pre>
</li>
<li><p class="first">install configuration files in:</p>
<pre class="literal-block">
/etc/webapps/${PF}/
</pre>
</li>
<li><p class="first">for documentation files (not served to clients):</p>
<pre class="literal-block">
/usr/share/doc/${PF}/
</pre>
</li>
</ul>
</blockquote>
<div class="section" id="single-host-installation">
<h3><a class="toc-backref" href="#id19" name="single-host-installation">3.1 Single Host Installation</a></h3>
<p>For single host installations the .ebuild will make the required
configurations changes and symlinks using the VHost Config tool to ensure
that the web application is available to be served from:</p>
<pre class="literal-block">
/var/www/localhost/htdocs/${PN}
</pre>
</div>
<div class="section" id="virtual-host-installation">
<h3><a class="toc-backref" href="#id20" name="virtual-host-installation">3.2 Virtual Host Installation</a></h3>
<p>For installations that support multiple virtual hosts the .ebuild will
install the web application into the default location and then leave configuration
to the user through the VHost Config tool.</p>
<p>&lt;&lt; TO BE EXPANDED UPON &gt;&gt;</p>
</div>
</div>
<div class="section" id="application-configuration">
<h2><a class="toc-backref" href="#id21" name="application-configuration">4. Application Configuration</a></h2>
<p>Having application configuration files in the Document Root of a web
server is a potential security risk.  Additionally given the way that many
ebuilds currently install web applications it can also lead to the
overwriting of important configuration files.</p>
<p>As stated above web application configuration files are to be installed into:</p>
<pre class="literal-block">
/etc/webapps/${PF}/
</pre>
<p>By installing application configuration files in /etc Portage CONFIG_PROTECT
features can be used to ensure that configuration files are not overwritten.</p>
<div class="section" id="virtual-host-support">
<h3><a class="toc-backref" href="#id22" name="virtual-host-support">4.1 Virtual Host Support</a></h3>
<p>&lt;&lt; TO BE EXPANDED UPON &gt;&gt;</p>
</div>
</div>
<div class="section" id="application-permissions">
<h2><a class="toc-backref" href="#id23" name="application-permissions">5. Application Permissions</a></h2>
<p>Installing web applications and giving the web server ownership of the files
is a security risk.  This can possibly lead to application configuration
files being accessed by unwanted third parties.</p>
<p>All web applications should be owned by <em>root</em> unless the application
absolutely requires write access to its installation directories at execution
time.</p>
</div>
</div>
<div class="section" id="backwards-compatibility">
<h1><a class="toc-backref" href="#id24" name="backwards-compatibility">Backwards Compatibility</a></h1>
<p>There may be some issues regarding compatibility with existing installs of
web applications.  This is particularly true if the default Document Root is
moved from what is accepted as the current standard (/home/httpd).</p>
<dl>
<dt>The main issues are:</dt>
<dd><ul class="first last simple">
<li>transition of existing configuration files to the
/etc/webapps/${PF}/ directory.</li>
<li>modification/reconfiguration of applications so that they
are aware of the location of configuration files.</li>
<li>creating approriate Apache configuration snippets for inclusion
in the Apache configuration files.</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id25" name="references">References</a></h1>
<table class="footnote" frame="void" id="webapppost1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a name="webapppost1">[1]</a></td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> <a class="reference" href="http://article.gmane.org/gmane.linux.gentoo.devel/10411">http://article.gmane.org/gmane.linux.gentoo.devel/10411</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="webapppost2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2" name="webapppost2">[2]</a></td><td><a class="reference" href="http://news.gmane.org/onethread.php?group=gmane.linux.gentoo.devel&amp;root=%3C1059843010.5023.80.camel%40carbon.internal.lan%3E">http://news.gmane.org/onethread.php?group=gmane.linux.gentoo.devel&amp;root=%3C1059843010.5023.80.camel%40carbon.internal.lan%3E</a></td></tr>
</tbody>
</table>
<table class="footnote" frame="void" id="webapppost3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3" name="webapppost3">[3]</a></td><td><a class="reference" href="http://news.gmane.org/onethread.php?group=gmane.linux.gentoo.devel&amp;root=%3C86960000.1060038977%40valkyrie.lsit.ucsb.edu%3E">http://news.gmane.org/onethread.php?group=gmane.linux.gentoo.devel&amp;root=%3C86960000.1060038977%40valkyrie.lsit.ucsb.edu%3E</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="copyright">
<h1><a class="toc-backref" href="#id26" name="copyright">Copyright</a></h1>
<p>This document has been placed in the public domain.</p>
</div>
</div>

<hr class="footer"/>
<div class="footer">
<a class="reference" href="glep-0011.txt">View document source</a>.
Generated on: 2003-08-07 19:02 UTC.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.
</div>
</body>
</html>

