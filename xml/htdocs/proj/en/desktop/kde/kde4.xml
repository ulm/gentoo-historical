<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/desktop/kde/Attic/kde4.xml,v 1.17 2008/02/18 21:24:20 ingmar Exp $ -->

<guide link="/proj/en/desktop/kde/kde4.xml">
<title>Gentoo KDE 4.0 Guide</title>

<author title="Author">
  <mail link="ingmar"/>
</author>
<author title="Author">
  <mail link="mark_alec"/>
</author>
<author title="Editor">
  <mail link="keytoaster"/>
</author>

<abstract>
This guide provides the information needed to upgrade to and use KDE 4.0.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.8</version>
<date>2008-02-18</date>

<chapter>
<title>Installation</title>
<section>
<title>Removing any pre-release ebuilds</title>
<body>

<p>
If you used <uri link="http://genkdesvn.mailstation.de">the genkdesvn
overlay</uri>, it's advisable that you remove the KDE pre-releases from your
system before upgrading.  For most users this should be as easy as running
<c>layman -d kde</c>. Also, if you modified any of the KDE related files in
<path>/etc/env.d/</path> you'll have to manually remove those. This can include
previous modifications for beryl or compiz.
</p>

</body>
</section>
<section>
<title>Enabling the necessary USE flags</title>
<body>

<p>
KDE 4.0 requires <c>x11-libs/qt:4</c> built with a set of minimal USE flags.
Add the following line to your <path>/etc/portage/package.use</path>.
</p>

<pre caption="Setting the necessary USE flags for x11-libs/qt:4">
x11-libs/qt:4 accessibility dbus gif jpeg png qt3support ssl zlib
</pre>

<p>
If you have the <c>opengl</c> USE flag set for KDE ebuilds, you'll have to set
the <c>opengl</c> USE flag for <c>x11-libs/qt:4</c> too.
</p>

<note>
KDE 4.0.0 hasn't been tested with the Qt-4.4.0 technical preview, and at the
moment of writing the KDE 4.0.0 ebuilds do <e>not</e> work with this version
of Qt.
</note>

</body>
</section>
<section>
<title>Unmasking and keywording</title>
<body>

<p>
KDE 4.0.0 is currently hard-masked, so you will have to unmask it first before
you can emerge it. Users with <c>ACCEPT_KEYWORDS="~x86"</c> or
<c>ACCEPT_KEYWORDS="~amd64"</c> do not need to perform any further steps. Any
other users will need to place the packages in package.keywords.<br/>
<path>/etc/portage/package.unmask/</path> and
<path>/etc/portage/package.keywords/</path> can be directories, so you can save
the following example files in those directories, to unmask and keyword KDE
4.0.0.
</p>

<ul>
  <li>
    <uri
link="https://www2.mailstation.de/gitweb/?p=genkde4svn-pub.git;a=blob_plain;f=Documentation/package.unmask-4.0.0-split;hb=HEAD">Example
    package.unmask</uri>
  </li>
  <li>
    <uri
link="https://www2.mailstation.de/gitweb/?p=genkde4svn-pub.git;a=blob_plain;f=Documentation/package.keywords.4.0.0-split;hb=HEAD">Example
    package.keywords</uri>
  </li>
</ul>

</body>
</section>

<section>
<title>Installing</title>
<body>

<p>
You can now run either of the following emerge commands, to install KDE.
The first will give you all of KDE 4.0.0, built from split ebuilds. The second
will give you a minimal KDE 4.0.0 desktop, as a basis to add only the programs
you like.
</p>

<pre caption="Installing KDE 4.0.0">
# <i>emerge -avD kde-base/kde-meta:kde-4</i>
# <i>emerge -avD kde-base/kdebase-startkde:kde-4</i>
</pre>

<!--
<p>
To read more about the difference between split and monolithic ebuilds, see
<uri link="http://www.gentoo.org/doc/en/kde-split-ebuilds.xml">The KDE
Split Ebuilds HOWTO</uri>.
</p>
-->

</body>
</section>
</chapter>

<chapter>
<title>Changes from KDE 3.5</title>
<section>
<body>

<p>
KDE 4 represents a dramatic change in the desktop architecture to KDE 3. One
such change is the migration from autotools to cmake. This means that you will
now have a percentage progress during the compilation of KDE.
</p>

</body>
</section>
<section>
<title>The startkde script</title>
<body>

<p>
It is not recommended to let KDE 3.5 and KDE 4.0 share the same configuration
files. In order to prevent this, the startkde scripts rewrite the
<path>~/.kde</path> symlink while KDE starts. This means that when you're in a
KDE 4.0 session your configuration from KDE 3.5 will be unavailable and vice
versa.
</p>

</body>
</section>
<section>
<body>

<p>
This is why you should not run two different KDE versions as the same user,
at the same time. (Logging in to KDE 4.0, while KDE 3.5 is still running in the
background, under the same user.)
</p>

</body>
</section>
<section>
<title>Selecting the login manager</title>
<body>

<p>
By default the highest version of kde-base/kdm you have installed will start on
login. To configure this, open <path>/etc/conf.d/xdm</path> in your favorite
text editor and change the <c>DISPLAYMANAGER</c> variable to <c>kdm-3.5</c> or
<c>kdm-4.0</c>. You can find possible versions for kdm by running <c>ls
/usr/kde/</c> in a shell.
</p>

<pre caption="Add the following to /etc/conf.d/xdm">
<ident>DISPLAYMANAGER</ident>=<const>kdm-3.5</const>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>FAQ</title>
<section>
<title>Q: Can I install KDE 4.0 and KDE 3.5 at the same time?</title>
<body>

<p>
A: Yes, both versions are slotted, and can be installed at the same time.  Both
versions of KDE use a different <c>KDEHOME</c>, so you can try KDE 4.0 as the
same user, without overwriting your KDE 3.5 settings.
</p>

</body>
</section>
<section>
<title>
Q: You said I could install KDE 3.5 and KDE 4.0, but they block each other!
</title>
<body>

<p>
A: You will need to install the latest revision (not version) of
<c>kde-base/kdebase-startkde</c>, which includes patches to allow multiple
versions of KDE to coexist.
</p>

</body>
</section>
<section>
<title>Q: Why is KDE 4.0.0 hard-masked?</title>
<body>

<p>
A: KDE 4.0.0 is very much a technology release. It was not intended to be a
complete replacement for the KDE 3 series, yet. Many features are missing and
many bugs will be found. When KDE 4.x is at the stage that it offers a true
upgrade path for users, it will leave the hard-masked status.
</p>

</body>
</section>
<section>
<title>Q: Why is KDE 4.0.0 masked by EAPI?</title>
<body>

<p>
The KDE 4.0.0 ebuilds use slot dependencies, such as
<c>kde-base/kdebase-startkde:kde-4</c>, in the dependency syntax. You need a
version of <c>sys-apps/portage</c> that understands this. If you get this error
message, you should simply update it to a sufficiently new version.
</p>

<pre caption="Updating to a version of portage that supports EAPI=1">
# <i>emerge --oneshot &gt;=sys-apps/portage-2.1.3.12</i>
</pre>
</body>
</section>

<section>
<title>Q: Where are the monolithic KDE 4 ebuilds?</title>
<body>

<p>
We find that having both split and monolithic ebuilds often causes needless
confusion for users, needless complexity in the eclasses, and a lot of pointless
duplication of effort, both for arch teams and ourselves.
As KDE uses cmake now, the main disadvantage of using split ebuilds (longer
compile-time because of the duplicate ./configure-runs) is insignificant.

For the reasons stated above, we have decided to maintain split ebuilds only.

To switch from monolithic to split ebuilds unmerge all monolithic KDE 4 ebuilds:
</p>

<pre caption="Uninstalling monolithic KDE 4">
# <i>emerge -C ~kde-base/kde{,accessibility,admin,artwork,base,edu,games,graphics,multimedia,network,sdk,toys,utils,webdev}-4.0.0</i>
</pre>

<p>
Then continue with installing split KDE ebuilds as explained earlier on this page.
</p>

</body>
</section>
<section>
<title>Q: Where is KDE-PIM in KDE 4?</title>
<body>

<p>
KDE-PIM wasn't released with KDE 4.0.0, so unfortunately you won't find it in
the tree for a while. You can of course use the 3.5 versions of kmail, akregator
and their friends, together with KDE 4.0.0.
</p>

</body>
</section>
<section>
<title>
Q: I tried KDE4 and realized I don't want it anymore. What should I do to get
rid of it?
</title>
<body>

<p>
A: Remove KDE 4 from your <path>package.keywords</path> and
<path>package.unmask</path>, then uninstall the packages you installed.
Remember to update your <c>DISPLAYMANAGER</c> if you changed it to
<c>kdm-4.0</c> earlier.
</p>

</body>
</section>
<section>
<title>Q: Does this mean KDE 3.5 will be gone soon?</title>
<body>

<p>
A: Not at all! KDE 3.5 is very stable, and still gets minor bugfixes from
upstream. While KDE 3.5 won't see new features anymore, we do plan on
maintaining it for a long time.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Suggestions for this guide</title>
<section>
<body>

<p>
If you have any ideas on how to improve this guide, please mail your suggestions
to <mail>kde@gentoo.org</mail>.
</p>

</body>
</section>
</chapter>
</guide>
