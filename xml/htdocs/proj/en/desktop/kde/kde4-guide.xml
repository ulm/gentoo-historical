<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/desktop/kde/kde4-guide.xml,v 1.105 2012/08/30 12:23:29 dilfridge Exp $ -->

<guide>
<title>Gentoo KDE Guide</title>

<author title="Author">
  <mail link="tampakrap"/>
</author>
<author title="Author">
  <mail link="dilfridge"/>
</author>
<author title="Author">
  <mail link="scarabeus"/>
</author>
<author title="Author">
  <mail link="jmbsvicetto"/>
</author>
<author title="Author">
  <mail link="johu"/>
</author>
<author title="Author">
  <mail link="cryos"/>
</author>
<author title="Editor">
  <mail link="keytoaster"/>
</author>
<author title="Editor">
  <mail link="nightmorph"/>
</author>

<abstract>
This guide demonstrates how to setup KDE SC using the ebuilds in the tree. Some
tools from the KDE team's git overlay (kde) may be used.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>3.22</version>
<date>2012-08-26</date>

<chapter>
<title>KDE SC 4</title>
<section>
<title>Introduction</title>
<body>

<note>
This guide is being migrated step by step to the Gentoo wiki. Visit the 
<uri link="http://wiki.gentoo.org/wiki/KDE">wiki page</uri> for more
information.  
</note>

<p>
KDE SC 4 is the current KDE version supported by upstream. In Portage there is a
stable version, and there might be one (or more) non-stable versions. Under
normal conditions new versions get in stabilized after a month.
In addition, KDE upstream provides <uri link="http://quickgit.kde.org">live git
source repositories</uri>. The Gentoo KDE team provides trunk and latest branch
live ebuilds through the <c>kde</c> overlay.
</p>

<p>
Choose what KDE SC version is most appropriate for you:
</p>

<table>
  <tr>
    <th>KDE SC Version</th>
    <th>Repository</th>
  </tr>
  <tr>
    <ti><uri link="#kde4_7">KDE SC 4.7.4</uri></ti>
    <ti>Portage</ti>
  </tr>
  <tr>
    <ti><uri link="#kde4_8">KDE SC 4.8.3</uri></ti>
    <ti>Portage</ti>
  </tr>
  <tr>
    <ti><uri link="#kde4_8">KDE SC 4.8.5</uri></ti>
    <ti>Portage</ti>
  </tr>
  <tr>
    <ti><uri link="#kde4_9">KDE SC 4.9.0</uri></ti>
    <ti>Portage</ti>
  </tr>
  <tr>
    <ti><uri link="#snapshots">KDE SC 4.9 Snapshots</uri></ti>
    <ti>KDE Overlay</ti>
  </tr> 
  <tr>
    <ti><uri link="#live">Live Ebuilds (4.9 Branch, Trunk)</uri></ti>
    <ti>KDE Overlay</ti>
  </tr>
</table>

</body>
</section>
</chapter>
<chapter id="prerequisites">
<title>Prerequisites</title>
<section>
<title>Desktop profile and subprofiles</title>
<body>

<p>
Desktop profile has been split to KDE and GNOME subprofiles.
This means that KDE and GNOME specific USE flags have been stripped
from the basic desktop profile and have been migrated to the subprofiles.
Choosing a subprofile doesn't restrict you to use only the equivalent
DE. In order to choose the profile that suits you, run <c>eselect profile list</c>
to get the profiles' list, and <c>eselect profile set X</c>, where X is the
appropriate number.
</p>

</body>
</section>

<section>
<title>Use flags</title>
<body>
<p>
Before you install KDE SC it is recommended that you set several useflags. 
Part of that is done automatically if you use a desktop/kde or desktop profile. 
In detail you should use:
</p>
<table>
  <tr>
    <th>flag</th>
    <th>explanation</th>
  </tr>
  <tr>
    <ti>consolekit</ti>
    <ti>Enables the consolekit framework for defining and tracking users, login sessions and seats</ti>
  </tr>
  <tr>
    <ti>dbus</ti>
    <ti>Enables use of the dbus message bus system</ti>
  </tr>
  <tr>
    <ti>policykit</ti>
    <ti>Enables the <b>polkit</b> framework for controlling privileges for system-wide services</ti>
  </tr>
  <tr>
    <ti>udev</ti>
    <ti>Enables support for udev Linux dynamic and persistent device naming</ti>
  </tr>
</table>
<p>
Note that other combinations may technically be possible, but may be unsupported, 
untested, or lead to unexpected loss of functionality.
</p>
<p>
If you changed any global useflags, you should later include the -N flag when running the actual emerge command 
which updates your system, e.g. 
</p>
<pre caption="Updating world after a useflag change">
# <i>emerge -uDNav world</i>
</pre>
</body>
</section>

<section>
<title>Kernel settings</title>
<body>
<p>
If you are rolling your own kernel, you'll want to install a new one with the following options:
</p>
<pre caption="Recommended kernel settings">
CONFIG_USB_SUSPEND=y
CONFIG_IDE=n
CONFIG_AUDITSYSCALL=y
</pre>
</body>
</section>

</chapter>
<chapter id="kde_portage">
<title>Installing KDE SC from Portage</title>
<section id="kde4_7">
<title>KDE SC 4.7</title>
<body>

<p>
KDE SC 4.7.4 is the current stable release for amd64, ppc and x86.
</p>

<pre caption="Installation of KDE SC 4.7 using meta packages">
# <i>emerge -av kde-meta</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av kdebase-meta kdegames-meta</i> <comment>(installation of chosen modules only)</comment>
</pre>

<warn>
If you running KDEPIM and upgrade from 4.4 to 4.7,
please have a look at the <uri link="http://wiki.gentoo.org/wiki/KDEPIM-4.7_upgrade">Gentoo Wiki KDEPIM 4.7
Upgrade Guide</uri> first! If you want to stick with KDEPIM 4.4 you can
<uri link="kdepim-4.7-mask.txt">mask KDEPIM 4.7</uri>
</warn>

</body>
</section>
<section id="kde4_8">
<title>KDE SC 4.8</title>
<body>

<p>
KDE SC 4.8.3 is under stabilization and already stable for amd64 and x86. KDE SC 4.8.5 is in portage, currently as ~testing, but stabilization is planned for the near future.
</p>

<p>
Users with stable systems need to put <uri 
link="http://git.overlays.gentoo.org/gitweb/?p=proj/kde.git;a=blob_plain;f=Documentation/package.keywords/kde-4.8.keywords">
this keywords file</uri> in <path>/etc/portage/package.keywords</path>.
</p>

<pre caption="Installation of KDE SC 4.8 using meta packages">
# <i>emerge -av kde-meta</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av kdebase-meta kdegames-meta</i> <comment>(installation of chosen modules only)</comment>
</pre>

<warn>
If you running KDEPIM and upgrade from 4.4 to 4.8, 
please have a look at the <uri link="http://wiki.gentoo.org/wiki/KDEPIM-4.7_upgrade">Gentoo Wiki KDEPIM 4.7
Upgrade Guide</uri> first! If you want to stick with KDEPIM 4.4 you can
<uri link="kdepim-4.7-mask.txt">mask KDEPIM 4.8</uri> (Guide is still valid for 4.8).
</warn>

</body>
</section>
<section id="kde4_9">
<title>KDE SC 4.9</title>
<body>

<p>
KDE SC 4.9.0 is in portage, currently as ~testing, stabilization isn't planned yet.
</p>

<p>
Users with stable systems need to put <uri 
link="http://git.overlays.gentoo.org/gitweb/?p=proj/kde.git;a=blob_plain;f=Documentation/package.keywords/kde-4.9.keywords">
this keywords file</uri> in <path>/etc/portage/package.keywords</path>.
</p>

<pre caption="Installation of KDE SC 4.9 using meta packages">
# <i>emerge -av kde-meta</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av kdebase-meta kdegames-meta</i> <comment>(installation of chosen modules only)</comment>
</pre>

<warn>
If you running KDEPIM and upgrade from 4.4 to 4.9, 
please have a look at the <uri link="http://wiki.gentoo.org/wiki/KDEPIM-4.7_upgrade">Gentoo Wiki KDEPIM 4.7
Upgrade Guide</uri> first! If you want to stick with KDEPIM 4.4 you can
<uri link="kdepim-4.7-mask.txt">mask KDEPIM 4.9</uri> (Guide is still valid for 4.9).
</warn>

</body>
</section>
</chapter>
<chapter id="kde_overlay">
<title>Installing KDE SC from Overlay</title>
<section id="kde_overlay_prerequisites">
<title>Prerequisites</title>
<body>
<p>
Installing snapshots and live ebuilds are only available through <c>kde</c> overlay, so first
thing is to install it:
</p>

<pre caption="Installing kde overlay">
# <i>layman -f -a kde</i>
<comment>For more information regarding overlays, please read the <uri
link="http://www.gentoo.org/proj/en/overlays/userguide.xml">Overlay Guide</uri></comment>
</pre>

<impo>
The <c>kde overlay</c> uses the thin manifest layout. For this
<c>sys-apps/portage-2.1.10.18</c> or greater is required. Otherwise you will
get missing manifest errors.
</impo> 

</body>
</section>

<section id="snapshots">
<title>Installing KDE SC snapshots</title>
<body>

<p>
During testing phases KDE upstream provides <uri link="ftp://ftp.kde.org/pub/kde/unstable">
snapshots</uri> taken from the git source repositories. Beta and Release Candidate KDE
releases are following the snapshot model below:
</p>

<table>
  <tr>
    <th>KDE SC Version</th>
    <th>Release Name</th>
  </tr>
  <tr>
    <ti>4.x.80</ti>
    <ti>Beta 1</ti>
  </tr>
  <tr>
    <ti>4.x.90</ti>
    <ti>Beta 2</ti>
  </tr>
  <tr>
    <ti>4.x.95</ti>
    <ti>Release Candidate 1</ti>
  </tr>
  <tr>
    <ti>4.x.97</ti>
    <ti>Release Candidate 2</ti>
  </tr>
</table>

<note>
Currently there are no snapshots available.
</note>

<!-- Enable this if first KDE SC 4.10 Snapshot is in overlay available -->
<!--
<p>
Users with stable systems have to keyword the packages to proceed. We provide a
package.keyword file in <c>kde</c> overlay. Due to masked depedencies, KDE SC
4.9.80 should also be masked. We should symlink the files:
</p>

<pre caption="Creating symlink of the keywords file">
# <i>ln -s /path/to/overlay/kde/Documentation/package.keywords/kde-4.10.keywords /etc/portage/package.keywords/</i>
# <i>ln -s /path/to/overlay/kde/Documentation/package.unmask/kde-4.10 /etc/portage/package.unmask/</i>
</pre>

<p>
The installation can be done either by using the meta packages or by using
sets.
</p>

<pre caption="Installation using meta packages">
# <i>emerge -av kde-meta</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av kdebase-meta kdegames-meta</i> <comment>(installation of chosen modules only)</comment>
</pre>

<pre caption="Installation using sets">
<comment>(For KDE SC 4.10 Snapshots)</comment>
# <i>emerge -av @kde-4.10</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av @kdebase-4.10 @kdegames-4.10</i> <comment>(installation of chosen modules only)</comment>
</pre>
-->

</body>
</section>
<section id="live">
<title>Installing KDE SC live ebuilds</title>
<body>

<p>
KDE SC is Open Source, with its code being available for browsing through <uri
link="http://quickgit.kde.org">KDE QuickGit</uri>, and for public checkout. 
Gentoo, as a source based distro, has the ability to provide live ebuilds that 
checkout the code either from the latest branch or from trunk. Currently, we 
provide 4.9.49.9999 ebuilds from 4.9 branch and 9999 ebuilds from trunk.
</p>

<table>
  <tr>
    <th>Ebuilds Version</th>
    <th>KDE SC Version</th>
  </tr>
  <tr>
    <ti>4.9.49.9999</ti>
    <ti>KDE 4.9 Branch</ti>
  </tr>
  <tr>
    <ti>9999</ti>
    <ti>KDE 4 Trunk</ti>
  </tr>
</table>

<p>
Users with stable systems have to keyword the packages to proceed.  We provide a
package.keyword file in <c>kde</c> overlay, which we'll have to symlink
to our package.keywords directory:
</p>

<pre caption="Creating symlink of the keywords file">
# <i>cd /etc/portage/package.keywords</i>
# <i>ln -s /path/to/overlay/kde/Documentation/package.keywords/kde-4.9.49.9999.keywords .</i><comment>(for 4.9 Branch)</comment>
# <i>ln -s /path/to/overlay/kde/Documentation/package.keywords/kde-live.keywords .</i><comment>(for KDE Trunk)</comment>
</pre>

<p>
The installation can be done either by using the meta packages or by using
sets.
</p>

<pre caption="Installation using meta packages">
# <i>emerge -av kde-meta</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av kdebase-meta kdegames-meta</i> <comment>(installation of chosen modules only)</comment>
</pre>

<pre caption="Installation using sets">
<comment>(For KDE SC 4.9 Branch)</comment>
# <i>emerge -av @kde-4.9</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av @kdebase-4.9 @kdegames-4.9</i> <comment>(installation of chosen modules only)</comment>
<comment>(For KDE SC Trunk)</comment>
# <i>emerge -av @kde-live</i> <comment>(contains all of KDE modules)</comment>
# <i>emerge -av @kdebase-live @kdegames-live</i> <comment>(installation of chosen modules only)</comment>

<comment>See the <uri link="#sets">Using Sets</uri> section for more information.</comment>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Additional Installation/Removal Information</title>
<section id="sets">
<title>Using Sets</title>
<body>

<p>
One of the new features provided by Portage 2.2 is sets.
</p>

<p>
Sets allow the KDE team to provide a complete replacement for the monolithic
packages, with the added bonus that users may choose to remove from the default
sets any packages they do not want. There is still some discussion going on
before we can put sets in the Portage tree. Thus, grab the sets from the
<c>kde</c> overlay <uri
link="http://git.overlays.gentoo.org/gitweb/?p=proj/kde.git;a=tree;f=sets">sets
directory</uri> or grab them as a <uri
link="http://git.overlays.gentoo.org/gitweb/?p=proj/kde.git;a=snapshot;h=5b2fc54fa5d1c8aeddaeb05f044bf28754bb18be;sf=tbz2">
tar.bz2 archive</uri> and put the ones you like in <path>/etc/portage/sets</path> --
you can browse the list of sets provided by the KDE team in the overlay
by using the first link.
</p>

<note>
If you are using the kde overlay you can use sets directly
instead of copying them to <path>/etc/portage/sets</path>.
</note>

<p>
Amongst others, there are sets for each KDE tarball - @kdeaccessibility,
@kdeadmin, @kdeartwork, @kdebase, @kdeedu, @kdegames, @kdegraphics,
@kdemultimedia, @kdenetwork, @kdepim, @kdesdk, @kdetoys, and @kdeutils. There is
also a set of sets (the equivalent to the old kde-meta package) @kde, and the
same for specific versions @kde-3.5 and @kde-4x, a set for KDE deps @kdedeps, a
set for optional packages @kdeoptional and a set for the split qt packages
@qt-split.
</p>

<p>
One can install the complete KDE by running <c>emerge -av @kde</c>. The specific
version equivalents are very useful to uninstall an old version, e.g. <c>emerge
-C @kde-3.5</c>, or to reinstall all packages from a specific version, e.g.
<c>emerge -av1 @kde-4x</c>. Advanced features, like removing any unwanted
packages from a set, will be supported in a future release of Portage -- you can
read more about it in <uri
link="http://blogs.gentoo.org/genone/2008/09/29/more_extensions_to_package_set_support">Marius
Mauch's (genone) blog</uri>. Part of this code has now been released in
portage-2.2_rc12, so you can reinstall all installed packages of a set
with <c>emerge -av @&lt;set&gt;/@installed</c> or to have a
<path>/etc/portage/sets/kdebase-unwanted</path> set and then run <c>emerge -av
@kdebase-@kdebase-unwanted</c>.
</p>

<p>
We strongly recommend that you install the <c>kdebase</c> set in order to get a
full KDE 4 session. The example below would install the <c>kdebase</c> set and
the <c>kdegames</c> set.
</p>

<pre caption="Installing KDE SC">
# <i>emerge @kdebase @kdegames</i>
</pre>

<note>
If you want to check the list of sets known to Portage run the following:
<c>emerge --list-sets</c>
</note>

<note>
All >= KDE 4.6 ebuilds require <c>portage-2.1.9.27</c> or greater,
which has implemented everything in the new EAPI 4 specification used in
these ebuilds (<c>>=sys-apps/portage-2.2_alpha11</c> is required to use sets).
</note>

</body>
</section>
<section id="cleanup">
<title>Cleaning Up KDE</title>
<body>

<p>
In order to minimize issues, it is best to begin with a clean environment. This
is recommended for the following cases:
</p>

<ul>
 <li>Moving from <c>+kdeprefix</c> to <c>-kdeprefix</c> (and vice versa)</li>
 <li>
   Downgrading KDE (eg. from snapshots/live ebuilds to the Portage version)
 </li>
 <li>Fully upgrading from KDE 3 to KDE 4 (and vice versa)</li>
 <li>Moving from an old overlay</li>
</ul>

<p>
A possible way of completely removing an old KDE installation in this case is:
</p>

<pre caption="Unmerging command">
# <i>emerge -ac kde-base/kdelibs $(qlist -IC 'kde-base/*') \
             $(for name in $(qlist -IC|grep -v '^kde-base/') ; do (  qdepends -C $name | grep -q kdelibs )  &amp;&amp; echo $name  ; done)</i>
</pre>

<p>
Note that this will remove not just kde but also all other packages depending on it, 
as e.g. libreoffice[kde].
</p>

<p>
Using portage-2.2 you can also do the following:
</p>

<pre caption="Unmerging command using sets (i.e. portage-2.2)">
# <i>emerge -C @kde-4.X @kdebase-4.X @kde-3.5</i>(using the typical sets)
</pre>

<p>
As a final step you should remove any old overlay so that there are no conflicts
with the KDE ebuilds. You should remove the old unmask and/or keyword data, too.
</p>

<note>
Don't forget to run <c>emerge --depclean</c> in order to uninstall any
now unneeded dependencies.
</note>

</body>
</section>

<section>
<title>Localization/Internationalization</title>
<body>

<p>
With new KDE there is new translators effort in Localization instead of
Internationalization. This cause some confusion, but don't worry; just the name
has been changed.
</p>

<pre caption="Getting the translations">
<comment>For KDE 4 and Calligra:</comment>
# <i>emerge kde-l10n</i>
# <i>emerge calligra-l10n</i>
</pre>

</body>
</section>
<section>
<title>Migrating configs from 3.5 to 4.X</title>
<body>

<p>
KDE stores its configuration files in the <path>~/.kde</path> directory by
default. In the Gentoo ebuilds this has been changed in KDE 4.X to
allow for better integration of KDE 3.5 and 4.X when using the same user
account. If you export $KDEHOME this behaviour will be overridden. It is
strongly recommended that you do not do this. $KDEHOME will make KDE 3.5 and 4.X
use the same configuration directory which is usually not desired.
</p>

<p>
KDE 3.5 uses <path>~/.kde</path> and the default FHS (<c>-kdeprefix</c>) KDE 4.X
uses <e>~/.kde4</e>.
</p>

<p>
Settings are not migrated by default. If you want to attempt to migrate your
settings you should copy your old configuration directory to the new location
before logging in. For example:
</p>

<pre caption="Copying the configuration directory">
$ <i>cp -r ~/.kde ~/.kde4</i>
</pre>

<p>
If this is successful, then your settings should all be migrated. If not, it is
possible to log out and remove the new configuration directory to start with a
clean configuration directory.
</p>

<impo>
Moving backwards in version, from 4.X to 3.5, is not supported.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Archive</title>
<section>
<title>Upgrade from KDE SC 4.4 to 4.6</title>
<body>
<p>
KDE SC 4.6.3 is currently stable. If you encounter problems during the
upgrade from KDE SC 4.4, please have a look at the separate 
<uri link="kde44-46-upgrade.xml">Gentoo KDE 4.4 - 4.6 Upgrade Guide</uri> first!
</p>
</body>
</section>
</chapter>
</guide>
