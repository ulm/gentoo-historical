<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/desktop/kde/Attic/qt4-split-ebuilds.xml,v 1.1 2009/01/08 00:15:54 yngwin Exp $ -->

<guide>
<title>Qt 4.4 Split Ebuilds Migration Guide</title>

<author title="Author">
  <mail link="yngwin"/>
</author>
<author title="Editor">
  <mail link="nightmorph"/>
</author>

<abstract>
This guide helps you migrate your system from the monolithic Qt 4 ebuilds to
the new split ebuilds.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2</version>
<date>2009-01-07</date>

<chapter>
<title>Introduction</title>
<section>
<body>

<p>
We used to have the whole of Qt in one package, <c>x11-libs/qt</c>. But with
version 4.4, Qt has grown even bigger, taking on new modules such as Webkit
and Phonon. For that reason, we decided to split the big Qt package up into
smaller parts, and making separate ebuilds for a good number of Qt modules.
This means that from 4.4 on, you no longer need all of Qt installed in order
to use it. Packages no longer depend on <c>x11-libs/qt</c>, but only on needed
split ebuilds, so that only the parts that you really need will be installed.
</p>

<p>
Note that the split ebuilds use one big tarball, so the initial download will
be big. But the ebuilds will then only unpack and install the needed parts.
</p>

<p>
Also, for your convenience, in case you want to install all of Qt, we still
provide a <c>x11-libs/qt</c> ebuild, which is now a meta ebuild. Most users
will have no need to specifically install this meta ebuild though. Other
packages that they install will pull in the needed Qt modules as depedencies
automatically.
</p>

<p>
Users that want all of Qt should note that the qt meta ebuild still excludes
the seldom needed qt-demo and qt-phonon modules. You probably don't want to
install <c>qt-phonon</c>, as at this point no package in Portage specifically
needs it, and it is incompatible with <c>media-sound/phonon</c>, which is used
by KDE 4. It is probably only of interest for people doing non-KDE Qt
development.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Migrating from monolithic to split ebuilds</title>
<section>
<title>Step 1: Removing monolithic Qt-4 and packages depending on it</title>
<body>

<p>
In order to upgrade from monolithic <c>qt-4.3</c> to the newer split
<c>qt-4.4</c> ebuilds, you need to unmerge <c>qt:4</c> first:
</p>

<pre caption="Removing monolithic package">
# <i>emerge -aC qt:4</i>
</pre>

<p>
You'll also need to mask <c>=x11-libs/qt:4.3*</c> in
<path>/etc/portage/package.mask</path> unless it is already hardmasked in your
profile. (The intention is to hardmask the 4.3* version when split qt-4.4
ebuilds are marked stable. See <uri link="https://bugs.gentoo.org/234628">bug
234628</uri> for the dirty details of why this is necessary.)
</p>

<p>
You may need to unmerge packages that depend on <c>qt-4.3</c>, and remerge them
once you have <c>qt-gui</c> installed. All packages that used <c>qt-4.3</c>
should work fine now with <c>qt-gui-4.4</c> (and any additional split Qt
packages they specifically need). If this is not the case, please file a 
<uri link="https://bugs.gentoo.org/">bug</uri>.
</p>

<p>
In order to ease the migration, please make sure you have
<c>app-portage/gentoolkit</c> installed, and execute the following commands:
</p>

<pre caption="Removing packages depending on monolithic Qt4">
# <i>equery -q -C depends x11-libs/qt:4 > /var/cache/qt4pkgs</i>
# <i>for pkg in $(cat /var/cache/qt4pkgs); do emerge -C "=${pkg}"; done</i>
</pre>

</body>
</section>
<section>
<title>Step 2: Upgrading to split Qt-4 and reinstalling packages</title>
<body>

<p>
Then we proceed with installing the new core and gui modules of Qt 4.4:
</p>

<pre caption="Installing basic modules of split Qt4">
# <i>emerge -av1 qt-gui</i>
</pre>

<p>
And finally we reinstall the packages we removed that depended on qt-4.3. This
will also pull in any additional split Qt modules needed as dependencies:
</p>

<pre caption="Reinstalling packages depending on Qt4">
# <i>for pkg in $(cat /var/cache/qt4pkgs); do emerge "=${pkg}"; done</i>
# <i>rm /var/cache/qt4pkgs</i>
</pre>

</body>
</section>
<section>
<title>In case of problems</title>
<body>

<p>
If you come across any problems with the procedure outlined above, or find
anything related that is not covered in this guide, please file a <uri
link="https://bugs.gentoo.org/">bug</uri>. The Gentoo Qt team is trying to
make this migration as smooth as possible.
</p>

<p>
Enjoy your Qt!
</p>

</body>
</section>
</chapter>
</guide>
