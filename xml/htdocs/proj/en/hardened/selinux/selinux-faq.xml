<?xml version='1.0' encoding="utf-8"?>
<?xml-stylesheet href="/xsl/guide.xsl" type="text/xsl"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/proj/en/hardened/selinux/selinux-faq.xml">
<title>SELinux HOWTO and FAQ</title>
<author title="Author">
  <mail link="pebenito@gentoo.org">Chris PeBenito</mail>
</author>
<abstract>
Frequently asked questions and HOWTOs for SELinux
</abstract>
<version>1.1</version>
<date>3 October 2003</date>

<chapter><title>HOWTO: Load policy into a running SELinux kernel</title>
<section><body>
<p>
  This requires you to be in the <i>sysadm_r</i> role.
</p>
<pre>
# <c>cd /etc/security/selinux/src/policy</c>
# <c>make load</c>
# <c>make initrd</c>
</pre>
<p>
  The initrd does not have to be regenerated (third command) every time policy
  is loaded.  It does need to be done once before rebooting, to ensure the policy
  in the initrd is consistent, otherwise the old policy will be loaded.
</p>
</body></section>
</chapter>

<chapter><title>HOWTO: Change roles</title>
<section><body>
This requires your user have access to the target role.  This example
is for changing to the <i>sysadm_r</i> role.
<pre>
# <c>newrole -r sysadm_r</c>
</pre>
</body></section>
</chapter>

<chapter><title>HOWTO: Specify available roles for a user</title>
<section><body>
<p>
  The SELinux identity determines the roles available to a user.  Modify the
  users file (/etc/security/selinux/src/policy/users).  For example, to allow
  the user <i>pebenito</i> the ability to have roles <i>staff_r</i> and <i>sysadm_r</i>,
  add to the file:
</p>
<pre>user pebenito roles { staff_r sysadm_r };</pre>
<p>
  Then <uri link="#doc_chap1">load</uri> the policy.  See the 
  <uri link="selinux-policy.xml#doc_chap3">Selinux Policy Overview</uri> for
  additional information on SELinux identities.
</p>
</body></section>
</chapter>

<chapter><title>HOWTO: Relabel filesystems</title>
<section><body>
<p>
  This requires you to be in the <i>sysadm_r</i> role.
</p>
<pre>
# <c>cd /etc/security/selinux/src/policy</c>
# <c>make relabel</c>
</pre>
</body>
</section>
</chapter>

<chapter><title>HOWTO: Start daemons in the correct domain</title>
<section><body>
<p>
  Controlling daemons that have init scripts in /etc/init.d is slighly
  different in SELinux.  The <i>run_init</i> command must be used to run
  the scripts, to ensure they are ran in the correct domain.  The command
  can be ran normally, except the command is prefixed with <i>run_init</i>.
  This requires you to be in the <i>sysadm_r</i> role.
</p>
<pre caption="run_init examples">
# <c>run_init /etc/init.d/ntpd start</c>
# <c>run_init /etc/init.d/apache2 restart</c>
# <c>run_init /etc/init.d/named stop</c>
</pre>
</body></section>
</chapter>

<chapter><title>FAQ: Cannot log in over ssh</title>
<section><title>"I can log in at the console, but not over ssh."</title>
<body>
<p>
  Openssh is most likely not labeled correctly, so it is not running in the
  right context.  Relabel openssh, then restart sshd.
</p>
<pre>
# <c>rlpkg openssh</c>
# <c>run_init /etc/init.d/sshd restart</c>
</pre>
<p>
  Also ensure your user has a valid shell.
</p>
</body>
</section>
</chapter>

<!-- always keep this one as the bottom FAQ :) -->
<chapter><title>FAQ: Gentoo SELinux Demonstration Machine</title>
<section><body>
<p>
  This machine is not running user-mode linux, or in a chroot, it has SELinux
  mandatory access control.  No, you cannot install psybnc or an irc bot on the
  machine, unless you break the SELinux security and gain higher priviledge.
</p>
</body></section>
</chapter>
<!-- dont put anything below here, this demo machine faq should be the last one -->

</guide>
