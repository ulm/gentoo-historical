<?xml version='1.0' encoding="utf-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
  
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/hardened/selinux/Attic/hb-selinux-conv-reboot2.xml,v 1.2 2005/08/06 20:56:20 pebenito Exp $ -->

<sections>
<section><title>Merge SELinux Packages</title>
<subsection>
<body>
<p>Merge the libraries, utilities and base-policy.  The policy version may need
   be adjusted, refer to the SELinux Overview
   for more information on policy versions.  Then load the policy.</p>

<pre caption="Merge base SELinux packages and policy">
# <i>emerge libselinux checkpolicy policycoreutils</i>
# <i>emerge selinux-base-policy</i>

# <i>cd /etc/security/selinux/src/policy</i>
<comment>Adjust the policy version now, if needed.</comment>
# <i>make load</i>
</pre>
</body></subsection>
</section>

<section><title>Merge SELinux-patched packages</title>
<subsection><body>
<p>
  There are several system packages that have SELinux patches.  These patches
  provide a variety of additional SELinux functionality, such as displaying
  file contexts.
</p>

<pre caption="Remerge Packages">
# <i>emerge sysvinit pam coreutils findutils openssh pam-login procps psmisc shadow util-linux python-selinux</i>
</pre>

<p>There are other packages that have SELinux patches, but are optional.  These
should be remerged if they are already installed, so the SELinux patches are
applied:</p>
<ul>
<li>app-admin/logrotate</li>
<li>sys-apps/fcron</li>
<li>sys-apps/vixie-cron</li>
<li>sys-fs/udev</li>
<li>sys-libs/pwdb</li>
</ul>
<note>
  Fcron and Vixie-cron are the only crons with SELinux support.
</note>
</body></subsection>
</section>

<section><title>Remove Unneeded Packages</title>
<subsection><body>
<p>SELinux does not use some packages that are used in standard Gentoo:</p> 	 
  	 
<pre caption="Remove unused packages from standard Gentoo">
# <i>emerge -C textutils fileutils sh-utils</i>
</pre>
</body></subsection>
</section>

<section><title>Label Filesystems</title>
<subsection><body>

<p>
  Now label the filesystems.  This gives each of the files in the filesystems
  a security label.  Keeping these labels consistent is important.
</p>

<pre caption="Label filesystems">
# <i>cd /etc/security/selinux/src/policy</i>
# <i>make relabel</i>
</pre>
<warn>
  There is a known issue with older versions of GRUB
  not being able to read symlinks that have been labeled.
  Please make sure you have at least GRUB 0.94 installed.
  Also rerun GRUB and reinstall it into the MBR to ensure
  the updated code is in use.
  You do have a LiveCD handy, right?
</warn>

<pre caption="Reinstall GRUB on the MBR (GRUB users only)">
# <i>grub</i>

grub> root (hd0,0) <comment>(Your boot partition)</comment>
grub> setup (hd0) <comment>(Where the boot record is installed; here, it is the MBR)</comment>
</pre>
</body></subsection>
</section>

<section><title>Final reboot</title>
<subsection><body>
<p>Reboot.  Log in, then relabel again to ensure all files
are labeled correctly (some files may have been created during shutdown and
reboot)</p>
<pre caption="Relabel">
# <i>cd /etc/security/selinux/src/policy</i>
# <i>make relabel</i>
</pre>
<note>
  It is strongly suggested to <uri link="http://www.gentoo.org/main/en/lists.xml">subscribe</uri>
  to the gentoo-hardened mail list.  It is generally a low traffic list, and 
  SELinux announcements are made there.
</note>
<p>
  SELinux is now installed!
</p>
</body></subsection>
</section>
</sections>
