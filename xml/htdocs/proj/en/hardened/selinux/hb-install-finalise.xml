<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/hardened/selinux/Attic/hb-install-finalise.xml,v 1.1 2004/08/27 00:04:12 pebenito Exp $ -->

<sections>
<section>
<title>Final Relabel</title>
<subsection>
<body>
<p>
Once rebooted in your Gentoo installation, it is almost a certainty that
some files will have changed between the above relabeling and the reboot.
To ensure that all daemons and all processes run in their correct contexts,
you must relabel again.
</p>
<pre caption="Relabeling the Filesystem for the Second Time">
# <i>cd /etc/security/selinux/src/policy</i>
# <i>make relabel</i>
</pre>
</body>
</subsection>
</section>

<section>
<title>User Administration</title>
<subsection>
<title>Adding a User for Daily Use</title>
<body>

<p>
Working as root on a Unix/Linux system is <e>dangerous</e> and should be avoided
as much as possible. Therefore it is <e>strongly</e> recommended to add a user 
for day-to-day use.
</p>

<p>
For instance, to create a user called <c>john</c> who is member of the
<c>wheel</c> group (be able to change to root using <c>su</c>), <c>users</c>
group (default for all users) and <c>audio</c> group (be able to use audio
devices), log in as root first (only root can create users):
</p>

<pre caption="Adding a user for day-to-day use">
Login: <i>root</i>
Password: <comment>(Your root password)</comment>

# <i>useradd john -m -G users,wheel,audio,tty -s /bin/bash</i>
# <i>passwd john</i>
Password: <comment>(Enter the password for john)</comment>
Re-enter password: <comment>(Re-enter the password to verify)</comment>
</pre>

<p>
If a user ever needs to perform some task as root, they can use <c>su -</c>
to temporarily receive root privileges. Another way is to use the <c>sudo</c> 
package which is, if correctly configured, very secure.  The user must also
be added to the <c>staff_r</c> and <c>sysadm_r</c> roles.  The users file
(/etc/security/selinux/src/policy/users) must be modified, and
this line added (using the above user as an example):
</p>

<pre caption="Adding roles to a user">
user john roles { staff_r sysadm_r };
</pre>

<p>
The policy must be loaded for this to take effect.  See the
<uri link="?part=4&amp;chap=1#doc_chap3">SELinux Overview</uri>
for more information.
</p>

</body>
</subsection>
</section>
<section>
<title>Optional: Install GRP Packages</title>
<body>

<impo>
This part is for GRP users only. Other users should skip this part and continue
with <uri link="?part=1&amp;chap=12">Where to go from here?</uri>.
</impo>

<p>
Now that your system is booted, log on as the user you created (for instance,
<c>john</c>) and use <c>su -</c> to gain root privileges:
</p>

<pre caption="Gaining full root privileges">
$ <i>newrole -r sysadm_r</i>
Authenticating john.
Password: <comment>(Enter john's password)</comment>
$ <i>su -</i>
Password: <comment>(Enter your root password)</comment>
</pre>

<p>
Now we need to change the Portage configuration to look for the prebuilt 
binaries from the second CD (Gentoo Packages CD). First mount this CD:
</p>

<pre caption="Mount the Packages CD">
<comment>(Put the Gentoo Packages CD in the CD tray)</comment>
# <i>mount /mnt/cdrom</i>
</pre>

<p>
Now configure Portage to use <path>/mnt/cdrom</path> for its prebuilt packages:
</p>

<pre caption="Configuring Portage to use /mnt/cdrom">
# <i>ls /mnt/cdrom</i>

<comment>(If there is a /mnt/cdrom/packages directory:)</comment>
# <i>export PKGDIR="/mnt/cdrom/packages"</i>

<comment>(Otherwise:)</comment>
# <i>export PKGDIR="/mnt/cdrom"</i>
</pre>

<p>
Now install the packages you want. The Packages CD contains several prebuilt 
binaries, for instance KDE:
</p>

<pre caption="Installing KDE">
# <i>emerge --usepkg kde</i>
</pre>

<p>
Be sure to install the binaries now. When you do an <c>emerge sync</c> to update
Portage (as you will learn later), the prebuilt binaries might not match against
the ebuilds in your updated Portage. You can try to circumvent this by using
<c>emerge --usepkgonly</c> instead of <c>emerge --usepkg</c>.
</p>

<p>
Congratulations, your system is now fully equiped! Continue with <uri
link="?part=1&amp;chap=12">Where to go from here?</uri> to learn more about
Gentoo.
</p>

</body>
</section>
</sections>
