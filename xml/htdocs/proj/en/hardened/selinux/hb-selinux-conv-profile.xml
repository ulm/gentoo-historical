<?xml version='1.0' encoding="utf-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
 
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/hardened/selinux/Attic/hb-selinux-conv-profile.xml,v 1.9 2009/07/22 13:38:18 pebenito Exp $ -->

<sections>
<version>2.0</version>
<date>2007-07-22</date>

<section><title>Change Profile</title>
<subsection><body>

<warn>SELinux is only supported on ext2/3, XFS, and JFS.  Other filesystems
lack the complete extended attribute support.</warn>

<warn>Users should convert from a 2006.1 or newer profile otherwise
there may be unpredictable results.</warn>

<impo>As always, keep a LiveCD at hand in case things go wrong.</impo>

<p>First switch your profile to the SELinux profile for your architecture:</p>

<pre caption="Switch profiles">
# <i>rm -f /etc/make.profile</i>

<comment>x86:</comment>
# <i>ln -sf /usr/portage/profiles/selinux/2007.0/x86 /etc/make.profile</i>
<comment>x86 (hardened):</comment>
# <i>ln -sf /usr/portage/profiles/selinux/2007.0/x86/hardened /etc/make.profile</i>
<comment>AMD64:</comment>
# <i>ln -sf /usr/portage/profiles/selinux/2007.0/amd64 /etc/make.profile</i>
<comment>AMD64 (hardened):</comment>
# <i>ln -sf /usr/portage/profiles/selinux/2007.0/amd64/hardened /etc/make.profile</i>
</pre>

<impo>Do not use any profiles other than the ones listed above, even
if they seem to be out of date.  SELinux profiles are not necessarily
created as often as default Gentoo profiles.</impo>

<impo>The SELinux profile has significanly fewer USE flags asserted than
the default profile.  Use <c>emerge info</c> to see if any use flags
need to be reenabled in make.conf.</impo>

<note>It is not necessary to add selinux to your USE flags in make.conf.
The SELinux profile already does this for you.
</note>

<note>
  You may encounter this message from portage: "!!! SELinux module not found.
  Please verify that it was installed."  This is normal, and will be fixed
  later in the conversion process.
</note>
</body>
</subsection>
</section>

<section><title>Update Kernel Headers</title>
<subsection><body>
<p>
  We will start by updating essential packages.  First check which version
  of linux-headers is installed.
</p>

<pre caption="Check linux-headers version">
# <i>emerge -s linux-headers</i>
<comment>or if you have gentoolkit installed:</comment>
# <i>equery list -i linux-headers</i>
</pre>

<p>
  If the linux-headers version is older than 2.4.20, newer headers must be merged.
</p>

<pre caption="Merge newer headers">
# <i>emerge \>=sys-kernel/linux-headers-2.4.20</i>
</pre>
</body>
</subsection>
</section>

<section><title>Update Glibc</title>
<subsection><body>
<p>
  If you have merged new headers, or you are unsure if your glibc was
  compiled with newer headers, you must recompile glibc.
</p>

<pre caption="Recompile glibc">
# <i>emerge glibc</i>
</pre>

<impo>
  This is a critical operation.  Glibc must be compiled with newer linux-headers,
  otherwise some operations will malfunction.
</impo>
</body></subsection>
</section>
</sections>
