<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/en/lisp/emacs/emacs.xml,v 1.23 2007/05/26 14:24:12 opfer Exp $ -->

<guide link="/doc/en/guide.xml" lang="en">
<title>GNU Emacs on Gentoo</title>

<author title="Author">
  <mail link="ulm@gentoo.org">Ulrich MÃ¼ller</mail>
</author>
<author title="Author">
  <mail link="opfer@gentoo.org">Christian Faulhammer</mail>
</author>

<abstract>
This document describes how GNU Emacs and associated packages are made
available in Gentoo.  These guidelines also describe the philosophy
how the packages are maintained.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>0.3</version>
<date>2007-05-25</date>

<chapter>
<title>Introduction</title>
<section>
<title>What is Emacs?</title>
<body>

<p> 
<uri link="http://www.gnu.org/software/emacs/">Emacs</uri> is the
extensible, customizable, self-documenting real-time display editor.
Large parts are written in the Lisp dialect Emacs Lisp, with which
extensions can be easily developed.  Apart from its editing features,
GNU Emacs provides a whole environment to manage your system, mails,
IRC chats and texts (be it correspondence or programming).
</p>

</body>
</section>
</chapter>

<chapter id="available_versions">
<title>Maintaining the editor itself</title>
<section>
<title>Available versions</title>
<body>
<p>
Currently the following Emacs versions are available:
</p>
<table>
<tr>
  <th>Package</th>
  <th>Version</th>
  <th>Type</th>
  <th>SLOT</th>
  <th>eselect name</th>
  <th>blocking depend</th>
</tr>
<tr>
<ti>emacs</ti>
  <ti>18.59</ti>
  <ti>released</ti>
  <ti>18</ti>
  <ti>emacs-18</ti>
  <ti></ti>
</tr>
<tr>
  <ti>emacs</ti>
  <ti>21.4</ti>
  <ti>released</ti>
  <ti>21</ti>
  <ti>emacs-21</ti>
  <ti></ti>
</tr>
<tr>
  <ti>emacs-cvs</ti>
  <ti>22.0*</ti>
  <ti>pre-release</ti>
  <ti>22</ti>
  <ti>emacs-22</ti>
  <ti></ti>
</tr>
<tr>
  <ti>emacs-cvs</ti>
  <ti>22.0.9999</ti>
  <ti>CVS (22_BASE branch)</ti>
  <ti>22</ti>
  <ti>emacs-22</ti>
  <ti></ti>
</tr>
<tr>
  <ti>emacs</ti>
  <ti>(22.1)</ti>
  <ti>not yet released</ti>
  <ti>22</ti>
  <ti>emacs-22</ti>
  <ti>!&lt;emacs-cvs-22.1</ti>
</tr>
<tr>
  <ti>emacs-cvs</ti>
  <ti>22.1.50</ti>
  <ti>CVS (trunk)</ti>
  <ti>22</ti>
  <ti>emacs-22-cvs</ti>
  <ti></ti>
</tr>
<tr>
  <ti>emacs-cvs</ti>
  <ti>23.0.0</ti>
  <ti>CVS (unicode-2 branch)</ti>
  <ti>23</ti>
  <ti>emacs-23</ti>
  <ti></ti>
</tr>
</table>

</body>
</section>

<section id="location">
<title>Locations of files</title>
<body>
<p>
The following files are installed in different locations or under a
different name:
</p>

<ul>
  <li>Emacs executable: <path>/usr/bin/emacs-<e>suffix</e></path>,
      where <e>suffix</e> is normally equal to the Emacs major version</li>
  <li>Auxiliary programs (e.g., <path>ctags</path>):
      <path>/usr/bin/ctags-emacs-<e>suffix</e></path></li>
  <li>Man pages are named accordingly</li>
  <li>Info files of Emacs are installed in directory
      <path>/usr/share/info/emacs-<e>suffix</e>/</path></li>
</ul>

<p>
The programs are symlinked to their original names by the Emacs
<uri link="#eselect">eselect module</uri>.
</p>
</body>
</section>

<section>
<title>USE flags</title>
<body>
<p>
Emacs has many USE flags, most are easy to understand what they are
good for, others have some hidden "features" one should know about.
</p>
<table>
<tr>
  <th>Flag</th>
  <th>Description</th>
  <th>Notes</th>
</tr>
<tr>
  <ti>alsa</ti>
  <ti>Determine if ALSA should be used</ti>
  <ti>Emacs autodetects ALSA.  That test is patched out if the flag
  is not set.  This is for cases where ALSA is installed but the user
  does not wish support for it in Emacs.</ti>
</tr>
<tr>
  <ti>gif</ti>
  <ti>Support for GIF images.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>gtk</ti>
  <ti>USE the Gimp ToolKit as windowing toolkit (menu bar etc.)</ti>
  <ti>When this toolkit is activated along with alternative ones (see
  other USE flags), GTK is chosen.  This is in sync with upstream's whises.</ti>
</tr>
<tr>
  <ti>gzip-el</ti>
  <ti>Zip up all el files.</ti>
  <ti>The zip binary is autodetected.  So even when this USE flag is
  disabled but the binary is found, all el files will be compressed.
  The ebuild takes care by confusing the configure script.</ti>
</tr>
<tr>
  <ti>hesiod</ti>
  <ti>Use the hesiod name service system.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>jpeg</ti>
  <ti>Support for JPEG images.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>leim</ti>
  <ti>Extended methods for input encodings.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>lesstif</ti>
  <ti>A windowing toolkit.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>motif</ti>
  <ti>A windowing toolkit.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>nls</ti>
  <ti>This makes use of gettext, an easy way to provide translations
  of strings.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>nosendmail</ti>
  <ti>Don't pull in a mail transfer agent (MTA).</ti>
  <ti></ti>
</tr>
<tr>
  <ti>png</ti>
  <ti>Support for PNG images.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>sound</ti>
  <ti>Control the availability of sound support.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>source</ti>
  <ti>Install the C source files and make them available in the
  internal documentation system of GNU Emacs.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>spell</ti>
  <ti>Control the spell checking abilities.</ti>
  <ti>Emacs 22 and higher autodetect aspell in favor of ispell, so no further
  actions needed.</ti>
</tr>
<tr>
  <ti>tiff</ti>
  <ti>Support for tiff images.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>toolkit-scroll-bars</ti>
  <ti>Instead of the internal scroll bars, the ones from the
  windowing toolkit are used.</ti>
  <ti>You will lose some functionality (split windows by clicking on
  the scroll bar for example).</ti>
</tr>
<tr>
  <ti>X</ti>
  <ti>Let Emacs use an X session if available.  Text mode can always
  be forced.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>Xaw3d</ti>
  <ti>A windowing toolkit.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>xft</ti>
  <ti>Choose an alternative font renderer.</ti>
  <ti></ti>
</tr>
<tr>
  <ti>xpm</ti>
  <ti>Support for xpm images.</ti>
  <ti>If disabled, all logos, icons etc. in Emacs are displayed in
  grayscale.  This flag is set to on in base profile's <path>package.use</path>.</ti>
</tr>
</table>
</body>
</section>
</chapter>

<chapter>
<title>Packages</title>
<section>
<title>The site-lisp directory and package loading</title>
<body>
<p>
The regular location for Emacs lisp packages in Gentoo
is <path>/usr/share/emacs/site-lisp/<e>package</e>/</path>.  All Elisp
files (<path>.el</path>) and compiled Elisp files (<path>.elc</path>
should go there.
</p>
<p>
Emacs packages normally need to be activated or loaded when a certain
condition is met (like c-mode for C source files).
</p>
<p>
In Gentoo every package has a site initialisation file that holds
the needed commands.  The file is located in <c>${FILESDIR}</c> and
starts with a two-digit number, followed by the package name
and <path>-gentoo</path>.  The <c>elisp-install</c> function puts
this file in the directory <path>/usr/share/emacs/site-lisp/</path>.
</p>
<p>
When calling <c>elisp-site-regen</c> in an ebuild, the global site
file <path>/usr/share/emacs/site-lisp/site-gentoo</path> is
regenerated, which holds the contents of all individual site init
files in one.  They are read in alphabetical order, so the numbers
determine which comes first, the lowest is to be found at the
beginning.  That means: Packages depending on each other need to have rising
order for site initialisation, too.
</p>

<p>
Some time ago all those initialisations were added
to <path>/usr/share/emacs/site-lisp/site-start.el</path>, which is
always loaded at Emacs start-up!  Today you can individually control
which user will activate all installed Elisp packages by adding a line like
</p>
<p>
<c>(load "/usr/share/emacs/site-lisp/site-gentoo" nil t)</c>
</p>
<p>
to a file read by Emacs on start-up.
</p>
<p>
A <c>load</c> command for site initialisationis only acceptable for a
few packages.  If used, it always loads the whole package and makes
Emacs start-up really slow, so the autoload mechanism is the preferred
way.  The <path>elisp-common</path> eclass has functions to generate
an autoload file if none is shipped is with the package but the
functionality is available nonetheless.  For more information about
the mechanism see
the <uri link="http://ftp.gnu.org/gnu/Manuals/elisp-manual-21-2.8/html_chapter/elisp_15.html#SEC199">Elisp
	manual</uri>.
</p>
</body>
</section>

<section>
<title>Eclasses</title>
<body>
<p>
Packages that have support for or rely on GNU Emacs can use two eclasses to do
some recurring tasks in a simple way.  The documentation of the
functions are provided at the beginning of the eclasses, so they are
not repeated here!
</p>
<table>
<tr>
  <th>Name</th>
  <th>Purpose</th>
</tr>
<tr>
  <ti><path>elisp-common.eclass</path></ti>
  <ti>Provides functions to handle Elisp files.  Compilation,
  installation and generation of autoloads is covered here in a
  general way.  Packages with optional Emacs support must rely on this eclass.</ti>
</tr>
<tr>
  <ti><path>elisp.eclass</path></ti>
  <ti>The functions from <path>elisp-common.eclass</path> are used to
  construct the default functions
  (<c>src_unpack</c>, <c>src_compile</c> and friends) for packages in
  the <path>app-emacs</path> hierarchy of ebuilds.  It pulls in an
  appropriate version of Emacs (meaning <path>virtual/emacs</path>)
  and is <e>not</e> intended for packages with optional (via USE
  flag) support for GNU Emacs.</ti>
</tr>
</table>
</body>
</section>

<section id="eselect">
<title>Emacs eselect module</title>
<body>
<p>
Having several Emacs versions simultaneously installed on a system,
needs some caution by maintainers.  Usual pitfalls are file collisions
and installations of one slot using data from another.  As
described <uri link="#location">earlier</uri>, the executables are
suffixed with their corresponding version number.  All data files go
to similar directories, also distinguished by a version suffix.
</p>
<p>
To be independent of the installed version, the eselect module
from <path>app-admin/eselect-emacs</path> guarantees
that <path>/usr/bin/emacs</path> always points to the Emacs you want.
All ebuilds for the editor check if the symlink is set, and change it
to the highest available in the case where it does not exist.
</p>
<p>
The module file has some comments about how the code works.  For more
information how an eselect module is set up, consult the <uri link="http://www.gentoo.org/proj/en/eselect/dev-guide.xml">documentation</uri>.
</p>
</body>
</section>

<section>
<title>Provided virtuals</title>
<body>
<p>
Some functionality is available several times in different packages.
To not force a subjective choice the maintainer made, virtuals check
if one of the alternatives is installed on the user's system.
</p>
<dl>
<dt>virtual/editor</dt>
<dd>Just makes sure you have an editing capability available on your system.</dd>
<dt>virtual/emacs</dt>
<dd>This gives you the choice between several version of Emacs.
  Elisp packages can choose which virtual version is the minimum they
  need.</dd>
<dt>virtual/flim</dt>
<dd>There are several libraries that provide encoding functions for
  other packages.  If they are compatible
  to <path>app-emacs/flim</path>, they should provide the virtual of
  the same name.</dd>
<dt>virtual/gnus</dt>
<dd>The news reader gnus is shipped with Emacs (from 21 on) and also
  available as a separate package.  To give users a better choice,
  all of these ebuilds provide a virtual.  Though it is only valid
  for version 5.10 or greater for Gnus, so the virtual points to
  Emacs 22. </dd>
</dl>
</body>
</section>

<section>
<title>Where Emacs team is upstream</title>
<body>
<p>
Not all packages maintained by the Emacs team are developed by people
from outside the Gentoo project (they are usually called upstream).
Most of those exceptions are for proper operation of GNU Emacs in the Gentoo environment
and provided in the Emacs Overlay in the emacs-extra branch.  From
there they are packaged and brought to the Portage tree when they have
proven stable.
</p>
<p>
Development takes place in the <path>emacs-extra</path> part of the
<uri link="http://overlays.gentoo.org/proj/emacs/browser/emacs-extra">Emacs overlay</uri>.
There are detailed ChangeLogs available, which should be used to document the process that
lead to a solution.
</p>
<table>
<tr>
  <th>Package name</th>
  <th>Purpose</th>
</tr>
<tr>
  <ti><path>app-admin/eselect-emacs</path></ti>
  <ti>Setting the correct man page locations, Info documentation paths
  and target for <path>/usr/bin/emacs</path>, see the separate <uri link="#eselect">section</uri>.</ti>
</tr>
<tr>
  <ti><path>x11-misc/emacs-desktop</path></ti>
  <ti>Holds the <path>desktop</path> file (provides file associations
  for many desktop environments) and icons, needed when Emacs is
  emerged with <c>USE=X</c>.</ti>
</tr>
<tr>
  <ti><path>app-emacs/ebuild-mode</path></ti>
  <ti>A Emacs major mode that helps you edit ebuilds.</ti>
</tr>
</table>
</body>
</section>
</chapter>
</guide>
