<?xml version='1.0' encoding="UTF-8"?>


<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="torrent.xml">
<title>Maintainers Guide - torrents.gentoo.org</title>
<author title="Author">
  <mail link="curtis119@gentoo.org">Curtis Napier</mail>
</author>

<abstract>
Maintainers Guide for torrents.gentoo.org 
</abstract>

<version>0.1</version>
<date>March- 6-2006</date>

<chapter>
<title>Torrent Tracker</title>
<section>
<body>

<p>
Gentoo offers iso's of our release media and other files via BitTorrent. We host
our own torrent tracker at http://torrents.gentoo.org/. The website uses
<uri link="http://phpbttrkplus.sourceforge.net/">PHPBTTracker+</uri> to track
the torrents.
</p>

</body>
</section>

<section>
<title>Initial Setup</title>
<body>

<p>
Requirements:
</p>

<ul>
  <li>Apache2</li>
  <li>mySQL</li>
  <li>php (requires USE="session")</li>
</ul>

<p>
The tracker resides on sparrow.gentoo.org and is administered by the Infrastructure
Project. The administrator assigned to the box will assist you by keeping the 
software up to date and advising you of any changes. Close coordination with the
assigned administrator is very important.
</p>

<p>
The tracker runs inside a webserver owned by a special user $TORRENT (the server
administrator has the details of the actual account). su to this user when adding
or changing any files to the web server. Apache user has group write access to
torrents/ in order to upload the .torrent files for storage. All other files and
directories are owned by the $TORRENT user.
</p>

<p>
Untar the tracker software in htdocs and edit <path>config_example.php</path> and
move it to <path>config.php</path>. The php scripts expect config.php to be in the
parent directory. Edit the necessary php files to reflect this. Move
<path>index_samples/index_sample.php</path> to <path>../index.php</path>. Edit
this file and insert the Gentoo header and make any other formatting changes necessary. 
</p>

<p>
Move <path>index_samples/tracker.css</path> to <path>../tracker.css</path> and
insert the Gentoo header information and any other formatting changes. Use
<uri link="http://www.gentoo.org/css/main.css">main.css</uri> as a reference.
</p>

<p>
The php scripts are heavily commented. Read the INSTALL and README docs for
information for other configuration information.
</p>

</body>
</section>
<section>
<title>Administration</title>
<body>

<p>
Logon to the <uri link="http://torrents.gentoo.org/administration/">administrative
panel</uri> for reports, adding and deleting torrents and grouping functions.
Create all of the categories first and then add the torrents. Make sure to fill
in the category information on the add torrent panel. 
</p>

</body>
</section>
<section>
<title>New Releases and Upgrades</title>
<body>

<p>
Because the release media is retired at each release the torrent database will
simply be cleared and the tracker software reinstalled. The install process is
much easier and less time consuming than retiring each individual torrent. Use
mysql to drop all the tables in the database and the install process will
automatically recreate it.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Torrent Client</title>
<section>
<body>

<p>
The torrent client is <uri link="http://www.bittornado.com/">BitTornado</uri>.
Use the various scripts it comes with to create the torrents and seed them.
</p>

<p>
The actual release media is stored in <path>/mnt/torrents/</path>. The mirror
admin will copy the <path>release/</path> directory directly to this partition.
Create a directory for the release, example <path>/mnt/torrents/2006.0</path>.
</p>

<p>
Move the files for the individual torrents into a seperate directory in
<path>/mnt/torrents/2006.0/*</path>. For instance: 
<path>/mnt/torrents/2006.0/x86-installcd-2006.0/</path>. Each .iso should be a
seperate torrent file. Include the .contents, .digests and .asc files for the .iso. 
in the directory with the .iso.
</p>

<p>
Once you have all of the files sorted use <c>btcompletedir.py</c> to mass create
the .torrent files:
</p>

<p>
$ btcompletedir.py http://torrents.gentoo.org/tracker.php/announce /mnt/torrents/2006.0/
</p> 

<p>
The torrent client is hosted on the same machine. Once you have created the torrents
use links to <uri link="http://torrents.gentoo.org/administration/">logon</uri>
to the tracker and add the torrents. 
</p>

<p>
Now start a screen session named <c>bittorando</c> and then su to the $TORRENT user.
Change to /mnt/torrents/2006.0 and start the torrent client.
</p>

<p>
/usr/bin/btlaunchmany.py --display_interval 100 --minport 6881 --maxport 6999 --ip 38.99.80.68 ./
</p>

</body>
</section>
</chapter>

<chapter>
<title>Resources</title>
<section>
<body>

<ul>
  <li><uri link="http://torrents.gentoo.org/">Gentoo Torrent Tracker</uri></li>
  <li><uri link="http://torrents.gentoo.org/administration/">Gentoo Torrent
  Tracker Administration</uri></li>
  <li><uri link="http://phpbttrkplus.sourceforge.net/">PHPBTTracker+</uri></li>
  <li><uri link="http://www.bittornado.com/">BitTornado</uri></li>
</ul>

<p>
For details of the #TORRENT account and the database account please contact the
server admin.
</p>

</body>
</section>
</chapter>

</guide>
