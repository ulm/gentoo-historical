<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/ro/base/amd64/howtos/Attic/2005.0-upgrade-amd64.xml,v 1.3 2005/09/22 04:07:08 alin Exp $ -->

<!-- The context of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommonds.org/licenses/by-sa/1.0 -->

<sections>

<version>1.3.4</version>
<date>2005-09-10</date>

<section>
<title>Actualizarea la multilib 2005.0</title>
<body>

<p>
Multilib este, acum, introdus în mod forţat în profilul 2005.0. Dacă
doriţi să aveţi un sistem pur pe 64 de biţi, puteţi utiliza profilul
2005.0/no-multilib. Acest ghid vă va arăta cum să actualizaţi o
instalare anterioară la un sistem ce utilizează noul nostru profilul.
Există două moduri de actualizare: calea uşoară bazată pe script-uri,
sau calea mai lungă, manuală.
</p>
</body>

<subsection>
<title>Actualizarea bazată pe script</title>
<body>

<p>
Vă recomandăm să utilizaţi script-ul de actualizare pentru a uşura
procesul.
</p>

<pre caption="Actualizarea bazată pe script">
# <i>cd /usr/portage/profiles/default-linux/amd64/2005.0/scripts</i>
# <i>sh ./2004.3-2005.0upgrade.sh</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</subsection>

<subsection>
<title>Actualizarea manuală</title>
<body>

<p>
Dacă folosiţi în mod curent USE=-multilib, trebuie să setaţi multilib
în variabila USE şi să recompilaţi gcc.
</p>

<pre caption="Instalarea unui compilator multilib">
# <i>USE=multilib emerge gcc</i>
<comment>Dacă primiţi o eroare despre faptul că nu aveţi componenta
sandbox compilată cu multilib, trebuie să setaţi FEATURES=-sandbox</comment>
# <i>FEATURES=-sandbox USE=multilib emerge gcc</i>
</pre>

<p>
Adiţional, trebuie să vă asiguraţi că aveţi versiunile necesare pentru
pachetele componente ale toolchain/portage, deoarece acestea sunt necesare
pentru a recompila corect glibc după schimbarea profilului.
</p>

<pre caption="Asiguraţi-vă că aveţi toolchain compilat cu multilib">
# <i>emerge -v --oneshot '>=sys-apps/portage-2.0.51-r9'</i>
# <i>emerge -v --oneshot 'sys-apps/sandbox'</i> <comment>Doar dacă aveţi ~amd64</comment>
# <i>emerge -v --oneshot '>=sys-devel/gcc-config-1.3.9'</i>
# <i>emerge -v --oneshot '>=sys-devel/distcc-2.18.3-r1'</i>
# <i>emerge -v --oneshot '>=linux-headers-2.6.8.1-r4'</i>
</pre>

<p>
Apoi, asiguraţi-vă că versiunea noastră pe 32 de biţi a pachetului
glibc este la zi. Această versiunea este necesară procesului de bootstrap
pentru compilarea pachetului glibc pe 32 de biţi după schimbarea profilului.
</p>

<pre caption="Instalaţi ultima versiune de glibc pe 32 de biţi">
# <i>emerge -v --oneshot '>=emul-linux-x86-glibc-2.3.4.20041102'</i>
</pre>

<p>
2005.0 nu utilizează link-uri simbolice de la /lib32 şi /usr/lib32 către
directoarele de emulare, deci va trebui să le transformăm în directoare
şi să copiem unele directoare importante.
</p>

<pre caption="Pregătirea manuală a directoarelor /lib32 şi /usr/lib32">
# <i>rm /lib32 /usr/lib32</i>
# <i>mkdir /lib32 /usr/lib32</i>
# <i>cp /emul/linux/x86/lib32/libsandbox.so /usr/lib32</i> <comment>Dacă utilizaţi ramura stabilă</comment>
# <i>cp /emul/linux/x86/usr/lib32/libsandbox.so /usr/lib32</i> <comment>Dacă utilizaţi ~amd64</comment>
# <i>cp /emul/linux/x86/usr/lib32/libc.so /usr/lib32</i>
# <i>cp /emul/linux/x86/usr/lib32/libpthread.so /usr/lib32</i>
# <i>cp /emul/linux/x86/usr/lib32/*crt*.o /usr/lib32</i>
# <i>env-update</i>
</pre>

<p>
Acum, trebuie să ne asigurăm că pachetul baselayout este la zi, pentru a
putea garanta existenţa /etc/env.d/04multilib.
</p>

<pre caption="Actualizarea baselayout">
# <i>emerge -v --oneshot baselayout</i>
</pre>

<p>
Acum, suntem gata, într-adevăr să comutăm la profilul 2005.0.
</p>

<pre caption="Modificaţi-vă profilul">
# <i>rm /etc/make.profile</i>
# <i>ln -s /usr/portage/profiles/default-linux/amd64/2005.0 /etc/make.profile</i>
</pre>

<p>
Acum, trebuie doar să compilaţi glibc, să dezinstalaţi versiunea
(învechită) emul-linux-x86-glibc şi să actualizaţi sistemul de bază.
Ar trebui să instalaţi aceeaşi versiune de glibc ca cea prezentă în
sistemul dvs., pentru a evita posibilele probleme de compilare (ce rezultă
în emerge care îşi încheie execuţia cu un mesaj de eroare).
</p>

<pre caption="Terminarea actualizării">
# <i>emerge -v --oneshot emerge -v --oneshot sys-libs/glibc</i>
# <i>emerge unmerge emul-linux-x86-glibc</i>
# <i>rm /emul/linux/x86/usr/lib/libsandbox.*</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</subsection>

<subsection>
<title>Probleme Comune</title>
<body>

<p>
<b>Comanda iniţială USE=multilib emerge gcc (sau sandbox) returnează 'skipping
incompatible /usr/lib/libc.so when searching for -lc'</b>
</p>

<p>
Această problemă este corectată, de obicei, prin rularea 'emerge -v --oneshot
emul-linux-x86-glibc'
</p>

<p>
<b>Cannot compute sizeof (long double)</b>
</p>

<p>
Dacă întâmpinaţi o problemă când ./configure rulează la pachetul
glibc şi acesta îşi termină execuţia cu mesajul 'checking size of long
double... configure: error: cannot compute sizeof (long double), 77',
verificaţi fişierul config.log şi căutaţi eroarea. Aceasta este prima
dată când sistemul dvs. toolchain este utilizat pentru a crea şi executa o
aplicaţie pe 32 de biţi. Problemele şi cauzele asociate pe care le veţi
observa sunt:
</p>

<pre caption="cannot compute size of long double">
<comment>Can't find libc.so</comment>
  Este ceva în neregulă cu pachetul dvs. instalat emul-linux-x86-glibc.
  Urmaţi aceşti paşi:
    # <i>rm -rf /lib32 /usr/lib32</i>
    # <i>rm /etc/make.profile</i>
    # <i>ln -s /usr/portage/profiles/default-linux/amd64/2004.3 /etc/make.profile</i> <comment>Sau 2003.4/lib64, în cazul în care acesta a fost profilul dvs. iniţial</comment>
    # <i>emerge --sync</i> <comment>Aveţi nevoie de o versiune snapshot de portage, cel puţin din 12 Iulie, 2200 UTC</comment>
    # <i>emerge -v --oneshot '>=emul-linux-x86-glibc-2.3.4.20041102'</i>

    <comment>Dacă utilizaţi actualizarea bazată pe script:</comment>
    # <i>rm /var/tmp/2005.0_upgrade/step[34]</i>
    # <i>cd /usr/portage/profiles/default-linux/amd64/2005.0/scripts</i>
    # <i>sh ./2004.3-2005.0upgrade.sh</i>

    <comment>Dacă utilizaţi actualizarea manuală:</comment>
    Continuaţi din blocul de cod unde aţi şters link-urile simbolice /lib32 şi /usr/lib32.

<comment>Can't find libsandbox.so</comment>
  Probabil că nu aveţi unul din pachetele sandbox sau portage, compilate
  cu sandbox. Cea mai uşoară soluţie este să utilizaţi FEATURES=-sandbox
  pe toată durata actualizării, şi apoi să recompilaţi portage şi sandbox.

<comment>./conftest: cannot execute binary file</comment>
  Probabil că trebuie să activaţi suportul pentru executabile pe 32 de 
  biţi, în kernel-ul dvs.
</pre>

<p>
<b>Simboluri nerezolvate în timpul compilării/editării de legături a
pachetului glibc</b>
</p>

<p>
Dacă primiţi mesaje despre simboluri nerezolvate în timpul compilării
glibc, încercaţi să efectuaţi operaţia de emerge --sync, şi apoi să
încercaţi din nou. Veţi avea nevoie de o versiune snapshot a portage mai
nouă de 20 August 2005. Dacă sunteţi blocaţi cu o versiune snapshot
dinainte de 20 August, trebuie doar să instalaţi aceeaşi versiune de glibc
ca cea deja prezentă în sistemul dvs. şi apoi să actualizaţi la o
versiune mai nouă de glibc după terminarea actualizării la 2005.0.
</p>

</body>
</subsection>
</section>

<section>
<title>Actualizarea la profilul 2005.0/no-multilib (doar pentru 64 de biţi)</title>
<body>

<p>
Utilizaţi acest profil doar în cazul în care nu doriţi nici o aplicaţie pe
32 de biţi instalată pe sistemul dvs. Aceasta înseamnă că nu veţi
putea să jucaţi jocuri pentru x86, să utilizaţi openoffice-bin,
mplayer-bin, mozilla-bin (flash), acroread, etc.
</p>

<pre caption="Comutaţi profilul şi actualizaţi sistemul">
# <i>rm /etc/make.profile</i>
# <i>rm /lib32 /usr/lib32</i> <comment>(Doar dacă directoarele există)</comment>
# <i>ln -s /usr/portage/profiles/default-linux/amd64/2005.0/no-multilib /etc/make.profile</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</section>
</sections>
