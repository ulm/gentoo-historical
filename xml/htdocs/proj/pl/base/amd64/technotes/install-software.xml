<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/pl/base/amd64/technotes/Attic/install-software.xml,v 1.1 2005/08/26 20:27:57 rane Exp $ -->
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The context of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommonds.org/licenses/by-sa/2.5 -->

<sections>

<section>
<title>Dostępne jądra</title>
<subsection>
<title>Na płycie instalacyjnej</title>
<body>

<p>
Od czasu wydania Gentoo 2004.3, na płytach instalacyjnych dostępne jest jedno
jądro, którego można użyć do bootowania. Jest to jądro typu SMP i nazywa się
<c>gentoo</c>. Komputery innego typu wciąż mogą korzystać z tego kernela.
</p>

</body>
</subsection>
<subsection>
<title>Wykorzystanie prawidłowych źródeł jądra</title>
<body>

<impo>
Należy korzystać z jąder linii <path>sys-kernel/gentoo-sources</path>! Zawierają
one łatki specyficzne dla AMD64 oraz inne dodatkowe rozszerzenia.
Wykorzystywanie innych kerneli nie jest zalecane.
</impo>

</body>
</subsection>
<subsection>
<title>Budowanie jądra dla laptopa eMachine</title>
<body>

<p>
Przed wydaniem Gentoo 2004.3, w czasie konfiguracji jądra dla laptopa eMachine
Mobile Athlon64 <e>konieczne</e> było wkompilowanie obsługi USB. W przeciwnym
razie generowany był błąd "unknown keypress" z pliku <path>atkbd.c</path>.
Wyłączenie wparcia dla USB nie było możliwe.
</p>

<p>
Wszelkie problemy związane z pracą Gentoo 2004.3 na laptopach eMachine powinny
być raportowane poprzez stronę <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Jądra 2.4.x oficjalnie zdeprecjonowane</title>
<body>

<p>
<b>Linia jąder 2.4.x została oficjalnie zdeprecjonowana dla komputerów
AMD64.</b> Gdy w jądrach wersji 2.4.23-pre7 zrezygnowano z obsługi devfs
(została ona ukryta), pojawił się problem z zarządzaniem pamięcią, co było
bezpośrednim powodem dokonania deprecjacji. W Gentoo nie doświadczyliśmy tego
typu problemów, jednak kernele linii 2.4 nie są dobrym rozwiązaniem ze względu
na brak obsługi devfs.
</p>

</body>
</subsection>
<subsection>
<title>gcc 3.3 oficjalnie zdeprecjonowane</title>
<body>

<p>
<b>Wraz z wydaniem Gentoo 2004.3, gcc 3.3 zostało oficjalnie zdeprecjonowane dla
komputerów AMD64.</b> Wszystkie wydania od 2004.3 opierają się na gcc 3.4.x.
</p>

</body>
</subsection>
</section>
<section><title>Błędy w czasie uruchamiania systemu zgłaszane przez jądro</title>
<body>

<p>
Jeśli w czasie uruchamiania systemu jądro zgłasza błędy (następuje kernel
panic), zaleca się przekazanie parametru <c>idle=poll</c> jako opcji bootowania.
Istnieje problem związany z wieloma BIOS-ami i wydaje się on dotykać głównie
płyt głównych z chipsetem VIA. Dodanie powyższego parametru do opcji
uruchamiania jądra może nastąpić jedynie <e>po</e> aktualizaji do najnowszej
wersji BIOS-u, jaką udostępnia producent posiadanej płyty głównej. Być może uda
się rozwiązać ten problem poprzez wyłączenie opcji "Legacy USB support" w
BIOS-ie. Jeśli jednak jesteśmy zmuszeni do użycia parametru <c>idle-poll</c>,
powinniśmy skontaktować się z producentem płyty głównej lub dostawcą BIOS-u, aby
uzyskać informacje o rozwiązaniu problemu #93 z erraty CPU.
</p>

<p>
Aby uzyskać więcej informacji na ten temat, warto odwiedzić archiwa list
mailingowych:
</p>

<ul>
  <li><uri>http://lists.suse.com/archive/suse-amd64/2003-Dec/0031.html</uri></li>
  <li><uri>http://lists.suse.com/archive/suse-amd64/2003-Dec/0034.html</uri></li>
</ul>

<p>
Widać na ich podstawie, że nie jest to problem specyficzny dla Gentoo.
</p>

</body>
</section>
<section>
<title>Obsługa systemów plików</title>
<body>

<p>
Mocno rekomendowane jest korzystanie z systemów plików ext2 i ext3. Pojawiają
się raporty o problemach z systemami plików reiserfs i JFS na 64-bitowych
komputerach (co w przypadku tego drugiego określić należy jako dziwne, ponieważ
ten system plików został zaprojektowany z myślą o systemach 64-bitowych).
</p>

<table>
<tr>
  <th>System plików:</th>
  <th>Status:</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti>STABILNY</ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti>STABILNY</ti>
</tr>
<tr>
  <ti>XFS</ti>
  <ti>STABILNY, >=gentoo-sources-2.6.3</ti>
</tr>
<tr>
  <ti>JFS</ti>
  <ti>STABILNY, >=gentoo-sources-2.6.7</ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti>STABILNY, >=gentoo-sources-2.6.5</ti>
</tr>
<tr>
  <ti>reiser4</ti>
  <ti>NIE DZIAŁA NA AMD64, NIE JEST WSPIERANY NA ŻADNEJ ARCHITEKTURZE!</ti>
</tr>
</table>

<p>
Prosimy o zgłaszanie wszelkich problemów z systemami plików na stronie <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>.
</p>

</body>
</section>
<section>
<title>Bootloader: kompilowanie programu grub</title>
<body>

<p>
Instalacja programu grub nie jest możliwa w czystym 64-bitowym środowisku. Można
go skompilować jedynie przy użyciu gcc z obsługą multilib. Gentoo 2004.3
domyślnie dołącza obsługę multilib. Jeśli zdecydujemy się na usunięcie z gcc
obsługi tego komponentu, konieczne będzie użycie programu <c>grub-static</c>
zamiast gruba. <c>grub-static</c> instalujemy przy użyciu komend:
</p>

<pre caption="Instalacja grub-static">
# <i>emerge grub-static</i>
# <i>cp -Rpv /usr/share/grub/i386-pc/* /boot/grub</i>
</pre>

</body>
</section>
<section>
<title>Dłuższe maskowanie niektórych pakietów dla AMD64</title>
<body>

<p>
Pewne pakiety, które zostały odmaskowane dla innych architektur, są wciąż
zamaskowane dla AMD64. Nie oznacza to oczywiście, że pakiety te nie działają.
Oznacza to jedynie, że żaden z developerów Gentoo nie mógł przetestować ich na
komputerze AMD64. Prosimy w związku z tym o testowanie zamaskowanych aplikacji i 
<uri link="http://bugs.gentoo.org">zgłaszanie raportów o błędach</uri>, aby
poinformować developorów czy pakiety działają poprawnie, czy też nie.
</p>

</body>
</section>
<section>
<title>Niedziałające pakiety</title>
<body>

<p>
Aktualnie niedziałające pakiety: 
</p>

<ul>
  <li>Firebird (baza danych, NIE przeglądarka)</li>
</ul>

<p>
Pakiety, które nie działają z trybie 64-bitowym, ale działają w trybie 32-bitowym
(po instalacji app-emulation/emul-linux-x86-baselibs i pokrewnych):
</p>

<ul>
  <li>
    Wszystkie programy, które korzystają z 32-bitowych plików dll z Windows
    (np. obsługa własnych formatów w mplayer/xine)
  </li>
  <li>Wszystkie programy, które wymagają obsługi 32-bitowej</li>
</ul>

</body>
</section>
<section>
<title>Obsługa Javy</title>
<body>

<p>
Blackdown wypuścił własną 64-bitową wersję Javy dla Linuksa na komputerach
AMD64. Jest to warunkowo opublikowana edycja, więc nie należy oczekiwać, że
będzie ona działać doskonale. W drzewie portage występuje ona jako
<path>blackdown-jdk-1.4.2</path> i <path>blackdown-jre-1.4.2</path>.
</p>

<p>
Niektórzy użytkownicy zauważyli, że 64-bitowa Java VM jest wolniejsza od jej
32-bitowego odpowiednika. Juergen Kreileder z Blackdown udzielił następujących
informacji na ten temat:
</p>

<pre caption="Juergen Kreileder o różnicach w prędkości działania Javy w wersjach 64- i 32-bitowych">
Obecnie 64-bitowa Java VM jest szysza od 32-bitowego odpowiednika w niemal
wszystkich testach.

Różnica zauważana przez użytkowników jest raczej efektem użycia różnych typów
Javy VM. Wersja dla i386 obejmuje Javę HotSpot Client VM i HotSpot
Server VM, przy czym domyślnie zostaje wykorzystany Client VM. Wersja dla
AMD64 zawiera wyłącznie Javę Server VM, gdyż Client VM nie został jeszcze
przygotowany.

Ogólnie rzecz biorąc Server VM jest szybszym typem. Jego kompilator
wykonuje bardziej szczegółową optymalizację i jest bardziej agresywny niż
kompilator Client VM. Dzięki temu zazwyczaj generuje on znacznie lepszy
kod. Wadą jest natomist to, że tak szczegółowa optymalizacja obciąża procesor w
większym stopniu. W związku z tym, kod GUI jest w Client VM zazwyczaj
przetwarzany szybciej (przynajmniej początkowo) niż na Server VM.

Innymi słowy: porównywanie Javy Client VM dla i386 z Javą Server VM dla AMD64
nie da wymiernych rezultatów. Należałoby raczej porównać Server VM dla i386
(np.: "java -server ...") z Server VM dla AMD64.
</pre>

<p>
Juergen Kreileder odpowiedział również na pytanie o potencjalny czas ukończenie
Javy Client VM dla AMD64:
</p>

<pre caption="Juergen Kreileder o Java Client VM dla AMD64">
Nie znajdzie się on w finalnej wersji 1.4.2. Nie jest on również przewidywany
dla wersji 1.5.0. Firma Sun jest zadowolona z Javy Server VM i tak naprawdę nie
jest zainteresowana wdrożeniem Javy Client VM (dla innych 64-bitowych
komputerów, jak IA64 &amp; SPARC64, również dostępna jest tylko Java Server VM).
Wprowadzenie wersji Client VM zajełoby zbyt dużo czasu, aby robić to bez zapłaty.
</pre>

<p>
Tak więc, aby wyniki porównania były wymierne, konieczne jest przetestowanie na
obu architekturach wersji Server, a wersji Client dla AMD64 nie należy
spodziewać się zbyt szybko. ;-)
</p>
<p>

Gdy java zostanie zainstalowana, wymagane jest stworzenie następującego
dowiązania symbolicznego, aby pracowała ona z mozillą (prawdopodobnie z tego
dowiązania korzysta też konqueor):
</p>

<pre caption="Dowiązanie symboliczne dla współpracy javy z mozillą">
/usr/lib/nsbrowser/plugins/libjavaplugin_oji.so -> /opt/blackdown-jdk-1.4.2_rc1/jre/plugin/amd64/mozilla/libjavaplugin_oji.so
</pre>

</body>
</section>
<section>
<title>Instalacja programu OpenOffice</title>
<body>

<p>
OpenOffice dla AMD64 jest obecnie dostępny jedynie w 32-bitowej binarnej formie,
gdyż wersje 1.1.x nie mogą zostać skompilowane na komputerach AMD64. Aby
zainstalować OpenOffice należy zemergować pakiet
<path>app-office/openoffice-bin</path>.
</p>

<note>
Nie warto nawet zastanawiać się nad instalacją OpenOffice ze źródeł. Będą to
daremne wysiłki, które zaowocują jedynie wieloma nieprzespanymi nocami.
</note>

</body>
</section>
<section>
<title>Prawidłowe ustawienia CFLAGS</title>
<body>

<p>
W przeciwieństwie do gcc 3.3, gcc 3.4 wymaga ustawienia parametru -march.
Najbardziej tradycyjne (i najlepiej wspierane) ustawienia CFLAGS to:
</p>

<pre caption="CFLAGS dla AMD64 i gcc 3.4">
...
CFLAGS="-march=k8 -O2 -pipe"
...
</pre>

<note>
<c>-march=k8</c> oznacza to samo co <c>-march=athlon64</c> oraz
<c>-march=opteron</c>.
</note>

<p>
Pojawiały się pakiety, które powodowały zgłaszanie braku <c>-fPIC</c> w czasie
tworzenia współdzielonych obiektów. Wyjaśnienie problemu znajduje się w
poniższym poście z jednej z list mailingowych: <uri
link="http://www.x86-64.org/lists/discuss/msg02621.html">Porting to Hammer</uri>
- paragraf zatutyłowany "Shared libraries must be compiled with -fPIC".
W przypadku natrafienia na programy, które zgłaszają w czasie działania brak
<c>-fPIC</c>, prosimy o natychmiastowe powiadomienie nas - będzie aktualizować
takie aplikacje. Nie należy dodawać <c>-fPIC</c> do globalnych flag CFLAGS,
ponieważ nie jest to godne zaakceptowania rozwiązanie problemu, a jedynie jego
obejście.
</p>

<p>
Nie należy dodawać <c>-m32</c> do flag USE, jeśli nie chcemy kompilować systemu
w trybie 32-bitowym. Domyślnie Gentoo dla AMD64 nie obsługuje kompilowania
32-bitowych programów. Używanie fagi <c>-m64</c> nie jest konieczne, ani nawet
wskazane, ponieważ kompilator domyślnie używa trybu 64-bitowego i mogłoby to
negatywnie wpłynąć na kompilację i działanie programów, które wewnętrznie dodają
flagę <c>-m32</c>, w celu 32-bitowej instalacji (jak na przykład nowsze wersje
gruba).
</p>

<warn>
Nie należy używać flagi <c>-Os</c>. Uniemożliwia ona kompilację pewnych
elementów KDE 3.2.0.
</warn>

</body>
</section>
<section>
<title>Ignorowane flagi USE</title>
<body>

<p>
Flagi USE <c>mmx</c>, <c>3dnow</c>, <c>sse</c> i <c>sse2</c> są ignorowane na
AMD64 od czasu, gdy wszystkie procesory tego typu będą obsługiwały zestawy
instrukcji determinowane przez te flagi. Są one ignorowane, ponieważ umożliwiają
niepożądaną 32-bitową optymalizację niektórych programów.
</p>

</body>
</section>
<section>
<title>Raportowanie błędów i proponowanie łatek</title>
<body>

<p>
Jeżeli istnieją łatki dla aplikacji, z którymi występują problemy lub jakiś
program może zostać oznaczony w drzewie portage jako poprawnie działający,
prosimy o zgłoszenie raportu na stronie <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>.
</p>

<note>
Można także wysłać e-maila na adres: <mail
link="amd64@gentoo.org">amd64@gentoo.org</mail>.  </note>

<note>
Aby zaproponować łatkę, należy najpierw zgłosić raport o błędzie, a następnie
przejść do nowoutworzonego raportu i wybrać link "Create a new
attachment".
</note>

</body>
</section>
</sections>
