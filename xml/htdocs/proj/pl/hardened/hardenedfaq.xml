<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/pl/hardened/hardenedfaq.xml,v 1.3 2005/10/17 14:06:47 rane Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- Orig revision: 1.7 -->
<!-- Translator: Paweł Kwiatkowski <yarel@o2.pl> -->
<!-- Status: Finished -->

<!-- $Id: hardenedfaq.xml,v 1.3 2005/10/17 14:06:47 rane Exp $ -->

<guide link = "/proj/pl/hardened/hardenedfaq.xml" lang="pl">
<title>Gentoo Hardened - często zadawane pytania</title>
<author title="Autor">
  <mail link="tocharian@gentoo.org">Adam Mondl</mail>
</author>
<author title="Współpracownik">
  <mail link="solar@gentoo.org">solar</mail>
</author>
<author title="Współpracownik">
  <mail link="kang@gentoo.org">Guillaume Destuynder</mail>
</author>
<author title="Współpracownik">
  <mail link="pageexec@freemail.hu">The PaX Team</mail>
</author>
<author title="Tłumaczenie">
  <mail link="yarel@o2.pl">Paweł Kwiatkowski</mail>
</author>

<abstract>
Ten dokument to zbiór pytań i odpowiedzi jakie pojawiają się na kanale IRC
#gentoo-hardened oraz na naszej liście dyskusyjnej.
</abstract>

<version>1.8</version>
<date>2005-10-10</date>

<chapter>
<title>Pytania</title>
<section>
<title>Ogólne</title>
<body>

<ul>
  <li>
    <uri link="#toolchain">Co to jest "toolchain"?</uri>
  </li>
  <li>
    <uri link="#whichisbetter">Z czego korzystać: RSBAC, SELinux czy
    Grsecurity?</uri>
  </li>
  <li>
    <uri link="#aclall">Czy jest możliwe jednoczesne korzystanie z Grsecurity,
    SELinux oraz PaX?</uri>
  </li>
  <li>
    <uri link="#libbitmap">W jaki sposób pozbyć się komunikatu "Symbol __guard
    from module /usr/X11R6/lib/modules/fonts/ libbitmap.a is unresolved!"</uri>
  </li>
  <li>
    <uri link="#hardenedcflags">Czy należy przekazywać jakieś flagi do
    LDFLAGS/CFLAGS, aby włączyć kompilację z PIE/SSP?</uri>
  </li>
  <li>
    <uri link="#hardenedcflagsoff">Jak wyłączyć kompilację z PIE/SSP?</uri>
  </li>
  <li>
    <uri link="#fsexec">Proces budowy kernela zostaje przerwany i pojawia się
    błąd "error: structure has no member named `curr_ip'", jak to naprawić?
    </uri>
  </li>
  <li>
    <uri link="#hardenedproject">Dopiero poznaję Gentoo Hardened. Czy
    muszę zainstalować wszystko co zostało wymienione na stronie projektu, by
    mieć Gentoo w wersji hardened?</uri>
  </li>
  <li>
    <uri link="#Othreessp">Dlaczego programy nie działają jeśli korzysta się z
    CFLAGS="-O3" i gcc hardened?</uri>
  </li>
  <li>
    <uri link="#cascadebootstrap">Co się stało z bootstrap-cascade.sh?</uri>
  </li>
  <li>
    <uri link="#hardenedprofile">Jak przełączyć się na profil hardened?</uri>
  </li>
  <li>
    <uri link="#hardeneddebug">W jaki sposób debugować z gdb?</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>PaX</title>
<body>

<ul>
  <li>
    <uri link="#paxinformation">Jaki jest adres strony domowej PaX?</uri>
  </li>
  <li>
    <uri link="#paxgentoodoc">Czy istnieje jakaś dokumentacja Gentoo dotycząca
    PaX?</uri>
  </li>
  <li>
    <uri link="#paxnoelf">Bez przerwy pojawia się komunikat: "error while
    loading shared libraries: cannot make segment writable for relocation:
    Permission denied". Co to oznacza?</uri>
  </li>
  <li>
    <uri link="#paxjava">Dlaczego Java nie działa z PaX?</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>Grsecurity</title>
<body>

<ul>
  <li>
    <uri link="#grsecinformation">Jaki jest adres strony domowej Grsecurity?</uri>
  </li>
  <li>
    <uri link="#grsecgentoodoc">Czy istnieje jakaś dokumentacja Gentoo dotycząca
    Grsecurity?</uri>
  </li>
  <li>
    <uri link="#grsec2681">Czy można używać Grsecurity z kernelami 2.6.8,
    2.6.8.1 albo 2.6.9?</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>RSBAC</title>
<body>

<ul>
  <li>
    <uri link="#rsbacinformation">Jaki jest adres strony domowej RSBAC?</uri>
  </li>
  <li>
    <uri link="#rsbacgentoodoc">Czy istnieje jakaś dokumentacja Gentoo dotycząca
    RSBAC?</uri>
  </li>
  <li>
    <uri link="#rsbacinitrd">Jak można korzystać ze startowego dysku RAM, gdy
    posiadamy kernel z włączonym RSBAC?</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>SELinux</title>
<body>

<ul>
  <li>
    <uri link="#selinuxfaq">Gdzie można znaleźć listę odpowiedzi na często
    zadawane pytania dotyczące SELinux?</uri>
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Pytania ogólne</title>
<section id="toolchain">
<title>Co to jest "toolchain"?</title>
<body>

<p>
Termin "toolchain" odnosi się do zbioru pakietów oprogramowania, które jest
wykorzystywane do rozwijania i budowania aplikacji na konkretną architekturę
sprzętową. "Toolchain" o którym można usłyszeć na kanale IRC #gnetoo-hardened,
składa się z GNU Compiler Collection (GCC), pakietu binutils oraz biblioteki GNU
C (glibc).
</p>

</body>
</section>
<section id="whichisbetter">
<title>Z czego korzystać: RSBAC, SELinux czy Grsecurity?</title>
<body>

<p>
Odpowiedź na to pytanie jest wysoce subiektywna, gdyż projekt Gentoo Hardened
stara się wskazać różne rozwiązania i wybór pozostawić użytkownikowi. Decyzja
wymaga analizy, którą, mamy nadzieję, ułatwi niniejsza dokumentacja. Jeśli
jednak narastają konkretne pytania dotyczące modelu bezpieczeństwa wprowadzanego
przez każde z rozwiązań, to zachęcamy do skorzystania z listy dyskusyjnej lub do
zadania pytania odpowiedniemu deweloperowi.
</p>

</body>
</section>
<section id="aclall">
<title>Czy jest możliwe jednoczesne korzystanie z Grsecurity, SELinux oraz PaX?</title>
<body>

<p>
Tak, taka kombinacja jest możliwa gdyż PaX pracuje zarówno z Grsecurity jak i
SELinux. Jedyny konflikt jaki może mieć miejsce ma swoje źródło w tym, że możemy
korzystać tylko z jednego systemu kontroli dostępu.
</p>

</body>
</section>
<section id="hardenedcflags">
<title>
Czy należy przekazywać jakieś flagi do LDFLAGS/CFLAGS, aby włączyć kompilację z
PIE/SSP?
</title>
<body>

<p>
Nie, gdyż obecny "toolchain" automatycznie dostarcza odpowiednik
CFLAGS="-fPIE -fstack-protector-all" LDFLAGS="-Wl,-z,now -Wl,-z,relro", poprzez
pliki specyfikacji GCC (ang. specfile). Jest to lepsze rozwiązanie niż flagi.
Użytkownicy starszej wersji hardened-gcc dodają <c>USE="hardened"</c> do
pliku <path>/etc/make.conf</path>, a następnie wykonują upgrade poleceniami:
</p>

<pre caption="Instalacja toolchain w wersji hardened">
# <i>emerge binutils gcc glibc</i>
# <i>emerge -e world</i>
</pre>

<note>
Do wszystkich gałęzi ~arch została dodana poprawka dla GCC, która umożliwia
przekazanie pliku specyfikacji przez zmienną środowiskową. W przyszłości na
systemach z Gentoo będzie instalowany zestaw dwóch plików specyfikacji tak, aby
na wspieranych architekturach, użytkownicy mogli w prosty sposób włączać i
wyłączać funkcjonalność. Prawidłowe wykorzystanie zmiennej jest pokazane
poniżej:
</note>

<pre caption="Przykład użycia GCC_SPECS">
# <i>GCC_SPECS=/path/to/specs gcc -v</i>
</pre>

</body>
</section>
<section id="hardenedcflagsoff">
<title>Jak wyłączyć kompilację z PIE/SSP?</title>
<body>

<p>
Standardową opcję SSP dla budowania binariów można wyłączyć przez dodanie
<c>-fno-stack-protector-all -fno-stack-protector</c> do zmiennej <c>CFLAGS</c>.
</p>

<p>
Jeśli chcemy wyłączyć domyślną opcję PIE, to dodajemy <c>-nopie</c> do
naszej zmiennej <c>CFLAGS</c>.
</p>

<impo>
Flaga <c>-fno-pic</c> nie powinna być używana, gdyż spowoduje to
wygenerowanie kodu non-PIC ([przyp. tłum.] opcja <c>-fpic</c> generuje kod
niezależny od pozycji, tzn. wszystkie statyczne adresy w obrębie kodu są
otrzymywane z tzw. globalnej tablicy wskaźników. Ustawienie <c>-fno-pic</c>
powoduje, że globalna tablica wskaźników nie jest wykorzystywana). Powrót do
standardowego zachowania GCC uzyskujemy przez <c>-nopie</c>, co powinno
przynieść zamierzony skutek.
</impo>

<note>
Jeśli dla każdego pakietu w obecnym Portage chcemy korzystać z osobnych ustawień
CFLAGS, to warto zapoznać się ze skryptem, przygotowanym przez solara, który
sobie z tym radzi:
<uri>http://article.gmane.org/gmane.linux.gentoo.hardened/1204</uri>
</note>

</body>
</section>
<section id="fsexec">
<title>
Proces budowy kernela zostaje przerwany i pojawia się błąd "error:
structure has no member named `curr_ip'", jak to naprawić?
</title>
<body>

<p>
Aby móc korzystać z PaX w pakiecie hardened-sources, musimy włączyć obsługę
Grsecurity w kernelu. W przyszłej wersji powinno to zostać naprawione.
</p>

</body>
</section>
<section id="hardenedproject">
<title>
Dopiero poznaję Gentoo Hardened. Czy muszę zainstalować wszystko co zostało
wymienione na stronie projektu, by mieć Gentoo w wersji hardened?
</title>
<body>

<p>
Nie. Gentoo Harened jest zbiorem pod-projektów, które mają wspólne założenia
odnośnie bezpieczeństwa. Wiele z nich może być zainstalowana wspólnie z innymi.
Niektóre powodują konflikty, jak np. kilka implementacji list kontroli dostępu
(ACL) oferowanych przez projekt Gentoo Hardened.
</p>

</body>
</section>
<section id="Othreessp">
<title>Dlaczego programy nie działają jeśli korzysta się z CFLAGS="-O3" i gcc hardened?</title>
<body>

<p>
W niektórych sytuacjach równoczesne używanie flagi "-O3" i SSP (ang.
stack-smashing protector) jest problematyczne. Flaga "-O3" nie jest oficjalnie
wspierana i dlatego odradzana przez zespół projektu Hardened. Zgłoszenia
problemów, w których użytkownik korzysta z ustawień <c>CFLAGS="-O3"</c>, będą
zamykane ze statusem INVALID/CANTFIX i/lub ignorowane.
</p>

</body>
</section>
<section id="cascadebootstrap">
<title>Co się stało z bootstrap-cascade.sh?</title>
<body>

<p>
Ostatnio stare wersje bootstrap.sh i bootstrap-2.6.sh stały się przestarzałe i
zastąpione przez bootstrap-cascade.sh, który zmienił nazwę na bootstrap.sh
</p>

</body>
</section>
<section id="hardenedprofile">
<title>Jak przełączyć się na profil hardened?</title>
<body>

<pre caption="Ustawiamy make.profile">
# <i>cd /etc</i>
# <i>rm make.profile</i>
# <i>ln -s ../usr/portage/profiles/hardened/x86 make.profile</i>
</pre>

<p>
Po zmianie profilu należy zrekompilować system korzystając z toolchain w wersji
hardened, tak by mieć spójne podstawy:
</p>

<pre caption="Przełączenie na toolchain w wersji hardened">
# <i>emerge binutils gcc glibc</i>
# <i>emerge -e world</i>
</pre>

</body>
</section>

<section id="hardeneddebug">
<title>Jak należy debugować z gdb?</title>
<body>

<p>
Pierwszy kruczkiem jest fakt, że GDB nie jest w stanie rozwiązać symboli w PIE.
Nie wie, że adresy w PIE są względne, a nie bezwzględne. Celem tego jest
pokazanie sytuacji kiedy staramy się prześledzić przykład i widzimy ciąg linii 
ze znakami '??' gdzie powinien znajdować się symbol.
</p>

<p>
Aby tego dokonać należy ostatni etap dowiązywania przeprowadzić z opcją '-nopie'.
Wszystkie poprzednie kompilacje obiektowe mogą być przeprowadzane tak jak
zawsze z opcją '-fPIE' (jest to domyślny sposób w przypadku kompilatora
hardenend) tak, aby plik wykonywalny był jaknajbardziej bliski prawdziwemu
obiektowi, jednak ostatnie dowiązanie musi stworzyć regularny plik wykonywalny.
Flagę <c>-nopie</c> można dodać do zmiennej <c>LDFLAGS</c> jeżeli budujemy
pakiety przy pomocy emerge.
</p>

<p>
Trzecią pułapką jest możliwość uniemożliwienia przez PaX ustawienia punktów
kontrolnych, zależnie od tego jak jest skonfigurowane jądro. Zawiera to głównie
punkt kontrolny, którego potrzebujemy, aby cokolwiek rozpocząć. Aby zapobiec
temu typu działaniom PaX-a, plik wykonywalny, który poddajemy debugowaniu musi
posiadać flagi 'm' i 'x'. Flaga 'x' ustawiania jest domyślnie, więc wystarczy
wydać jedynie poniższe polecenia:
</p>

<pre caption="Ustawianie PaX-a do debugowania">
# <i>/sbin/paxtcl -m foo</i>
</pre>

<p>
W tym momencie powinniśmy mieć wszystko ustawione i gotowe do pracy. Należy
uruchomić gdb w normlany sposób. Powodzenia!
</p>

</body>
</section>
</chapter>

<chapter>
<title>Pytania dotyczące PaX</title>
<section id="paxinformation">
<title>Jaki jest adres strony domowej PaX?</title>
<body>

<p>
Strona domowa PaX znajduje się pod adresem <uri>http://pax.grsecurity.net</uri>.
</p>

</body>
</section>
<section id="paxgentoodoc">
<title>Czy istnieje jakaś dokumentacja Gentoo dotycząca PaX?</title>
<body>

<p>
Obecnie jedyną dokumentacją w Gentoo dotyczącą PaX jest krótki przewodnik po
PaX, dostępny na stronie
<uri>http://www.gentoo.org/proj/pl/hardened/pax-quickstart.xml</uri>.
</p>

</body>
</section>
<section id="paxnoelf">
<title>
Bez przerwy pojawia się komunikat: "error while loading shared libraries: cannot
make segment writable for relocation: Permission denied". Co to oznacza?
</title>
<body>

<p>
Informacja o błędzie pojawia się wtedy, gdy włączymy CONFIG_PAX_NOELFRELOCS w
następujący sposób:
</p>

<pre caption="Opcje w menuconfig">
Non-executable page ->

 [*]   Disallow ELF text relocations
</pre>

<p>
Jeśli korzystamy z "toolchain" w wersji hardened, to zazwyczaj podczas
kompilacji powstaną biblioteki ELF z opcją PIC, nie zawierające relokacji sekcji
text ([przyp. tłum.] text jest jedną z sekcji pliku binarnego ELF). Jednakże z
różnych powodów, niektóre biblioteki nadal zawierają relokacje tej sekcji (są to
najczęściej te, które zawierają nieprawidłowo obsługiwane fragmenty). Może to
stanowić lukę w zabezpieczeniach, gdyż potencjalny agresor może wykorzystać
biblioteki skompilowane z opcją non-PIC do wykonania swojego shellcode.
Biblioteki z opcją non-PIC mają także niepożądany wpływ na zużycie pamięci, jako
że podważają sens istnienia bibliotek współdzielonych.
</p>

<p>
Możemy pozbyć się tego błędu i pozwolić by program działał, lecz musimy
poświęcić bezpieczeństwo pozwalając na generowanie kodu w trakcie działania
programu. Opcja PaX, która to umożliwia nazywa się MPROTECT. Należy wyłączyć
MPROTECT dla każdego pliku wykonywalnego, który korzysta z bibliotek
skompilowanych z non-PIC.
</p>

<note>
Do sprawdzenia systemu pod kątem istnienia plików z relokacją sekcji text, można
użyć programu check-textrel, który został napisany przez solara i umieszczony na
stronie <uri>http://dev.gentoo.org/~solar/pax/misc/check-textrel</uri>.
</note>

</body>
</section>
<section id="paxjava">
<title>Dlaczego Java nie działa z PaX?</title>
<body>

<p>
Wirtualna maszyna Javy przy każdym uruchomieniu generuje znaczną ilość kodu, co
nie wpływa na PaX zbyt dobrze. Istnieją dwa rozwiązania problemu:
</p>

<pre caption="Instalacja chpax">
# <i>emerge chpax</i>
# <i>/etc/init.d/chpax start</i>
</pre>

<p>
Jeśli już posiadamy program chpax, możemy wykonać:
</p>

<pre caption="Opcja chpax dla java">
# <i>chpax -pemrxs /opt/*-jdk-*/{jre,}/bin/*</i>
</pre>

<p>
Obydwie opcje lekko modyfikują nagłówek ELF, tak by było możliwe ustawienia flag
PAX na binariach.
</p>

<note>
Jeśli używamy PaX w połączeniu z dodatkowymi mechanizmami bezpieczeństwa, takimi
jak RSBAC, Grsecurity lub SELinux, to powinniśmy zarzdzać PaXem przy użyciu
doczepień do funkcji kernela (ang. kernel hook), dostarczonymi z każdą
implementacją.
</note>

<p>
Przy włączonym RSBAC można, poniższą komendą, poetykietować wszystkie pliki
Javy.
</p>

<pre caption="Opcje PaX dla Javy, przy włączonym RSBAC">
# <i>for i in $(ls /opt/*(jdk|sdk)*/{jre,}/bin/*);do attr_set_file_dir FILE $i pax_flags pmerxs;done</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Pytania dotyczące Grsecurity</title>
<section id="grsecinformation">
<title>Jaki jest adres strony domowej Grsecurity?</title>
<body>

<p>
Strona domowa Grsecurity znajduje się pod adresem
<uri>http://www.grsecurity.net</uri>.
</p>

</body>
</section>
<section id="grsecgentoodoc">
<title>Czy istnieje jakaś dokumentacja Gentoo dotycząca Grsecurity?</title>
<body>

<p>
Najnowszą wersją dokumentacji dla Grsecurity jest krótki przewodnik po
Grsecurity2, znajdujący się pod adresem
<uri>http://www.gentoo.org/proj/en/hardened/grsecurity.xml</uri>.
</p>

</body>
</section>
<section id="grsec2681">
<title>Czy można używać Grsecurity z kernelami 2.6.8, 2.6.8.1 albo 2.6.9?</title>
<body>

<p>
W związku ze znacznymi zmianami w kernelu 2.6.8, które popsuły obsługę PaX,
poprawki PaX i Grsecurity dla wersji 2.6.8, 2.6.8.1 i 2.6.9 nie są dostępne.
Mimo istnienia eksperymentalnej poprawki na kernel 2.6.10, przed jej użyciem
należy zapoznać się z oficjalnym stanowiskiem (odnośnie 2.6) zespołu tworzącego
PaX: <uri>http://forums.grsecurity.net./viewtopic.php?t=968</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Pytania dotyczące RSBAC</title>
<section id="rsbacinformation">
<title>Jaki jest adres strony domowej RSBAC?</title>
<body>

<p>
Strona domowa RSBAC znajduje się pod adresem <uri>http://www.rsbac.org</uri>.
</p>

</body>
</section>
<section id="rsbacgentoodoc">
<title>Czy istnieje jakaś dokumentacja Gentoo, dotycząca RSBAC?</title>
<body>

<p>
Cała dokumentacja Gentoo dotycząca RSBAC znajduje się na stronie podprojektu
RSBAC, dostępnej pod adresem:
<uri>http://www.gentoo.org/proj/en/hardened/rsbac/index.xml</uri>
</p>

<p>
Poza tym, nie znajdziemy żadnej dokumentacji Gentoo RSBAC w podręczniku RSBAC,
znajdującym się pod adresem
<uri>http://www.rsbac.org/documentation/rsbac_handbook</uri>.
</p>

</body>
</section>
<section id="rsbacinitrd">
<title>
Jak można korzystać ze startowego dysku RAM, gdy posiadamy kernel
z włączonym RSBAC?
</title>
<body>

<p>
W kernelach z włączonym RSBAC, by używać startowego dysku RAM należy zaznaczyć
specjalną opcję, która zapobiegnie potraktowaniu initrd jak głównego urządzenia
([ang.] root device).
</p>

<pre caption="Opcje w menuconfig">
General RSBAC options  --->
    [*] Delayed init for initial ramdisk
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Pytania dotyczące SELinux</title>
<section id="selinuxfaq">
<title>
Gdzie można znaleźć listę odpowiedzi na często zadawane pytania dotyczące
SELinux?
</title>
<body>

<p>
Odpowaiedzi na często zadawane pytania dotyczące SELinux można znaleźć w <uri
link="/proj/en/hardened/selinux/selinux-x86-handbook.xml?part=4&amp;chap=3">Podręczniku
SELinux</uri>.
</p>

</body>
</section>
</chapter>

</guide>
