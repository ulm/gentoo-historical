<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/fr/desktop/x/x11/modular-x-howto.xml,v 1.2 2006/01/26 17:50:53 neysx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/proj/fr/desktop/x/x11/modular-x-howto.xml" lang="fr">
<title>Guide de migration vers X.Org modulaire</title>

<author title="Auteur">
  <mail link="spyderous@gentoo.org">Donnie Berkholz</mail>
</author>
<author title="Auteur">
  <mail link="joshuabaergen@gentoo.org">Joshua Baergen</mail>
</author>
<author title="Traducteur">
  <mail link="koppatroopa@yahoo.fr">Bertrand Coppa</mail>
</author>

<abstract>
Ce guide vous explique comment migrer vers la version modulaire de X.Org.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.16</version>
<date>2006-01-02</date>

<chapter>
<title>Introduction</title>

<section>
<title>Pourquoi une version modulaire&nbsp;?</title>
<body>

<p>
Vous vous demandez sûrement pourquoi changer un simple et unique paquet
xorg-x11 en environ 300 paquets séparés. Cela est justifié.  Ce n'est pas
Gentoo qui a fait ce choix indépendamment du projet X.Org&nbsp;; ce sont leurs
développeurs qui ont décidé de séparer tous ces paquets, et nous ne faisons que
suivre.
</p>

<p>
Les trois principales raisons de cette division et de ce changement dans le
système de compilation sont&nbsp;:
</p>

<ul>
  <li>
    Il est trop difficile pour les nouveaux développeurs de se plonger dans X,
    d'où la migration vers autotools, un système avec lequel beaucoup se
    sentent à l'aise, si ce n'est heureux.
  </li>
  <li>
    Autotools permet la séparation des sources, aussi le système devient plus
    abordable pour les développeurs.
  </li>
  <li>
    Les choses ont été par le passé, sans que cela soit nécessaire, liées les
    unes aux autres et cela a rendu la publication de correctifs de bogue
    souvent impossible. Si les développeurs arrivaient à publier un correctif,
    il fallait à chaque fois recompiler entièrement X.Org. Par exemple, pour un
    bogue dans les pilotes Ati, il vous fallait soit attendre 6 mois pour la
    version suivante, soit aussi recompiler vos fontes de caractères pour le
    corriger, sans aucune raison.
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Migration vers X modulaire</title>

<section>
<title>Introduction</title>
<body>

<p>
Pour empêcher les vieux paquets de perturber l'opération, nous allons nettoyer
complètement l'ancien xorg-x11 avant d'installer X modulaire. Ce n'est pas
absolument crucial, mais cela aidera à assurer une migration sans accroc.
</p>

</body>
</section>
<section>
<title>Première étape&nbsp;: nettoyage de l'ancien X</title>
<body>
    
<pre caption="Sauvegarder l'ancien xorg-x11">
# <i>emerge gentoolkit</i>
# <i>quickpkg xorg-x11</i>
</pre>

<p>
Se débarasser de l'installation monolithique&nbsp;:
</p>

<pre caption="Désinstallation de la version monolithique">
# <i>emerge -Ca xorg-x11 virtual/x11</i>
# <i>rm -rf /usr/lib/opengl/xorg-x11</i>
# <i>rm -rf /usr/lib/libGL*</i>
</pre>

<p>
Il est fortement conseillé de faire une sauvegarde du xorg-x11 monolithique au
cas où les choses se passeraient vraiment très mal.
</p>

<p>
Les dernières opérations sont nécessaires pour être certain de se débarasser
des liens symboliques créés par <c>opengl-update</c>.
</p>

<p>
Si <path>/usr/X11R6</path> n'est pas un lien symbolique vers <path>/usr</path>,
effacez-le et partez de zéro. Mais d'abord, établissez une liste de tous les
paquets s'installant dans ce répertoire.
</p>

<pre caption="Établir la liste des paquets">
# <i>if [[ ! -L /usr/X11R6 ]]; \
    then equery belongs /usr/X11R6 > usr-x11r6-packages \
    &amp;&amp; rm -rf /usr/X11R6; fi</i>
</pre>

</body>
</section>
<section>
<title>Seconde étape&nbsp;: installer le X modulaire</title>
<body>
    
<p>
D'abord, ajoutez les paquets nécessaires dans le fichier
<path>/etc/portage/package.unmask</path>. Ouvrez
<path>/usr/portage/profiles/package.mask</path> avec l'éditeur de texte de
votre choix et faites un copier-coller de la liste complète des fichiers
masqués pour X modulaire dans <path>package.unmask</path>. Faites de même pour
<path>/etc/portage/package.keywords</path> si vous êtes dans la branche stable.
Si tout ceci vous est incompréhensible, lisez <uri
link="/doc/fr/handbook/handbook-x86.xml?part=3&amp;chap=3"> la section
concernant le masquage du manuel.</uri>.
</p>

<p>
Pour avoir accès au «&nbsp;direct rendering&nbsp;», ajoutez l'option <c>dri</c>
à la variable USE.
</p>

<p>
Maintenant, installez le méta-paquet. Cela installera le serveur et les
applications usuelles, vous donnant accès à une implémentation fonctionnelle de
X.
</p>

<pre caption="Installer le méta-paquet modulaire">
# <i>emerge xorg-x11</i>
</pre>

<p>
Remarquez que cette installation est plutôt minimaliste, donc les choses comme
xcursor-themes ne seront pas installées par défaut.
</p>

<p>
Ensuite, installez quelques pilotes. Cela dépend de votre matériel vidéo et de
vos périphériques d'entrée, donc jetez un œil au répertoire
<path>/usr/portage/x11-drivers/</path>. Voici un exemple&nbsp;:
</p>

<pre caption="Installer quelques pilotes">
# <i>emerge xf86-input-mouse xf86-input-keyboard xf86-video-ati</i>
</pre>

<note>
Une fois la version modulaire installée, certains pilotes externes comme
nvidia-glx et wacom tout comme certaines applications vnc risquent de ne pas
fonctionner s'ils installent des choses dans <path>/usr/lib/modules</path> au
lieu de <path>/usr/lib/xorg/modules</path>.  Une détection de X modulaire a été
ajoutée au processus d'installation de la plupart d'entre eux, ainsi ils auront
besoin d'être réinstallés après l'installation de X modulaire.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Remarques/problèmes usuels</title>
<section>
<title>'emerge -u world' veut installer xorg-x11 6.x</title>
<body>

<p>
Cela est dû au fait que l'arbre n'est pas encore adapté aux dépendances vers X
modulaire. Vous pouvez aider à la transition en lisant le <uri
link="porting-modular-x-howto.xml">Guide de portage vers X modulaire</uri> et
en remplissant des bogues avec les correctifs pour les mainteneurs des paquets.
Les noms des mainteneurs sont listés dans le fichier <path>metadata.xml</path>
dans le répertoire du paquet. Le paquet <c>herdstat</c> peut vous aider dans
vos recherches.
</p>

</body>
</section>
<section>
<title>Qu'est-il advenu de toutes les options de la variable USE&nbsp;?</title>
<body>

<p>
De nombreuses options USE de la série xorg-x11-6.8 ont disparu ou changé pour
la 7.0.  De nouvelles sont aussi apparues. En voici la description&nbsp;:
</p>

<table>
<tr>
  <th>Variable USE</th>
  <th>Que se passe-t-il avec la 7.0&nbsp;?</th>
</tr>
<tr>
  <ti>3dfx</ti>
  <ti>Dans la 7.0, intègre glide-v3 depuis le méta-paquet xorg-x11</ti>
</tr>
<tr>
  <ti>3dnow, mmx, sse</ti>
  <ti>
    Activées par defaut lors de la compilation, car des contrôles sont
    effectués
  </ti>
</tr>
<tr>
  <ti>bitmap-fonts, truetype-fonts, type1-fonts</ti>
  <ti>
    Le méta-paquet xorg-x11 n'installe qu'une petite sélection des fontes les
    plus utilisées ou nécessaires. Vous pouvez installer en plus toutes celles
    qui se trouvent dans la catégorie media-fonts/.
  </ti>
</tr>
<tr>
  <ti>cjk</ti>
  <ti>
    USE=nls pour font-misc-misc and font-sony-misc permet d'obtenir les fontes
    japonaises JISX0201. D'autres sont disponibles dans font-jis-misc. Les
    fontes chinoises se trouvent dans font-isas-misc.  Les fontes coréennes
    sont dans font-daewoo-misc
  </ti>
</tr>
<tr>
  <ti>dlloader</ti>
  <ti>La 7.0 utilise dlloader par défaut et elfloader ne fonctionne pas</ti>
</tr>
<tr>
  <ti>doc</ti>
  <ti>Remplacé par app-doc/xorg-docs</ti>
</tr>
<tr>
  <ti>dmx</ti>
  <ti>Compilé avec xorg-server sauf avec l'option USE=minimal</ti>
</tr>
<tr>
  <ti>font-server</ti>
  <ti>Il faut installer manuellement xfs</ti>
</tr>
<tr>
  <ti>ipv6</ti>
  <ti>
    Adaptée seulement aux paquets l'utilisant. Réglez-la de manière globale si
    vous la voulez.
  </ti>
</tr>
<tr>
  <ti>minimal</ti>
  <ti>
    Pour obtenir le même effet, installez uniquement xorg-server à la place de
    xorg-x11. L'option minimal pour xorg-server permet de ne pas compiler Xdmx,
    Xvfb et Xnest. Si vous avez besoin de quelque chose d'encore plus minimal,
    orientez-vous vers x11-base/kdrive.
  </ti>
</tr>
<tr>
  <ti>nls</ti>
  <ti>
    Dans la 7.0, USE=nls installe toutes les versions non-ISO8859-1 des
    fontes.
  </ti>
</tr>
<tr>
  <ti>nocxx</ti>
  <ti>Pas encore d'équivalent pour la 7.0</ti>
</tr>
<tr>
  <ti>opengl</ti>
  <ti>
    Changée en «&nbsp;dri&nbsp;» qui active le rendu direct («&nbsp;direct
    rendering&nbsp;») dans xorg-server et de nombreux pilotes. Que USE=dri soit
    activé ou non, vous devriez toujours avoir de la 3D logicielle via Mesa.
  </ti>
</tr>
<tr>
  <ti>pam</ti>
  <ti>
    S'applique uniquement aux paquets qui l'utilisent tels que xorg-server et
    xdm.
  </ti>
</tr>
<tr>
  <ti>sdk</ti>
  <ti>La 7.0 doit installer le SDK à cause de la modularisation.</ti>
</tr>
<tr>
  <ti>static</ti>
  <ti>
    Cela n'a presque aucun sens de vouloir compiler un serveur statique dans un
    monde modulaire, car les pilotes ne peuvent être compilés avec.
  </ti>
</tr>
<tr>
  <ti>xprint</ti>
  <ti>
    Pour le méta-paquet, cela intègre libXp. Pour les autres applications, cela
    intègre le support pour xprint. La plupart des gens n'ont pas besoin de
    cette option.
  </ti>
</tr>
<tr>
  <ti>xv</ti>
  <ti>
    N'est plus une option, car cela n'engendre presque aucun gain de place et
    pose problème avec certains paquets qui s'attendent à ce qu'elle soit
    activée.
  </ti>
</tr>
</table>

</body>
</section>
<section>
<title>Problèmes de pilotes</title>
<body>

<p>
On m'a rapporté que&nbsp;:
</p>

<ul>
  <li>vesa bloque la machine avec les cartes mga</li>
  <li>
    vga donne un affichage très étrange, l'écran étant divisé en quatre.
  </li>
</ul>

</body>
</section>
<section>
<title>Utiliser glxinfo/glxgears</title>
<body>

<p>
Ces programmes sont maintenant fournis par <c>x11-apps/mesa-progs</c>.
<c>mesa-progs</c> est automatiquement installé par <c>x11-base/xorg-x11</c>.
</p>

<p>
Pour obtenir des informations de débogage de la part de glxinfo pour faire
fonctionner le rendu direct&nbsp;:
</p>

<pre caption="Obtenir des informations de débogage par glxinfo">
# <i>LIBGL_DEBUG=verbose glxinfo</i>
</pre>

</body>
</section>
<section>
<title>Auto-détection du protocole de la souris</title>
<body>

<p>
Si vous avez configuré votre souris avec <c>Protocol "auto"</c> dans xorg.conf,
cela risque de ne pas fonctionner. Il vous faudra alors spécifier <c>Protocol
"ExplorerPS/2"</c> ou <c>"IMPS/2"</c> pour que votre molette fonctionne.
</p>

</body>
</section>
<section>
<title>Le contenu de /usr/lib/xorg a disparu&nbsp;!</title>
<body>

<p>
Installez à nouveau &gt;=xorg-server-0.99.1-r4. C'était un bogue temporaire
dans l'ebuild qui avait pour conséquence l'effacement après désinstallation du
paquet. Normalemment, <path>/usr/lib/xorg</path> ne devrait être effacé que
s'il n'y a plus aucun xorg-server sur le système.
</p>

</body>
</section>
<section>
<title>gdm/kdm ne fonctionne pas</title>
<body>

<p>
Si vous avez installé X modulaire sur une nouvelle installation Gentoo, il se
peut que vous n'ayez pas le lien symbolique <path>/usr/X11R6</path> -&gt;
<path>/usr</path>.  Le paquet <c>x11-base/xorg-x11</c> s'assurera que ce lien
existe durant le processus d'installation.
</p>

<p>
Vous pouvez aider à sortir les choses de <path>/usr/X11R6</path> en corrigeant
les paquets qui s'y installent et en remplissant des rapports de bogue.
</p>

</body>
</section>
<section>
<title>Autres problèmes</title>
<body>

<ul>
  <li>
    Le paquet <c>x11-base/xorg-x11</c> filtre maintenant tous les ModulePath et
    RgbPath de votre <path>/etc/X11/xorg.conf</path>, puisque ces deux chemins
    ont changé depuis les versions précédentes. Assurez-vous de lancer
    <c>etc-update</c> pour que ces modifications prennent effet.
  </li>
  <li>
    De nombreuses dispositions de clavier XKB ont été déplacées, consolidées ou
    ont disparu. Regardez le répertoire
    <path>/usr/share/X11/xkb/symbols/pc</path> pour voir ce qu'il est advenu de
    votre ancien paramètre XkbLayout de xorg.conf. Par exemple, pour remplacer
    la disposition "us_intl", vous devriez mettre XkbLayout "latin", XkbOptions
    "lv3:ralt_switch". Pour remplacer la disposition "sk_qwerty", il faut
    mettre XkbLayout "sk", XkbVariant "qwerty". Cas plus compliqué, vous avez
    XkbLayout "us,sk_qwerty". Pour le faire fonctionner, le nouveau paramètre
    serait XkbLayout "us,sk", et l'astuce, c'est la virgule dans XkbVariant
    ",qwerty", parce qu'on veut que la variante s'applique à la seconde
    disposition.
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
