<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/fr/gdp/doc/doc-tipsntricks.xml,v 1.14 2006/05/11 09:14:57 neysx Exp $ -->

<guide link="/proj/fr/gdp/doc/doc-tipsntricks.xml" lang="fr">
<title>Trucs et astuces pour le développement de la documentation</title>

<author title="Auteur">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Correcteur">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Traducteur">
  <mail link="ribosome@gentoo.org">Olivier Fisette</mail>
</author>
<author title="Traducteur">
  <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Quelques trucs et astuces qui faciliteront le travail des auteurs de
documentation Gentoo.
</abstract>

<license/>

<version>0.22</version>
<date>2006-05-11</date>

<chapter>
<title>Paramétrer votre environnement local</title>
<section>
<title>Environnement local pour les contributeurs</title>
<body>

<p>
Créez un répertoire dédié au développement de la documentation. À titre
d'exemple, nous utiliserons <path>~/work/gentoo/doc</path>. Dans ce répertoire,
créez un sous-répertoire dans lequel vous conserverez la documentation (à jour)
en anglais (par exemple, <path>en/</path>).
</p>

<p>
Téléchargez l'archive tar la plus récente de la documentation anglaise&nbsp;:
</p>

<pre caption="Télécharger la documentation anglaise">
$ <i>wget http://www.gentoo.org/dyn/doc-snapshots/docs-latest-en.tar.bz2</i>
</pre>

<p>
Désarchivez la documentation dans le répertoire <path>en/</path>. Vous
disposez maintenant d'un instantané récent de la documentation anglaise.
Chaque fois que vous souhaiterez mettre à jour votre instantané, vous pourrez
télécharger l'archive à nouveau ou alors naviguer dans la documentation et
ajouter <path>?passthru=1</path> à l'URL pour récupérer le fichier. Par
exemple&nbsp;:
</p>

<pre caption="Mettre à jour un document en anglais">
$ <i>wget http://www.gentoo.org/doc/en/alsa-guide.xml?passthru=1 -O alsa-guide.xml</i>
</pre>

<p>
Si vous voulez participer à la traduction de la documentation, créez un
répertoire pour votre langue dans lequel vous garderez les traductions
courantes&nbsp;:
</p>

<pre caption="Télécharger un instantané pour votre langue">
$ <i>LANG=fr</i>
$ <i>mkdir </i><comment>${LANG}</comment>
$ <i>cd </i><comment>${LANG}</comment>
$ <i>wget http://www.gentoo.org/dyn/doc-snapshots/docs-latest-</i><comment>${LANG}</comment><i>.tar.bz2</i>
$ <i>tar xvjf docs-latest-*.tar.bz2</i>
</pre>

<p>
Lorsque vous mettez un document à jour, copiez-le toujours à partir de
<path>${LANG}/</path> vers le répertoire racine
(<path>~/work/gentoo/doc</path>). Ensuite, modifiez cette copie. Vous devez
conserver l'original afin de créer un correctif («&nbsp;patch&nbsp;»)&nbsp;:
</p>

<pre caption="Créer un correctif pour une mise à jour">
$ <i>diff -U6 </i><comment>${LANG}</comment><i>/alsa-guide.xml alsa-guide.xml</i> > alsa-guide.diff
</pre>

</body>
</section>
<section>
<title>Dépôt CVS en ligne</title>
<body>

<p>
Vous pouvez utiliser notre <uri link="/cgi-bin/viewcvs.cgi">dépôt CVS en
ligne</uri> pour déterminer les différences entre des versions d'un même
document. Le dépôt principal pour les documents en anglais est <uri
link="/cgi-bin/viewcvs.cgi/en/?root=doc&amp;sortby=date">intégralement
disponible</uri>. Notez que le dépôt CVS en ligne est mis à jour toutes les
heures.
</p>

</body>
</section>
<section>
<title>Dépôt local pour les développeurs</title>
<body>

<p>
Créez un répertoire dédié à Gentoo, par exemple
<path>~/work/gentoo/doc</path>. Ensuite, créez un sous-répertoire nommé
<path>cvs/</path> dans lequel vous conserverez un instantané du CVS&nbsp;:
</p>

<pre caption="Obtenir un instantané du CVS">
$ <i>mkdir cvs; cd cvs/</i>
$ <i>export CVSROOT=</i><comment>&lt;votre nom d'utilisateur&gt;</comment><i>@cvs.gentoo.org:/var/cvsroot</i>
$ <i>cvs co doc</i>
</pre>

<p>
Pour mettre à jour l'instantané du CVS, exécutez <c>cvs update -dP</c> dans
le répertoire <path>cvs/doc</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Tester GuideXML</title>
<section>
<title>Environnement de test</title>
<body>

<p>
D'abord, créez un répertoire <path>test/</path> dans lequel vous conserverez
<path>guide.xsl</path>, <path>main.css</path> ainsi que quelques images&nbsp;:
</p>

<pre caption="Créer l'environnement de test">
$ <i>mkdir test</i>
$ <i>cd test</i>
$ <i>mkdir css images</i>
$ <i>wget -P css/ http://www.gentoo.org/css/main.css</i>
$ <i>wget -P images/ http://www.gentoo.org/images/gridtest.gif \
  http://www.gentoo.org/images/gentoo-new.gif \
  http://www.gentoo.org/images/gtop-www.jpg</i>
</pre>

<p>
Téléchargez une version spéciale de <path>guide.xsl</path> disponible sur <uri
link="http://dev.gentoo.org/~neysx/guide.xsl">l'espace Web de Neysx</uri>.
Cette version est adaptée pour la transformation locale de GuideXML en HTML et
supporte quelques langues. Une <uri
link="http://dev.gentoo.org/~neysx/guide-en.xsl">version nettement plus
courte</uri> qui ne connaît que l'anglais existe aussi.
</p>

<pre caption="Télécharger guide.xsl">
$ <i>wget http://dev.gentoo.org/~neysx/guide.xsl</i>
<comment>(Ou, si l'anglais vous suffit)</comment>
$ <i>wget -O guide.xsl http://dev.gentoo.org/~neysx/guide-en.xsl</i>
</pre>

<p>
Terminez en éditant <path>/etc/xml/catalog</path> pour y ajouter la ligne
suivante&nbsp;:
</p>

<pre caption="Addenda à /etc/xml/catalog">
&lt;rewriteURI uriStartString="/dtd" rewritePrefix="<i>/usr/portage/metadata/dtd/</i>"/&gt;
</pre>

<p>
Si votre fichier <path>/etc/xml/catalog</path> est vide ou ne contient aucune
entrée, vous devez <e>insérer</e> l'élément <c>&lt;rewriteURI&gt;</c> à
l'intérieur de l'élément <c>&lt;catalog&gt;</c>&nbsp;:
</p>

<pre caption="Exemple de /etc/xml/catalog">
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;
&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;
  &lt;rewriteURI uriStartString="/dtd/" rewritePrefix="<i>/usr/portage/metadata/dtd/</i>"/&gt;
&lt;/catalog&gt;
</pre>

<p>
De plus, certains fichiers utilisent parfois une URL vers la DTD du site
Gentoo, par exemple <path>http://www.gentoo.org/dtd/guide.dtd</path>. Vous
pouvez aussi récrire de telles URL vers des fichiers locaux pour éviter les
accès au net qui sont évidemment plus lents&nbsp;:
</p>

<pre caption="Ajouter une redirection à /etc/xml/catalog">
&lt;rewriteURI uriStartString="http://www.gentoo.org/dtd/" rewritePrefix="<i>/usr/portage/metadata/dtd/</i>"/&gt;
</pre>

</body>
</section>
<section>
<title>Tester un guide Gentoo</title>
<body>

<p>
Pour tester un guide Gentoo, vérifiez d'abord si sa syntaxe XML est
valide&nbsp;:
</p>

<pre caption="Utiliser xmllint pour vérifier les guides">
$ <i>xmllint --valid --noout alsa-guide.xml</i>
</pre>

<p>
Si <c>xmllint</c> se termine sans afficher quoi que ce soit, cela indique que
le fichier est exempt d'erreur (du moins en ce qui concerne les balises XML).
La prochaine étape est la conversion du fichier en HTML. L'outil idoine est
<c>xsltproc</c>&nbsp;:
</p>

<pre caption="Conversion en HTML">
$ <i>xsltproc test/guide.xsl alsa-guide.xml &gt; test/alsa-guide.html</i>
</pre>

<p>
Si aucune erreur n'est affichée, vous devriez pouvoir pointer votre
navigateur vers
<uri>file:///home/user/work/gentoo/doc/test/alsa-guide.html</uri> pour
consulter le document résultant de la conversion. Dans tous les autres cas,
vous devrez corriger votre guide jusqu'à ce qu'il fonctionne convenablement.
</p>

</body>
</section>
<section>
<title>Tester le Manuel Gentoo</title>
<body>

<p>
Le manuel Gentoo est divisé en chapitres. Pour traiter un chapitre quasiment
comme sur le serveur web de Gentoo, vous devez utiliser à la fois le fichier
<path>handbook-x86.xml</path> et le fichier <path>hb-</path> (tel que
<path>hb-install-about.xml</path>). Vous devez également fournir à
<c>xsltproc</c> des paramètres identiques à ceux qui sont utilisés pour la
navigation en ligne du Manuel, soit <c>part</c> et <c>chap</c>. Voici un exemple
qui montre la validation du fichier <path>hb-install-about.xml</path>. Notez
bien que vous <e>devez</e> avoir tous les fichiers inclus par le manuel.
</p>

<pre caption="Valider et convertir hb-install-about.xml">
$ <i>xmllint --valid --noout handbook-x86.xml</i>
$ <i>xmllint --valid --noout hb-install-about.xml</i>
$ <i>xsltproc --stringparam part 1 --stringparam chap 1 test/guide.xsl handbook-x86.xml &gt; test/hb-install-about.html</i>
</pre>

<p>
Vous pouvez aussi traiter un chapitre comme n'importe quel document GuideXML,
mais les liens vers les autres chapitres ne seront pas générés.
</p>

<pre caption="Valider et convertir hb-install-about.xml plus simplement">
$ <i>xmllint --valid --noout hb-install-about.xml</i>
$ <i>xsltproc test/guide.xsl hb-install-about.xml &gt; test/hb-install-about.html</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Utiliser une configuration Axkit</title>
<section>
<body>

<note>
Ce chapitre n'est plus activement maintenu et est conservé pour des raisons
historiques aussi longtemps qu'un de nos serveurs web utilise une configuration
similaire. Vous devriez peut-être essayer <c>www-servers/gorg</c> qui est
d'ailleurs utilisé sur plusiers serveurs Gentoo.
</note>

<p>
Certains documentalistes préfèrent utiliser une configuration axkit similaire à
celle utilisée sur <uri>http://www.gentoo.org</uri>. Voici quelques conseils
pour vous aider à obtenir une configuration similaire.
</p>

<warn>
Il semble que axkit soit très sensible aux versions des paquets qu'il utilise,
particulièrement libxml2. La configuration décrite ci-dessous est fonctionnelle.
Toute autre combinaison de paquets pourrait ne pas l'être.
</warn>

<p>
D'abord, installez les paquets requis&nbsp;:
</p>

<pre caption="Utiliser emerge pour installer des versions spécifiques des
paquets requis">
<comment>(Vérifiez si les paquets sont disponibles dans Portage)</comment>
# <i>emerge -vp =dev-libs/libxml2-2.6.17 =dev-libs/libxslt-1.1.12 \
=dev-perl/AxKit-1.6.1 =dev-perl/XML-XPath-1.13 =dev-perl/XML-LibXML-1.58 \
=dev-perl/XML-LibXSLT-1.57 =dev-perl/XML-Parser-2.34 =net-www/apache-1.3.33</i>

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild   R   ] dev-libs/libxml2-2.x.17  -debug -ipv6 +python +readline  0 kB 
[ebuild   R   ] dev-libs/libxslt-1.1.12  +crypt +python  0 kB 
[ebuild   R   ] dev-perl/AxKit-1.6.1  +gnome  0 kB 
[ebuild   R   ] dev-perl/XML-XPath-1.13   0 kB 
[ebuild   R   ] dev-perl/XML-LibXML-1.58   0 kB 
[ebuild   R   ] dev-perl/XML-LibXSLT-1.57   0 kB 
[ebuild   R   ] dev-perl/XML-Parser-2.34   0 kB
[ebuild   R   ] net-www/apache-1.3.33  +pam  0 kB

<comment>(Installez les paquets)</comment>
# <i>emerge =dev-libs/libxml2-2.6.17 =dev-libs/libxslt-1.1.12 \
=dev-perl/AxKit-1.6.1 =dev-perl/XML-XPath-1.13 =dev-perl/XML-LibXML-1.58 \
=dev-perl/XML-LibXSLT-1.57 =dev-perl/XML-Parser-2.34 =net-www/apache-1.3.33</i>
</pre>

<p>
Ensuite, éditez les fichiers de configuration suivants&nbsp;:
</p>

<pre caption="/etc/apache/conf/commonapache.conf">
<comment>(Dans)</comment>
&lt;IfModule mod_dir.c&gt;
  <comment>(Ajoutez index.xml à la liste)</comment>
  DirectoryIndex index.xml index.html index.php index.php3 index.shtml index.cgi index.pl index.htm Default.htm default.htm
&lt;/IfModule&gt;

<comment>(Ajoutez les lignes suivantes)</comment>
&lt;IfDefine PERL&gt;
  LoadModule perl_module extramodules/libperl.so
#  AddModule mod_perl.c
  PerlModule AxKit
  SetHandler perl-script
  PerlHandler Apache::AxKit::StyleChooser::PathInfo AxKit
  AddHandler axkit .xml .xsp
  AxAddPlugin Apache::AxKit::StyleChooser::QueryString
  AxAddXSPTaglib AxKit::XSP::Util
  AxAddXSPTaglib AxKit::XSP::IfParam
  AxAddXSPTaglib AxKit::XSP::Param
  AxAddStyleMap application/x-xsp Apache::AxKit::Language::XSP
  AxAddStyleMap text/xsl Apache::AxKit::Language::LibXSLT
  &lt;AxStyleName "#default"&gt;
    AxAddProcessor text/xsl /xsl/guide.xsl
  &lt;/AxStyleName&gt;
  &lt;AxStyleName printable&gt;
    AxAddProcessor text/xsl /xsl/guide-print.xsl
  &lt;/AxStyleName&gt;
&lt;/IfDefine&gt;

<comment>(Dans)</comment>
&lt;IfModule mod_alias.c&gt;
    Alias /icons/ /var/www/localhost/icons/
<comment>(Commentez la ligne suivante)</comment>
    #Alias /doc /usr/share/doc
</pre>

<pre caption="/etc/conf.d/apache">
<comment>(Ajoutez -D PERL à la liste des options)</comment>
APACHE_OPTS="-D PERL"
</pre>

<p>
Puis, copiez les fichiers de la documentation dans
<path>/var/www/localhost/htdocs/</path>, incluant les DTD et les feuilles de
style. Vous aurez besoin des répertoires <path>css/</path>, <path>doc/</path>,
<path>dtd/</path>, <path>images/</path> et <path>xsl/</path>. Les développeurs
Gentoo peuvent copier à partir de leur copie locale du CVS, ou lier
symboliquement cette copie locale.
</p>

<p>
Il ne reste plus qu'à démarrer votre serveur apache avec&nbsp;:
</p>

<pre caption="Démarrer apache">
# <i>/etc/init.d/apache start</i>
# <comment>(Ajoutez-le à un niveau d'exécution si vous souhaitez le démarrer automatiquement lors de l'amorçage.)</comment>
# <i>rc-update add apache default</i>
</pre>

<p>
Pointez votre navigateur vers <uri>http://votre_serveur/doc/en/</uri>, ou
simplement <uri>http://localhost/doc/en/</uri> si vous avez installé axkit sur
votre station de travail. Vous pouvez consulter le journal des accès dans
<path>/var/log/apache/access_log</path>, et le journal des erreurs dans
<path>/var/log/apache/error_log</path>.
</p>

<note>
Les utilisateurs de Mozilla devront peut-être régler <c>keyword.enabled</c> à
<c>false</c> dans leur page <uri>about:config</uri> lorsqu'ils utilisent
«&nbsp;localhost&nbsp;».
</note>

</body>
</section>
</chapter>
<chapter>
<title>Foire Aux Questions</title>
<section>
<title>Comment puis-je convertir un fichier en UTF-8&nbsp;?</title>
<body>

<p>
De nombreux outils sont disponibles pour cette tâche. Les plus populaires sont
<c>app-text/recode</c> ou <c>iconv</c> qui fait partie de
<c>sys-libs/glibc</c>.
</p>

<p>
Recode est vraiment facile d'utilisation. Vous n'avez qu'à lui dire quel codage
de caractère est actuellement utilisé par le document et en quel codage vous
voulez obtenir le résultat.
</p>

<p>
Par exemple, pour convertir un document codé en ISO-8859-15 (aussi connu sous le
nom «&nbsp;Latin-9&nbsp;») en UTF-8, vous pouvez faire&nbsp;:
</p>

<pre caption="Réencoder un fichier">
<comment>(l9 = ISO-8859-15, u8 = UTF-8)</comment>
$ <i>recode l9..u8 fichier.xml</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Astuces lors de la soumission d'un document</title>
<section>
<title>Vérification de l'élément &lt;guide&gt;</title>
<body>

<p>
Faites bien attention à ce que l'attribut <c>link=""</c> de l'élément
<c>&lt;guide&gt;</c> indique le bon chemin du document. Si votre guide est basé
sur les DTD <c>guide</c> ou <c>book</c>, vous pouvez indiquer soit son chemin
absolu (exemple&nbsp;: <path>/doc/${LANG}/fichier.xml</path>, recommandé par le
GDP, obligatoire pour les traductions), soit son chemin relatif (exemple&nbsp;:
<path>chemin.xml</path>).
</p>

</body>
</section>
<section>
<title>Vérification des liens</title>
<body>

<p>
Vous <e>devez</e> vérifier que tous les liens hypertextes de votre document
fonctionnent correctement. Pour une traduction, faites pointer les liens vers la
version traduite des documents si elle existe (vers l'originale sinon) et
assurez-vous que cette version traduite existe bien&nbsp;!
</p>

</body>
</section>

<section>
<title>Vérification des tabulations</title>
<body>

<p>
Les tabulations sont complètement interdites dans les documents GuideXML, sauf
cas particulier (par exemple si le document indique à l'utilisateur de taper une
tabulation). Pour chercher les tabulations dans un document, tapez&nbsp;:
<c>grep "&lt;Ctrl-V&gt;&lt;TAB&gt;" fichier.xml</c>. Corrigez toutes les lignes
que grep renvoie.
</p>

</body>
</section>
<section>
<title>Bugzilla</title>
<body>

<p>
Lorsque votre document est terminé, il faut le soumettre à validation par
l'équipe de documentation GDP sur le <uri
link="http://bugs.gentoo.org/enter_bug.cgi?product=Documentation">Bugzilla</uri>.
Les informations demandées systématiquement par Bugzilla, telles que votre
plate-forme, le résultat du <c>emerge info</c>, les étapes pour reproduire le
problème, etc. n'ont aucun intérêt ici. Si vous soumettez une traduction,
choisissez plutôt le composant <uri
link="http://bugs.gentoo.org/enter_bug.cgi?product=Doc%20Translations">Doc
Translations</uri> pour votre bogue.
</p>

<p>
Pour le titre du bogue, vous pouvez utiliser ce format simple&nbsp;: «&nbsp;[fr]
New translation: /doc/fr/gnupg-user.xml&nbsp;» en remplaçant «&nbsp;fr&nbsp;»
par le code à deux lettres de la langue concernée, «&nbsp;translation&nbsp;» par
«&nbsp;document&nbsp;» si ce n'est pas une traduction et le nom du fichier.
</p>

<p>
Écrivez tout en anglais.
</p>

<p>
Par défaut, le bogue sera assigné à <mail>docs-team@gentoo.org</mail>. Ce n'est
pas la peine de modifier cette valeur.
</p>

<p>
Ajoutez vos fichiers au bogue en choisissant le type «&nbsp;plain text
(text/plain)&nbsp;», même si c'est un fichier XML. Cochez la case
«&nbsp;Patch&nbsp;» lorsque c'est un correctif. Ne mettez jamais une archive tar
ou zip contenant tous les fichiers mais ajoutez chaque fichier individuellement
en spécifiant juste leur nom dans la case description.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Erreurs fréquentes et dangereuses</title>
<section>
<title>Oubli de l'aspect multi-architecture du manuel Gentoo</title>
<body>

<p>
Les fichiers contenus dans <path>[gentoo]/xml/htdocs/doc/en/handbook</path> qui
ne se terminent pas par un suffixe en &quot;-&lt;arch&gt;.xml&quot; sont lus par
<e>toutes</e> les versions du manuel, c'est-à-dire que tout ce qui est contenu
dans ces fichiers concerne toutes les architectures.
</p>

<p>
Si vous devez faire des modifications qui concernent votre architecture et si
vous avez peur de devoir les placer dans un tel fichier, vous pourriez d'abord
demander sur <c>gentoo-doc@gentoo.org</c> comment résoudre ce problème. Parfois,
il peut exister une solution qui ne compliquera pas la vie des utilisateurs des
autres architectures.
</p>

</body>
</section>
<section>
<title>Oubli de la mise à jour de la version et de la date</title>
<body>

<p>
Conformément aux consignes, vous <e>devez</e> incrémenter la version et mettre à
jour la date des documents lorsque vous faites certaines modifications (en fait,
pratiquement toutes). Bien que la version soit moins importante (SwifT vous
tuera quand même si vous l'oubliez), la date indique à nos utilisateurs quand
le document a été mis à jour pour la dernière fois.
</p>

<p>
Si vous modifiez le <e>contenu</e> d'un document, vous devez alors incrémenter
sa version. Les modifications qui n'altèrent pas le contenu (fautes de frappe,
ménage dans le XML...) n'ont pas à provoquer un changement de version.
</p>

<p>
Lorsque vous mettez à jour le Manuel, ne mettez à jour que les dates et versions
des fichiers que vous modifiez. Ne mettez pas à jour les fichiers
handbook-<e>ARCH</e>.xml à moins que vous n'ayez modifié son contenu.
</p>

<p>
Une autre erreur fréquente est d'augmenter le numéro de version comme si c'était
un nombre décimal. Ce n'est pas le cas. En cas de mise à jour, vous devez
remplacer <c>3.9</c> par <c>3.10</c> et non pas par <c>4.0</c> ni par
<c>3.91</c>.
</p>

</body>
</section>
</chapter>
</guide>
