<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Id: php-upgrading.xml,v 1.1 2006/10/03 10:17:24 neysx Exp $ -->

<guide link="php-upgrading.xml" lang="fr">
<title>Mise à jour de PHP</title>

<author title="Author">
  <mail link="akorthaus@web.de">Andreas Korthaus</mail>
</author>
<author title="Translator">
  <mail link="n.litchinko@noos.fr">Nicolas Litchinko</mail>
</author>

<abstract>
Ce document décrit la procédure à suivre pour mettre à jour une installation de
PHP en toute sécurité.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.1</version>
<date>2006-03-19</date>

<chapter>
<title>Introduction</title>
<section>
<body>

<p>
Il a été demandé de nombreuses fois pourquoi PHP5 n'était pas encore marqué
comme stable dans Portage. Le problème n'est pas le paquet PHP5 lui-même&nbsp;;
la principale raison pour laquelle PHP5 n'est pas encore marqué comme stable
est qu'il y a beaucoup d'applications, d'extensions de PHP et de paquets dans
Portage qui ne fonctionnent pas avec PHP5 et il n'y a rien que nous ne
puissions faire pour y remédier. PHP5 n'est pas compatible à 100% avec PHP4 et
tous les programmes PHP4 ne peuvent être ou ne seront pas portés pour être
utilisés avec PHP5. Beaucoup d'utilisateurs vont encore avoir besoin du support
de PHP4 pour un bon moment.
</p>

<p>
La solution à ces problèmes est de fournir un environnement comportant à la
fois PHP4 et PHP5. Ce n'était toutefois pas possible avec la configuration
actuelle des paquets et eclass de PHP&nbsp;; il a donc été nécessaire de
consentir beaucoup d'efforts pour la mise en place d'une nouvelle
configuration, de nouvelles eclasses et de nouveaux ebuilds.
</p>

<p>
Ce document explique comment mettre à jour sans détériorer votre système.
</p>

<note>
Les nouveaux paquets PHP nécessitent la nouvelle configuration d'Apache. Lisez
donc le guide <uri link="/doc/fr/apache-upgrading.xml">Mettre à Jour Apache
</uri> si vous ne l'avez pas déjà fait.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Changements</title>
<section>
<title>La consolidation des paquets PHP de base</title>
<body>

<p>
Tous les ebuilds de PHP <c>dev-php/php</c>, <c>dev-php/php-cgi</c> et
<c>dev-php/mod_php</c> ont été rassemblés en un seul ebuild&nbsp;:
<c>dev-lang/php</c>.
</p>

<p>
Pour choisir la SAPI que vous désirez, utilisez les options USE
suivantes&nbsp;:
</p>

<ul>
  <li>
    <c>cgi</c> - compile &amp; installe <path>/usr/bin/php-cgi</path>
  </li>
  <li>
    <c>cli</c> - compile &amp; installe <path>/usr/bin/php</path>
  </li>
  <li>
    <c>apache</c> - compile &amp; installe <c>mod_php</c> pour Apache 1.3
    (nouvelle configuration)
</li>
  <li>
    <c>apache2</c> - compile &amp; installe <c>mod_php</c> pour Apache 2.0
    (nouvelle configuration)
</li>
</ul>

<p>
Vous pouvez mélangez ces options USE à ceci près que vous ne pouvez pas activer
<c>apache</c> et <c>apache2</c> en même temps.
</p>

<p>
Le principal objectif de ces ebuilds est de vous permettre d'avoir PHP4 et PHP5
installés en parallèle&nbsp;:
</p>

<pre caption="Installer PHP">
<comment>(Installer la dernière version de PHP avec les modules CLI et Apache2)</comment>
# <i>USE="cli apache2" emerge 'dev-lang/php'</i>

<comment>(Installer uniquement PHP4)</comment>
# <i>USE="cli apache2" emerge '=dev-lang/php-4*'</i>

<comment>(Installer les deux, PHP4 et PHP5)</comment>
# <i>USE="cli apache2" emerge '=dev-lang/php-4*' '=dev-lang/php-5*'</i>
</pre>

<note>
Les USE flags ne devraient pas être configurés de cette façon. Référez-vous au
fichier <path>/etc/portage/package.use</path> comme expliqué plus loin.
</note>

</body>
</section>

<section>
<title>Nouvelles catégories dans Portage</title>
<body>

<p>
Les nouveaux ebuilds de PHP ont été déplacés de <c>dev-php</c> vers
<c>dev-lang/php</c>. Pour permettre d'installer les paquets indépendamment pour
PHP4 et PHP5, deux nouvelles catégories ont été introduites dans portage&nbsp;:
<c>dev-php4</c> et <c>dev-php5</c>. Ces catégories sont principalement
utilisées par les paquets PECL comme <c>pecl-pdo</c>, <c>pecl-apc</c>,
<c>php-java-bridge</c> ou <c>xdebug</c>.
</p>

<p>
Pour installer <c>pecl-apc</c>&nbsp;:
</p>

<pre caption="Installer une extension PHP comme PECL::APC (exemple)">
<comment>(Installer APC pour PHP4 uniquement)</comment>
# <i>emerge dev-php4/pecl-apc</i>

<comment>(Installer APC pour PHP5 uniquement)</comment>
# <i>emerge dev-php5/pecl-apc</i>

<comment>(Installer APC pour PHP4 et PHP5)</comment>
# <i>emerge dev-php4/pecl-apc dev-php5/pecl-apc</i>
</pre>

</body>
</section>

<section>
<title>Nouveaux répertoires</title>
<body>

<ul>
  <li>
    Ces nouveaux ebuilds installent leur contenu dans
    <path>/usr/lib/php4</path> et <path>/usr/lib/php5</path> (les modules
    Apache sont placés au bon endroit pour Apache)&nbsp;;
  </li>
  <li>
    Les paquets PEAR et les autres bibliothèques PHP sont installés dans
    <path>/usr/share/php</path> (au lieu de <path>/usr/lib/php</path>
    auparavant)&nbsp;;
  </li>
  <li>
    Les paquets PECL n'ajouteront plus d'instructions de configuration dans le
    fichier de configuration <path>php.ini</path>, mais ajouteront un fichier
    <path>[PAQUET].ini</path> dans le répertoire
    <path>/etc/php/[SAPI]/ext</path>.
  </li>
</ul>

</body>
</section>

<section>
<title>Liens vers les binaires de PHP</title>
<body>

<p>
Si vous installez plusieurs versions de PHP, par exemple&nbsp;:
</p>

<pre caption="emerge PHP4 et PHP5">
# <i>USE="cgi cli apache2" emerge '=dev-lang/php-4*' '=dev-lang/php-5*'</i>
</pre>

<p>
Ces ebuilds vont créer des liens symboliques dans <path>/usr/bin</path> vers la
dernière version de PHP que vous avez installée, et dans ce cas c'est PHP5, car
il a été installé après PHP4. Si vous voulez que <path>/usr/bin/php</path> ou
<path>/usr/bin/php-cgi</path> pointe vers PHP4 ou alors l'un vers PHP4 et
l'autre vers PHP5, etc., vous pouvez <uri link="#doc_chap3_sect5">utiliser
l'outil php-select</uri> fourni par <c>app-admin/php-toolkit</c>.
<c>php-select</c> rend très simple la modification des liens vers les binaires
de votre choix.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Instructions de mise à jour</title>
<section>
<title>Trouvez les paquets à mettre à jour</title>
<body>

<p>
Tout d'abord, vous devez déterminer quels paquets additionnels vous devez
mettre à jour. Vous pouvez faire cela en utilisant l'outil <c>equery</c>,
fourni par le paquet <c>app-portage/gentoolkit</c>&nbsp;:
</p>

<pre caption="Lister les paquets de dev-php installés">
$ <i>equery list 'dev-php/'</i>
[ Searching for all packages in 'dev-php' among: ]
 * installed packages
[I--] [  ] dev-php/php-4.4.0 (0)
[I--] [  ] dev-php/mod_php-4.4.0 (1)
[I--] [  ] dev-php/smarty-2.6.10 (0)
[I--] [  ] dev-php/PEAR-PEAR-1.3.5-r1 (0)
[I--] [  ] dev-php/PEAR-Mail-1.1.6 (0)
[I--] [  ] dev-php/PEAR-MDB-1.3.0 (0)
[I--] [  ] dev-php/PECL-apc-3.0.6 (0)
[I--] [  ] dev-php/PECL-imagick-0.9.11 (0)
[I--] [  ] dev-php/xdebug-2.0.0_beta3 (0)
</pre>

<impo>
Les paquets que vous avez installés peuvent être complètement différents,
assurez-vous que vous utilisez cette commande en personne. Vous devriez
sauvegarder la liste générée pour vous assurer de mettre à jour tous les
paquets.
</impo>

<note>
De nombreuses applications web ne sont pas affectées du tout, car elles
utilisent pour la plupart l'eclass webapp qui se charge de les installer
correctement. Vous pourriez vérifier qu'il n'existe pas de nouvelle révision.
</note>

<p>
Les extensions de PHP comme
</p>

<ul>
  <li><c>PECL-apc</c></li>
  <li><c>PECL-imagick</c></li>
  <li><c>xdebug</c></li>
</ul>

<p>
ont été séparées en 2 catégories dans portage&nbsp;: <c>dev-php4</c> et
<c>dev-php5</c>. Cela permet de les utiliser indépendamment avec les deux
versions de PHP. De plus, la plupart de ces paquets ont été renommés&nbsp;:
</p>

<p>
Exemples de nouveaux répertoires et de changements de noms&nbsp;:
</p>

<table>
  <tr>
    <th>Extension PHP</th>
    <th>Ancien</th>
    <th>Nouveau pour PHP4</th>
    <th>Nouveau pour PHP5</th>
  </tr>
  <tr>
    <ti>APC</ti>
    <ti>dev-php/PECL-apc</ti>
    <ti>dev-php4/pecl-apc</ti>
    <ti>dev-php5/pecl-apc</ti>
  </tr>
  <tr>
    <ti>Imagick</ti>
    <ti>dev-php/PECL-imagick</ti>
    <ti>dev-php4/pecl-imagick</ti>
    <ti>dev-php5/pecl-imagick</ti>
  </tr>
  <tr>
    <ti>Xdebug</ti>
    <ti>dev-php/xdebug</ti>
    <ti>dev-php4/xdebug</ti>
    <ti>dev-php5/xdebug</ti>
  </tr>
</table>

<note>
Avant d'installer à nouveau ces extensions, vous devez trouver dans
<path>/usr/portage</path> comment ces paquets ont été renommés.
</note>

</body>
</section>

<section>
<title>Supprimer les anciens paquets</title>
<body>

<p>
Nous avons effectués de nombreux changements dans le fonctionnement de PHP sous
Gentoo. Vous devez supprimer complètement vos anciens paquets PHP avant
d'installer les nouveaux paquets&nbsp;:
</p>

<pre caption="Supprimer les anciens paquets (exemple)">
<comment>(Supprimer les paquets PHP)</comment>
# <i>emerge --unmerge php mod_php</i>

<comment>(Supprimer les extensions de PHP)</comment>
# <i>emerge --unmerge PECL-apc PECL-imagick xdebug</i>

<comment>(supprimer les bibliothèques/applications PHP)</comment>
# <i>emerge --unmerge PEAR-PEAR PEAR-Mail PEAR-MDB smarty</i>
</pre>

</body>
</section>

<section>
<title>Configurer les options USE</title>
<body>

<p>
Comme nous avons ajouté de nouvelles options USE, vous désirez probablement les
passer en revue et ajouter les lignes appropriées à
<path>/etc/portage/package.use</path> (ce fichier doit être créé s'il n'existe
pas).
</p>

<note>
<path>/etc/portage/package.use</path> va configurer les options USE pour votre
installation de PHP et s'en souvenir sans que vous n'ayez à éditer
<path>make.conf</path>.
</note>

<p>
Veuillez configurer les options USE en fonction des fonctionnalités que vous
désirez intégrer à votre installation de PHP (il est recommandé de définir au
moins l'option <c>cli</c>)&nbsp;:
</p>

<pre caption="Options USE pour dev-lang/php (exemple)">
dev-lang/php -* cli apache2 ctype expat fastbuild ftp gd hash iconv memlimit mysql nls pcre pic pdo reflection session simplexml sockets spl ssl tokenizer truetype unicode xml xsl zlib
</pre>

<note>
<c>-*</c> désactive toutes les options USE (ceci désactive également des
fonctionnalités de base comme le support des sessions, PCRE, gd ou
MySQL&nbsp;!) et vous devez donc préciser toutes les options USE relatives aux
extensions/fonctions que vous désirez utiliser. Référez-vous au guide <uri
link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/ManagingExtensions">
Managing Extensions</uri> pour de plus amples détails. Vous devez définir les
options USE pour les fonctions par défaut comme <c>pcre</c> si vous voulez
utiliser les fonctions <uri
link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/PhpRefPcre">preg_*
</uri> ou <c>session</c> si vous voulez utiliser les fonctions de <uri
link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/PhpRefSession">
gestion de session</uri>.
</note>

<p>
Si vous désirez installer PHP4 et PHP5 en parallèle, vous pouvez définir
différentes options USE pour chaque version&nbsp;:
</p>

<pre caption="Différentes options USE pour PHP4 et PHP5 (exemple)">
=dev-lang/php-4* -* cli cgi apache2 ctype expat fastbuild force-cgi-redirect ftp gd iconv ipv6 memlimit mysql nls pcre pic posix session sockets ssl tokenizer truetype unicode xml xsl zlib
=dev-lang/php-5* -* cli cgi apache2 ctype fastbuild force-cgi-redirect ftp gd hash iconv ipv6 memlimit mysql nls pcre pic posix pdo reflection session simplexml soap sockets spl sqlite ssl tokenizer truetype unicode xml xmlreader xmlwriter xsl zlib
</pre>

<note>
Pour une liste d'options USE recommandées, vous pouvez consulter la <uri
link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/CommonQuestions#DoYouRecommendAnyUSEFlags">
liste des options USE recommandées</uri>. Pour la liste des options USE
disponibles, vous pouvez consulter la <uri
link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/NewUseFlags">table
des options USE</uri> sur le wiki de l'overlay.
</note>

</body>
</section>
<section>
<title>Installer PHP</title>
<body>

<p>
Maintenant, vous avez le choix d'installer uniquement PHP4, uniquement PHP5 ou
les deux en parallèle. Pour installer PHP4, vous n'avez qu'à installer
<c>=dev-lang/php-4*</c>&nbsp;; pour installer PHP5 (la dernière version), vous
pouvez utiliser <c>dev-lang/php</c>&nbsp;; et pour installer les deux en
parallèle, vous devez installer <c>=dev-lang/php-4*</c> et
<c>=dev-lang/php-5*</c>.
</p>

<p>
Vérifier les options USE&nbsp;:
</p>

<pre caption="Vérifier les options USE (exemple)">
<comment>(Vérifier le paquet PHP4)</comment>
# <i>emerge --pretend --verbose '=dev-lang/php-4*'</i>

<comment>(Vérifier le paquet PHP5)</comment>
# <i>emerge --pretend --verbose '=dev-lang/php-5*'</i>

<comment>(Vérifier les extensions pour PHP4)</comment>
# <i>emerge --pretend --verbose dev-php4/pecl-apc dev-php4/pecl-imagick dev-php4/xdebug</i>

<comment>(Vérifier les extensions pour PHP5)</comment>
# <i>emerge --pretend --verbose dev-php5/pecl-apc dev-php5/pecl-imagick</i>

<comment>(Vérifier les bibliothèques/applications PHP)</comment>
# <i>emerge --pretend --verbose PEAR-PEAR PEAR-Mail PEAR-MDB smarty</i>
</pre>

<p>
Installez PHP si tout est correct&nbsp;:
</p>

<pre caption="Installer les nouveaux paquets (exemple)">
<comment>(Installer le paquet PHP4)</comment>
# <i>emerge '=dev-lang/php-4*'</i>

<comment>(Installer le paquet PHP5)</comment>
# <i>emerge '=dev-lang/php-5*'</i>

<comment>(Installer les extensions pour PHP4)</comment>
# <i>emerge dev-php4/pecl-apc dev-php4/pecl-imagick dev-php4/xdebug</i>

<comment>(Installer les extensions pour PHP5)</comment>
# <i>emerge dev-php5/pecl-apc dev-php5/pecl-imagick</i>

<comment>(Installer les bibliothèques/applications PHP)</comment>
# <i>emerge PEAR-PEAR PEAR-Mail PEAR-MDB smarty</i>
</pre>

</body>
</section>

<section>
<title>PHP4 et PHP5 en parallèle&nbsp;: sélectionner l'application utilisée par
cli/cgi</title>
<body>

<p>
Une fois l'installation terminée, vous aurez des applications pour <c>cli</c>
(N.d.t. ligne de commande) et/ou <c>cgi</c> dans <path>/usr/lib/php4/bin</path>
et/ou <path>/usr/lib/php5/bin</path>. Si vous avez installé PHP4 et PHP5,
Portage ne peut pas décider pour vous lequel doit être utilisé par défaut et
crée toujour un lien symbolique vers la dernière version de PHP que vous avez
installée dans <path>/usr/bin</path>. Par conséquent, si vous avez installé
PHP5 en dernier, <path>/usr/bin/php</path> pointera vers
<path>/usr/lib/php5/bin/php</path>. Par conséquent, des liens symboliques (dans
<path>/usr/bin</path>) doivent pointer vers les applications <c>cli</c> et/ou
<c>cgi</c> ainsi que <c>php-devel</c> (responsable de la création des
extensions PHP à l'aide de <c>phpize</c> et <c>php-config</c>). Ceci peut être
effectué facilement en utilisant <c>php-select</c> qui fait partie du paquet
<c>app-admin/php-toolkit</c>.
</p>

<note>
Les paquets <c>dev-lang/php</c> dépendent d'<c>app-admin/php-toolkit</c>. Par
conséquent, <c>php-select</c> devrait être disponible automatiquement après
avoir installé les nouveaux paquets PHP.
</note>

<p>
Considérant que vous avez installé <c>=dev-lang/php-4*</c> et
<c>=dev-lang/php-5*</c>, utilisez <c>php-select</c> et les commandes suivantes
pour afficher les versions de PHP actuellement sélectionnées&nbsp;:
</p>

<pre caption="Afficher les versions de PHP actuellement installées">
<comment>(Pour cli)</comment>
# <i>php-select php</i>

<comment>(Pour cgi)</comment>
# <i>php-select php-cgi</i>

<comment>(Pour phpize, php-config)</comment>
# <i>php-select php-devel</i>
</pre>

<p>
Le résultat devrait ressembler à ceci&nbsp;:
</p>

<pre caption="Exemple de résultat de php-select">
# <i>php-select php</i>
/usr/bin/php is set to /usr/lib/php5/bin/php
</pre>

<p>
Ceci signifie que <path>/usr/bin/php</path>, chemin par défaut vers
l'application cli de PHP pointe sur l'application PHP5
<path>/usr/lib/php5/bin/php</path>. Par conséquent, les scripts PHP utilisant
<path>/usr/bin/php</path> seront exécutés par PHP5.
</p>

</body>
</section>
<section>
<title>Utiliser php-select pour modifier les versions de PHP par défaut</title>
<body>

<p>
Si vous n'êtes pas satisfait de la configuration que vous avez découverte au
chapitre précédent, vous pouvez utiliser <c>php-select</c> à nouveau pour
séléctionner la version que vous voulez&nbsp;:
</p>

<pre caption="Sélectionner la version désirée">
<comment>(Pour cli)</comment>
# <i>php-select php php4</i>

<comment>(Pour cgi)</comment>
# <i>php-select php-cgi php5</i>

<comment>(Pour phpize, php-config)</comment>
# <i>php-select php-devel php5</i>
</pre>

<note>
Vous pouvez utiliser <c>php-select -h</c> pour obtenir plus de détails sur les
possibilités de <c>php-select</c>.
</note>

<p>
Vérifier les liaisons&nbsp;:
</p>

<pre caption="Vérifier les liens symboliques">
# <i>stat /usr/bin/php /usr/bin/php-cgi /usr/bin/phpize /usr/bin/php-config | grep File</i>
 File: `/usr/bin/php' -> `/usr/lib/php4/bin/php'
 File: `/usr/bin/php-cgi' -> `/usr/lib/php5/bin/php-cgi'
 File: `/usr/bin/phpize' -> `/usr/lib/php5/bin/phpize'
 File: `/usr/bin/php-config' -> `/usr/lib/php5/bin/php-config'
</pre>

<note>
Veuillez noter que <c>php-select</c> ne modifie que les versions par défaut. Si
vous avez installé PHP4 et PHP5 cgi/cli, vous pouvez toujours utiliser les
chemins directs que sont <path>/usr/lib/php4/bin/php</path> et
<path>/usr/lib/php5/bin/php</path> pour exécuter des scripts PHP à l'aide
d'une version spécifique. Vous pouvez utiliser PHP4 et PHP5 cgi dans la même
instance d'Apache, mais vous ne pouvez pas utiliser deux modules PHP pour
Apache différents dans une seule instance d'Apache&nbsp;; référez vous au <uri
link="/proj/en/php/php4-php5-configuration.xml">Guide de Configuration de PHP4
et PHP5</uri> pour plus de détails.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Migration des fichiers de configuration</title>
<section>
<body>

<p>
Le paquet PHP pour Gentoo place la configuration dans <path>/etc/php</path> qui
contient un sous-répertoire pour chaque SAPI pour chaque version de PHP&nbsp;:
</p>

<pre caption="Contenu des répertoires de configuration de PHP">
$ <i>ls -1 /etc/php</i>
apache2-php4
apache2-php5
cli-php4
cli-php5
</pre>

<p>
Chaque sous-répertoire contient son propre <path>php.ini</path>, comme les
anciens paquets.
</p>

</body>
</section>

<section>
<title>Modifications dans php.ini</title>
<body>

<p>
Vous devriez utiliser <c>etc-update</c> ou <c>dispatch-conf</c> et vérifier les
différences entre vos anciens et vos nouveaux paramètres dans
<path>php.ini</path>. Les deux directives que vous devez absolument vérifier
sont <c>include_path</c> et <c>extension_dir</c>. Toutefois, soyez prudent,
<c>extension_dir</c> est modifié entre les différentes versions de PHP (y
compris entre les versions 5.0 et 5.1&nbsp;!).
</p>

<p>
Exemple pour PHP 5.1 dans <path>/etc/php/apache2-php5/php.ini</path> et
<path>/etc/php/cli-php5/php.ini</path>&nbsp;:
</p>

<pre caption="Anciens paramètres dans php.ini">
include_path = ".:/usr/lib/php"
extension_dir = "/usr/lib/php/extensions/no-debug-non-zts-20050617/"
</pre>

<pre caption="Nouveaux paramètres dans php.ini">
include_path = ".:/usr/share/php"
extension_dir = "/usr/lib/php5/lib/php/extensions/no-debug-non-zts-20050617/"
</pre>

<warn>
Assurez-vous d'utiliser <c>etc-update</c> ou <c>dispatch-conf</c> pour
visualiser les paramètres corrects pour chaque fichier.
</warn>

</body>
</section>
<section>
<title>Changements dans la configuration des extensions de PHP</title>
<body>

<p>
Le nouveau paquet PHP ne stocke plus les directives de configuration des
extensions externes (partagées) de PHP dans <path>php.ini</path>. Ces
directives sont maintenant stockées dans des fichiers de configuration
spécifiques à l'extension dans les dossiers <path>/etc/php/*/ext</path>. Pour
activer/désactiver les extensions partagées, les liens symboliques situés dans
<path>/etc/php/*/ext-active</path> sont utilisés. Si vous voulez activer une
extension, créez un lien symbolique dans <path>/etc/php/*/ext-active</path>
pointant vers le fichier <path>[EXTENSION].ini</path> correspondant dans
<path>/etc/php/*/ext/</path>. Si vous voulez désactiver une extension,
supprimez le lien symbolique.
</p>

<p>
Si vous aviez installé <c>dev-php/PECL-apc</c>, la configuration d'APC est
stockée dans votre <path>php.ini</path>. Si vous réinstallez le nouveau paquet
<c>dev-php5/pecl-apc</c>, la configuration par défaut d'APC sera placée dans
<path>/etc/php/*5/ext/apc.ini</path>.
</p>

<p>
Vous devez donc déplacer les directives de configuration d'APC de
<path>/etc/php/*5/php.ini</path> vers <path>/etc/php/*5/ext/apc.ini</path> et
créer un lien symbolique depuis <path>/etc/php/*5/ext-active/apc.ini</path>
vers <path>/etc/php/*5/ext/apc.ini</path>.
</p>

<note>
Si vous installez PHP en tant que module d'Apache, assurez-vous de redémarrer
Apache après l'installation et la configuration.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Configurer Apache pour utiliser PHP4 et/ou PHP5</title>
<section>
<body>

<p>
Pour configurer Apache pour charger le module PHP4 ou PHP5 (mod_php), vous
devez ajouter la directive <c>-D PHP4</c> ou <c>-D PHP5</c> à la variable
<c>APACHE2_OPTS</c> dans <path>/etc/conf.d/apache2</path>.
</p>

<pre caption="Configurer Apache pour charger mod_php">
<comment>(Options pour PHP4)</comment>
<i>APACHE2_OPTS="-D PHP4"</i>

<comment>(Ou options pour PHP5)</comment>
<i>APACHE2_OPTS="-D PHP5"</i>
</pre>

<p>
Il y a de nombreuses façons de configurer Apache pour utiliser les deux
versions de PHP en parallèle. La plus simple est d'utiliser PHP4 et PHP5 en
tant qu'application cgi, ou bien PHP4 en tant que cgi et PHP5 en tant que
module (ou bien l'inverse). Il n'est pas possible d'utiliser le module PHP4 et
le module PHP5 dans une seule instance d'Apache.
</p>

<p>
Nous avons créé un <uri link="/proj/en/php/php4-php5-configuration.xml">Guide
de configuration de PHP4 et PHP5</uri> qui explique certaines des solutions
envisageables.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Support / obtenir de l'aide</title>
<section>
<body>

<p>
Si vous rencontrez des problèmes avec les nouveaux paquets PHP de Gentoo, voici
les moyens que vous avez d'obtenir de l'aide&nbsp;:
</p>

<ul>
  <li>
    <uri
    link="http://svn.gnqs.org/projects/gentoo-php-overlay/wiki/CommonQuestions">
    Questions courantes</uri> à propos de PHP sous Gentoo&nbsp;;
  </li>
  <li>
    <uri link="http://svn.gnqs.org/projects/gentoo-php-overlay">Page de
    développement de l'overlay PHP</uri>&nbsp;;
  </li>
  <li>
    <c>#gentoo-php</c> sur irc.freenode.net&nbsp;; c'est le salon de discussion
    où les auteurs réguliers de l'overlay se retrouvent. Votre visite nous fera
    plaisir&nbsp;!
  </li>
  <li>
    <uri link="http://forums.gentoo.org/">Les forums Gentoo</uri> sont un
    endroit populaire où vous pouvez demander de l'aide. Il y a de nombreux
    autres utilisateurs de Gentoo qui lisent les forums tout au long de la
    journée, ce qui en fait un excellent endroit pour demander de l'aide en
    urgence.
  </li>
</ul>

<p>
Pour des détails à propos de l'implémentation des nouveaux paquets, vous pouvez
consulter les <uri
link="http://article.gmane.org/gmane.linux.gentoo.devel/30050">e-mails de
Stuart sur gentoo-dev</uri> et les entrées dans le blog de Stuart à partir de
<uri
link="http://stu.gnqs.org/diary/gentoo.php/2005/07/11/radical_changes_for_php5_support">
'Radical Changes for PHP5 Support'</uri> (N.d.t. 'Changements radicaux pour le
support de PHP5').
</p>

<p>
Sur la <uri link="http://svn.gnqs.org/projects/gentoo-php-overlay">Page de
développement</uri>, vous trouverez beaucoup de documentation et des ebuilds
plus récents qui seront intégrés dans l'arbre de Portage officiel plus tard.
</p>

</body>
</section>
</chapter>

</guide>
