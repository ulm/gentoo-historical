<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/es/php/Attic/php-guide.xml,v 1.1 2011/01/08 17:46:42 nimiux Exp $ -->

<guide lang="es">
<title>Actualizando PHP</title>

<author title="Author">
 <mail link="akorthaus@web.de">Andreas Korthaus</mail>
 <mail link="mabi@gentoo.org">Matti Bickel</mail>
 <mail link="olemarkus@gentoo.org">Ole Markus With</mail>
</author>
<author title="Traductor">
  <mail link="warp3r@gmail.com">Jordi Molina</mail>
</author>
<author title="Traductor">
  <mail link="nimiux"/>
</author>

<abstract>
Este documento describe cómo configurar PHP en Gentoo.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.6</version>
<date>2011-01-05</date>

<chapter>
<title>El paquete PHP</title>
<section>
<title>Paquetes PHP básicos consolidados</title>

<body>

<p>
Existe únicamente un paquete php package (al contrario que los casos
como cgi, cli o apache en los que hay un paquete para cada SAPI
(Server Application Programming Interface o Interfaz de Programación
de Aplicaciones Servidor)). Puede habilitar las SAPIs que desee a
través de los ajustes USE en <c>dev-lang/php</c>. Una lista de las
SAPIs disponibles se muestra debajo.
Puede combinarlas como desee, pero, obviamente necesita al menos una
de ellas para poder usar su instalación php.
</p>

<p>
Para elegir el SAPI que desea usar, utilice los siguientes ajustes USE:
</p>

<ul>
  <li><c>cgi</c> - compila e instala <path>/usr/bin/php-cgi</path></li>
  <li><c>cli</c> - compila e instala <path>/usr/bin/php</path></li>
  <li><c>apache2</c> - compila e instala <c>mod_php</c> for Apache 2</li>
  <li>
    <c>fpm</c> - compila e instala el Gestor de procesos de PHP FastCgi
    (únicamente disponible en PHP-5.3 y superiores)
  </li>
  <li><c>embed</c> - compila e instala el cliente PHP incrustado</li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Ranuras (Slotting)</title>

<section>
<title>Ranuras de versiones menores</title>

<body>

<p>
El equipo de php decidió facilitar la transición entre PHP-5.2 y
PHP-5.3  permitiendo a los usuarios instalar ambas versiones de forma
concurrente. Usando las SAPIs cgi o FPM, se puede incluso servir
páginas web usando PHP-5.2 y PHP-5.3 a la vez (o PHP-5.4 una vez sea
liberado).
</p>

<p>
Para la implementación de ranuras de versiones menores, elegimos un
enfoque similar al que usó el equipo de ruby; puede ajustar la variable
global <c>PHP_TARGETS</c> para controlar qué ranuras desea y gestionar
la versión activa usando un módulo eselect (mire el
<uri link="#doc_chap3">capítulo 3</uri>).
</p>

</body>
</section>
</chapter>

<chapter>
<title>Cambiando de ranuras de versiones mayores a versiones menores</title>

<section>
<title>Preparación</title>

<body>

<note>
Debido a la demanda popular, ahora es posible actualizar ranuras de
versiones mayores a menores sin necesidad de desinstalar php.
</note>

<note>
Si desea tener siempre las extensiones PHP compiladas para la última
versión estable, puede saltarse el primer paso.
</note>

<p>
Decida para qué versiones de PHP necesita tener las extensiones compiladas
y ajústelas en su <path>/etc/make.conf</path>.
</p>

<pre caption="Ajustando PHP_TARGETS en /etc/make.conf">
<comment># Correr PHP 5.3 y PHP 5.2 en paralelo</comment>
<var>PHP_TARGETS="php5-3 php5-2"</var>
</pre>

<p>
Puede definir los objetivos (targets) en cualquier orden. Observe que la
ranura php se llama "5.3" y el ajuste <c>PHP_TARGETS</c> correspondiente
es <c>php5-3</c>. Esto es debido a restricciones actuales en los nombres
de los ajustes USE.<br />Puede también ajustar <c>PHP_TARGETS</c> para
cada paquete de la siguiente forma:
</p>

<pre caption="Ajustando PHP_TARGETS en package.use">
<comment>; compilar el paquete mailparse únicamente para php-5.3</comment>
dev-php5/mailparse php_targets_php5-3
</pre>

<p>
A continuación, instale las versiones PHP que desee:
</p>

<pre caption="Instalando PHP-5.2 y -5.3">
emerge dev-lang/php:5.2 dev-lang/php:5.3
</pre>

<p>
Observe que usar <c>emerge php</c> es suficiente para obtener siempre la
última versión estable.
</p>

<p>
Actualice sus extensiones. Si tiene instaladas extensiones PHP como
suhosin o mailparse, necesitará reinstalarlas.<br />El equipo php ofrece
una ranura de versión menor compatible con todos los paquetes en la
categoría <c>dev-php5</c>.
</p>

<pre caption="Reinstalando todas las extensiones">
emerge -av $(equery depends dev-lang/php | egrep -v 'dev-php/|/php' | sed -e 's:^:=:')
</pre>

<warn>
Ejecutar ambas versiones de PHP con diferentes ajustes USE no está
soportado. Puede instalar paquetes con diferentes configuraciones, pero
no podrá registrar informes de error (bugs) sobre fallos.<br />El equipo
php está trabajando en una solución que automatizará esto en el futuro.
</warn>

<p>
Observe que <c>PHP_TARGETS</c> se muestra como una variable USE expandida.
<br />Algunas extensiones no están disponibles para todas las ranuras
(p.e. no han sido actualizadas para trabajar con PHP-5.3). Esto se indica
a través de la variable <c>USE_PHP</c> del siguiente modo:
</p>

<pre caption="Ebuild para una extensión que soporta únicamente PHP-5.2">
EAPI=2
USE_PHP="php5-2" # el valor por defecto debería ser "php5-2 php5-3"

inherit php-ext-source-r2
[...]
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Ranuras de versiones menores en detalle</title>
<section>
<title>Enlazando simbólicamente los binarios PHP</title>

<body>

<p>
La primera vez que instala una versión menor de una ranura PHP, se
invocará automáticamente al nuevo módulo eselect php para ajustar los
enlaces simbólicos en <path>/usr/bin</path> a los binarios PHP en
<path>/usr/lib/php5.3/bin</path> (se asume que antes ha instalado
php-5.3). Únicamente hay un enlace simbólica para cada SAPI fpm, cgi o
cli que haya habilitado a través de los ajustes USE. Además, se coloca
un enlace simbólico al módulo apache
<path>/usr/lib/php5.3/apache2/</path> en su directorio de módulos de
apache si instaló php con USE="apache2".
</p>

<p>
Ole Markus With ofreció generosamente un módulo eselect
(<c>app-admin/eselect-php</c>) para gestionar los enlaces simbólicos.
Puede listar y actualizar la versión activa de PHP para cada SAPI de
forma independiente. Aquí se muestra un ejemplo de uso de la SAPI
apache2:
</p>

<pre caption="Usando el módulo PHP eselect cuando tiene instalado PHP-5.2 y 5.3">
# <i>eselect php list apache2</i>
[1]   php5.2
[2]   php5.3 *

# <i>eselect php set apache2 1</i>
Tiene que ejecutar `/etc/init.d/apache2 restart' para que los cambios
tengan efecto.
</pre>

<p>
El módulo eselect soporta actualmente las SAPIs fpm, apache2, cli y cgi
</p>

</body>
</section>

<section>
<title>Ficheros de configuración</title>

<body>

<p>
El paquete PHP de Gentoo almacena su configuración en
<path>/etc/php</path>, el cual contiene un subdirectorio para cada
SAPI de cada versión PHP, p.e. los ficheros de configuración para+
la SAPI apache2 de PHP-5.3 se instalan en
<path>/etc/php/apache2-php5.3</path>
</p>

<pre caption="Listar los directorioes de configuración de  PHP">
$ <i>ls -1 /etc/php</i>
apache2-php5
cli-php5
cgi-php5
</pre>

<p>
Cada subdirectorio contiene su propio <path>php.ini</path>. Por otro
lado, las extensiones externas (compartidas) se guarda ahora en su
propio directorio <path>/etc/php/&amp;sapi>-&amp;ranura>/ext</path>.
Para habilitar o deshabilitar las extensiones compartidas, se usan
enlaces simbólicas en <path>/etc/php/*/ext-active</path>. Si quiere
habilitar una extensión, cree un enlace simbólica en
<path>/etc/php/*/ext-active</path> al correspondiente fichero
<path>&amp;extensión>.ini</path> en <path>/etc/php/*/ext/</path>. Si
quiere deshabilitar una extensión, elimine el enlace simbólico.
</p>

<note>
Si quiere instalar PHP como un módulo Apache, asegúrese de reiniciar
Apache después de la instalación y configuración.
</note>

</body>
</section>

<section>
<title>Configurando Apache para trabajar con PHP5</title>

<body>

<p>
Para configurar Apache para que cargue su módulo PHP5 module (mod_php),
tendrá que añadir <c>-D PHP5</c> a la variable <c>APACHE2_OPTS</c> en
<path>/etc/conf.d/apache2</path>.
</p>

<pre caption="Configurando Apache para cargar mod_php">
<comment>(ajustes para PHP5)</comment>
<i>APACHE2_OPTS="-D PHP5"</i>
</pre>

<note>
No puede usar a la vez dos módulos PHP diferentes con Apache.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Soporte / Obteniendo ayuda</title>
<section>

<body>

<p>
Si se encuentra con problemas con los nuevos paquetes PHP de Gentoo,
puede encontrar ayuda en:
</p>

<ul>
  <li>
    <uri link="http://overlays.gentoo.org/proj/php/wiki/CommonQuestions">
    Preguntas comunes</uri> sobre PHP en Gentoo.
  </li>
  <li>
    <uri link="http://overlays.gentoo.org/proj/php/">Página de desarrollo
    del overlay PHP</uri>
  </li>
  <li>
    #gentoo-php en irc.freenode.net; esta es la sala de chat en la que
    los autores de los overlays se dejan caer regularmente. ¡Nos
    encantaría verle por allí!.
  </li>
  <li>
    <uri link="http://forums.gentoo.org/">Foros de Gentoo</uri> son un
    lugar popular para pedir ayuda. Hay muchísimos usuarios de Gentoo
    leyendo los foros en cada momento, haciendo de éste muy buen lugar
    para pedir ayuda en una emergencia.
  </li>
</ul>

<p>
El la <uri link="http://overlays.gentoo.org/proj/php/">Página de
desarrollo</uri> encontrará mucha documentación y <uri
link="http://git.overlays.gentoo.org/gitweb/?p=proj/php.git">nuestro
repositorio git</uri> ofrece un lugar de pruebas para nuestros paquetes,
el cual moveremos al árbol oficial Portage posteriormente.
</p>

</body>
</section>
</chapter>
</guide>
