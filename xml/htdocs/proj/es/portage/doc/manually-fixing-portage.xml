<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/es/portage/doc/manually-fixing-portage.xml,v 1.1 2008/05/18 22:14:12 chiguire Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/proj/es/portage/doc/manually-fixing-portage.xml" lang="es">

<title>Reparando Instalaciones Rotas de Portage Manualmente</title>

<author>
  <mail link="genone@gentoo.org">Marius Mauch</mail>
</author>

<author title="Traductor">
   <mail link="sebasmagri@gmail.com">Sebastián Magrí</mail>
</author>

<abstract>
Este documento pretende ayudar a los usuarios a reparar manualmente
una instalación rota de sys-apps/portage.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>0.3</version>
<date>2007-05-31</date>

<chapter>
<title>Reparando Portage Manualmente</title>
<section>
<title>Propósito</title>
<body>

<p>
Esta sección tiene por fin ser una guía para actualizar o arreglar
manualmente su instalación de Portage en casos en los que usted no
pueda correr <c>emerge sys-apps/portage</c>. Aunque no es un
procedimiento difícil, aún debe hacerse con extremo cuidado, por favor
siga los pasos listados con exactitud, pero aplique sentido común
cuando sea necesario.
</p>

<note>Un guión que automatiza el siguiente procedimiento está disponible
<uri link="http://dev.gentoo.org/~genone/scripts/get_portage_back.sh">aquí</uri>.
</note>
</body>
</section>

<section>
<title>Obteniendo un tarball de Portage</title>
<body>

<p>
Lo primero que debes hacer es obtener un tarball de una versión
actualizada de Portage. En el siguiente texto usaremos
<e>portage-2.1.1</e> como ejemplo (ya que es la versión estable al
momento de edición del documento), por favor reemplácelo con una
versión presente en el árbol Portage en la medida de lo posible.
</p>

<warn>
Si tu versión instalada de Python reportada por <c>python -V</c> es
menor que 2.4, entonces debes elegir una versión de Portage compatible
con ésta. Si tienes por lo menos Python 2.3 entonces usa
<e>portage-2.1.1.tar.bz2</e>. Si tienes python 2.2 entonces utiliza
<e>portage-2.0.51.22.tar.bz2</e>.
</warn>

<p>
Dependiendo de la razón exacta por la cual Portage haya dejado de
trabajar, puede que aún sea posible usarlo para obtener el tarball,
primero que nada trata de correr <c>emerge --fetchonly
sys-apps/portage</c>, solo si eso no funciona tendrás que obtener el
tarball manualmente con:
</p>

<pre caption="Obteniendo el tarball de Portage con wget">
# <i>wget -P /usr/portage/distfiles http://distfiles.gentoo.org/distfiles/portage-2.1.1.tar.bz2</i>
</pre>

<p>
Después de esto el tarball debería estar disponible como
<path>/usr/portage/distfiles/portage-2.1.1.tar.bz2</path>.
</p>
</body>
</section>

<section>
<title>Reemplazando la versión instalada</title>
<body>

<p>
El próximo paso es desempaquetar el tarball en una localización
temporal, usando <path>/root/portage-recover</path> como ejemplo, los
comandos serían:
</p>

<pre caption="Desempaquetando el tarball de Portage">
# <i>cd /root</i>
# <i>mkdir portage-recover</i>
# <i>cd portage-recover</i>
# <i>tar xfj /usr/portage/distfiles/portage-2.1.1.tar.bz2</i>
</pre>

<p>
Una vez que hayas hecho esto es solo cuestión de reemplazar los
archivos de Python y Bash de tu sistema con los del tarball (en la
mayoría de los casos). Para hacer eso por favor ejecute:
</p>

<pre caption="Reemplazando los archivos del sistema">
# <i>cd /root/portage-recover/portage-2.1.1</i>
# <i>cp -R pym bin /usr/lib/portage/</i>
</pre>

<p>
Si no estás usando Gentoo en FreeBSD deberías remover el envoltorio de
sed, ya que este no es necesario y se sabe que causa problemas con
versiones antiguas de bash:
</p>

<pre caption="Eliminando el envoltorio de sed">
# <i>rm -f /usr/lib/portage/bin/sed</i>
</pre>

<note>
Si accidentalmente desinstalaste Portage o perdiste
<path>/etc/make.globals</path> por otras razones, deberías también
copiar <path>cnf/make.globals</path> de nuevo en <path>/etc</path>, de
otra manera Portage se podría comportar de manera extraña.
</note>

<note>
Si la versión previa de Portage era menor que 2.1, deberías ejecutar
ahora <c>emerge --metadata</c> antes de continuar con el siguiente
paso. Es necesario para convertir la metadata de los ebuilds al nuevo
formato usado a partir de Portage 2.1. Está bien ejecutarlo incluso si
no estás seguro de la versión previa de Portage.
</note>

<p>
Ahora deberías tener una instalación de Portage operativa de
nuevo. Sin embargo, para asegurarnos de la consistencia del sistema
deberías correr <c>emerge sys-apps/portage</c> de inmediato.
</p>

<p>
Si recibes un mensaje de error como <e>command not found</e> al tratar
de usar <c>emerge</c>, debes recrear el enlace simbólico al mismo:
</p>

<pre caption="Recreating the emerge symlink">
# <i>ln -s ../lib/portage/bin/emerge /usr/bin/emerge</i>
</pre>

<p>
Si estos pasos no funcionaron para ti, es muy probable que no sea un
problema de la instalación de Portage sino de otra cosa fuera del
alcance de este documento. Por favor revisa la <uri
link="/proj/en/portage/doc/common-problems.xml">Lista de Problemas
Comunes</uri> (en inglés) y mira también en <uri
link="http://bugs.gentoo.org">bugzilla</uri> si el problema ha sido
reportado.
</p>
</body>
</section>
</chapter>
</guide>
