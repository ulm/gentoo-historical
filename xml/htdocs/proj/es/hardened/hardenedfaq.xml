<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/proj/es/hardened/hardenedfaq.xml" lang="es">
<title>Preguntas de Uso Frecuente de Gentoo Hardened</title>
<author title="Autor">
  <mail link="tocharian@gentoo.org">Adam Mondl</mail>
</author>
<author title="Contribuidor">
  <mail link="solar@gentoo.org">solar</mail>
</author>
<author title="Contribuidor">
  <mail link="kang@gentoo.org">Guillaume Destuynder</mail>
</author>
<author title="Contribuidor">
  <mail link="pageexec@freemail.hu">El equipo de PaX</mail>
</author>
<author title="Traductor">
  <mail link="jgascon@gmail.com">Jaime Gascón Romero</mail>
</author>
<author title="Traductor">
  <mail link="nimiux"/>
</author>

<abstract>
Preguntas frecuentes surgidas en el canal IRC #gentoo-hardened y la
lista de correos gentoo-hardened.
</abstract>

<version>1.9</version>
<date>2006-02-18</date>

<chapter>
<title>Preguntas</title>
<section>
<title>Generales</title>
<body>

<ul>
  <li>
    <uri link="#toolchain">¿Qué es exactamente el "toolchain"?</uri>
  </li>
  <li>
    <uri link="#whichisbetter">¿Qué debería usar: grsecurity, RSBAC o
    SELinux?</uri>
  </li>
  <li>
    <uri link="#aclall">¿Se pueden usar usar grsecurity, RSBAC,
    SELinux y PaX al mismo tiempo?</uri>
  </li>
  <li>
    <uri link="#hardenedcflags">¿Necesito usar alguna bandera en
    LDFLAGS/CFLAGS para activar la compilación de PIE/SSP?</uri>
  </li>
  <li>
    <uri link="#hardenedcflagsoff">¿Cómo desactivo la compilación de
    PIE/SSP?</uri>
  </li>
  <li>
    <uri link="#fsexec">La compilación de mi núcleo falla con el
    error: "error: structure has no member named `curr_ip'", ¿cómo lo
    arreglo?</uri>
  </li>
  <li>
    <uri link="#hardenedproject">Acabo de encontrar el proyecto
    hardened, ¿tengo que instalar todo lo de la página del proyecto
    para instalar Gentoo Hardened?</uri>
  </li>
  <li>
    <uri link="#Othreessp">¿Por qué no funcionan mis programas cuando
    uso gcc hardened y CFLAGS="-O3"?</uri>
  </li>
  <li>
    <uri link="#cascadebootstrap">¿Qué ha pasado con
    bootstrap-cascade.sh?</uri>
  </li>
  <li>
    <uri link="#hardenedprofile">¿Cómo cambio al perfil
    hardened?</uri>
  </li>
  <li>
    <uri link="#hardeneddebug">¿Cómo depuro con gdb?</uri>
  </li>
</ul>

</body>
</section>

<section>
<title>PaX</title>
<body>

<ul>
  <li>
    <uri link="#paxinformation">¿Cuál es el sitio Web de PaX?</uri>
  </li>
  <li>
    <uri link="#paxgentoodoc">¿Qué documentación hay en Gentoo sobre
    PaX?</uri>
  </li>
  <li>
    <uri link="#paxnoelf">Me sale este mensaje: "error while loading
    shared libraries: cannot make segment writable for relocation:
    Permission denied." ¿Qué significa?</uri>
  </li>
  <li>
    <uri link="#paxjava">Desde que uso PaX no me funciona Java, ¿por
    qué?</uri>
  </li>
</ul>

</body>
</section>

<section>
<title>grsecurity</title>
<body>

<ul>
  <li>
    <uri link="#grsecinformation">¿Cuál es el sitio Web de
    grsecurity?</uri>
  </li>
  <li>
    <uri link="#grsecgentoodoc">¿Qué documentación hay en Gentoo sobre
    Grsecurity?</uri>
  </li>
  <li>
    <uri link="#grsec2681">¿Puedo usar Grsecurity con un núcleo 2.6.8,
    2.6.8.1, o 2.6.9?</uri>
  </li>
</ul>

</body>
</section>

<section>
<title>RSBAC</title>
<body>

<ul>
  <li>
    <uri link="#rsbacinformation">¿Cuál es el sitio Web de
    RSBAC?</uri>
  </li>
  <li>
    <uri link="#rsbacgentoodoc">¿Qué documentación hay en Gentoo sobre
    RSBAC?</uri>
  </li>
  <li>
    <uri link="#rsbacinitrd">¿Cómo uso un disco de inicio RAM con
    RSBAC?</uri>
  </li>
</ul>

</body>
</section>

<section>
<title>SELinux</title>
<body>

<ul>
  <li>
    <uri link="#selinuxfaq">¿Dónde están las preguntas de uso
    frecuente relacionadas con SELinux?</uri>
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Generales</title>
<section id="toolchain">
<title>¿Qué es exactamente el "toolchain"?</title>
<body>

<p>
El término "toolchain" se refiere a la combinación de paquetes de
software usados normalmente para construir y desarrollar para una
arquitectura determinada. El toolchain que tal vez haya oído nombrar
en el canal de IRC #gentoo-hardened consiste en el conjunto de
compiladores GCC (GNU Compiler Collection), binutils, y la librería C
de GNU (glibc).
</p>

</body>
</section>

<section id="whichisbetter">
<title>¿Qué debería usar: grsecurity, RSBAC o SELinux?</title>
<body>

<p>
La respuesta a esta pregunta es muy subjetiva, el proyecto Gentoo
Hardened sólo intenta proporcionar las tecnologías y dejar la elección
de cual usar al usuario. Esta decisión requiere mucha investigación
que esperamos facilitar con esta documentación. Sin embargo, si tiene
preguntas específicas acerca del modelo de seguridad que proporciona
cada una, no dude en preguntar al desarrollador pertinente en el canal
de IRC o en la lista de correo.
</p>

</body>
</section>

<section id="aclall">
<title>¿Se pueden usar usar grsecurity, RSBAC, SELinux y PaX al mismo
tiempo?</title>
<body>

<p>
Sí, es posible combinarlos ya que PaX funciona con grsecurity, RSBAC y
SELinux.  Sólo habría problemas si sólo puede usar un sistema de
control de acceso.
</p>

</body>
</section>

<section id="hardenedcflags">
<title>¿Necesito usar alguna bandera en LDFLAGS/CFLAGS para activar la
compilación de PIE/SSP?</title>
<body>

<p>
No, el toolchain actual implementa el equivalente de <c>CFLAGS="-fPIE
-fstack-protector-all" LDFLAGS="-Wl,-z,now -Wl,-z,relro"</c>
automáticamente mediante el archivo de especificaciones de GCC lo
cual, es una solución más apropiada. Los usuarios de hardened-gcc
anteriores deben añadir <c>USE="hardened pic"</c> a su
<path>/etc/make.conf</path> y actualizar con las siguientes ordenes:
</p>

<pre caption="Instalación del Toolchain Hardened">
# <i>emerge --oneshot binutils gcc virtual/libc</i>
# <i>emerge -e world</i>
</pre>

<note>
Gentoo parchea sus GCCs para permitir que se pasen archivos de
especificaciones mediante una variable de entorno. Actualmente se
instalan varios conjuntos de archivos de especificaciones en los
sistemas Gentoo para permitir a los usuarios de arquitecturas
soportadas activar o desactivar fácilmente la funcionalidad del
toolchain. Para acceder a los archivos de especificación como usuario
puede usar la utilidad gcc-config.
</note>

</body>
</section>

<section id="hardenedcflagsoff">
<title>¿Cómo desactivo la compilación de PIE/SSP?</title>
<body>

<p>
Puede usar <c>gcc-config</c> para hacerlo:
</p>

<pre caption="Ejemplo de salida de gcc-config">
# gcc-config -l
 [1] i686-pc-linux-gnu-3.4.4 *
 [2] i686-pc-linux-gnu-3.4.4-hardenednopie
 [3] i686-pc-linux-gnu-3.4.4-hardenednopiessp
 [4] i686-pc-linux-gnu-3.4.4-hardenednossp
 [5] i686-pc-linux-gnu-3.4.4-vanilla

<comment>Para desactivar el soporte SSP y cambiar al perfil
hardenednossp</comment>
# gcc-config i686-pc-linux-gnu-3.4.4-hardenednossp
</pre>

<p>
Puede conseguir lo mismo cambiando sus CFLAGS:
</p>

<p>
Para desactivar el uso de SSP en la compilación cuando se usa el
toolchain hardened añada <c>-fno-stack-protector-all
-fno-stack-protector</c> a sus CFLAGS.
</p>

<p>
Si quiere deshabilitar el uso de PIE añada <c>-nopie</c> a sus
<c>CFLAGS</c>.
</p>

<impo>
No se debe usar la bandera <c>-fno-pic</c> ya que habilita
específicamente el código no PIC. En cambio, si usa <c>-nopie</c>
revertirá al comportamiento "vanilla" de GCC que seguramente era el lo
que deseaba.
</impo>

<note>
Si está interesado en usar CFLAGS distintas dependiendo del paquete
con Portage seguro que le interesará el script que ha desarrollado
solar para tal propósito:
<uri>http://article.gmane.org/gmane.linux.gentoo.hardened/1204</uri>
</note>

</body>
</section>

<section id="fsexec">
<title>La compilación de mi núcleo falla con el error: "error:
structure has no member named `curr_ip'", ¿cómo lo arreglo?</title>
<body>

<p>
Para usar PaX con las fuentes hardened-sources debe activar también
Grsecurity en la configuración de su núcleo. Esto debería estar
resuelto en futuros núcleos.
</p>

</body>
</section>

<section id="hardenedproject">
<title>Acabo de encontrar el proyecto hardened, ¿tengo que instalar
todo lo de la página del proyecto para instalar Gentoo
Hardened?</title>
<body>

<p>
No, el Proyecto Gentoo Hardened es una colección de subproyectos que
tienen como meta común la seguridad. Mientras que muchos de estos
proyectos pueden ser instalados conjuntamente, pueden surgir algunos
conflictos debido a las diversas implementaciones de listas de control
de acceso (ACL) que ofrece el proyecto Gentoo Hardened.
</p>

</body>
</section>

<section id="Othreessp">
<title>¿Por qué no funcionan mis programas cuando uso gcc hardened y
CFLAGS="-O3"?</title>
<body>

<p>
Se sabe que el uso de la bandera de optimización <c>-O3</c> puede dar
problemas con el uso de la protección de ruptura de la pila SSP
(Stack-Smashing protector). Este bandera de optimización no está
soportado oficialmente y por lo tanto el equipo de hardened aconseja
que no se use. Los problemas de compilación cuando un usuario usa
<c>CFLAGS="-O3"</c> serán marcados como INVALID/CANTFIX e ignorados.
</p>

</body>
</section>

<section id="cascadebootstrap">
<title>¿Qué ha pasado con bootstrap-cascade.sh?</title>
<body>

<p>
Recientemente, el antiguo bootstrap.sh y bootstrap-2.6.sh han sido
marcados como obsoletos. En su lugar, bootstrap-cascade.sh se ha
renombrado a bootstrap.sh.
</p>
</body>
</section>

<section id="hardenedprofile">
<title>¿Cómo cambio al perfil hardened?</title>
<body>

<pre caption="Ajustar make.profile">
# <i>eselect profile list</i>
[1]   default/linux/amd64/10.0
[2]   default/linux/amd64/10.0/desktop
[3]   default/linux/amd64/10.0/desktop/gnome *
[4]   default/linux/amd64/10.0/desktop/kde
[5]   default/linux/amd64/10.0/developer
[6]   default/linux/amd64/10.0/no-multilib
[7]   default/linux/amd64/10.0/server
[8]   hardened/linux/amd64/10.0
[9]   hardened/linux/amd64/10.0/no-multilib
[10]  selinux/2007.0/amd64
[11]  selinux/2007.0/amd64/hardened
[12]  selinux/v2refpolicy/amd64
[13]  selinux/v2refpolicy/amd64/desktop
[14]  selinux/v2refpolicy/amd64/developer
[15]  selinux/v2refpolicy/amd64/hardened
[16]  selinux/v2refpolicy/amd64/server
# <i>eselect profile set 8</i> <comment>(Reemplace 8 por el perfil hardened deseado)</comment>
</pre>

<p>
Tras configurar su perfil debería recompilar su sistema usando el
toolchain de hardened para tener una base consistente:
</p>

<pre caption="Cambio al toolchain hardened">
# <i>emerge --oneshot binutils gcc virtual/libc</i>
# <i>emerge -e world</i>
</pre>
</body>
</section>

<section id="hardeneddebug">
<title>¿Cómo depuro con gdb?</title>
<body>

<p>
El primer problema es que GDB no resuelve símbolos en ejecutables PIE,
no se da cuenta de que las direcciones en dichos ejecutables son
relativas y no absolutas. Esto se pone de manifiesto, por ejemplo,
cuando se intenta obtener un "backtrace" y se ve un flujo de líneas
con caracteres '??' donde debería estar el símbolo en cuestión.
</p>

<p>
Para solucionar esto realice la etapa final de enlazado con la bandera
<c>-nopie</c>, todas las compilaciones de objetos anteriores serán
<c>-fPIE</c> como es normal (la opción predeterminada con el
compilador hardened), lo que hará el ejecutable sea lo más próximo
posible a como debería ser, aunque el enlazado final creará un
ejecutable normal. Intente añadir <c>-nopie</c> a las LDFLAGS si está
usando emerge.
</p>

<p>
Otra forma de hacerlo, es haciendo un emerge del paquete
>=sys-devel/gdb-7.1, que contiene un parche que le permite depurar
ejecutables enlazados con -pie.
</p>

<p>
El segundo problema es que PaX puede evitar que GDB establezca puntos
de ruptura dependiendo de como se haya configurado el núcleo. Esto
incluye el punto de ruptura en el main que usted necesita para
empezar. Para evitar que PaX interfiera con el ejecutable a depurar
necesita las banderas <c>m</c> y <c>x</c>. La bandera <c>x</c> está
configurada por defecto, así que basta con hacer:
</p>

<pre caption="Relajar PaX para depurar">
# <i>/sbin/paxctl -m foo</i>
</pre>

<p>
Llegados a este punto, ya debería estar preparado. Arranque gdb como
lo haría normalmente y ¡buena suerte!.
</p>

</body>
</section>

</chapter>

<chapter>
<title>Preguntas sobre PaX</title>
<section id="paxinformation">
<title>¿Cuál es el sitio Web de PaX?</title>
<body>

<p>
El sitio Web de PaX es: <uri>http://pax.grsecurity.net</uri>.
</p>

</body>
</section>

<section id="paxgentoodoc">
<title>¿Qué documentación hay en Gentoo sobre PaX?</title>
<body>

<p>
Actualmente la única documentación que hay en Gentoo sobre PaX es la
guía rápida de PaX en
<uri>http://www.gentoo.org/proj/en/hardened/pax-quickstart.xml</uri>.
</p>

</body>
</section>

<section id="paxnoelf">
<title>Me sale este mensaje: "error while loading shared libraries:
cannot make segment writable for relocation: Permission denied." ¿Qué
significa?</title>
<body>

<p>
Este error ocurre cuando se activa CONFIG_PAX_NOELFRELOCS:
</p>

<pre caption="Opciones de Menuconfig">
Non-executable page ->

 [*]   Disallow ELF text relocations
</pre>

<p>
Si usa el toolchain de gentoo hardened, al compilar sus programas
creará librerías ELF PIC sin relocalizaciones de texto. Sin embargo,
ciertas librerías todavía contienen relocalizaciones de texto por
varias circunstancias (a menudo son librerías que contienen código en
ensamblador escrito incorrectamente).  Esto puede ser una
vulnerabilidad ya que un atacante podría usar las librerías no-PIC
para ejecutar shellcode. Las librerías no-PIC también son malas para
el uso de memoria ya que no siguen el propósito de compartir código en
memoria de las librerías compartidas.
</p>

<p>
Para evitar este error y permitir que su programa se ejecute, deberá
sacrificar cierta seguridad y permitir generación de código durante la
ejecución para ese programa. La funcionalidad de PaX que le permite
hacer eso se llama MPROTECT. Deberá desactivar MPROTECT en todos los
ejecutables que usen librerías que no sean PIC.
</p>

<p>
Para buscar en su sistema relocalizaciones de texto, puede usar el
programa <c>scanelf</c> de <c>app-misc/pax-utils</c>. Si quiere más
información sobre cómo usar el paquete <c>pax-utils</c> visite, por
favor, la <uri link="/proj/en/hardened/pax-utils.xml"> Guia de Gentoo
de las utilidades PaX</uri>.
</p>

<note>
Versiones recientes de <c>sys-apps/portage</c>(>=2.0.53) buscan
automáticamente relocalizaciones de texto y muestran un mensaje de
aviso e incluso abortan el proceso merge dependiendo de las
<c>FEATURES</c> que haya habilitado en su <path>/etc/make.conf</path>.
</note>

</body>
</section>

<section id="paxjava">
<title>Desde que uso PaX no me funciona Java, ¿por qué?</title>
<body>

<p>
Como parte de su diseño, la máquina virtual de Java crea una cantidad
considerable de código durante la ejecución lo que no hace feliz a
PaX. Hay dos formas de corregir está situación:
</p>

<pre caption="Instalar Chpax">
# <i>emerge chpax</i>
# <i>/etc/init.d/chpax start</i>
</pre>

<p>
O si ya tiene <c>chpax</c> instalado, haga lo siguiente:
</p>

<pre caption="Opciones de Java de Chpax">
# <i>chpax -pemrxs /opt/*-jdk-*/{jre,}/bin/*</i>
</pre>

<p>
Las dos opciones modificarán ligeramente las cabeceras ELF para
ajustar correctamente las banderas PaX en los binarios.
</p>

<note>
Si usa PaX junto con otra implementación de seguridad como RSBAC,
grsecurity, o SELinux deberá manejar PaX usando las configuraciones
del núcleo provistas para cada implementación.
</note>

<p>
En RSBAC, puede etiquetar todos los archivos Java con la siguiente
orden:
</p>

<pre caption="Opciones PaX de Java con RSBAC">
# <i>for i in $(ls /opt/*(jdk|sdk)*/{jre,}/bin/*);do attr_set_file_dir FILE $i
pax_flags pmerxs;done</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Preguntas sobre grsecurity</title>
<section id="grsecinformation">
<title>¿Cuál es el sitio Web de grsecurity?</title>
<body>

<p>
El sitio Web de grsecurity es: <uri>http://www.grsecurity.net</uri>.
</p>
</body>
</section>

<section id="grsecgentoodoc">
<title>¿Qué documentación hay en Gentoo sobre Grsecurity?</title>
<body>

<p>
La documentación más actualizada sobre grsecurity es la Guía
Grsecurity v2 de Gentoo en
<uri>http://www.gentoo.org/proj/es/hardened/grsecurity.xml</uri>.
</p>

</body>
</section>

<section id="grsec2681">
<title>¿Puedo usar Grsecurity con un núcleo 2.6.8, 2.6.8.1, o 2.6.9?</title>
<body>

<p>
Debido a los significativos cambios introducidos en el núcleo 2.6.8,
que rompieron el soporte para PaX, no hay parches ni de PaX ni de
grsecurity disponibles para los núcleos 2.6.8, 2.6.8.1 y 2.6.9. Aunque
existe un parche experimental para el núcleo 2.6.10, debería conocer
la postura oficial del Equipo de PaX hacia los núcleos 2.6 y tenerla
en consideración antes de usarlos: <uri>
http://forums.grsecurity.net./viewtopic.php?t=968</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Preguntas sobre RSBAC</title>
<section id="rsbacinformation">
<title>¿Cuál es el sitio Web de RSBAC?</title>
<body>

<p>
El sitio Web de RSBAC es: <uri>http://www.rsbac.org</uri>.
</p>

</body>
</section>

<section id="rsbacgentoodoc">
<title>¿Qué documentación hay en Gentoo sobre RSBAC?</title>
<body>

<p>
Toda la documentación de Gentoo sobre RSBAC se encuentra en la página
del subproyecto RSBAC en:
<uri>http://www.gentoo.org/proj/en/hardened/rsbac/index.xml</uri>.
</p>

<p>
Además, puede encontrar documentación sobre RSBAC que no pertenece a
Gentoo en el manual de RSBAC en:
<uri>http://www.rsbac.org/documentation/rsbac_handbook</uri>.
</p>

</body>
</section>

<section id="rsbacinitrd">
<title>¿Cómo uso un disco de inicio RAM con RSBAC?</title>
<body>

<p>
Para usar un disco de inicio RAM (initrd) con un núcleo RSBAC se debe
habilitar una opción del núcleo o si no, RSBAC tratará el initrd como
si fuera el dispositivo raíz.
</p>

<pre caption="Opciones en menuconfig">
General RSBAC options  --->
    [*] Delayed init for initial ramdisk
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Preguntas sobre SELinux</title>
<section id="selinuxfaq">
<title>¿Dónde están las preguntas de uso frecuente relacionadas con
SELinux?</title>
<body>

<p>
Puede encontrar un PUF especifico de SELinux en:
<uri>http://www.gentoo.org/proj/en/hardened/selinux/selinux-handbook.xml?part=3&amp;chap=3</uri>.
</p>

</body>
</section>
</chapter>

</guide>
