<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/es/base/x86/gcc-upgrading-guide.xml,v 1.1 2005/12/03 19:05:33 chiguire Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/proj/es/base/x86/gcc-upgrading-guide.xml" lang="es">
<title>Guía de actualización de GCC en Gentoo Linux</title>

<author title="Autor">
  <mail link="amne@gentoo.org">Wernfried Haas</mail>
</author>

<author title="Autor">
  <mail link="wolf31o2@gentoo.org">Chris Gianelloni</mail>
</author>

<author title="Traductor">
  <mail link="anpereir@gentoo.org">Andrés Pereira</mail>
</author>

<abstract>
Este documento ofrece ayuda al usuario que actualiza
GCC en Gentoo Linux
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.1</version>
<date>2005-12-03</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
Esta guía documenta el proceso de actualización desde GCC 3.3 a GCC 3.4,
sin embargo, los conceptos descritos aquí son válidos para cualquier
actualización de GCC.
</p>

<p>
Instalar gcc 3.4.4 no tiene influencia en el sistema por si mismo. Para
usarlo tiene que realizar manualmente el cambio. Este paso puede tomar algo de
tiempo, así que asegúrese que tiene tiempo disponible y estar preparado para
esta tarea. Hay dos métodos para llevar a cabo la actualización. El primero
es rápido, pero potencialmente podría saltarse uno o dos paquetes que necesitan
actualizarse, mientras que el segundo método requiere más esfuerzo y
sustancialmente más compilación.
</p>

<note>
Antes de proceder con alguno de los métodos, por favor desactive distcc si
lo tiene activado. Si todos los nodos con distcc no tiene instalado gcc-3.4,
va a experimentar problemas de compilación.
</note>
</body>
</section>
</chapter>

<chapter>
<title>Usando revdep-rebuild (Método más rápido)</title>
<section>
<body>

<p>
Este método necesita que primero instale <c>gentoolkit</c> si es que
ya no lo ha hecho. Luego actualizaremos GCC y cambiaremos al nuevo
compilador.
</p>

<pre caption="Instalando gentoolkit y actualizando GCC">
# <i>emerge -an gentoolkit</i>
# <i>emerge -uav gcc</i>
# <i>gcc-config i686-pc-linux-gnu-3.4.4</i>
# <i>source /etc/profile</i>
</pre>

<note>
Esto asume que tiene configurada la variable de entorno
CHOST="i686-pc-linux-gnu". Si está usando otro CHOST, por favor
ajuste la línea apropiada de gcc-config.
</note>

<warn>
No configure ahora CFLAGS específicas de GCC 3.4 como -march=pentium-m.
De hacerlo va a causar fallas en sus compilaciones. Puede configurar
dichos parámetros luego de haber borrado gcc-3.3, el cual no las reconocerá.
</warn>

<p>
Ahora queremos ver qué paquetes revdep-rebuild considerará que
deben ser recompilados. Luego le diremos a revdep-rebuild que
recompile dichos paquetes. Esto puede tomar algo de tiempo, así que
tenga paciencia.
</p>

<pre caption="Usando revdep-rebuild">
# <i>revdep-rebuild --library libstdc++.so.5 -- -pv</i>
# <i>revdep-rebuild --library libstdc++.so.5</i>
</pre>

<p>
Es posible que tenga problemas con versiones de paquetes inexistentes debido
a que estén enmascarados o sean antiguos. Si este es el caso, tendrá que
usar la opción -X con revdep-rebuild. Esto hace que los paquetes
sean recompilados basados en su nombre en vez de la versión y nombre exacto.
</p>

<pre caption="Usando revdep-rebuild con la opción -X">
# <i>revdep-rebuild -X --library libstdc++.so.5 -- -pv</i>
# <i>revdep-rebuild -X --library libstdc++.so.5</i>
</pre>

<p>
Para tener compatibilidad con aplicaciones binarias en C++ y
cualquiera de los paquetes que revdep-rebuild puede haber saltado,
el paquete <c>sys-libs/libstdc++-v3</c> tiene que ser instalado 
antes de que desinstale GCC 3.3 de su sistema.
</p>

<pre caption="Instalando libstdc++-v3 y desinstalando GCC 3.3">
# <i>emerge -1 sys-libs/libstdc++-v3</i>
# <i>emerge -aC =sys-devel/gcc-3.3*</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Usando emerge -e (Método más seguro)</title>
<section>

<body>
<p>
Este método, aunque es mucho más lento, recompila todo su sistema
para asegurar que se todo se haya recompilado con su nuevo compilador.
Primero, actualice GCC y cámbiese a su nuevo compilador.
</p>

<pre caption="Actualizando GCC">
# <i>emerge -uav gcc</i>
# <i>gcc-config i686-pc-linux-gnu-3.4.4</i>
# <i>source /etc/profile</i>
</pre>

<note>
Esto asume que tiene configurada la variable de entorno
CHOST="i686-pc-linux-gnu". Si está usando otro CHOST, por favor
ajuste la línea apropiada de gcc-config.
</note>

<warn>
No configure ahora CFLAGS específicas de GCC 3.4 como -march=pentium-m.
De hacerlo va a causar fallas en sus compilaciones. Puede configurar
dichos parámetros luego de haber borrado gcc-3.3, el cual no las reconocerá.
</warn>

<p>
Para tener compatibilidad con aplicaciones binarias en C++ 
el paquete <c>sys-libs/libstdc++-v3</c> tiene que ser instalado 
en su sistema.
</p>

<pre caption="Instalando libstdc++-v3">
# <i>emerge -1 sys-libs/libstdc++-v3</i>
</pre>

<p>
Ahora primero recompilaremos los paquetes centrales (system) y luego el 
sistema completo (world). Esto va a tomar mucho tiempo dependiendo del
número de paquetes que tenga instalado, pues recompilará el toolchain
entero y los archivos de apoyo del sistema, seguido de cada paquete
existente en su sistema. Esto es necesario para asegurar que todos los
paquetes hayan sido compilados con el nuevo toolchain, incluyendo
el toolchain también.
</p>

<pre caption="Recopilando system y world">
# <i>emerge -e system</i>
# <i>emerge -e world</i>
</pre>

<p>
También es seguro borrar las versiones antiguas de GCC en este
momento.
</p>

<pre caption="Limpiando el sistema">
# <i>emerge -aC =sys-devel/gcc-3.3*</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Indicaciones y problemas</title>
<section>

<body>
  <ul>
    <li>
    Una vez que los módulos del núcleo (por ejemplo, app-emulation/qemu-softmmu)
    hayan sido recompilados con GCC 3.4, no funcionarán más con su antiguo
    núcleo. Recompilar el núcleo con GCC 3.4 soluciona el problema.
    </li>
    <li>
    Si revdep-rebuild parece que quiere recompilar los paquetes incluso después
    de que ya han sido recompilados, prosiga. Los paquetes deberían funcionar
    todavía.
    </li>
    <li>
    Si un paquete falla durante emerge -e system/world puede continuar el
    proceso con <c>emerge --resume</c>. Si un paquete falla repetidamente,
    sáltelo con <c>emerge --resume --skipfirst</c>. No ejecute otras instancias
    de emerge entre medio o perderá la información para reanudar.
    </li>
    <li>
    Si observa el error: libtool: link: 
    `/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.6/libstdc++.la' is not a
    valid libtool archive, entonces ejecute <c>/sbin/fix_libtool_files.sh
    3.3.6</c>
    </li>
    <li>
    Si <c>/sbin/fix_libtool_files.sh</c> fue borrado cuando desinstaló GCC,
    necesita reinstalar GCC. Esto puede pasar si ejecuta 
    <c>emerge -e system</c> y GCC 3.3 se compila después de 3.4. 
    Si no quiere reinstalar de nuevo GCC, intente recuperar
    <c>/lib/rcscripts/awk/fixlafiles.awk</c> y
    <c>/sbin/fix_libtool_files.sh</c> desde
    <c>/usr/portage/sys-devel/gcc/files</c> y
    <c>/usr/portage/sys-devel/gcc/files/awk</c>.  Esto hará que
    dichos archivos no los reconozca Portage y su próxima instalación
    podría fallar cuando use FEATURES=collision-protect.
    </li>
    <li>
    Si observa el error: /usr/bin/gcc-config: line 632:
    /etc/env.d/gcc/i686-pc-linux-gnu-3.3.5: No such file or
    directory, intente borrar
    <c>/etc/env.d/gcc/config-i686-pc-linux-gnu</c> y ejecute
    <c>gcc-config</c> de nuevo, seguido por <c>source /etc/profile</c>.
    Solamente haga esto si no tiene configurado algún compilador
    cruzado.
    </li>
</ul>

<p>
Hay discusiones sobre este tópico en los <uri
link="http://forums.gentoo.org/viewtopic-t-407840.html">Foros</uri>.
</p>
</body>
</section>
</chapter>
</guide>
