<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/it/base/amd64/howtos/Attic/2005.0-upgrade-amd64.xml,v 1.1 2005/10/21 12:41:50 so Exp $ -->

<!-- The context of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommonds.org/licenses/by-sa/2.5 -->

<sections>

<version>1.3.4</version>
<date>2005-09-10</date>

<section>
<title>Aggiornare alla versione 2005.0 multilib</title>
<body>

<p>
Multilib è il profilo base della versione 2005.0.  Se si desidera avere un
sistema solo a 64bit, si deve usare il profilo 2005.0/no-multilib.  Questa
guida mostra come aggiornare una precedente installazione ad un sistema che
utilizza il nuovo profilo. Ci sono due strade per aggiornare: la facile, per
mezzo di uno script, o la più lunga, manualmente.
</p>

</body>

<subsection>
<title>Aggiornare con lo script</title>
<body>

<p>
Si raccomanda di utilizzare lo script di aggiornamento che agevola il processo.
</p>

<pre caption="Script di Aggiornamento">
# <i>cd /usr/portage/profiles/default-linux/amd64/2005.0/scripts</i>
# <i>sh ./2004.3-2005.0upgrade.sh</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</subsection>

<subsection>
<title>Aggiornamento manuale</title>
<body>

<p>
Se in questo momento avete USE=-multilib, è necessario impostare multilib in
USE e riemergere gcc.
</p>

<pre caption="Emergere un compilatore multilib">
# <i>USE=multilib emerge gcc</i>
<comment>Se ottenete un errore che indica che non avete un sandbox multilib,
è necessario impostare FEATURES=-sandbox</comment>
# <i>FEATURES=-sandbox USE=multilib emerge gcc</i>
</pre>

<p>
Inoltre, è necessario essere certi di avere la versione corretta dei
pacchetti toolchain/portage
</p>

<pre caption="Assicurarsi di avere una toolchain multilib">
# <i>emerge -v --oneshot '>=sys-apps/portage-2.0.51-r9'</i>
# <i>emerge -v --oneshot 'sys-apps/sandbox'</i> <comment>Solo se siete in ~amd64</comment>
# <i>emerge -v --oneshot '>=sys-devel/gcc-config-1.3.9'</i>
# <i>emerge -v --oneshot '>=sys-devel/distcc-2.18.3-r1'</i>
# <i>emerge -v --oneshot '>=linux-headers-2.6.8.1-r4'</i>
</pre>

<p>
Dopo assicurarsi di avere la versione 32bit di glibc aggiornata. Questa
versione è necessaria per effettuare il bootstrap della versione 32bit delle
glibc compilata dopo l'attivazione del profilo.
</p>

<pre caption="Prendere l'ultima versione 32bit di glibc">
# <i>emerge -v --oneshot '>=emul-linux-x86-glibc-2.3.4.20041102'</i>
</pre>

<p>
2005.0 non usa link simbolici per /lib32 e /usr/lib32 per emulare le
directory, cosi è necessario sostituire ai link simbolici delle directory e
copiare alcuni importanti file.
</p>

<pre caption="Preparazione manuale di /lib32 e /usr/lib32">
# <i>rm /lib32 /usr/lib32</i>
# <i>mkdir /lib32 /usr/lib32</i>
# <i>cp /emul/linux/x86/lib32/libsandbox.so /usr/lib32</i> <comment>Se state usando la branca stabile</comment>
# <i>cp /emul/linux/x86/usr/lib32/libsandbox.so /usr/lib32</i> <comment>Se siete in ~amd64</comment>
# <i>cp /emul/linux/x86/usr/lib32/libc.so /usr/lib32</i>
# <i>cp /emul/linux/x86/usr/lib32/libpthread.so /usr/lib32</i>
# <i>cp /emul/linux/x86/usr/lib32/*crt*.o /usr/lib32</i>
# <i>env-update</i>
</pre>

<p>
Ora è necessario essere sicuro che la vostra baselayout sia aggiornata, cosi
da garantire che /etc/env.d/04multilib esista.
</p>

<pre caption="Aggiornare baselayout">
# <i>emerge -v --oneshot baselayout</i>
</pre>

<p>
Ora si è pronti per attivare il profilo 2005.0
</p>

<pre caption="Cambiare il profilo">
# <i>rm /etc/make.profile</i>
# <i>ln -s /usr/portage/profiles/default-linux/amd64/2005.0 /etc/make.profile</i>
</pre>

<p>
Ora è possibile compilare glibc, disinstallare (l'obsoleta)
emul-linux-x86-glibc e aggiornare il sistema base. Dovreste emergere la
stessa versione di glibc che avete correntemente nel sistema per evitare
possibili problemi di compatibilità (che apparirebbero con un messaggio di
errore purante l'emerge).
</p>

<pre caption="Concludere l'aggiornamento">
# <i>emerge -v --oneshot emerge -v --oneshot sys-libs/glibc</i>
# <i>emerge unmerge emul-linux-x86-glibc</i>
# <i>rm /emul/linux/x86/usr/lib/libsandbox.*</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</subsection>

<subsection>
<title>Problemi comuni</title>
<body>

<p>
<b>Inizialmente USE=multilib emerge gcc (or sandbox) potrebbe dare 'skipping
incompatible /usr/lib/libc.so when searching for -lc'</b>
</p>

<p>
Questo problema è solitamente corretto facendo 'emerge -v --oneshot
emul-linux-x86-glibc'
</p>

<p>
<b>Impossibile calcolare la dimensione (long double)</b>
</p>

<p>
Se ci sono problemi quando ./configure sta eseguendo glibc, e indica
'checking size of long double... configure: error: cannot compute sizeof
(long double), 77', controllare il file config.log, e cercare l'errore.
Questa è la prima volta che la vostra toolchain è utilizzata per creare ed
eseguire una applicazione a 32bit. I problemi e le cause che potete
riscontrare sono:
</p>

<pre caption="Impossibile calcolare la dimensione (long double)">
<comment>libc.so non si trova</comment>
	Qualcosa è inconflitto con la vostra emul-linux-x86-glibc installata.
	Seguono questi passi:
		# <i>rm -rf /lib32 /usr/lib32</i>
		# <i>rm /etc/make.profile</i>
		# <i>ln -s /usr/portage/profiles/default-linux/amd64/2004.3 /etc/make.profile</i> <comment>O 2003.4/lib64 se quella era il vostro profilo originale</comment>
		# <i>emerge --sync</i> <comment>Una versione dello snapshot di portage più recente del 12 Luglio 2005, 2200 UTC, è necessaria</comment>
		# <i>emerge -v --oneshot '>=emul-linux-x86-glibc-2.3.4.20041102'</i>

		<comment>Se state aggiornando con lo script :</comment>
		# <i>rm /var/tmp/2005.0_upgrade/step[34]</i>
		# <i>cd /usr/portage/profiles/default-linux/amd64/2005.0/scripts</i>
		# <i>sh ./2004.3-2005.0upgrade.sh</i>

		<comment>Se state aggiornando manualmente:</comment>
		Continuare  a partire da "Preparazione manuale di /lib32 e /usr/lib32".

<comment>libsandbox.so non si trova</comment>
	Probabilmente non avete una versione multilib di sandbox o di portage. Il modo più semplice
	per risolvere questo problema è utilizzare FEATURES=-sandbox durante l'aggiornamento,
        ed emergere portage and sandbox al termine.

<comment>./conftest: non può eseguire file binari</comment>
	Probabilmente è necessario abilitare il supporto per l'esecuzione a 32bit nel kernel.
</pre>

<p>
<b>Unresolved symbols durante la compilazione o il linking di glibc</b>
</p>

<p>
Se ottenete un unresolved symbols durante un emerge di glibc, eseguite emerge
--sync e riprovate.  Una versione dello snapshot di portage più recente del
20 Agosto è necessaria. Se volete utilizzare uno snapshot precedente al 20
Agosto 2005, dovete utilizzare la stessa versione di glibc che avete sul
vostro sistema. Dopo aver completato l'aggiornamento alla versione 2005.0,
installate la glibc più recente.
</p>

</body>
</subsection>

</section>

<section>
<title>Aggiornare al profilo 2005.0/no-multilib (solo 64bit)</title>
<body>

<p>
Usare questo profilo se voi non volete installare applicazioni 32bit sul
vostro sistema. Questo significa che non sarete in grado di utilizzare giochi
x86, utilizzare openoffice-bin, mplayer-bin, mozilla-bin (con flash),
acroread, etc.
</p>

<pre caption="Cambiare sistema e aggiornare il sistema">
# <i>rm /etc/make.profile</i>
# <i>rm /lib32 /usr/lib32</i> <comment>(Solo se questa esiste)</comment>
# <i>ln -s /usr/portage/profiles/default-linux/amd64/2005.0/no-multilib /etc/make.profile</i>
# <i>emerge -upv system</i>
# <i>emerge -uv system</i>
</pre>

</body>
</section>

</sections>




