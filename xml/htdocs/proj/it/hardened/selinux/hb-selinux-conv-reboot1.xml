<?xml version='1.0' encoding="utf-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/it/hardened/selinux/Attic/hb-selinux-conv-reboot1.xml,v 1.4 2010/08/03 22:43:44 scen Exp $ -->

<sections>
<version>2.0</version>
<date>2007-07-22</date>

<section>
<title>Installare un kernel SELinux</title>
<subsection>
<body>

<p>
SELinux richiede un qualisiasi kernel 2.6: si suggerisce di utilizzare i
sorgenti hardened.
</p>

<note>
Al momento della stesura di questo documento la versione del kernel 2.6.28-r9
è la corrente release "hardened": tutte le istruzioni contenute in seguito
assumeranno di utilizzare almeno questa versione.
</note>

<warn>
Le versioni del kernel 2.6.14 e 2.6.15 non dovrebbero venire utilizzate dagli
utenti di XFS in quanto sono stati riscontrati dei bachi nel supporto a questo
filesystem.
</warn>

<pre caption="Installare un kernel appropriato">
<comment>Qualunque kernel 2.6</comment>
# <i>emerge hardened-sources</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Compilare il kernel con le opzioni di SELinux abilitate</title>
<subsection>
<body>

<p>
Il kernel deve essere compilato abilitando il supporto ai moduli di sicurezza, a
SELinux, a devpts e agli attributi estesi delle etichette di sicurezza (ndT:
"security labels"). Fare riferimento alla guida di installazione principale per
ulteriori informazioni sulla configurazione.
</p>

<note>
Le opzioni disponibili potrebbero differire lievemente in base alla versione
del kernel utilizzata. In particolare, Btrfs sarà disponibile a partire dalla
versione 2.6.29 del kernel, mentre le opzioni riguardanti gli Attributi Estesi
(ndT: "Extended Attributes") e le Etichette di Sicurezza (ndT: "Security
Labels") per /dev/pts e tmpfs è diventata obsoleta con la versione del kernel
2.6.13 (oltre la quale sono state abilitate di default).
"Default Linux Capabilies" all'interno del menù "Security options" è diventata
altrettanto obsoleta a partire dalla versione 2.6.26 (abilitata di default).
</note>

<pre caption="Posizioni ed opzioni richieste sotto menuconfig">
<comment>Menù "General setup"</comment>
[*] Prompt for development and/or incomplete code/drivers
[*] Auditing support
[*]   Enable system-call auditing support

<comment>Menù "File systems"</comment>
&lt;*&gt; Second extended fs support <comment>(per abilitare ext2)</comment>
[*]   Ext2 extended attributes
[ ]     Ext2 POSIX Access Control Lists
[*]     Ext2 Security Labels
[ ]   Ext2 Execute in place support
&lt;*&gt; Ext3 journalling file system support <comment>(per abilitare ext3)
</comment>
[*]   Ext3 extended attributes
[ ]     Ext3 POSIX Access Control Lists
[*]     Ext3 Security labels
&lt;*&gt; The Extended 4 (ext4) filesystem <comment>(If using ext4)</comment>
[ ]   Enable ext4dev compatibility
[*]   Ext4 extended attrributes
[ ]     Ext4 POSIX Access Control Lists
[*]     Ext4 Security Labels
&lt;*&gt; JFS filesystem support <comment>(per abilitare JFS)</comment>
[ ]   JFS POSIX Access Control Lists
[*]   JFS Security Labels
[ ]   JFS debugging
[ ]   JFS statistics
&lt;*&gt; XFS filesystem support <comment>(per abilitare XFS)</comment>
[ ]   XFS Quota support
[ ]   XFS POSIX ACL support
[ ]   XFS Realtime subvolume support (EXPERIMENTAL)
[ ]   XFS Debugging Support
&lt;*&gt; Btrfs filesystem (EXPERIMENTAL) Unstable disk format <comment>(if
using Btrfs)</comment>
[ ]   Btrfs POSIX Access Control Lists (NEW)

<comment>Menù "Pseudo filesystems" (all'interno di "File systems")</comment>
[ ] /dev file system support (EXPERIMENTAL)
[*]   /dev/pts Extended Attributes
[*]     /dev/pts Security Labels
[*] Virtual memory file system support (former shm fs)
[*]   tmpfs Extended Attributes
[*]     tmpfs Security Labels

<comment>Menù "Security options"</comment>
[*] Enable different security models
[*]   Socket and Networking Security Hooks
&lt;*&gt;   Default Linux Capabilities
[*] NSA SELinux Support
[ ]   NSA SELinux boot parameter
[ ]   NSA SELinux runtime disable
[*]   NSA SELinux Development Support
[ ]   NSA SELinux AVC Statistics
(1)   NSA SELinux checkreqprot default value
[ ]   NSA SELinux enable new secmark network controls by default
[ ]   NSA SELinux maximum supported policy format version
</pre>

<p>
Occorre abilitare il supporto agli attributi estesi delle security label per
devpts e per i filesystem utilizzati. Devfs non è utilizzabile in SELinux, e
dovrebbe essere disattivato. Non tutte le opzioni descritte sono presenti nei
vecchi kernel 2.6, come per esempio il supporto ad Auditing e runtime disable.
Nei kernel più recenti, il supporto agli attributi estesi per i filesystem
virtuali proc e tmpfs vengono abilitati in modo predefinito; in questo caso, non
apparirà nessuna opzione all'interno del menù di configurazione.
</p>

<note>
Nel caso in cui si stiano utilizzando i sorgenti "hardened" (come consigliato),
si raccomanda di configurare anche PaX. Ulteriori informazioni a riguardo
possono essere reperite nel corrispondente <uri
link="http://www.gentoo.org/proj/it/hardened/pax-quickstart.xml">Guida rapida
per PaX su Gentoo Hardened</uri>
</note>

<warn>
Non abilitare l'opzione "SELinux MLS policy" anche se è disponibile, in quanto
non è supportata e inibirà il riavvio della macchina.
</warn>

<p>
Ora è possibile compilare ed installare il kernel ed i moduli, ma non riavviare.
</p>

</body>
</subsection>
</section>
<section>
<title>Aggiornare fstab</title>
<subsection>
<body>

<p>
Affinchè SELinuxfs venga montato all'avvio, occorre aggiornare /etc/fstab nel
seguente modo:
</p>

<pre caption="Impostazioni di Fstab per selinuxfs">
none    /selinux       selinuxfs       defaults        0       0
</pre>

</body>
</subsection>
</section>
<section>
<title>Configurare Baselayout</title>
<subsection>
<body>

<p>
SELinux non supporta devfs, quindi occorre configurare baselayout per utilizzare
nodi di dispositivi statici oppure udev: se si opta per quest'ultimo, è
necessario disabilitare il salvataggio dei device in un archivio tar.
Modificare quindi il file /etc/conf.d/rc impostando RC_DEVICES a "static" o
"udev", e RC_DEVICE_TARBALL a "no". In presenza di numerosi device
personalizzati è consigliabile utilizzare static, in caso contrario udev
(quest'ultimo è l'impostazione di default al momento della stesura di questo
manuale). Per ulteriori informazioni al riguardo, si consulti la
<uri link="/doc/it/udev-guide.xml">Guida a UDEV su Gentoo</uri>.

</p>

<pre caption="Configurazione degli Init script">
# Use this variable to control the /dev management behavior.
#  auto   - let the scripts figure out what's best at boot
#  devfs  - use devfs (requires sys-fs/devfsd)
#  udev   - use udev (requires sys-fs/udev)
#  static - let the user manage /dev

<i>RC_DEVICES="<comment>udev</comment>"</i>

# UDEV OPTION:
# Set to "yes" if you want to save /dev to a tarball on shutdown
# and restore it on startup.  This is useful if you have a lot of
# custom device nodes that udev does not handle/know about.

<i>RC_DEVICE_TARBALL="<comment>no</comment>"</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Riavviare</title>
<subsection>
<body>

<p>
Infine prima di riavviare è necessario creare alcune directory.
</p>

<pre caption="Creare le directory richieste">
# <i>mkdir /selinux</i>
# <i>mkdir /sys</i>
</pre>

<p>
Infine riavviare.
</p>

</body>
</subsection>
</section>
</sections>