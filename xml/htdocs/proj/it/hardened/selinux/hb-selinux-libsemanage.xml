<?xml version='1.0' encoding="utf-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/it/hardened/selinux/Attic/hb-selinux-libsemanage.xml,v 1.1 2007/08/21 07:09:34 scen Exp $ -->

<sections>

<version>1.0</version>
<date>2006-10-15</date>

<section>
<title>Infrastruttura di gestione di SELinux</title>
<subsection>
<body>

<p>
L'infrastruttura di gestione di SELinux ricopre numerosi aspetti delle politiche
di SELinux. Queste applicazioni gestionali sono basate sulle librerie principali
di libsemanage. Esistono numerosi programmi gestionali per le varie operazioni,
tra cui <c>semanage</c> e <c>semodule</c>. Questi permettono di configurare
alcuni aspetti delle poliche senza richiederne i sorgenti.
</p>

</body>
</subsection>
</section>

<section>
<title>Gestione dei moduli delle politiche di SELinux</title>
<subsection>
<title>Cos'è un modulo di una politica?</title>
<body>

<p>
SELinux supporta politiche modulari. Questo significa che numerosi parti di una
politica vengono combinate per costituirne una completa pronta a venire caricata
nel kernel, secondo una struttura che ricalca quella dei moduli del kernel: è
presente un'immagine principale del kernel e differenti moduli che possono
venire aggiunti (a patto che le dipendenze vengano soddisfatte) o rimossi senza
necessità di riavviare il sistema. In maniera molto simile ogni politica è
composta da un modulo base e alcuni moduli (se presenti), generati in fase di
creazione della politica. I moduli vengono creati compilando una parte di
politica, e viene creato un pacchetto di politica (*.pp) contenete la politica
compilata ed opzionalmente i contesti dei file.
</p>

<p>
Il pacchetto dei moduli della politica base (base.pp) contiene i requisiti
basilari per le politiche. Tutte le politiche modulari hanno bisogno almeno dei
moduli base. In Gentoo, vengono messe a disposizione queste politiche per tutte
le parti del profilo di sistema contenute nell'ebuild selinux-base-policy. Gli
ebuild delle altre politiche sono composte da uno o più moduli di politica.
</p>

<p>
Per ulteriori informazioni riguardo alla scrittura di un modulo di politica, ed
in particolare su come gestire le proprie personalizzazioni, fare riferimento
alla <uri link="selinux-handbook.xml?part=3&amp;chap=5">guida alle politiche
modulari</uri>.
</p>

</body>
</subsection>
<subsection>
<title>L'archivio dei moduli di SELinux</title>
<body>

<p>
Nel momento in cui un modulo di una politica viene inserito o rimosso, viene
anche copiato o eliminato dall'archivio dei moduli. Questo archivio mantiene una
copia dei moduli utilizzati per creare la politica correntemente attiva, in
aggiunta ai numerosi file ausiliari. L'archivio viene salvato nella cartella
/etc/selinux/{strict,targeted}/modules. Sarebbe opportuno non accedere mai
direttamente ai contenuti dell'archivio dei moduli: in caso di necessità, si
dovrebbe utilizzare un'applicazione basata su libsemanage.
</p>

<p>
Libsemanage gestisce l'archivio dei moduli per transizioni: questo significa che
se viene eseguito un insieme di operazioni (una transazione) sull'archivio ma
una o più operazioni falliscono, l'intera transazione viene abortita. Questo fa
si che l'archivio sia sempre mantenuto in uno stato consistente.
</p>

<p>
La gestione dell'archivio dei moduli viene effettuata tramite il comando
<c>semodule</c>. Tramite l'opzione <c>-l</c> si ottiene l'elenco dei contenuti
dell'archivio dei moduli.
</p>

<pre caption="">
# semodule -l
distcc  1.1.1
</pre>

<p>
Dal momento che il modulo base è richiesto in tutti i casi, e non ha nessuna
versione associata, non verrà mostrato nella lista. Tutti gli altri moduli
verranno elencati, affiancati dalla loro versione.
</p>

</body>
</subsection>
<subsection>
<title>Inserire un modulo in una politica</title>
<body>

<p>
Si dovrebbe fare riferimento al modulo in questione tramite il nome del suo
file.
</p>

<pre caption="">
# <i>semodule -i module.pp</i>
</pre>

<p>
Questo comando inserirà il modulo all'interno dell'archivio per la politica
correntemente configurata, come specificato in /etc/selinux/config. Se
l'inserimento avviene con successo, la politica verrà caricata, a meno che non
sia stata utilizzata l'opzione <c>-n</c>. Per inserire il modulo di un altro
archivio, utilizzare l'opzione <c>-s</c>.
</p>

<pre caption="">
# <i>semodule -s archivio -i module.pp</i>
</pre>

<p>
Siccome questo comando fa riferimento ad un'archivio alternativo, la politica
non verrà caricata.
</p>

</body>
</subsection>
<subsection>
<title>Rimuovere un modulo da una politica</title>
<body>

<p>
Si dovrebbe fare riferimento al modulo in questione tramite il suo nome
all'interno dell'archivio.
</p>

<pre caption="">
# <i>semodule -r module</i>
</pre>

<p>
Questo comando rimuoverà il modulo dall'archivio per la politica attualmente
configurata come specificato in /etc/selinux/config. Se la rimozione avviene con
successo, la politica verrà caricata, a meno che non sia stata utilizzata
l'opzione <c>-n</c>. L'opzione <c>-s</c> è valida anche per il comando di
rimozione.
</p>

</body>
</subsection>
</section>

<section>
<title>Configurare le corrispondenze degli utenti all'autenticazione</title>
<subsection>
<body>

<p>
Il metodo corrente per assegnare un insieme di ruoli ad un utente consiste nel
configurare una corrispondenza tra gli utenti di linux e le identità di SELinux.
Nel momento in cui un utente accede al sistema, il programma di autenticazione
associerà l'identità di SELinux basandosi sulle corrispondenze precedentemente
configurate. Nel caso in cui non esista una corrispondenza esplicita, viene
utilizzata quella predefinita (<c>__default__</c>). 
</p>

<p>
La gestione delle corrispondenze degli utenti SELinux viene effettuata tramite
il programma <c>semanage</c>.
</p>

<pre caption="Mappatura degli utenti SELinux">
# <i>semanage login -l</i>
Login Name                SELinux User

__default__               user_u
root                      root
</pre>

</body>
</subsection>
<subsection>
<title>Aggiungere la mappatura all'autenticazione di un utente</title>
<body>

<p>
Per associare l'utente linux <c>pebenito</c> all'identità di SELinux
<c>staff_u</c>, utilizzare il comando:
</p>

<pre caption="">
# <i>semanage login -a -s staff_u pebenito</i>
</pre>

<p>
Per ulteriori informazioni sulle identità di SELinux disponibili, fare
riferimento a <uri
link="selinux-handbook.xml?part=3&amp;chap=1#doc_chap3">Panoramica su
SELinux</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Rimuovere una mappatura all'autenticazione di un utente</title>
<body>

<p>
Per rimuovere l'associazione dell'utente <c>pebenito</c>, utilizzare il comando:
</p>

<pre caption="">
# <i>semanage login -d pebenito</i>
</pre>

<note>
Le corrispondenze specificate da una politica (e non dall'infrastruttura
gestionale) non possono essere rimosse.
</note>

</body>
</subsection>
</section>

<section>
<title>Configurare lo stato iniziale dei valori booleani</title>
<subsection>
<body>

<p>
Il programma <c>setsebool</c> ora fa parte dell'utility libsemanage. La
principale funzione di questo programma è di impostare lo stato di un booleano.
Comunque, se la macchina è appena stata riavviata, i booleani verranno impostati
utilizzando lo stato iniziale specificato nella politica. Per impostare tale
stato, e fare in modo che venga salvato come stato iniziale della politica,
utilizzare il comando <c>setsebool</c> con l'opzione <c>-P</c>.
</p>

<pre caption="Impostare lo stato iniziale di un booleano">
# <i>setsebool -P fcron_crond 1</i>
</pre>

<p>
Questo comando imposterà il booleano fcron_crond a vero (true) e farà in modo
che diventi il suo stato iniziale.
</p>

</body>
</subsection>
</section>

<section>
<title>Configurare le identità di SELinux</title>
<subsection>
<body>

<p>
Solitamente non è necessario aggiungere le identità di SELinux alla politica, in
quanto è sufficiente la mappatura degli utenti all'autenticazione. In ogni caso,
un motivo per aggiungerle è per aumentarne le leggibilità, dal momento che
l'identità di SELinux è parte del testo del messaggio di negazione.
</p>

<p>
La gestione delle identità di SELinux viene effettuata tramite il comando
<c>semanage</c>.
</p>

<pre caption="Elencare le identità di SELinux">
# <i>semanage user -l</i>
SELinux User    SELinux Roles

root            sysadm_r staff_r
staff_u         sysadm_r staff_r
sysadm_u        sysadm_r
system_u        system_r
user_u          user_r
</pre>

</body>
</subsection>
<subsection>
<title>Aggiungere un'identità di SELinux</title>
<body>

<p>
Oltre a specificare i ruoli dell'identità da aggiungere, deve essere specificato
anche un prefisso. Quest'ultimo dovrebbe corrispondere ad un ruolo, per esempio
<c>staff</c> o <c>sysadm</c>, e verrà utilizzato come cartella home. Quindi, se
venisse utilizzato come prefisso <c>staff</c>, gli utenti linux che vengono
associati a questa identità troveranno le loro home directory marchiate
<c>staff_home_dir_t</c>.
</p>

<p>
Per aggiungere l'identità <c>test_u</c> con ruolo <c>staff_r</c> e
<c>sysadm_r</c> con prefisso <c>staff</c>, utilizzare:
</p>

<pre caption="">
# <i>semanage user -a -R 'staff_r sysadm_r' -P staff test_u</i>
</pre>

<note>
Per utilizzare l'identità di SELinux, occorre aggiungere una corrispondenza per
l'autenticazione dell'utente.
</note>

</body>
</subsection>
<subsection>
<title>Rimuovere una identità di SELinux</title>
<body>

<p>
Per rimuovere l'identità di SELinux <c>test_u</c>, utilizzare:
</p>

<pre caption="">
# <i>semanage user -d test_u</i>
</pre>

<note>
Le identità di SELinux specificate dalla politica (e non dall'infrastruttura
gestionale) non possono essere rimosse.
</note>

</body>
</subsection>
</section>

</sections>