<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/it/hardened/selinux/Attic/hb-selinux-loglocal.xml,v 1.2 2008/06/04 19:40:31 scen Exp $ -->

<sections>
<version>1.4</version>
<date>2004-11-16</date>

<section>
<title>Si comincia...</title>
<subsection>
<body>

<p>
Per effettuare le seguenti azioni, occorre appartenere al ruolo <c>sysadm_r</c>.
</p>

<p>
Eseguire <c>sestatus -v</c>. Selezionare il collegamento relativo al contesto
che non corrisponde:
</p>

<table>
<tr>
  <th>Processo</th>
  <th>Contesto</th>
</tr>
<tr>
  <ti>Init context</ti>
  <ti><uri link="#doc_chap2">system_u:system_r:init_t</uri></ti>
</tr>
<tr>
  <ti>/sbin/agetty</ti>
  <ti><uri link="#doc_chap3">system_u:system_r:getty_t</uri></ti>
</tr>
<tr>
  <th>File</th>
  <th>Contesto</th>
</tr>
<tr>
  <ti>/bin/login</ti>
  <ti><uri link="#doc_chap4">system_u:object_r:login_exec_t</uri></ti>
</tr>
<tr>
  <ti>/sbin/unix_chkpwd</ti>
  <ti><uri link="#doc_chap5">system_u:object_r:chkpwd_exec_t</uri></ti>
</tr>
<tr>
  <ti>/etc/passwd</ti>
  <ti><uri link="#doc_chap6">system_u:object_r:etc_t</uri></ti>
</tr>
<tr>
  <ti>/etc/shadow</ti>
  <ti><uri link="#doc_chap6">system_u:object_r:shadow_t</uri></ti>
</tr>
<tr>
  <ti>/bin/bash</ti>
  <ti><uri link="#doc_chap7">system_u:object_r:shell_exec_t</uri></ti>
</tr>
</table>

</body>
</subsection>
</section>
<section>
<title>Contesto iniziale errato</title>
<subsection>
<title>Verificare l'etichetta Init</title>
<body>

<p>
Esistono molti possibili motivi per cui init può utilizzare un contesto errato.
Anzitutto occorre verificare che init sia stato etichettato correttamente,
facendo riferimento al risultato del comando <c>sestatus</c> su /sbin/init. Nel
caso in cui sia differente da <c>system_u:object_r:init_exec_t</c>, etichettare
nuovamente sysvinit.
</p>

<pre caption="Correggere il contesto di init">
# <i>rlpkg sysvinit</i>
</pre>

</body>
</subsection>
<subsection>
<title>Verificare le politiche disponibili</title>
<body>

<p>
Per eseguire questa azione, occorre appartenere al ruolo <c>sysadm_r</c>.
</p>

<p>
SELinux deve necessariamente avere a disposizione almeno una politica binaria in
/etc/selinux/{strict,targeted}/policy. In caso contrario, installare la
politica.
</p>

<pre caption="Installare una politica binaria">
# <i>semodule -n -B</i>
</pre>

</body>
</subsection>

<subsection>
<title>Verificare che Init possa caricare la politica</title>
<body>

<p>
Controllo conclusivo per assicurarsi che Init possa caricare la politica:
eseguire <c>ldd</c> su init e -se il risultato fosse differente da libselinux-
emergere nuovamente sysvinit.
</p>

<pre caption="Controllare la corretta installazione di Init">
# <i>ldd /sbin/init</i>
  linux-gate.so.1 =>  (0xffffe000)
  <comment>libselinux.so.1 => /lib/libselinux.so.1 (0x40025000)</comment>
  libc.so.6 => /lib/libc.so.6 (0x40035000)
  /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)
</pre>

<p>
A questo punto occorre riavviare in modo che init ottenga il contesto corretto
e carichi la politica.
</p>

</body>
</subsection>
</section>
<section>
<title>Contesto di agetty non corretto</title>
<subsection>
<body>

<p>
Verificare che agetty sia stato etichettato correttamente: si faccia riferimento
al valore ritornato da sestatus per /sbin/agetty. Se il risultato fosse
differente da <c>system_u:object_r:getty_exec_t</c>, occorre etichettare
nuovamente util-linux e riavviare tutti i getty.
</p>

<pre caption="Correggere il contesto di agetty">
# <i>rlpkg util-linux</i>
# <i>killall agetty</i> <comment>(verranno riavviate tutte le istanze)</comment>
</pre>

<p>
Adesso tutti gli agetty dovrebbero aver ottenuto il corretto contesto
<c>system_u:object_r:getty_exec_t</c>: si provi a connettersi nuovamente.
</p>

</body>
</subsection>
</section>
<section>
<title>Contesto di Login non corretto</title>
<subsection>
<body>

<p>
Il programma di accesso (/bin/login) non è stato etichettato correttamente.
Ripetere l'operazione su shadow.
</p>

<pre caption="Rietichettare shadow">
# <i>rlpkg shadow</i>
</pre>

<p>
/bin/login adesso dovrebbe appartenere a <c>system_u:object_r:login_exec_t</c>.
Provare ad accedere nuovamente.
</p>

</body>
</subsection>
</section>
<section>
<title>Contesto di PAM non corretto</title>
<subsection>
<body>

<p>
Il server SSHd deve essere in grado di utilizzare PAM per l'autenticazione degli
utenti. Il programma di verifica delle password di PAM (/sbin/unix_chkpwd) deve
venire etichettato correttamente, così che sshd possa trasferire il contesto al
controllo della password. Etichettare nuovamente PAM.
</p>

<pre caption="Correggere il contesto di unix_chkpwd">
# <i>rlpkg pam</i>
</pre>

<p>
Il programma di verifica della password dovrebbe appartenere a
<c>system_u:object_r:chkpwd_exec_t</c>. Si provi ad accedere nuovamente.
</p>

</body>
</subsection>
</section>
<section>
<title>Contesto del file delle password errato</title>
<subsection>
<body>

<p>
I file delle password (/etc/passwd e /etc/shadow) devono essere etichettati
correttamente, altrimenti PAM non sarà in grado di autenticare gli utenti.
Etichettare nuovamente i file.
</p>

<pre caption="Correggere il contesto di shadow">
# <i>restorecon /etc/passwd /etc/shadow</i>
</pre>

<p>
I file delle password e shadow adesso dovrebbero appartenere rispettivamente a
<c>system_u:object_r:etc_t</c> e <c>system_u:object_r:shadow_t</c>. Riprovare ad
accedere.
</p>

</body>
</subsection>
</section>
<section>
<title>Contesto di Bash non corretto</title>
<subsection>
<body>

<p>
Bash deve essere etichettato correttamente, in modo da permettere la transizione
degli utenti nei propri domini nel momento in cui accedono al sistema.
Etichettare nuovamente bash.
</p>

<pre caption="Correggere il contesto di Bash">
# <i>rlpkg bash</i>
</pre>

<p>
Bash (/bin/bash) adesso dovrebbe appartenere a
<c>system_u:object_r:shell_exec_t</c>. Provare ad accedere nuovamente.
</p>

</body>
</subsection>
</section>
</sections>
