<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/proj/it/hardened/selinux/Attic/hb-selinux-localmod.xml,v 1.2 2008/02/03 19:48:49 scen Exp $ -->

<sections>

<version>1.0</version>
<date>2006-10-15</date>

<section>
<title>Introduzione</title>
<subsection>
<body>

<p>
Questa guida mostra come configurare un modulo di una politica in modo da
modificare localmente le regole di una politica.
</p>

</body>
</subsection>
</section>

<section>
<title>Preparazione</title>
<subsection>
<body>

<p>
Anzitutto occorre effettuare una copia del Makefile di esempio dalla cartella
dei documenti della politica di base (selinux-base-policy) nella cartella che
verrà utilizzata per costruire la politica. Si suggerisce di utilizzare la
cartella /root: la home directory del sysadm infatti è inclusa tra quelle in cui
lo strumento <c>semodule</c> cercherà i moduli delle politiche.
</p>

<pre caption="">
# <i>zcat /usr/share/doc/selinux-base-policy-20061008/Makefile.example.gz > /root/Makefile</i>
</pre>

</body>
</subsection>
</section>

<section>
<title>Scrivere un file TE</title>
<subsection>
<body>

<p>
Nei moduli delle politiche è possibile utilizzare la maggior parte delle
istruzioni di SELinux: occorre solamente aggiungere alcune istruzioni aggiuntive
per le operazioni specifiche.
</p>

<pre caption="Esempio di local.te">
policy_module(local,1.0)

require {
        type sysadm_su_t, newrole_t;
}
allow sysadm_su_t newrole_t:process sigchld;
</pre>

<p>
Oltre alla regola permissiva di base (allow), queste esempio mostra alcune
istruzioni richieste dai moduli delle politiche. La prima consiste in una macro
policy_module() che indica il nome del modulo e la sua versione. E' presente
inoltre un blocco require, nel quale vengono specificati tutti i tipi richiesti
da questo modulo affinchè funzioni correttamente. Tutti i tipi utilizzati nel
modulo devono essere dichiarati al suo interno o esplicitamente richiesti.
</p>

</body>
</subsection>
</section>

<section>
<title>Scrivere un file FC (opzionale)</title>
<subsection>
<body>

<p>
Il contesto del file è opzionale e ha la stessa sintassi descritta nei capitoli
precedenti.
</p>

<pre caption="Esempio di local.fc">
/opt/myprogs/mybin      --      system_u:object_r:bin_t
</pre>

<p>
I tipi utilizzati nei file di contesto dovrebbero venire richiesti o dichiarati
all'interno del file TE.
</p>

</body>
</subsection>
</section>

<section>
<title>Compilare i moduli delle politiche</title>
<subsection>
<body>

<p>
Per compilare tutti i moduli della directory occorre semplicemente eseguire il
comando <c>make</c>. Il modulo verrà compilato espressamente per la politica
corrente, come specificato in /etc/selinux/config.
</p>

<pre caption="">
# <i>make</i>
Compiling strict local module
/usr/bin/checkmodule:  loading policy configuration from tmp/local.tmp
/usr/bin/checkmodule:  policy configuration loaded
/usr/bin/checkmodule:  writing binary representation (version 6) to tmp/local.mod
Creating strict local.pp policy package
</pre>

<p>
Per compilare moduli per una politica differente rispetto a quella configurata,
si utilizzi l'opzione <c>NAME=</c>.
</p>

<pre caption="">
# <i>make NAME=targeted</i>
Compiling targeted local module
/usr/bin/checkmodule:  loading policy configuration from tmp/local.tmp
/usr/bin/checkmodule:  policy configuration loaded
/usr/bin/checkmodule:  writing binary representation (version 6) to tmp/local.mod
Creating targeted local.pp policy package
</pre>

</body>
</subsection>
</section>

<section>
<title>Caricare i moduli</title>
<subsection>
<body>

<p>
I moduli possono venire caricati nella politica correntemente configurata
semplicemente utilizzando il parametro load del Makefile.
</p>

<pre caption="">
# <i>make load</i>
</pre>

<p>
Il parametro load rispetta l'opzione <c>NAME=</c>; in alternativa, si può
ricorrere al comando <c>semodule</c> per caricare individualmente i moduli.
</p>

<pre caption="">
# <i>semodule -i local.pp</i>
</pre>

</body>
</subsection>
</section>

<section>
<title>Politica di riferimento per costruire nuovi moduli</title>
<subsection>
<body>

<p>
La nuova politica utilizzata da Gentoo è basata sulla <uri
link="http://oss.tresys.com/projects/refpolicy">Politica di riferimento di
SELinux</uri>. Per ulteriori informazioni su come costruire un modulo completo
per la politica di riferimento, si veda <uri
link="http://oss.tresys.com/projects/refpolicy/wiki/GettingStarted">Reference
Policy Wiki</uri>.
</p>

</body>
</subsection>
</section>
</sections>