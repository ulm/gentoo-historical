<?xml version='1.0'?>

<!DOCTYPE news SYSTEM "/dtd/guide.dtd">

<news gentoo="yes" category="linux">
  <poster>dberkholz</poster>
  <date>2008-02-04</date>
  <title>Your Portage tree just got 200MB smaller</title>
  <body>
    <p>
      Each ebuild in the Portage tree used to come with its own digest
      file. When you emerged a package, this digest was used to verify that
      you had the same files the developer did.
    </p>
    <p><b>Until now.</b></p>
    <p>
      A few days ago, all digest files were erased from the Portage tree as
      part of the final work to implement <uri
      link="http://www.gentoo.org/proj/en/glep/glep-0044.html">GLEP 44</uri>.
      This migrates that information to a single <path>Manifest</path> file
      per package instead of one digest for every ebuild of that package,
      which <b>saves about 200MB of disk space</b> in
      <path>/usr/portage</path>.
    </p>
    <p>
      Here are some stats showing the size of the tree before and after
      removing the digest files:
    </p>
    <table>
    <tr>
      <th>Command:</th>
      <th>du -s</th>
      <th>du -s --bytes</th>
      <th>du -sh</th>
      <th>du -sh --bytes</th>
    </tr>
    <tr>
      <th>Before:</th>
      <ti>786458</ti>
      <ti>186368043</ti>
      <ti>769M</ti>
      <ti>178M</ti>
    </tr>
    <tr>
      <th>After:</th>
      <ti>586336</ti>
      <ti>149942873</ti>
      <ti>573M</ti>
      <ti>143M</ti>
    </tr>
    </table>
    <p>
      The --bytes flag shows how much space would be taken up if your
      filesystem perfectly fit your files (for example, 1-byte block size
      instead of 4096-byte). <b>Without --bytes, this shows how much actual
      space was used</b> on an ext3 filesystem.
    </p>
    <p>
      References:
    </p>
    <ul>
      <li>
        <uri link="http://www.gentoo.org/proj/en/portage/doc/converting-manifest2.xml">
        Migrating back to Manifest1 for portage-2.0.x systems</uri>
      </li>
      <li>
        <uri link="http://devmanual.gentoo.org/general-concepts/digest-and-manifest/index.html">
        Understanding digest and manifest files</uri>
      </li>
      <li>
        <uri link="http://www.gentoo.org/proj/en/glep/glep-0044.html">GLEP 44: Manifest2 format</uri>
      </li>
      <li>
      <uri link="http://archives.gentoo.org/gentoo-dev/msg_1cb6c14d5759a510a8f27d14bd8ebfc4.xml">
        [gentoo-dev] RFC: removal of digest files from the tree</uri> by <mail link="zmedico"/>
      </li>
      <li>
        <uri link="http://archives.gentoo.org/gentoo-dev/msg_dfd7b9035dfc8a5fbd643cd1bc5c8b12.xml">
        [gentoo-dev] Redux: removal of digest files from the tree</uri> by <mail link="robbat2"/>
      </li>
    </ul>
    <p>
      <uri link="http://forums.gentoo.org/POSTHERE">Discuss this!</uri>
    </p>
    <p>
      <e>≈Åukasz Damentko and Joshua Nichols contributed the draft for this
      announcement.</e>
    </p>
  </body>
</news>
