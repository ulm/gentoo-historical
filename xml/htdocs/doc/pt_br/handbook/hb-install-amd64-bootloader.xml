<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pt_br/handbook/hb-install-amd64-bootloader.xml,v 1.1 2005/01/14 12:07:13 enderson Exp $ -->

<sections>

<version>1.16</version>
<date>2005-01-11</date>

<section>
<title>Fazendo sua escolha</title>
<subsection>
<title>Introdução</title>
<body>

<p>
Agora que seu kernel está configurado e compilado e os arquivos necessários para a configuração do sistema foram preenchidos corretamente, está na hora de instalar um programa que irá carregar seu kernel quando você iniciar o sistema. O programa é chamado de <e>bootloader</e>. 
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Framebuffer</title>
<body>

<p>
<e>Se</e> você configurou seu kernel com suporte para framebuffer, você
tem que adicionar o comando de <c>video</c> ao arquivo de configuração de seu bootloader
se você precisa de framebuffer.
</p>

<p>
Para o comando de <c>video</c>, uma sintaxe simplificada é usada. A maior parte das vezes 
usar <c>video=vesafb</c> é o suficiente. 
</p>

<p>
Mais informação pode ser encontrada em 
<path>/usr/src/linux/Documentation/fb/vesafb.txt</path>.
</p>


<p>
Lembre-se (ou escreva) seu valor; você vai precisar dele em breve.
</p>

</body>
</subsection>
</section>
<section>
<title>Usando o GRUB</title>
<subsection>
<title>Entendendo a terminologia do GRUB</title>
<body>

<p>
A parte mais crítica do entendimento do GRUB é saber como 
o GRUB faz referência aos discos rígidos e partições. Sua partição de Linux 
<path>/dev/hda1</path> é chamada de <path>(hd0,0)</path> no GRUB. Veja os 
parênteses em torno de <path>hd0,0</path> - eles são necessários.
</p>

<p>
Discos rígidos contam a partir de zero ao invés de "a" e partições começa em zero 
ao invés de um. Saiba também que com os dispositivos hd, somente discos rígidos são 
contados, não dispositivos atapi-ide como tocadores de cdrom e gravadores. Também, a 
mesma construção é usada com discos SCSI. (Normalmente, eles têm números maiores que 
discos IDE, exceto quando a BIOS é configurada para bootar a partir de dispositivos 
SCSI.)
</p>

<p>
Presumindo que você tem um disco rígido em <path>/dev/hda</path>, em tocador de cdrom em 
<path>/dev/hdb</path>, um gravador em <path>/dev/hdc</path>, um segundo disco rígido em 
<path>/dev/hdd</path> e nenhum disco rígido SCSI, <path>/dev/hdd7</path> é  
traduzido como <path>(hd1,6)</path>. Pode parecer complicado e é mesmo, 
mas como veremos, o GRUB oferece um mecanismo de completação com o tab
que ajuda muito aqueles que têm muitos discos rígidos e 
partições e que ficam um pouco perdidos com o esquema de numeração do GRUB.
</p>

<p>
Tendo entendido a situação, está na hora de instalar o GRUB.
</p>

</body>
</subsection>
<subsection>
<title>Instalando o GRUB</title>
<body>

<p>
Para instalar o GRUB, vamos primeiro fazer emerge dele.
</p>

<pre caption = "Instalando o GRUB">
# <i>emerge grub</i>
</pre>

<p>
Embora agora o GRUB esteja instalado, nós ainda precisamos 
escrever um arquivo de configuração para ele e instalar o GRUB no MBR para que 
ele carregue automaticamente seu novo kernel. Crie
<path>/boot/grub/grub.conf</path> com o <c>nano</c> (ou, se for o caso, outro
editor):
</p>

<pre caption = "Criando o /boot/grub/grub.conf">
# <i>nano -w /boot/grub/grub.conf</i>
</pre>

<p>
Agora nós vamos escrever o <path>grub.conf</path>. Abaixo você
encontrará dois <path>grub.conf</path> possíveis para o exemplo de particionamento que usamos 
neste guia, com uma imagem de kernel chamada <path>kernel-2.6.5-gentoo</path>. Nós somente 
fizemos comentários extensivos para o primeiro <path>grub.conf</path>. 
</p>

<ul>
  <li>
    O primeiro <path>grub.conf</path> é para pessoas que não usaram o
    <c>genkernel</c> para construir seu kernel
  </li>
  <li>
    O segundo <path>grub.conf</path> é para pessoas que usaram o
    <c>genkernel</c> para construir seu kernel
  </li>
</ul>

<pre caption = "grub.conf para quem não usou genkernel">
<comment># Que ítem para carregar como padrão; 0 é o primeiro, 1 é o segundo, etc...</comment>
default 0
<comment># Quantos segundos para esperar antes do ítem padrão ser carregado.</comment>
timeout 30
<comment># Uma bela imagem de splash para deixar as coisas mais interessantes :)
# Comente a linha se você não tem uma placa gráfica instalada</comment>
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.5
<comment># Partição onde a imagem de kernel (ou sistema operacional) está localizada</comment>
root (hd0,0)
kernel /kernel-2.6.5-gentoo root=/dev/hda3

<comment># As próximas quatro linhas só são para quem tem Windows instalado paralelamente.</comment>
<comment># In this case, Windows is hosted on /dev/hda6.</comment>
title=Windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
</pre>


<pre caption = "grub.conf para usuários do genkernel">
default 0
timeout 30
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.5
root (hd0,0)
kernel /kernel-2.6.5-gentoo root=/dev/ram0 init=/linuxrc ramdisk=8192 real_root=/dev/hda3
initrd /initrd-2.6.5-gentoo

<comment># Só se você tiver Windows em paralelo</comment>
title=Windows XP
root (hd0,5)
makeactive
chainloader +1
</pre>


<note>
Se você usar um esquema de particionamento diferente e/ou imagem de kernel, ajuste 
de acordo. No entanto, certifique-se de que qualquer coisa depois de um dispositivo do GRUB 
(como <path>(hd0,0)</path>) é relativo ao ponto de montagem, não a raiz. Em outras 
palavras, <path>(hd0,0)/grub/splash.xpm.gz</path> é na realidade 
<path>/boot/grub/splash.xpm.gz</path> uma vez que <path>(hd0,0)</path> é 
<path>/boot</path>.
</note>

<p>
Se você precisa passar opções adicionais para o kernel, simplesmente adicione-os 
ao final da linha de comando do kernel. Já estamos passando uma opção 
(<c>root=/dev/hda3</c> ou <c>real_root=/dev/hda3</c>), mas você pode passar outras 
também. Como um exemplo vamos usar o comando de <c>video</c> para o framebuffer que 
discutimos anteriormente:
</p>

<pre caption = "Adicionando o comando de video como uma opção de kernel">
title=Gentoo Linux
  root (hd0,0)
  kernel /kernel-2.6.5-gentoo root=/dev/hda3 video=vesafb
</pre>

<p>
Usuários do <c>genkernel</c> devem saber que seus kernéis usam as mesmas opções de boot que 
as usadas no LiveCD. Por exemplo, se você tem dispositivos SCSI, você deve adicionar 
<c>doscsi</c> como uma opção de kernel.
</p>

<p>
Agora salve o arquivo <path>grub.conf</path> e saia. Nós ainda precisamos instalar o GRUB no 
MBR (Master Boot Record), todavia.
</p>

<p>
Os desenvolvedores do GRUB recomendam o uso do <c>grub-install</c>. Porém, se por algum
motivo o <c>grub-install</c> não funcionar corretamente você ainda tem a
opção de instalar o GRUB manualmente.
</p>

<p>
Continue com <uri link="#grub-install-auto">Padrão: Configurando o GRUB usando o 
grub-install</uri> ou <uri link="#grub-install-manual">Alternativa: Configurando o
GRUB manualmente</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-auto">
<title>Padrão: Instalando o GRUB usando o grub-install</title>
<body>

<p>
Para instalar o GRUB você irá precisar rodar o comando <c>grub-install</c>. No entanto,
o <c>grub-install</c> não irá funcionar sem ajustes porque estamos dentro de um ambiente
de chroot. Precisamos atualizar o <path>/etc/mtab</path> (o arquivo com informações sobre 
todos sistemas de arquivos montados) primeiro: para nossa sorte existe um jeito fácil de 
fazê-lo - simplesmente copie o <path>/proc/mounts</path> para o <path>/etc/mtab</path>:
</p>

<pre caption="Atualizando o /etc/mtab">
# <i>cp /proc/mounts /etc/mtab</i>
</pre>

<p>
Agora podemos instalar o GRUB usando o <c>grub-install</c>:
</p>

<pre caption="Rodando o grub-install">
# <i>grub-install --root-directory=/boot /dev/hda</i>
</pre>

<p>
Se você tem mais perguntas sobre o GRUB, por favor consulte o <uri
link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> ou o <uri
link="http://www.gnu.org/software/grub/manual/">Manual do GRUB</uri>.
</p>

<p>
Continue com <uri link="#reboot">Reiniciando o sistema</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-manual">
<title>Alternativa: Configurando o GRUB manualmente</title>
<body>

<p>
Para iniciar a configuração do GRUB, digite <c>grub</c>. Você verá 
o prompt de comando do grub, <path>grub&gt;</path>. Agora, você tem que digitar
os comandos corretos para instalar os arquivos de boot do GRUB em seu disco rígido.
</p>

<pre caption ="Iniciando o shell do GRUB">
# <i>grub</i>
</pre>

<note>
Se o seu sistema não tem dispositivos de disquete, adicione a opção <c>--no-floppy</c>
ao comando acima para prevenir que o GRUB procure os dispositivos de disquete
(não-existentes).
</note>

<p>
Na configuração de exemplo nós queremos instalar o GRUB de maneira que ele leia sua
informação da partição de boot <path>/dev/hda1</path>, e instale o
arquivo de boot do GRUB no MBR (master boot record) do disco rígido de forma que 
a primeira coisa que vemos quando ligamos o computador é o prompt do GRUB. Lógico, se você 
não seguiu as configurações de exemplo durante a instalação, 
mude os comandos de acordo.
</p>

<p>
O mecanismo de completação de tab do GRUB pode ser usado de dentro do GRUB.
Por exemplo, se você digitar "<c>root (</c>" seguido de um TAB, você verá 
uma lista de dispositivos (como <path>hd0</path>). Se você 
digitar "<c>root (hd0,</c>" seguido de um TAB, você receberá uma lista 
de partições disponíveis para escolher (como <path>hd0,0</path>).
</p>

<p>
Usando a completação de tab, configurar o GRUB não é tão difícil.
Vamos configurar o GRUB agora? :-)
</p>

<pre caption ="Instalando o GRUB no MBR">
grub&gt; <i>root (hd0,0)</i>          <comment>(Coloque onde sua partição /boot reside)</comment>
grub&gt; <i>setup (hd0)</i>           <comment>(Instale o GRUB no MBR)</comment>
grub&gt; <i>quit</i>                  <comment>(Saia do shell do GRUB)</comment>
</pre>

<note>
Se você não quiser instalar o GRUB no MBR e sim numa partição, 
você tem de alterar o comando <c>setup</c> para que ele aponte para a 
partição correta. Por exemplo, se você quer o GRUB instalado em 
<path>/dev/hda3</path>, então o comando vira <c>setup (hd0,2)</c>.
Poucos usuários, no entanto, devem fazer isso.
</note>

<p>
Se você tem mais perguntas em relação ao GRUB, por favor consulte o <uri
link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> ou o <uri
link="http://www.gnu.org/software/grub/manual/">Manual do GRUB</uri>.
</p>

<p>
Continue com <uri link="#reboot">Reiniciando o sistema</uri>.
</p>

</body>
</subsection>
</section>
<section id="reboot">
<title>Reiniciando o sistema</title>
<subsection>
<body>

<p>
Saia do ambiente de chroot e desmonte todas partições montadas. Então digite aquele comando mágico que você estava esperando: <c>reboot</c>.
</p>

<pre caption="Desmontando todas partições e reiniciando">
# <i>exit</i>
# <i>cd</i>
# <i>umount /mnt/gentoo/boot /mnt/gentoo/proc /mnt/gentoo</i>
# <i>reboot</i>
</pre>

<p>
Claro, não se esqueça de tirar o CD bootável, ou o CD será carregado novamente ao invés de seu sistema Gentoo.
</p>

<p>
Uma vez iniciada sua instalação do Gentoo, termine com  <uri
link="?part=1&amp;chap=11">Completando sua instalação do Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>
