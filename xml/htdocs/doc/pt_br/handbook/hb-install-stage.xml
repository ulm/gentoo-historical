<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pt_br/handbook/hb-install-stage.xml,v 1.1 2004/11/30 17:12:57 enderson Exp $ -->

<sections>

<version>1.67</version>
<date>2004-11-09</date>

<section>
<title>Instalando um Stage</title>
<subsection>
<title>Configurando a Data/Hora</title>
<body>

<p>
Antes de continuar você precisa checar a data/hora e atualizá-las. Um
relógio mal configurado pode levar a resultados estranhos no futuro!
</p>

<p>
Para verificar a data/hora atual, execute <c>date</c>:
</p>

<pre caption="Verificando a data/hora">
# <i>date</i>
Fri Oct 29 16:21:18 CEST 2004
</pre>

<p>
Se a data/hora for exibida incorretamente, atualize-a usando <c>date
MMDDhhmmAAAA</c> sintaxe (<b>M</b>ês, <b>D</b>ia, <b>h</b>ora, <b>m</b>inuto
e <b>A</b>no). Por exemplo, para configurar a data para 29 de Outubro 2004,
16:21:
</p>

<pre caption="Configurando a data/hora">
# <i>date 102916212004</i>
</pre>

</body>
</subsection>
<subsection>
<title>Fazendo sua Escolha</title>
<body>

<p>
No próximo passo você precisa executar a instalação de um <e>stage</e> da sua
escolha no sistema. Você tem a opção de baixar o arquivo da Internet ou, 
se você iniciou de um dos LiveCDs Universal do Gentoo, copie-o
diretamente do CD. Se você tem um CD Universal e o stage que você quer usar
está no CD, baixá-lo da Internet será somente um desperdício de banda pois 
os arquivos são os mesmos.
</p>

<ul>
<li><uri link="#doc_chap2">Padrão: Usando um Stage da Internet</uri></li>
<li><uri link="#doc_chap3">Alternativo: Usando um Stage do LiveCD</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Padrão: Usando um Stage da Internet</title>
<subsection>
<title>Baixando o Stage</title>
<body>

<p>
Entre no ponto de montagem do Gentoo onde você montou seu sistema de arquivos
(geralmente <path>/mnt/gentoo</path>):)
</p>

<pre caption="Entrando no ponto de montagem do Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Dependendo da sua mídia de instalação, você tem uma série de ferramentas
disponíveis para baixar o stage. Se você tem disponível o <c>links2</c>, 
então você pode acessar imediatamente 
<uri link="/main/en/mirrors.xml">o Gentoo mirrorlist</uri> e escolher 
o melhor mirror para você. Se você não tem disponível o <c>links2</c> você 
deve ter o <c>lynx</c> a sua disposição. Neste caso, substitua todas 
ocorrências do <c>links2</c> no resto das instruções por <c>lynx</c>.
</p>

<p>
Escolha o diretório <path>releases/</path>, seguido pela sua arquitetura (por
exemplo <path>x86/</path> e a versão do Gentoo (<path>2004.3/</path>), para
concluir acesse o diretório <path>stages/</path>. Lá você deve ver todos
arquivos stage disponíveis para sua arquitetura (eles podem ser armazenados
dentro de subdiretórios nomeados por sub arquiteturas individuais). Selecione
um e pressione <c>D</c> para baixá-lo. Quando finalizar, pressione <c>Q</c>
para sair do navegador.
</p>

<pre caption="Navegando na lista do mirror com links2">
<comment>(Sem proxy)</comment>      # <i>links2 http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Com proxy)</comment>      # <i>links2 -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Se quiser checar a integridade do stage baixado, use o <c>md5sum</c> e 
compare a saída com o MD5 checksum disponível no mirror. Por exemplo,
para checar a validade de um stage x86:
</p>

<pre caption="Exemplo checando integridade de um stage">
# <i>md5sum -c stage1-x86-2004.3.tar.bz2.md5</i>
stage1-x86-2004.3.tar.bz2: OK
</pre>

</body>
</subsection>
<subsection>
<title>Descompactando um Stage</title>
<body>

<p>
Agora descompacte o stage no seu sistema. Nós usamos GNU's <c>tar</c>,
para processá-lo este é o método mais fácil.
</p>

<pre caption="Descompactando o stage">
# <i>tar -xvjpf stage?-*.tar.bz2</i>
</pre>

<p>
Certifique-se que está usando as mesmas opções (<c>-xvjpf</c>). O <c>x</c> 
serve para <e>Extrair</e>, o <c>v</c> para <e>Detalhar</e> (ok, sim, isto 
é opcional), o <c>j</c> para <e>Descompactar com bzip2</e>, o <c>p</c> para
<e>Preservar as permissões</e> e o <c>f</c> para definir que queremos extrair 
um arquivo, ao invés da entrada padrão.
</p>

<p>
Agora que o stage está instalado, continue com <uri
link="#installing_portage">Instalando o Portage</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Alternativo: Usando um Stage do LiveCD</title>
<subsection>
<title>Extraindo o Stage</title>
<body>

<p>
Os stages do CD estão no diretório <path>/mnt/cdrom/stages</path>. Para
ver uma lista dos stages disponíveis, use <c>ls</c>:
</p>

<pre caption="Listando todos os stages disponíveis">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Se o sistema retornar um erro, pode ser necessário montar o CD-ROM primeiro:
</p>

<pre caption="Montando o CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Agora acesse o ponto de montagem do Gentoo (geralmente <path>/mnt/gentoo</path>:
</p>

<pre caption="Acessando o diretório /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Iremos agora extrair o stage escolhido. Faremos isso com a ferramenta GNU 
<c>tar</c>. Certifique-se que está usando as mesmas opções (<c>-xvjpf</c>)!
No próximo exemplo, iremos extrair o stage 
<path>stage3-&lt;subarch&gt;-2004.3.tar.bz2</path>.
Certifique-se que substitui o nome do arquivo pelo do seu stage.
</p>

<pre caption="Extraindo o stage">
# <i>tar -xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2004.3.tar.bz2</i>
</pre>

<p>
Agora que o stage está instalado, continue com <uri
link="#installing_portage">Instalando o Portage</uri>.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Instalando o Portage</title>
<subsection>
<title>Com rede ou sem rede?</title>
<body>

<p>
Se você não tem uma conexão de rede, terá que instalar um snapshot do 
Portage disponível em um dos nossos LiveCDs. Nisto automaticamente
assume-se que você está instalando a partir de um <e>stage3</e> (este é
o único stage que suporta instalações sem conexão de rede). Se você quer 
usar pacotes pré-compilados depois para aumentar a velocidade da instalação,
você <e>deve</e> usar um snapshot do Portage de um LiveCD. Outros usuários
irão baixar um Portage totalmente atualizado usando o <c>emerge</c> citado
no próximo cápitulo.
</p>

<p>
Continue com a parte apropriada:

</p>

<ul>
  <li>
    <uri link="#installing_from_LiveCD">Instalando um snapshot do Portage e
    o Código Fonte de um LiveCD</uri> (para instalações sem conexão de rede
    ou GRP)
  </li>
  <li>
    <uri link="#compile_options">Configurando as Opções de Compilação</uri> 
    (todos os outros métodos de instalação) 
  </li>
</ul>

</body>
</subsection>
<subsection id="installing_from_LiveCD">
<title>Instalando um Snapshot do Portage e o Código Fonte de um LiveCD</title>
<body>

<p>
Existe um snapshot do Portage disponível nos LiveCDs Universal. Se você está
lendo isto, nós podemos assumir que está usando um LiveCD. Para instalar este
snapshot, verifique em <path>/mnt/cdrom/snapshots/</path> para saber qual
snapshot temos disponíveis:
</p>

<pre caption="Verificando o conteúdo de /mnt/cdrom/snapshots">
# <i>ls /mnt/cdrom/snapshots</i>
</pre>

<p>
Agora extraia o snapshot usando a seguinte construção. Novamente,
certifique-se que está usando as opções corretas no <c>tar</c>. Note também, 
o <c>-C</c> é um <c>C</c> maíusculo, não <c>c</c>. No próximo exemplo usaremos
<path>portage-20041022.tar.bz2</path> como o nome do arquivo do snapshot. 
Certifique-se de substítui-lo pelo seu snapshot.
</p>

<pre caption="Extraindo um snapshot do Portage">
# <i>tar -xvjf /mnt/cdrom/snapshots/portage-20041022.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

<p>
Pode ser necessário copiar todo o código fonte do CD:
</p>

<pre caption="Copiando o código fonte">
# <i>mkdir /mnt/gentoo/usr/portage/distfiles</i>
# <i>cp /mnt/cdrom/distfiles/* /mnt/gentoo/usr/portage/distfiles/</i>
</pre>

<p>
Agora que seu snapshot do Portage está instalado, continue com <uri
link="#compile_options">Configurando as Opções de Compilação</uri>.
</p>

</body>
</subsection>
</section>

<section id="compile_options">
<title>Configurando as Opções de Compilação</title>
<subsection>
<title>Introducão</title>
<body>

<p>
Para otimizar o Gentoo, você pode ajustar um par das variáveis que causarão
impacto no comportamento do Portage. Todas essas variáveis podem ser 
configuradas como variáveis de ambiente (usando <c>export</c>) mas isso não
é permanente. Para manter suas configurações, o Portage lhe fornece o 
<path>/etc/make.conf</path>, um arquivo de configuração para o Portage. Este
é o arquivo que iremos editar agora.
</p>

<note>
Uma listagem comentada de todas as variáveis possíveis pode ser encontrada em
<path>/mnt/gentoo/etc/make.conf.example</path>. Para uma instalação com sucesso 
do Gentoo você só precisa configurar as variáveis conforme mencionado abaixo.
</note>

<p>
Abra seu editor favorito (neste tutorial usamos o <c>nano</c>), assim
poderemos alterar as variáveis de otimização que discutiremos abaixo. 
</p>

<pre caption="Abrindo /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Como você provavelmente observou, o arquivo <path>make.conf.example</path> é
estruturado de uma maneira genérica: linhas de comentário começam com "#", 
outras linhas definem variáveis usando a sintaxe <c>VARIÁVEL="conteúdo"</c>.
O arquivo <path>make.conf</path> usa a mesma sintaxe. Diversas dessas variáveis
serão discutidas abaixo. 
</p>

<warn>
Não faça nenhuma modificação nas variáveis USE se está realizando uma
instalação de um stage3 ou GRP. Você pode alterar a variável USE antes de
instalar os pacotes que deseja. Gremlins serão avisados para atacar seu sistema
caso ignore esse aviso!
</warn>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<warn>
Embora isto possa ser temporário para usuários não-stage1, eles <e>não</e> devem
alterar a configuração de <c>CHOST</c> em <path>make.conf</path>. Fazendo isso
você pode tornar seu sistema inutilizável. Novamente: somente altere esta 
variável se estiver instalando a partir do <e>stage1</e>.
</warn>

<p>
A variável <c>CHOST</c> define com qual arquitetura o <c>gcc</c> irá compilar
os programas. As possíveis variáveis são::
</p>

<table>
<tr>
  <th>Arquitetura</th>
  <th>Sub-arquitetura</th>
  <th>Configuração CHOST</th>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i386</ti>
  <ti>i386-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i486</ti>
  <ti>i486-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i586</ti>
  <ti>i586-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i686 e acima (incl. athlon)</ti>
  <ti>i686-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>alpha</ti>
  <ti></ti>
  <ti>alpha-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc</ti>
  <ti></ti>
  <ti>powerpc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc64</ti>
  <ti></ti>
  <ti>powerpc64-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>sparc</ti>
  <ti></ti>
  <ti>sparc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>(genérico)</ti>
  <ti>hppa-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa7000</ti>
  <ti>hppa1.1-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa8000 e acima</ti>
  <ti>hppa2.0-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>mips</ti>
  <ti></ti>
  <ti>mips-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>amd64</ti>
  <ti></ti>
  <ti>x86_64-pc-linux-gnu</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>CFLAGS e CXXFLAGS</title>
<body>

<p>
As variáveis <c>CFLAGS</c> e <c>CXXFLAGS</c> definem as flags de otimização 
para o <c>gcc</c> C e C++ compiladores respectivamente. Embora geralmente
definimos eles aqui, você só irá obter máxima performance se otimizar as flags
para cada programa separadamente. A razão disto é que cada programa é diferente.
</p>

<p>
Em <path>make.conf</path> você deve definir as flags de otimização que você
pensa que irão tornar seu sistema mais responsivo <e>geralmente</e>. Não
coloque configurações experimentais nesta variável; muitas otimizações podem 
fazer o programa não se comportar bem (crash, ou mal funcionamento).
</p>

<p>
Não iremos explicar todas as opções de otimização possíveis. Se quiser 
conhece-las, leia o <uri link="http://gcc.gnu.org/onlinedocs/">GNU
Online Manual(s)</uri> ou a página info do <c>gcc</c> (<c>info gcc</c> -- só
funciona em um sistema Linux já funcionando). O próprio arquivo 
<path>make.conf.example</path> contém inúmeros exemplos e informações; não
se esqueça de lê-lo também.
</p>

<p>
A primeira configuração é a flag <c>-march=</c>, que específica o nome da 
arquitetura alvo. Possíveis opções são descritas no arquivo 
<path>make.conf.example</path> (com comentários). Por exemplo, para uma 
arquitetura x86 Athlon XP:
</p>

<pre caption="Configurando o GCC march">
<comment># Usuários de AMD64 que quiserem usar um sistema nativo de 64 bit
não devem usar athlon-xp</comment>
-march=athlon-xp
</pre>

<p>
A segunda é a flag <c>-O</c> (que é um O maiúsculo, não é um zero), que 
especifíca a classe da flag de otimização da <c>gcc</c>. Possíveis classes são
<c>s</c> (para otimização de tamanho), <c>0</c> (zero - para não otimizar), 
<c>1</c>, <c>2</c> ou <c>3</c> para flags mais otimizadas de velocidade 
(toda classe tem as mesmas flags que a anterior, com alguns extras). Por 
exemplo, para uma otimização de classe 2:
</p>

<pre caption="Configurando o GCC O">
-O2
</pre>

<p>
Outra otimização popular é a flag <c>-pipe</c> (usar pipes ao invés de 
arquivos temporários é melhor para comunicação entre os vários estágios de 
compilação).
</p>

<p>
Saiba você que usar <c>-fomit-frame-pointer</c> (que não mantem o frame
pointer em um registro para as funções que não necessitam de um) pode ter 
sérias repercurssões na eliminação de erros das aplicações!
</p>

<p>
Quando você define as <c>CFLAGS</c> e <c>CXXFLAGS</c>, pode-se combinar
diversas flags de otimização, como o exemplo a seguir:
</p>

<pre caption="Definindo as variáveis CFLAGS e CXXFLAGS">
CFLAGS="-march=athlon-xp -pipe -O2"   <comment># Usuários de AMD64 não devem usar athlon-xp</comment>
CXXFLAGS="${CFLAGS}"                  <comment># Use as mesmas configurações da variável acima</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Com <c>MAKEOPTS</c> defina quantas compilações paralelas deverão ocorrer 
quando instalar um pacote. Uma boa escolha é o número de CPUs no seu sistema 
mais um, mas este tutorial não é perfeito.
</p>

<pre caption="MAKEOPTS para um sistema regular de 1-CPU">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Pronto, Configure, Vá!</title>
<body>

<p>
Atualize seu <path>/mnt/gentoo/etc/make.conf</path> para suas próprias 
preferências e salve (usuários do <c>nano</c> podem pressionar <c>Ctrl-X</c>). 
Agora você está pronto para continuar com <uri link="?part=1&amp;chap=6">Instalando o Sistema Base do Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>

