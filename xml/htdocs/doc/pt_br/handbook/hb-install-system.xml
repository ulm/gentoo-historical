<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pt_br/handbook/hb-install-system.xml,v 1.8 2005/04/16 21:03:32 vanquirius Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<sections>

<version>2.4</version>
<date>2005-04-09</date>

<section>
<title>Fazendo o chroot</title>
<subsection>
<title>Opcional: Selecionando servidores alternativos</title>
<body>

<p>
Para poder baixar código fonte rapidamente é recomendado selecionar um servidor
veloz. O Portage irá procurar em seu arquivo <path>make.conf</path> a
variável GENTOO_MIRRORS e usar os servidores listados nela. Você pode surfar em
nossa <uri link="/main/en/mirrors.xml">lista de servidores</uri> e procurar
um servidor (ou servidores) próximo(s) a você (já que são freqüentemente os
mais rápidos), mas nós oferecemos uma boa ferramenta chamada <c>mirrorselect</c>, que
oferece uma interface agradável para selecionar os servidores que você deseja.
</p>
  
<pre caption="Usando mirrorselect para a variável GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Não selecione nenhum servidor de IPv6. Nossos stages atualmente não suportam IPv6.
</warn>

<p>
Um segundo ajuste importante é o de SYNC no <path>make.conf</path>. Esta
variável contém o servidor de rsync que você quer usar para atualizar sua árvore
do Portage (a coleção de ebuilds, scripts contendo todas informações que o Portage
precisa para baixar e instalar software). Embora você possa digitar um servidor de SYNC
manualmente, o <c>mirrorselect</c> pode facilitar a operação para você:
</p>

<pre caption="Selecionando um servidor de rsync usando mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Depois de rodar <c>mirrorselect</c> é aconselhável verificar novamente os ajustes
no <path>/mnt/gentoo/etc/make.conf</path> !
</p>

</body>
</subsection>
<subsection>
<title>Copiando informações de DNS</title>
<body>

<p>
Uma coisa que ainda precisa ser feita antes de entrarmos no novo ambiente,
copiar as informações de DNS do <path>/etc/resolv.conf</path>. Você precisa
fazer isso para ter certeza que a rede ainda funciona mesmo depois de entrar no
novo ambiente. O <path>/etc/resolv.conf</path> contém os servidores de nome para sua
rede.
</p>

<pre caption="Copiando informações de DNS">
<comment>(A opção "-L" é necessária para ter certeza que não copiamos um link simbólico)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Montando o sistema de arquivos proc</title>
<body>

<p>
Monte o sistema de arquivos <path>/proc</path> em <path>/mnt/gentoo/proc</path> para
permitir que a instalação use as informações fornecidas pelo kernel mesmo dentro do
ambiente de chroot.
</p>

<pre caption="Montando /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Entrando no novo ambiente</title>
<body>

<p>
Agora que todas partições foram iniciadas e o ambiente de base está 
instalado, está na hora de entrar no nosso novo ambiente de instalação 
fazendo <e>chroot</e> nele. Isto quer dizer que mudamos o nosso ambiente 
de instalação atual (CD de instalação ou outro método de instalação) para seu sistema
instalado (as partições iniciadas).
</p>

<p>
O processo de chroot é feito em três passos. Primeiro iremos mudar a raiz (root)
de <path>/</path> (na mídia de instalação) para <path>/mnt/gentoo</path> 
(em sua partição) usando o <c>chroot</c>. Então iremos criar um novo ambiente
usando o <c>env-update</c>, que essencialmente cria variáveis de ambiente.
Finalmente, nós carregamos essas variáveis na memória usando <c>source</c>.
</p>

<pre caption = "Fazendo chroot no novo ambiente">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Parabéns! Você agora está dentro de seu ambiente do Gentoo Linux.
Claro que está longe de acabar, mas é por isso mesmo que a instalação
ainda tem outras seções :-)
</p>

</body>
</subsection>
<subsection>
<title>Atualizando sua árvore do Portage</title>
<body>

<p>
Você agora deve atualizar sua árvore do Portage para a última versão. <c>emerge 
--sync</c> faz isso para você.
</p>

<pre caption="Atualizando sua árvore do Portage">
# <i>emerge --sync</i>
</pre>

<p>
Se você estiver atrás de uma firewall que bloqueia tráfego de rsync, você pode usar
<c>emerge-webrsync</c> que irá baixar e instalar um snapshot do portage para
você.
</p>

<p>
Se você for avisado de que uma nova versão do Portage está disponível e que você deve
atualizar o Portage, ignore-a. O Portage será atualizado mais tarde 
durante a instalação.
</p>

</body>
</subsection>
<subsection>
<title>Escolhendo o profile correto</title>
<body>

<p>
Primeiro, uma pequena definição é feita.
</p>

<p>
Um profile (perfil) é um bloco de construção para qualquer sistema Gentoo. Não só ele especifica
os valores padrão para CHOST, CFLAGS e outras variáveis importantes, ele também trava
o sistema em um certo alcance de versões de pacotes. Tudo isto é mantido pelos
desenvolvedores do Gentoo.
</p>

<p>
Antigamente, o profile mal era tocado pelo usuário. Todavia, recentemente,
usuários de x86, hppa e alpha podem escolher entre dois profiles, um para um kernel 2.4
e outro para um kernel 2.6. Este requisito foi imposto para melhorar a
integração de kernéis 2.6.
</p>

<p>
Você pode ver que profile você está usando atualmente rodando o seguinte
comando:
</p>

<pre caption="Verificando o profile de sistema">
# <i>ls -l /etc/make.profile</i>
lrwxrwxrwx  1 root root 48 Mar  7 11:55 /etc/make.profile ->
      ../usr/portage/profiles/default-linux/x86/2005.0
</pre>

<p>
Se você estiver usando uma das três arquiteturas mencionadas acima, você verá um
profile adicional no listado pelo link simbólico <path>make.profile</path>:
</p>

<pre caption="Verificando se um profile adicional existe">
# <i>ls -F /etc/make.profile/</i>
2.4/  packages  parent  virtuals
</pre>

<p>
Como você pode ver, no exemplo acima existe um subdiretório 2.4. Isto significa
que o profile atual usa o kernel 2.6; se você quiser um sistema baseado em 2.4,
você precisa re-ligar o seu link simbólico <path>make.profile</path>:
</p>

<pre caption="Re-ligando o profile">
# <i>ln -snf /usr/portage/profiles/default-linux/x86/2005.0/2.4 /etc/make.profile</i>
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Configurando a variável USE</title>
<body>

<p>
A variável <c>USE</c> é uma das variáveis mais poderosas que o Gentoo fornece a seus usuários.
Vários programas podem ser compilados com ou sem suporte opcional para certos 
ítens. Por exemplo, alguns programas podem ser compilados com ou sem suporte a gtk, ou com
suporte a qt. Outros podem ser compilados com ou sem suporte a SSL. Alguns programas
podem até mesmo ser compilados com suporte a framebuffer (svgalib) ao invés de 
suporte a X11 (servidor de X).
</p>

<p>
A maior parte das distribuições compilam seus pacotes com suporte para o máximo possível,
aumentando o tamanho dos programas e seu tempo de inicialização, sem mencionar uma
grande quantidade de dependências. Com o Gentoo você pode definir que opções um pacote
deve usar para a compilação. Aí que entra a variável <c>USE</c>.
</p>

<p>
Na variável <c>USE</c> você define palavras-chave que são mapeadas nas opções
de compilação. Por exemplo, <e>ssl</e> irá compilar suporte de ssl nos programas
que suportam ssl. <e>-X</e> irá remover suporte a servidor de X (note o sinal de 
menos na frente). <e>gnome gtk -kde -qt</e> irá compilar seus programas com suporte a gnome
(e gtk), e sem suporte a kde (e qt), fazendo com que seu sistema seja completamente 
voltado para o GNOME.
</p>

<p>
As configurações padrão de <c>USE</c> são colocadas no arquivo <path>make.defaults</path> 
de seu profile. Você encontra os arquivos <path>make.defaults</path> no diretório
para o qual <path>/etc/make.profile</path> aponta e todos os subdiretórios
também. Os ajustes padrão de <c>USE</c> são a soma de todos os ajustes de <c>USE</c>
em todos arquivos <path>make.defaults</path>. O que você coloca no
<path>/etc/make.conf</path> é calculado contra estes ajustes. Se você
adiciona algo ao ajuste de <c>USE</c>, ele é adicionado à lista padrão. Se
você remover algo do ajuste de <c>USE</c> (colocando um sinal de menos 
na frente), o algo é removido da lista padrão (se estava na lista padrão para
começar). <e>Nunca</e> altere nada dentro do diretório <path>/etc/make.profile</path>; 
ele será sobre-escrito quando você atualizar o Portage!
</p>

<p>
Uma descrição completa da <c>USE</c> pode ser encontrada na segunda parte do Manual
do Gentoo, <uri link="?part=2&amp;chap=2">opções de USE</uri>. Uma lista completa 
das opções de USE disponíveis pode ser encontrada em seu sistema em
<path>/usr/portage/profiles/use.desc</path>. 
</p>

<pre caption="Vendo todas opções de USE disponíveis">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Você pode rolar usando as teclas de seta, e sair apertando 'q')</comment>
</pre>

<p>
Como um exemplo nós iremos mostrar um ajuste de <c>USE</c> para um sistema baseado em KDE com suporte a DVD, ALSA
e gravação de CD:
</p>

<pre caption="Abrindo o /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="ajustes de USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Opcional: locales de GLIBC</title>
<body>

<p>
Você provavelmente só usa um ou dois locales em seu sistema. Até agora
depois de compilar o <c>glibc</c> uma lista completa de locales é 
criada. A partir de agora você pode ativar a opção de USE <c>userlocales</c> e especificar
só os locales que você irá precisar em <path>/etc/locales.build</path>. Só faça isso
se você sabe que locales escolher. Isto não irá funcionar durante o bootstrap,
mas irá quando você re-compilar o glibc depois.
</p>

<pre caption="Ativando a opção de USE userlocales especialmente para o glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Agora especifique os locales que você quer poder usar:
</p>

<pre caption="Abrindo /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Os locales da lista seguinte são um exemplo de como ter tanto inglês (americano),
alemão (da Alemanha) e Português (do Brasil) com os formatos de caracteres correspondentes (como UTF-8).
</p>

<pre caption="Especifique seus locales">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
pt_BR.ISO-8859-1
pt_BR.UTF-8/UTF-8
</pre>

</body>
</subsection>
</section>
<section>
<title>Diferenças entre stage1, stage2 e stage3</title>
<body>

<p>
Agora sente-se e pense sobre os passos anteriores. Nós pedimos que você
selecionasse um <e>stage1</e>, <e>stage2</e> ou <e>stage3</e> e avisamos 
que sua escolha é importante para os passos mais avançados da instalação. Bem, aqui
é o primeiro lugar onde sua escolha define os passos subseqüentes.
</p>

<ul>
<li>
  Se você escolheu um <e>stage1</e>, então você tem que seguir <e>ambos</e> passos 
  neste capítulo (começando com <uri link="#doc_chap3">Progredindo de um stage1
  para um stage2)</uri>)
</li>
<li>
  Se você escolheu um <e>stage2</e> você só pode pular o primeiro passo
  e imediatamente começar com o segundo (<uri link="#doc_chap4">Progredindo de um
  stage2 para um stage3</uri>)
</li>
<li>
  Se você escolheu o <e>stage3</e> então você pode pular ambos
  passos e continuar com <uri link="?part=1&amp;chap=7">Configurando o
  kernel</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Progredindo de um stage1 para um stage2</title>
<subsection>
<title>Introdução ao bootstrapping</title>
<body>

<p>
Então, você quer compilar tudo do zero? Tudo bem :-)
</p>

<p>
Neste passo, iremos fazer <e>bootstrap</e> de seu sistema Gentoo. Isto leva
bastante tempo, mas resulta em um sistema que foi otimizado 
inteiramente para sua máquina específica e suas necessidades.
</p>

<p>
Fazer <e>Bootstrap</e> significa construir a biblioteca C do GNU, a coleção de 
compiladores do GNU e outros programas chave para o sistema.
</p>

<p>
Antes de continuar o bootstrap, você pode querer baixar todo código-fonte
necessário primeiro. Se você não fizer isso, continue com 
<uri link="#bootstrap">Fazendo bootstrap do sistema</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Baixando as fontes primeiro</title>
<body>

<p>
Se você não copiou todo código-fonte antes, o script de bootstrap 
irá baixar todos arquivos necessários. Se você quiser baixar 
o código-fonte primeiro e fazer bootstrap do sistema mais tarde (por exemplo,
porque você não irá ter uma conexão de Internet aberta durante a compilação)
use a opção <e>-f</e> do script de bootstrap, que irá
baixar (fetch em inglês, logo a letra <e>f</e>) todo código-fonte para você.
</p>

<pre caption = "Baixando as fontes necessárias">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Fazendo bootstrap do sistema</title>
<body>

<p>
Tudo bem, pegue seu teclado e digite os comandos seguintes para iniciar 
o processo de boostrap. Então vá se divertir com alguma outra coisa porque
este passo leva bastante tempo para terminar.
</p>

<pre caption = "Fazendo bootstrap do sistema">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Agora continue com o próximo passo, <uri link="#doc_chap4">Progredindo de um stage2 
para um stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Progredindo de um stage2 para um stage3</title>
<subsection>
<title>Introdução</title>
<body>

<p>
Se você estiver lendo esta seção, então você tem um sistema com o bootstrap feito
(ou você fez bootstrap antes, ou você está usando um
<e>stage2</e>). Agora está na hora de construir os pacotes de sistema.
</p>

<p>
<e>Todos</e> pacotes de sistema? Não, na verdade não. Neste passo, você irá construir
os pacotes de sistema para os quais não há alternativas. Alguns pacotes
têm várias alternativas (como loggers de sistema) e como o Gentoo
revolve em torno de escolhas, não forçamos nada a você.
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Vendo o que será feito</title>
<body>

<p>
Se você quiser saber que pacotes serão instalados, execute <c>emerge
--pretend --emptytree system</c>. Isto irá listar todos pacotes que serão 
construídos. Como esta lista é muito grande, você também deve usar um pager como
<c>less</c> ou <c>more</c> para subir e descer na lista.
</p>

<pre caption = "Vendo o que 'emerge system' irá fazer">
# <i>emerge --pretend --emptytree system | less</i>
</pre>

<p>
Note que, se você não tocou o ajuste padrão de CFLAGS/CXXFLAGS, fazer
<c>emerge --pretend --newuse system</c> é o suficiente: isto irá reconstruir as
aplicações que são afetadas por uma mudança nas opções de USE (comparado com a opção de
USE que nós usamos quando construindo o stage2.) Se você não tocou
a opção de USE, então por que está fazendo uma instalação de stage2?
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Baixando as fontes</title>
<body>

<p>
Se você quiser que o <c>emerge</c> baixe as fontes antes de continuar
(por exemplo, porque você não terá uma conexão de Internet aberta 
enquanto você está construindo todos pacotes) você pode usar a opção <e>--fetchonly</e>
do <c>emerge</c> que irá baixar todas fontes para você.
</p>

<pre caption = "Baixando as fontes">
# <i>emerge --fetchonly --emptytree system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Construindo o sistema</title>
<body>

<p>
Para começar a construir o sistema, execute <c>emerge --emptytree system</c>. Então vá
fazer algo para manter sua mente ocupada, porque este passo leva bastante 
tempo para terminar.
</p>

<pre caption = "Construindo o sistema">
# <i>emerge --emptytree system</i>
</pre>

<p>
Novamente, se você não tocou no ajuste de CFLAGS e CXXFLAGS, usar
<c>--newuse</c> é o suficiente.
</p>

<p>
Você pode agora ignorar com segurança qualquer aviso sobre arquivos de configuração atualizados
(e rodar <c>etc-update</c>). Quando o sistema Gentoo estiver inteiramente instalado e
carregado, leia nossa documentação em <uri
link="?part=3&amp;chap=2#doc_chap3">Proteção de arquivos de configuração</uri>.
</p>

<p>
Quando o processo de construção houver terminado, continue com <uri
link="?part=1&amp;chap=7">Configurando o kernel</uri>.
</p>

</body>
</subsection>
</section>

</sections>
