<?xml version='1.0' encoding="UTF-8"?> 
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pt_br/printing-howto.xml,v 1.2 2005/01/27 19:04:37 enderson Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/pt_br/printing-howto.xml"> 

<title>Guia de impressão do Gentoo</title> 

<author title="Autor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Editor">
  <mail link="wleggette@gate.net">Wesley Leggette</mail>
</author>
<author title="Editor">
  <mail link="carl@gentoo.org">Carl Anderson</mail>
</author>
<author title="Editor">
  <mail link="lanius@gentoo.org">Heinrich Wendel</mail>
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor de cópia">
  <mail link="phil@thenexusproject.org">Phil Bordelon</mail>
</author>
<author title="Tradutor">
  <mail link="marcelogoes@gmail.com">Marcelo Góes</mail>
</author> 

<abstract>
Um guia completo para a impressão com o Gentoo Linux.
Este documento cobre impressão local e de rede.
</abstract> 

<license/>

<version>1.20</version>
<date>2004-10-25</date>

<chapter> 
<title>Instalando CUPS e foomatic</title> 
<section>
<body> 

<p>
Configurar a impressão no Gentoo Linux é uma tarefa relativamente indolor, graças
a grandes programas como o CUPS (Common Unix Printing System) e o 
foomatic. Ambos estão atualmente na árvore do Portage, e são
muito fáceis de configurar para o usuário final.
</p> 

<p>
Por favor saiba que o cups funciona em vários desktops, isto é, você pode seguir
estas instruções para fazer a impressão funciona no GNOME ou no KDE.
Existem outras opções, como a configuração de impressão do KDE, mas acredito que
o CUPS é o mais fácil de configurar, e o mais escalável.
</p>

<p>
Antes de instalar o CUPS, é uma boa idéia adicionar as opções 
de USE necessárias ao <path>/etc/make.conf</path>.
</p>

<pre caption = "Editando o /etc/make.conf">
<comment>adicione cups, foomaticdb, ppds e usb (se você estiver usando uma conexão de impressora USB) a sua lista de variáveis de USE existente. </comment>
USE="cups foomaticdb ppds usb outra_var1 outra_var2"
</pre>

<p>
Para mais informações sobre variáveis de USE, por favor veja o capítulo <uri
link="http://www.gentoo.org/doc/pt_br/handbook/handbook-x86.xml?part=2&amp;chap=2">opções de 
USE</uri> no Manual do Gentoo.
</p>

<pre caption = "Instalando os pacotes necessários">
# <i>emerge cups</i>
# <i>emerge foomatic </i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configurando módulos do kernel</title> 
<section>
<title>Geral</title>
<body>

<p>
Agora que os pacotes necessários estão instalados, está na hora de instalar a
impressora.
</p>

<p>
Dependendo de que tipo de conexão de impressora você usar, será
necessário ativar ou conexão de porta parela ou USB
no kernel.
</p>

<note>
Isto só é necessário para a impressão local, se você quiser imprimir via samba, pule
esta seção.
</note>

<note>
Se você não tiver certeza de como compilar o kernel, as instruções
específicas podem ser encontradas em <uri 
link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">Kernel Howto</uri> (atualmente
sendo revisado). Certifique-se que você saiba como compilar e instalar novos módulos
sem ter que re-compilar seu kernel ou re-iniciar o seu computador. Economiza bastante
tempo.
</note>

</body>
</section>
<section>
<title>Módulos de USB</title>
<body>

<p>
Para ativar suporte a impressoras USB, vá para <c>USB support</c> e ative <c>Support 
for USB</c> e <c>USB Printer support</c>. Ativar os dois como módulos irá
instalar usbcore.o e printer.o no diretório de módulos. Eu sugiro usar
módulos porque você não terá que re-iniciar seu computador. Usuários de kernéis 2.6
irão encontrar as opções em <c>Device Drivers</c>.
</p>

<p>
Depois que o kernel for construído, e seu computador re-iniciado, está na hora de carregar
os módulos necessários:
</p>

<pre caption = "Carregando módulos USB">
# <i>modprobe usbcore</i> 

<comment>(Para usuários de kernel 2.4:)</comment>
# <i>modprobe printer</i>
<comment>(Para usuários de kernel 2.6:)</comment>
# <i>modprobe usblp</i>
</pre> 

<p>
Depois de os módulos terem sido carregados com sucesso, plugue a impressora, e verifique o
<c>dmesg</c> para ver se foi detectada.
</p> 

<pre caption = "Vendo mensagens do kernel">
# <i>dmesg | tail</i>
</pre> 

<p>
Você deverá ver algo assim:
</p>

<pre caption = "saída do dmesg">
hub.c: USB new device connect on bus2/2, assigned device number 2 
printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104
</pre>

</body>
</section> 
<section>
<title>Módulos de porta paralela</title>
<body>

<p>
Para ativar suporte a porta paralela, vá para <c>Parallel port support</c> e ative
<c>Parallel port support</c> e <c>PC-style hardware</c>. Dependendo da sua
impressora você também deve ativar <c>Multi-IO cards (parallel and serial)</c>,
<c>Support for foreign hardware</c> e <c>IEEE 1284 transfer mode</c>. Então
vá em <c>Character devices</c> e ative <c>Parallel Printer Support</c>. Usuários de
kernel 2.4 irão encontrar essas opções em <c>Device Drivers</c>.
</p>

<p>
Depois de o kernel ser construído, certifique-se que a impressora está conectada e
re-inicie seu computador. Agora está na hora de carregar os módulos necessários:
</p>

<pre caption = "Carregando módulos de porta paralela">
# <i>modprobe lp</i> <comment>(Só para usuários de kernel 2.6)</comment>
# <i>modprobe parport</i> 
# <i>modprobe parport_pc</i>
</pre> 

<p>
Depois de os módulos terem sido carregados com sucesso, veja
<path>/var/log/messages</path> para conferir se a impressora foi detectada.
</p> 

<note>
Se você estiver usando algo diferente do sysklogd, seu arquivo de registro do kernel será
diferente.
</note>

<pre caption = "Vendo mensagens do kernel">
# <i>tail /var/log/messages</i>
</pre> 

<p>
Você deverá ver algo do tipo:
</p>

<pre caption = "saída de /var/log/messages">
lp0: using parport0 (polling).
</pre>

</body>
</section>
<section>
<title>Teste de baixo nível</title>
<body>

<p>
Antes de configurar a impressora com o CUPS, podemos testá-la com alguns simples
comandos de baixo nível.
</p>

<note>
Algumas impressoras (especialmente as <uri 
link="http://pnm2ppa.sourceforge.net">baseadas em PPA</uri> com a HP 720 series,
820 series e 1000 series) não aceitam alimentação ASCII. Se você tiver uma dessas impressoras,
lembre-se de que você tem uma impressora <e>baseada em PPA</e> e que o teste dará errado
mesmo se a impressora funcionar.
</note> 

<note>
Algumas impressoras (como várias HP LaserJets) precisam de um ^L
(Control-L) no final do arquivo para iniciar a impressão.
Sem o ^L o cat tem sucesso, mas a impressora absorve
os dados, e espera sentada sem fazer nada.
</note>

<pre caption = "Testando a impressora usando cat">
# <i>touch test.txt</i>
# <i>echo "Hello World" > test.txt</i>
# <i>cat test.txt > /dev/usb/lp0 </i>

<comment> Alternativamente, para impressoras de porta paralela: </comment>
# <i>cat test.txt > /dev/lp0 </i>
</pre>

</body>
</section>
</chapter>			

<chapter>
<title>Drivers especiais de impressora</title> 
<section>
<body> 

<p>
Antes de usar o foomatic para gerar um arquivo PPD, pode ser necessário localizar
drivers de terceiros para suas impressoras. Por exemplo, a Epson fornece <uri 
link="http://www.epkowa.co.jp/english/linux_e/linux.html">vários drivers de
impressora</uri> para sistemas operacionais de código aberto. No entanto, como com os da Epson,
muitos dos drivers especiais não são de código aberto.
</p>

<p>
Os seguintes drivers de impressão estão disponíveis como ebuilds no Portage: gimp-print,
omni, hpijs, pnm2ppa.
</p>

<p>
Para a maior parte das impressoras fora HPs jato de tinta, você poderá usar os drivers
padrão de impressora do Linux. Visite o <uri 
link="http://www.linuxprinting.org/printer_list.cgi">banco de dados de suporte de
impressoras do linuxprinting.org</uri> para descobrir mais informações sobre sua impressora específica. Certifique-se
de ler a documentação fornecida com qualquer driver que você baixar sobre
informações de instalação e licenciamento.
</p> 

<p>
Se você estiver usando uma impressora HP jato de tinta, é necessário instalar o
driver de impressão <c>hpijs</c>. O driver lida com toda interpretação de
Postscript necessária para fazer a impressora HP funcionar. O driver <c>hpijs</c>
é só para impressoras HP jato de tinta, mas está disponível através do Portage para
sua conveniência. A documentação da HP para o driver <c>hpijs</c> será
colocada em <path>/usr/share/doc/hpijs-&lt;versão&gt;</path>. O autor
recomenda <e>muito</e> sua leitura.
</p>

<p>
Se você estiver usando uma impressora baseada em PPA, é necessário instalar o
driver de impressão <c>pnm2ppa</c>.
</p>

<pre caption="Instalando o hpijs">
# <i>emerge hpijs</i>
</pre>

<note>
Se você estiver usando uma HP Laserjet, o suporte pode já estar disponível através do sistema
de impressão do GNOME. Se você você estiver usando uma impressora fora HP jato de tinta, você não precisa
instalar este driver especial de impressão.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Configuração do arquivo PPD</title>
<section>
<body>

<p>
Agora está na hora de configurar a impressora e o CUPS. Para sua impressora interpretar
Postscript corretamente, o CUPS precisa de um arquivo PPD (Printer Postscript Definition).
O jeito mais fácil de gerar um PPD é através do foomatic.
</p>

<note>
Outro jeito é baixar um arquivo PPD de <uri
link="http://www.linuxprinting.org">LinuxPrinting.org</uri> e colocá-lo em
<path>/usr/share/cups/model</path>. Se você usar este método, você pode pular o
resto desta seção e continuar com <uri link="#doc_chap5">Configuração do
CUPS</uri>.
</note>

<p>
Três informações são necessárias para fazer o comando abaixo
funcionar; você precisa de sua ID de impressora, dispositivo de impressão, e seu driver de impressão (que
será hpijs se você precisou instalar o driver especial acima). A ID de impressora
e o driver podem ser <c>grep-ados</c> do banco de dados do foomatic, e o dispositivo
de impressão é o nódulo de dispositivo ao qual sua impressora está conectado (isto é
<path>file:/dev/lp0</path>, <path>file:/dev/usb/lp0</path> ou para impressoras de samba
<path>smb://user:password@server/share</path>).
</p>

<p>
Antes de usar o <c>foomatic-configure</c>, por favor, lembre-se de iniciar o <c>cupsd</c>.
</p>

<pre caption = "Iniciando o cupsd">
# <i>/etc/init.d/cupsd start</i>
</pre>

<pre caption = "Uso geral do foomatic">
<comment>(Coloque o modelo de sua impressora no lugar de $printer_model e ID de impressora no $printer_ID)</comment>
<comment>(Use a saída das duas primeiras expressões de grep para 
preencher o último comando de foomatic-configure)</comment>
# <i>grep $printer_model /usr/share/foomatic/db/source/printer/* </i>
# <i>grep $printer_ID /usr/share/foomatic/db/source/driver/* </i>
# <i>foomatic-configure -s cups -p $printer_model_number -c file:$print_device_path -n queue name -d driver </i>
</pre>

<p>
Se grep-ar pelo driver não funcionar, você pode procurar sua impressora em <uri
link="http://www.linuxprinting.org">LinuxPrinting.org</uri> e verificar com quais
drivers sabe-se que ela funciona. Então escolha um dos drivers e instale:
</p>

<pre caption="Instalando um driver PPD">
<comment>(Se você usa impressoras múltiplas, use nomes separados de filas. Caso
contrário, um nome fácil de lembrar como "padrao" servirá)</comment>
# <i>foomatic-configure -s cups -p &lt;modelo de impressora&gt; -c file:&lt;dispositivo de impressora&gt; -n &lt;nome da fila&gt; -d &lt;driver&gt;</i>
</pre>

<p>
Agora, aqui está um exemplo mais específico. O código seguinte presume que você tem
uma Epson Stylus Color 980. Claro, você deve substituir isso com o modelo
de sua impressora.
</p>

<pre caption="Uso específico do foomatic com uma Stylus Color 980">
# <i>grep "Stylus Color 980" /usr/share/foomatic/db/source/printer/* </i>
<comment> Agora procure pela linha que diz: </comment>
/usr/share/foomatic/db/source/printer/Epson-Stylus_Color_980.xml:   &lt;model>Stylus Color 980&lt;/model>
<comment> Epson-Stylus_Color_980 é sua ID de impressora. </comment>

# <i>grep Epson-Stylus_Color_980 /usr/share/foomatic/db/source/driver/* </i>
/usr/share/foomatic/db/source/driver/gimp-print-ijs.xml:  &lt;printer>&lt;id>printer/Epson-Stylus_Color_980&lt;/id>&lt;/printer>
<comment> Aqui, seu driver de impressão é o gimp-print-ijs.</comment>

# <i>foomatic-configure -s cups -p Epson-Stylus_Color_980 -c file:/dev/lp0 -n Epson -d gimp-print-ijs </i>
</pre>

</body> 
</section>
</chapter> 

<chapter> 
<title>Configuração do CUPS</title> 
<section>
<body> 

<p>
Já que a impressora em si está agora configurada, agora o CUPS deve ser configurado
para lidar com filas de impressão. O CUPS pode ser acessado via navegador na porta 631
do servidor de impressoras.
</p>

<p>
O CUPS tem um arquivo de configuração para o daemon que deve no mínimo
ser modificado para permitir nomes de dispositivo no estilo URI. Abra o
<path>/etc/cups/cupsd.conf</path> com seu editor favorito e coloque
<c>FileDevice</c> como <c>Yes</c>:
</p>

<pre caption="Colocando FileDevice com Yes">
# <i>nano -w /etc/cups/cupsd.conf</i>
<comment>(Coloque FileDevice como Yes)</comment>
</pre>

<p>
Para aqueles que querem configurar clientes para uso com o novo servidor de impressão por favor
veja o <path>/etc/cupsd/client.conf</path> na máquina cliente e aponte o
parâmetro <c>ServerName</c> para o nome de rede de seu servidor de impressão.
</p>

<pre caption = "Adicionando o CUPS ao runlevel padrão, e re-iniciando o CUPS">
# <i>rc-update add cupsd default</i>
# <i>/etc/init.d/cupsd restart</i>
</pre>

<p>
O daemon do CUPS deve estar rodando agora, então abra seu navegador favorito, aponte-o
para <uri>http://localhost:631</uri> e clique em <c>Manage Printer</c>. Aqui
você encontrará sua impressora recém-instalada, configure-a ou imprima uma página de teste.
Certifique-se de colocar o tamanho padrão de página para o que você usa (como A4
ao invés de Letter).
</p> 

<note>
Se sua impressora não funcionar por algum motivo, vá para o diretório onde você
falou para seus registros do CUPS serão gravados, e veja o <c>error_log</c>.
</note>

</body> 
</section>
</chapter>

<chapter>
<title>Configurando programas para imprimir usando o CUPS</title>
<section>
<title>Geral</title>
<body>

<p>
A maior parte dos programas hoje em dia tem uma interface nativa do CUPS, então você não precisa mudar
nada, só tente imprimir do programa.
</p>

</body>
</section>
<section>
<title>The GIMP</title>
<body>

<p>
Para poder imprimir documentos usando The Gimp, você precisa (re)instalar o pacote
<c>gimp</c> com a variável de USE "gimpprint" ativada. Isto irá instalar o
<c>gimp-print</c> se não já tiver instalado.
</p>

<pre caption="Instalando o gimp com capacidades de impressão">
<comment>(Certifique-se de ter USE="gimpprint" ativado)</comment>
# <i>emerge gimp</i>
</pre>

<p>
Agora, abra The GIMP, e abra uma figura existente, ou uma em branco,
não importa muito porque tudo que queremos é o menu <c>Arquivo</c>.
Clique com o botão direito na imagem e vá para <c>Arquivo/Imprimir</c>. O diálogo
de impressão deve aparecer, e quando aparecer, clique em nova impressora.
Se sua impressora já não estiver listada, digite o nome de sua impressora, e
selecione o tipo de impressora. Ok, você configurou The GIMP para impressão. Brinque
com os ajustes e divirta-se.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Usando o Linux como um servidor de impressão compatível com Windows</title>
<section>
<body>

<p>
O Linux faz um bom servidor de impressão, mas de novo, ele faz um bom servidor
de tudo. A primeira coisa a fazer é editar o <path>/etc/samba/smb.conf</path> para atender
a sua configuração. O arquivo <path>smb.conf</path> contém todos ajustes que
irão fazer sua máquina Linux parecer um servidor de Windows NT para qualquer máquina Windows.
Eu incluí um útil exemplo de <path>smb.conf</path> abaixo. Edite
como necessário para seu ambiente de rede. 
</p>

<pre caption = "Amostra de smb.conf">
[global]

workgroup = SEU_WORKGROUP
server string = Servidor Gentoo Linux
encrypt passwords = True
security = user
smb passwd file = /etc/samba/private/smbpasswd
log file = /var/log/samba/log.%m
socket options = IPTOS_LOWDELAY TCP_NODELAY
domain master = Yes
local master = Yes
preferred master = Yes
os level = 65
dns proxy = No
name resolve order = lmhosts host bcast
bind interfaces only = True
interfaces = eth0
hosts deny = ALL
hosts allow = 192.168.1.4 127.0.0.1 (lista de hosts permitidos aqui) 
debug level = 1
create mask = 0644
directory mask = 0755
level2 oplocks = True
read raw = no
write cache size = 262144

[printers]
comment = All Printer
path = /var/spool/samba
browseable = no
</pre>

<p>
A maior parte dos drivers de Windows são drivers PCL. Trabalhos enviados do Windows devem ser
interpretados pelo CUPS como <c>application/octet-stream</c> e impressos como um
arquivo raw. Se você usar o CUPS, abra o <path>/etc/cups/mime.types</path> e
descomente a seguinte linha:
</p>

<pre caption="Descomente uma linha do /etc/cups/mime.types">
application/octet-stream
</pre>

<p>
Faça o mesmo para a seguinte linha no <path>/etc/cups/mime.convs</path>:
</p>

<pre caption="Descomente uma linha do /etc/cups/mime.convs">
application/octet-stream application/vnd.cups-raw   0 -
</pre>

<p>
Agora que o SAMBA está configurado, re-inicie o samba, vá para sua máquina Windows
e instale uma impressora de rede. Fácil, não?
</p>

</body>
</section>
</chapter>
</guide>
