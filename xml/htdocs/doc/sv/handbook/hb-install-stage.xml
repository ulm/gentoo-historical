<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/sv/handbook/hb-install-stage.xml,v 1.1 2004/11/06 17:15:27 neysx Exp $ -->

<sections>
<section>
<title>Installera ett stadiumarkiv</title>
<subsection>
<title>Ställ in rätt tid och datum</title>
<body>

<p>
Innan du fortsätter behöver du kontrollera tid/datum och uppdatera dem. En felinställd klocka kan leda till konstiga resultat längre fram.
</p>

<p>
För att kontrollera datum och tid kör du <c>date</c>:
</p>

<pre caption="Bekräfta datum och tid">
# <i>date</i>
Sun Apr 25 16:21:18 CEST 2004
</pre>

<p>
Om tiden och/eller datumet är fel uppdaterar du det med <c>date
MMDDttmmÅÅÅÅ</c> syntax (<b>M</b>ånad, <b>D</b>ag, <b>t</b>imme, <b>m</b>inut
och <b>Å</b>r). För att exempelvis ange tid och datum till 16:21 25 april år 2004:
</p>

<pre caption="Att ställa in datum och tid">
# <i>date 042516212004</i>
</pre>

</body>
</subsection>
<subsection>
<title>Att välja</title>
<body>

<p>
I nästa steg installerar du <e>stadium</e>arkivet du bestämt dig för för ditt system. 
Du kan välja mellan att hämta ner det nödvändiga arkivet från Internet eller, om du 
har startat från en Gentoo Universal LiveCD, kopiera den från CDn. Om du har en 
Universal CD och det stadium du vill använda finns på den, så slösar du bara bandbredd
på att hämta den från Internet. Stadiumarkivet är det samma.
</p>

<ul>
<li><uri link="#doc_chap2">Standard: Att använda ett stadium från Internet</uri></li>
<li><uri link="#doc_chap3">Alternativ: Att använda ett stadiumarkiv från LiveCD</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Standard: Att använda ett stadium från Internet</title>
<subsection>
<title>Hämta ner stadiumarkivet</title>
<body>

<p>
Gå till den plats i filsystemet där du monterade dina filsystem (troligen <path>/mnt/gentoo</path>):
</p>

<pre caption="Att flytta till monteringsplatsen för Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Beroende på ditt installationsmedium har du några verktyg att välja på för att hämta ner ett stadium. 
Om du har tillgång till <c>links2</c> kan direkt surfa till <uri link="/main/en/mirrors.xml">speglingslistan
på Gentoo</uri> och välja en spegel nära dig. Välj sedan <path>releases/</path> katalogen, din arkitektur
 (<path>x86/</path> till exempel) och Gentoo versionen (<path>2004.2/</path>) och till slut 
<path>stages/</path> katalogen. Där finner du alla tillgängliga stadimfiler för din arkitektur (de kan vara 
sparade i underkataloger namngivna efter den specifika subarkitekturen). Välj en av dem och tryck <c>D</c> 
för att hämta hem den. När du är klar trycker du <c>Q</c> för att stänga webbläsaren.
</p>

<pre caption="Surfa till speglingslistan med links2">
<comment>(Utan proxy)</comment>   # <i>links2 http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Med proxy)</comment>      # <i>links2 -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Om du vill kontrollera det hämtade stadiumarkivets integritet, använder du <c>md5sum</c> 
och jämför resultatet med den MD5 kontrollsumman som finns på speglingssajten. Om du exempelvis vill
validera ett x86 stadiumarkiv:
</p>

<pre caption="Exempel för att kontrollera ett stadiumarkivs integritet">
# <i>md5sum -c stage1-x86-2004.2.tar.bz2.md5</i>
stage1-x86-2004.2.tar.bz2: OK
</pre>

</body>
</subsection>
<subsection>
<title>Packa upp stadiumarkivet</title>
<body>

<p>
Packa nu upp det stadium du hämtat ner till ditt system. Vi använder GNU <c>tar</c> 
här eftersom det är det enklaste sättet:
</p>

<pre caption="Packa upp stadiet">
# <i>tar -xvjpf stage?-*.tar.bz2</i>
</pre>

<p>
Se till att du använder samma val (<c>-xvjpf</c>). <c>x</c> står för <e>Extrahera</e>, <c>v</c> 
betyder <e>Verbose</e> (mångordig, du får mer information om vad som händer [ö.a.], okey, jo, 
detta är valfritt), <c>j</c> står för <e>dekomprimera med bzip2</e>, medan slutligen <c>p</c> står för<e> 
bevara rättigheterna</e> och <c>f</c> visar att vi vill extrahera en fil inte standard indata.
</p>

<p>
Nu när du har installerat stadiet fortsätter du med <uri link="#installing_portage">Installera Portage</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Alternativ: Att använda ett stadium från LiveCD</title>
<subsection>
<title>Extrahera stadiumarkivet</title>
<body>

<p>
Stadierna på CDn finns i <path>/mnt/cdrom/stages</path> katalogen. För att se en lista på tillgängliga
stadier använder du <c>ls</c>:
</p>

<pre caption="Lista alla tillgängliga stadier">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Om systemet svarar med ett fel kan du behöva montera CDn först:
</p>

<pre caption="Montera en CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Gå nu till den plats i filsystemet där du monterat där du har monterat Gentoo 
(vanligen <path>/mnt/gentoo</path>):
</p>

<pre caption="Gå till katalogen /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Vi kommer nu att extrahera stadiumarkivet du valt. Vi gör detta med verktyget GNU <c>tar</c>. 
Se till att du använder samma val (<c>-xvjpf</c>)! I nästa exempel extraherar vi stadiumarkivet
<path>stage3-&lt;subarch&gt;-2004.2.tar.bz2</path>.
Försäkra dig om att du byter ut exempelarkivnamnet med namnet på ditt valda stadiumarkiv.
</p>

<pre caption="Extrahera stadiumarkivet">
# <i>tar -xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2004.2.tar.bz2</i>
</pre>

<p>
Nu när du har installerat stadiet fortsätter du med <uri link="#installing_portage">Installera Portage</uri>.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Installera Portage</title>
<subsection>
<title>Med eller utan nätverk?</title>
<body>

<p>
Om du inte har en fungerande nätverksanslutning måste du installera den portagebild som finns 
på en av våra LiveCD. Detta förutsätter automatiskt att du installerar från ett <e>stadium 3</e> 
arkiv (då det är det enda arkiv som stöder installationer utan nätverk). Om du vill använda 
förkompilerade paket senare för att snabba upp installationen <e>måste</e> du använda 
en portagebild från LiveCD. Andra användare kommer att hämta ett helt uppdaterad Portageträd 
med <c>emerge</c> i nästa kapitel. 
</p>

<p>
Fortsätt med korrekt avsnitt:
</p>

<ul>
  <li>
    <uri link="#installing_from_LiveCD">Installera en Portagebild och källkod från
    LiveCD</uri> (för nätverkslös installation eller GRP installationer)
  </li>
  <li>
    <uri link="#compile_options">Konfigurera kompileringsmöjligheterna</uri> (alla 
    andra installationsmetoder)
  </li>
</ul>

</body>
</subsection>
<subsection id="installing_from_LiveCD">
<title>Installera en Portagebild och källkod från LiveCD</title>
<body>

<p>
Det finns en Portagebild på Universal LiveCD. Eftersom du läser detta kan vi säkerligen utgå
från att du använder en sådan LiveCD. Titta i <path>/mnt/cdrom/snapshots/</path> för att 
installera denna bild. Du ser där vilka Portagebilder som är tillängliga:
</p>

<pre caption="Kontrollera innehållet i /mnt/cdrom/snapshots">
# <i>ls /mnt/cdrom/snapshots</i>
</pre>

<p>
Extrahera nu bilden genom att använda formeln nedan. Återigen ska du se till att du väljer 
de rätta valen till <c>tar</c>. Lägg dessutom märke till att <c>-C</c> använder stort
<c>C</c>, inte <c>c</c>. I nästa exempel använder vi <path>portage-20040710.tar.bz2</path> 
som bildnamn. Se till att du byter detta mot ditt valda bildnamn.
</p>

<pre caption="Extrahera en Portagebild">
# <i>tar -xvjf /mnt/cdrom/snapshots/portage-20040710.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

<p>
Du måste också kopiera över all källkod från CDn CD:
</p>

<pre caption="Kopiera över källkod">
# <i>mkdir /mnt/gentoo/usr/portage/distfiles</i>
# <i>cp /mnt/cdrom/distfiles/* /mnt/gentoo/usr/portage/distfiles/</i>
</pre>

<p>
Nu när din Portagebild är installerad fortsätter du med  <uri
link="#compile_options">Konfigurera kompileringsmöjligheterna</uri>.
</p>

</body>
</subsection>
</section>

<section id="compile_options">
<title>Konfigurera kompileringsmöjligheterna</title>
<subsection>
<title>Inledning</title>
<body>

<p>
För att optimera Gentoo kan du ange några variabler som påverkar hur
Portage beter sig. Alla variabler kan anges som miljövariabler (med <c>export</c>) 
men är då inte permanenta. För att behålla inställningar tillhandahåller Portage
konfigurationsfilen <path>/etc/make.conf</path>. Det är denna fil vi kommer att
redigera nu. 
</p>

<note>
En kommenterad lista på alla möjliga variabler finns i <path>/mnt/gentoo/etc/make.conf.example</path>. 
För att lyckas med Gentoo installationen behöver du bara ange variablerna som nämns här nedan.
</note>

<p>
Starta din favoriteditor (i denna guide använder vi <c>nano</c>) så kan vi ändra de optimeringsvariabler
som vi kommer att diskutera framöver. 
</p>

<pre caption="Öppna /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Som du förmodligen märkte har filen <path>make.conf.example</path> en generisk
struktur: kommenterade rader börjar med "#", andra rader definierar variabler med
<c>VARIABLE="content"</c> syntaxen. <path>make.conf</path> filen använder 
samma syntax. Flera av dessa variabler diskuteras här nedan. 
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<warn>
Även om det kan vara lockande för andra än stadium 1 användare så ska de <e>inte</e>
ändra <c>CHOST</c> värdet i <path>make.conf</path>. Om man gör det kan systemet bli
oanvändbart. Återigen: ändra bara denna variabel om du använder en <e>stadium 1</e> installation.
</warn>

<p>
<c>CHOST</c> variabeln definierar vilken arkitektur <c>gcc</c> ska kompilera program för. 
Följande möljligheter finns:
</p>

<table>
<tr>
  <th>Arkitektur</th>
  <th>Subarkitektur</th>
  <th>CHOST värde</th>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i386</ti>
  <ti>i386-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i486</ti>
  <ti>i486-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i586</ti>
  <ti>i586-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i686 och bättre (inkl. athlon)</ti>
  <ti>i686-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>alpha</ti>
  <ti></ti>
  <ti>alpha-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc</ti>
  <ti></ti>
  <ti>powerpc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc64</ti>
  <ti></ti>
  <ti>powerpc64-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>sparc</ti>
  <ti></ti>
  <ti>sparc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>(generisk)</ti>
  <ti>hppa-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa7000</ti>
  <ti>hppa1.1-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa8000 och bättre</ti>
  <ti>hppa2.0-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>mips</ti>
  <ti></ti>
  <ti>mips-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>amd64</ti>
  <ti></ti>
  <ti>x86_64-pc-linux-gnu</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>CFLAGS och CXXFLAGS</title>
<body>

<p>
<c>CFLAGS</c> och <c>CXXFLAGS</c> variabler definierar optimeringsflaggor för 
<c>gcc</c>, C och C++ kompilatorerna. Även om vi gör en generell definition av dessa
här så kommer du bara att ha maximal prestanda om du optimerar desa flaggor för 
varje program för sig. Orsaken till detta är att alla program är olika. 
</p>

<p>
I <path>make.conf</path> ska du definiera optimeringsflaggor du <e>generellt</e> tror 
förbättrar prestandan i ditt system. Experimentera inte med detta värde. För mycket 
optimering kan få dina program att uppföra sig dåligt (krascha, eller till och med sluta 
fungera).
</p>

<p>
Vi kommer inte att förklara alla möjliga optimeringsmöjligheter. Om du vill lära dig alla
- läs <uri link="http://gcc.gnu.org/onlinedocs/">GNU Online Manual(s)</uri> eller 
infosidan <c>gcc</c> (<c>info gcc</c> -- endast på ett fungerande Linuxsystem). 
Filen <path>make.conf.example</path> innehåller också mycket exempel och information,
glöm inte att läsa den. 
</p>

<p>
Ett första värde är <c>-march=</c> flaggan, som specifierar namnet på målarkitekturen. 
Möjliga val beskrivs i filen <path>make.conf.example</path> (som kommentarer). Exempelvis 
x86 Athlon XP arkitekturen:
</p>

<pre caption="GCC march värdet">
<comment># AMD64 users who want to use a native 64 bit system should not use athlon-xp</comment>
-march=athlon-xp
</pre>

<p>
Ett andra värde är <c>-O</c> flaggan (det är ett stort O, inte en nolla), som specifierar flaggan för
<c>gcc</c> optimeringsklass. Möjliga klasser är <c>s</c> (för storleksoptimerad), <c>0</c> 
(noll - för ingen optimering), <c>1</c>, <c>2</c> eller <c>3</c> för mer hastighetsoptimering 
(varje klass har samma flaggor som den föregående, plus några till). Som exempel kan tas klass 2
optimering:
</p>

<pre caption="GCC O värdet">
-O2
</pre>

<p>
Andra populära optimeringsflaggor är <c>-pipe</c> (använd pipes snarare än tillfälliga filer
för kommunikation mellan de olika stegen i kompileringen) och <c>-fomit-frame-pointer</c> 
(som inte behåller rampekaren i ett funktionsregister du inte behöver).
</p>

<p>
När du definierar <c>CFLAGS</c> och <c>CXXFLAGS</c> ska du kombinera flera optimeringsflaggor, 
som i följande exempel:
</p>

<pre caption="Definiera CFLAGS och CXXFLAGS värden">
CFLAGS="-march=athlon-xp -pipe -O2"   <comment># AMD64 users should not use athlon-xp</comment>
CXXFLAGS="${CFLAGS}"                  <comment># Use the same settings for both variables</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Med <c>MAKEOPTS</c> definierar du hur många parallella kompileringar som ska ske
nr du installerar ett paket. Ett bra värde är antalet CPU i ditt system plus ett, men denna
tumregel är inte alltid helt perfekt.
</p>

<pre caption="MAKEOPTS för ett vanligt 1-CPU system">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Klara, färdiga, gå!</title>
<body>

<p>
Uppdatera din <path>/mnt/gentoo/etc/make.conf</path> enligt dina egna önskemål och spara 
(<c>nano</c> användare trycker <c>Ctrl-X</c>). Du är nu redo att fortsätta med 
<uri link="?part=1&amp;chap=6">Installera Gentoos bassystem</uri>.
</p>

</body>
</subsection>
</section>
</sections>
