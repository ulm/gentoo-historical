<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ja/alsa-guide.xml,v 1.14 2005/03/08 21:26:30 idani Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/ja/alsa-guide.xml">
<title>Gentoo Linux ALSA ガイド</title>
<author title="Author">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Author">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Author">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Author">
  <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Editor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="翻訳">
  <mail link="iwaki_iwaki@hotmail.com">Masanori Iwasaki</mail>
</author>
<author title="翻訳">
  <mail link="yasumichi@users.sourceforge.jp">Yasumichi Akahoshi</mail>
</author>
<author title="翻訳">
  <mail link="solidsneak@hyper.cx">小林弘樹</mail>
</author>

<abstract>
このガイドはGentooLinux上でAdvanced Linux Sound Architecture (ALSA)の設定方法を解説するものです。
Gentoo Linux Desktop Configuration Guideに追加する内容として、このガイドではこの題材についてさらなる情報を提供します。
</abstract>

<license/>

<version>1.5.11</version>
<date>2005-03-06</date>

<!-- Original revision: 1.48 -->

<chapter>
<title>Advanced Linux Sound Architecture</title>
<section>
<title>ALSAって何？</title>
<body>

<p>
ALSA は<e>Advanced Linux Sound Architecture</e>の略で、高品質なLinuxサウンドシステムの開発を行うプロジェクトです。
2.6カーネルシリーズではOSS(<e>Open Sound System</e>)に変わってデフォルトのサウンドシステムになっています。
</p>

<p>
ALSAはすべてのタイプのオーディオインタフェースの効率的なサポートを提供して、完全にモジュール化されており、SMPとスレッド・セーフであり、アプリケーションプログラミングを簡素化するために<e>alsa-lib</e>と呼ばれる高品質なユーザスペースライブラリを提供します。
また、OSSの下位互換も提供します。
</p>

</body>
</section>
</chapter>
<chapter>
<title>ALSAのインストール</title>
<section>
<title>USEフラグ</title>
<body>

<p>
GentooはパッケージをALSAをサポートしてコンパイルできるように<path>/etc/make.conf</path>に設定できる<c>alsa</c>USEフラグを提供します。
<c>oss</c>をUSE変数に設定していたなら、ALSAはOSS下位互換としてコンパイルします。
</p>

</body>
</section>
<section>
<title>カーネルモジュール</title>
<body>

<p>
何よりもまず最初に、カーネルで<e>Sound Card Support</e>が有効になっているかどうかを確認してください。
カーネルのビルドに<c>genkernel</c>を使ったなら、これは自動的に有効になっています。
そうでなければカーネルを再設定します。さらに、カーネル設定で<e>Open Sound System</e>を無効になっているかどう
か確認してください。
もしそうしなければ、システムはalsaの代わりにこれらのドライバを使おうとします。
正しいドライバを使っているにもかかわらず'sound card not detected'というメッセージが表示されたなら、もしかするとこれが原因かもしれません。
</p>

<warn>
2.6カーネルを使っているなら、カーネルが提供するドライバを使うかもしれません。
しかし、カーネルツリーが提供する物よりも最新のmedia-sound/alsa-driverを利用することを推奨します。
それでもまだカーネルが提供するドライバを使おうと思うなら、この章の以降の部分は飛ばして<uri link="#alsa-utils">ALSA Utilsのインストール</uri>に進むことができます。
</warn>

<p>
サウンドドライバをインストールする最初の段階は、あなたがどのサウンドカードを使っているのかを知ることです。
まだ知らなければ、簡単な方法は<c>lspci</c>コマンドの出力で"audio"を検索してください。
<c>emerge pciutils</c>でインストールできます。
</p>

<pre caption="サウンドカードの種類を探す">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
次に<uri link="http://www.alsa-project.org/alsa-doc">ALSA Soundcard Matrix</uri>に行ってサウンドカードを探してください。
上記の例では"VIA"に行きます。
ベンダーの知られているチップセットの表が表示されるでしょう。
上記例のチップセットは"via82c686"です。
"Details"リンクではドライバが<path>via82xx</path>ということが分かります。
これで必要な情報を得ることができたので、このドキュメントは閉じてしまって構いません。
</p>

<p>
この情報をもとに、サウンドカード用に<c>alsa-driver</c>をインストールすることができます。
まず<path>/etc/make.conf</path>を編集してALSA_CARDSという新しいオプションを<e>追加</e>します。
この変数で利用したいサウンドドライバを宣言します。
</p>

<pre caption="/etc/make.confを編集してALSA_CARDSを追加">
ALSA_CARDS="via82xx"
</pre>

<warn>
システムに複数のサウンドカードがあるなら、それらをALSA_CARDS変数でコンマで区切ります。
例えば、ALSA_CARDS="via82xx,emu10k1"の様にします。
</warn>

<p>
もしOSS互換性(強く推奨)を必要とするなら、<path>/etc/make.conf</path>のUSEフラグに'oss'を追加してください。
その後、<c>alsa-driver</c>をインストールします。
</p>

<pre caption="ALSAドライバのインストール">
# <i>emerge alsa-driver</i>
</pre>

<impo>
カーネルソースを(再)コンパイルする時はいつでも、おそらくALSAドライバは上書きされるでしょう。
その為、カーネルを(再)コンパイルした<e>後</e>に<c>emerge alsa-driver</c>を再度実行することをお勧めします。
これはドライバを/usr/src/linuxにあるカーネル用にコンパイルすることであり、起動中のカーネルへではないと言うことに注意してください。
</impo>

</body>
</section>
<section id="alsa-utils">
<title>ALSA Utilsのインストール</title>
<body>

<p>
カーネルレベルのOSS互換機能で不十分な場合には、<c>alsa-oss</c>をインストールしましょう。
これは以下のように使われる実行可能な'aoss'を提供します。
</p>

<pre caption="より多くのOSS互換レイヤ">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
ではシステムにALSA Utilsをインストールしましょう(これは必須です)。
</p>

<pre caption="ALSA Utilsのインストール">
# <i>emerge alsa-utils</i>
</pre>

<p>
これでutilsがインストールされたので、ALSAの設定をしましょう。
</p>

</body>
</section>
</chapter>
<chapter>
<title>ALSAの設定</title>
<section>
<title>カーネルモジュールの自動読み込み</title>
<body>

<p>
モジュール式のカーネルを使っている(<c>genkernel</c>を使った時など)なら、<path>/etc/modules.d/alsa</path>を編集してシステム起動時に必要なモジュールが有効になるようにします。
サウンドカードなら例のようにします。
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># 以下はOSS互換が必要な時のみ必要です</comment>
alias sound-slot-0 snd-via82xx
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
では<c>modules-update</c>を実行して、あなたが作成したalsaファイルを<path>/etc/modules.conf</path>の中に加え、変更を保存します。
</p>

<pre caption="modules-updateの実行">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>デバイスファイルの確認</title>
<body>

<p>
最近のインストールではこれは自動的に行われますが、もし問題に直面したなら、ALSAデバイスと、/devマネージャにパーミションが正しく設定されているか確認してください。
DevFSを使っているなら、<path>/etc/devfsd.conf</path>を確認します。
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>システム起動時にALSAを有効にする</title>
<body>

<p>
システム起動時にALSAを有効にするには、<c>alsasound</c>スクリプトをブートランレベルに追加します。
</p>

<pre caption="alsasoundをブートランレベルに追加">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>チャンネルのミュート(消音)解除</title>
<body>

<p>
デフォルトでは、全てのサウンドチャンネルはミュートされています。これを修正するには、<c>amixer</c>を実行します。
</p>

<pre caption="amixerの実行">
# <i>amixer</i>
</pre>

<p>
もし<c>amixer</c>が多くの出力を行うなら、チャンネルのミュート解除をする準備ができています。
エラーが表示されたなら、サウンドカードモジュールが起動しているか再度確認してください。
</p>

<p>
では<e>Master</e>と<e>PCM</e>チャンネルをミュート解除しましょう。
これで十分でなければ、<e>Center</e>と<e>Surround</e>チャンネルもミュート解除します。
</p>

<pre caption="サウンドチャンネルのミュート解除">
<comment>(ncurses方法を好むなら)</comment>
# <i>alsamixer</i>

<comment>(もしくは)</comment>

# <i>amixer set Master 100% unmute</i>
# <i>amixer set PCM 100% unmute</i>
<comment>(上で十分でなかった時のみ)</comment>
# <i>amixer set Center 100% unmute</i>
# <i>amixer set Surround 100% unmute</i>
# <i>amixer set Headphone 100% unmute</i>
</pre>


<p>
サウンドが動作するか確かめるには、waveファイル(<c>aplay</c>を利用)、mp3(<c>mpg123</c>か<c>mplayer</c>を利用)、その他のサウンドファイルを再生します。
</p>

</body>
</section>
</chapter>
<chapter>
<title>MIDIサポートの有効化</title>
<section>
<title>必要なパッケージのインストール</title>
<body>

<p>
いくらかのサウンドカードはオンボードMIDIシンセサイザーを搭載しています。
これを利用するには、まず<c>awesfx</c>パッケージをインストールしなければなりません。
</p>

<pre caption="awesfxパッケージのインストール">
# <i>emerge awesfx</i>
</pre>

<p>
サウンドフォントの一覧を持っているなら、<path>/usr/share/sfbank</path>に置いてください。
例えば、SBLiveは<path>8MBGMSFX.SF2</path>か<path>CT4GMSFX.SF2</path>というサウンドフォントファイルを持っています。
</p>

<p>
サウンドフォントをコピーしたなら、<c>asfxload</c>を使ってそれらを選択します。
</p>

<pre caption="サウンドフォントの読み込み">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
このコマンドを起動するたびに実行しなければならないので、<path>/etc/conf.d/local.start</path>に追加すると良いでしょう。
</p>

<p>
サウンドフォントをドライバCDから見つけることができなければ<uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>からダウンロードすることができます。
</p>

</body>
</section>
<section>
<title>Timidity++ 仮想シンセサイザー</title>
<body>

<p>
サウンドカードがハードウェアシンセサイザーを搭載していなければ(もしくはそれを使いたくなければ)、仮想シンセサイザーを提供する<c>timidity++</c>を使うことができます。
このパッケージをemergeしましょう。
</p>

<pre caption="Timidity++のインストール">
# <i>emerge timidity++</i>
</pre>

<p>
timidityが音楽を再生するには、サウンドフォントが必要です。
何も持っていなければ、サウンドフォントを提供する<c>timidity-eawpatches</c>か<c>timidity-shompatches</c>をインストールします。
複数のサウンドフォント設定をインストールすることができますし、自分で作成したサウンドフォントを<path>/usr/share/timidity/</path>に置くこともできます。
複数のtimidity設定を切り替えるために、timidity++パッケージが提供する<e>timidity-update</e>ツールを使うでしょう。
</p>

<pre caption="サウンドフォントのインストール">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(もしくは)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
忘れずに<c>timidity</c>をデフォルトランレベルに追加してください。
</p>

<pre caption="timiditをデフォルトランレベルに追加">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>MIDIサポートのテスト</title>
<body>

<p>
ALSA Utilsの<c>aplaymidi</c>を使うことでMIDI設定をテストできます。
</p>

<p>
システムのどのMIDI出力ポートが有効か見るには、<c>-l</c>オプションを利用します。
</p>

<pre caption="MIDI出力ポートを見る">
# <i>aplaymidi -l</i>
</pre>

<p>
全てが良いなら、MIDIファイルを再生して全てが動作しているか確認してください。
<c>-p</c>オプションでどのMIDIポートを使うか定義できます。
</p>

<pre caption="MIDIファイルの再生">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith' Theme.mid"</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>最後に</title>
<section>
<title>ツールとファームウェア</title>
<body>

<p>
特定のサウンドカードは<c>alsa-tools</c>と<c>alsa-firmware</c>パッケージによって提供されるツールを利用できます。
もし<c>alsa-tools</c>が必要なら、<path>/etc/make.conf</path>でALSA_TOOLSを定義するようにしてください。
例えばこの様にします。
</p>

<pre caption="/etc/make.confでALSA Toolsを選択">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
そして<c>alsa-tools</c>または<c>alsa-firmware</c>、もしくは両方をインストールします。
</p>

<pre caption="ALSA Toolsのインストール">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>ジョイスティックサポートの有効化</title>
<body>

<p>
もし、あなたのサウンドカードにジョイスティック用のプラグがあるなら、ジョイスティックサポートの有効化に興味があるかもしれません。
もしそうならば、サウンドカードドライバにジョイスティック向けのパラメータがないか探してみてください。
<c>modinfo</c>をカーネルモジュールに対して実行する事で探せます。
<c>snd-via82xx</c>の場合は次の例のようになります。
</p>

<pre caption="modinfoの実行">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
もし、<c>joystick</c>というパラメータがあるなら、<path>/etc/modules.d/alsa</path>の<c>options</c>行に<c>joystick=1</c>を加えます。
snd-via82xxの場合は次のようにします。
</p>

<pre caption="ジョイスティックパラメータの追加">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>リソース</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">The ALSA Project</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto's and FAQs</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
