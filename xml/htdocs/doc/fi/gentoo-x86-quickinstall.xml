<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/gentoo-x86-quickinstall.xml,v 1.18 2006/09/29 05:03:29 flammie Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fi/gentoo-x86-quickinstall.xml" lang="fi">
<title>Gentoon x86-pika-asennusopas</title>

<author title="Tekijä">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Tekijä">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Vastuullinen kääntäjä">
  <mail link="flammie@gentoo.org">Flammie Pirinen</mail>
</author>

<abstract>
Pika-asennusopas kertoo Gentoon asennuksen hyvin tiiviissä muodossa. 
Tarkoituksena on asentaa Gentoo stage3:sta nopeasti. 
Gentoon
aiempi asennuskokemus on välttämätöntä tämän oppaan hyödyntämiseksi.
</abstract>

<license/>

<version>8</version>
<date>2006-09-16</date>

<chapter>
<title>Johdanto</title>
<section>
<body>

<p>
Tämä opas kertoo komennot Gentoon asentamiseen stage3:lta. Internet-yhteys
on tarpeen asennettaessa.
</p>

<p>
Komentojen kesto lukee pitkäkestoisen jokaisen komennon lopussa.
Ajastus on tehty 1,66 GHz:sellä AMD 2000:lla, jossa on 512 megaa rammia
ja 2 SATA-levyä.
</p>

<pre caption="Koneen tehot">
<comment>(Seuraavat tiedot auttavat määrittämään karkeasti tarvittavan
asennusajan)</comment>

# <i>grep bogo /proc/cpuinfo</i>
bogomips       : 3337.81

# <i>hdparm -tT /dev/sda</i>
/dev/sda:
 Timing cached reads:   1100 MB in  2.00 seconds = 549.97 MB/sec
 Timing buffered disk reads:  224 MB in  3.01 seconds =  74.36 MB/sec

# <i>grep MemTotal /proc/meminfo</i>
MemTotal:       509248 kB
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Pika-asennusopas</title>
<section>
<title>Asennuslevyt</title>
<body>

<p>
Lataa CD <uri link="/main/en/mirrors.xml">peilipalvelimelta</uri>.
ISOt sijaitsevat hakemistoissa
<path>releases/x86/2006.0/installcd</path>
minimal asennus-CD:lle tai 
<path>releases/x86/2006.0/installcd</path> Live asennus-CD:lle.
<e>Minimal</e> on järkevämpi verkosta asennettaessa. <e>LiveCD</e>:llä voi
asentaa verkottomasti, kuten
<uri link="handbook/2006.1/handbook-x86.xml">2006.1 x86 -asennusohjeissa
</uri> neuvotaan.
</p>

<p>
<uri link="faq.xml#isoburning">Polta</uri> CD ja käynnistä siltä.
</p>

</body>
</section>
<section>
<title>CD:n käynnistys</title>
<body>

<p>
Painamalla <c>F2</c> näkee mitä vaihtoehtoja on tarjolla. Ytimistä voi
käynnistää joko <c>gentoo</c>n tai <c>gentoo-nofb</c>:n, joista jäljempi
poistaa framebufferin käytöstä. LiveCD:llä pitää myös muistaa <c>nox</c>,
joka estää X:n käynnistymisen. Muut asetukset mahdollistavat ominaisuuksien
poistamisen tai lisäämisen. Jos käynnistys toimii oikein, laitteisto
tunnistetaan ja tarpeelliset moduulit ladataan. Jos ydin ei käynnisty tai
kone jumiutuu, kannattaa kokeilla muita asetukista. Varmin ratkaisu on
käyttää <c>nodetect</c>iä ja ladata moduulit itse.
</p>

<pre caption="Minimal CD:n käynnistys">
Gentoo Linux Installation LiveCD                     http://www.gentoo.org
Enter to Boot; F1 for kernels  F2 for options.
boot: <i>gentoo-nofb</i>
  <comment>(ongelmatilanteissa:)</comment>
boot: <i>gentoo-nofb nodetect</i>
</pre>

</body>
</section>
<section>
<title>Valinnainen: Moduulien lataaminen</title>
<body>

<p>
Jos <c>nodetect</c> on käytössä, täytyy moduulit ladata käsin käynnistyksen
jälkeen. Tarpeellisia ovat verkko- ja levyajurit. Komennolla <c>lspci</c> saa
joitain vihjeitä laitteiston ja moduulien tunnistamiseksi.
</p>

<pre caption="Tarpeellisten moduulien lataaminen">
livecd root # <i>lspci</i>
<comment>(lspci:n tuloste kertoo laitteistosta)</comment>

<comment>(esimerkki:)</comment>
livecd root # <i>modprobe 3w-9xxx</i>
livecd root # <i>modprobe r8169</i>
</pre>

</body>
</section>
<section>
<title>Verkkoasetukset</title>
<body>

<p>
Jos verkko ei toimi, komennolla <c>net-setup</c> tehdään verkkoasetukset.
Tätä ennen saattaa pitää ladata verkkokortin ajurit <c>modprobe</c>lla. Sisäisen
ADSL:n käyttäjien pitää käynnistää <c>pppoe-setup</c> ja <c>pppoe-start</c>.
PPTP-käyttäjien pitää asettaa <path>/etc/ppp/chap-secrets</path>-tiedosto ja
<path>/etc/ppp/options.pptp</path> ja käynnistää <c>pptp &lt;palvelimen
ip&gt;</c>.
</p>

<p>
Langattomille verkoille käytetään komentoa <c>iwconfig</c>, jonka jälkeen
ajetaan normaalisti <c>net-setup</c> tai <c>ifconfig</c>, <c>dhcpcd</c> ja
<c>route</c>.
</p>

<p>
Jos käytössä on välityspalvelin, muista <c>export http_proxy</c>,
<c>ftp_proxy</c> ja <c>RSYNC_PROXY</c>.
</p>

<pre caption="Verkon ohjattu asennus">
livecd root # <i>net-setup eth0</i>
</pre>

<p>
Vaihtoehtoisesti verkon voi asettaa käsin. Seuraavassa esimerkissä käytetään
IP:tä 192.168.1.10 koneen osoitteena ja 192.168.1.1 reitittimen ja
nimipalvelimen osoitteena.
</p>

<pre caption="Verkon asennus käsin">
livecd root # <i>ifconfig eth0 192.168.1.10/24</i>
livecd root # <i>route add default gw 192.168.1.1</i>
livecd root # <i>echo nameserver 192.168.1.1 > /etc/resolv.conf</i>
</pre>

<p>
Asennus-CD:ltä voi käynnistää <c>sshd</c>:n, lisätä käyttäjiä, käyttää
<c>irssi</c>ä ja surfata verkossa <c>lynx</c>illä tai <c>links</c>illä.
</p>

</body>
</section>
<section>
<title>Valinnainen: Asennuskoneeseen yhdistäminen sshd:llä</title>
<body>

<p>
Mielenkiintoisin ominaisuus on <c>sshd</c>. Sen voi käynnistää
asennuskoneeseen ja suorittaa tämän ohjeen komentoja toiselta koneelta.
</p>

<pre caption="Sshd:n käynnistys">
livecd root # <i>time /etc/init.d/sshd start</i>
 * Generating hostkey ...
<comment>(sshd luo avaimen ja tulostaa lisää dataa)</comment>
 * starting sshd ...                            [ok]

real   0m13.688s
user   0m9.420s
sys    0m0.090s
</pre>

<p>
Rootin salasana pitää asettaa, jotta koneeseen voi yhdistää muualta. Muista,
ettei ssh-yhteys root-tunnukselle ole järkevää normaaleissa olosuhteissa.
Jos paikallisverkko ei ole luotettava, salasanan kannattaa olla pitkä ja
monimutkainen. Sitä käytetään vain kerran ja se häviää asennuksen loputtua.
</p>

<pre caption="Rootin salasanan asennus">
livecd root # <i>passwd</i>
New UNIX password: <comment>kirjoita_salasana</comment>
Retype new UNIX password: <comment>kirjoita_salasana</comment>
passwd: password updated successfully
</pre>

<p>
Seuraavaksi voi käynnistää terminaalin toisessa koneessa ja yhdistää
asennuskoneeseen, avata tämän oppaan toiseen ikkunaan ja leikata ja liimata
komennot suoraan terminaaliin.
</p>

<pre caption="Toiseen koneeseen yhdistäminen">
<comment>(Käytä koneen oikeaa IP-osoitetta)</comment>
$ <i>ssh root@192.168.1.10</i>
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
RSA key fingerprint is 96:e7:2d:12:ac:9c:b0:94:90:9f:40:89:b0:45:26:8f.
Are you sure you want to continue connecting (yes/no)? <i>yes</i>
Warning: Permanently added '192.168.1.10' (RSA) to the list of known hosts.
Password: <comment>kirjoita_salasana</comment>
</pre>

</body>
</section>
<section>
<title>Levyjen valmistelu</title>
<body>

<p>
Osioinnin voi hoitaa komennolla <c>fdisk</c> tai <c>cfdisk</c>. Ainakin yksi
swappiosio (tyyppinumero 82) ja yksi Linux-osio (tyyppinumero 83) pitää luoda.
</p>

<pre caption="Osioiden luonti">
livecd ~ # <i>fdisk /dev/sda</i>

<comment>(Oppaassa seurataan tätä osiointia)</comment>
livecd ~ # <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 599.9 GB, 599978409984 bytes
255 heads, 63 sectors/track, 72943 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1          12       96358+  83  Linux
/dev/sda2              13         110      787185   82  Linux swap / Solaris
/dev/sda3             111       72943   585031072+  83  Linux
</pre>

<p>
Komennoilla <c>mke2fs</c>, <c>mke2fs -j</c>, <c>mkreiserfs</c>, <c>mkfs.xfs</c>
ja <c>mkfs.jfs</c> voi luoda tiedostojärjestelmiä osioille. Swappiosio
aktivoidaan komennoin <c>mkswap</c> ja <c>swapon</c>.
</p>

<pre caption="Tiedostojärjestelmien luonti ja swapin aktivointi">
<comment>(ext2 riittää /boot-osiolle)</comment>
livecd ~ # <i>mke2fs /dev/sda1</i>

<comment>(ext3 sopii juuriosiolle)</comment>
livecd ~ # <i>mke2fs -j /dev/sda3</i>

<comment>(Swapin luonti ja aktivointi)</comment>
livecd ~ # <i>mkswap /dev/sda2 &amp;&amp; swapon /dev/sda2</i>
</pre>

<p>
Tiedostojärjestelmät liitetään hakemiston <path>/mnt/gentoo</path> alle.
Muiden liitosten liitospisteet pitää luoda käsin, jos niitä tarvitsee (esim.
<path>/mnt/gentoo/boot</path>).
</p>

<pre caption="Osioiden liittäminen">
livecd ~ # <i>mount /dev/sda3 /mnt/gentoo</i>
livecd ~ # <i>mkdir /mnt/gentoo/boot</i>
livecd ~ # <i>mount /dev/sda1 /mnt/gentoo/boot</i>
</pre>

</body>
</section>
<section>
<title>Stagejen asetukset</title>
<body>

<p>
Päiväys pitää asettaa oikeaksi komennolla <c>date kkppttmmvvvv</c>. Tässä
vaiheessa käytetään UTC-aikaa.
</p>

<pre caption="Ajan asetus UTC-ajaksi">
<comment>(Ajan katselu)</comment>
livecd ~ # <i>date</i>
Mon Mar  6 00:14:13 UTC 2006

<comment>(Ajan asettaminen)</comment>
livecd ~ # <i>date 030600162006</i> <comment>(muoto on kkpptthmmvvvv)</comment>
Mon Mar  6 00:16:00 UTC 2006
</pre>

<p>
Sitten ladataan stage-paketti <uri
link="/main/en/mirrors.xml">peilipalvelimelta</uri> tai käytetään asennus-CD:ltä
löytyvää (<path>/mnt/cdrom/stages</path>). Siirry hakemistoon
<path>/mnt/gentoo</path> ja pura paketti:
<c>tar&nbsp;-xvjpf&nbsp;&lt;stage-paketti&gt;</c>.
</p>

<pre caption="Stage3:n lataaminen">
livecd ~ # <i>cd /mnt/gentoo</i>
livecd gentoo # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Valitse peili (kuten trumpetti.atm.tut.fi),
siirry hakemistoon releases/x86/current/stages
valitse stage3-paketti, kuten stage3-i686-2006.1.tar.bz2
ja lataa painamalla D:tä)</comment>

<comment>(<b>tai</b> lataa suoraan valitsematta lähintä peilipalvelinta)</comment>
livecd ~ # <i>cd /mnt/gentoo</i>
livecd gentoo # <i>wget http://gentoo.osuosl.org/releases/x86/current/stages/stage3-i686-2006.1.tar.bz2</i>
</pre>

<pre caption="Stage3-paketin purkaminen">
livecd gentoo # <i>time tar xjpf stage3*</i>

real  1m13.157s
user  1m2.920s
sys   0m7.230s
</pre>

<p>
Asenna Portagen tuorein otos. Tee samoin kuin stage3-paketin kanssa: valitse
lähin peili <uri link="/main/en/mirrors.xml">peililuettelosta</uri>, lataa
paketti ja pura se.
</p>

<pre caption="Portagen otoksen lataaminen">
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Valitse peili (kuten trumpetti.atm.tut.fi,
siirry hakemistoon snapshots/,
valitse <b>portage-latest.tar.bz2</b>
ja lataa painamalla D:tä)</comment>

<comment>(<b>tai</b> lataa wgetillä käytämättä lähintä peilipalvelinta)</comment>
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>wget http://gentoo.osuosl.org/snapshots/portage-latest.tar.bz2</i>
</pre>

<pre caption="Portagen otoksen purkaminen">
livecd usr # <i>time tar xjf portage*</i>

real  0m51.523s
user  0m28.680s
sys   0m12.840s
</pre>

</body>
</section>
<section>
<title>Chroottaus</title>
<body>

<p>
Liitä <path>/proc</path>, kopioi <path>/etc/resolv.conf</path> ja chroottaa
</p>

<pre caption="Chroottaaminen">
livecd usr # <i>cd /</i>
livecd / # <i>mount -t proc proc /mnt/gentoo/proc</i>
livecd / # <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/</i>
livecd / # <i>chroot /mnt/gentoo /bin/bash</i>
livecd / # <i>env-update &amp;&amp; source /etc/profile</i>
>>> Regenerating /etc/ld.so.cache...
</pre>

</body>
</section>
<section>
<title>Aikavyöhykeasetus</title>
<body>

<p>
Aikavyöhyke asetetaan kopioimalla tiedosto hakemistosta
<path>/usr/share/zoneinfo</path> tiedostoksi <path>/etc/localtime</path>.
</p>

<pre caption="Aikavyöhykkeen kopiointi">
<comment>(Esimerkkinä Helsinki)</comment>
livecd / # <i>cp /usr/share/zoneinfo/Europe/Helsinki /etc/localtime</i>
livecd / # <i>date</i>
Wed Mar  8 00:46:05 EET 2006
</pre>

</body>
</section>
<section>
<title>Kone- ja verkkonimi</title>
<body>

<p>
Konenimi asetetaan tiedostoissa <path>/etc/conf.d/hostname</path> ja
<path>/etc/hosts</path>.  Seuraavassa esimerkissä käytetään <c>loota</c>a 
koneena ja <c>kotona</c> verkkona. Asetustiedostoja voi muokata
<c>nano</c>lla tai käyttää seuraavia komentoja:
</p>

<pre caption="Kone ja verkkonimen asettaminen">
livecd / # <i>cd /etc</i>
livecd etc # <i>echo "127.0.0.1 loota.kotona loota localhost" > hosts</i>
livecd etc # <i>sed -i -e 's/HOSTNAME.*/HOSTNAME="loota"/' conf.d/hostname</i>
<comment>(Käytä annettua nimeä varmistuksena)</comment>
livecd etc # <i>hostname loota</i>
livecd etc # <i>hostname -f</i>
loota.kotona
</pre>

</body>
</section>
<section>
<title>Ytimen asetukset</title>
<body>

<p>
Asenna ydin (tyypillisesti <c>gentoo-sources</c> tai
<c>vanilla-sources</c>), tee asetukset ja kopioi se tiedostosta
<path>arch/i386/boot/bzImage</path> hakemistoon <path>/boot</path>.
</p>

<pre caption="Ytimen asennus">
livecd etc # <i>time emerge gentoo-sources</i>

real  2m51.435s
user  0m58.220s
sys   0m29.890s
livecd etc # <i>cd /usr/src/linux</i>
livecd linux # <i>make menuconfig</i>
<comment>(Ytimen asetukset)</comment>
livecd linux # <i>time make -j2</i>

<comment>(Kääntämisen kesto riippuu asetuksista)</comment>
real  3m51.962s
user  3m27.060s
sys   0m24.310s

livecd linux # <i>make modules_install</i>
livecd linux # <i>cp arch/i386/boot/bzImage /boot/kernel</i>
</pre>

</body>
</section>
<section>
<title>Järjestelmän asetukset</title>
<body>

<p>
Muokkaa tiedostoa <path>/etc/fstab</path> ja korvaa arvot <c>BOOT</c>,
<c>ROOT</c> ja <c>SWAP</c> oikeilla osioilla. Muista myös asettaa oikeat
tiedostojärjestelmät.
</p>

<pre caption="Fstabin asettaminen">
livecd linux # <i>cd /etc</i>
livecd etc # <i>nano -w fstab</i>
/dev/<i>sda1</i>   /boot     ext2    noauto,noatime     1 2
/dev/<i>sda3</i>   /         ext3    noatime            0 1
/dev/<i>sda2</i>   none      swap    sw                 0 0
</pre>

<p>
Verkkoasetukset tehdään tiedostoon <path>/etc/conf.d/net</path>.
Lisää <c>net.eth0</c> initskripti default-runlevelille. Jos käytössä on
useampia verkkolaitteita, ne linkitetään symbolisella linkillä 
<c>net.eth0</c>:n initskriptiin ja lisätään default-runlevelille.
Muokkaa asetustiedostoa <c>nano</c>lla tai käytä seuraavia komentoja:
</p>

<pre caption="Verkon asetusten teko">
livecd etc # <i>cd conf.d</i>
livecd conf.d # <i>echo 'config_eth0=( "192.168.1.10/24" )' >> net</i>
livecd conf.d # <i>echo 'routes_eth0=( "default via 192.168.1.1" )' >> net</i>
livecd conf.d # <i>rc-update add net.eth0 default</i>
<comment>(Jos verkkokortin ajuri on moduuli,
se lisätään tiedostoon /etc/modules.autoload.d/kernel-2.6)</comment>
livecd conf.d # <i>echo r8169 >> /etc/modules.autoload.d/kernel-2.6</i>
<comment>(Jos uudelleenkäynnistyksen jälkeenkin käytetään ssh-yhteyttä:)</comment>
livecd conf.d # <i>rc-update add sshd default</i>
</pre>

<note>
Jos <c>pcmcia-cs</c>:ää tarvitsee, se kannattaa asentaa ja lisätä 
default-runlevelille myös.
</note>

<p>
Rootin salasana asetetaan komennolla <c>passwd</c>.
</p>

<pre caption="Rootin salasanan asettaminen">
livecd conf.d # <i>passwd</i>
New UNIX password: <comment>kirjoita_salasana</comment>
Retype new UNIX password: <comment>kirjoita_salasana</comment>
passwd: password updated successfully
</pre>

<p>
Myös asetukset tiedostoissa <path>/etc/rc.conf</path>, 
<path>/etc/conf.d/rc</path>, <path>/etc/conf.d/keymaps</path>,
<path>/etc/conf.d/clock</path> kannattaa tarkistaa.
</p>

<pre caption="Muiden asetustiedostojen muokkaus">
livecd conf.d # <i>nano -w /etc/rc.conf</i>
livecd conf.d # <i>nano -w /etc/conf.d/rc</i>
livecd conf.d # <i>nano -w /etc/conf.d/keymaps</i>
livecd conf.d # <i>nano -w /etc/conf.d/clock</i>
</pre>

</body>
</section>
<section>
<title>Järjestelmätyökalujen asennus</title>
<body>

<p>
Järjestelmäloki kuten <c>syslog-ng</c> ja cron kuten
<c>vixie-cron</c>, kannattaa asentaa ja lisätä default-runlevelille.
</p>

<note>
Cronit tarvitsevat sähköpostinvälitysohjelman eli MTA:n. <c>mail-mta/ssmtp</c>
tulee oletuksena asennetuksi. Jos tarkoitus on käyttää tehokkaampaa MTA:ta,
se kannattaa asentaa ensin. Jos asennuksella on kiire, voi ssmtp:n asentaa
aluksi ja korvata sen sitten myöhemmin muulla.
</note>

<pre caption="Järjestelmälokin ja cronin asennus">
livecd conf.d # <i>time emerge syslog-ng vixie-cron</i>

real  1m52.699s
user  1m1.630s
sys   0m35.220s
livecd conf.d # <i>rc-update add syslog-ng default</i>
livecd conf.d # <i>rc-update add vixie-cron default</i>
</pre>

<p>
Tarpeelliset tiedostojärjestelmätyökalutkin kannattaa asentaa (kuten
<c>xfsprogs</c>, <c>reiserfsprogs</c> tai <c>jfsutils</c>) sekä
verkkotyökalut (kuten <c>dhcpcd</c> tao <c>rp-pppoe</c>), jos niitä käyttää.
</p>

<pre caption="Lisäohjelmien asentaminen">
livecd conf.d # <i>emerge xfsprogs</i>           
<comment>(Jos XFS-tiedostojärjestelmä on käytössä)</comment>
livecd conf.d # <i>emerge jfsutils</i>           
<comment>(Jos JFS-tiedostojärjestelmä on käytössä)</comment>
livecd conf.d # <i>emerge reiserfsprogs</i>      
<comment>(Jos ReiserFS-tiedostojärjestelmä on käytössä)</comment>
livecd conf.d # <i>emerge dhcpcd</i>             
<comment>(Jos DHCP on käytössä)</comment>
livecd conf.d # <i>USE="-X" emerge rp-pppoe</i>  
<comment>(Jos PPPoE-ADSL on käytössä)</comment>
</pre>

</body>
</section>
<section>
<title>Käynnistyslataimen asetukset</title>
<body>

<p>
Asenna <c>grub</c> tai <c>lilo</c>. Asetukset tehdään tiedostoon
<path>/boot/grub/grub.conf</path> tai <path>/etc/lilo.conf</path>.
</p>

<p>
<b>1. Grub</b>
</p>

<pre caption="Grubin asentaminen">
livecd conf.d # <i>time emerge grub</i>

real  1m8.634s
user  0m39.460s
sys   0m15.280s
livecd conf.d # <i>nano -w /boot/grub/grub.conf</i>
</pre>

<pre caption="Grubin asetusten teko">
default 0
timeout 10

title=Gentoo
root (hd0,0)
kernel /boot/kernel root=/dev/sda3
</pre>

<pre caption="Grubin asentaminen">
livecd conf.d # <i>grub</i>
Probing devices to guess BIOS drives. This may take a long time.

grub> <i>root (hd0,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd0)</i>
 Checking if "/boot/grub/stage1" exists... yes
 Checking if "/boot/grub/stage2" exists... yes
 Checking if "/boot/grub/e2fs_stage1_5" exists... yes
 Running "embed /boot/grub/e2fs_stage1_5 (hd0)"...  16 sectors are embedded.
succeeded
 Running "install /boot/grub/stage1 (hd0) (hd0)1+16 p (hd0,0)/boot/grub/stage2 /boot/
grub/menu.lst"... succeeded
Done.

grub> <i>quit</i>
</pre>

<p>
Lopuksi <uri link="#reboot">uudelleenkäynnistys</uri>.
</p>

<p>
<b>2. Lilo</b>
</p>

<pre caption="Lilon asennus">
livecd conf.d # <i>time emerge lilo</i>

real  0m47.016s
user  0m22.770s
sys   0m5.980s
livecd conf.d # <i>nano -w /etc/lilo.conf</i>
</pre>

<pre caption="Lilon asetusten teko">
boot=/dev/sda
prompt
timeout=50
default=gentoo

image=/boot/kernel
  label=Gentoo
  read-only
  root=/dev/sda3
</pre>

<pre caption="Lilon asennus">
livecd conf.d # <i>lilo</i>
Added Gentoo *
</pre>

</body>
</section>
<section id="reboot">
<title>Uudelleenkäynnistys</title>
<body>

<p>
Poistu chrootista, poista liitokset ja uudelleenkäynnistä:
</p>

<pre caption="Uudelleenkäynnistäminen">
livecd conf.d # <i>exit</i>
livecd / # <i>umount /mnt/gentoo/proc /mnt/gentoo/boot /mnt/gentoo</i>
livecd / # <i>reboot</i>
<comment>(Muista ottaa CD pois asemasta)</comment>
</pre>

</body>
</section>
<section id="after-reboot">
<title>Asennuksen viimeistely</title>
<body>

<note>
Asennuksen kokonaisaika oli testilaitteistolla <b>00:42:31</b>.
Tähän aikaan kuului pakettien noutaminen verkosta ja ytimen asetusten
pohtiminen.
</note>

<p>
Kirjaudu <c>root</c>ina, lisää muut käyttäjät <c>useradd</c>illa.
</p>

<pre caption="Koneeseen kirjautuminen etäkoneelta SSH:lla">
<comment>(known_hosts pitää siivota, koska uusi asennus
sisältää uuden avaimen)</comment>
$ <i>nano -w ~/.ssh/known_hosts</i>
<comment>(Etsi ja poista koneen IP:n rivi,
tallenna ja lopeta)</comment>

<comment>(Käytä uutta IP:tä)</comment>
$ <i>ssh root@192.168.1.10</i>
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
RSA key fingerprint is 96:e7:2d:12:ac:9c:b0:94:90:9f:40:89:b0:45:26:8f.
Are you sure you want to continue connecting (yes/no)? <i>yes</i>
Warning: Permanently added '192.168.1.10' (RSA) to the list of known hosts.
Password: <comment>kirjoita_salasana</comment>
</pre>

<pre caption="Käyttäjien lisääminen">
loota ~ # <i>adduser -g users -G lp,wheel,audio,cdrom,portage,cron -m pekka</i>
loota ~ # <i>passwd pekka</i>
New UNIX password: <comment>Kirjoita Pekan salasana</comment>
Retype new UNIX password: <comment>Kirjoita Pekan salasana uudestaan</comment>
passwd: password updated successfully
</pre>

</body>
</section>
<section>
<title>Viimeiset asetukset</title>
<body>

<p>
Aseta lähimmät peilipalvelimet tiedoston <path>/etc/make.conf</path>
muuttujiin <c>RSYNC</c> ja <c>GENTOO_MIRRORS</c> tai käytä 
<c>mirroselect</c>iä. Myös rinnakkaissuoritettavien käännösprosessien
määrän voi asettaa.
</p>

<pre caption="Peiliasestusten ja käännösprosessimäärän valinta">
loota ~ # <i>emerge mirrorselect</i>
loota ~ # <i>mirrorselect -i -o >> /etc/make.conf</i>
loota ~ # <i>mirrorselect -i -r -o >> /etc/make.conf</i>
<comment>(Yleensä (suoritinmäärä + 1) on hyvä arvio)</comment>
loota ~ # <i>echo 'MAKEOPTS="-j2"' >> /etc/make.conf</i>
</pre>

<p>
Seuraavaksi voi asettaa USE-flägit. Komennolla <c>emerge -vpe world</c>
saa luettelon asennetuista paketeista USE-flägeineen. Muokkaa
tiedostoa <path>/etc/make.conf</path> tai käytä seuraavia komentoja:
</p>

<pre caption="USE-asetusten teko">
loota ~ # <i>emerge -vpe world</i>
<comment>(Portage listaa paketit ja USE-flägit, esimerkiksi asetetaan
ipv6 ja fortran pois päältä, userlocales ja unicode päälle)</comment>
loota ~ # <i>echo 'USE="nptl nptlonly -ipv6 -fortran userlocales unicode"' >> /etc/make.conf</i>
</pre>

<p>
<c>Userlocales</c> glibc:n versioille, jotka sitä tukevat käyttää tiedostoa
<path>/etc/locales.build</path> määrittelemään mitkä lokaalit luodaan ja
asennetaan.
</p>

<p>
Tuoreemmat glibc-paketoinnit ohittavat userlocales-asetuksetn ja käyttävät
tiedostoa <path>/etc/locale.gen</path> suoraan. Jos päivität glibc:n versiota,
luo <path>/etc/locale.gen</path> <e>ja poista</e>
<path>/etc/locales.build</path>. Komento <c>emerge -vpe world</c> kertoo
käyttääkö glibc userlocales-asetusta vai ei.
</p>

<pre caption="Lokaalien asettaminen">
loota ~ # <i>cd /etc</i>
<comment>(Userlocales-versio)</comment>
loota etc # <i>nano -w locales.build</i>

<comment>(Locales.buildin muuntaminen tuoreille versioille)</comment>
loota etc # <i>grep '^[^#].*' locales.build | sed 's:/: :' >locale.gen</i>
loota etc # <i>rm locales.build</i>
loota etc # <i>nano -w locale.gen</i>
</pre>

<p>
Viimeiseksi voi muokata <c>CFLAGS</c>-muuttujaa tiedostossa
<path>/etc/make.conf</path> jos optimoinnit tai mukautukset ovat tarpeen.
Yleensä kovin montaa asetusta ei tarvita, ja monet saattavat särkeä
järjestelmää. Suostiteltavaa on asettaa suoritintyyppi <c>march</c>iin ja
muiksi asetuksiksi vain <c>-O2 -pipe</c>.
</p>

<p>
On myös mahdollista vaihtaa ohjelmistohaaraan <b>~x86</b>. Tätä ei kannata
tehdä jollei osaa korjailla erikoisten ebuildien ongelmia ja muita
rikkinäisiä paketointeja. Vakaassa järjestelmässä <c>ACCEPT_KEYWORDS</c>ia
ei tule muuttaa. Asetus <c>FEATURES="parallel-fetch ccache"</c> on myös
järkevää lisätä.
</p>

<pre caption="Make.confin lopullinen muokkaus">
loota etc # <i>nano -w make.conf</i>
<comment>(marchiksi asetetaan suorittimen tyyppi)</comment>
CFLAGS="-O2 -march=<i>athlon-xp</i> -pipe"
<comment>(Seuraava rivi lisätään)</comment>
FEATURES="parallel-fetch ccache"
<comment>(Seuraavaa riviä ei välttämättä kannata käyttää)</comment>
ACCEPT_KEYWORDS="~x86"
</pre>

<p>
Järjestelmä pitäisi kääntää kahdesti, jotta uudet asetukset vaikuttavat
kaikkiin mahdollisiin paketteihin. Se kuitenkin kestää kauan.
Järjestelmän yhtenäisyyttä ajatellen täydellinen uudelleenkääntäminen
on kuitenkin hyvä ratkaisu. <uri link="/doc/en/gcc-upgrading.xml">Gentoo GCC Upgrading Guide</uri> kertoo aiheesta enemmän.
</p>

<p>
Jo päivittyneiden ja USE-asetusten vaatimien pakettien asennus
vie jo paljon aikaa. Tässä vaiheessa saattaa myös joutua poistamaan paketteja,
jotka estävät päivityksiä. Rivit "[blocks
<brite>B</brite>     ]" komennon <c>emerge -vpuD --newuse world</c> tulosteessa
kertovat tästä. Ne poistetaan komennolla <c>emerge -C</c>.
</p>

<pre caption="Pakettien päivittäminen">
<comment>(Ccachen asennus)</comment>
loota etc # <i>emerge ccache</i>

<comment>(~x86 sisältää paljon päivityksiä)</comment>
loota etc # <i>emerge -vpuD --newuse world</i>
<comment>(Pakettiluetteloa ja USE-asetuksia kannattaa tarkkailla,
sitten poistetaan estävät paketit ja asennetaan)</comment>
loota etc # <i>time emerge -vuD --newuse world</i>
<comment>(79 packages have been (re)compiled)</comment>

real  180m13.276s
user  121m22.905s
sys   36m31.472s

<comment>(libtool kannattaa uudelleenasentaa ongelmien välttämiseksi)</comment>
loota etc # <i>emerge libtool</i>

<comment>(Asetustiedostot pitää päivittää, ja kannattaa varmistaa ettei
etc-update ylikirjoita tehtyjä muutoksia)</comment>
loota etc # <i>etc-update</i>

<comment>(Jos perl päivittyy, perl-cleaner pitää suorittaa)</comment>
loota etc # <i>time perl-cleaner all</i>
real  1m6.495s
user  0m42.699s
sys   0m10.641s

<comment>(Jos python päivittyy major-version verran, python-updater pitää 
suorittaa)</comment>
loota etc # <i>python-updater</i>
</pre>

</body>
</section>
<section>
<title>Seuraavaksi</title>
<body>

<p>
Järjestelmästä riippuen, seuraavaksi asennetaan tyypillisesti palvelimet
tai työpöytäympäristö. Esimerkkeinä ovat ajanotot komennoista
<c>emerge gnome</c> ja <c>emerge kde</c> ~x86-järjestelmällä, jota 
kuvattiin alussa. Molemmat asennukset tehtiin samasta lähtökohdasta.
</p>

<p>
<uri link="/doc/en/">Gentoon ohjesivuilla</uri> on linkkejä muihin
ohjeisiin ja oppaisiin.
</p>

<impo>
Seuraava on esimerkki, ei suositus.
</impo>

<pre caption="Emerge GNOME">
loota etc # <i>emerge -vp gnome</i>
<comment>(Tarkista paketit ja USE-asetukset,
korjaa tarvittaessa.)</comment>
loota etc # <i>nano -w /etc/make.conf</i>
<comment>(Seuraavat on määritelty)</comment>
USE="nptl nptlonly -ipv6 -fortran unicode svg hal dbus \
     -kde -qt -arts -eds -esd gnome gstreamer gtk -xmms firefox"

loota etc # <i>time emerge gnome</i>
<comment>(326 packages have been emerged)</comment>

real  520m44.532s
user  339m21.144s
sys   146m22.337s
</pre>

<pre caption="Emerge KDE">
loota etc # <i>emerge -vp kde-meta</i>
<comment>(Tarkista paketit ja USE-asetukset,
korjaa tarvittaessa.)</comment>
loota etc # <i>nano -w /etc/make.conf</i>
<comment>(Seuraavat on määritetty)</comment>
USE="nptl nptlonly -ipv6 -fortran unicode svg hal dbus \
     kde qt -arts -eds -esd -gnome -gstreamer -gtk -xmms -firefox"

loota etc # <i>time emerge kde-meta</i>
<comment>(391 packages have been emerged)</comment>

real  1171m25.318s
user  851m26.393s
sys   281m45.629s
</pre>

</body>
</section>
</chapter>
</guide>
