<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/mysql-upgrading.xml,v 1.2 2005/12/23 21:09:37 flammie Exp $ -->

<guide link="/doc/fi/mysql-upgrading.xml">
<title>Ohje MySQL 4.1.x -päivitykseen</title>

<author title="Tekijä">
  <mail link="citizen428@gentoo.org">Michael Kohl</mail>
</author>
<author title="Tekijä">
  <mail link="vivo@gentoo.org">Francesco Riosa</mail>
</author>
<author title="Kääntäjä">
  <mail link="rogkaa@gmail.com">rogk</mail>
</author>

<abstract>
MySQL-ryhmä ylpeänä ilmoittaa, että MySQL 4.1 löytyy nyt Gentoon portagepuusta
epävaakaana versiona. Ryhmä toivoo, että siitä pian saataisiin vakaa ebuild,
tässä on päivitysohje kaikille halukkaille testaajille.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.5</version>
<date>2005-12-21</date>

<chapter>
<title>MySQL-päivitys vanhasta versioista</title>
<section>
<body>

<p>
Käyttäjien, jotka päivittävät vanhemmasta (&lt;4.0.24) MySQL-versiosta,
täytyy ensin asentaa MySQL 4.0.25. Jos sinulla on jo käytössäsi tämä
versio, voit jättää väliin tämän osan ja siirtyä seuraavaan.
</p>

<pre caption="Suora päivitys">
# <i>emerge -av --buildpkg "&lt;mysql-4.1"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Nykyisten tietojen varmuuskopiointi</title>
<section>
<body>

<p>
Yksi tärkeimmistä tehtävistä, mikä jokaisen tietokannoista vastaavan 
järjestelmänvalvojan tulee suorittaa, on varmuuskopionti. Ja se menee näin:
</p>

<pre caption="Varmuuskopioidaan kaikki tietokannat">
# <i>mysqldump \</i>
  <i>-uroot \</i>
  <i>--password=</i><comment>salasana</comment><i> \</i>
  <i>-hlocalhost \</i>
  <i>--all-databases \</i>
  <i>--opt \</i>
  <i>--allow-keywords \</i>
  <i>--flush-logs \</i>
  <i>--hex-blob \</i>
  <i>--master-data \</i>
  <i>--max_allowed_packet=16M \</i>
  <i>--quote-names \</i>
  <i>--result-file=BACKUP_MYSQL_4.0.SQL</i>
</pre>

<p>
Nyt sinulta pitäisi löytyä tiedosto nimeltä, <path>BACKUP_MYSQL_4.0.SQL</path>,
mitä voidaan myöhemmin käyttää tietojen palauttamiseen. Tiedot ovat kuvattu
MySQL:n SQL-kielellä (Structured Query Language).
</p>

<p>
Nyt on hyvä aika todeta tehdyn varmuuskopionnin toimivuus.

</p>

</body>
</section>
</chapter>

<chapter>
<title>Päivittäminen tuoreemmasta MySQL-versiosta</title>
<section>
<body>

<p>
Jos hyppäsit kohdan 1 yli, sinun täytyy nyt luoda varmuuskopio nykyisestä
tietokanta-palvelimen (ei tietojen) versiosta:
</p>

<pre caption="Binääri-pakettien varmuuskopionti">
# <i>quickpkg dev-db/mysql</i>
</pre>

<p>
Nyt poistetaan nykyinen versio ja kaikki siihen liittyvät tieto:
</p>

<pre caption="Poistetaan MySQL">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>tar cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
</pre>

<note>
Nyt sinulla pitäisi olla kaksi erillaista varmuuskopiota: SQL, mikä on
siirrettävissä eri MySQL versioiden välillä, ja toinen, joka mahdollistaa
tietokantojen nopean palautuksen. Tästä kerrotaan tarkemmin myöhemmässä
vaiheessa tätä ohjetta.
</note>

<p>
Sen jälkeen, kun olet poistanut vanhan MySQL-asennuksen, voit asentaa tilalle
uuden. Huomaa, että <c>revdep-rebuild</c> on välttämätön rakennettaessa
uudelleen MySQL linkityksiä.
</p>

<pre caption="Päivitetään binäärit">
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
</pre>

<p>
Määrittele nyt asetukset juuri asennettuun MySQL-versioon ja käynnistä palvelu
uudelleen.
</p>

<pre caption="Määrittele MySQL:n perusasetukset">
# <i>emerge --config =mysql-4.1.&lt;mikroversio&gt;</i>
# <i>/etc/init.d/mysql start</i>
</pre>

<p>
Lopuksi voit tuoda varmuuskopiot, jotka loit kohdassa 2:
</p>

<pre caption="Palautetaan SQL-varmuuskopio">
# <i>cat BACKUP_MYSQL_4.0.SQL \</i>
     <i>| mysql \</i>
     <i>-uroot \</i>
     <i>--password=</i><comment>salasana</comment><i> \</i>
     <i>-hlocalhost \</i>
     <i>--max_allowed_packet=16M</i>

# <i>mysql_fix_privilege_tables \</i>
     <i>--defaults-file=/etc/mysql/my.cnf \</i>
     <i>--user=root \</i>
     <i>--password=</i><comment>salasana</comment>
</pre>

<p>
Jos nyt käynnistät uudelleen MySQL-palvelun ja kaikki on mennyt niinkuin
pitikin, sinulla on nyt toimiva versio 4.1.x! :-)
</p>

<pre caption="Käynnistä MySQL uudelleen">
# <i>/etc/init.d/mysql restart</i>
</pre>

<p>
Jos kohtaat ongelmia päivittäessäsi, ilmoitathan niistä 
<uri link="https://bugs.gentoo.org">Gentoon bugzillaan</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Palautetaan vanha MySQL 4.0-asennus</title>
<section>
<body>

<p>
Jos et ole tyytyväinen MySQL 4.1:een, on mahdollista palata takaisin MySQL
4.0:aan.
</p>

<pre caption="Paluu vanhaan">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
# <i>emerge --usepkgonly "&lt;mysql-4.1"</i>
# <i>tar -xjpvf mysql.[tag] -C /</i>
# <i>/etc/init.d/mysql start</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Suora päivitys, ei suositella, vaarallinen</title>
<section>
<body>

<p>Jossain tietyssä tilanteessa, on mahdollista päivittää suoraan seuraavan
suurempaan MySQL-versioon. Jos tiedät mitä olet tekemässä ja luulet, että
se soveltuu sinun tapaukseesi, niin tässä on temppu, joka mahdollistaa
suoran päivittämisen MySQL 4.1:een.

</p>

<pre caption="Suora päivitys">
# <i>quickpkg dev-db/mysql</i>
# <i>/etc/init.d/mysql stop</i>
# <i>tar -cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>export MYSQL_STRAIGHT_UPGRADE=1</i>
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>unset MYSQL_STRAIGHT_UPGRADE</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
# <i>/etc/init.d/mysql start</i>
# <i>mysql_fix_privilege_tables --defaults-file=/etc/mysql/my.cnf \</i>
      <i>-uroot --password=</i><comment>salasana</comment>
# <i>mysql --database=mysql -uroot -p</i><comment>salasana</comment> <i>&lt; /tmp/new_pieces.sql</i>
# <i>/etc/init.d/mysql restart</i> # just to be sure
</pre>

<p>
Onnea! Jos jokin menee pieleen, älä sano, etteikö sinua varoitettu! ;-)
</p>

</body>
</section>
</chapter>

</guide>
