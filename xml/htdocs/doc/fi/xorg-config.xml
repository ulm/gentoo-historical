<?xml version='1.0' encoding='UTF-8'?>

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/xorg-config.xml,v 1.7 2007/08/20 07:47:12 flammie Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fi/xorg-config.xml" lang="fi">

<title>KUINKA X-palvelin säädetään kuntoon</title>

<author title="Tekijä">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Vastuullinen kääntäjä">
  <mail link="flammie@gentoo.org">Flammie Pirinen</mail>
</author>

<abstract>
Xorg on graafinen käyttöympäristö joka toimii X-ikkunointipalvelinperiaatteella.
Tämä KUINKA-dokumentti selvittää mikä Xorg on, kuinka se asennetaan ja mitä
säätömahdollisuuksia siihen liittyy.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.17</version>
<date>2007-06-20</date>

<chapter>
<title>Mikä on X-ikkunointipalvelin?</title>
<section>
<title>Graafinen vs. komentorivi</title>
<body>

<p>
Keskivertokäyttäjiä saattaa pelottaa ajatus, että tietokonetta käytetään
kirjoittamalla merkkipohjaisia komentoja. Mikseipä olisikaan kätevämpää sohia
hiirellä ja kliksutella tiensä läpi Gentoo-järjestelmän? Tokihan tämä onkin
mahdollista, Linuxeissa on itse asiassa laajakin valikoima välkkyviä ja
värikkäitä käyttöliittymiä joita voi käyttää missä tahansa yhteydessä.
</p>

<p>
Graafinen käyttöliittymä ei kuitenkaan ole muuta kuin yksi sovellus, jota
ajetaan järjestelmässä. Se <e>ei</e> kuulu Linuxin ytimeen millään tavalla,
eikä muuhunkaan järjestelmän sisäiseen osaan. Se on vain työkalu, jolla
saa käyttöön graafisen liitynnän työasemaansa.
</p>

<p>
<e>X-ikkunointijärjestelmä</e> on eräs standardi, joka määrittelee grafiikan
piirtämisen ja ikkunoiden liikuttelun ruuduilla ja syötelaitteiden kuten
hiirten ja näppisten käsittelyn sekä muitakin. X-ikkunointijärjestelmästä
käytetään usein lyhennettä <e>X11</e> tai vain <e>X</e>. X:iä voidaan käyttää
kaikissa Unix-tyylisissä käyttöjärjestelmissä.
</p>

<p>
Linux-käyttäjien suosima sovellus, joka tarjoaa graafisen käyttöliittymän
X11-standardin mukaisesti, on Xorg-X11. Xorg on XFree86-projektista forkattu
ikkunointijärjestelmä. Kun XFree86 käytti lisenssiä, joka saattaa olla
yhteensopimaton GPL:n kanssa, on ruvettu suosittelemaan Xorgin käyttöä sen
sijaan; XFree86-paketteja ei enää ole Portagepuussa.
</p>

</body>
</section>
<section>
<title>X.org-projekti</title>
<body>

<p>
<uri link="http://www.x.org">X.org</uri>-projekti ylläpitää vapaasti
levitettävää open source -toteutusta X11-järjestelmästä.
</p>

<p>
Xorg on rajapinta laitteiston ja graafisen ohjelmiston välillä. Sen lisäksi
Xorgissa on verkkotuki, jonka avulla ohjelmia voi ajaa toisessa koneessa kuin
niitä käyttää.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Xorgin asennus</title>
<section>
<title>Emergaamalla</title>
<body>

<p>
Xorg asennetaan yllättävästi komennolla <c>emerge xorg-x11</c>. Asennuksessa
kestää jokunen tovi.
</p>

<p>
Ennen Xorgin asentamista kannattaa asettaa kaksi muuttujaa tiedostossa
<path>/etc/make.conf</path>.
</p>

<p>
Ensimmäinen on <c>VIDEO_CARDS</c>, jolla kerrotaan mitkä näyttöajurit ovat
käytössä. Yleisimmät asetukset ovat <c>nvidia</c> nVidian laitteille
tai <c>fglrx</c> ATin Radeoneille. Nämä ovat nVidian ja ATin suljetut
ajuriversiot. Avoimet, vapaat vaihtoehdot ovat <c>nv</c>, jossa ei ole
ollenkaan 3D-kiihdytystä. Vapaa <c>radeon</c>-ajuri sisältää jopa 3D-tuen
vanhemmille radeoneille.
<c>VIDEO_CARDS</c>-asetukseen voi panna niin monta ajuria kuin haluaa, ja ne
erotellaan välilyönnein.
</p>

<p>
Toinen asetus on <c>INPUT_DEVICES</c>, joka kertoo mitkä syöttölaiteajurit
ovat käytössä. Yleensä asetus <c>keyboard mouse</c> riittää hyvin.
</p>

<p>
Lisää tarvittavat ajurit tiedostoon <path>/etc/make.conf</path>:
</p>

<pre caption="Ajurien lisäys make.confiin">
<comment>(Hiirelle ja näppäimistölle)</comment>
INPUT_DEVICES="keyboard mouse"
<comment>(nVidian näyttölaitteille)</comment>
VIDEO_CARDS="nvidia"
<comment>(ATin Radeoneille)</comment>
VIDEO_CARDS="fglrx"
</pre>

<p>
Tarkemmat ohjeet nVidian ja ATin laitteiden käytöstä löytyvät
<uri link="/doc/fi/nvidia-guide.xml">nVidia-oppaasta</uri> ja
<uri link="/doc/en/ati-faq.xml">Gentoo Linux ATI FAQ:sta</uri>.
Jos et tiedä mikä ajuri kannattaa valita, lue nämä oppaat lisätietoa varten.
</p>

<note>
Jos asetukset eivät toimi, suorita <c>emerge -pv
xorg-server</c>, tarkista asetukset ja valitse sellaiset mitkä sopivat
järjestelmääsi. Esimerkki on yhdistelmälle amd64 ja <c>xorg-server-1.2</c>.
</note>

<pre caption="Ajurivaihtoehtojen tarkastelu">
# <i>emerge -pv xorg-server</i>

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] x11-base/xorg-server-1.2.0-r3  USE="dri nptl xorg (-3dfx) -debug
-dmx -ipv6 -kdrive -minimal -sdl -xprint" INPUT_DEVICES="keyboard mouse -acecad
-aiptek -calcomp -citron -digitaledge -dmc -dynapro -elo2300 -elographics -evdev
-fpit -hyperpen -jamstudio -joystick -magellan -microtouch -mutouch -palmax
-penmount -spaceorb -summa -synaptics -tek4957 -ur98 -vmmouse -void -wacom"
VIDEO_CARDS="nvidia -apm -ark -chips -cirrus -cyrix -dummy -epson -fbdev -fglrx
-glint -i128 (-i740) -i810 (-impact) (-imstt) -mach64 -mga -neomagic (-newport)
(-nsc) -nv -r128 -radeon -rendition -s3 -s3virge -savage -siliconmotion -sis
-sisusb (-sunbw2) (-suncg14) (-suncg3) (-suncg6) (-sunffb) (-sunleo) (-suntcx)
-tdfx -tga -trident -tseng -v4l -vesa -vga -via -vmware -voodoo" 0 kB
</pre>

<p>
Muuttujan asettamisen jälkeen Xorgin voi asentaa.
</p>

<pre caption="Xorgin asennus">
# <i>emerge xorg-x11</i>
</pre>

<p>
Kun asennus on valmis, ympäristömuuttujat saattaa pitää päivittää ennen
jatkamista. Ympäristön päivitys tapahtuu tavalliseen tapaan komennoilla
<c>env-update</c> ja <c>source /etc/profile</c>.
</p>

<pre caption="Ympäristömuuttujien päivitys">
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Xorgin säädöt</title>
<section>
<title>Tiedosto xorg.conf</title>
<body>

<p>
Xorgin asetustiedosto on <path>xorg.conf</path> hakemistossa
<path>/etc/X11</path>. Paketissa Xorg-x11 on oletusasetusto mukana tiedostossa
<path>/etc/X11/xorg.conf.example</path>. Sitä voi käyttää pohjana omien
asetusten säätämisessä. Se on selkeästi kommentoitu, mutta jos tarvitset
lisäohjeita, niin niitähän löytyy ohjesivuilta:
</p>

<pre caption="Xorg.confin ohjesivut">
# <i>man 5 xorg.conf</i>
</pre>

<p>
Mielenkiintoista luettavaa joka tapauksessa. Tässä emme kuitenkaan tarkastele
sitä, vaan katsomme ensin asetustiedoston automatisoitua luontia.
</p>

</body>
</section>
<section>
<title>Oletus: xorg.confin automaattinen luonti</title>
<body>

<p>
Xorg osaa itsekin arvata valtaosan asetuksista puolestasi. Useimmiten
tarvitsee vain muuttaa muutamia rivejä, että saa haluamansa resoluution
käyttöön. Tarkempiakin säätöjä voi tehdä, mutta niistä lisää kappaleen lopussa.
Mutta ensin luodaan Xorgin asetustiedosto.
</p>

<pre caption="Xorg.confin luonti">
# <i>Xorg -configure</i>
</pre>

<p>
Lue huolella myös Xorgin ruudulle tulostamat ohjeet, jos niissä kerrotaan
virheistä, pitää <path>xorg.conf</path>ia muokata käsin. Jollei virheitä
tapahtunut, ohjelma kertoo kirjoittaneensa uudet asetukset
tiedostoon <path>/root/xorg.conf.new</path>, ja näitä voi nyt testata:
</p>

<pre caption="Xorg.conf.new'n testaus">
# <i>X -config /root/xorg.conf.new</i>
</pre>

<p>
Jos kaikki toimii, ruudulle ilmestyy mustavalkoinen punoskuvio. Varmista että
hiiri toimii odotuksen mukaisesti ja resoluutio näyttää hyvältä. Jos hiiri
kertoo virheitä tiedostossa /dev/mouse, kannattaa kokeilla asetusta
/dev/input/mice.
Poistuminen onnistuu painamalla Ctrl-Alt-Backspace.
</p>

</body>
</section>
<section>
<title>Vaihtoehto: Xorg.confin vuorovaikutteinen luonti</title>
<body>

<p>
Xorgin mukana tulee työkaluohjelma <c>xorgconfig</c>,
joka kyselee tietoja koneestasi, ja sen pohjalta vääntää sopivan
<path>xorg.conf</path>-tiedoston.
</p>

<pre caption="Xorg.confin vuorovaikutteinen luonti">
# <i>xorgconfig</i>
</pre>

<p>
Xorgin mukana tulee myös työkalu <c>xorgcfg</c>, joka käyttää
<c>Xorg -configure</c>a asetusten tekoon, ja käynnistää sitten X:n
lopullista asetusten säätöä varten.
</p>

<pre caption="Xorgcfg:n käyttö">
# <i>xorgcfg</i>
<comment>(Jollei X tunnu toimivan, koeta:)</comment>
# <i>xorgcfg -textmode</i>
</pre>

</body>
</section>
<section>
<title>Xorg.confin kopiointi</title>
<body>

<p>
Kun <path>xorg.conf.new</path> kopioidaan <path>/etc/X11/xorg.conf</path>;ksi,
se luetaan automaattisesti X:n käynnistyessä, eikä tarvita enää
-config-valitsinta. Nyt käynnistyksen voi suorittaa komennolla <c>X</c> tai
<c>startx</c>.
</p>

<pre caption="Xorg.confin kopiointi">
# <i>cp /root/xorg.conf.new /etc/X11/xorg.conf</i>
</pre>

</body>
</section>
<section id="using_startx">
<title>Startx:n käyttö</title>
<body>

<p>
Käynnistetään nyt palvelin <c>startx</c>:llä. <c>Startx</c> on skripti,
joka käynnistää <e>X session</e>, eli ajaa X-palvelimen ja käynnistää
siihen joitain graafisia sovelluksia. Sovellukset se päättää seuraavan kaavan
mukaan:
</p>

<ul>
  <li>
    Jos kotihakemistossa on <path>.xinitrc</path>, suoritetaan sen sisältö.
  </li>
  <li>
    Muutoin suoritetaan ympäristömuuttujan XSESSION nimeämä sessio, joka
    löytyy hakemistosta <path>/etc/X11/Sessions/</path>.
    XSESSIONin voi muuttaa tiedostosta <path>/etc/rc.conf</path>.
  </li>
<li>
    Jos kumpikaan ei onnistu, käynnistestään jokin varmasti saatavilla oleva
    ikkunointijärjestelmä, kuten <c>twm</c>.
  </li>
</ul>

<pre caption="X:n käynnistys">
# <i>startx</i>
</pre>

<p>
Jos nyt käynnistyy hankala, ruma ja sekava ikkunointijärjestelmä, se on
todennäköisesti <c>twm</c> <!-- tai KDE ;-) -->. TWM:n saa suljettua
kirjoittamalla <c>exit</c> tai painamalla Ctrl-D jossain terminaali-ikkunassa.
X:n voi tappaa myös näppäilyllä Ctrl-Alt-Backspace, tällöin X kuitenkin sammuu
suoraan ja varmistuksetta, mikä ei aina ole odotettua.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Xorg.confin säätäminen</title>
<section>
<title>Resoluutioasetukset</title>
<body>

<p>
Jos resoluutio näyttää väärältä, asetustiedostossa on kaksi kohtaa
tarkistettavaksi. Ensinnä <e>Screen</e>-osiossa on luettelo resoluutioista,
joita X-palvelin käyttää. Oletuksena tämä osio voi olla myös tyhjä, ja silloin
Xorg arpoo resoluutiot osiosta <e>Monitor</e>.
</p>

<p>
Käytännössä Xorg tarkistaa <e>Monitor</e>-osion <c>HorizSync</c> ja
<c>VertRefresh</c> saadakseen toimivat resoluutiot. Nämä asetukset on hyvä
aluksi jättää sellaisikseen, ja vasta jos <e>Screen</e>-osion muutokset
eivät toimi kannattaa näitä muokata. Näiden arvot pitää katsoa monitorin
ohjekirjasta, apuna voi käyttää myös työkalua joka hakee monitorin arvot,
kuten <c>sys-apps/ddcxinfo-knoppix</c>.
</p>

<warn>
<b>Älä</b> muuttele monitoriasetuksia ilman monitorin ohjekirjan tarkkoja
tietoja, väärät arvot johtavat parhaimmillaan taajuusvirheilmoituksiin ja
pahimmillaan hajonneisiin näyttöihin.
</warn>

<p>
Muokataan aluksi resoluutioarvoja. Seuraavassa esimerkissä
lisätään <path>/etc/X11/xorg.conf</path>iin
<c>Modes</c>-asetukset ja <c>DefaultDepth</c>, jotta X käynnistyisi
1024×768-resoluutiossa 24-bittisellä värisyvyydellä. Esimerkkejä voi ja
kannattaa muuttaa mieltymysten mukaisiksi.
</p>

<pre caption="/etc/x11/xorg.confin säätäminen">
Section "Screen"
  Identifier  "Default Screen"
  Device    "S3 Inc. ProSavage KN133 [Twister K]"
  Monitor   "Generic Monitor"
  <i>DefaultDepth  24</i>
  <comment># Ohitettu joitain rivejä</comment>
  SubSection "Display"
    Depth   24
    <i>Modes   "1024x768"</i>
  EndSubSection
EndSection
</pre>

<p>
Käynnistä X testataksesi että resoluutio on oikea ja toimii.
</p>

</body>
</section>
<section>
<title>Näppäimistön asetukset</title>
<body>

<p>
X:n voi asettaa käyttämään vaikkapa suomalaista näppäimistöä
sopivasta <e>InputDevice</e>-osiosta. Asetus <c>XkbLayout</c> määrittelee
halutun näppäinasettelun. Esimerkiksi näin asetetaan suomalainen näppäimistö:
</p>

<pre caption="Näppäimistöasettelun muuttaminen">
Section "InputDevice"
  Identifier  "Generic Keyboard"
  Driver    "keyboard"
  Option    "CoreKeyboard"
  Option    "XkbRules"  "xorg"
  Option    "XkbModel"  "pc105"
  <i>Option    "XkbLayout" "fi"</i>
EndSection
</pre>

</body>
</section>
<section>
<title>Hiiren säätäminen</title>
<body>

<p>
Jollei hiiri toimi, kannattaa ensiksi testata tunnistaako kerneli sitä
ollenkaan. Hiirten laitetiedostot ovat
<path>/dev/input/mouse0</path> (tai <path>/dev/input/mice</path> useille
hiirille). Joissain tapauksissa myös <path>/dev/psaux</path> voi olla oikein.
Joka tapauksessa hiiren toimivuutta voi testata katsomalla
tiedostojen sisältöä kun hiirtä käytetään. Tulosteessa pitäisi näkyä
satunnaisehkoa roskaa hiirtä liikutellessa. Katselu lopetetaan
painamalla <c>Ctrl-C</c>:tä.
</p>

<pre caption="Laitetiedostojen tarkastelu">
# <i>cat /dev/input/mouse0</i>
<comment>(Muista Ctrl-C lopuksi)</comment>
</pre>

<p>
Jollei hiirtä tunnisteta, tarkista että kaikki tarpeelliset moduulit on ladattu.
</p>

<p>
Jos hiiri toimii, sen saa käyttöön täyttämällä sopivan <e>InputDevice</e>-osion.
Esimerkissä asetetaan myös kaksi muuta asetusta:
<c>Protocol</c> (joka kertoo hiiren käyttämän tietokäytännön, yleensä IMPS/2 tai
vastaavat) ja
<c>ZAxisMapping</c> (joka kertoo rullien toiminnan, jos niitä on).
</p>

<pre caption="Xorgin hiiriasetusten korjaus">
Section "InputDevice"
  Identifier  "TouchPad Mouse"
  Driver    "mouse"
  Option    "CorePointer"
  <i>Option    "Device"    "/dev/input/mouse0"</i>
  <i>Option    "Protocol"    "IMPS/2"</i>
  <i>Option    "ZAxisMapping"    "4 5"</i>
EndSection
</pre>

<p>
Komennolla <c>startx</c> voi taas varmistua lopputuloksesta. Nyt kasassa pitäisi
olla toimiva X-ympäristö. Seuraava askel olisi asentaa työpöytäympäristö ja
päästä eroon twm:stä, mutta se ei kuulu enää tähän oppaaseen.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Lisätietoa</title>
<section>
<title>Xorg.confin säätö</title>
<body>

<p>
Ohjesivulla <c>man 5 xorg.conf</c> on tiivis, mutta täysi luettelo
asetustiedoston sisältömahdollisuuksista. Se kannattaa pitää esillä
asetustiedostoa muokattaessa.
</p>

<p>
Lisäksi dokumentaatiota löytyy hakemiston
<path>/usr/X11R6/lib/X11/doc</path> alta erinäisistä
<path>README</path>-tiedostoista eri grafiikkakorteille.
</p>

<p>
Netissä on myös paljon tietoa asetuksista, alla on muutama
lueteltuna, mutta <uri link="http://www.google.com">Googlaamalla</uri>
löytyy lisää.
<path>xorg.conf</path> ja <path>XF86Config</path> (XFree86-palvelimen
asetustiedosto) ovat käytännössä samoja, joten luettelossa on myös
siihen liittyviä tietoja.
</p>

<ul>
  <li>
    <uri link="http://tldp.org/HOWTO/XFree-Local-multi-user-HOWTO/">The XFree
    Local Multi-User HOWTO</uri>
  </li>
  <li>
    <uri
    link="http://www-106.ibm.com/developerworks/edu/os-dw-linuxxwin-i.html">An
    Introduction to XFree 4.x</uri> by Chris Houser
  </li>
</ul>

</body>
</section>
<section>
<title>Muut lähteet</title>
<body>

<p>
Jos päivität vanhasta monoliitti-Xorgista uudempaan modulaariseen, lue
<uri
link="/proj/en/desktop/x/x11/modular-x-howto.xml">Migrating to Modular X
HOWTO</uri>.
</p>

<p>
Muita ohjeita löytyy
<uri link="/doc/fi/?catid=desktop">Työpöytäopaskokoelmasta</uri>.
</p>

</body>
</section>
</chapter>
</guide>
