<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/handbook/hb-net-modules.xml,v 1.4 2005/09/13 05:20:48 flammie Exp $ -->

<sections>

<version>1.5</version>
<date>2005-09-07</date>

<section>
<title>Verkkomoduulit</title>
<body>

<p>
Nykyisissä verkkoskripteissä on tuet eri moduuleille, joten siihen voi
lisätä helposti uusia rajapintatyyppejä ilman että vanhoja tarvitsee päivittää.
</p>

<p>
Moduulit latautuvat automaattisesti jos niiden tarvitsemat paketit on asennettu.
Kun moduulia, jonka tarvitsemat paketit eivät ole asenettu, yritetään käyttää,
tulostuu näytölle virheilmoitus, jossa kerrotaan, mikä paketti pitää asentaa.
Moduuliasetuksia ei yleensä tarvitse käyttää muutoin, kun jos on asennettu
kaksi saman toiminnon tarjoavaa pakettia ja niistä pitää valita sopivampi.
</p>

<pre caption="Moduulien valitseminen">
<comment># iproute2 ennen ipconfigia</comment>
modules=( "iproute2" )

<comment># Myös rajapinnoille voi valita moduuleja
# tässä valitaan udhcpc ennen dhcpcd:tä</comment>
modules_eth0=( "udhcpc" )

<comment># Moduulien käytön voi myös kieltää. Esimerkiksi jos käyttää
# muuta korviketta tai linux-wlan-ng:tä asetusten tekoon ja haluaa kuitenkin
# asettaa asetustiedostoon ESSID:t ja muut tiedot.</comment>
modules=( "!iwconfig" )
</pre>

</body>
</section>

<section>
<title>Rajapintakäsittelimet</title>
<body>

<p>
Tarjolla on kaksi rajapintojen käsittelijää: ifconfig ja iproute2. Toinen näistä
pitää valita että mitään saa asetetuksi ylipäätään.
</p>

<p>
Ifconfig on Gentoon oletusarvo ja se sisältyy profiiliin.
Iproute2 on tehokkaampi ja mukautuvampi, muttei ole oletusasennuksissa mukana.
</p>

<pre caption="Iproute2:n asennus">
# <i>emerge sys-apps/iproute2</i>

<comment># Iproute2 valitaan suositummaksi jos molemmat on asennettu</comment>
modules=( "iproute2" )
</pre>

<p>
Koska ifconfig ja iproute2 tekevät käytännössä samoja juttuja, niiden asetukset
toimivat molemmilla samoin. Esimerkiksi seuraavat ratkaisut toimivat käytetystä
paketista riippumatta.
</p>

<pre caption="ifconfigin ja iproute2:n esimerkit">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># Myös broadcastin voi määritellä</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>

</body>
</section>

<section id="dhcp">
<title>DHCP</title>
<body>

<p>
DHCP:llä haetaan verkon asetustiedot (IP, DNS-palvelimet, Gateway jne.)
automaattisesti DHCP-palvelimelta. Jos verkossa on DHCP-plavelin, koneiden
tarvitsee vain käyttää DHCP:tä ja verkon asetukset toimivat itsestään. Muut
laitteet, kuten langattomat verkot ja ppp pitää tietenkin asettaa tarvitessa
ennen DHCP:tä.
</p>

<p>
DHCP löytyy paketeista dhcpcd, dhclient, pump tai udhcpc. Jokainen DHCP-moduuli
sisältää hyviä ja huonoja puolia:
</p>

<table>
  <tr>
    <th>DHCP-moduuli</th>
    <th>Paketti</th>
    <th>Hyödyt</th>
    <th>Haitat</th>
  </tr>
  <tr>
    <ti>dhclient</ti>
    <ti>net-misc/dhcp</ti>
    <ti>
      ISC:n, BINDin DNS-ohjelmistojen tekijöiden tekemä, erittäin muokattava.
    </ti>
    <ti>
      Asetukset ovat monimutkaisia, ohjelmisto on turhan iso, ei osaa hakea
      NTP-palvelimia, ei lähetä konenimeä oletuksena.
    </ti>
  </tr>
  <tr>
    <ti>dhcpcd</ti>
    <ti>net-misc/dhcpcd</ti>
    <ti>
      Gentoon oletusarvo, ei riipu ulkoisista työkaluista.
    </ti>
    <ti>
      Ei enää ylläpidetty, toisinaan hidas, ei osaa muuttua palveluksi jos IP:n
      käyttöaika on ääretön.
    </ti>
  </tr>
  <tr>
    <ti>pump</ti>
    <ti>net-misc/pump</ti>
    <ti>
      Kevyt, ei riipu ulkoisista työkaluista
    </ti>
    <ti>
      Ei enää ylläpidetty, epäluotettava (erityisesti modeemeilla), ei osaa
      hakea NIS-palvelimia.
    </ti>
  </tr>
  <tr>
    <ti>udhcpc</ti>
    <ti>net-misc/udhcp</ti>
    <ti>
      Kevyt, pienin dhcp-asiakkaista, tehty integroiduille järjestelmille
    </ti>
    <ti>
      Testaamaton, ei käytössä missään distroista, ei osaa kolmea sekuntia
      pidempää aikakatkaisua.
    </ti>
  </tr>
</table>

<p>
Jos käytössä on useampia DHCP-ohjelmia, pitää niistä määritellä jokin
suosituimmaksi, oletusarvona on muutoin dhcpcd.
</p>

<p>
Lisäkomentoja moduulikohtaisesti saa muuttujaan moduuli_eth0.
<e>Esimerkiksi dhcpcd:lle dhcpcd_eth0="..."</e>.
</p>

<p>
Yleisesti toimiva DHCP-asetuksiakin on olemassa, ne asetetaan muuttujaan
dhcp_eth0. Näistä yksikään ei oletusarvoisesti ole päällä:
</p>

<ul>
  <li>release — vapauttaa IP-osoitteen</li>
  <li>nodns — ei ylikirjoita /etc/resolv.confia</li>
  <li>nontp — ei ylikirjoita /etc/ntp.confia</li>
  <li>nonis — ei ylikirjoita /etc/yp.confia</li>
</ul>

<pre caption="DHCP-esimerkkiasetusten teko tiedostoon /etc/conf.d/net">
<comment># Jos useampia dhcp-moduuleja on asennettu</comment>
modules=( "dhcpcd" )

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># Aikakatkaisu 10 sekuntia</comment>
dhcp_eth0="release nodns nontp nonis" <comment># Vain osoitteenhaku</comment>
</pre>

<note>
Dhcpcd, udhcpc ja pump lähettävät DHCP-palvelimelle konenimen oletusarvoisesti,
joten sitä ei tarvitse erikseen määritellä.
</note>

</body>
</section>

<section>
<title>ADSL-modeemi</title>
<body>

<p>
Ensin asennetaan ADLS-ohjelmat.
</p>

<pre caption="Rp-pppoe:n asentaminen">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
Baselayout-1.11.x-versiot tukevat vain PPPoE:tä, tulevaisuudessa aiotaan
tukea myös PPPoA:ta.
</warn>

<p>
Seuraavaksi asetetaan eth0 käyttämään ADSL-rajapintaa ja sopivaa käyttäjänimeä.
</p>

<pre caption="eth0:n asettaminen ADSL:ksi">
config_eth0=( "adsl" )
adsl_user_eth0="username"
</pre>

<p>
Lopulta pitää määritellä käyttäjänimi ja salasana tiedostoon
<path>/etc/ppp/pap-secrets</path>.
</p>

<pre caption="/etc/ppp/pap-secretsin asettaminen">
<comment># *-merkki on tärkeä!</comment>
"username"	*	"password"
</pre>

</body>
</section>

<section id="apipa">
<title>APIPA</title>
<body>

<p>
APIPA (Automatic Private IP Adressing) toimii hakemalla vapaata osoitetta
alueelta 169.254.0.0—169.254.255.255. Jos jostain osoitteesta ei vastata niin
se otetaan käyttöön.
</p>

<p>
Tämä on lähinnä hyödyllinen LANeilla kun DHCP-palvelinta eikä suoraa
Internet-yhteyttä ole käytössä, ja kaikki käyttävät APIPAa.
</p>

<p>
APIPA-tuen saa paketista net-misc/iputils tai net-analyzer/arping
</p>

<pre caption="APIPA-asetusten tekeminen tiedostoon /etc/conf.d/net">
<comment># Ensin yritetään DHCP:tä sitten APIPAa</comment>
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># Just use APIPA</comment>
config_eth0=( "apipa" )
</pre>

</body>
</section>

<section>
<title>Bonding</title>
<body>

<p>
Linkkien bondaus ja yhdistely onnistuu ohjelmalla net-misc/ifenslave.
</p>

<p>
Bondaus nostaa kaistanleveyttä. Jos käytössä on kaksi verkkoyhteyttä samaan
verkkoon ne vou liittää yhteen siten, että ohjelmille ne näkyvät yhtenä
yhteytenä.
</p>

<pre caption="bonding-asetusten teko tiedostoon /etc/conf.d/net">
<comment># Rajapintojen yhteenliittäminen</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># Bonding-rajapinnalle ei ehkä haluta osoitetta</comment>
config_bond0=( "null" )

<comment># Liittäminen riippuu kaikista liitettävistä rajapinnoista</comment>
depend_bond0() {
    need net.eth0 net.eth1 net.eth2
}
</pre>

</body>
</section>

<section>
<title>Siltaus (802.1d-tuki)</title>
<body>

<p>
Siltaustuki löytyy paketista net-misc/bridge-utils.
</p>

<p>
Siltauksella liitetään verkkoja toisiinsa. Esimerkiksi jos käytössä on palvelin,
joka liitetään Internetiin ADSL:llä ja langaton paikallinen yhteys siihen muista
koneista, voidaan yhdistää sillan läpi ADSL:llä Internetiin.
</p>

<pre caption="Siltausasetusten tekeminen tiedostoon /etc/conf.d/net">
<comment># Siltauksen asetukset, ohjesivulta man btctl lisätietoja</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># Lisää portteja siltaan br0</comment>
bridge_br0="eth0 eth1"

<comment># Portit pitää asettaa nulleiksi ettei dhcp käynnisty</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># Lopulta sillalle annetaan osoite, tähän voi käyttää DHCP:täkin</comment>
config_br0=( "192.168.0.1/24" )

<comment># Riippuvuus eht0:aan ja eth1:een jos ne tarvitsevat lisäasetuksia</comment>
depend_br0() {
    need net.eth0 net.eth1
}
</pre>

<impo>
Joissain silta-asetuksissa kannattaa pitää mielessä
<uri link="?part=4&amp;chap=2#variable_name">muuttujien nimet</uri>.
</impo>

</body>
</section>

<section>
<title>MAC-osoite</title>
<body>

<p>
MAC-osoiteen muuttamiseksi suoraan ei tarvita mitään eri ohjelmia. Kuitenkin
jos halutaan satunnaisia tai tietyntyyppisiä osoitteita pitää asentaa
net-analyzer/macchanger.
</p>

<pre caption="MAC-osoitteen muuttaminen">
<comment># Aseta rajapinnan MAC-osoite</comment>
mac_eth0="00:11:22:33:44:55"

<comment># Satunnaista kolme viimeistä tavua</comment>
mac_eth0="random-ending"

<comment># Satunnaista kaikki samantyyppiset yhteydet (valokaapeli,
# kupari, langaton)</comment>
mac_eth0="random-samekind"

<comment># Satunnaista kaikentyyppiset yhteydet</comment>
mac_eth0="random-anykind"

<comment># Satunnaista täysin, huomaa: tämä ei useinkaan toimi niinkuin
# olisi odotettua</comment>
mac_eth0="random-full"
</pre>

</body>
</section>

<section>
<title>Tunnelointi</title>
<body>

<p>
Tunnelointia varten ei tarvitse mitään eri ohjelmia, koska sen hoitaa rajapinnan
käsittelijä.
</p>

<pre caption="Tunnelointiasetusten tekeminen tiedostoon /etc/conf.d/net">
<comment># GRE-tunneli</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># IPIP-tunneli</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># Rajapinta-asetukset</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" )
</pre>

</body>
</section>

<section>
<title>VLAN (802.1q-tuki)</title>
<body>

<p>
VLAN-tuelle tarvitaan paketti net-misc/vconfig.
</p>

<p>
Virtuaali-LAN tarkoittaa joukkoa verkkolaitteita, jotka käyttäytyvät
paikallisena verkkosegmenttinä, vaikkeivät fyysisesti olisikaan. VLANin
osat näkevät vain saman VLANin osat paikallisina, vaikka jakaisivatkin
fyysisen verkon muiden kanssa.
</p>

<pre caption="VLAN-asetusten tekeminen tiedostoon /etc/conf.d/net">
<comment># Määrittele VLAN-numerot rajapinnoille</comment>
<comment># Muista ettei VLAN-numeroita täydennetä etunollilla</comment>
vlans_eth0="1 2"

<comment># VLANille voi myös antaa asetuksia</comment>
<comment># lisätietoja vconfigin man-sivuilta</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># Aseta rajapinnat tavalliseen tapaan</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Joissakin VLAN-asetuksissa kannattaa muistaa
<uri link="?part=4&amp;chap=2#variable_name">muuttujien nimet</uri>.
</impo>

</body>
</section>

</sections>
