<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/handbook/hb-working-features.xml,v 1.1 2004/10/11 08:18:47 flammie Exp $ -->

<sections>
<section>
<title>DistCC</title>
<subsection>
<title>Mikä sitten on DistCC?</title>
<body>

<p>
<c>distcc</c> on ohjelma joka osaa jakaa käännökset useammalle, jopa
erilaiselle, verkotetulle koneelle. <c>distcc</c>-asiakasohjelma lähettää
tarpeelliset tiedot kaikille saatavilla oleville DistCC-palvelimille
(käynnistetyille <c>distccd</c>-palveluille), jotta ne voivat kääntää
osia koodista asiakkaan puolesta. Tästä netotaan yleensä vähemmän
käännösaikaa.
</p>

<p>
Tarkemmin tietoa <c>distcc</c>:stä (ja sen käytöstä Gentoo-järjestelmissä)
löydät erillisestä <uri link="/doc/en/distcc.xml">Gentoo
Distcc-dokumentistamme</uri>.
</p>

</body>
</subsection>
<subsection>
<title>DistCC:n asennus</title>
<body>

<p>
Distcc:n mukana tulee graafisia valvontaohjelmia joilla voi tarkastella
lähetettyjä käännöksiä. Jos käytät Gnomea, lisää gnome <c>USE</c>-asetuksiisi.
Jollet käytä Gnomea ja tarvitset silti valvontaohjelmaa, käytä
<c>USE</c>-asetusta gtk.
</p>

<p>
Distcc:n asennus on helppoa kuten kaikkien muidenkin Gentoon ohjelmistojen:
</p>


<pre caption="Distcc:n asennus">
# <i>emerge distcc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Portagen tuen aktivointi</title>
<body>

<p>
Kun asennus on helppoa niin lopunkin pitäisi sujua helposti :) Aktivoikaamme
siis Portageen tuki <c>distcc</c>:lle.
</p>

<p>
Aloita avaamalla tiedosto <path>/etc/make.conf</path> ja lisää
muuttujaan <c>FEATURES</c> arvo <c>distcc</c>. Sitten muuta muuttujaa
<c>MAKEOPTS</c> siten, että siinä sanotaan <c>-jX</c>, missä <c>X</c> on
verkossa olevien <c>distccd</c>:tä ajavien prosessorien määrä (nämä
mukaanlukien) lisättynä yhdellä:
</p>

<pre caption="/etc/make.confin MAKEOPTS-asetus">
<comment># Oletetaan kaksi yhden prosessorin järjestelmää tämän
lisäksi:</comment>
MAKEOPTS="-j4"
</pre>

<p>
Seuraavaksi lisää <c>distcc-config</c>illa käytettävät DistCC-palvelimet.
Esimerkissä käytämme palvelimia osoitteissa
<c>192.168.1.102</c> (tämä kone), <c>192.168.1.103</c> ja
<c>192.168.1.104</c> (kaksi etäkonetta):
</p>

<pre caption="DistCC:n asettaminen etäkoneita varten">
# <i>distcc-config --set-hosts "192.168.1.102 192.168.1.103 192.168.1.104"</i>
</pre>

<p>
Älä tietenkään unohdaa käynnistää itse <c>distccd</c>-palvelua:
</p>

<pre caption="Distccd-palvelun käynnistäminen">
# <i>/etc/init.d/distccd start</i>
</pre>

<p>
Onnea, järjestelmä on nyt valmis rinnakaistettuihin kääntöihin! Lisää
tietoa DistCC:stä Gentoossa löytyy <uri
link="/doc/en/distcc.xml">Gentoo DistCC Documentation</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Ccache</title>
<subsection>
<title>Mikä on ccache?</title>
<body>

<p>
<c>ccache</c> on nopea kääntäjän välimuisti. Ohjelmaa käännettäessä se
tallentaa tulokset jotta saman ohjelman uusien kääntöjen ajat nopeutuisivat.
Yleisissä käännöksissä nopeutus on jotain viisin-, kymmenkertaisen luokkaa.
</p>

<p>
Jos haluat tietää tarkemmin <c>ccache</c>n käyttäytymisestä, vieraile
<uri link="http://ccache.samba.org">ccachen kotisivuilla</uri>.
</p>

</body>
</subsection>
<subsection>
<title>ccachen asennus</title>
<body>

<p>
<c>ccachen</c> asennus gentooseen on näppärää, ei tarvitse kuin käyttä
emergeä ja homma on valmis :)
</p>

<pre caption="ccachen asennus">
# <i>emerge ccache</i>
</pre>

</body>
</subsection>
<subsection>
<title>Ccachen säätäminen</title>
<body>

<p>
Portage käyttää ccachea automaattisesti jos se on asennettu.
Oletusarvoisen cachen kokoa voi kuitenkin säätää tarjoamalla muuttujaa
<c>CCACHE_SIZE</c> tiedostossa <path>/etc/make.conf</path>:
</p>

<pre caption="CCACHE_SIZEn muokkaus tiedostossa /etc/make.conf">
CCACHE_SIZE="2G"
</pre>

<p>
Nyt portage käyttää <c>ccache</c>a nopeuttaakseen käännöstöitä kun
se vain on mahdollista. Jos epäilet <c>ccache</c>n toimivuutta, komennolla
<c>ccache -s</c> saa näkyviin statistiikkatietoja:
</p>

<pre caption="ccachen statistiikkatietojen katselu">
# <i>ccache -s</i>
</pre>

</body>
</subsection>
<subsection>
<title>Ccachen käyttö Portagen ulkopuolella C-koodin kanssa</title>
<body>

<p>
Jos aiot käyttää ccachea Portagen ulkopuolella kääntäessäsi itse
C-kielistä koodia, lisää
<path>/usr/lib/ccache/bin</path> polkumuuttujan <c>PATH</c> alkuun
(erityisesti ennen kohtaa <path>/usr/bin</path>). Tähän päästään
muokkaamalla tiedostoa <path>/etc/profile</path>:
</p>

<pre caption="Profiilin muokkaus">
# <i>nano -w /etc/profile</i>
# <i>source /etc/profile</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Binääripaketit</title>
<subsection>
<title>Binääripakettien luonti</title>
<body>

<p>
Olemme jo tarkastelleet esikäännettyjen paketin asentamista, seuraavaksi
paneudutaan esikäännettyjen pakettien tekemiseen.
</p>

<p>
Asennetusta paketista voi tehdä tarpallon komennolla <c>quickpkg</c>. Tämä
on tehokasta varmuuskopiointiin!
</p>

<pre caption="quickpkg:n käyttö">
# <i>quickpkg gnumeric</i>
</pre>

<p>
Jollei pakettia ole asennettu, <c>emerge</c>ä voi pyytää tekemään
binääripakettejakin. Tämän saa aikaan valitsemella <c>--buildpkg</c> (lyhyesti
<c>-b</c>):
</p>

<pre caption="Gnumericin asennus ja binääripaketin rakennus">
# <i>emerge --buildpkg gnumeric</i>
</pre>

<p>
Oletusarvoiseksi tämän käyttäytymisen saa lisäämällä sanan <c>buildpkg</c>
<path>/etc/make.conf</path>in muuttujaan <c>FEATURES</c>.
</p>

<pre caption="Binääripakettien automaattinen asentaminen">
FEATURES="buildpkg"
</pre>

<p>
Jos haluat tehdä binääripaketin asentamatta itse ohjelmaa, voit tehdä sen
valitsimella <c>--buildpkgonly</c> (lyhyesti <c>-B</c>):
</p>

<pre caption="Gnumericin binääripaketin tekeminen">
# <i>emerge --buildpkgonly gnumeric</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Turvallisuustoiminnot</title>
<subsection>
<title>Hiekkalaatikkoympäristö (sandbox)</title>
<body>

<p>
Ohjelmien kääntö- ja asennusvaiheessa Portage käyttää <e>sandbox</e>-ympäristöä
oikean järjestelmän suojelemiseksi. Tämä tarkoittaa ettei paketti ennen
varsinaista asennusta muokkaa hiekkalaatikon ulkopuolisia tiedostoja. Näin
Portage varmistaa tiedon siitä mitä tiedostoja paketit ovat luoneet ja
muokanneet.
</p>

<p>
Paketin käännön loputtua Portage esiasentaa sen hiekkalaatikkoon tarkkaillen
tiedostojen sijoittumista. Tämän jälkeen tiedostot siirretään hiekkalaatikosta
varsinaisen järjestelmän puolelle.
</p>

</body>
</subsection>
<subsection>
<title>Käyttäjäoikeudet (User privileges)</title>
<body>

<p>
Portage pystyy myös kääntämään paketit ilman pääkäyttäjän oikeuksia (käytännössä
käyttäjänä portage ryhmässä portage). Tämä parantaa käännösprosessin
tietoturvaa. Portage voi käyttää käyttäjän oikeuksia joko ilman tai
hiekkalaatikon kanssa. Suositelluin tapa on tietenkin valita
käyttäjän oikeudet hiekkalaatikkolla :)
</p>

</body>
</subsection>
<subsection>
<title>Sandboxin ja userprivin aktivointi</title>
<body>

<p>
<c>sandbox</c> on Portagessa oletusasetus. Jos haluat käyttää käyttäjän
oikeuksia, lisää <c>userpriv</c> muuttujaan <c>FEATURES</c>. Huomaa, että
<c>userpriv</c> poistaa <c>sandbox</c>in käytöstä, ellei käyttöön oteta
myös <c>usersandbox</c>ia:
</p>

<pre caption="Userprivin ja usersandboxin aktivointi">
FEATURES="userpriv usersandbox"
</pre>

<warn>
<e>Älä</e> poista <c>sandbox</c>ia <c>FEATURES</c>-muuttujasta!
</warn>

</body>
</subsection>
<subsection>
<title>Tiukat varmistukset</title>
<body>

<p>
Portagen voi saada olemaan varovainen mahdollisesti vaarallisten tilanteiden
(kuten puuttuvien ja virheellisten Manifest-tiedostojen) kanssa. Tiukemmat
varmistukset käännetään päälle lisäämällä
<c>strict</c> muuttujaan <c>FEATURES</c>:
</p>

<pre caption="Varmistusten aktivointi">
FEATURES="strict"
</pre>

</body>
</subsection>
<subsection>
<title>Älykäs tiedosto-oikeuksien hallinta</title>
<body>

<p>
Portagen saa käsittelemään mahdollisesti tietoturvallisesti ongelmallisia
tilanteita automaattisesti. Tällöin se poistaa esiasennusvaiheessa ryhmän ja
maailman lukuoikeudet tiedostoista joissa setuid on asetettu ja maailman
lukuoikeudet jos setgid on asetettu. Älykkäät tiedosto-oikeudet
saa päälle lisäämällä sanan <c>sfperms</c> muuttujaan <c>FEATURES</c>:
</p>

<pre caption="Älykkäiden tiedosto-oikeuksien aktivointi">
FEATURES="sfperms"
</pre>

</body>
</subsection>
</section>
<section>
<title>Lokeroidut (SLOT'ed) ohjelmistoversiot</title>
<subsection>
<title>SLOTti?</title>
<body>

<p>
Toisinaan on hyödyllistä asentaa samasta ohjelmistosta useita versioita
yhteen järjestelmään, vaikkapa riippuvuuksia täyttämään. Useimmissa distroissa
tämä toimii siten, että pakettien nimiin ympätään sen versio (kuten
<c>freetype</c> versus <c>freetype2</c>), Portagessa kuitenkin tähän käytetään
<e>SLOT</e>teja.
</p>

<p>
<e>SLOT</e>ti, eli lokero, on (osa) ohjelman versiotiedosta, jonka mukaan
Portage sijoittelee samannimiset paketit eri lokeroihinsa, jotta ne voisivat
esiintyä samassa järjestelmässä yhtä aikaa. Portage osaa seurata molempia
versiohaaroja ja päivittää vastaavat lokerot tarpeen mukaan.
</p>

<p>
Kun päivität ohjelmistoja, Portage puhdistaa automaattisesti niiden vanhemmat
versiot vain, jos ne käyttävät samaa lokeroa. Tämän takia esimerkiksi
kerneleitä ei koskaan poisteta päivityksissä, niiden lokerotunnuksina kun
käytetään koko versionumeroa.
</p>

</body>
</subsection>
</section>
<section>
<title>Muut ominaisuudet</title>
<subsection>
<title>Portagen ohje</title>
<body>

<p>
<c>FEATURES</c>-muuttujaan voi myös asettaa muutamia muita arvoja. Useimmat
niistä on kehittäjien käytettäväksi, eivätkä varmaankaan kiinnosta tavan
käyttäjää. Jos nämä toiminnot kiinnostavat (tai Portage muutenkin, lue
<path>make.conf</path>in man-sivumme.
</p>

<pre caption="Lisää Portage-tietoutta">
# <i>man make.conf</i>
</pre>

</body>
</subsection>
</section>
</sections>
