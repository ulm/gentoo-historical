<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/handbook/hb-net-advanced.xml,v 1.2 2005/09/04 00:17:26 flammie Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fi/handbook/hb-net-advanced.xml,v 1.2 2005/09/04 00:17:26 flammie Exp $ -->

<sections>

<version>1.4</version>
<date>2005-08-14</date>

<section>
<title>Erikoisasetukset</title>
<body>

<p>
Config_eth0 määrittelee keskeisen osan rajapinnan asetuksista. Se on
korkean tason määritys rajapinnalle eth0. Jokainen komento siinä suoritetaan
järjestyksessä. Rajapinnan katsotaan olevan pystyssä, jos yksikin kommenoista
on onnistunut.
</p>

<p>
Tässä luettelo komentovaihtoehdoista.
</p>

<table>
  <tr>
    <th>Komento</th>
    <th>Kuvaus</th>
  </tr>
  <tr>
    <ti>null</ti>
    <ti>Ei tee mitään</ti>
  </tr>
  <tr>
    <ti>noop</ti>
    <ti>
      Jos rajapinta on pystyssä ja sillä on osoite, peruuta onnistuneesti.

    </ti>
  </tr>
  <tr>
    <ti>IPv4- tai IPv6-osoite</ti>
    <ti>Lisää osoite rajapintaan</ti>
  </tr>
  <tr>
    <ti>
      dhcp, adsl tai apipa (tai mukailtu komento jostain ulkoisesta moduulista)
    </ti>
    <ti>
      Käynnistä moduuli joka tarjoaa komennon. Dhcp käynnistää jonkin
      moduuleista joka tarjoaa toiminnon dhcp, eli dhcpcd:n, udhcpc:n,
      dhclientin tai pumpin.
    </ti>
  </tr>
</table>

<p>
Jos komento epäonnistuu, on mahdollista määritellä varakomento. Varakomentojen
rakenne vastaa täsmälleen configin rakennetta.
</p>

<p>
Näitä komentoja voi ketjuttaa yhteen, tässä on esimerkiksi joitain käytettyjä
asetuksia:
</p>

<pre caption="Asetusesimerkkejä">
<comment># IPv4-osoitteiden lisäys</comment>
config_eth0=(
    "192.168.0.2/24"
    "192.168.0.3/24"
    "192.168.0.4/24"
)

<comment># IPv4-osoitteen ja IPv6-osoitteiden lisäys</comment>
config_eth0=(
    "192.168.0.2/24"
    "4321:0:1:2:3:4:567:89ab"
    "4321:0:1:2:3:4:567:89ac"
)

<comment># Pidetään ytimen antama osoite kunnes se lakkaa toimimasta,
# Tämän jälkeen haetaan DHCP:llä. Jos DHCP ei onnistu haetaan sopiva
# kiinteä osoite APIPAlla</comment>
config_eth0=(
    "noop"
    "dhcp"
)
fallback_eth0=(
    "null"
    "apipa"
)
</pre>

<note>
Jos käytössä on ipconfig-moduuli ja asetataan useampia osoitteita, niille
luodaan rajapinta-aliakset. Ylläolevissa esimerkeissä tehdään rajapinnat
eth0, eth0:1 ja eth0:2. Näillä rajapinnoilla ei voi tehdä mitään suurempia,
sillä ydin ja ohjelmat käsittelevät eth0:1:tä ja eth0:2:ta kuten eth0:aa.
</note>

<impo>
Fallback-komennon järjestys on merkityksellinen! Jos ensimmäinen komento ei
olisi null, apipa ajettaisiin vain jos noop ei toimi.
</impo>

<note>
<uri link="?part=4&amp;chap=3#apipa">APIPAsta</uri> ja
<uri link="?part=4&amp;chap=3#dhcp">DHCP:stä</uri> kerrotaan lisää tuonnempana
</note>

</body>
</section>

<section>
<title>Verkkoriippuvuudet</title>
<body>

<p>
Initskriptit <path>/etc/init.d</path>:ssä voivat riippua tietyistä
verkkorajapinnoista tai vain netistä. Mitä net tarkoittaa määritellään
tiedostossa <path>/etc/conf.d/rc</path> muuttujan
<c>RC_NET_STRICT_CHECKING</c> eri arvoina.
</p>

<table>
  <tr>
    <th>Arvo</th>
    <th>Kuvaus</th>
  </tr>
  <tr>
    <ti>none</ti>
    <ti>net on aina ylhäällä</ti>
  </tr>
  <tr>
    <ti>no</ti>
    <ti>
      Vähintään yhden net.*-palvelun pitää olla käynnistynyt onnistuneesti
      net.lo:n lisäksi. Tätä voi käyttää kannettavilla, joissa on wifi ja
      staattinen nic, ja vain toisen tarvitsee olla käytössä.
    </ti>
  </tr>
  <tr>
    <ti>lo</ti>
    <ti>
      Sama kuin no, mutta net.lo lasketaan myös rajapinnaksi. Tämä sopii
      jos ei tarvitse minkään tietyn rajapinnan olla ylhäällä käynnistyksessä.
    </ti>
  </tr>
  <tr>
    <ti>yes</ti>
    <ti>
      Tätä varten kaikkien rajapintojen täytyy olla pystyssä, jotta net
      lasketaan pystyssäolevaksi.
    </ti>
  </tr>
</table>

<p>
Mutta jos net.br0 riippuu net.eth0:sta ja net.eth1:stä? Net.eth1 saattaa
olla langaton tai ppp-yhteys, joka pitää asettaa ennen siltausta.
Tätä ei voi tehdä <path>/etc/init.d/net.br0</path>:lla, koska se on vain linkki
net.lo:hon.
</p>

<p>
Ratkaisuna voi käyttää omaa depend()-funktiota <path>/etc/conf.d/net</path>issä.

</p>

<pre caption="net.br0:n riippuvuuden asettaminen /etc/conf.d/netiin">
<comment># Mitä tahansa tunnetuista initskriptiriippuvuuksista after,
# before jne. voi käyttää</comment>
depend_br0() {
    need net.eth0 net.eth1
}
</pre>

<p>
Tarkemmat selitykset riippuvuuksista löytyvät,
<uri link="?part=2&amp;chap=4#doc_chap4">
Käsikirjan initskriptiosiosta</uri>.
</p>

</body>
</section>

<section id="variable_name">
<title>Muuttujien nimet ja arvot</title>
<body>

<p>
Muuttujien nimet ovat dynaamisia. Ne vastaavat yleensä rakennetta
<c>muuttuja_${rajapinta|mac|essid|apmac}</c>. Esimerkiksi
<c>dhcpcd_eth0</c> on rajapinnan eth0 dhcpcd-asetusmuuttuja ja
<c>dhcpcd_essid</c> on minkä tahansa essid:tä käyttävän rajapinnan
dhcpcd-asetukset.
</p>

<p>
Kuitenkaan ei ole olemassa mitään sääntöä, että rajapintanimien pitäisi olla
muotoa ethN. Esimerkiksi monet langattomat rajapinnat ovat wlanN tai raN
ethN:n lisäksi. Käyttäjien rajapinnatu kuten sillat ovat myös usein vapaasti
nimettyjä. Lisäksi langattomien AP-nimet voivat sisältää muitakin kuin aakkosia
ja numeroita, tämä on tärkeää huomata, koska on mahdollista asettaa
ESSID-kohtaisia verkkoasetuksia.
</p>

<p>
Huonona puolena Gentoo käyttää bashin muuttujia verkkoasetuksiin, ja bash ei
voi käyttää muita kuin englantilaisia aakkosia ja numeroita. Tämän ohittamiseksi
kaikki muut kirjaimet pitää muuttaa alaviivoiksi '_'.
</p>

<p>
Toinen haittapuoli bashissa on, että muuttujien arvoissa olevia merkintöjä
pitää joskus merkitä escape-merkinnöin. Tähä tarkoitukseen käytetään
takakenoviivaa '\'. Merkit <c>"</c> <c>'</c> ja <c>\</c> pitää merkitä aina
escape-merkinnöillä.
</p>

<p>
<c>" ' \</c>
</p>

<p>
Esimerkiksi jos käytämme ESSID:tä joka sisältää erikoismerkkejä:
</p>

<p>
<c>My "\ NET</c>
</p>

<pre caption="Muuttujan nimiesimerkki">
<comment># Toimii, paitsi domainnimi on virheellinen</comment>
dns_domain_My____NET="My \"\\ NET"

<comment># Ylläoleva asettaa domainiksi My \" NET kun langattomalla
# yhdistetään AP:hen jonka ESSID on My \" NET</comment>
</pre>

</body>
</section>

</sections>
