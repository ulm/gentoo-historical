<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/cs/alsa-guide.xml,v 1.4 2005/09/09 15:36:19 jkt Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/cs/alsa-guide.xml" lang="cs">
<title>Instalace ALSA pro&nbsp;Gentoo</title>

<author title="Autor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Překladatel">
  <mail link="_einstein@centrum.cz">Mirek Kratochvíl</mail>
</author>
<author title="Překladatel">
   <mail link="jkt@gentoo.org">Jan Kundrát</mail>
</author>


<abstract>
Pomoc při&nbsp;instalaci a nastavení ALSA pro&nbsp;Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.9</version>
<date>2005-09-09</date>

<!-- This translation needs review & check -->

<chapter>
<title>Úvod</title>
<section>
<title>Co je to ALSA?</title>
<body>

<p>
ALSA, zkratka pro&nbsp;<e>Advanced Linux Sound Architecture</e>, je nástroj dodávající
zvukové a MIDI (<e>Musical Instrument Digital Interface</e>) funkce do&nbsp;Linuxu.
Od dob kernelu 2.6 je to výchozí zvukový systém nahrazující původní OSS
(<e>Open Sound System</e>), který byl používán v kernelech řady 2.4.
</p>

<p>
Hlavní vlastností ALSA je dostatečná podpora všech typů zvukových
nástrojů, od běžných zvukových karet až k&nbsp;profesionálnímu hudebnímu
studiovému vybavení. Plně modulové ovladače, SMP a thread safety,
zpětná kompatibilita s&nbsp;OSS a userspace knihovna <c>alsa-lib</c>
mění vyvíjení zvukových aplikací pro&nbsp;Linux na&nbsp;procházku růžovým sadem.
</p>

</body>
</section>
<section>
<title>ALSA v&nbsp;Gentoo</title>
<body>

<p>
Jedna z&nbsp;hlavních výhod Gentoo je, že nechává uživatelům maximální
kontrolu nad instalací a konfigurací systému. Stejně je tomu i u ALSA,
Gentoo nabízí 2 způsoby podpory. Na oba se podíváme detailně v
následující kapitole.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Instalace ALSA</title>
<section>
<title>Nastavení</title>
<body>

<warn>
2 následující metody instalace jsou <e>naprosto nezkombinovatelné</e>.
ALSA nemůže být zkompilována do&nbsp;kernelu a zároveň běžet z
<c>media-sound/alsa-driver</c>.
</warn>

<p>
Dvě možnosti jsou:
</p>

<ol>
  <li>
  Použít ALSA dodávanou s&nbsp;kernelem. To je doporučovaná, jednodušší
  a preferovaná metoda.
  </li>
  <li>
  Použít balíček <c>media-sound/alsa-driver</c>.
  </li>
</ol>

<p>
Obě metody mají klady a zápory, tady je jejich stručný přehled:
</p>

<table>
<tr>
  <th>ALSA v kernelu</th>
  <th>Klady a zápory</th>
</tr>
<tr>
  <th>+</th>
  <ti>Velmi stabilní, ovladače jsou přímo v kernelu.</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Rozhodnutí bez následků, žádné další emergování při&nbsp;přestavování kernelu.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Může jít o trochu starší verzi ovladačů než v <c>alsa-driver</c>.</ti>
</tr>
</table>

<table>
<tr>
  <th>alsa-driver</th>
  <th>Klady a zápory</th>
</tr>
<tr>
  <th>+</th>
  <ti>Nejnovější ovladače přímo od ALSA týmu.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Každá změna v nastavení kernelu znamená přestavbu <c>alsa-driver</c>.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Potřeba několika přesných nastavení kernelu.</ti>
</tr>
</table>

</body>
</section>
<section>
<title>Rozhodnutí</title>
<body>

<p>
Hlavní a nejdůležitější rozdíl mezi <c>alsa-driver</c> a ALSA v kernelu
je ten, že <c>alsa-driver</c> je v zásadě aktuálnější. V dnešní době to
už ale neznamená až tak obrovský rozdíl (rozuměj prakticky nepoznatelný),
takže použít ALSA z&nbsp;kernelu se zdá jako nejlepší řešení. Před hlášením chyb
do <uri link="https://bugs.gentoo.org">Gentoo Bugzilly</uri> se je prosím
pokuste reprodukovat při použití <c>alsa-driver</c>u (chybu však nahlaste
v&nbsp;každém případě).
</p>

</body>
</section>
<section id="lspci">
<title>Ještě před akcí...</title>
<body>

<p>
Ať zvolíte jakoukoliv metodu instalace ALSA, potřebujete vědět, jaké ovladače
používá vaše zvuková karta. Ve&nbsp;většině případů jsou zvukové karty typu PCI
(ať už integrované na motherboardu či doplňkové), a proto vám pomůže příkaz
<c>lspci</c>. Pokud jej ještě nemáte nainstalovaný, použijte prosím <c>emerge
sys-apps/pciutils</c>. Pokud je vaše zvuková karta připojena přes USB,
<e>může</e> vám pomoci <c>lsusb</c> z&nbsp;<c>sys-apps/usbutils</c>. Pro karty
ISA zkuste <c>sys-apps/isapnptools</c>, event. zkuste projít následující odkazy:
</p>

<ul>
  <li>
  <uri link="http://www.roestock.demon.co.uk/isapnptools/">Stránka
  o ISAPNPTOOLS</uri>
  </li>
  <li>
  <uri link="http://www2.linuxjournal.com/article/3269">Článek o PnP na
  LinuxJournal</uri>
  </li>
  <li>
  <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">TLDP Sound
  HowTo</uri>
  </li>
</ul>

<note>
Pro jednoduchost budeme dále předpokládat, že používáte zvukovou kartu typu PCI.
</note>

<p>
Nyní o zvukové kartě zjistíme více informací.
</p>

<pre caption="Detaily o zvukové kartě">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
V tomto případě víme, že zvuková karta je Sound Blaster Live! a že ji vyrobil
Creative Labs. Podíváme se na&nbsp;<uri link="http://www.alsa-project.org/alsa-doc/">
ALSA Soundcard Matrix</uri>, tam z&nbsp;menu vybereme Creative Labs. Na další stránce
vidíme, že SB Live! používá modul <c>emu10k1</c>, a to je informace kterou potřebujeme.
Pokud vás zajímají detaily, můžete použít odkaz vedle "Details".
</p>

</body>
</section>
<section id="kernel">
<title>Použití ALSA z&nbsp;kernelu</title>
<body>

<p>
Pokud jste osoba se sklonem k&nbsp;jednoduchým a krásným řešením, tohle je právě
to, co hledáte.
</p>

<note>
Od dob 2005.0, Gentoo Linux používá jako standartní kernel 2.6. Kromě případu
specfického použití 2.4 kernelu je na&nbsp;<e>většině</e> architektur jádro
<c>gentoo-sources</c> ve verzi 2.6, přesto to raději zkontrolujte, protože
na nižším kernelu (2.4) tato metoda <e>definitivně nepracuje</e>.
</note>

<p>
Nastavíme kernel tak, aby používal ALSA.
</p>

<impo>
Uživatelé <c>genkernel</c>u by nyní měli spustit <c>genkernel --menuconfig all</c> a poté se řídit
instrukcemi z&nbsp;<uri link="#doc_chap2_pre3">Nastavení kernelu pro ALSA</uri>.
</impo>

<pre caption="Nastavení kernelu">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
Příklad nahoře předpokládá, že ke zdrojům použitého kernelu ukazuje symlink
<path>/usr/src/linux</path>, proto je to dobré zkontrolovat.
</note>

<p>
Teď se podíváme na&nbsp;nastavení samotného 2.6 kernelu.
</p>

<p>
Všimněte si prosím, že pro jednoduchost uvádějí všechny příklady ALSA
nakonfigurovanou jako jaderné moduly. Je doporučené se držet stejného schématu,
neboť umožňuje použití <c>alsaconf</c>, jež vám usnadní konfiguraci karty.
<e>Nepřeskočte</e> prosím sekci <uri link="#alsa-config">Configuration</uri>.
Pokud stále chcete mít ALSA součástí kernelu, ujistěte se, že jste si
odpovídajícím způsobem upravili svoji konfiguraci.
</p>

<pre caption="Nastavení kernelu pro ALSA">
Device Drivers  ---&gt;
   Sound  ---&gt;

<comment>(Musí být povoleno)</comment>
&lt;M&gt; Sound card support

<comment>(OSS zakážeme)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(O položku výše je ALSA)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Tohle vybereme v případě, že chceme MIDI sequencer)</comment>
   &lt;M&gt; Sequencer support
   <comment>(Podpora starších /dev/mixer* a /dev/dsp*, je dobré s&nbsp;ní počítat.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API

<comment>(Teď si můžeme vybrat podporovaná zařízení (viz. pokus s&nbsp;lspci)
Vetšinou nebude potřeba víc než jedno, v případě větsího množství je
povolte všechny.</comment>

<comment>(Většinou pro&nbsp;důvody testování a vývoje, ne pro&nbsp;normální
uživatele, pokud nevíte co děláte.</comment>
Generic devices  ---&gt;

<comment>(Pro ISA karty)</comment>
ISA devices   ---&gt;
<comment>(V přípagě že máte Gravise, vyberte následující)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Další menu je pro&nbsp;PCI karty, kterých je dnes většina)</comment>
PCI devices   ---&gt;
   <comment>(Vzbereme emu10k1 pro&nbsp;naši kartu)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(Nebo většinou onboardový AC97)</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(Nebo kartu od VIA)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(V případě že máte cokoliv zvukového na&nbsp;USB je pro&nbsp;vás
následující sekce)</comment>
USB Devices   ---&gt;
</pre>

<p>
Teď, když máme podporu pro&nbsp;ALSA zapnutou, můžeme překompilovat kernel,
ALSA by měla fungovat hned, jak nabootujeme. Můžeme pokračovat rovnou
do sekce <uri link="#alsa-utilities">ALSA Utilities</uri>
</p>

</body>
</section>
<section id="alsa-driver">
<title>Použití balíčku alsa-driver</title>
<body>

<p>
Rozhodli jste se pro&nbsp;cestu s&nbsp;ovladačem <c>alsa-driver</c>.
Je potřeba udělat ještě pár menších věcí k&nbsp;zajištění, že se zkompilují
jen ovladače, které potřebujeme. Přestože to není nutný krok, zbaví nás to
nepotřebných ovladačů, které by se jinak kompilovaly.
</p>

<p>
V případě, že nevíte jaké ovladače vaše karta potřebuje, podívejte se do
sekce <uri link="#lspci">lspci</uri>. Až budete mít jméno svého ovladače,
(v našem příkladě to je <c>emu10k1</c>), zeditujte <path>/etc/make.conf</path>
a přidejte proměnnou <c>ALSA_CARDS</c>.
</p>

<pre caption="Přidání ALSA_CARDS do make.conf">
<comment>(Pro jednu zvukovou kartu)</comment>
ALSA_CARDS="emu10k1"
<comment>(Pro větší množství oddělte jména mezerou)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Pokud máte zkompilovaný kernel a chcete používat <c>alsa-driver</c>,
zkontrolujte ješťě následující nastavení v
<path>/usr/src/linux/.config</path>:
</p>

<note>
Uživatelé <c>genkernel</c>u mohou pokračovat <uri
link="#doc_chap2_pre6">instalací alsa-driveru</uri>, neboť jejich konfigurace je
podle výchozího nastavení v&nbsp;pořádku.
</note>

<ol>
  <li>
  <c>CONFIG_SOUND</c> je nastaven. (Základní podpora zvuku)
  </li>
  <li>
  <c>CONFIG_SOUND_PRIME</c> není nastaven. (OSS je vypnutý)
  </li>
  <li>
  <c>CONFIG_SND</c> není nastaven. (ALSA není stavěna do&nbsp;kernelu)
  </li>
  <li>
  <path>/usr/src/linux</path> ukazuje na&nbsp;kernel pro&nbsp;který kompilujete ALSA.
  </li>
</ol>

<pre caption="Kontrola .config">
<comment>(Předpokládáme, že /usr/src/linux ukazuje na&nbsp;správný kernel)</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(1. platí)</comment>
CONFIG_SOUND=y
<comment>(2. platí)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(a 3. platí)</comment>
CONFIG_SND is not set
</pre>

<p>
Všechno co potřebujete do&nbsp;dalšího kroku je napsat pár magických slovíček
(a nemluvíme zde o výrazu "abrakadabra").
</p>

<pre caption="Instalace alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Zapamatujte si, že musíte spustit <c>emerge alsa-driver</c> po každé změně
nastavení kernelu nebo změně kernelu, protože předchozí ovladače jsou tím
smazány.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Nastavení a test ALSA</title>
<section id="alsa-utilities">
<title>Nástroje ALSA</title>
<body>

<p>
<c>alsa-utils</c> je nedílná součást ALSA a obsahuje hromadu
užitečných programů, včetně initskriptů pro&nbsp;ALSA. Pro normálního uživatele
je ALSA bez <c>alsa-utils</c> skoro nepoužitelná, proto instalaci vřele
doporučujeme.
</p>

<pre caption="Instalace alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Pokud máte ALSA vestavěnou přímo v kernelu, <e>a</e> nekompilovali ji jako
moduly, můžete pokračovat do&nbsp;sekce <uri link="#initscript">Initscripts pro
ALSA</uri>. Ostatní musí ještě nastavit ALSA, což je naštěstí jednoduché díky
nástroji <c>alsaconf</c> z&nbsp;balíčku <c>alsa-utils</c>.
</note>

</body>
</section>
<section id="Konfigurace ALSA">
<title>Konfigurace</title>
<body>

<note>
Průběh <c>alsaconf</c> nesmí být rušen, proto zavřete všechz programy které
by třeba jen <e>mohly</e> pracovat se zvukem.
</note>

<p>
Nejjednodušší cesta ke konfiguraci ALSA je spustit <c>alsaconf</c>. Prostě
jako root napište <c>alsaconf</c> do&nbsp;příkazové řádky.
</p>

<pre caption="Spuštění alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Můžete si prohlédnout rozhraní, které automaticky projde váš hardware
a zkusí v něm najít zvukovou kartu. Nechá vás vybrat si ji ze seznamu, pak
se zeptá na&nbsp;povolení ke změně <path>/etc/modules.d/alsa</path> (povolíme).
Dále nastaví hodnoty hlasitosti, spustí <c>modules-update</c> a nastartuje
službu <path>/etc/init.d/alsasound</path>. Až se <c>alsaconf</c> ukončí,
můžete pokračovat k&nbsp;nastavení ALSA initskriptů.
</p>

</body>
</section>
<section id="initscript">
<title>Initscripts pro&nbsp;ALSA</title>
<body>

<p>
V tomto okamžiku je už skoro všechno nastavené. Ať jste si ale vybrali jakoukoliv
metodu, potřebujete něco, co zajistí načtení modulů a načtení nastavení při&nbsp;bootování
systému. To je práce initskriptu se jménem <c>alsasound</c>. Přidejte ho do
runlevelu <c>boot</c>.
</p>

<pre caption="Přidání ALSA do runlevelu boot">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Ještě zkontrolujte soubor <path>/etc/conf.d/alsasound</path> a ujistěte se,
že proměnná SAVE_ON_STOP má hodnotu yes. To znamená, že vaše nastavení se
bude automaticky ukládat při&nbsp;vypínání systému.
</p>

</body>
</section>
<section>
<title>Skupina audio</title>
<body>

<p>
Ještě než se vrhneme do testování je <e>důležité</e> zmínit jednu věc — na
*nixových operačních systémech platí, že se pod rootem <e>nepracuje</e>. Jaký to
má vztah ke&nbsp;zvuku? Aby mohl normální uživetel, pod kterým běžně pracujete,
přehrávat hudbu a přistupovat ke&nbsp;zvukové kartě, musí být členem skupiny
"audio". Nyní tedy uživatele do této skupiny přidáme, aby mohli ke&nbsp;zvukovým
zařízením volně přistupovat. Použijeme příkaz <c>gpasswd</c> (je potřeba být
přihlášen jako root):
</p>

<pre caption="Přidání uživatelů do skupiny audio">
<comment>(Nahraďte &lt;uživatel&gt; odpovídajícím uživatelským jménem)</comment>
# <i>gpasswd -a &lt;uživatel&gt; audio </i>
Adding user &lt;uživatel&gt; to group audio
</pre>

</body>
</section>
<section>
<title>Hlasitost</title>
<body>

<p>
Máme za sebou všechno nastavování, takže můžeme nahodit ALSA. Pokud jste použili
<c>alsaconf</c> tak můžete přeskočit následující krok (protože <c>alsaconf</c>
ho udělal za vás).
</p>

<pre caption="Nastartování služby ALSA">
<comment>(ALSA jako moduly)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Loading: snd-card-0 ...        [ ok ]
 * Loading: snd-pcm-oss ...       [ ok ]
 * Loading: snd-seq ...           [ ok ]
 * Loading: snd-emu10k1-synth ... [ ok ]
 * Loading: snd-seq-midi ...      [ ok ]
 * Restoring Mixer Levels ...     [ ok ]
<comment>(ALSA v&nbsp;kernelu)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Restoring Mixer Levels ...     [ ok ]
</pre>

<p>
Teď potřebujeme zkontrolovat hlasitost, protože v určitých případech zůstane
nastavená jako "muted" (čili ztišená až na&nbsp;nulu). Pro tento účel máme <c>alsamixer</c>.
</p>

<pre caption="Nastartujeme alsamixer">
<comment>(Otevře program pro&nbsp;konzoli, ukazujeme zde pouze potřebné nastavení)</comment>
# <i>alsamixer</i>
</pre>

<impo>
Máte-li se spouštěním <c>alsamixer</c>u problémy a dostáváte chyby jako
alsamixer: function snd_ctl_open failed for default: No such file or directory,
je pravděpodobně chyba ve&nbsp;vytváření souborů zařízení přes udev. Pro nové
vytvoření souborů v&nbsp;<path>/dev</path> spusťte <c>killall udevd;
udevstart</c>, pravděpodobně to odstraní problémy.
</impo>

<p>
Takhle ALSA Mixer <e>může</e> vypadat po prvním spuštění. Všimněte si kanálů
Master a PCM a značky MM pod nimi. To znamená že jsou ztišeny (muted). V tomto
případě si s&nbsp;mixerem můžete hrát jak chcete ale nic neuslyšíte.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="AlsaMixer" caption="Hlavní okno AlsaMixeru"/>

<p>
Proto značku MM odstraníme a nastavíme potřebné hlasitosti.
</p>

<warn>
Pokud chcete vůbec něco slyšet, nesmí být ztišen <e>ani Master, ani PCM</e>.
</warn>

<ul>
  <li>
  Pro pohyb mezi kanály používáme šipky doprava a doleva. (&lt;-
  &amp; -&gt;)
  </li>
  <li>
  Pro zapnutí/vypnutí "muted" (ztišení) stiskněte na&nbsp;klávesnici <e>m</e>.
  </li>
  <li>
  Pro zvýšení a snížení hlasitosti použijte šipky nahoru a dolů.
  </li>
</ul>

<note>
Dávejte pozor při&nbsp;nastavováni hodnot Bass a Treble. Obyčejně je dobrá hodnota
50 pro&nbsp;oba. Vyšší hodnoty můžou způsobit chraptění reproduktorů, které pro
podobné zatížení nebyly navrženy.
</note>

<p>
Po tomto kroku by měl ALSA Mixer vypadat asi jako ten dole. Všimněte si značek
00 místo MM a nastavení hlasitostí.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="AlsaMixer je nastaven" caption="nastavený Alsa Mixer"/>

</body>
</section>
<section>
<title>1 - 2 - 3 - Zkouška!</title>
<body>

<p>
Rozčilující způsob, jak zkontrolovat, zda zvuková karta funguje, je kontrola,
zda slyšíte šum. Není to sice příliš zábavné, avšak ověříte, zda je karta
nastavená a funkční.
</p>

<pre caption="Ať šum zní...">
# <i>cat /dev/urandom > /dev/dsp</i>
</pre>

<note>
<path>/dev/dsp</path> je symbolický odkaz na <path>/dev/sound/dsp</path> a měl
by být automaticky vytvořen. Jestliže uvidíte hlášku "No such file or
directory", zkuste přesměrovat výstup do <path>/dev/sound/dsp</path>.
</note>

<p>
Měli byste slyšet praskání; stiskem <c>Ctrl + C</c> jej ukončíte. Neslyšíte-li
nic, je na čase se vrátit a vyřešit problém.
</p>

<p>
Konečně trochu muziky. Pokud všechno doteď šlo dobře, měl by váš systém být schopný
něco poslouchatelného přehrát. Nejsnažší cesta je použít nástroj jako
<c>media-sound/madplay</c> do&nbsp;příkazové řádky, případně známější, jako
například <c>mpg123</c> nebo <c>xmms</c>. Pokud patříte k&nbsp;fanouškům
vorbis oggů můžete použít <c>ogg123</c> z&nbsp;balíčku <c>media-sound/vorbis-tools</c>,
Použijte přehrávač, který vám vyhovuje. Jako vždy ale potřebujete emerge.
</p>

<pre caption="Instalace přehrávačů">
<comment>(Nainstalovat si můžete který chcete)</comment>
# <i>emerge madplay mpg123 xmms</i>
<comment>(k přehrávání souborů .ogg)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
Pak si pustíme náš nejoblíbenější song....
</p>

<pre caption="Přehrávání hudby">
# <i>madplay -v /mnt/shyam/Music/Paul\ Oakenfold\ -\ Dread\ Rock.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Dread Rock
         Artist: Paul Oakenfold
          Album: Matrix Reloaded
           Year: 2003
          Genre: Soundtrack
                 Soundtrack
 00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 Paul\ Oakenfold\ -\ Dread\ Rock.ogg</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Paul Oakenfold - Dread Rock.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Soundtrack
Transcoded: mp3;160
Title: Dread Rock
Artist: Paul Oakenfold
Date: 2003
Album: Matrix Reloaded
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>

</body>
</section>
<section>
<title>ALSA a USE</title>
<body>

<p>
Nyní můžete do <path>/etc/make.conf</path> přidat USE proměnnou <c>alsa</c>,
abyste zajistili, že aplikace budou kompilovány s&nbsp;její podporou. Některé
architektury, jako například x86 a amd64, mají tuto volbu aktivní
ve&nbsp;výchozím nastavení.
</p>

</body>
</section>
<section>
<title>Problémy?</title>
<body>

<p>
Pokud z&nbsp;nějakého důvodu nic neslyšíte, jako první zkontrolujte
<uri link="#doc_chap3_pre6">alsamixer</uri>. 80% takových problémů je pohřbeno
pod ztišenými kanály nebo nízkou hlasitostí. Taky zkontrolujte zvukový applet
svého Windowmanageru a jeho nastavení hlasitostí.
</p>

<p>
<path>/proc</path> je váš přítel. V našem případě, <path>/proc/asound</path>
je váš nejlepší přítel. Měli bysme se podívat na&nbsp;všechno použitelné, co se
odtud můžeme dozvědět.
</p>

<pre caption="Průzkum /proc/asound">
<comment>(Především, /proc/asound/cards musí ukazovat vaši kartu.)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Pokud máte kernelovou ALSA, možná byste chtěli vědět o kolik verzí jste
pozadu za nejnovějším alsa-driverem.)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(detaily ALSA OSS emulace)</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
Další častou chybou je obávané "Unknown symbol in module" (nenzámý symbol
v&nbsp;modulu); příklad následuje.
</p>

<pre caption="Chyba Unknown Symbol in module">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
Podíváte-li se podle doporučení na <c>dmesg</c>, uvidíte něco podobného:
</p>

<pre caption="dmesg output">
<comment>(uvedeny jsou pouze relevantní části)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) -> IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
Tento problém je způsoben přechodem z&nbsp;balíčku <c>alsa-driver</c> na ALSU
z&nbsp;kernelu, protože při odinstalaci <c>alsa-driver</c> jsou zkompilované
moduly umístěny v&nbsp;adresáři, který je chráněn (config protect) a proto
nejsou odstraněny. Po přechodu se tak <c>modprobe</c> snaží zavést směs modulů
jak z&nbsp;jádra, tak z&nbsp;balíčku <c>alsa-driver</c>.
</p>

<p>
Řešní je poměrně jednoduché - stačí pouze po odinstalaci balíčku
<c>alsa-driver</c> ručně smazat problémový adresář. Ujistěte se, že mažete
správné soubory (ne aktuální jádro!).
</p>

<pre caption="Odstranění modulů alsa-driver">
<comment>(nahraďte KERNELVER verzí svého jádra)</comment>
# <i>rm -rf /lib/modules/KERNELVER/alsa-driver</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Ostatní</title>
<section>
<title>Podpora MIDI</title>
<body>

<p>
V případě, že máte kartu s&nbsp;MIDI syntetizérem a chtěli byste ji slyšet
přehrávat .mid soubory, musíte nainstalovat <c>awesfx</c>, balíček utilit pro
ovládání AWE32. Pokud nemáte hardwarový syntetizér, můžete použít virtuální.
Více informací o virtuálím syntetizéru najdete v sekci <uri link="#vsynth">
Virtuální Syntetizéry</uri>.
</p>

<pre caption="Instalace awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Budete taky pravděpodobně potřebovat soubor SoundFont (SF2) z&nbsp;vašeho CD od zvukové
karty nebo např. z&nbsp;instalace Windows. Ten se umisťuje do
<path>/usr/share/sounds/sf2/</path>. Například SF2 soubor od Creative SBLive!
se jmenuje 8MBGMSFX.SF2.
</note>

<p>
Po zkopírování souboru SoundFont můžeme přehrát MIDI podle příkladu dole.
Ještě je dobré přidat příkaz <c>asfxload</c> do&nbsp;skriptu
<path>/etc/conf.d/local.start</path>, aby se SoundFont načetl při&nbsp;každém
spuštění systému.
</p>

<note>
Cesty k&nbsp;souborům v následujícím výpisu budou na&nbsp;vašem stroji vypadat <e>jinak</e>.
Tohle je jen příklad, proto ho změňte podle své konfigurace.
</note>

<pre caption="Načítání Soundfontů">
<comment>(Nejdříve zkopírujeme SoundFont)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(případně ze SoundBlaster CD)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(a potom ho načteme)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Teď můžeme přehrávat .mid soubory pomocí programu jako je například
<c>aplaymidi</c>. Spusťte <c>aplaymidi -l</c> pro&nbsp;zjištění dostupných portů
a vyberte si jeden na&nbsp;kterém budete přehrávat.
</p>

<pre caption="Přehrávání MIDI">
<comment>(Výpis otevřených MIDI portů)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Vybereme si port a přehrajeme na&nbsp;něm .mid)</comment>
# <i> aplaymidi --port=65:0 /mnt/shyam/music/midi/mi2.mid</i>
</pre>

</body>
</section>
<section id="vsynth">
<title>Virtuální Syntetizéry</title>
<body>

<p>
V případě, že na&nbsp;vaší kartě chybí hardwarový syntetizér, můžete použít virtuální,
jako například <c>timidity++</c>. Instalace je prostá...
</p>

<pre caption="Instalace timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Aby timidity hrála, potřebuje SoundFont. Pokud žádný nemáte, můžete nainstalovat
<c>timidity-eawpatches</c> nebo <c>timidity-shompatches</c>, to vám dá k&nbsp;dispozici
několik SoundFontů. Ty se ukládají do&nbsp;adresáře <path>/usr/share/timidity/</path>
a každý jich může mít prakticky libovolné množství. Pro Procházení různých nastavení
používejte <c>timidity-update</c> z&nbsp;balíčku timidity++.
</p>

<pre caption="Instalace SoundFontů">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(nebo)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Nezapomeňte přidat <c>timidity</c> do&nbsp;vašeho default runlevelu.
</p>

<pre caption="Přidání timidity do default">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Teď si konečně můžete vyzkoušet <uri link="#doc_chap4_pre3">Přehrávání MIDI</uri> souborů.
</p>

</body>
</section>
<section>
<title>Nástroje a Firmware</title>
<body>

<p>
Některým zvukovým kartám můžete povolit další funkce za pomoci
balíčků <c>alsa-tools</c> a <c>alsa-firmware</c>. Pokud používáte
<c>alsa-tools</c>, nastavte do&nbsp;proměnné ALSA_TOOLS v souboru
<path>/etc/make.conf</path> všechny nástroje, které potřebujete.
</p>

<pre caption="Výběr nástrojů ALSA v /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Pokud ALSA_TOOLS nenastavíte, zkompilují se všechny dostupné nástroje.
Zbývá nainstalovat <c>alsa-tools</c> (nebo případně i <c>alsa-firmware</c>):
</p>

<pre caption="Instalace ALSA Tools">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Poděkování...</title>
<body>

<p>
Děkujeme všem, kteří přispěli do&nbsp;alsa-guide nebo ho pomohli opravit:
Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy Huddleston,
John P. Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft and Erwin.
</p>

</body>
</section>
<section>
<title>Odkazy</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">The ALSA Project</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
