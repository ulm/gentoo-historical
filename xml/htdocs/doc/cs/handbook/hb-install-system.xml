<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/cs/handbook/hb-install-system.xml,v 1.5 2005/04/07 22:07:54 neysx Exp $ -->

<sections>

<version>2.3</version>
<date>2005-04-07</date>

<section>
<title>Chroot</title>
<subsection>
<title>Volitelně: volba mirrorů</title>
<body>

<p>
Abyste mohli stáhnout potřebné archivy zdrojových kódů co nejrychleji, je
doporučeno nastavit používání blízkého mirroru (zrcadla, serveru obsahujícího
potřebné soubory). Portage zjišťuje použité mirrory podle proměnné
GENTOO_MIRRORS v&nbsp;souboru <path>make.conf</path>. Nejbližší (a tudíž
zpravidla i ten nejrychlejší) mirror si můžete vybrat z&nbsp;našeho <uri
link="/main/en/mirrors.xml">seznamu</uri> a nebo můžete využít nástroj
<c>mirrorselect</c>, který Vám výběr usnadní hezkým rozhraním.
</p>

<pre caption="Použítí mirrorselect pro nastavení proměnné GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Nevybírejte žádná IPv6 zrcadla - naše stage soubory je v&nbsp;současné době
neumožňují použít.
</warn>

<p>
Druhé důležité nastavení je proměnná SYNC, opět v&nbsp;souboru
<path>make.conf</path>. Obsahuje jméno rsync serveru, který chcete používat pro
synchronizaci svého Portage stromu (sbírky souborů ebuild, skriptů
obsahujících vše, co Portage potřebuje pro stažení a instalaci softwaru). I
když můžete nastavit proměnnou RSYNC ručně (pro použití v&nbsp;České republice
je doporučená hodnota <c>rsync://rsync.europe.gentoo.org/gentoo-portage</c>),
<c>mirrorselect</c> Vám může ulehčit práci:
</p>

<pre caption="Výběr rsync mirroru pomocí mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Po použití nástroje <c>mirrorselect</c> je doporučeno překontrolovat
nastavení v&nbsp;souboru <path>/mnt/gentoo/etc/make.conf</path>!
</p>

</body>
</subsection>
<subsection>
<title>Kopírování nastavení DNS</title>
<body>

<p>
Ještě je potřeba zkopírovat nastavení DNS z&nbsp;instalačního CD do nového
systému, aby síť správně pracovala i nadále. Tyto informace jsou uloženy
v&nbsp;souboru <path>/etc/resolv.conf</path>.
</p>

<pre caption="Kopírování informací o DNS">
<comment>(Paramter "-L" je potřeba k&nbsp;tomu, abychom nekopírovali případný symbolický odkaz)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Připojení souborového systému proc</title>
<body>

<p>
Připojte souborový systém <path>/proc</path> do <path>/mnt/gentoo/proc</path>,
aby i instalace v&nbsp;novém prostředí mohla využívat informace poskytované
jádrem:
</p>

<pre caption="Připojení /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Vstup do nového prostředí</title>
<body>

<p>
Nyní jsou všechny diskové oddíly inicializovány a základní prostředí připraveno,
můžeme do něj tedy vstoupit. Použijeme k&nbsp;tomu <e>chroot</e>, proces je
proto také nazýván <e>chrooting</e>. Aktivní prostředí se změní
z&nbsp;instalačního média (například z&nbsp;instalačního CD) do nově
instalovaného systému (do nového prostředí).
</p>

<p>
Chroot je tvořen třemi kroky. Nejprve změníme aktuální root
z&nbsp;<path>/</path> (na instalačním médiu) na <path>/mnt/gentoo</path> (na
nově inicializovaných oddílech), poté vytvoříme nové prostředí pomocí
<c>env-update</c> (vytvoření proměnných prostředí) a nakonec tyto proměnné
načteme do paměti přes <c>source</c>.
</p>

<pre caption = "Chroot do nového prostředí">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Gratulujeme! Nyní jste uvnitř svého nového Gentoo Linuxu. Samozřejmě ještě
zdaleka nejste hotovi, proto Vám ostatně také ještě zbývá pár kapitol :-)
</p>

</body>
</subsection>
<subsection>
<title>Aktualizace stromu Portage</title>
<body>

<p>
Nyní byste měli aktualizovat svůj Portage strom na nejnovější verzi. <c>emerge
--sync</c> to zařídí:
</p>

<pre caption="Aktualizace stromu Portage">
# <i>emerge --sync</i>
</pre>

<p>
Blokuje-li Váš firewall protokol rsync, můžete použít <c>emerge-webrsync</c>,
který stáhne a nainstaluje aktualizovaný strom Portage jinou metodou.
</p>

<p>
Pokud dostanete varování, že je k&nbsp;dispozici nová verze Portage a že byste
jej měli zaktualizovat, ignorujte to prosím. Portage bude zaktualizováno
později v&nbsp;průběhu instalace.
</p>

</body>
</subsection>
<subsection>
<title>Výběr správného profilu</title>
<body>

<p>
Nejprve si vysvětlíme, co profil znamená.
</p>

<p>
Profil je základ každého Gentoo systému. Nejen, že specifikuje výchozí hodnoty
CHOST, CFLAGS a jiných důležitých proměnných, ale zároveň nastavuje, jaké verze
balíčků bude systém používat. Toto vše udržují vývojáři Gentoo.
</p>

<p>
Dříve nebyly profily téměř vůbec ovlivňovány uživateli, v&nbsp;poslední době se
však na architekturách x86, hppa a alpha objevila potřeba udržovat profily dva,
jeden pro jádra řady 2.4 a druhý pro řadu 2.6. Bez dvou profilů by se integrace
jader řady 2.6 zkomplikovala.
</p>

<p>
Zjistit, jaký profil právě používáte, můžete tímto příkazem:
</p>

<pre caption="Ověření systémového profilu">
# <i>ls -l /etc/make.profile</i>
lrwxrwxrwx  1 root root 48 Mar  7 11:55 /etc/make.profile ->
      ../usr/portage/profiles/default-linux/x86/2005.0
</pre>

<p>
Používáte-li jednu z&nbsp;výše zmíněných architektur, uvidíte další profil pod
symbolickým odkazem <path>make.profile</path>:
</p>

<pre caption="Zjištění, zda další profil existuje">
# <i>ls -F /etc/make.profile/</i>
2.4/  packages  parent  virtuals
</pre>

<p>
Jak vidíte, ve&nbsp;výše zmíněném profilu je podadresář 2.4. To znamená, že
aktuální profil používá jádro řady 2.6 a pokud chcete systém založený na 2.4,
budete muset provést úpravu odkazu <path>make.profile</path>:
</p>

<pre caption="Úprava odkazu na profil">
# <i>ln -snf /usr/portage/profiles/default-linux/x86/2005.0/2.4 /etc/make.profile</i>
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Nastavení USE proměnných</title>
<body>

<p>
<c>USE</c> je jedna z&nbsp;nejmocnějších proměnných, které Gentoo nabízí.
Programy mohou být zkompilovány s&nbsp;podporou různých rozšíření, například
GTK nebo QT, jiné s&nbsp;a nebo bez podpory SSL, některé s&nbsp;podporou
framebufferu (svgalib) namísto X11 (X-serveru).
</p>

<p>
Většina distribucí kompiluje balíčky s&nbsp;podporou co nejvíce věcí, což
způsobuje značnou velikost programů a delší čas spouštění, o ohromném množství
závislostí ani nemluvě. Proto jsme zavedli <c>USE</c>.
</p>

<p>
Pomocí proměnné <c>USE</c> definujete klíčová slova, která jsou promítnuta do
voleb pro kompilaci. Například <e>ssl</e> aktivuje podporu SSL
v&nbsp;programech, které ji mohou využít. Nastavení <e>gnome gtk -kde -qt</e>
zkompiluje Vaše programy s&nbsp;podporou GTK a GNOME a bez KDE a QT, takže bude
Váš systém vyladěn pro GNOME.
</p>

<p>
Výchozí hodnoty <c>USE</c> jsou umístěny v&nbsp;souboru
<path>make.defaults</path> Vašeho profilu. Tento soubor najdete v&nbsp;adresáři,
kam ukazuje <path>/etc/make.profile</path>, a v jeho nadřazených adresářích.
Výchozí nastavení <c>USE</c> jsou výsledkem kombinace všech souborů
<path>make.defaults</path>. To, co umístíte do svého
<path>/etc/make.conf</path>, je zpracováváno po výchozích nastaveních - pokud
něco přidáte, přidá se to i do výsledku, pokud něco uberete (provádí se
to znaménkem mínus před konkrétní USE volbou), bude daná možnost ze&nbsp;seznamu
USE proměnných odstraněna, pokud v&nbsp;nich vůbec byla. <e>Nikdy</e> neměňte
nic uvnitř&nbsp;adresáře <path>/etc/make.profile</path>, tato nastavení by byla
ztracena při aktualizaci Portage!
</p>

<p>
Celkový popis USE proměnných můžete nalézt ve druhé části Gentoo Handbooku, <uri
link="?part=2&amp;chap=2">USE proměnné</uri>. Ve Vašem systému je popis uložen
v&nbsp;souboru <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Zobrazení dostupných USE proměnných">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Můžete se posouvat pomocí kláves se&nbsp;šipkami, ukončíte stiskuntím "q")</comment>
</pre>

<p>
Jako příklad si uvedeme nastavení <c>USE</c> pro systém založený na KDE
s&nbsp;podporou DVD, ALSA a vytváření CD:
</p>

<pre caption="Otevření /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Nastavení USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Volitelně: lokalizační nastavení GLIBC</title>
<body>

<p>
Pravděpodobně budete používat pouze jedno či dvě lokalizační nastavení
(locales). Až do teď se po kompilaci <c>glibc</c> generovala všechna dostupná,
nyní však můžete aktivovat USE proměnnou <c>userlocales</c> a
v&nbsp;<path>/etc/locales.build</path> určit jenom ta, která chcete. Učiňte tak
však pouze tehdy, víte-li, která nastavení chcete použít. Tato volba neovlivní
bootstrap, pouze další rekompilace glibc.
</p>

<pre caption="Aktivace USE proměnné userlocales USE speciálně pro glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Nyní určete ta lokalizační nastavení, která chcete použít:
</p>

<pre caption="Otevření /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Následující nastavení jsou příkladem, jak povolit angličtinu (Spojené Státy) a
češtinu (Česká republika) s&nbsp;odpovídajícími kódováními (například UTF-8):
</p>

<pre caption="Určení locales">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
cs_CZ/ISO-8859-2
cs_CZ.UTF-8/UTF-8
</pre>

</body>
</subsection>
</section>
<section>
<title>Rozdíly mezi stage1, stage2 a stage3</title>
<body>

<p>
Nyní se v&nbsp;klidu rozmyslete nad použitým stage. Řekli jsme Vám, že si máte
vybrat jednu ze <e>stage1</e>, <e>stage2</e> nebo <e>stage3</e>, a varovali jsme
Vás, že je tento výběr důležitý pro další průběh instalace. Toto je první
případ, kdy se Vaše rozhodnutí promítne do dalšího postupu.
</p>

<ul>
<li>
  vyberete-li si <e>stage1</e>, musíte provést <e>oba dva</e> kroky z&nbsp;této
  kapitoly počínaje <uri link="#doc_chap3">postupem ze&nbsp;stage1 do
  stage2</uri>
</li>
<li>
  vyberete-li si <e>stage2</e>, můžete přeskočit první krok a ihned začít
  s&nbsp;krokem druhým (<uri link="#doc_chap4">postup ze&nbsp;stage2 do
  stage3</uri>)
</li>
<li>
  vyberete-li si <e>stage3</e>, můžete přeskočit oba kroky a pokračovat <uri
  link="?part=1&amp;chap=7">konfigurací jádra</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Postup ze&nbsp;stage1 do stage2</title>
<subsection>
<title>Úvod do procesu bootstrapu</title>
<body>

<p>
Takže chcete kompilovat vše od nuly? Nuž dobrá :-)
</p>

<p>
V&nbsp;tomto kroku provedeme <e>bootstrap</e> Vašeho systému Gentoo. Potrvá to
poměrně dlouho, ale výsledkem je systém od základů optimalizovaný pro Vaše
potřeby a Váš hardware.
</p>

<p>
<e>Bootstrapping</e> znamená sestavení GNU C knihovny, GNU kompilátoru a pár
dalších klíčových systémových programů.
</p>

<p>
Před samotným startem bootstrapu možná budete chtít stáhnout všechny potřebné
zdrojové kódy. Pokud ne, můžete pokračovat <uri link="#bootstrap">bootstrapem
systému</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Volitelně: stažení zdrojových kódů</title>
<body>

<p>
Nemáte-li k&nbsp;dispozici všechny potřebné zdrojové kódy, bootstrapovací
skript je za Vás stáhne. Chcete-li je stáhnout dopředu a ne až během samotného
procesu (například proto, že nechcete být neustále připojeni k&nbsp;Internetu),
předejte skriptu parametr <e>-f</e>, který stáhne (anglicky <e>fetch</e>, proto
písmeno  <e>f</e>) všechny potřebné zdrojové kódy najednou.
</p>

<pre caption = "Stažení potřebných zdrojovýck kódů">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Bootstrap systému</title>
<body>

<p>
Zadáním následujících příkazů začne bootstrap systému. Běžte se zatím bavit
něčím jiným, protože tento proces bude nějakou dobu trvat.
</p>

<pre caption = "Bootstrap systému">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Nyní pokračujte dalším krokem, <uri link="#doc_chap4">postupem ze&nbsp;stage2 do
stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Postup ze&nbsp;stage2 do stage3</title>
<subsection>
<title>Úvod</title>
<body>

<p>
Čtete-li tuto sekci, máte bootstrapovaný systém - buď jste to provedli sami a
nebo používáte <e>stage2</e>. Je tedy čas sestavit všechny systémové balíčky.
</p>

<p>
<e>Všechny</e> systémové balíčky? Ne tak docela. V&nbsp;tomto kroku sestavíte
pouze ty, ke kterým nejsou žádné možné alternativy. Implementaci některých
nástrojů si můžete zvolit z&nbsp;několika možných variant (například systémový
logger), a protože principem Gentoo je volba, nechceme Vás do&nbsp;ničeho
tlačit.
</p>

</body>
</subsection>
<subsection>
<title>Volitelně: zobrazení toho, co se bude dít</title>
<body>

<p>
Pokud chcete vědět, které balíčky budou nainstalovány, spusťte <c>emerge
--pretend --emptytree system</c>, což zobrazí seznam všech balíčků, které budou
sestaveny. Protože je tento seznam poměrně dlouhý, asi budete chtít k&nbsp;jeho
zobrazení použít pager jako <c>less</c> či <c>more</c>, abyste se v&nbsp;něm
mohli pohybovat vpřed a vzad.
</p>

<pre caption = "Zobrazení, co se `emerge system` chystá udělat">
# <i>emerge --pretend --emptytree system | less</i>
</pre>

<p>
Pokud jste nezměnili výchozí nastavení CFLAGS/CXXFLAGS, stačí použít <c>emerge
--pretend --newuse system</c>. Pokud jste navíc nezměnili ani nastavení USE
proměnných, proč instalujete ze&nbsp;stage2?
</p>

</body>
</subsection>
<subsection>
<title>Volitelně: stažení zdrojových kódů</title>
<body>

<p>
Pokud chcete, aby <c>emerge</c> stáhlo všechny potřebné zdrojové kódy před
samotným pokračováním (třeba proto, aby nemuselo být připojení k&nbsp;Internetu
dostupné po celou dobu kompilace balíčků), můžete mu předat parametr
<e>--fetchonly</e>, který způsobí stažení všech potřebných souborů bez samotné
kompilace.
</p>

<pre caption = "Stažení zdrojových kódů">
# <i>emerge --fetchonly --emptytree system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Sestavení systému</title>
<body>

<p>
Aby začala kompilace balíčků, spusťte <c>emerge system</c>. Zatím se jděte
zabývat něčím jiným, protože instalace zabere poměrně dlouhou dobu.
</p>

<pre caption = "Sestavení systému">
# <i>emerge system</i>
</pre>

<p>
Opět platí, že pokud jste nezměnili výchozí nastavení proměnných CFLAGS a
CXXFLAGS, stačí použít <c>--newuse</c>.
</p>

<p>
Zatím můžete klidně ignorovat jakákoli varování o aktualizovaných
konfiguračních souborech či spouštění <c>etc-update</c>. Až bude Váš systém
Gentoo zcela nainstalován a nabootován, přečtěte si dokumentaci o&nbsp;<uri
link="?part=3&amp;chap=2#doc_chap3">ochraně konfiguračních souborů</uri>.
</p>

<p>
Až proces kompilace a instalace skončí, pokračujte <uri
link="?part=1&amp;chap=7">konfigurací jádra</uri>.
</p>

</body>
</subsection>
</section>

</sections>
