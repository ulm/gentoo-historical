<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/nl/power-management-guide.xml,v 1.3 2012/04/18 18:30:30 swift Exp $ -->
<guide lang="nl">
<title>EnergieBeheer Gids</title>

<author title="Auteur">
  <mail link="earthwings@gentoo.org">Dennis Nienhüser</mail>
</author>
<author title="Redacteur">
  <mail link="chriswhite@gentoo.org">Chris White</mail>
</author>
<author title="Vertaler">
  <mail link="diox@gentoo.org">Dimitry Bradt</mail>
</author>
<author title="Vertaler">
  <mail link="thomaswouters@telenet.be">Thomas Wouters</mail>
</author>

<abstract>
Energiebeheer is de sleutel tot het uitbreiden van de werktijd van batterijen op
mobiele systemen, zoals laptops. Deze gids helpt je om je laptop in te stellen.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.28</version>
<date>2006-07-26</date>

<chapter>
<title>Inleiding</title>
<section>
<body>

<p>
De capaciteit en de levenstijd van laptop batterijen zijn veel verbeterd in de
laatste jaren. Niettemin verbruiken de moderne processoren veel meer energie
dan oudere modellen en elke laptop generatie introduceert meer apparaten die
energie-hongerig zijn. Daarom is energiebeheer belangrijker dan ooit. Het
verhogen van de werktijd van de batterij betekend niet noodzakelijk een andere
batterij kopen. Veel kan worden bereikt met intelligente energiebeheer-beleid
toe te passen.
</p>

</body>
</section>
<section>
<title>Een snel overzicht</title>
<body>

<p>
Merk op dat deze gids het energiebeheer voor <e>laptops</e> beschrijft. Terwijl
sommige secties ook voor <e>servers</e> zouden kunnen geschikt zijn, anderen
zijn het niet en kunnen zelfs kwaad veroorzaken. Gelieve op te passen met het
toepassen van om het even wat van deze gids op een server tenzij u werkelijk
weet wat u doet.
</p>

<p>
Aangezien deze gids vrij lang is geworden, vindt u hier een kort overzicht dat
u kan helpen om uw weg door deze gids te vinden.
</p>

<p>
Het <uri link="#doc_chap2">Eerste Vereisten</uri> hoofdstuk praat over sommige
vereisten aan die moeten worden voldaan vóóraleer het volgen van enige
hoofdstukken van deze gids. Dit omvat BIOS montages, pitconfiguratie en sommige
vereenvoudigingen in gebruikersland. De volgende drie hoofdstukken concentreren
zich op apparaten die typisch de meeste energie verbruiken namelijk: processor,
beeld en harde schijf. Elk kan van elkaar geconfigureerd worden. <uri
link="#doc_chap3">CPU EnergieBeheer</uri> toont hoe men de frequentie van de
processor kan aan passen om een maximum van energie te besparen zonder teveel
prestaties te verliezen. Een paar verschillende trucs verhinderen
uw harde schijf onnodig te werken in <uri link="#doc_chap5">Harde Schijf
Energie Beheer</uri> (die ook een dalend lawaainiveau als aardige bijwerking
heeft). Sommige nota's over grafische kaarten, Draadloze LAN en USB beëindigen
de apparatensectie in <uri link="#doc_chap6">Energie Beheer voor Andere
Apparaten</uri> terwijl een ander hoofdstuk tegewijd is aan (eerder
experimenteel) <uri link="#doc_chap7">slaap status</uri>. En als allerlaatste
hebben wij een lijst uri <uri link="#doc_chap8">Probleemoplossing</uri> van
gemeenschappelijke problemen.
</p>

</body>
</section>
<section>
<title>Energie-budget voor elke component</title>
<body>

<figure link="/images/energy-budget.png" short="Welke componenten verbruiken
het meetste energie?" caption="Energie-budget voor elke component"/>

<p>
Bijna elk component kan fungeren in verschillende statussen - uit, slaap,
ruststand, actief om enkelen te noemen die - een verschillende hoeveelheid
energie verbruiken. De belangrijke delen worden verbruikt door het LCD scherm,
processor, chipset en de harde aandrijving. Vaak kan het OS-onafhankelijke
energiebeheer in BIOS activeerd worden, maar een intelligente opstelling in het
werkende systeem dat aan verschillende situaties aanpast kan veel meer
bereiken.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Benodigdheden</title>
<section>
<body>

<p>
Vooraleer je discussieert over de details van het bewust laten worden van
energiebeheer van de individuele toestellen moet je zorgen dat bepaalde
vereisten ingevuld zijn. Na het controleren BIOS instellingen, worden sommige
kernel opties best inschakeld - (ACPI),  slaapstand en de processorsnelheid
schalen. Aangezien de  energiebesparing meestal samen met prestatiesverlies
gepaard gaat, zou het slechts moeten worden toegelaten wanneer het loopt op
batterijen. Dat waar een nieuwe opstartlevel <e>batterij</e> handig kan zijn.
Voor we de details van elke apparaat-energiebeheer individueel bespreken,
controleren we best of alle benodigdheden er zijn. Na controleren van de BIOS
instellingen, hoeven enkele kernel-opties ingeschakelt te worden (acpi),
slaapstand en de callibratie van de processorkloksnelheid. Omdat energie
besparen ook gepaard gaat met prestatie-verlies of vertraagde reactietijd, het
zou alleen mogen aanstaan als het op batterijen werkt. Hier is een nieuw
opstartlevel <e>batterij</e> handig.
</p>

</body>
</section>
<section>
<title>Het BIOS Deel</title>
<body>

<p>
Laten we eerst es kijen in je BIOS energiebeheer instellingen. De beste manier
is om het BIOS- en besturingsysteem-beleid te combineren, maar op het moment is
het beter om het meeste van de BIOS uit te schakelen. Controleer als dit niet
mengt met je beleid. Vergeet niet om iedere BIOS instelling die je hebt
ingesteld te hercontroleren nadat je alles hebt ingesteld.
</p>
</body>
</section>
<section>
<title>Instellen van de USE Flags</title>
<body>

<p>
Controleer dat de <c>acpi</c> USE flag is ingesteld in
<path>/etc/make.conf</path>. Andere interresante USE flags kunnen <c>apm</c>,
<c>lm_sensors</c>, <c>nforce2</c>, <c>nvidia</c>, <c>pmu</c> zijn. Zie
<path>/usr/portage/profiles/use*.desc</path> voor details. Als je vergeten bent
om een van deze flags in te stellen, hercompileer dan de paketten met de
<c>--newuse</c> optie in <c>emerge</c>, zie <c>man emerge</c>.
</p>

</body>
</section>
<section>
<title>Instellen van de Kernel</title>
<body>

<p>
ACPI (Advanced Configuration and Power Interface) ondersteuning in de kernel is
nog altijd onder constructie. Een recente kernel gebruiken zal helpen om het
meeste eruit te halen.
</p>

<p>
Er zijn verschillende kernel bronnen in de Portage. Ik raad
<c>gentoo-sources</c> of <c>suspend2-sources</c>. De laatste bevat aanpassingen
voor <e>Software Suspend 2</e>, zie het hoofdstuk over <uri
link="#doc_chap7">slaap status</uri> voor meer details. Tijdens het instellen
van de kernel, activeer je best deze opties:
</p>

<pre caption="Minimum kernel opstelling voor Energiebeheer (Kernel 2.6)">
Power Management Options ---&gt;
  [*] Power Management Support
  [ ] Software Suspend

  ACPI( Advanced Configuration and Power Interface ) Support ---&gt;
    [*] ACPI Support
    [ ]   Sleep States
    [ ]     /proc/acpi/sleep (deprecated)
    [*]   AC Adapter
    [*]   Battery
    &lt;M&gt;   Button
    &lt;M&gt;   Video
    [ ]   Generic Hotkey
    &lt;M&gt;   Fan
    &lt;M&gt;   Processor
    &lt;M&gt;     Thermal Zone
    &lt; &gt;   ASUS/Medion Laptop Extras
    &lt; &gt;   IBM ThinkPad Laptop Extras
    &lt; &gt;   Toshiba Laptop Extras
    (0)   Disable ACPI for systems before Jan 1st this year
    [ ]   Debug Statements
    [*]   Power Management Timer Support
    &lt; &gt;   ACPI0004,PNP0A05 and PNP0A06 Container Driver (EXPERIMENTAL)

  CPU Frequency Scaling ---&gt;
    [*] CPU Frequency scaling
    [ ]   Enable CPUfreq debugging
    &lt; &gt;   CPU frequency translation statistics
    [ ]     CPU frequency translation statistics details
          Default CPUFreq governor (userspace)
    &lt;*&gt;   'performance' governor
    &lt;*&gt;   'powersave' governor
    &lt;*&gt;   'ondemand' cpufreq policy governor
    &lt;*&gt;   'conservative' cpufreq governor
    &lt;*&gt;   CPU frequency table helpers
    &lt;M&gt; ACPI Processor P-States driver
    &lt;*&gt; <i>CPUFreq driver for your processor</i>
</pre>

<p>
Beslis zelf als je Software Suspend en slaapstatus wil inschakelen (zie
hieronder). Als jee een ASUS, Medion, IBM Thinkpad of Toshiba laptop hebt,
schakel dan de aangewezen opties.
</p>

<p>
De kernel heeft de kennis om de callibratie van de processorkloksnelheid in te
schakelen. Omdat elk type CPU een andere interface heeft, moet je de correcte
driver voor je processor kiezen. Opgepast hier - bij het inschakelen van de
<c>Intel Pentium 4 clock modulation</c> driver op een op een Pentium M systeem
zal leiden tot vreemde resultaten. Raadpleeg de kernel documentatie als je neit
zeker weet welke je hoeft te nemen.
</p>

<p>
Compileer je kernel, controleer dat de juiste modules geladen worden als uw pc
opstart en herstart je pc op in je nieuwe ACPI-ingeschakelde kernel. Start
vervolgens <c>emerge sys-power/acpid</c> om de acpi daemon. Deze informeerd je
over evenementen zoals het omschakelen van AC naar batterij of het sluiten van
de laptop. controleer dat de modules geladen worden als je ze niet hebt
ingebakken in de kernel en start acpid door <c>/etc/init.d/acpid start</c> uit
te voeren. voer <c>rc-update add acpid default</c> uit om acpid te laden als de
pc start. Je zult binnenkort zien hoe je het kunt gebruiken.
</p>

<pre caption="Installeren van acpid">
# <i>emerge sys-power/acpid</i>
# <i>/etc/init.d/acpid start</i>
# <i>rc-update add acpid default</i>
</pre>

</body>
</section>
<section>
<title>Creëren van het "battery" opstartlevel</title>
<body>

<p>
Het standaard beleid zal enkel Energiebeheer in te schakelen als men het nodig
heeft - op batterijspanning dus. Om de omschakeling tussen AC en batterijen
gemakkelijk te maken, creëer een opstartlevel <c>battery</c> die alle start en
stop scripts voor Energiebeheer bevat.
</p>

<note>
Je kan deze stap gemakkelijk overslaan als je het idee van een extra
opstartlevel niet goed vind. Hoewel, dit het moeilijk zal maken om deze gids
verder te kunnen volgen aangezien er verondersteld wordt dat er zo'n
osptartlevel aanwezig is.
</note>

<pre caption="Creeren van een battery opstartlevel">
# <i>cd /etc/runlevels</i>
# <i>cp -a default battery</i>
</pre>

<p>
Voila. Het nieuwe opstartlevel <c>battery</c> bevat alles zoal het standaard
(<c>default</c>), maar er is nog geen automatische overgang tussen de twee.
Tijd om dit te veranderen.
</p>

</body>
</section>
<section>
<title>Reageren op ACPI Gebeurtenis</title>
<body>

<p>
Typische ACPI gebeurtenissen zijn het sluiten van het laptopscherm, veranderen
van stroombron, of het induwen van de slaap-toets. Een belangrijke gebeurtenis
is het veranderen van de stroombron, die een opstartlevel verandering zou
moeten teweeg brengen. Een kleine script zal hiervoor zorgen.
</p>

<p>
Eerst heb je een script nodig die het opstartlevel van <c>default</c> naar
<c>battery</c> (en visa versa) veranderd naar gelang de stroombron. Het script
maakt gebruik van het <c>on_ac_power</c> commando van
<c>sys-power/powermgmt-base</c> - Controleer dat dit pakket is geinstalleerd op
je systeem.
</p>

<pre caption="Installeren van powermgt-base">
# <i>emerge powermgmt-base</i>
</pre>

<p>
Je kunt nu nakijken op welke voedingsbron je werkt door <c>on_ac_power
&amp;&amp; echo AC available || echo Running on batteries</c> uit te voeren in
je terminal. Het onderstaande script is verantwoordelijk voor het veranderen
van de opstartlevels, sla het op onder
<path>/etc/acpi/actions/pmg_switch_runlevel.sh</path>.
</p>

<pre caption="/etc/acpi/actions/pmg_switch_runlevel.sh">
#!/bin/bash

<comment># BEGIN configuratie</comment>
RUNLEVEL_AC="default"
RUNLEVEL_BATTERY="battery"
<comment># EINDE configuratie</comment>


if [ ! -d "/etc/runlevels/${RUNLEVEL_AC}" ]
then
    logger "${0}: Runlevel ${RUNLEVEL_AC} does not exist. Aborting."
    exit 1
fi

if [ ! -d "/etc/runlevels/${RUNLEVEL_BATTERY}" ]
then
    logger "${0}: Runlevel ${RUNLEVEL_BATTERY} does not exist. Aborting."
    exit 1
fi

if on_ac_power
then
    if [[ "$(&lt;/var/lib/init.d/softlevel)" != "${RUNLEVEL_AC}" ]]
    then
        logger "Switching to ${RUNLEVEL_AC} runlevel"
         /sbin/rc ${RUNLEVEL_AC}
    fi
elif [[ "$(&lt;/var/lib/init.d/softlevel)" != "${RUNLEVEL_BATTERY}" ]]
then
    logger "Switching to ${RUNLEVEL_BATTERY} runlevel"
    /sbin/rc ${RUNLEVEL_BATTERY}
fi
</pre>

<p>
Vergeet niet om <c>chmod +x /etc/acpi/actions/pmg_switch_runlevel.sh</c> uit te
voeren om het script uitvoerbaar te maken. Het laatste wat je nodig hebt is het
aanroepen van het script wanneer je de krachtbron veranderd. Dat gebeurd door
het opvangen van ACPI gebeurtenissen met de hulp van <c>acpid</c>. Allereerst
moet je weten welke gebeurtenissen gegenereerd worden als je de voedingsbron
veranderd. De gebeurtenissen worden <c>ac_adapter</c> en <c>battery</c> genoemt
op de meeste laptops, maar dit kan op jouw laptop anders zijn.
</p>

<pre caption="Uitzoeken van ACPI gebeurtenissen voor het veranderen van de
voedingsbron">
# <i>tail -f /var/log/acpid | grep "received event"</i>
</pre>

<p>
Voer het bovenstaande commando uit en trek de energiekabel uit Je zou iets
moeten zien zoals dit:
</p>

<pre caption="Voorbeeld output van voedingsbron veranderingen">
[Tue Sep 20 17:39:06 2005] received event "ac_adapter AC 00000080 00000000"
[Tue Sep 20 17:39:06 2005] received event "battery BAT0 00000080 00000001"
</pre>

<p>
Het interresante stuk is het  stuk tussen <e>aanhalingtekens</e> vlak na
<c>received event</c>. Dit zal het zelfde zijn als de gebeurtenis lijn in de
bestanden die je zoals hieronder zal creeren. Maak je geen zorgen als je
systeem meerdere gebeurtenissen genereerd of altijd dezelfde. Zolang dat hij
een gebeurtenis genereerd, zal het opstartlevel werken.
</p>

<pre caption="/etc/acpi/events/pmg_ac_adapter">
<comment># vervang "ac_adapter" hieronder met de gebeurtenis genereerd door je
laptop</comment>
<comment># Bijvoorbeeld, ac_adapter.* zal overeenstemmen met ac_adapter
AC 00000080 00000000</comment>
event=ac_adapter.*
action=/etc/acpi/actions/pmg_switch_runlevel.sh %e
</pre>

<pre caption="/etc/acpi/events/pmg_battery">
<comment># vervang "battery" hieronder met de gebeurtenis genereerd door je
laptop</comment>
<comment># Bijvoorbeeld, battery.* zal overeenstemmen met battery
BAT0 00000080 00000001</comment>
event=battery.*
action=/etc/acpi/actions/pmg_switch_runlevel.sh %e
</pre>

<p>
Ten slotte moet acpid herstart worden om de veranderingen te erkennen.
</p>

<pre caption="Afwerking: het wisselen van opstartlevel met acpid">
# <i>/etc/init.d/acpid restart</i>
</pre>

<p>
Probeer het eens uit: Plug AC in en uit en kijk naar de syslog voor het
"Switching to AC mode" of "Switching to battery mode" bericht. Zie het <uri
link="#doc_chap8">Probleem Oplossing sectie</uri> als dit script niet de
mogelijkheid heeft om de voedingsbroen correct te detecteren.
</p>

<p>
Uit nature zal het event mechanisme, je laptop opstarten in het <c>default</c>
opstartlevel, op welke voedingsbron hij dan ook mag staan. Dit is goed wanneer
hij op AC draaid, maar we zouden graag willen dat hij in het <e>battery</e>
opstartlevel als dit nodig is. Een oplossing is het toevoegen van een optie aan
de bootloader; namelijk de parameter <c>softlevel=battery</c>, maar
waarschijnlijk zal dit vergeten worden om ervoor te kiezen. Een beter oplossing
is een vals ACPI gebeurtenis genereren op het einde van het opstart-proces en
het <path>pmg_switch_runlevel.sh</path> script laten beslissen of een
opstartlevel verandering nodig is. Open <path>/etc/conf.d/local.start</path> in
je favoriete editor en voeg de volgende lijnen toe:
</p>

<pre caption="Opstartlevel aanpassingen tijdens het opstarten door local.start
aan te passen.">
<comment># Vervals acpi gebeurtenissen om het opstartlevel te veranderen als je
op batterijen werkt</comment>
/etc/acpi/actions/pmg_switch_runlevel.sh "battery/battery"
</pre>

<p>
Voorbereid zoals dit kun je het Energiebeheer beleid activeren voor individuele
apparaten.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Processor Energiebeheer</title>
<section>
<body>

<p>
Mobiele processors kunnen verscshillende kloksnelheden aannemen. Sommige staan
het toe om de voltage aan te passen. Meestal hoeft je cpu niet aan volle
snelheid werken en het schalen van de kloksnelheid zal veel energie besparen -
meestal zonder enige prestatie verlies.
</p>

</body>
</section>
<section>
<title>Enkele Technische Termen</title>
<body>

<p>
Het schalen van de kloksnelheid kunnen enkele technische termen gebruiken die
je niet kent. Hier is een snelle inleiding.
</p>

<p>
Allereerst moet de kernel de mogelijkheid hebben om de kloksnelheid van de
processor aan te passen. De <b>CPUfreq processor driver</b> weet hoe hij dit
moet toepassen op je cpu. Dus is het belangrijk om de juiste te kiezen in de
kernel. knows the commands to do it on your CPU. Je zou reeds hierboven moeten
gedaan hebben. Eenmaal de kernel weet hoe hij de kloksnelheid moet veranderen,
moet het weten welke kloksnelheid het moet instellen. It wordt gedaan volgends
het <b>beleid (policy)</b> die bestaat uit een <b>CPUfreq policy</b> en een
<b>governor</b>. Een CPUfreq beleid is gewoon 2 nummers die een waaier van
kloksnelheden waar de processor tussen moet blijven (dus de minimum en maximum
kloksnelheid). <e>The governor</e> beslist nu welke beschikbare kloksnelheid
tussen de minimum en maximum kloksnelheid hij moet kiezen. Bijvoorbeeld, de
<b>powersave governor</b> kiest altijd de laagste kloksnelheid beschikbaar, de
<b>performance governor</b> kiest de hoogste. De <b>userspace governor</b>
maakt geen beslissing maar kiest (of een programma in <e>userspace</e>) wilt -
wat betekend dat het de kloksnelheid van
<path>/sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed</path> leest.
</p>

<p>
Dit lijkt niet alsof dynamische kloksnelheid veranderd, en dat is ook zo.
Dynamiteit kan wel bereikt worden door verschillende aanpakken. Bijvoorbeeld,
de <b>ondemand governor</b> maakt zijn beslissing afhankelijk van het
cpu-gebruik. Het zelfde wordt gedaan door vele andere hulpapplicaties zoals
<c>cpudyn</c>, <c>cpufreqd</c>, <c>powernowd</c> en vele anderen. ACPI
evenementen kunnen gebruikt worden voor het inschakelen en uitschakelen van
dynamische kloksnelheid veranderingen afhankelijk van de stroombron.
</p>

</body>
</section>
<section>
<title>De kloksnelheid manueel instellen</title>
<body>

<p>
Het verminderen van de CPU snelheid en de voltage heeft twee voordelen: aan de
ene kant is er minder energieverbruik en aan de andere kant is er
temperatuursverbetering, aangezien je systeem niet zo warm wordt door op volle
snelheid te werken. Het grootste nadeel is natuurlijk het verlies van prestatie.
Het verminderen van de processorsnelheid is een strijd tussen prestaties-verlies
en energie-besparing.
</p>

<note>
Niet iedere laptop ondersteund kloksnelheid-schaling. Als je onzeker bent, neem
een kijkje op de lijst van ondersteunde processors in het <uri
link="#doc_chap8">Troubleshooting</uri> hoofdstuk, om te controleren of jouw
processor ondersteund is.
</note>

<p>
Het wordt tijd om te testen welke kloksnelheid schaling werkt. Laten we een
ander hulpmiddel installeren die erg handig is om fouten op te sporen:
<c>sys-power/cpufrequtils</c>
</p>

<pre caption="De kloksnelheid controlen">
# <i>emerge cpufrequtils</i>
# <i>cpufreq-info</i>
</pre>

<p>
Hier is een voorbeeld output:
</p>

<pre caption="voorbeeld output van cpufreq-info">
cpufrequtils 0.3: cpufreq-info (C) Dominik Brodowski 2004
Report errors and bugs to linux@brodo.de, please.
analyzing CPU 0:
  driver: centrino
  CPUs which need to switch frequency at the same time: 0
  hardware limits: 600 MHz - 1.40 GHz
  available frequency steps: 600 MHz, 800 MHz, 1000 MHz, 1.20 GHz, 1.40 GHz
  available cpufreq governors: conservative, ondemand, powersave, userspace, performance
  current policy: frequency should be within 924 MHz and 1.40 GHz.
    The governor "performance" may decide which speed to use
    within this range.
  current CPU frequency is 1.40 GHz.
</pre>

<p>
Speel nu met de <c>cpufreq-set</c> om zeker te zijn dat het wisselen van
kloksnelheid werkt. Start <c>cpufreq-set -g ondemand</c> bijvoorbeeld om het
ondemand governor te activeren en de verandering te controleren met
<c>cpufreq-info</c>. Als het niet werkt zoals het hoord, kun je hulp vinden in
het <uri link="#doc_chap8">Troubleshooting hoofdstuk</uri> in het einde van de
gids.
</p>

</body>
</section>
<section>
<title>Geautomatiseerde kloksnelheid aanpassing</title>
<body>

<p>
Het bovenstaande ziet er goed uit, maar het is nietdoenbaar in het dagelijkse
leven. Het is beter om je systeem de geschikte kloksnelheden automatisch in te
stellen. Er zijn verschillende aanpakken voor dit. Er zijn verschillende
aanpakken om dit te doen. De volgende tabel geeft een snel overzicht om je te
helpen om een van die te kiezen. Het is ruw ingedeeld in drie categorieën;
<b>kernel</b> voor aanpakken die alleen de kernel ondersteunen, <b>daemon</b>
voor programma's die in de achtergrond starten en <b>grafisch</b> voor
programma's die een GUI leveren voor gemakkelijke configuratie en veranderingen.
</p>

<table>
<tr>
  <th>Naam</th>
  <th>Category</th>
  <th>Switch decision</th>
  <th>Kernel governors</th>
  <th>Further governors</th>
  <th>Commentaren</th>
</tr>
<tr>
  <ti>'ondemand' governor</ti>
  <ti>Kernel</ti>
  <ti>CPU load</ti>
  <ti>N.A.</ti>
  <ti>N.A.</ti>
  <ti>
    Kiest voor maximale kloksnelheid bij het laden van CPU load en daald
    langzaam wanneer de CPU niets aan het doen is. Verdere verbeteringen kun je
    in de <path>/sys/devices/system/cpu/cpu0/cpufreq/ondemand/</path> volgende
    bestanden instellen. Dit vereist userland tools (programma's, scripts) als
    governor switching gewenst is.
  </ti>
</tr>
<tr>
  <ti>'conservative' governor</ti>
  <ti>Kernel</ti>
  <ti>CPU load</ti>
  <ti>N.A.</ti>
  <ti>N.A.</ti>
  <ti>
    Anders dan de <e>ondemand governor</e>, <e>conversative</e> springt die niet
    tusssen de maximale kloksnelheid wanneer de nood hoog is, maar verhoogd de
    kloksnelheid stap per stap. Verdere verbeteringen door bestanden in
    <path>/sys/devices/system/cpu/cpu0/cpufreq/ondemand/</path>. Er is nog
    steeds nood (programmas, scripts) als de governer switching of gelijkaardig
    gewenst is.
  </ti>
</tr>
<tr>
  <ti><uri link="http://mnm.uib.es/~gallir/cpudyn/">cpudyn</uri></ti>
  <ti>Daemon</ti>
  <ti>CPU load</ti>
  <ti>Prestatie, Energiebesparing</ti>
  <ti>Dynamisch</ti>
  <ti>
    Dit ondersteund ook harde schijf standby - die laat weten hoe de <e>laptop
    mode</e> in meeste gevallen een betere job zal doen.
  </ti>
</tr>
<tr>
  <ti><uri link="http://sourceforge.net/projects/cpufreqd/">cpufreqd</uri></ti>
  <ti>Daemon</ti>
  <ti>Battery state, CPU load, temperature, running programs and more</ti>
  <ti>Alle beschikbare </ti>
  <ti>Geen</ti>
  <ti>
    Ingewikkeld ( maar ook een beetje verfijnde) installatie. Uitbreidbaar met
    behulp van plugins zoals sensor monitoring (lm_sensors) of het coördineren
    van enkele NVidia gebaseerde grafische kaarten en meer. Cpufreqd is bewust
    van SMP en kan optioneel manueel gecontroleerd worden op elk moment.
  </ti>
</tr>
<tr>
  <ti>
    <uri link="http://www.deater.net/john/powernowd.html">powernowd</uri>
  </ti>
  <ti>Daemon</ti>
  <ti>CPU load</ti>
  <ti>Geen</ti>
  <ti>Passief, <e>sinus</e>, aggressive</ti>
  <ti>
    Ondersteund SMP.
  </ti>
</tr>
<tr>
  <ti>
    <uri
    link="http://fatcat.ftj.agh.edu.pl/~nelchael/index.php?cat=projs&amp;subcat=ncpufreqd&amp;language=en">ncpufreqd</uri>
  </ti>
  <ti>Daemon</ti>
  <ti>Temperatuur</ti>
  <ti>Geen</ti>
  <ti>Krachtbesparing, prestaties</ti>
  <ti>
    Wisselt de gebruikte gouverneur tussen prestatie en energiebesparing
    afhankelijk van de systeem temperatuur. Erg handig bij laptops die
    warmteproblemen hebben.
  </ti>
</tr>
<tr>
  <ti><uri link="http://www.goop.org/~jeremy/speedfreq/">speedfreq</uri></ti>
  <ti>Daemon</ti>
  <ti>CPU load</ti>
  <ti>Geen</ti>
  <ti>Dynamisch, energiebesparing, prestatie, aangepaste snelheid</ti>
  <ti>
    Gemakkelijk te configureren met een goede client/server interface. Vereist
    een 2.6 kernel. Deze is momenteel niet meer onderhouden, gebroken en dus
    verwijderd van de portage. Gelieve te wisselen naar cpufreqd moest je deze
    nog steeds gebruiken.
  </ti>
</tr>
<tr>
  <ti><uri link="http://cpuspeedy.sourceforge.net/">gtk-cpuspeedy</uri></ti>
  <ti>Grafisch</ti>
  <ti>Geen</ti>
  <ti>Geen</ti>
  <ti>Geen</ti>
  <ti>
    Gnome applicatie, een grafische tool om de kloksnelheid manueel in te
    stellen. Het levert geen automatisatie.
  </ti>
</tr>
<tr>
  <ti>klaptopdaemon</ti>
  <ti>Grafisch</ti>
  <ti>Battery staat</ti>
  <ti>Alle beschikbare</ti>
  <ti>Geen</ti>
  <ti>
    Enkel geschikt voor KDE, 'ondemand' gouverneur vereist voor dynamische
    kloksnelheid schaling.
  </ti>
</tr>
</table>

<p>
Tijdens het aanpassen van de kloksnelheid naar de huidige status lijkt simpel
op het eerste zicht, het is geen zo'n gemakkelijke taak. Een slecht algoritme
kan constant verwisselingen teweeg brengen tussen twee frequenties of het
verliezen van energie wanneer de kloksnelheid staat ingesteld op een onnodig
hoog level.
</p>

<p>
Welke moet je kiezen ? Als je geen idee hebt, probeer <c>cpufreqd</c>:
</p>

<pre caption="Installeren van cpufreqd">
# <i>emerge cpufreqd</i>
</pre>

<p>
<c>cpufreqd</c> kan geconfigureerd worden door het aanpassen van
<path>/etc/cpufreqd.conf</path>. De standaart config kan wat verwarrend lijken.
Daarom raad ik aan de die te vervangen met die van ontwikkelaar Handrik Brix
Andersen (zie hieronder). Merk op dat je cpufreqd-2.0.0 of hoger nodig hebt.
Oudere versies hebben een verschillende syntax voor deze config file.
</p>

<pre caption="/etc/cpufreqd.conf (cpufreqd-2.0.0 en later)">
[General]
pidfile=/var/run/cpufreqd.pid
poll_interval=3
enable_plugins=acpi_ac, acpi_battery
enable_remote=1
remote_group=wheel
verbosity=5
[/General]

[Profile]
name=ondemand
minfreq=0%
maxfreq=100%
policy=ondemand
[/Profile]

[Profile]
name=conservative
minfreq=0%
maxfreq=100%
policy=conservative
[/Profile]

[Profile]
name=powersave
minfreq=0%
maxfreq=100%
policy=powersave
[/Profile]

[Profile]
name=performance
minfreq=0%
maxfreq=100%
policy=performance
[/Profile]

[Rule]
name=battery
ac=off
profile=conservative
[/Rule]

[Rule]
name=battery_low
ac=off
battery_interval=0-10
profile=powersave
[/Rule]

[Rule]
name=ac
ac=on
profile=ondemand
[/Rule]
</pre>

<p>
Je kunt nu de cpufreqd daemon starten. Voeg het ook toe aan het <c>default</c>
en <c>battery</c> opstartlevel.
</p>

<pre caption="Starten van cpufreqd">
# <i>rc-update add cpufreqd default battery</i>
# <i>rc</i>
</pre>

<p>
Soms kan het gewenst zijn om een andere beleid te kiezen dan het beleid waar de
daemon voor kiest, bijvoorbeeld als de batterij bijna leeg is, maar je weet dat
AC binnenkort beschikbaar is. In dit geval kun je cpufreqd's manuele mode
selecteren met <c>cpufreqd-set manual</c> en een van je voorgeconfigureerde
beleiden kiezen (beschikbaar in lijstje door <c>cpufreqd-get</c>). Je kunt
manuele mode veralten door <c>cpufreqd-set dynamic</c> uit te voeren.
</p>

<warn>
Start niet meer dan een bovenstaand programma op de zelfde tijd. Het kan
verwarring creëeren, zoals het constant wisselen tussen twee frequenties.
</warn>


</body>
</section>
<section>
<title>Het resultaat controleren</title>
<body>

<p>
Het laatste wat je wilt controlere is of je beleid het goed doet. Een
gemakkelijke manier om dit te doen is controleren deprocessor snelheid
controleren terwijl je werkt met laptop:
</p>

<pre caption="Bijhouden van de CPU snelheid">
# <i>watch grep \"cpu MHz\" /proc/cpuinfo</i>
</pre>

<p>
Als <path>/proc/cpuinfo</path> niet upgedate wordt (zie <uri
link="#doc_chap8">Troubleshooting</uri>), controleer de kloksnelheid met:
</p>

<pre caption="Alternatieve kloksnelheid controle">
# <i>watch x86info -mhz</i>
</pre>

<p>
Afhankelijk van de installatie, zou de kloksnelheid fel moeten verhogen bij
zware processortaken, en sterk verminderen als er geen activiteit is of op het
normale niveau werkt. Als je <c>cpufreqd</c> en verbosity ingesteld is op 5 of
hoger in <path>cpufreqd.conf</path> zul je extra inforamtie krijgen over wat er
gebeurd in <c>syslog</c>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>LCD Energiebeheer</title>
<section>

<body>

<p>
Zoals je kan zien in <uri link="#doc_chap1_fig1">figuur 1.1</uri>, neemt het
LCD scherm het grootste deel van de energie (Dit kan anders zijn voor
niet-mobiele CPU's). Dus is het belangrijk niet alleen de display uit te
schakelen wanneer die niet nodig is maar ook om de backlight te verminderen
indien mogelijk. Meeste laptops offeren de mogelijkheid om de backligt te
dimmen.
</p>

</body>
</section>
<section>
<title>Standby instellingen</title>
<body>


<p>
Het eerste dat je wilt controleren is de standby/suspend/uit tijden van het
scherm. Dit omdat dit zwaar afhangt op je windowmanaager, Ik zal je dit zelf
laten uitzoeken. Twee veelvoorkomende plaatsen: De terminal wit maken met
<c>setterm -blank &lt;number-of-minutesM&gt;</c>, <c>setterm -powersave on</c>
en <c>setterm -powerdown &lt;number-of-minutesM&gt;</c>. Voor X.org, pas
<path>/etc/X11/xorg.conf</path> aan zoals onderstaand voorbeeld:
</p>

<pre caption="LCD suspend instellingen in in X.org en XFree86">
Section "ServerLayout"
  Identifier  [...]
  [...]
  Option  "BlankTime"  "5"  <comment># Blank the screen after 5 minutes (Fake)</comment>
  Option  "StandbyTime"  "10"  <comment># Turn off screen after 10 minutes (DPMS)</comment>
  Option  "SuspendTime"  "20"  <comment># Full suspend after 20 minutes</comment>
  Option  "OffTime"  "30"  <comment># Turn off after half an hour</comment>
  [...]
EndSection

[...]

Section "Monitor"
  Identifier  [...]
  Option  "DPMS"  "true"
  [...]
EndSection
</pre>

<p>
Dit is het zelfde voor XFree86 en <path>/etc/X11/XF86Config</path>.
</p>

</body>
</section>
<section>
<title>Backlight dimmen</title>
<body>

<p>
Wat waarschijnlijk belangrijker is, is het dimmen van de backlight. Als je
toegang hebt tot de instellingen van het dimmen via een programma, schrijf dan
een kleine script die de backligt dimt in batterij mode en plaats het in je
<c>battery</c> opstartlevel. Het volgende script zou moeten werken op de meeste
IBM Thinkpads en Toshiba laptops. Je moet wel de benodigde opties aanschakelen
in je kernel (enkel voor IBM Thinkpads). Voor Toshiba laptops, installeer
<c>app-laptop/acpitool</c> en sla de onderstaande configuratie van
<c>ibm_acpi</c> over.
</p>

<warn>
Ondersteuning voor helderheid instellingen is gemarkeerd als experimenteel in
ibm-acpi. Het raadpleegt de hardware direct en kan schade aanrichten op je
systeem. Gelieve de <uri link="http://ibm-acpi.sourceforge.net/">ibm-acpi
website</uri> te lezen.
</warn>

<p>
Om de mogelijkheid te hebben om de helderheid in te stellen, moet de ibm_acpi
module geladen worden met de experimentele parameter.
</p>

<pre caption="automatisch laden van de ibm_acpi module">
<comment>(Gelieve bovenstaande waarschuwingen te lezen vooraleer dit te
doen!)</comment>
# <i>echo "options ibm_acpi experimental=1" >> /etc/modules.d/ibm_acpi</i>
# <i>/sbin/modules-update</i>
# <i>echo ibm_acpi >> /etc/modules.autoload.d/kernel-2.6</i>
# <i>modprobe ibm_acpi</i>
</pre>

<p>
Dit zou moeten wekren zonder fout-berichten en het bestand
<path>/proc/acpi/ibm/brightness</path> zou moeten aangemaakt zijn ne hat laden
van de module. Een init script zal er voor zorgen dat de correcte keuze
gemaakt wordt afhankelijk van de energiebron.
</p>

<pre caption="/etc/conf.d/lcd-brightness">
<comment># Zie /proc/acpi/ibm/brightness voor beschikbare waarden</comment>
<comment># Gelieve /usr/src/linux/Documentation/ibm-acpi.txt te lezen</comment>

<comment># Helderheid level in ac mode. De standaard is 7.</comment>
BRIGHTNESS_AC=7

<comment># Helderheid level in batterij mode. De standaard is 4.</comment>
BRIGHTNESS_BATTERY=4
</pre>

<pre caption="/etc/init.d/lcd-brightness">
#!/sbin/runscript

set_brightness() {
    if on_ac_power
    then
        LEVEL=${BRIGHTNESS_AC:-7}
    else
        LEVEL=${BRIGHTNESS_BATTERY:-4}
    fi

    if [ -f /proc/acpi/ibm/brightness ]
    then
        ebegin "Setting LCD brightness"
        echo "level ${LEVEL}" > /proc/acpi/ibm/brightness
        eend $?
    elif [[ -e /usr/bin/acpitool &amp;&amp; -n $(acpitool -T | grep "LCD brightness") ]]
    then
        ebegin "Setting LCD brightness"
        acpitool -l $LEVEL >/dev/null || ewarn "Unable to set lcd brightness"
        eend $?
    else
        ewarn "Setting LCD brightness is not supported."
        ewarn "For IBM Thinkpads, check that ibm_acpi is loaded into the kernel"
        ewarn "For Toshiba laptops, you've got to install app-laptop/acpitool"
    fi
}

start() {
    set_brightness
}

stop () {
    set_brightness
}
</pre>

<p>
Wanneer je dit hebt gedaan, controleer of de helderheid automatisch wordt
aangepast door het toe te voegen aan het batterij opstartlevel.
</p>

<pre caption="Inschakelen van automatische helderheid aanpassingen">
# <i>chmod +x /etc/init.d/lcd-brightness</i>
# <i>rc-update add lcd-brightness battery</i>
# <i>rc</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Schijf Energiebeheer</title>
<section>
<body>

<p>
Harde schijvern verbruiken minder energie in slaap-modues. Daarom is het
logisch om energiebesparing in te schakelen, wanneer de harde schijf niet
gebruikt is voor een bepaalde tijd. Ik zal je twee alternatieve mogelijkheden
tonen, om dit te doen. ALlereerst zal laptop-mode veel energie besparen die
aangegeven werden door verschillende metingen. De keerzijde van de medaille is
hier dat door de vertraagde schrijftoegang een stroomonderbreking of
kernel-crash nog gevaarlijker kan zijn voor dataverlies. Als je dit niet wil,
moet je controleren dat er geen processen zijn die direct naar de harde schijf
schrijven. Daarna kkun je energiebesparing inschakelen of je harde schijf met
<c>hdparm</c> als tweede alternatief.
</p>

</body>
</section>
<section>
<title>Verhogeven van de idle-tijd - laptop-mode</title>
<body>

<p>
Recente kernels (2.6.6 en nieuwer, recente 2.4 kernels en andere met patches)
bevatten de" zogenaamde <c>laptop-mode</c>. Als die geactiveerd is, worden
buffers geschreven naar de harde schijf bij lees-opdrachten of na 10 minuten
(in plaats van 30 seconden). Dit verkleint de tijd dat de harde schijf stroom
verbruikt.
</p>

<pre caption="Geautomatiseerde start van laptop-mode">
# <i>emerge laptop-mode-tools</i>
</pre>

<p>
<c>laptop-mode-tools</c> 's configuratiebestanden zijn te vinden in
<path>/etc/laptop-mode/laptop-mode.conf</path>. Pas het op de manier dat je
wil, het is goed gecommentariseerd. Voer <c>rc-update add laptop_mode
battery</c> om het automatisch te starten.
</p>

<p>
Recente versies (1.11 en nieuwer) van laptop-mode-tools bevatten een nieuw
hulp-programma, namelijk <c>lm-profiler</c>. Het zal je systeem schijfgebruik
en netwerk diensten in de gaten houden en zal voorstellen onnodige processen af
te breken. Je kunt ze uitschakelen door laptop-mode-tools's ingebouwde
opstartlevel ondersteuning (die zal worden aangepast naar Gentoo's
<c>/sbin/rc</c>) of gebruik je <c>default</c>/<c>battery</c> opstartlevels
(aangeraden).
</p>

<pre caption="Voorbeeld output van het starten van lm-profiler">
# <i>lm-profiler</i>
Profiling session started.
Time remaining: 600 seconds
[4296896.602000] amarokapp
Time remaining: 599 seconds
[4296897.714000] sort
[4296897.970000] mv
Time remaining: 598 seconds
Time remaining: 597 seconds
[4296900.482000] reiserfs/0
</pre>

<p>
Na het profileren van je systeem gedurende tien minuten, zal lm-profiler je een
lijst van services voorstellen die voor schijf raadplegingen hebbben gezorgt
tijdens die tijd.
</p>

<pre caption="lm-profiler stelt voor deze uit te schakelen">
Program:     "atd"
Reason:      standard recommendation (program may not be running)
Init script: /etc/init.d/atd (GUESSED)


Do you want to disable this service in battery mode? [y/N]: <i>n</i>
</pre>

<p>
Om atd uit te schakelen zoals voorgesteld in het bovenstaande voorbeeld, zou je
<c>rc-update del atd battery</c> moeten uitvoeren. Wees voorzichtig met het
uitschakelen van diensten, die nodig zijn voor je systeem nodig heeft om goed
te werken - <c>lm-profiler</c> kan mogelijk enkele slechte voorstellen doen.
Schakel die niet uit als je niet zeker bent als deze nodig zijn of niet.
</p>

</body>
</section>
<section>
<title>Limiteren van schrijf raadplegingen</title>
<body>

<p>
Als je laptop mode niet wilt gebruiken, moet je extra aandacht besteden aan
programma's die geregeld naar je harde schijf schrijven - <c>syslogd</c> is een
goede kandidaat bijvoorbeeld. Je wilt het waarschijnlijk niet helemaal stoppen,
maar je kunt het configuratie bestand zodanig aanpassen dat het "onnodige zaken
niet registreerd, en dus geens schijf activiteit genereerd. <c>Cups</c>
schrijft ook geregeld naar de schijf, dus denk er es ove rna om het uit te
schakelen en het manueel op te starten wanneer dit nodig is.
</p>

<pre caption="Uit schakelen van cups in de batterij modus">
# <i>rc-update del cupsd battery</i>
</pre>

<p>
Je kunt ook <c>lm-profiler</c> van laptop-mode-tools (zie hierboven) gebruiken
om diensten te vinden die je wilt uitschakelen. Eenamal je ze allemaal
geëlimineert hebt, ga dan verder met het configureren van hdparm.
</p>

</body>
</section>
<section>
<title>hdparm</title>
<body>

<p>
De volgende mogelijkheid is het gebruiken van een klein script en
<c>hdparm</c>. Sla dit over als je laptop-mode gebruikt. Creëer in het andere
geval <path>/etc/init.d/pmg_hda</path>:
</p>

<pre caption="Gebruiken van hdparm voor de harde schijf standby-status">
#!/sbin/runscript

depend() {
after hdparm
}

start() {
ebegin "Activating Power Management for Hard Drives"
hdparm -q -S12 /dev/hda
eend $?
}

stop () {
ebegin "Deactivating Power Management for Hard DSkip this if
you are using rives"
hdparm -q -S253 /dev/hda
eend $?
}
</pre>

<p>
Kijk ook eens naar <c>man hdparm</c> voor meer opties. Als je script is
afgewerkt, kun je het toevoegen aan het batterij opstartlevel.
</p>

<pre caption="Automatiseer harde schijf standby instellingen">
# <i>chmod +x /etc/init.d/pmg_hda</i>
# <i>/sbin/depscan.sh</i>
# <i>rc-update add pmg_hda battery</i>
</pre>

<impo>
Wees voorzichtig met slaap/rotatie instellingen van je harde schijf. Het
instellen naar een kleine waarde kan je slijtage veroorzaken en je garantie
laten vervallen.
</impo>

</body>
</section>
<section>
<title>Andere trucs</title>
<body>

<p>
Andere mogelijkheden zijn het deactiveren van de swap in batterij modus.
Vooraleer we een swapon/swapoff wisselaar schrijven, controleren we als er
genoeg RAM gegeugen en dat swap niet teveel gebruikt wordt, anders zul je
problemen ondervinden.
</p>

<p>
Als je laptop-mode niet wilt gebruiken, is het nog altijd mogelijk om de schijf
raadplegingen te verminderen door enkele mappen te mounten als <c>tmpfs</c> -
schrijf raadplegingen zijn niet opgelsaan op een schijf, maar in het geugen en
worden verloren bij het unmounten. Meestal is het handig om een
<path>/tmp</path> op deze manier te mounten - Je moet er geen extra aandacht aan
schenken aangezien het gewist wordt elke keer men reboot, waar het ook gemount
werd (harde schijf or ram). Controleer dat je genoeg ram gegeugen hebt en dat er
geen programma (zoals een download client of compress programma) extra ruimte
nodig heeft in <path>/tmp</path>. Om dit te activeren, schakel tmpfs
ondersteuning in de kernel in en voeg een lijn toe aan je
<path>/etc/fstab</path> zoals hier:
</p>

<pre caption="Aanpassen van /etc/fstab om /tmp automatisch te laten mounten">
none  /tmp  tmpfs  size=32m  0 0
</pre>

<warn>
Let op bij de size parameter en pas het aan voor jouw systeem. Als je onzeker
bent, probeer dit niet, het kan een prestatie probleem veroorzaken. In het geval
je <path>/var/log</path> op deze manier wilt mounten, controleer dat je de
logbestanden copieert naar je schijf vooraleer je unmount. Ze zijn belangrijk.
Probeer nooit <path>/var/tmp</path> op deze manier te mounten. De portage
gebruikt dit om te compileren...
</warn>

</body>
</section>
</chapter>

<chapter>
<title>Energiebeheer voor andere aparaten</title>
<section>
<title>Grafische kaarten</title>
<body>

<p>
In het geval je een PowerPlay ondersteunende ATI graphics kaart hebt (dynamic
clock scaling for the the graphics processing unit GPU), kun je deze activeren
in X.org. Open <path>/etc/X11/xorg.conf</path> en voeg (of schakel) de
<c>DynamicClocks</c> optie in, in het aparaten sectie (Device section). Merk
ook op dat deze optie kan leiden tot een crash op sommige systemen.
</p>

<pre caption="Inschakelen van ATI PowerPlay ondersteuning in X.org">
Section "Device"
[...]
Option      "DynamicClocks" "on"
EndSection
</pre>

</body>
</section>
<section>
<title>Draadloze energiebeheer ondersteuning</title>
<body>

<p>
Draadloze LAN kaarten verbruiken veel energie. Plaats ze in energiebeheer mode
in analogie in het <c>pmg_hda</c> script.
</p>

<note>
Dit script gaat ervan uit dat je draadloze interface <c>wlan0</c> heet; Vervang
dit met de echte naam van je interface.
</note>

<pre caption="Geautomatiseerde WLAN Energiebeheer">
#!/sbin/runscript
start() {
  ebegin "Activating Power Management for Wireless LAN"
  iwconfig wlan0 power on
  eend $?
}

stop () {
  ebegin "Deactivating Power Management for Wireless LAN"
  iwconfig wlan0 power off
  eend $?
}
</pre>

<p>
Het starten van dit script zal energiebesparing voor wlan0 activeren. Sla het
op als <path>/etc/init.d/pmg_wlan0</path> en voeg het toe aan het batterij
opstartlevel zoals het bovenstaande schijf-script. Kijk ook naar <c>man
iwconfig</c> voor meer detailopties zoals de periode tussen wakeups of timeout
instellingen. Als je driver en access point het wisselen van de beacon tijd
ondersteunen, is dit een goed beginpunt om nog meer energie te besparen.
</p>

<pre caption="Energiebeheer voor WLAN">
# <i>chmod +x /etc/init.d/pmg_wlan0</i>
# <i>/sbin/depscan.sh</i>
# <i>rc-update add pmg_wlan0 battery</i>
</pre>

</body>
</section>
<section>
<title>USB Energiebeheer</title>
<body>

<p>
Er zijn altijd twee problemen bij USB apraten als men praat over
energieverbruik: het eerste is dat aparaten zoals een USB muis, digitale cameras
of USB sticks energie verbruiken terwijl ze aangeschakelt zijn. Je kunt dit niet
behelpen. En ten tweede, wanneer er een USB aparaat ingeschakelt is, raadpleegt
de USB-controller periodisch de bus, die op zijn beurt tegengaat dat de CPU in
slaap-modus gaat. De kernel levert een experimentele optie om suspentie van USB
aparaten kan ischakelen door een driver of een van de <path>power/state</path>
bestanden in <path>/sys</path>.
</p>

<pre caption="Inschakelen van USB suspend ondersteuning in de kernel">
Device Drivers
  USB support
    [*]   Support for Host-side USB
      [*]   USB suspend/resume (EXPERIMENTAL)
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Slaapstanden: slaapstand, standby, en suspend naar harde schijf</title>
<section>
<body>

<p>
ACPI definieert verschillende slaapstanden. De belangrijkste zijn
</p>

<ul>
  <li>S1 aka Standby</li>
  <li>S3 aka Suspend naar RAM aka Slaapstand</li>
  <li>S4 aka Suspend naar Harde schijf aka Hibernate</li>
</ul>

<p>
Ze kunnen opgeroepen worden als je systeem niet in gebruik is, maar afsluiten
niet gewenst is door de lange opstarttijd.
</p>

</body>
</section>
<section>
<title>Sleep (S3)</title>
<body>

<p>
De ACPI ondersteuning voor deze slaapstanden is experimenteel, en wel voor een
zeer goede reden. APM slaapstanden lijken stabieler maar je kan APM en ACPI
jammer genoeg niet samen gebruiken.
</p>

<pre caption="Kernel configuratie voor de verschillende suspend types">
  Power Management Optioyou'll get
additional information about what's happening reported to ns ---&gt;
    [*]  Power Management support
      ACPI (Advanced Configuration and Power Interface) Support ---&gt;
        [*]  ACPI Support
          [*]   Sleep States
</pre>

<p>
Eens de kernel juist geconfigureerd is kan je het <c>hibernate-script</c>
gebruiken om de suspend of slaapstand te activeren. Laten we dit eerst
installeren.
</p>

<pre caption="Het hibernate-script installeren">
# <i>emerge hibernate-script</i>
</pre>

<p>
Er moeten enkele zaken in <path>/etc/hibernate</path> ingesteld worden. Het
standaard pakket introduceert twee configuratie bestanden
<path>hibernate.conf</path> en <path>ram.conf</path>.
</p>

<p>
Om slaapstand in te stellen gebruik je <path>ram.conf</path> in
<path>/etc/hibernate</path>. <c>UseSysfsPowerState mem</c> is al juist
ingesteld, maar je moet de rest van het configuratie bestand doorlopen en
wijzigingen maken voor jouw systeem. De commentaar en namen van de opties
zullen je hierbij helpen. Als je nfs of samba shares op het netwerk gebruikt
moet je ervoor zorgen dat de juiste scripts afsluiten om timeouts te vermijden.
</p>

<p>
Klaar? Dit is de laatste kans om backups te nemen van date die je wil behouden
nadat het volgende commando is uitgevoerd. Hou er rekening mee dat je een
bepaalde toets moet indrukken om terug te komen uit de slaapstand.
</p>

<pre caption="Slaapstand oproepen">
# <i>hibernate-ram</i>
</pre>

<p>
Als je nog steeds aan het lezen bent blijkt het te werken :). Je kan standby
(S1) op dezelfde wijze instellen door <path>ram.conf</path> naar
<path>standby.conf</path> te kopiëren en een symbolische link
<path>/usr/sbin/hibernate-standby</path> te maken die verwijst naar
<path>/usr/sbin/hibernate</path>. S3 en S4 zijn interessantere slaapstanden
omdat de meer energie besparen.
</p>

</body>
</section>
<section>
<title>Hibernate (S4)</title>
<body>

<p>
Deze sectie introduceert hibernatie, waar een snapshot van het werkende systeem
gekopieerd wordt naar de harde schijf voordat het systeem afsluit. Bij het
hervatten wordt de snapshot geladen en kan je verder werken vanaf het moment
dat je hibernate opriep.
</p>

<warn>
Verwissel geen hot-pluggable hardware tijdens de suspend en probeer geen nieuw
kernel image te laden dan datgene waarmee de suspend gestart werd. Sluit ook
alle NFS of samba server/clients voordat je in hibernatie mode gaat.
</warn>

<p>
Er zijn twee verschillende implementaties voor S4. De originele is swsusp en de
nieuwe is suspend2, die heeft een mooiere interface (inclusief fbsplash
ondersteuning). Een <uri link="http://suspend2.net/features.html#compare">
vergelijking </uri> is te vinden op de <uri link="http://suspend2.net">
suspend2 website</uri>. Er was vroeger een Suspend-naar-Schijf (pmdisk) maar
die wordt niet meer gebruikt.
</p>

<p>
Suspend2 is nog niet geïmplementeerd in de standaard kernel, daarom moet je
ofwel je kernel source patchen met de patches die <uri
link="http://suspend2.net">suspend2.net</uri> voorziet, of gebruik
<c>sys-kernel/suspend2-sources</c>.
</p>

<p>
De kernel instellingen voor zowel swusp en suspend2 zien er zo uit:
</p>

<pre caption="Kernel configuratie voor verschillende suspend types">
Power Management Options ---&gt;
  <comment>(hibernate with swsusp)</comment>
  [*] Software Suspend
      <comment>(replace /dev/SWAP with your swap partition)</comment>
      (/dev/SWAP)      Default resume partition

  <comment>(hibernate with suspend2)</comment>
  Software Suspend 2
    --- Image Storage (you need at least one writer)
    [*]     File Writer
    [*]    Swap Writer
    ---   General Options
    [*]    LZF image compression
    <comment>(replace /dev/SWAP with your swap partition)</comment>
    (swap:/dev/SWAP)   Default resume device name
    [ ]     Allow Keep Image Mode
</pre>

<p>
De configuratie voor swsusp is nogal eenvoudig. Als je de locatie van ja swap
partitie niet hebt opgegeven in de kernel kan je dit ook meegeven met de
<c>resume=/dev/SWAP</c> optie. Als je niet kan booten door een eventueel
beschadigde image, kan je de <c>noresume</c> kernel parameter meegeven. Het
<c>hibernate-cleanup</c> init script maakt de swsusp images ongeldig tijdens
het booten.
</p>

<pre caption="swsusp images ongeldig maken bij boot">
# <i>rc-update add hibernate-cleanup boot</i>
</pre>

<p>
Om hibernate met swsusp te activeren moet je het hibernate script gebruiken en
de <c>UseSysfsPowerState disk</c> optie in
<path>/etc/hibernate/hibernate.conf</path> aanzetten.
</p>

<warn>
Backup je data voordat je dit doet. Voer <c>sync</c> uit voordat je een van de
commando's uitvoert zodat je de data op de schijf hebt staan. Probeer het eerst
buiten X, later als X opgestart is, maar je niet ingelogd bent.
</warn>

<p>
Als je kernel panics ondervindt door uhci of iets gelijkaardigs kan je proberen
USB support als module te laden en de modules te unloaden voordat je de laptop
in slaapstand zet. Er zijn configuratie optie voorzien in
<path>hibernate.conf</path>
</p>

<pre caption="Hibernaten met swsusp">
# <i>nano -w /etc/hibernate.conf</i>
<comment>(Zorg voor een backup van je data!)</comment>
# <i>hibernate</i>
</pre>

<p>
De volgende sectie behandelt de setup van suspend2 met fbsplash ondersteuning
voor een mooie grafische progress bar tijdens de suspend en het hervatten van
de sessie.
</p>

<p>
Het eerste deel van de setup is gelijkaardig aan die van de configuratie van
swsusp. Als je de locatie van je swap partitie niet in de kernel hebt ingesteld
kan je deze meegeven met de <c>resume2=swap:/dev/SWAP</c> optie. Als je niet
kan booten door een beschadigde image, voeg dan de <c>noresume2</c> parameter
toe. Het <c>hibernate-cleanup</c> script zal de images tijdens het bootproces
ongeldig maken.
</p>

<pre caption="suspend2 images ongeldig maken tijdens boot">
# <i>rc-update add hibernate-cleanup boot</i>
</pre>

<p>
Bewerk nu <path>/etc/hibernate/hibernate.conf</path>, uncomment de
<c>suspend2</c> sectie en plaats alles in de <c>sysfs_power_state</c> en
<c>acpi_sleep</c> secties in commentaar . Schakel het <c>fbsplash</c> stuk in de
globale opties nog niet in.
</p>

<pre caption="Hibernaten met suspend2">
# <i>nano -w /etc/hibernate.conf</i>
<comment>(Zorg voor een backup van je data!)</comment>
# <i>hibernate</i>
</pre>

<p>
Nu kan je <c>fbsplash</c> configureren (als je dit nog niet gedaan hebt). Om de
fbsplash in te schakelen tijdens de hibernatie is het
<c>sys-apps/suspend2-userui</c> pakket nodig en moet je de <c>fbsplash</c> USE
flag inschakelen.
</p>

<pre caption="suspend2-userui installeren">
# <i>mkdir -p /etc/portage</i>
# <i>echo "sys-apps/suspend2-userui fbsplash" >> /etc/portage/package.use</i>
# <i>emerge suspend2-userui</i>
</pre>

<p>
De ebuild zegt dat je een symlink moet maken naar het thema dat je wilt
gebruiken. Bijvoorbeeld om het <c>livecd-2005.1</c> thema te gebruiken moet je
het volgende commando uitvoeren:
</p>

<pre caption="Het livecd-2005.1 thema gebruiken tijdens hibernatie">
# <i>ln -sfn /etc/splash/livecd-2005.1 /etc/splash/suspend2</i>
</pre>

<p>
Als je geen zwart scherm wilt in de beginfase van het resume proces moet je
<c>suspend2ui_fbsplash</c> aan je initrd image toevoegen. Stel dat je een
initrd hebt aangemaakt met <c>splash_geninitramfs</c> en dit hebt opgeslagen
als <path>/boot/fbsplash-emergence-1024x768</path>, dan doe je dit zo.
</p>

<pre caption="suspend2ui_fbsplash toevoegen aan een initrd image">
# <i>mount /boot</i>
# <i>mkdir ~/initrd.d</i>
# <i>cp /boot/fbsplash-emergence-1024x768 ~/initrd.d/</i>
# <i>cd ~/initrd.d</i>
# <i>gunzip -c fbsplash-emergence-1024x768 | cpio -idm --quiet -H newc</i>
# <i>rm fbsplash-emergence-1024x768</i>
# <i>cp /usr/sbin/suspend2ui_fbsplash sbin/</i>
# <i>find . | cpio --quiet --dereference -o -H newc | gzip -9 > /boot/fbsplash-suspend2-emergence-1024x768</i>
</pre>

<p>
Daarna pas je <path>grub.conf</path> (of <path>lilo.conf</path>) aan zodat je
suspend2 kernel <path>/boot/fbsplash-suspend2-emergence-1024x768</path> als
initrd image gebruikt. Je kan nu testen of alles correct is ingesteld.
</p>

<pre caption="Test run voor fbsplash hibernatie">
# <i>suspend2ui_fbsplash -t</i>
</pre>

<p>
Daarna open je <path>/etc/hibernate/hibernate.conf</path> opnieuw en activeer
je de fbsplash opties. Voer <c>hibernate</c> uit en geniet.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Probleemoplossing</title>
<section>
<body>

<p>
<e>V:</e> Ik probeer de kloksnelheid te veranderen maar
<path>/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</path> bestaat
niet.
</p>

<p>
<e>A:</e> Controlleer of je processor het schalen van de kloksnelheid
ondersteunt en je de juiste CPUFreq driver voor je processor hebt gekozen. Hier
is een lijst van processoren die cpufreq (kernel 2.6.7) ondersteunt: ARM
Integrator, ARM-SA1100, ARM-SA1110, AMD Elan - SC400, SC410, AMD mobile K6-2+,
AMD mobile K6-3+, AMD mobile Duron, AMD mobile Athlon, AMD Opteron, AMD Athlon
64, Cyrix Media GXm, Intel mobile PIII en Intel mobile PIII-M op verschillende
chipsets, Intel Pentium 4, Intel Xeon, Intel Pentium M (Centrino), National
Semiconductors Geode GX, Transmeta Crusoe, VIA Cyrix 3 / C3, UltraSPARC-III,
SuperH SH-3, SH-4, verscheidene "PowerBook" en "iBook2" en andere processoren
en enkele ACPI 2.0-compatibele systemen (enkel als "ACPI Processor Performance
States" mogelijk zijn op de ACPI/BIOS interface).
</p>

<p>
<e>V:</e> Mijn laptop ondersteunt het schalen van de kloksnelheid maar
<path>/sys/devices/system/cpu/cpu0/cpufreq/</path> is leeg.
</p>

<p>
<e>A:</e> Zoek naar ACPI gerelateerde foutmeldingen met <c>dmesg | grep
ACPI</c>. Probeer de BIOS te updaten, zeker als er een <e>broken DSDT</e> is
gemeld. Je kan dit ook zelf repareren, maar dit wordt hier niet uitgelegd.
</p>

<p>
<e>V:</e> Mijn laptop ondersteunt het schalen van de kloksnelheid maar volgens
<path>/proc/cpuinfo</path> verandert de snelheid nooit.
</p>

<p>
<e>A:</e> Waarschijnlijk heb je <e>symmetric multiprocessing support</e>
(CONFIG_SMP) in je kernel aangezet. Deactiveer dit en het zou moeten werken.
Sommige oudere kernels hebben een bug die dit veroorzaakt, doe in dat geval
<c>emerge x86info</c>, update je kernel zoals gevraagd en controleer de
momentele kloksnelheid met <c>x86info -mhz</c>.
</p>

<p>
<e>V:</e> Ik kan de kloksnelheid veranderen, maar de reikwijdte is niet zo
breed als in een ander OS.
</p>

<p>
<e>A:</e> Je kan <e>CPU Frequency scaling</e> combineren met <e>ACPI
throttling</e> om een lagere minimale kloksnelheid te bereiken. Merk wel op dat
throttling niet zoveel energie bespaart en vooral gebruikt is voor temperatuur
management (om je laptop koel en stil te houden). Je kan de momentele
throttling status bekijken met <c>cat /proc/acpi/processor/CPU/throttling</c>
en veranderen met <c>echo -n "0:x" > /proc/acpi/processor/CPU/limit</c>, waar x
een van de Tx waarden is uit <path>/proc/acpi/processor/CPU/throttling</path>.
</p>

<p>
<e>V:</e> Bij het configureren van de kernel zie ik die <e>powersave</e>,
<e>performance</e> en <e>userspace governors</e>, maar dat <e>ondemand</e> ding
is er niet. Waar vind ik dat?
</p>

<p>
<e>A:</e> De <e>ondemand governor</e> zit enkel in recente kernel sources,
probeer je kernel te updaten.
</p>

<p>
<e>V:</e> De batterij lijkt minder lang mee te gaan dan voorheen.
</p>

<p>
<e>A:</e> Controleer je BIOS instellingen, misschien ben je iets vergeten
terug in te inschakelen.
</p>

<p>
<e>V:</e> Mijn batterij is opgeladen maar KDE zegt dat er 0% over is en sluit
onmiddellijk af.
</p>

<p>
<e>A:</e> Controleer dat battery support in de kernel is ingebouwd, indien je
het als een module gebruikt, controleer dan of de module geladen is.
</p>

<p>
<e>V:</e> Mijn systeem logger maakt meldingen zoals "logger: ACPI group battery
/ action battery is not defined".
</p>

<p>
<e>A:</e> Dit bericht wordt gegenereerd door het
<path>/etc/acpi/default.sh</path> script dat bij acpid komt. Je kan dit gewoon
negeren. Als je er echt vanaf wil, moet je volgende lijn in
<path>/etc/acpi/default.sh</path> als volgt bewerken:
</p>

<pre caption="Waarschuwingen over acpi events uitschakelen">
        *)      # logger "ACPI action $action is not defined"
</pre>

<p>
<e>V:</e> Ik heb een Dell Inspiron 51XX en ik kan geen ACPI events krijgen.
</p>

<p>
<e>A:</e> Dit schijnt een kernel bug te zijn, lees <uri
link="http://bugme.osdl.org/show_bug.cgi?id=1752">hier</uri> meer.
</p>

<p>
<e>V:</e> Ik heb de <c>DynamicClocks</c> optie in <path>xorg.conf</path>
ingeschakeld en nu crasht X.org / blijft het scherm zwart / sluit de laptop niet
goed meer af.
</p>

<p>
<e>A:</e> Dit gebeurt op sommige systemen, je zal <c>DynamicClocks</c> moeten
uitschakelen.
</p>

<p>
<e>V:</e> Ik wil suspend2 gebruiken maar het zegt me dat mij swap partitie te
klein is en ik kan ze niet vergroten.
</p>

<p>
<e>A:</e> Als je genoeg vrije ruimte hebt kan je de <e>filewriter</e> gebruiken
in plaats van de <e>swapwriter</e>. Het <c>hibernate-script</c> ondersteunt dit
ook. Meer informatie kan gevonden worden in
<path>/usr/src/linux/Documentation/power/suspend2.txt</path>.
</p>

<p>
<e>V:</e> Ik heb net een gloednieuwe batterij gekocht en na enkele minuten is ze
leeg! Wat doe ik fout?
</p>

<p>
<e>A:</e> Volg het advies van de fabrikant over hoe je de batterij moet opladen.
</p>

<p>
<e>V:</e> Het bovenstaande hielp niet. Wat moet ik doen?
</p>

<p>
<e>A:</e> Sommige "nieuwe" batterijen zijn er eigenlijk oude. Probeer het
volgende:
</p>

<pre caption="Batterij status opvragen">
$ <i>grep capacity /proc/acpi/battery/BAT0/info</i>
design capacity:     47520 mWh
last full capacity:  41830 mWh
</pre>

<p>
Als de "last full capacity" duidelijk verschilt van de "design capacity" is je
batterij waarschijnlijk stuk. Probeer je garantie op te eisen.
</p>

<p>
<e>V:</e> Mijn probleem staat hier niet vermeld, wat moet ik nu doen?
</p>

<p>
<e>A:</e> Je kan steeds de auteur <mail link="earthwings@gentoo.org">Dennis
Nienhüser</mail> bereiken. De <uri link="http://forums.gentoo.org">Gentoo
Forums</uri> zijn ook een goede plaats om hulp te vragen. Als je liever IRC
gebruikt, probeer dan het <c>#gentoo-laptop</c> kanaal op <uri
link="irc://irc.freenode.net">irc.freenode.net</uri>.
</p>

</body>
</section>
</chapter>
</guide>
