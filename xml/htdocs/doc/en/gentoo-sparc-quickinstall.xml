<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/en/Attic/gentoo-sparc-quickinstall.xml,v 1.18 2006/05/18 13:44:20 neysx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/gentoo-sparc-quickinstall.xml">
<title>Gentoo Linux Sparc Quick Install Reference</title>

<author title="Author">
  <mail link="ciaranm@gentoo.org">Ciaran McCreesh</mail>
</author>

<abstract>
The Quick install reference covers all details of the sparc install process in a
non-verbose manner. Users should already have prior experience with 
installing Gentoo Linux if they want to follow this guide.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.11</version>
<date>2006-05-18</date>

<chapter>
<title>Sparc Quick Install Reference</title>
<section>
<body>

<p>
This guide is aimed at people who have prior experience of installing Gentoo
Linux. For more detailed instructions, please consult the <uri
link="http://www.gentoo.org/doc/en/handbook">Gentoo Handbook</uri>.
</p>

<p>
The installation ISOs and netboot images are on the <uri link=
"http://www.gentoo.org/main/en/mirrors.xml">Gentoo
Mirrors</uri>. The 'universal' and 'minimal' CDs are bootable and contain
the tools necessary to install Gentoo. The 'universal' CD also contains
stages and some distfiles. The 'packages' CD contains additional precompiled
packages for GRP installs. The netboot images contain no stages and a subset of
the standard toolset (note that you will have to use <c>vi</c> instead of
<c>nano</c> when netbooting).
</p>

<p>
Use <c>stop+A</c> (keyboard) or send a break (serial console) whilst booting to
enter OBP. Boot from either the universal or the minimal Gentoo CD using the
command <c>boot cdrom</c>, or from the netboot images using <c>boot net</c>.
Press return to use the default kernel, or hit tab to see a list of
alternative kernels.
</p>

<note>
For more information on OBP, see the <uri
link="/doc/en/gentoo-sparc-obpreference.xml">OpenBoot PROM (OBP)
Reference</uri> or consult Sun's "OpenBoot 3.x Command Reference" (P/N
802-3242).
</note>

<pre caption="Beginning settings">
# <i>date</i>  (Make sure your time and date is correct. If wrong, set it with  <i>date MMDDhhmmCCYY</i> )
# <i>modprobe module_name</i>  (Optional - Load any necessary modules)
# <i>ifconfig eth0 a.b.c.d netmask e.f.g.h broadcast i.j.k.l</i> (Configure the network)
# <i>route add -net default gw a.b.c.d netmask 0.0.0.0 metric 1 eth0</i> (Configure the default gateway)
# <i>echo "nameserver a.b.c.d" > /etc/resolv.conf</i> (Set up DNS)
# <i>fdisk /dev/sda</i> (Partition your drive)
</pre>

<p>
A sun disclabel is required for sparc machines. This can be created using 's'.
</p>

<p>
A separate /boot is not recommended for sparc. The root partition must be
entirely within the first 1GByte of the disc for all sparc32 machines. The
recommended filesystem is ext3. At least 512MBytes of RAM + swap is required for
bootstrap and some larger compiles.
</p>

<p>
Initialise your partitions using <c>mke2fs</c> (Ext2), <c>mke2fs -j</c> (Ext3)
and <c>mkswap</c> (swap partition). For instance: <c>mke2fs -j /dev/sda1</c>.
</p>

<p>
Continue by mounting the partitions and extracting the appropriate stage file.
</p>

<pre caption="Preparing the Installation">
(Activate the swap partition)                    # <i>swapon /dev/sdax</i>
(Mount the root partition)                       # <i>mount /dev/sdax /mnt/gentoo</i>
(Go to the mountpoint)                           # <i>cd /mnt/gentoo</i>
(Extract a stage tarball...)                     # <i>tar xvjpf /mnt/cdrom/stages/stage?-*.tar.bz2</i>
(<comment>or</comment> download the latest tarball...)              # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
(                  ... and extract)              # <i>tar xvjpf stage*</i>
(Optional: unpack a portage tree)                # <i>tar xvjf /mnt/cdrom/snapshots/portage-*.tar.bz2 -C /mnt/gentoo/usr</i>
(Optional: copy over distfiles)                  # <i>cp -R /mnt/cdrom/distfiles /mnt/gentoo/usr/portage/distfiles</i>
(Select a mirror)                                # <i>mirrorselect -a -s4 -o | grep 'GENTOO_MIRRORS=' &gt;&gt; /mnt/gentoo/etc/make.conf</i>
(Copy over nameserver information)               # <i>cp /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
(Mount the proc filesystem)                      # <i>mount -t proc none /mnt/gentoo/proc</i>
(Chroot into the new environment)                # <i>chroot /mnt/gentoo /bin/bash</i>
(Load the necessary variables)                   # <i>env-update; source /etc/profile</i>
(Network-only, non-GRP: update Portage)          # <i>emerge --sync</i>
</pre>

<p>
Now we install Gentoo:
</p>

<pre caption = "Installing Gentoo">
(Stage1 only:)
(  Change USE, CFLAGS and CXXFLAGS. Do not change CHOST) # <i>nano -w /etc/make.conf</i>
(  Bootstrap system)                                     # <i>cd /usr/portage; scripts/bootstrap.sh</i>
(Stage1 and Stage2 only:)
(  Install base system)                                  # <i>emerge system</i>
</pre>

<note>
Suitable CFLAGS for Sparc systems are <c>-mcpu=your_cpu -O2 -pipe</c>, where
<c>your_cpu</c> is one of <c>ultrasparc3</c>, <c>ultrasparc</c>, <c>v9</c> (64
bit systems) or <c>hypersparc</c>, <c>supersparc</c>, <c>v8</c> or <c>v7</c> (32
bit systems). The <c>-frename-registers</c> flag may also be of interest. Note
that, unlike on x86 systems, <c>-fomit-frame-pointer</c> is not
recommended.
</note>

<p>
Next we set up the necessary information:
</p>

<pre caption = "Setting up Configuration Files">
<comment>(Set timezone information)</comment>
# <i>cp /usr/share/zoneinfo/<comment>&lt;path to time zone file&gt;</comment> /etc/localtime</i>
<comment>(Edit fstab file)</comment>
# <i>nano -w /etc/fstab</i>
</pre>

<p>
Use the following as a <e>template</e> (don't copy verbatim) for
<path>/etc/fstab</path>:
</p>

<pre caption="/etc/fstab">
# &lt;fs&gt;                  &lt;mountpoint&gt;    &lt;type&gt;          &lt;opts&gt;                  &lt;dump/pass&gt;
/dev/sdax               none            swap            sw                      0 0
/dev/sdax               /               ext3            noatime                 0 1
/dev/cdroms/cdrom0      /mnt/cdrom      auto            noauto,user             0 0
none                    /proc           proc            defaults                0 0
none                    /dev/shm        tmpfs           nodev,nosuid,noexec     0 0
</pre>

<p>
Continue by installing the Linux kernel. Available kernel packages for Sparc
are <c>sparc-sources</c> (2.4) and <c>gentoo-sources</c>,
<c>vanilla-sources</c> (2.6). The <c>ultra1</c> USE flag should be set on Ultra
1 and Netra i 1 "Enterprise" and "Creator" models for proper support for the
onboard HME Ethernet controller.
</p>

<pre caption="Installing the Kernel">
(Install the kernel sources)                               # <i>emerge <comment>&lt;kernel-package-here&gt;</comment></i>
                                                           # <i>cd /usr/src/linux; make menuconfig</i>
(   (2) Include shmfs, procfs, devfs if not using udev)
(   (3) Compile your kernel)
(       - 2.4 kernels on sparc32)                          # <i>make dep &amp;&amp; make clean vmlinux modules modules_install</i>
(       - 2.4 kernels on sparc64)                          # <i>make dep &amp;&amp; make clean vmlinux image modules modules_install</i>
(       - 2.6 kernels on sparc32                           # <i>make &amp;&amp; make modules_install</i>
(       - 2.6 kernels on sparc64                           # <i>make &amp;&amp; make image modules_install</i>
(   (4) Copy over the kernel)
(       - 2.4 kernels on sparc32)                          # <i>cp vmlinux /boot/image</i>
(       - 2.4 kernels on sparc64)                          # <i>cp arch/sparc64/boot/image /boot</i>
(       - 2.6 kernels on sparc32)                          # <i>cp arch/sparc/boot/image /boot</i>
(       - 2.6 kernels on sparc64)                          # <i>cp arch/sparc64/boot/image /boot</i>
</pre>

<p>
Now install other tools you might want:
</p>

<pre caption = "Install important system tools">
(Install system logger; choice: sysklogd, metalog, msyslog, syslog-ng) # <i>emerge syslog-ng </i>
(Have the systemlogger automatically started at boot)                  # <i>rc-update add syslog-ng default</i>
(Install cron daemon; choice: vixie-cron, dcron, fcron)                # <i>emerge vixie-cron</i>
(Have the cron daemon automatically started at boot)                   # <i>rc-update add vixie-cron default</i>   
(Domain name init script)                                              # <i>rc-update add domainname default</i>
(2.6.x kernels only: udev can be used in place of devfs)               # <i>emerge udev</i>
</pre>

<note>
For more information on configuring udev, see the <uri
link="/doc/en/udev-guide.xml">Gentoo udev Guide</uri>. Note that the
<c>RC_DEVICE_TARBALL="no"</c> option is preferred on Sparc systems.
</note>

<p>
Finalise the settings for your Gentoo system:
</p>

<pre caption = "Finalise the Configuration Settings">
(Set root password)                                      # <i>passwd</i>
(Create a user)                                          # <i>useradd your_user -m -G users,wheel,audio -s /bin/bash</i>
(Set password for that user)                             # <i>passwd your_user</i>
(Set the system hostname)                                # <i>echo mymachine &gt; /etc/hostname</i>
(Set the system domainname)                              # <i>echo mydomain.com &gt; /etc/dnsdomainname</i>
(Set the hostsfile, ex:"127.0.0.1 localhost mymachine")  # <i>nano -w /etc/hosts</i>
(Configure basic system settings; follow comments)       # <i>nano -w /etc/rc.conf</i>
</pre>

<pre caption = "Set up Networking">
(Setup networking; dhcp-users should set config_eth0="dhcp")     # <i>nano -w /etc/conf.d/net</i>
(List modules to be loaded at startup)                           # <i>nano -w /etc/modules.autoload.d/kernel-<comment>&lt;version&gt;</comment></i>
(start networking automatically at boot)                         # <i>rc-update add net.eth0 default</i>
(Only if you have multiple network interfaces:)
   (1) Create initscripts for each interface)                    # <i>ln -s /etc/init.d/net.eth0 /etc/init.d/net.ethx</i>
   (2) Automatically start at boot)                              # <i>rc-update add net.ethx default</i>
</pre>

<p>
Now install the bootloader.
</p>

<pre caption="Installing SILO">
# emerge silo
# nano -w /etc/silo.conf
partition = 1
root = /dev/sda1
timeout = 150

image = /boot/image
    label = Gentoo
# silo
</pre>


<p>
Now unmount all partitions and reboot into your new system:
</p>

<pre caption="Finishing off and installing GUI">
(Exiting the chroot)                            # <i>exit; cd /</i>
(Unmounting partitions)                         # <i>umount /mnt/gentoo/proc /mnt/gentoo</i>
(Reboot; Remove the install CD from the tray)   # <i>reboot</i>
(After booting:)
(GRP-users only)
(  (1) Mount CD2)                               # <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>  
(  (2) Copy over packages)                      # <i>cp -a /mnt/cdrom/packages/* /usr/portage/packages/</i>
(  (3) Install extra software)                  # <i>USE="bindist" emerge -k xorg-x11 gnome kde mozilla</i>
(  (4) Configure your Xserver)                  # <i>$EDITOR /etc/X11/XF86Config</i>
</pre>

<p>
You can get more information from the <uri
link="http://www.gentoo.org/doc/en/index.xml">Gentoo
Documentation</uri>.
</p>
</body>
</section>
</chapter>
</guide>
