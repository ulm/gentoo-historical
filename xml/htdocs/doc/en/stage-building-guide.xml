<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/stage-building-guide.xml">

<author title = "Author"><mail link = "zhen@gentoo.org">John P. Davis</mail></author>
<author title = "Author"><mail link = "avenj@gentoo.org">Jon Portnoy</mail></author>
<author title = "Editor"><mail link = "peesh@gentoo.org">Jorge Paulo</mail></author>

<license/>

<version>1.1</version>
<date>15 Jun 2003</date>

<abstract>This guide is an explanation of how to build stages for
Gentoo Linux.</abstract>

<chapter>
	<title>Preliminaries</title>
	<section>
		<title>Introduction</title>
		<body>
		<p>This guide is an explanation of how to build fresh
		stages for Gentoo Linux using stager, our stage-building application.</p>

	</body>
	</section>
	<section>
		<title>Getting The Source</title>
		<body>
		<p>Before building anything, it is necessary to get the required source, tools, etc.
		First of all, make sure that you have the <i>gentoo-src</i> module checked out of CVS
		and that it is up to date. The build scripts change frequently, so make sure that you stay current.
		If you do not have access to the gentoo-src module, a snapshot of stager can be found at
		<uri>http://dev.gentoo.org/~avenj/stager/</uri>.
		Additionally, the most recent experimental stage1 tarball is 
		required. This can usually be found at <path>experimental/x86/stages</path> on any Gentoo mirror. The tarball that you will be looking for is 
		<i>stage1-x86-1.4_pre<i>DATE</i></i>.tar.bz2, where <i>DATE</i> is the most recent date available. 
		</p>
		
		</body>
	</section>
</chapter>

<chapter>
	<title>The Build Process</title>
	<section>
		<title>First Steps</title>
		<body>
		<p>First create a directory on a nice big partition to hold all of the build files. Next, copy the <path>stager</path>
		directory from <i>gentoo-src</i> into this new
		directory (which will be referred to as <path>/usr/src/build</path> in this document). Alternatively, extract the tarball of the snapshot into this directory. 
		Finally, create a directory inside <path>/usr/src/build</path> called <i>stages</i>
		and put the experimental stage1 tarball in there.
		</p>

		<pre caption="Getting Ready">
# <c>mkdir /usr/src/build </c>
<codenote>You can change the above path to whatever you want.</codenote>

# <c>cp -R /gentoo-src/stager/ /usr/src/build</c>
# <c>cd /usr/src/build/stager ; mkdir stages</c>
# <c>mv stage1-x86-1.4_preDATE.tar.bz2 /usr/src/build/stager/stages</c>

		</pre>

		</body>
	</section>


	<section>
		<title>Building</title>
		<body>
		<p>First we need to build a stage2 tarball that uses generic optimizations. This tarball
		will be used to build any new fresh stages, including a fresh stage1.
		</p>

		<pre caption="Building stage2">
# <c>./stager x86 2 orig dest</c>
<codenote>Above, orig refers to the date in the name of the experimental tarball.</codenote>
<codenote>Dest refers to the date of the new tarball. Replace these accordingly.</codenote>		
		</pre>

		<p>Once this build finishes, you should have a fresh stage2 tarball alongside your original stage1 tarball in the <path>stages</path>
		directory. Now you can build a new stage1 from your stage2 using basically the same method:
		</p>

		<pre caption="Building new stage1">
# <c>./stager x86 1 dest dest</c>
		</pre>

		<p>Tada - you've built a fresh stage1 alongside your original stage1 and new stage2. Now you can build non-generic tarballs that are
		optimized for specific CPU sub-types. Be warned that these optimized tarballs <i>cannot</i> be used to build other stages. Only
		generic tarballs should be used to build other stages. Building for other sub-types is the same - merely replace x86 with the specific sub-type.
		For a list of subtypes, execute stager without any arguments.</p>

		</body>
	</section>

</chapter>

<chapter>
	<title>Final Notes</title>
	<section>
		<title>Contacts</title>
		<body>
		
		<table>
		<tr>
			<th>Contact</th>
			<th>Function</th>
		</tr>
		<tr>
			<ti><mail link="avenj@gentoo.org">Jon Portnoy</mail></ti>
			<ti>Gentoo Linux Release Manager</ti>
		</tr>
		<tr>
			<ti><mail link="jhhudso@gentoo.org">Jared Hudson</mail></ti>
			<ti>Release quality assurance</ti>
		</tr>
		<tr>
			<ti><mail link="zhen@gentoo.org">John Davis</mail></ti>
			<ti>Author</ti>
		</tr>
		<tr>
			<ti><mail link="avenj@gentoo.org">Jon Portnoy</mail></ti>
			<ti>Author</ti>
		</tr>
		</table>
		
		</body>
	</section>
</chapter>
</guide>
			
		

		
