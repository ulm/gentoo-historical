<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/en/gentoo-ppc-faq.xml,v 1.38 2005/07/29 17:31:26 josejx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/gentoo-ppc-faq.xml">

<title>Gentoo Linux/PowerPC Frequently Asked Questions</title>

<author title="Editor">
  <mail link="rajiv@gentoo.org">Rajiv Manglani</mail>
</author>
<author title="Editor">
  <mail link="pylon@gentoo.org">Lars Weiler</mail>
</author>
<author title="Editor">
  <mail link="sejo@gentoo.org">Jochen Maes </mail>
</author>
<author title="Editor">
  <mail link="josejx@gentoo.org">Joseph Jezak</mail>
</author>

<abstract>
This FAQ is a collection of questions and answers collected from the
gentoo-ppc-dev mailing list and from IRC -- if you have any questions (or
answers!) to add, please contact either an author or a member of the
documentation team.
</abstract>

<license/>

<version>1.19</version>
<date>2005-07-29</date>

<chapter>
<title>Installation</title>
<section>
<title>How do I verify with Mac OS X the downloaded ISO is not corrupted?</title>
<body>

<p>
First be sure you did not mount the ftp server with <e>Finder</e> and then copy
the file with drag'n'drop.  This will corrupt the ISO.  Instead, use <c>curl</c>
(with <c>curl -O http://path/to/iso</c>).
</p>

<p>
As long as Mac OS X does not offer <c>md5sum</c>, you have to use the
<c>openssl</c> capability to produce an md5 checksum.  Therefore, type in
a Terminal the following:
</p>

<pre caption="md5sum with the help of openssl">
<comment>(This could take some time depending of the size of the ISO and your CPU)</comment>
$ <i>openssl md5 /path/to/iso</i>
</pre>

<p>
Now compare this output with the appropriate file found on the server
where you downloaded the ISO (the file will end with <path>.md5</path>).
If it is the same, the ISO image downloaded correctly.  Be sure you have 
<e>not</e> mounted it (e.g. with Disk Copy) yet!
</p>

</body>
</section>
<section>
<title>Can I dual-boot Gentoo Linux and Mac OS X?</title>
<body>

<p>
Yes you can! In fact, <e>yabootconfig</e> will automatically detect
and setup <path>/etc/yaboot.conf</path> with Linux, Mac OS X and even
classic Mac OS (see the 
<uri link="/doc/en/handbook/handbook-ppc.xml?part=1&amp;chap=10">Gentoo Handbook
</uri> for details on yabootconfig). The trick is in how you partition your hard
drive. Before installing Gentoo, startup with the Mac OS X Install CD. Use the 
<c>Disk Utility</c> to partition the drive in your machine into two or three 
partitions.  Alternatively, use <c>parted</c> from the recent LiveCD, since that
can handle HFS and HFS+ partitions.  Parted is also able to shrink a partition 
so you don't need to delete your existing install. The first partition should 
be big enough to contain all your Linux partitions (root+swap+/home etc.). The 
format of this partition does not matter.  The second partition should be for 
OS X.  The third (and optional) partition should be for classic Mac OS. It is 
needed only if you want to put Mac OS 9 on a separate partition.
</p>

<note>
If you want to be able to triple-boot with yaboot, Mac OS 9 needs
to be on a separate partition from your Mac OS X installation.
</note>

<p>
After partitioning, install Mac OS X and Mac OS 9 onto their
respective partitions. Once installation is complete, start following
the <uri link="/doc/en/handbook/handbook-ppc.xml">Gentoo Handbook</uri>.
When you get to the section on partitioning, use <c>mac-fdisk</c> to 
<e>delete</e> the large partition you created for Gentoo. In its place, 
create a bootstrap partition, root, swap, and any other partitions you 
wish to use with Gentoo.
</p>

<p>
If you have an OldWorld Macintosh (pre-iMac), follow a similar
procedure as described above. However, use the Mac OS 9 install CD and
the <c>Drive Setup</c> utility. OldWorld machines do not need a
bootstrap partition.
</p>

<note>
If yabootconfig does not detect your MacOS partitions, you can manually add 
them to your yaboot.config.  See the example yaboot.conf in the 
<uri link="/doc/en/handbook/handbook-ppc.xml?part=1&amp;chap=10#doc_chap_pre6">
handbook</uri> for details.
</note>

</body>
</section>
<section>
<title>
I have an early NewWorld Mac such as the Blue and White G3.  It should be
compatible with the LiveCD, but on boot it returns an "Unknown or corrupt
filesystem" error.
</title>
<body>

<p>
As a workaround, boot into Open Firmware by holding down the Apple + Option +
O + F keys on startup.  When the prompt appears, type:
</p>

<pre caption="Early NewWorld Mac Open Firmware work around">
<i>boot cd:,\\yaboot</i>
</pre>

<p>
The CD should load as expected afterwards.  Thanks to John Plesmid for this
workaround.
</p>

</body>
</section>
<section>
<title>
I have an OldWorld Macintosh and need to use BootX. However, I am having trouble
opening the BootX installer archive. What can I do?
</title>
<body>

<p>
You will need a new version of <e>StuffIt Expander</e> to open the archive. 
You can 
<uri link="http://www.stuffit.com/expander/download.html">download it</uri>
for free.
</p>

</body>
</section>
<section>
<title>
Is it possible to boot Gentoo Linux on an OldWorld machine without Mac OS? I 
would like to have a Mac OS-free machine.
</title>
<body>

<p>
If you have a lot of time to experiment, you could try 
<uri link="http://penguinppc.org/projects/quik/">Quik</uri>. <e>Quik</e> is a
bootloader for OldWorld PPC machines. If your machine uses <e>BootX</e>, you can
use <e>Quik</e>; if it uses <e>yaboot</e>, you can't.  <e>Quik</e> can be
incredibly difficult to install, but the end result is somewhere between "neato"
and "breathtaking" because Mac OS does not have to load. Think yaboot on speed.
</p>

<p>
Be sure to read the <uri
link="http://penguinppc.org/projects/quik/quirks.shtml">Quik quirks
page</uri> for help getting your Old World PPC booting with Quik. The
"<uri link="http://www.netbsd.org/Ports/macppc/models.html">NetBSD/MacPPC Model
Support</uri>" documents various OpenFirmware versions for various Apple and 
clone PowerPC machines and is also a helpful reference.
</p>

<p>
Thanks to vladimir for this information.
</p>

</body>
</section>
<section>
<title>
I have a Beige G3 machine. Can I install Gentoo Linux/PPC on a second IDE hard 
drive?
</title>
<body>

<p>
Early Beige G3 machines (those with a "Rev 1" motherboard with an ATI
RageII+ chip) do not support slave IDE drives. To use a second hard drive
with this machine, you would have to attach it to the internal or external
SCSI connector, use install a PCI IDE card. Later G3 machines do not have
this limitation. See
<uri>http://www.xlr8yourmac.com/G3-ZONE/IDE/index.html</uri> for more
information.
</p>

</body>
</section>
<section>
<title>
When I try and install Gentoo on my PowerBook or iBook the internal
hard drive does not show up. What should I do?
</title>
<body>

<p>
For a PowerBook, pass <c>hda=1,1,1</c> to the kernel at boot time.
That should solve your problems. You can do this at <e>yaboot</e> prompt
by typing <c>boot hda=1,1,1</c>. Some iBooks need
<c>hda=16383,16,64</c>.
</p>

</body>
</section>
<section>
<title>
I have a revision A or B iMac.  I've replaced the hard drive with a larger one
and now I can't boot into anything!
</title>
<body>

<p>
There is an 8GB limit for the root partition on these machines.  Ensure that
your root partition is less than 8GB and it should work as expected.  This also
applies to OS X and later versions of OS 9.
</p>

</body>
</section>
<section>
<title>
My /etc/fstab file has /dev/BOOT in it. Do I need to setup this line for my 
bootstrap partition?
</title>
<body>

<p>
No. If you are not running a separate boot partition (<path>/boot</path>) then 
you do not need this line and can safely just delete it from 
<path>/etc/fstab</path>.  The bootstrap partition is <e>not</e> 
<path>/boot</path> and is not related in anyway. In general, PowerPC machines 
do not need a separate <path>/boot</path> partition, and the bootstrap partition
should not be mounted.
</p>

</body>
</section>
<section>
<title>
When I rebooted, yaboot didn't work! Now, I'm stuck. How can I fix this?
</title>
<body>

<p>
It's probably just a misconfigured yaboot.conf.  The easiest way to fix 
this is to boot the LiveCD again, mount your gentoo partition and check 
yaboot.conf for errors.  You'll also need to run 
<c>ybin -v -C /mnt/gentoo/etc/yaboot.conf</c> to update the boot loader once
you have finished.  This can all be done without chrooting back into your
install.
</p>
  
<note>
If you <e>really</e> just need to get back to OSX, try holding down the Option
key on startup.  This should give you a graphical selection of bootable disks.
Choose OSX and remember to fix your boot problems later.
</note>

</body>
</section>
<section>
<title>
Installation is now complete. However after rebooting, I am getting
different characters than the keys I press on my machine's keyboard. What
should I do?
</title> 
<body>

<p>
If this is an English keymap, you likely have a kernel config issue.
You will need to rebuild your kernel with the following options:
</p>

<pre caption="Input core support">
<comment>(these are the defaults, but check them)</comment>
&lt;*&gt; Input core support
&lt;*&gt;   Keyboard support 
&lt;*&gt;   Mouse support
(1024)   Horizontal screen resolution
(768)    Vertical screen resolution
&lt; &gt;   Joystick support
&lt;*&gt;   Event interface support
</pre>

<pre caption="Macintosh Device Drivers">
[*] Apple Desktop Bus (ADB) support
[*]    Use input layer for ADB devices
[*]      Support for mouse button 2+3 emulation
</pre>

<p>
This way, you will still be able to use <path>/proc/sys/dev/mac_hid</path> to 
emulate buttons 2 and 3 (see next question).
</p>

<p>
If, for some reason you do not want to recompile your kernel, append
<c>keyboard_sends_linux_keycodes=1</c> to the kernel arguments in
<path>yaboot.conf</path>. This will also correct the problem, but might
possibly introduce other problems.
</p>

<p>
Thanks to Joe McMahon for help with this answer.
</p>

</body>
</section>
<section>
<title>
I only have one mouse-button.  How can I make use of the second and third one, 
since ctrl-button does not work?
</title>
<body>

<p>
There is no way to use ctrl-button like on Mac OS X, but you can map just about
any key or combination of keys to emulate the second and third mouse-button.  
The values can be obtained with the command line utility <c>showkey</c> from the
console.  Note that this program does not work as expected from X and should 
only be run from the console.  In addition to having the kernel configuration 
settings from the previous section, you will also need to set the mouse button
values in <path>/etc/sysctl.conf</path>.  Here is an example using F11 and F12:
</p>

<pre caption="Mouse button emulation with F11 and F12">
<comment># Enable mouse button emulation</comment>
dev.mac_hid.mouse_button_emulation = 1
<comment># Set 2nd button to 87 - F11</comment>
dev.mac_hid.mouse_button2_keycode = 87
<comment># Set 3rd button to 88 - F12</comment>
dev.mac_hid.mouse_button3_keycode = 88
</pre>

<p>
Other commonly used keycodes are 125 (The Apple key) and 96 (The Keypad Enter).
</p>

<note>
The easiest way to activate these settings it to reboot after changing them.
</note>

</body>
</section>
<section>
<title>
Installation is now complete. However, after my machine boots into
Gentoo and I try to emerge anything, I see errors saying it cannot 'stat'
a file. What is wrong?
</title>
<body>

<p>
Check to see that your time is set correctly. Setting your time and
linking <path>/etc/localtime</path> to your proper timezone (in
<path>/usr/share/zoneinfo</path>) will solve your problems. Also make
sure that you have <e>not</e> enabled the <e>Enhanced RTC</e> option in
the <e>Character devices</e> section of the kernel configuration (as
stated in install guide).
</p>

</body>
</section>
</chapter>

<chapter>
<title>Laptop Support</title>
<section>
<title>
How do I enable the full processor speed on my PowerBook while running Linux?
</title>
<body>

<note>
Most (if not all) processors should now work at the correct speed with modern 
kernels.  If you still have this problem, you should upgrade to the latest 
kernel and try again, only use this as a backup solution.
</note>

<p>
Some processors in PowerBooks start up at slower speed than they are
designed to run. Running at this slower speed conserves battery life
with the tradeoff of performance. The operating system on the machine
must instruct the hardware to run at its full speed. In Mac OS X this is
called "Reduced processor performance" or "CPU Scaling" in Linux. To
check the current speed of your processor while running in Linux, type
<c>cat /proc/cpuinfo</c>. In Mac OS X, you first have to turn off
"Reduce processor performance" in the "Options" tab of the <e>Energy Saver</e>
system preference panel. Then run <e>Apple System Profiler</e> (in
Applications:Utilities).
</p>

<warn>
Do not use this method to overclock your machine. Results are
unpredictable if you use an improper value. We are not responsible if
you fry your machine!
</warn>

<p>
If <e>Apple System Profiler</e> reports a higher speed than what you
get when running in Linux, you can enable the full speed of the
processor with a simple command. First, your machine needs to be running
kernel <c>2.4.20-pre9-ben0</c> or later. Earlier kernels do not have the
code necessary to change the processor speed. Second, you will need to
compile the kernel with <c>CPU Frequency scaling</c> <e>disabled</e>.
Finally, run an appropriate command as shown in the examples below.
</p>

<pre caption="CPU Frequency scaling">
<comment>(These are examples only. Use values appropriate for your machine.)</comment>

echo "0:667000:1000000:performance" > /proc/cpufreq    <comment>(For a 1GHz PowerBook G4)</comment>
echo "0:667000:800000:performance" > /proc/cpufreq     <comment>(For an 800MHz PowerBook G4)</comment>
</pre>

<p>
Many users will want to add this command to the end of
<path>/etc/conf.d/local.start</path>. This file is sourced every time
your machine starts.
</p>

</body>
</section>
<section>
<title>
I'm running Gentoo on a PowerPC laptop. What packages should I
install to enable laptop-specific functionality?
</title>
<body>

<p>
There are four main packages you will need to install.
</p>

<ul>
  <li>
    <e>pbbuttonsd</e> is a tool that enables the brightness and volume
    keys on most ppc laptops.  The current versions also work as a
    powermanager.
  </li>
  <li>
    <e>gtkpbbuttons</e> gives you a gtk front end for pbbuttonsd
    (visual feedback on button presses in X).  <e>gtkpbbuttons</e>
    requires gtk and should be added to your X session file
    (<path>~/.Xsession</path>) for best results (so that it is always
    running while in X).
  </li>
  <li>
    <e>powerprefs</e> ties together with pbbuttonsd, and gives you the
    ability to edit settings such as power-management, trackpad options
    and various other preferences.
  </li>
  <li>
    <e>cpudyn</e> allows cpu speed scaling for longer battery life. Other
    packages also provide the same functionality, such as <e>powernowd</e>,
    <e>cpufreqd</e> and <e>speedfreq</e>.
  </li>
</ul>

<p>
These packages can be installed by running the appropriate commands from the 
list below:
</p>

<pre caption="Installing laptop-specific packages">
# <i>emerge pbbuttonsd; rc-update add pbbuttonsd default</i>
# <i>emerge gtkpbbuttons</i>
# <i>emerge powerprefs</i>
# <i>emerge cpudyn</i>
</pre>

<note>
You should edit <path>/etc/pbbuttonsd.conf</path> to better suit your needs.
The behaviour of the Fx-keys can be controlled here as well as many sleep
options.  To switch the Fx-keys to the OSX behaviour, set KBDMode to fkeyslast.
You can turn off touchpad tapping by setting TPMode to notap.  Many other 
options are available, see man pbbuttonsd.conf for details.
</note>

<p>
It is useful to add pbbuttonsd and cpudyn to your boot runlevel so that they're
started when your computer starts.  To do this:
</p>
<pre caption="Adding pbbuttonsd and cpudyn to the boot runlevel">
# <i>rc-update add pbbuttonsd boot</i>
# <i>rc-update add cpudyn boot</i>
</pre>

</body>
</section>
<section>
<title>How can I configure my machine's Airport or other Wi-Fi card?</title>
<body>

<p>
Make sure you have support for the airport card compiled into the kernel, or 
compiled as a module and loaded. Changing the wireless settings is accomplished
using iwconfig.  This is part of the <c>wireless-tools</c> package.
</p>

<p>
As an example of using iwconfig, to set your SSID to home_ssid:
</p>

<pre caption="Setting an SSID">
# <i>iwconfig wlan0 essid home_ssid</i>
</pre>

<p>
Where wlan0 is your wifi card's device name.  For Airport users, the wifi device
is often eth1.  For more details on iwconfig, refer to its man page.
</p>

<note>
Airport Extreme cards are not yet supported on Linux.
</note>

</body>
</section>
<section>
<title>Will the internal modem in an iBook2 or PowerBook work?</title>
<body>

<note>
Unless you have purchased a key from Linuxant, this driver will only work at
14.4 and will not support FAX.
</note>

<p>
Emerge <c>net-dialin/hcfusbmodem</c> which will provide
<path>/dev/ttySHCF0</path>.  Then set up ppp like usual.  Further
information about the installation can be found at
<uri>http://www.linuxant.com/drivers/hcf/install.html</uri>
</p>

</body>
</section>
<section>
<title>Does sleep work on my iBook/PowerBook?</title>
<body>

<p>
Sleep (suspend to ram) works very well on all G3 iBooks and TiBooks.  Recently,
a kernel patch has been released that adds sleep support for G4 iBooks and 
Radeon based AlBooks.  If you have one of these laptops, use 
vanilla-sources-2.6.12 or gentoo-sources 2.6.11 for built in support.
</p>

<note>
Note that the 12" PowerBook is not yet supported due to its nVidia chipset.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Applications</title>
<section>
<title>
I can't emerge a package, and get an error about it being masked.  What should I
 do?
</title>
<body>

<p>
There are two common reasons why a package will not emerge: either it hasn't
been tested on PPC or it has been tested, but hasn't yet been marked stable.
</p>

<p>
If your package hasn't yet been tested on PPC, youll need to first mark the
ebuild with the ppc keyword.  This is done using the ekeyword tool which is 
part of the gentoolkit-dev package.  To mark the ebuild ppc:
</p>

<pre caption="Adding the ppc keyword to app-foo/bar">
$ <i>ekeyword ppc /usr/portage/app-foo/bar/bar-1.0.ebuild</i>
</pre>

<p>
Once the ebuild has been keyworded, you can now emerge it as usual.  Test the
application and if it works, <b>please</b> report it as a bug so one of the 
developers can add the keyword.
</p>

<note>
This change will only last until the next sync.  If you need a more permanent 
fix, you can maintain a portage overlay.  See the portage documentation for 
more information.
</note>

<p>
If your package already has the ~ppc keyword, you have two options.  Either
follow the above instructions and replace the ~ppc keyword with ppc, or you can
use /etc/portage to unmask the specific package.
</p>

<pre caption="Using /etc/portage to unmask app-foo/bar">
$ <i>echo "=app-foo/bar-1.0 ~ppc" > /etc/portage/package.keywords</i>
</pre>

<note>
If the /etc/portage directory does not exist, make sure to create it first.
</note>

<p>
Now emerge the package as normal.  Once you're sure the app is stable, <b>please
</b> report this as a bug so the developers can add the keyword.
</p>

</body>
</section>
<section>
<title>Does Gentoo/PPC have support for Flash?</title>
<body>

<p>
Well, not really. Macromedia has not supplied a linux/ppc binary and open source
implementations are incomplete and buggy at this time. Two projects that are
working on this problem are <uri link="http://gplflash.sf.net">gplflash2</uri>
and <uri link="http://swfdec.sf.net">swfdec</uri>, so check with these projects
for more information.  A possible workaround for now is to use qemu (an x86
emulator) to run the Macromedia Flash Player 6 stand alone player.  This process
was described on the forums: 
<uri>http://forums.gentoo.org/viewtopic.php?t=117774</uri>
</p>

</body>
</section>
<section>
<title>Does Gentoo/PPC have a Java plugin?</title>
<body>

<p>
No, not at this time.  The older java plugin is no longer compatible with the
new Mozilla plugin system and a new plugin has not yet been written.
</p>

</body>
</section>

<section>
<title>Is there an easy way to configure X?</title>
<body>

<p>
Simply emerge <c>Xautoconfig</c>.  Once the package has been emerged, run
Xautoconfig to generate the config for your setup.  To enable DRM, you may need
to do further tweaking, see the sections below.
</p>

</body>
</section>
<section>
<title>
How can I enable Direct Rendering (DRM) on rage128 or radeon cards?
</title>
<body>

<p>
Make sure in your kernel config you have the following options set:
</p>

<pre caption="DRM kernel configuration">
Device Drivers - Character devices ---&gt;
  &lt;*&gt; /dev/agpgart (AGP Support)
  [*] Apple UniNorth support
  [*] Direct Rendering Manager (DRI support)
  &lt;*&gt;   ATI Rage 128
  &lt;*&gt;   ATI Radeon
Device Drivers - Graphics Support ---&gt;
  &lt;*&gt;   ATI Rage 128 display support
  &lt;*&gt;   ATI Radeon display support 
</pre>

<p>
Rebuild and install the kernel if necessary. After this, make sure you
have booted to the native framebuffer (i.e. radeonfb or atyfb and
<e>not</e> from offb or ofonly video), and run <c>Xautoconfig</c>.
</p>

<impo>
You may need to edit your <path>/etc/X11/xorg.conf</path> file depending
on your card setup. Ensure that the device driver selected is either 
ati or your specific driver (r128 or radeon).  Also check that the
DRI extension is loaded and not commented out.
</impo>

<note>
There currently isn't any DRI support for the R300/R400 chipsets, a project has
been started at <uri>http://r300.sourceforge.net</uri>. nVidia chipsets are also
mostly unsupported on PPC, there is basic 2D acceleration provided by the nv 
driver, but no 3D acceleration.
</note>

</body>
</section>
<section>
<title>
I recently emerged Xorg, but when using it, my international
keyboard layout does not work correctly. The main keys work fine but I am
unable to compose special characters like the "at" sign. The startx output
says something like "could not load keymap, falling back to default
keymap". What is wrong?
</title>
<body>

<p>
Check that the permissions on <path>/var/tmp</path> are set to
<path>drwxrwxrwx</path>. If not, change them by typing <c>chmod a+rwx
/var/tmp</c>. This will allow Xorg to load keymaps properly again.
</p>

</body>
</section>
<section>
<title>
When using OpenGL DRI or playing movies, the system sometimes freezes hard 
unexpectedly. What can I do?
</title>
<body>

<p>
Your system may not cope properly with AGP support.  The easiest 
solution is to add the following line to the "Device" section 
of <path>/etc/X11/xorg.conf</path>:
</p>

<pre caption="Forcing PCI mode for AGP-Cards">
Option       "ForcePCIMode"
</pre>

<p>
Also, there are some known issues with the composite and damage
extensions included with the newer X.org releases.  Please disable
these extensions if you're having problems. 
</p>

</body>
</section>
<section>
<title>How do I get sound playback working?</title>
<body>

<p>
There are two approaches to sound on modern kernels: OSS or ALSA.  OSS is the 
older of the two options and has been depreciated, but still functions well for
many older Macs.  ALSA is the newer method and will continue to be supported in 
the future.  We recommend that you use ALSA unless you have problems.
</p>

<note>
If you include the OSS driver in your kernel, the ALSA driver will not load.
</note>

<p>
In addition to configuring the kernel, users who should have access to the 
audio devices need to be added to the appropriate group with the command:
</p>

<pre caption="Adding users to the audio group">
# <i>gpasswd -a username audio</i>
</pre>

<p>
If the kernel is set up correctly, but you can't hear any sound, ensure that
the main mixer volume is turned up and that the device isn't muted!
</p>

<note>
If you are using a G5 or a mac-mini, you should follow the Gentoo ALSA
configuration guide to install the latest version of the ALSA drivers instead of
the versions supplied by the kernel.
</note>

</body>
</section>
<section>
<title>Sound setup with ALSA</title>
<body>

<p>
For ALSA, we'll set up both the regular ALSA drivers and the OSS emulation
layer so that we can still use legacy OSS only programs.  In <c>make 
menuconfig</c> you'll need to select:
</p>

<pre caption="Kernel options for ALSA">
Device Drivers - Sound ---&gt;
&lt;*&gt; Sound card support
    Advanced Linux Sound Architecture ---&gt;
    &lt;&nbsp;&gt;   PowerMac DMA sound support
      &lt;*&gt; Advanced Linux Sound Architecture
      &lt;*&gt; Sequencer support
      &lt;*&gt; Sequencer dummy client
      &lt;*&gt; OSS Mixer API
      &lt;*&gt; OSS PCM (digital audio) API
      [*] OSS Sequencer API
          ALSA PowerMac devices ---&gt;
	   &lt;*&gt; PowerMac (AWACS, DACA, Burgundy, Tumbler, Keywest)
</pre>

<p>
(or configure as modules and ensure they're loaded on boot).
</p>

<note>
Please make sure that <c>PowerMac DMA sound support</c> is turned off,
otherwise the ALSA module will not be able to load.
</note>

</body>
</section>
<section>
<title>Sound setup with OSS</title>
<body>

<note>Again, only use this if you're not using ALSA.</note>

<p>
In <c>make menuconfig</c> you'll need to select:
</p>

<pre caption="Kernel options for OSS">
&lt;*&gt; Sound card support
  &lt;*&gt;   PowerMac DMA sound support
</pre>

<p>
(or configure as modules and ensure they're loaded on boot).
</p>

<p>
If the <c>dmasound_pmac</c> module does not load, you probably need to
enable <c>i2c-core</c> in the kernel or as a module.
</p>

</body>
</section>
<section>
<title>How do I play Audio CDs?</title>
<body>

<p>
NewWorld machines have no audio connection between their CD-ROM drive
and their sound hardware. Therefore, audio information must be read as
data and then piped to the sound hardware. This is possible using
<e>xmms</e> and the <e>xmms-cdread</e> plugin, that reads the audio off
the CD over the ATA cable, decodes it in software and sends it to the
sound card over the PCI bus as digital data.  If you want 'true'
cd-playing, you have to do the following steps:
</p>

<p>
First, you will need to rebuild your kernel with the following options:
</p>

<pre caption="Kernel options for playing audio-CDs">
<comment>(In "ATA/IDE/MFM/RLL Support")</comment>
<comment>(In "IDE, ATA, and ATAPI Block Devices")</comment>
&lt; &gt; Include IDE/ATAPI CDROM support  <comment>(turn this OFF)</comment>
&lt;M&gt; SCSI emulation support           <comment>(compile this as a module)</comment>

<comment>(In "SCSI Support")</comment>
&lt;M&gt; SCSI support                     <comment>(compile this as a module)</comment>
&lt;M&gt; SCSI CD-ROM support              <comment>(compile this as a module)</comment>
</pre>

<p>
Then, append <c>hdX=ide-scsi</c> to the kernel image section(s) in
<path>/etc/yaboot.conf</path> where <c>hdX</c> is the IDE device
corresponding to your CD player. This is usually <c>hdc</c>. Type
<c>ybin -v</c> to install the new yaboot.conf settings. Edit
<path>/etc/group</path> add any users who should be able to play CDs to
the <c>cdrom</c> group. You will now need to reboot your system for the
kernel changes to take effect.
</p>

<p>
Upon reboot, <c>su</c> to root and change the permissions of the cd device, 
then install xmms:
</p>

<pre caption="Changing permission for cdrom and install xmms-read">
# <i>chown root:cdrom /dev/scsi/host0/bus0/target0/lun0/cd</i>
# <i>chmod 660 /dev/scsi/host0/bus0/target0/lun0/cd</i>
# <i>emerge xmms xmms-cdread</i>
</pre>

<note>
Make sure to use the path corresponding to the CD drive on your machine.
</note>

<p>
To play a CD, fire up <c>xmms</c> and enter <c>/dev/cdrom</c> as the
file you want to play.
</p>

</body>
</section>
<section>
<title>Can I run Mac OS 9 or Mac OS X under Gentoo Linux?</title>
<body>

<p>
Yes, as long as you are running Gentoo Linux on PPC hardware, you can use <uri
link="http://www.maconlinux.org/">Mac-on-Linux</uri> which allows you to run an
instance of OS 9, OS X or Linux as a process on Linux. Simply <c>emerge mol</c>
to install this package. MOL supports Mac OS 7.5.2 to 9.2.2, as well as any 
version OS X except Tiger (support is currently in progress). It can be run from
a console framebuffer or run in a window on X.
</p>

<note>
To run MOL fullscreen, you'll need to compile MOL with the fbcon use flag 
enabled and run it in a console framebuffer.
</note>

<p>
For networking and sound you should install the drivers in the folder
<path>MOL-Install</path> on your Mac OS X-Desktop.  If errors with
networking occur, make sure you have the following kernel options
enabled:
</p>

<p>
For the dhcp server:
</p>

<ul>
  <li>Socket Filtering (CONFIG_FILTER)</li>
  <li>Packet Socket (CONFIG_PACKET)</li>
</ul>

<p>
For NAT:
</p>

<ul>
  <li>Network packet filtering (CONFIG_NETFILTER)</li>
  <li>Connection tracking (CONFIG_IP_NF_CONNTRACK)</li> 
  <li>IP tables support (CONFIG_IP_NF_IPTABLES)</li> 
  <li>Packet filtering (CONFIG_IP_NF_FILTER)</li> 
  <li>Full NAT (CONFIG_IP_NF_NAT)</li>
  <li>MASQUERADE target support (CONFIG_IP_NF_TARGET_MASQUERADE)</li>
</ul>

</body>
</section>
<section>
<title>Can I access my ext2/ext3 partitions from OSX?</title>
<body>

<p>
OSX can support the reading and writing of ext2/ext3 partitions by using the 
kernel extension provided by the <uri link="http://sourceforge.net/projects/ext2fsx">ext2fsx project.</uri>
</p>

<note>
When using MOL, you cannot access a partition that is currently being used by
Linux.
</note>

</body>
</section>
<section>
<title>Which Portage USE flags do not work on PowerPC machines?</title>
<body>

<p>
If you're using an old flat profile, (depreciated, pre 2005.0) look at 
<path>/etc/make.profile/use.mask</path> for a list.
</p>

<p>
If you're using a cascaded profile, (2005.0 and onwards) look at 
<path>/usr/portage/profiles/default-linux/ppc/use.mask</path> for a list.
</p>

</body>
</section>
<section>
<title>How can I set up distcc with my x86 box?</title>
<body>

<p>
If you've got another faster computer, you can set up distcc to compile binaries
for your slower ppc processor.  It's better to do as much building as possible
on the faster machine, if possible, don't even build on the slower computer. 
With that said, here are a few links to get you started:
<uri>http://dev.gentoo.org/~vapier/CROSS-COMPILE-HOWTO</uri>
<uri>http://www.sable.mcgill.ca/~dbelan2/crossdev/crossdev-powerpc-i686.html</uri>
</p>

</body>
</section>
<section>
<title>Why does gcc keep segfaulting during ebuilds?</title>
<body>

<p>
If gcc segfaults during ebuilds, this probably isn't a bug with gcc and isn't
even a problem with your hardware.  Most of the time this problem is due to
kernel preemption being enabled.  Although this option is safe on x86, it can
cause cache corruption on PPC which is why it is noticed most frequently during
compiles.  To prevent this from happening, simply recompile the kernel with
preempt turned off.  To check if preempt is enabled:
</p>

<pre caption="Check if preempt is enabled">
$ <i>grep PREEMPT /usr/src/linux/.config</i>
</pre>

<p>
If returns: "# CONFIG_PREEMPT is not set", then you should report the 
segfault as a bug.
</p>

<p>
If it returns: "CONFIG_PREEMPT=y", then you'll need to disable it and rebuild
your kernel.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Resources</title>
<section>
<title>Can I buy a CD of Gentoo Linux/PPC?</title>
<body>

<p>
Yes! We sell Gentoo on CD-ROM in our <uri link="http://store.gentoo.org/">Gentoo
store</uri>.  You can choose between CDs with precompiled packages for generic 
ppc hardware, or optimized for G3 and G4 processors, or a KDE/GNOME LiveCD that 
boots directly in a live Gentoo Linux environment.
</p>

</body>
</section>
<section>
<title>This FAQ hasn't answered my question. What do I do now?</title>
<body>

<p>
A good first step is to browse through the relevant <uri
link="/doc/en/index.xml">documentation on www.gentoo.org</uri>. Two
PPC-specific <uri link="/main/en/lists.xml">mailing lists</uri>
currently exist, gentoo-ppc-dev and gentoo-ppc-user.  <uri
link="http://forums.gentoo.org/viewforum.php?f=24">Gentoo on PPC</uri>
(on forums.gentoo.org) is an open bulletin-board for discussion of all
PowerPC issues. Also, there is usually a lively discussion on IRC. Join
us on <c>#gentoo-ppc</c> on <c>irc.freenode.net</c>.
</p>

<p>
General information about Linux on PowerPC can be found at <uri
link="http://penguinppc.org/">penguinppc.org</uri>. General Linux
information is at <uri
link="http://www.linuxdoc.org/">www.linuxdoc.org</uri>.
</p>

</body>
</section>
</chapter>
</guide>
