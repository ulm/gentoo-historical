<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/en/gentoo-ppc-faq.xml,v 1.26 2004/12/26 18:13:14 swift Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/gentoo-ppc-faq.xml">
<title>Gentoo Linux/PowerPC Frequently Asked Questions</title>
<author title="Editor">
  <mail link="rajiv@gentoo.org">Rajiv Manglani</mail>
</author>
<author title="Editor">
  <mail link="pylon@gentoo.org">Lars Weiler</mail>
</author>

<abstract>
This FAQ is a collection of questions and answers collected from the
gentoo-ppc-dev mailing list and from IRC -- if you have any questions (or
answers!) to add, please contact either an author or a member of the
documentation team.
</abstract>

<license/>

<version>1.13</version>
<date>2004-12-26</date>


<chapter>
<title>Installation</title>
<section>
<title>
  How do I verify with Mac OS X the downloaded ISO is not
  corrupted? 
</title>
<body>

<p>
First be sure you did not mount the ftp server with 
<e>Finder</e> and then copy the file with drag'n'drop.  This will corrupt
the ISO.  Instead, use <c>curl</c> (with <c>curl -O
http://path/to/iso</c>).
</p>

<p>
As long as Mac OS X does not offer <c>md5sum</c>, you have to use the
<c>openssl</c> capability to produce an md5 checksum.  Therefore, type in
a Terminal the following:
</p>

<pre caption="md5sum with the help of openssl">
$ <i>openssl md5 /path/to/iso</i>
<comment>This could take some time depending of the size of the ISO and your CPU</comment>
</pre>

<p>
Now compare this output with the appropriate file found on the server
where you downloaded the ISO (the file will end with <path>.md5</path>).
If it is the same, the ISO image downloaded correctly.  Be sure you have 
<e>not</e> mounted it (e.g. with Disk Copy) yet!
</p>

</body>
</section>
<section>
<title>Can I dual-boot Gentoo Linux and Mac OS X?</title>
<body>

<p>
Yes you can! In fact, <e>yabootconfig</e> will automatically detect
and setup <path>/etc/yaboot.conf</path> with Linux, Mac OS X and even
classic Mac OS (see the <uri
link="/doc/en/handbook/handbook-ppc.xml?part=1&amp;chap=9#yaboot">Gentoo Handbook</uri> 
for details on yabootconfig). The trick is in how you partition your hard
drive. Before installing Gentoo, startup with the Mac OS X Install CD.
Use the <c>Disk Utility</c> to partition the drive in your machine into
two or three partitions.  Alternatively use <c>parted</c> from the
recent LiveCD, that can handle HFS and HFS+ partitions.  Furthermore, it
is able to shrink a partition so you don't need to delete your whole
disk.  The first partition should be big enough to contain all your
Linux partitions (root+swap+/home etc.). The format of this partition
does not matter. The second partition should be for OS X.  The third (and
optional) partition should be for classic Mac OS. It is needed only if
you want to put Mac OS 9 on a separate partition.
</p>

<note>
If you want to be able to triple-boot with yaboot, Mac OS 9 needs
to be on a separate partition from your Mac OS X installation.
</note>

<p>
After partitioning, install Mac OS X and Mac OS 9 onto their
respective partitions. Once installation is complete, start following
the <uri link="/doc/en/handbook/handbook-ppc.xml">Gentoo Handbook</uri>.
When you get to the section on partitioning, use <c>mac-fdisk</c> to 
<e>delete</e> the large partition you created for Gentoo. In its place, 
create a bootstrap partition, root, swap, and any other partitions you 
want to use with Gentoo.
</p>

<p>
If you have an OldWorld Macintosh (pre-iMac), follow a similar
procedure as described above. However, use the Mac OS 9 install CD and
the <c>Drive Setup</c> utility. OldWorld machines do not need a
bootstrap partition.
</p>

</body>
</section>
<section>
<title>
  I have an OldWorld Macintosh and need to use BootX. However, I am
  having trouble opening the BootX installer on the PPC install CD. What can
  I do?
</title>
<body>

<p>
You will need a new version of <e>StuffIt Expander</e> to open the
file. You can <uri
link="http://www.stuffit.com/expander/download.html">download it</uri>
for free.
</p>

</body>
</section>
<section>
<title>
  Is it possible to boot Gentoo Linux on an OldWorld machine without
  Mac OS? I would like to have a Mac OS-free machine.
</title>
<body>

<p>
If you have a lot of time to experiment, you could try <uri
link="http://penguinppc.org/projects/quik/">Quik</uri>. <e>Quik</e> is a
bootloader for OldWorld PPC machines. If your machine uses <e>BootX</e>,
you can use <e>Quik</e>; if it uses <e>yaboot</e>, you can't.
<e>Quik</e> can be incredibly difficult to install, and is currently
<e>not</e> working with gcc 3.x (read: Gentoo 1.4 or later), but the
end result is somewhere between "neato" and "breathtaking" because Mac OS
does not have to load. Think yaboot on speed.
</p>

<p>
Be sure to read the <uri
link="http://penguinppc.org/projects/quik/quirks.shtml">Quik quirks
page</uri>. Also see "<uri
link="http://lppcfom.sourceforge.net/fom-serve/cache/574.html">Is Quik
Bootloader for Mac OS Dead?</uri>" and "<uri
link="http://www.imaclinux.net/php/imaclinux_g_h.php3?single=17+index=0">Guide:
Quik - Direct Booting for Older PowerMacs</uri>". "<uri
link="http://www.netbsd.org/Ports/macppc/models.html">NetBSD/macppc
Model Support</uri>" documents OpenFirmware versions for various Apple
and clone PowerPC machines.
</p>

<p>
Thanks to vladimir for this information.
</p>

</body>
</section>
<section>
<title>
  I have a Beige G3 machine. Can I install Gentoo Linux/PPC on a
  second IDE hard drive?
</title>
<body>

<p>
Early Beige G3 machines (those with a "Rev 1" motherboard with an ATI
RageII+ chip) do not support slave IDE drives. To use a second hard drive
with this machine, you would have to attach it to the internal or external
SCSI connector, use install a PCI IDE card. Later G3 machines do not have
this limitation. See
<uri>http://www.xlr8yourmac.com/G3-ZONE/IDE/index.html</uri> for more
information.
</p>

</body>
</section>
<section>
<title>
  When I try and install Gentoo on my PowerBook or iBook the internal
  hard drive does not show up. What should I do?
</title>
<body>

<p>
For a PowerBook, pass <c>hda=1,1,1</c> to the kernel at boot time.
That should solve your problems. You can do this at <e>yaboot</e> prompt
by typing <c>boot hda=1,1,1</c>. Some iBooks need
<c>hda=16383,16,64</c>.
</p>

</body>
</section>
<section>
<title>
  My /etc/fstab file has /dev/BOOT in it.
  Do I need to setup this line for my bootstrap partition?
</title>
<body>

<p>
No. If you are not running a separate boot partition
(<path>/boot</path>) then you do not need this line and can safely just
delete it from <path>/etc/fstab</path>.  The bootstrap partition is
<e>not</e> <path>/boot</path> and is not related in anyway. In general,
PowerPC machines do not need a separate <path>/boot</path> partition,
and the bootstrap partition should not be mounted.
</p>

</body>
</section>
<section>
<title>
  Installation is now complete. However after rebooting, I am getting
  different characters than the keys I press on my machine's keyboard. What
  should I do?
</title> 
<body>

<p>
If this is an English keymap, you likely have a kernel config issue.
You will need to rebuild your kernel with the following options:
</p>

<pre caption="Input core support">
<comment>(these are the defaults, but check them)</comment>
&lt;*&gt; Input core support
&lt;*&gt;   Keyboard support 
&lt;*&gt;   Mouse support
(1024)   Horizontal screen resolution
(768)    Vertical screen resolution
&lt; &gt;   Joystick support
&lt;*&gt;   Event interface support
</pre>

<pre caption="Macintosh Device Drivers">
[*] Apple Desktop Bus (ADB) support
[ ]    Include MacIO (CHRP) ADB driver   <comment>doesn't matter</comment>
[*]    Use input layer for ADB devices
[ ]      Support for ADB raw keycodes    <comment>turn this OFF</comment>
[*]      Support for mouse button 2+3 emulation
</pre>

<p>
This way, you will still be able to use <path>/proc/sys/dev/mac_hid</path> to 
emulate buttons 2 and 3 (see next question ).
</p>

<p>
If, for some reason you do not want to recompile your kernel, append
<c>keyboard_sends_linux_keycodes=1</c> to the kernel arguments in
<path>yaboot.conf</path>. This will also correct the problem, but might
possibly introduce other problems.
</p>

<p>
Thanks to Joe McMahon for help with this answer.
</p>

</body>
</section>
<section>
<title>
  I only have one mouse-button.  How can I make use of the second and
  third one, as ctrl-button does not work?
</title>
<body>

<p>
There is no way to get ctrl-button, like on Mac OS X, working.  But
you can map quite any key or combination of keys to emulate the second
and third mouse-button.  The values can be obtained with the command
line utility <c>showkey</c>.  The mouse button emulation is switched on
using the proc-device.  First run <c>echo "1" >
/proc/sys/dev/mac_hid/mouse_button_emulation</c>.  Then copy the right
keycodes to <path>mouse_button2_keycode</path> and
<path>mouse_button3_keycode</path>.  To keep the settings after reboot,
write them to <path>/etc/sysctl.conf</path>.  Here is an example using
F11 and F12:
</p>

<pre caption="Mouse button emulation with F11 and F12">
# Enable mouse button emulation
dev.mac_hid.mouse_button_emulation = 1
# Set 2nd button to 87 - F11
dev.mac_hid.mouse_button2_keycode = 87
# Set 3rd button to 88 - F12
dev.mac_hid.mouse_button3_keycode = 88
</pre>

<p>
Other keys are 100 and 126 for the combinations fn+alt and fn+apple.
</p>

</body>
</section>
<section>
<title>
  Installation is now complete. However, after my machine boots into
  Gentoo and I try to emerge anything, I see errors saying it cannot 'stat'
  a file. What is wrong?
</title>
<body>

<p>
Check to see that your time is set correctly. Setting your time and
linking <path>/etc/localtime</path> to your proper timezone (in
<path>/usr/share/zoneinfo</path>) will solve your problems. Also make
sure that you have <e>not</e> enabled the <e>Enhanced RTC</e> option in
the <e>Character devices</e> section of the kernel configuration (as
stated in install guide).
</p>

</body>
</section>
</chapter>

<chapter>
<title>Laptop Support</title>
<section>
<title>
  How do I enable the full processor speed on my PowerBook while running Linux?
</title>
<body>

<p>
Some processors in PowerBooks start up at slower speed than they are
designed to run. Running at this slower speed conserves battery life
with the tradeoff of performance. The operating system on the machine
must instruct the hardware to run at its full speed. In Mac OS X this is
called "Reduced processor performance" or "CPU Scaling" in Linux. To
check the current speed of your processor while running in Linux, type
<c>cat /proc/cpuinfo</c>. In Mac OS X, you first have to turn off
"Reduce processor performance" in the "Options" tab of the <e>Energy Saver</e>
system preference panel. Then run <e>Apple System Profiler</e> (in
Applications:Utilities).
</p>

<warn>
Do not use this method to overclock your machine. Results are
unpredictable if you use an improper value. We are not responsible if
you fry your machine!
</warn>

<p>
If <e>Apple System Profiler</e> reports a higher speed than what you
get when running in Linux, you can enable the full speed of the
processor with a simple command. First, your machine needs to be running
kernel <c>2.4.20-pre9-ben0</c> or later. Earlier kernels do not have the
code necessary to change the processor speed. Second, you will need to
compile the kernel with <c>CPU Frequency scaling</c> <e>disabled</e>.
Finally, run an appropriate command as shown in the examples below.
</p>

<pre caption="CPU Frequency scaling">
<codenote>These are examples only. Use values appropriate for your machine.</codenote>

echo "0:667000:1000000:performance" > /proc/cpufreq    <codenote>For a 1ghz PowerBook G4</codenote>
echo "0:667000:800000:performance" > /proc/cpufreq     <codenote>For an 800mhz PowerBook G4</codenote>
</pre>

<p>
Many users will want to add this command to the end of
<path>/etc/conf.d/local.start</path>. This file is sourced every time
your machine starts.
</p>

</body>
</section>
<section>
<title>
  I'm running Gentoo on a PowerPC laptop. What packages should I
  install to enable laptop-specific functionality?
</title>
<body>

<p>
There are three main packages you will need to install.
</p>

<ul>
  <li>
    <e>pbbuttonsd</e> is a tool that enables the brightness and volume
    keys on most ppc laptops.  The current versions also work as a
    powermanager.
  </li>
  <li>
    <e>gtkpbbuttons</e> gives you a gtk front end for pbbuttonsd
    (visual feedback on button presses in X).  <e>gtkpbbuttons</e>
    requires gtk and should be added to your X session file
    (<path>~/.Xsession</path>) for best results (so that it is always
    running while in X).
  </li>
  <li>
    <e>powerprefs</e> ties together with pbbuttonsd, and gives you the
    ability to edit settings such as power-management, trackpad options
    and various other preferences.
  </li>
</ul>

<p>
These packages can be installed by running the appropriate commands from the 
list below:
</p>

<pre caption="Installing laptop-specific packages">
# <i>emerge pbbuttonsd; rc-update add pbbuttonsd default</i>
# <i>emerge gtkpbbuttons</i>
# <i>emerge powerprefs</i>
</pre>

<note>
You should edit your <path>/etc/pbbuttonsd.conf</path> for your
preferences.  Especially the behaviour of the Fx-keys, as pbbuttonsd
gives you the availabilty, to use the Fx-keys in the first mode, and the
brightness- and sound-keys with the help of Fn.
</note>

</body>
</section>
<section>
<title>How can I configure my machine's Airport or other Wi-Fi card?</title>
<body>

<p>
First, make sure you have support for the airport card compiled into
the kernel, or compiled as a module and loaded. Then, <c>emerge
wireless-tools; iwconfig</c>.
</p>

<note>
Airport Extreme cards are not yet supported on Linux.
</note>

</body>
</section>
<section>
<title>Will the internal modem in an iBook2 or PowerBook work?</title>
<body>

<p>
Install <c>net-dialin/hcfusbmodem</c> which will provide
<path>/dev/ttySHCF0</path>.  Then set up ppp like usual.  Further
information about the installation can be found at
<uri>http://www.linuxant.com/drivers/hcf/install.html</uri>
</p>

</body>
</section>
</chapter>

<chapter>
<title>Applications</title>
<section>
<title>Is there an easy way to configure X?</title>
<body>

<p>
Thanks to Gerk, you can do <c>emerge xeasyconf; Xeasyconf</c>.  Or
test out <c>Xautoconfig</c>.
</p>

</body>
</section>
<section>
<title>How can I enable Direct Rendering (DRM) on rage128 or radeon cards?</title>
<body>

<p>
emerge xorg-x11 and x11-drm.
</p>

<p>
Make sure in your kernel config you have the following options set:
</p>

<pre caption="DRM kernel configuration">
Character devices ---&gt;
  &lt;*&gt; /dev/agpgart (AGP Support)
  [*] Apple UniNorth support
  [*] Direct Rendering Manager (XFree86 DRI support)
</pre>

<p>
Also make sure to disable both the r128 and radeon drm drivers in the
kernel (the x11-drm provides much updated versions that are required for
this to work).
</p>

<pre caption="Disable r128 and radeon drivers">
&lt; &gt; ATI Rage 128
&lt; &gt; ATI Radeon
</pre>

<p>
Rebuild and install the kernel if necessary. After this, make sure you
are booted from the native framebuffer (i.e. radeonfb or atyfb and
<e>not</e> from offb or ofonly video), and run <c>Xeasyconf</c>.
</p>

<impo>
You may need to edit your <path>XF86Config-4</path> file depending
on your card setup. When running <c>Xeasyconf</c>, also please choose the
"auto" option and not "ati" for your video card setup.
</impo>

<p>
You can run the command <c>dmesg</c> to see which version of the radeon
drm module is loaded. If all is correct for radeon you should see 1.7.0 or
newer loading, if you see 1.2.x you have the kernel radeon drivers still
compiled into your running kernel or as modules and they are loaded.
Looking in <path>/var/log/Xfree.0.log</path> is a good place to get
detailed information for troubleshooting.
</p>

<note>
If/when you do another <c>make modules_install</c> in your current
kernel, or you upgrade to a new kernel you will have to reemerge x11-drm
again.
</note>

</body>
</section>
<section>
<title>
  I recently emerged XFree, but when using it, my international
  keyboard layout does not work correctly. The main keys work fine but I am
  unable to compose special characters like the "at" sign. The startx output
  says something like "could not load keymap, falling back to default
  keymap". What is wrong?
</title>
<body>

<p>
Check that the permissions on <path>/var/tmp</path> are set to
<path>drwxrwxrwx</path>. If not, change them by typing <c>chmod a+rwx
/var/tmp</c>. This will allow XFree to load keymaps properly again.
</p>

</body>
</section>
<section>
<title>
  When using OpenGL DRI in XFree or playing movies, the system
  sometimes freezes hard unexpectedly. What can I do?
</title>
<body>

<p>
Your system may not cope properly with AGP support. Newer kernels
(2.4.20 or higher) and XFree 4.3 or better should solve this. Until then
the easiest solution is to add the following line to the "Device"
section of <path>/etc/X11/XF86Config-4</path>:
</p>

<pre caption="Forcing PCI mode for AGP-Cards">
Option       "ForcePCIMode"
</pre>

</body>
</section>
<section>
<title>How do I get sound output working?</title>
<body>

<p>
Two things are needed here. First, you have to make sure that you
have the correct kernel options selected.  In <c>make menuconfig</c> you
need:
</p>

<pre caption="Kernel options for sound">
&lt;*&gt; Sound card support
  &lt;*&gt;   PowerMac DMA sound support
</pre>

<p>
(or selected as modules and loaded). Second, users who should have
access to the audio devices need to be added to the appropriate group
with the command:
</p>

<pre caption="Adding users to the audio group">
# <i>gpasswd -a username audio</i>
</pre>

<p>
If the <c>dmasound_pmac</c> module does not load, you probably need to
enable <c>i2c-core</c> in the kernel or as a module.
</p>

</body>
</section>
<section>
<title>How do I play Audio CDs?</title>
<body>

<p>
NewWorld machines have no audio connection between their CD-ROM drive
and their sound hardware. Therefore, audio information must be read as
data and then piped to the sound hardware. This is possible using
<e>xmms</e> and the <e>xmms-cdread</e> plugin, that reads the audio off
the CD over the ATA cable, decodes it in software and sends it to the
sound card over the PCI bus as digital data.  If you want 'true'
cd-playing, you have to do the following steps:
</p>

<p>
First, you will need to rebuild your kernel with the following options:
</p>

<pre caption="Kernel options for playing audio-CDs">
<codenote>In "ATA/IDE/MFM/RLL Support"</codenote>
<codenote>In "IDE, ATA, and ATAPI Block Devices"</codenote>
&lt; &gt; Include IDE/ATAPI CDROM support  <codenote>turn this OFF</codenote>
&lt;M&gt; SCSI emulation support           <codenote>compile this as a module</codenote>

<codenote>In "SCSI Support"</codenote>
&lt;M&gt; SCSI support                     <codenote>compile this as a module</codenote>
&lt;M&gt; SCSI CD-ROM support              <codenote>compile this as a module</codenote>
</pre>

<p>
Then, append <c>hdX=ide-scsi</c> to the kernel image section(s) in
<path>/etc/yaboot.conf</path> where <c>hdX</c> is the IDE device
corresponding to your CD player. This is usually <c>hdc</c>. Type
<c>ybin -v</c> to install the new yaboot.conf settings. Edit
<path>/etc/group</path> add any users who should be able to play CDs to
the <c>cdrom</c> group. You will now need to reboot your system for the
kernel changes to take effect.
</p>

<p>
Upon reboot, <c>su</c> to root and change the permissions of the cd device, 
then install xmms:
</p>

<pre caption="Changing permission for cdrom and install xmms-read">
# <i>chown root:cdrom /dev/scsi/host0/bus0/target0/lun0/cd</i>
# <i>chmod 660 /dev/scsi/host0/bus0/target0/lun0/cd</i>
# <i>emerge xmms xmms-cdread</i>
</pre>

<note>
Make sure to use the path corresponding to the CD drive on your machine.
</note>

<p>
To play a CD, fire up <c>xmms</c> and enter <c>/dev/cdrom</c> as the
file you want to play.
</p>

</body>
</section>
<section>
<title>Can I run Mac OS or Mac OS X under Gentoo Linux?</title>
<body>

<p>
Yes, as long as your are running Gentoo Linux/PPC on Apple hardware
(or a Mac-clone). You will need to run <uri
link="http://www.maconlinux.org/">Mac-on-Linux</uri>. Just <c>emerge
mol</c>. MOL support Mac OS 7.5.2 to 9.2.2, as well as any version of OS X.
It can take over your full screen, or run in a window.
</p>

<p>
For networking and sound you might install the drivers in the folder
<path>MOL-Install</path> on your Mac OS X-Desktop.  If errors with
networking occur, make sure you have the following kernel options
enabled:
</p>

<p>
For the dhcp server:
</p>

<ul>
  <li>Socket Filtering (CONFIG_FILTER)</li>
  <li>Packet Socket (CONFIG_PACKET)</li>
</ul>

<p>
For NAT:
</p>

<ul>
  <li>Network packet filtering (CONFIG_NETFILTER)</li>
  <li>Connection tracking (CONFIG_IP_NF_CONNTRACK)</li> 
  <li>IP tables support (CONFIG_IP_NF_IPTABLES)</li> 
  <li>Packet filtering (CONFIG_IP_NF_FILTER)</li> 
  <li>Full NAT (CONFIG_IP_NF_NAT)</li>
  <li>MASQUERADE target support (CONFIG_IP_NF_TARGET_MASQUERADE)</li>
</ul>

</body>
</section>
<section>
<title>Which Portage USE flags do not work on PowerPC machines?</title>
<body>

<p>
Look at <path>/etc/make.profile/make.defaults</path> for a list.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Resources</title>
<section>
<title>Can I buy a CD of Gentoo Linux/PPC?</title>
<body>

<p>
Yes! We sell Gentoo on CD-ROM in our <uri link="http://store.gentoo.org/">Gentoo
store</uri>.  You can choose between CDs with precompiled packages for generic 
ppc hardware, or optimized for G3 and G4 processors, or a KDE/GNOME LiveCD that 
boots directly in a live Gentoo Linux environment.
</p>

</body>
</section>

<section>
<title>This FAQ hasn't answered my question. What do I do now?</title>
<body>

<p>
A good first step is to browse through the relevant <uri
link="/doc/en/index.xml">documentation on www.gentoo.org</uri>. Two
PPC-specific <uri link="/main/en/lists.xml">mailing lists</uri>
currently exist, gentoo-ppc-dev and gentoo-ppc-user.  <uri
link="http://forums.gentoo.org/viewforum.php?f=24">Gentoo on PPC</uri>
(on forums.gentoo.org) is an open bulletin-board for discussion of all
PowerPC issues. Also, there is usually a lively discussion on IRC. Join
us on <c>#gentoo-ppc</c> on <c>irc.freenode.net</c>.
</p>

<p>
General information about Linux on PowerPC can be found at <uri
link="http://penguinppc.org/">penguinppc.org</uri>. General Linux
information is at <uri
link="http://www.linuxdoc.org/">www.linuxdoc.org</uri>.
</p>

</body>
</section>
</chapter>
</guide>
