<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet href="/xsl/guide.xsl" type="text/xsl"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/grp-build.xml">

<author title = "Author">
<mail link = "zhen@gentoo.org">John P. Davis</mail></author>

<version>1.0</version>
<date>18 Feb 2003</date>

<abstract>This guide is an explanation on how to build GRP stages for
Gentoo Linux releases.</abstract>

<chapter>
	<title>Preliminaries</title>
	<section>
		<title>Introduction</title>
		<body>
		<p>This guide is an explanation on how to build release-ready
		GRP stages for Gentoo Linux. This guide assumes a couple of
		things: </p>

		<ul>
		<li>You are a Gentoo Linux Developer.</li>
		<li>You have access to the <i>gentoo-src</i> module of CVS.</li>
		</ul>

	</body>
	</section>
	<section>
		<title>Getting the source</title>
		<body>
		<p>Before building anything, it is necessary to get the required source, tools, etc.
		First of all, make sure that you have the <i>gentoo-src</i> module checked out of CVS
		and that it is up to date. The build scripts change frequently, so make sure that you stay current.
		Additionally, the most recent experimental stage1 tarball is requried. This can
		usually be found <uri link="http://www.ibiblio.org/gentoo/experimental/x86/stages">here</uri>.
		</p>
		
		</body>
	</section>
</chapter>

<chapter>
	<title>The Build Process</title>
	<section>
		<title>First Steps</title>
		<body>
		<p>First, create a directory on a nice big partition to hold all of the build stuffs. I created mine
		in <path>/usr/src/grp</path>, but of course, yours can be different. Next, copy the <path>stager</path>
		directory from <i>gentoo-src</i> into this new
		directory. Finially, create a directory inside of the <path>grp/stager</path> drive called <i>stages</i>
		and put the experimental stage1 tarball in there.
		</p>

		<pre caption="Getting Ready">
# <c>mkdir /usr/src/grp </c>
<codenote>You can change the above drive to whatever you want, but I will
reference it as what I have written.
</codenote>

# <c>cp -R /<comment>path-to-gentoo-src</comment>/stager/ /usr/src/grp </c>
# <c>cd /usr/src/grp/stager; mkdir stages </c>
# <c>mv stage1-x86-1.4_pre<comment>current</comment>.tar.bz2 /usr/src/grp/stager/stages </c>

		</pre>

		</body>
	</section>

	<section>
		<title>Pre-Build Configuration</title>
		<body>
		<p>Once everything is in the correct place, modify the <c>dostage.sh</c> script to fit your application.
		</p>

		<pre caption="Modifying the dostage.sh script">
<codenote>change SOURCE to stage1-x86-1.4_preFOO</codenote>
SOURCE=stage1-x86-1.4_pre<comment>current</comment>.tar.bz2
<codenote>You can change DEST to whatever you desire, but for testing, it is easier to keep it
the same as SOURCE</codenote>
DEST=stage1-x86-1.4_pre<comment>current</comment>.tar.bz2
		</pre>

		<p>After that is complete, make sure to change the m/arch in the for loop to match your architecture.
		</p>

		</body>
	</section>

	<section>
		<title>Build!</title>
		<body>

		<p>Make sure that you are root, and run <c>dostage.sh</c>. The script will take care of creating
		the chroot environment, and it will build all of the stages for you.
		</p>

		<p>After the build completes, remove the <path>packages</path> and <path>build</path> directories
		from under the stages directory so that you don't get any precompiled packages for a
		different arch in your next build.
		</p>
		
		</body>
	</section>
</chapter>

<chapter>
	<title>Final Notes</title>
	<section>
		<title>Contacts</title>
		<body>
		
		<table>
		<tr>
			<th>Contact</th>
			<th>Function</th>
		</tr>
		<tr>
			<ti><uri link="bcowan@gentoo.org">Brad Cowan</uri></ti>
			<ti>Gentoo Linux Release Manager</ti>
		</tr>
		<tr>
			<ti><uri link="jhhudso@gentoo.org">Jared Hudson</uri></ti>
			<ti>Stage Builds</ti>
		</tr>
		<tr>
			<ti><uri link="zhen@gentoo.org">John Davis</uri></ti>
			<ti>Documentation Coordinator/ Author</ti>
		</tr>
		</table>
		
		</body>
	</section>
</chapter>
</guide>
			
		

		
