<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/en/liveusb.xml,v 1.5 2006/02/12 14:54:15 nightmorph Exp $ -->

<guide link="/doc/en/liveusb.xml">
<title>Gentoo Linux LiveUSB HOWTO</title>

<author title="Author">
  <mail link="brix@gentoo.org">Henrik Brix Andersen</mail>
</author>

<abstract>
This HOWTO explains how to create a Gentoo Linux LiveUSB or, in other words,
how to emulate a Gentoo Linux Installation CD using an USB flash drive.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.1</version>
<date>2006-02-12</date>

<chapter>
<title>Introduction</title>
<section>
<title>The LiveUSB</title>
<body>

<p>
This HOWTO explains how to create a <e>Gentoo Linux LiveUSB</e> or, in other
words, how to emulate a Gentoo Linux Installation CD using an USB flash drive.
This is particularly useful for installing Gentoo Linux on a modern laptop with
no CD-ROM drive.
</p>

<p>
Although the instructions found in this document aim at emulating a Gentoo
Linux Installation CD using an USB flash drive, they should work for any
arbitrary block device as long as you adjust the device names accordingly.
</p>

</body>
</section>
<section>
<title>Prerequisites</title>
<body>

<p>
In order to use a Gentoo Linux LiveUSB you need the following:
</p>

<ul>
  <li>Bootable USB flash drive (at least 64MB)</li>
  <li>
    x86 computer with support for booting from USB (with at least 64MB RAM)
  </li>
</ul>

<p>
You will also need access to the following for creating the LiveUSB:
</p>

<ul>
  <li>
    A computer running Gentoo Linux (or alternatively another Linux
    distribution)
  </li>
</ul>

</body>
</section>
</chapter>
<chapter>
<title>Preparing the USB flash drive</title>
<section>
<title>Partitioning the drive</title>
<body>

<warn>
These instructions will erase all data from the USB flash drive. Make sure to
backup your data first.
</warn>

<impo>
This HOWTO assumes that the <path>/dev/sda</path> device node corresponds to
your USB flash drive. If you have other SCSI-like devices make sure to use the
correct device node.
</impo>

<p>
Create a FAT32 partition on your USB flash drive and mark it bootable using
<c>fdisk</c>. An example partitioning scheme can be seen below:
</p>

<pre caption="Example partitioning scheme">
# <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 1048 MB, 1048313856 bytes
33 heads, 61 sectors/track, 1017 cylinders
Units = cylinders of 2013 * 512 = 1030656 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1        1017     1023580    b  W95 FAT32
</pre>

</body>
</section>
<section>
<title>Creating the filesystem</title>
<body>

<p>
Create a FAT32 filesystem on the USB flash drive using <c>mkdosfs</c>:
</p>

<pre caption="Running mkdosfs">
<comment>(Make sure you have sys-fs/dosfstools installed)</comment>
# <i>emerge -av sys-fs/dosfstools</i>
# <i>mkdosfs -F 32 /dev/sda1</i>
mkdosfs 2.11 (12 Mar 2005)
</pre>

</body>
</section>
<section>
<title>Installing a Master Boot Record</title>
<body>

<p>
Install the precompiled Master Boot Record (MBR) from <c>syslinux</c> on the
USB flash drive:
</p>

<pre caption="Installing a master boot record">
<comment>(Make sure you have sys-boot/syslinux-3.00 or later installed)</comment>
# <i>emerge -av '>=sys-boot/syslinux-3*'</i>
# <i>dd if=/usr/lib/syslinux/mbr.bin of=/dev/sda</i>
0+1 records in
0+1 records out
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Copying the files</title>
<section>
<title>Mounting the Gentoo Linux Installation CD</title>
<body>

<p>
Download the <path>install-x86-minimal-2005.1-r1.iso</path> file from your
local Gentoo Linux <uri link="/main/en/where.xml">mirror</uri> site and mount
the ISO image on <path>/mnt/cdrom/</path> as shown below:
</p>

<pre caption="Mounting the Gentoo Linux Installation CD ISO image">
<comment>(Create the /mnt/cdrom/ mount point if needed)</comment>
# <i>mkdir -p /mnt/cdrom</i>
# <i>mount -o loop,ro -t iso9660 install-x86-minimal-2005.1-r1.iso /mnt/cdrom/</i>
</pre>

</body>
</section>
<section>
<title>Mounting the LiveUSB</title>
<body>

<p>
Mount the newly formatted USB flash drive on <path>/mnt/usb/</path> as shown
below:
</p>

<pre caption="Mounting the USB flash drive">
<comment>(Create the /mnt/usb/ mount point if needed)</comment>
# <i>mkdir -p /mnt/usb</i>
# <i>mount -t vfat /dev/sda1 /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Copying the files</title>
<body>

<p>
Copy the files from the Gentoo Linux Installation CD to the LiveUSB. The files
need to be reordered a bit as we will be using the <c>syslinux</c> bootloader
instead of <c>isolinux</c>:
</p>

<pre caption="Copying the files">
# <i>cp -r /mnt/cdrom/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux.cfg /mnt/usb/syslinux.cfg</i>
# <i>rm -rf /mnt/usb/isolinux*</i>

<comment>(The memtest86 kernel needs to be renamed for loading it via syslinux)</comment>
# <i>mv /mnt/usb/memtest86 /mnt/usb/memtest</i>
</pre>

<p>
You can now unmount the ISO image:
</p>

<pre caption="Unmounting the ISO image">
# <i>umount /mnt/cdrom/</i>
</pre>

</body>
</section>
<section>
<title>Adjusting the bootloader configuration</title>
<body>

<p>
Adjust the syslinux configuration file using <c>sed</c> as shown below. The
<c>scandelay=10</c> parameter will introduce a 10 seconds delay before
attempting to mount the filesystem. This is needed to allow the USB flash drive
to settle upon detection.
</p>

<pre caption="Adjusting the boot parameters">
# <i>sed -i \
    -e "s:cdroot:cdroot scandelay=10:" \
    -e "s:kernel memtest86:kernel memtest:" \
    /mnt/usb/syslinux.cfg</i>
</pre>

<note>
Consider adding <c>docache</c> to the boot parameters. This will allow running
<c>umount /mnt/cdrom/</c> after booting so that you can unplug the USB flash
drive.
</note>

</body>
</section>
</chapter>
<chapter>
<title>Installing a bootloader</title>
<section>
<title>Unmounting the drive</title>
<body>

<p>
Make sure you unmount the USB flash drive before installing the bootloader:
</p>

<pre caption="Unmounting the USB flash drive">
# <i>umount /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Installing syslinux</title>
<body>

<p>
Finally install the <c>syslinux</c> bootloader on the USB flash drive:
</p>

<pre caption="Running syslinux">
# <i>syslinux /dev/sda1</i>
</pre>

<impo>
You will need to rerun <c>syslinux /dev/sda1</c> each time you modify the
<path>syslinux.cfg</path> file for the configuration changes to take affect.
</impo>

</body>
</section>
</chapter>
<chapter>
<title>Using the LiveUSB</title>
<section>
<title>Booting</title>
<body>

<p>
Insert the USB flash drive and turn on the computer, making sure the BIOS is
set to boot from USB. If all goes well you should be presented with a standard
syslinux prompt.
</p>

<p>
You should be able to follow the generic installation instructions found in the
<uri link="/doc/en/handbook/">Gentoo Handbook</uri> from here on.
</p>

</body>
</section>
</chapter>
</guide>
