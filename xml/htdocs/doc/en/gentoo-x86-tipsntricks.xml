<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/gentoo-x86-tipsntricks.xml">
<title>Gentoo/x86 Installation Tips &amp; Tricks</title>
<author title="Author">
    <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>

<abstract>
The Gentoo installation allows for very flexible approaches to the various
installation methods. As it is almost impossible to insert every single tip or
trick in the installation instructions this document tries to deal with all
submitted tips and tricks for reference purposes.
</abstract>

<license/>

<version>1.0</version>
<date>April 11, 2004</date>

<chapter>
<title>Introduction</title>
<section>
<title>Preliminary</title>
<body>

<p>
This document contains various tips and tricks for the Gentoo/x86 installation.
Most of them are discussed in a dense way - they are meant as an addendum to the
installation instructions and not as a replacement.
</p>

</body>
</section>
<section>
<title>Contents</title>
<body>

<p>
<b>Advanced Installations</b>
</p>

<ul>
  <li><uri link="#software-raid">Software RAID</uri></li>
</ul>

<p>
<b>Simplifying the Installation</b>
</p>

<ul>
  <li><uri link="#leave_terminal">Leaving the Terminal</uri></li>
</ul>

</body>
</section>
</chapter>
<chapter>
<title>Advanced Installations</title>
<section id="software-raid">
<title>Software RAID</title>
<body>

<note>
If you are not known to software raid, please read the <uri
link="http://tldp.org/HOWTO/Software-RAID-HOWTO.html">Software-RAID-HOWTO</uri>.
</note>

<p>
Once you are booted from the LiveCD, load the appropriate RAID modules. For
instance, if you plan on using RAID-1:
</p>

<pre caption="Loading the RAID-1 module">
# <i>modprobe raid1</i>
</pre>

<p>
When you partition your disks, make sure that your partitions use <c>fd</c>
(Linux raid autodetect) as Partition Type instead of <c>83</c> (Linux native).
You can alter the partition type using the <c>t</c> command in <c>fdisk</c>.
</p>

<p>
After partitioning, create the <path>/etc/raidtab</path> file (yes, indeed, on
the LiveCD environment) and insert the necessary commands for your RAID setup.
For instance, to have your boot, swap and root partition mirrored (RAID-1)
covering <path>/dev/sda</path> and <path>/dev/sdb</path>, you can use:
</p>

<pre caption="/etc/raidtab for RAID-1 setup">
raiddev /dev/md0
  raid-level 1
  nr-raid-disks 2
  chunk-size 32
  persistent-superblock 1
  device /dev/sda1
    raid-disk 0
  device /dev/sdb1
    raid-disk 1

raiddev /dev/md1
  raid-level 1
  nr-raid-disks 2
  chunk-size 32
  persistent-superblock 1
  device /dev/sda2
    raid-disk 0
  device /dev/sdb2
    raid-disk 1

raiddev /dev/md2
  raid-level 1
  nr-raid-disks 2
  chunk-size 32
  persistent-superblock 1
  device /dev/sda3
    raid-disk 0
  device /dev/sdb3
    raid-disk 1
</pre>

<p>
Now create the necessary RAID devices for each RAID device you listed in
<path>/etc/raidtab</path>:
</p>

<pre caption="Creating RAID devices">
# <i>mkraid /dev/md0</i>
# <i>mkraid /dev/md1</i>
# <i>mkraid /dev/md2</i>
</pre>

<p>
The Linux Software RAID driver will start creating the metadevices. You can see
its progress in <path>/proc/mdstat</path>. Wait until the metadevices are
completely finished before proceeding.
</p>

<p>
From now onwards, use <path>/dev/md0</path> for the boot partition,
<path>/dev/md1</path> for the swap partition and <path>/dev/md2</path> for the
root partition.
</p>

<p>
After mounting <path>/dev/md2</path> on <path>/mnt/gentoo</path>, don't forget
to copy over <path>/etc/raidtab</path> to <path>/mnt/gentoo/etc</path>.
</p>

<p>
When you're configuring your kernel, make sure you have the appropriate RAID
support <e>in</e> your kernel and not as module. 
</p>

<p>
When installing extra tools, emerge <c>raidtools</c> as well. Note that this
isn't available on all LiveCDs so you might not be able to install Gentoo on a
Software RAID when using a networkless installation!
</p>

<p>
When configuring your bootloader, make sure it gets installed in the MBR of
<e>both</e> disks if you use mirroring. 
</p>

</body>
</section>
</chapter>

<chapter>
<title>Simplifying the Installation</title>
<section id="leave_terminal">
<title>Leaving your Terminal</title>
<body>

<p>
Many people want to leave their system when it's compiling. In certain cases
this is rather difficult as the installation is done in a public environment
where you cannot trust everyone. If this is the case, you want to be able to
perform the compilation in the background and log out from all terminals.
</p>

<p>
There are several possible solutions for this. The first one is to use
<c>screen</c>. After booting the LiveCD, set your root password and start a
screen session:
</p>

<note>
Not all LiveCDs provide screen. If this is the case, you will have to use one of
the other methods described in this section.
</note>

<pre caption="Starting a screen session">
# <i>screen -S gentoo</i>
</pre>

<p>
Once inside the screen session you can perform the entire installation. When you
want to leave your terminal, press <c>Ctrl-a, d</c> (that is, control and a at
the same time, then followed by a d) to <e>detach</e> your screen session. You
can now safely log out of your system.
</p>

<p>
To regain access to your terminal, log in as root again and <e>attach</e> to 
the running screen session:
</p>

<pre caption="Attaching to a screen session">
# <i>screen -x gentoo</i>
</pre>

<p>
If you can't use screen, there is still a way to leave your terminal. Follow the
installation instructions, but when you come to the point where a long-term
compilation would be started (for instance the <c>./scripts/bootstrap.sh</c>
step), use <c>nohup</c> which allows for a process to continue even when you log
out. Don't forget the trailing "&amp;", otherwise the process won't be placed in
the background! Remember where you are (the <c>pwd</c> command will show you
that) as you will need to know this later on.
</p>

<pre caption="Using nohup">
# <i>pwd</i>
/usr/portage
# <i>nohup ./scripts/bootstrap.sh &amp;</i>
</pre>

<p>
Now exit the chrooted environment (<c>exit</c>) and the LiveCD session. Your
compilation will continue in the background. 
</p>

<p>
When you want to check the compilation, log in as root (on the LiveCD) and
chroot back into your environment and go to the directory where you left off:
</p>

<pre caption="Chrooting back">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update &amp;&amp; source /etc/profile</i>
# <i>cd /usr/portage</i>
</pre>

<p>
Now use the <c>less</c> command on the <path>nohup.out</path> file that is
situated inside that directory. The compilation will append its output to that
file, so if you want to follow the compilation progress, run <c>less
nohup.out</c> and press <c>F</c> to follow the changes. When the compilation is
finished, you can continue with the next step of the installation instructions.
</p>

<p>
If you ever get tired of following the changes, press <c>Ctrl-C</c> followed by
a <c>q</c>. This won't stop the compilation process, only the <c>less</c>
process.
</p>

</body>
</section>
</chapter>

</guide>
