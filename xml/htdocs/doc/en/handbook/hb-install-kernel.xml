<sections>
<section>
<title>Installing the Sources</title>
<subsection>
<title>Choosing a Kernel</title>
<body>

<p>
The core around which all distributions are built is the Linux kernel. It is the
layer between the user programs and your system hardware. Gentoo provides its
users several possible kernel sources. A full listing with description is
available at the <uri link="/doc/en/gentoo-kernel.xml">Gentoo Kernel
Guide</uri>. 
</p>

<p>
For x86-based systems we have, amongst other kernels, <c>vanilla-sources</c>
(the default kernel source as developed by the linux-kernel developers),
<c>gentoo-sources</c> (kernel source patched with performance-enhancing
features), <c>xfs-sources</c> (kernel source with the latest XFS support),
<c>gs-sources</c> (kernel source patched for server usage),
<c>gaming-sources</c> (kernel source patched for optimal gaming performance),
...
</p>

<p>
For alpha-based systems we have <c>vanilla-sources</c> (the default kernel
source as developed by the linux-kernel developers), <c>alpha-sources</c>
(kernel source optimized for alpha users) and <c>compaq-sources</c> (kernel
source as used by RedHat for Alpha, maintained by Compaq).
</p>

<p>
Other architectures should use the kernel source specifically optimized for
their architecture: <c>hppa-sources</c> (HPPA), <c>ppc-sources</c> (PowerPC),
<c>sparc-sources</c> (Sparc).
</p>

<p>
Choose your kernel source and install it using <c>emerge</c>. In the next
example we install the <c>gentoo-sources</c>. Ofcourse substitute with your
choice of sources:
</p>

<pre caption="Installing a kernel source">
# <i>emerge -k gentoo-sources</i>
</pre>

<p>
When you take a look in <path>/usr/src</path> you should see a symlink called
<path>linux</path> pointing to your kernel source:
</p>

<pre caption="Viewing the kernel source symlink">
# <i>ls -l /usr/src/linux</i>
lrwxrwxrwx    1 root     root           12 Oct 13 11:04 /usr/src/linux -&gt; linux-2.4.20-gentoo-r8
</pre>

<p>
If this isn't the case (i.e. the symlink points to a different kernel source) 
change the symlink before you continue:
</p>

<pre caption="Changing the kernel source symlink">
# <i>rm /usr/src/linux &amp;&amp; ln -s /usr/src/linux-2.4.20-gentoo-r8 /usr/src/linux</i>
</pre>

<p>
Now it is time to configure and compile your kernel source. The x86-based
architectures can use <c>genkernel</c> for this, which will build a generic
kernel as used by the LiveCD. We explain the "manual" configuration first
though, as it is the best way to optimize your environment.
</p>

<p>
If you want to manually configure your kernel, continue now with <uri
link="#doc_chap2">Default: Manual Configuration</uri>. x86-users can use
<c>genkernel</c> if they want and read <uri link="#doc_chap3">Alternative: Using
genkernel</uri> instead.
</p>

</body>
</subsection>
</section>
<section>
<title>Default: Manual Configuration</title>
<subsection>
<title>Introduction</title>
<body>

<p>
Manually configuring a kernel is often seen as the most difficult course every
Linux users ever has to go through. Nothing is less true -- after configuring a
couple of kernels you don't even remember that it was difficult ;)
</p>

<p>
However, one thing <e>is</e> true: you must know your system when you start
configuring a kernel manually. Most information can be gathered by viewing the
contents of <path>/proc/pci</path> (or by using <c>lspci</c> if available).
</p>

<p>
Now go to your kernel source directory and execute <c>make menuconfig</c>. This
will fire up an ncurses-based configuration menu.
</p>

<pre caption="Invoking menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
You will be greeted with several configuration sections. We'll first list some
options you must activate (otherwise Gentoo will not function, or not function
properly without additional tweaks).
</p>

</body>
</subsection>
<subsection>
<title>Activating Required Options</title>
<body>

<p>
First of all, activate the use of development and experimental code/drivers.
You need this, otherwise some very important code/drivers won't show up:
</p>

<pre caption="Selecting experimental code/drivers">
Code maturity level options ---&gt;
  [*] Prompt for development and/or incomplete code/drivers"
</pre>

<p>
Now go to <c>File Systems</c> and select support for the filesystems you use.
<e>Don't</e> compile them as modules, otherwise your Gentoo system will not be
able to mount your partitions. Also select <c>Virtual memory</c>, <c>/proc
file system</c>, <c>/dev file system</c> + <c>Automatically mount at boot</c>:
</p>

<pre caption="Selecting necessary file systems">
File systems ---&gt;
  [*] Virtual memory file system support (former shm fs)
  [*] /proc file system support
  [*] /dev file system support (EXPERIMENTAL)
  [*]   Automatically mount at boot

<comment>(Deselect the following unless you have a 2.6 kernel)</comment>
  [ ] /dev/pts file system for Unix98 PTYs

<comment>(Select one of more of the following options as needed by your system)</comment>
  &lt;*&gt; Reiserfs support
  &lt;*&gt; Ext3 journalling file system support
  &lt;*&gt; JFS filesystem support
  &lt;*&gt; Second extended fs support
  &lt;*&gt; XFS filesystem support
</pre>

<p>
If you are using PPPoE to connect to the Internet, you will need the following
options in the kernel:
</p>

<pre caption="Selecting PPPoE necessary drivers">
Network device support ---&gt;
  &lt;*&gt; PPP (point-to-point protocol) support
  &lt;*&gt;   PPP support for async serial ports
  &lt;*&gt;   PPP support for sync tty ports
</pre>

<p>
The two compression options won't harm but are not definitely needed, neither
does the <c>PPP over Ethernet</c> option, that might only be used by 
<c>rp-pppoe</c> when configured to do kernel mode PPPoE.
</p>


</body>
</subsection>
</section>
<section>
<title>Alternative: Using genkernel</title>
<body>

<p>
Warn about x86-only. Explain what <c>genkernel</c> does. Use it.
</p>

</body>
</section>
<section>
<title>Installing Seperate Kernel Modules</title>
<body>

<p>
Provide a list of available kernel modules and how to install them.
</p>

</body>
</section>
</sections>
