<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/rsync.xml,v 1.7 2005/12/20 13:08:14 rane Exp $ -->

<guide link="/doc/pl/rsync.xml" lang="pl">

<title>Zasady pracy serwerów rsync</title>
<author title="Autor">
  <mail link="mirror-admin@gentoo.org">Gentoo Mirror Administrators</mail>
</author>
<author title="Redaktor">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Tłumacz">
  Damian Kuras
</author>

<abstract>
W dokumencie tym opisano sposób tworzenia oficjalnego serwera lustrzanego rsync lub
własnego lokalnego serwera lustrzanego.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.13</version>
<date>2005-12-12</date>

<chapter>
<title>Prośby o sprzęt</title>
<section>
<title>Dotowanie sprzętu</title>
<body>

<p>
W Gentoo Linux wyróżniamy dwa typy serwerów lustrzanych: główne serwery
lustrzane (tak zwane "main rotation mirrors") i serwery lustrzane utrzymywane
przez społeczność (tak zwane "community mirrors"). "Main rotation mirrors" są to
dedykowane serwery rsync odpowiedzialne za obsługę dużego ruchu powodowanego
przez tą usługę.  Na wszystkich "main rotation mirrors" zainstalowany jest
Gentoo Linux, a zarządzają nimi członkowie drużyn deweloperskich Gentoo.
"Community mirrors" są to serwery zarządzane przez członków społeczności Gentoo.
Serwery te mogą, ale nie muszą być przeznaczone do obsługi ruchu rsync oraz
mogą, ale nie muszą pracować pod kontrolą Gentoo Linux.
</p>

<p>
W tej chwili posiadamy wystarczającą ilość "community mirrors" jednak usilnie
poszukujemy dodatkowych "main rotation mirrors". Specyfikacja dla "main rotation
servers":
</p>

<ul>
  <li>Co najmniej procesor Pentium 4 2GHz (lub odpowiednik)</li>
  <li>Co najmniej 1GB pamięci RAM (zalecane 1.5GB - 2GB)</li>
  <li>10GB wolnego miejsca na dysku (mogą być to dyski IDE)</li>
</ul>

<p>
Serwery te mogą być dotowane poprzez zwiększenie przepustowości łącza lub
przeznaczenie miejsca na swoim dysku jeśli takowe posiadamy. W innym wypadku,
możemy przeznaczyć serwer na wyżej wymienione potrzeby. Średnie obciążenie łącza
dla "main rotation server" waha się w tym momencie w granicach 7Mbps (około 2
TB danych na miesiąc). W miarę jak ilość "main rotation servers" będzie się
zwiększała, liczba ta powinna stopniowo maleć.
</p>

<p>
Jeśli chciałbyś wysłać dotację na serwer, prosimy o maila do <mail
link="jforman@gentoo.org">Jeffrey Forman</mail> z odpowiednią informacją.
</p>

</body>
</section>
</chapter>
<!--
<chapter>
<title>Wymagania.</title>
<section>
<title>Minimalna przepustowość.</title>
<body>

<p>
Aby zaagwarantować prawidłowe działanie serwera lustrzanego powinniśmy
dysponować łączem o przepustowości co najmniej 5Mbps w obie strony.
</p>

</body>
</section>
<section>
<title>Minimalna ilość użytkowników.</title>
<body>

<p>
Wymagamy aby serwer wspierał co najmniej 15 połączeń od różnych
użytkowników w tym samym czasie.
</p>

</body>
</section>
<section>
<title>Minimalne wymagania sprzętowe.</title>
<body>

<p>
Aby faktycznie móc obsługiwać co najmniej 15 jednoczesnych połączeń, powinniśmy
spełniać minimalne wymagania sprzętowe, które podane są poniżej:
</p>

<ul>
  <li>Procesor PIII 500MHz</li>
  <li>256MB RAM</li>
</ul>

</body>
</section>
<section>
<title>Częstotliwość aktualizacji.</title>
<body>

<p>
Aktualizacje muszą być przeprowadzane w :00 i :30 minucie każdej godziny, przez
cały dzień. Przestrzeganie tego harmonogramu jest <e>bardzo</e> ważne, dopóki
w użyciu znajdują się sekwencyjne DNS-y (round robin style DNS), służące do
wybierania serwera rsync użytkownika.
</p>

</body>
</section>
<section>
<title>MOTD (/etc/rsync/rsyncd.motd)</title>
<body>

<p>
Prosimy zawrzeć poniższe informacje w pliku MOTD serwera:
</p>

<ul>
<li>nazwę serwera</li>
<li>adres IP serwera</li>
<li>specyfikację serwera (rodzaj procesora oraz pojemność pamięci RAM)</li>
<li>przepustowość łącza</li>
<li>jeśli jest, limit połączeń</li>
<li>położenie serwera (kraj i miasto)</li>
<li>nazwę kontaktową oraz adres poczty elektronicznej</li>
</ul>

<p>
Zawarcie powyższych informacji w pliku MOTD sprawi, że zidentyfikowanie serwera
zostanie znacznie ułatwione w razie występienia jakichkolwiek problemów.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Szczegóły dotyczące tworzenia serwera lustrzanego rsync.</title>
<section>
<body>

<p>
Aby utworzyć nowy serwer lustrzany, prosimy postępować według instrukcji
podanych poniżej:
</p>

<ul>
<li>
  Nasz nowo utworzony serwer lustrzany należy zsynchronizować z istniejącym
  publicznym serwer rsync Gentoo Linux. Nie ma znaczenia, który to z
  serwerów będzie. Należy mieć pewność, iż serwer zsynchrornizujemy zgodnie
  z naszym harmonogramem opisanym powyżej w sekcji <e>Częstotliwość
  aktualizacji</e>.
</li>
<li>
  Wypełnijmy zgłoszenie dostępne na <uri
  link="http://bugs.gentoo.org">bugs.gentoo.org</uri>,
  w którym podamy nazwę naszej organizacji, nazwę serwera, adres IP serwera,
  dane kontaktowe oraz, w którym wyrazimy chęć utworzenia nowego serwera
  lustrzanego rsync. Po wysłaniu zgłoszenia serwer zostanie sprawdzony pod
  względem prawidłowego przeprowadzania procesu synchronizacji. Ważną kwestią
  jest synchronizacja dwa razy na godzinę, pierwsza między :00 a :10 minutą i
  drugą pomiędzy :30 a :40 minutą. Synchronizację powinniśmy przeprowadzać w
  tych 10 minutowych okienkach.
</li>
<li>
  Kiedy serwer zostanie już sprawdzony pod tym względem jego adres IP znajdzie
  się na liście dostępu rsync1.us.gentoo.org.
</li>
<li>
  Zaktualizujmy crona tak aby wskazywał na <path>rsync1.us.gentoo.org</path>.
  Serwer będzie monitorowany przez następne 48-72 godzin, aby mieć pewność czy
  synchronizacje przebiegają poprawnie.
</li>
</ul>

<p>
Jeśli wszystko poszło gładko, ustawiony zostanie oficjalny wpis DNS
<path>rsync[liczba].[kod_kraju].gentoo.org</path> i doda nowy serwer do
naszego DNS-a sekwencyjnego dla wpisu rsync.[kod_kontynentu].gentoo.org i
rsync.[kod_kraju].gentoo.org. Niedługo po tym jak wpis zostanie dodany do
DNS-a, na serwerze zauważymy ruch.
</p>

<p>
Dodatkowo, jako administrator serwera lustrzanego zostaniesz dodany do listy
mailingowej gentoo-mirrors o niskim natężeniu ruchu, tak abyś mógł śledzić na
bieżąco wszystkie błędy związane z serwerami lustrzanymi rsync.
</p>

<note>
Dziękujemy za wsparcie udzielane Gentoo Linux przez użytkowników i deweloperów!
:) Wszelakie problemy lub błędy, prosimy zgłaszać odwiedzając stronę <uri
link="http://bugs.gentoo.org">http://bugs.gentoo.org</uri>, a następnej
wypełniając raport błędu dotyczący usługi "Rsync".
</note>

</body>
</section>
</chapter>

<chapter>
<title>Zadania równoległe.</title>
<section>
<body>

<p>
Wkrótce zostanie stworzona strona przy użyciu rrdtool, na której znajdą się
linki do wykresów (ułożone w pierwszej kolejności, według kontynentów, następnie
państw i serwerów) dostępności oficjalnych serwerów lustrzanych rsync (wykresy te
będą sporządzane z wyjścia sping). Wykresy te będą sprawdzane co najmniej raz
dziennie Nieosiągalne serwery zostaną usunięte z DNS-ów sekwencyjnych (round
robin DNS) do czasu rozwiązania problemu. Posiadamy również skrypty
weryfikujące co 30 minut czy wszystkie serwery lustrzane synchronizują się z
nami.
</p>

<warn>
Jeśli problemy z danym serwerem będą powtarzać się zbyt często, a
administrator wiedząc o tych problemach nie będzie robił nic co miało by
poprawić daną sytuację, wpis takiego serwer lustrzanego może zostać
usunięty z DNS-a sekwencyjnego (round robin DNS) na stałe.
</warn>

</body>
</section>
</chapter>
-->
<chapter>
<title>Krótkie FAQ (akceptowane jako informacje dla obecnych administratorów
serwerów lustrzanych).</title>
<section>
<title>Z kim powinnienem się skontaktować odnośnie problemów z rsync?</title>
<body>

<p>
Odwiedź http://bugs.gentoo.org i wypełnij raport odnoszący się do usługi.
"Rsync".
</p>

</body>
</section>
<section>
<title>Posiadam prywatny serwer lustrzany rsync w mojej firmie. Czy mogę uzyskać
dostęp do rsync1.us.gentoo.org?</title>
<body>

<p>
A: Ponieważ nasze zasoby są ograniczone musimy zaagwarantować, że zostaną one
wykorzystane w sposób zapewniający jak największy komfort dla naszych
użytkowników. Dlatego też, główny serwer lustrzany rsync i distfile zezwala na
połączenia jedynie od publicznych serwerów lustrzanych. Użytkownicy, którzy
zakładają prywatne serwery lustrzane mogą używać naszego zwyczajnego systemu
serwerów lustrzanych, tym niemniej powinni przestrzegać pewnych <uri
link="http://www.gentoo.org/news/en/gwn/20030505-newsletter.xml#doc_chap1_sect3"
> podstawowych wytycznych</uri> dotyczących serwerów lustrzanych rsync.
</p>

</body>
</section>
<section>
<title>Czy ważną kwestią jest synchronizacja serwera lustrzanego dwa razy na
godzinę?</title>
<body>

<p>
Tak, jest to ważne. Nie musimy przeprowadzać synchronizacji dokładnie w :00 i
:30 minucie, jednak powinny one odbywać się w każdym z dwóch przedziałów
czasowych:
</p>

<ol>
  <li>między :00 a :10 minutą</li>
  <li>między :30 a :40 minutą</li>
</ol>

<p>
Dodatkowo trzeba zadbać o to, aby między synchronizacjami była dokładnie
30-minutowa przerwa. Jeśli wykonamy pierwszą synchronizację w :08 minucie danej
godziny, drugą należy przeprowadzić w :38 minucie tej samej godziny.
</p>

</body>
</section>
<section>
<title>
Z czym synchronizować serwer rsync zanim stanie się on oficjalnym serwerem
lustrzanym Gentoo?
</title>
<body>

<ul>
  <li>Europa: rsync.de.gentoo.org</li>
  <li>Stany Zjednoczone: rsync.us.gentoo.org</li>
  <li>Reszta świata: rsync.us.gentoo.org</li>
</ul>

</body>
</section>
<section>
<title>Jak znaleźć serwer lustrzany znajdujący się najbliżej miejsca
zamieszkania?</title>
<body>

<p>
Narzędzie <c>netselect</c> zostało zaprojektowane do wykonania tej czynności za
użytkownika. Jeśli jeszcze nie zainstalowaliśmy tego narzędzia, zróbmy to teraz
poprzez użycie polecenia <c>emerge netselect</c>. Następnie należy uruchomić go
poleceniem <c>netselect rsync.gentoo.org</c>. Po chwili jako wynik polecenia
otrzymamy adres IP. Adres ten, z dwoma dwukropkami na końcu, będzie jedynym
parametrem dla serwera rsync - np. <c>rsync 1.2.3.4::</c>. Po wiadomości z
banera można dowiedzieć się, który to jest serwer lustrzany. Na koniec
powinniśmy również zaktualizować plik <path>/etc/make.conf</path>.
</p>

</body>
</section>
<section>
<title>Czy można używać kompresji przy synchronizacji z serwerem
rsync1.us.gentoo.org?</title>
<body>

<p>
A: Nie. Kompresja bardzo silnie obciąża serwer, więc zostaliśmy zmuszeni do
wyłączenia jej na <path>rsync1.us.gentoo.org</path>. Prosimy o <e>nie</e>
używanie kompresji podczas synchronizacji z tym serwerem.
</p>

</body>
</section>
<section>
<title>Widzę bardzo dużo starych i prawdopodobnie martwych procesów rsync,
jak mogę się ich pozbyć?</title>
<body>

<p>
Prosimy zajrzeć do rozdziału "Przykładowe skrypty".
</p>

</body>
</section>
<section>
<title>Wielu użytkowników łączy się do mojego serwer rsync zbyt często,
czasami powodując ataki typu DoS, czy jest jakiś sposób, aby zapobiec tego
typu zdarzeniom?</title>
<body>

<p>
Ponownie prosimy zajrzeć do rozdziału "Przykładowe skrypty".
</p>

</body>
</section>
</chapter>

<chapter>
<title>Przykładowe skrypty.</title>
<section>
<body>

<note>
Przykładowe pliki konfiguracyjne oraz skrypty znajdziemy w pakiecie
gentoo-rsync-mirror. Wystarczy wydać polecenie <c>emerge
gentoo-rsync-mirror</c>, aby go zainstalować.
</note>

<p>
Do mirrorowania drzewa Portage potrzeba około 250MB wolnego miejsca. Posiadanie
przynajmniej 500MB wolnego miejsca powinno pozwolić nam spać spokojnie, w miarę
jak drzewo Portage będzie się rozrastało w przyszłości. Konfiguracja serwera
lustrzanego drzewa Portage jest prosta. Na początek należy upewnić się czy nasz
serwer posiada zainstalowanego demona rsyncd. Następnie, konfigurujemy plik
<path>rsyncd.conf</path> tak, aby wyglądał jak poniżej:
</p>

<pre caption="rsyncd.conf">
uid = nobody
gid = nobody
use chroot = yes
max connections = 15
pid file = /var/run/rsyncd.pid
motd file = /etc/rsync/rsyncd.motd
log file = /var/log/rsync.log
transfer logging = yes
log format = %t %a %m %f %b
syslog facility = local3
timeout = 300

[gentoo-x86-portage]
#wpis niezbędny dla zachowania kompatybilności
path = /gentoo/rsync
comment = Gentoo Linux Portage tree

[gentoo-portage]
#współczesne wersje Portage używają takiego rodzaju wpisów
path = /gentoo/rsync
comment = Gentoo Linux Portage tree mirror
exclude = distfiles
</pre>

<p>
W powyższym przykładzie, serwer lustrzany gentoo-x86-portage odnosi się do tych
samych danych co serwer gentoo-portage. Chociaż zmieniliśmy oficjalną nazwę
serwera lustrzanego na gentoo-portage, nazwa gentoo-x86-portage jest cały czas
potrzeba dla zachowania wstecznej kompatybilności, więc powinniśmy zawrzeć
obydwa wpisy.
</p>

<p>
Ze względów bezpieczeństwa wymagane jest użycie chrootowanego środowiska!
</p>

<p>
Teraz potrzebujemy zmirrorować drzewo Portage Gentoo Linux. Aby to uczynić,
należy użyć następującego skryptu:
</p>

<pre caption="rsync-gentoo-portage.sh">
#!/bin/bash

RSYNC="/usr/bin/rsync"
OPTS="--quiet --recursive --links --perms --times --devices --delete --timeout=300"
#Odkomentujmy tą linię tylko w wypadku udzielenia nam dostępu do serwera
rsync1.us.gentoo.org
#SRC="rsync://rsync1.us.gentoo.org/gentoo-portage"
#Jeśli czekamy na udzielenie dostępu do głównego serwera lustrzanego, wybierzmy
jeden z pozostałych serwerów lustrzanych:
SRC="rsync://rsync2.de.gentoo.org/gentoo-portage"
DST="/space/gentoo/rsync/"

echo "Started update at" `date` >> $0.log 2>&amp;1
logger -t rsync "re-rsyncing the gentoo-portage tree"
${RSYNC} ${OPTS} ${SRC} ${DST} >> $0.log 2>&amp;1

echo "End: "`date` >> $0.log 2>&amp;1
</pre>

<pre caption="/etc/init.d/rsyncd">
#!/sbin/runscript
# Copyright 1999-2004 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# &#36;Header: /var/cvsroot/gentoo-x86/net-misc/rsync/files/rsyncd.init.d,v 1.2 2004/05/02 22:45:02 mholzer Exp &#36;

depend() {
need net
}

# FYI: --sparce seems to cause problems.
RSYNCOPTS="--daemon --safe-links --timeout=300"

start() {
ebegin "Starting rsync daemon"
start-stop-daemon --start --quiet --pidfile /var/run/rsyncd.pid --nicelevel 15 --exec /usr/bin/rsync -- ${RSYNCOPTS}
eend $?
}

stop() {
ebegin "Stopping rsync daemon"
start-stop-daemon --stop --quiet --pidfile /var/run/rsyncd.pid
eend $?
}
</pre>

<p>
W pliku <path>rsyncd.motd</path> powinny znaleźć się takie informacje jak 
adres IP oraz przydatne dane na temat samego serwera lustrzanego, takie jak
informacje na temat hosta utrzymującego serwer lustrzany drzewa Portage lub
kontakt do administratora. Po tym jak zostaniemy zaakceptowani jako oficjalny
serwer lustrzany rsync, zostanie nam przydzielony alias w postaci:
<path>rsync[liczba].[kod_kraju].gentoo.org</path>
</p>

<p>
Polecenie to pomoże zabić stare procesy rsync, które czasami stwarzają problemy
z diagnozowaniem problemów związanych z połączeniem. Ważnym aspektem jest, aby
procesy te zabijać, ponieważ zliczane są jako prawidłowe połączenia dla opcji
'max connections'. Polecenie to można uruchamiać przy pomocy crontaba co
godzinę, odnajdzie ono i zabije procesy rsync, które są starsze niż jedna
godzina.
</p>

<pre caption="Zabijanie starych procesów rsync">
/bin/kill -9 `/bin/ps --no-headers -Crsync -o etime,user,pid,command|/bin/grep nobody | \
             /bin/grep "[0-9]\{2\}:[0-9]\{2\}:" |/bin/awk '{print $3}'`
</pre>

<p>
Czasami zdarza się, że znajdą się lekkomyślni użytkownicy, którzy nadużywają
systemu serwerów lustrzanych rsync, wykonując synchronizacje więcej niż 1-2 razy
na dzień. W najbardziej ekstremalnych przypadkach użytkownicy ustawiają crona
tak aby wykonywał synchrornizację co 15 minut. Często prowadzi to do ataku typu
Denial Of Service poprzez zajmowanie slotu rsync, który w innym przypadku mógłby
zostać wykorzystany przez innego użytkownika. Aby zapobiec tego typu zdarzeniom,
możemy użyć <uri
link="/proj/en/infrastructure/mirrors/rsyncd.conf_pl.txt">skryptu perl</uri>,
który przeskanuje pliki log serwera rsync, wybierze adresy IP, z których
połączono się więcej niż <c>N</c> razy na dzień i dynamicznie stworzy plik,
<path>rsyncd.conf</path> zawierający regułkę z danym adresem IP w sekcji 'hosts
deny'. Poniższa linia kontroluje wielkość zmiennej <c>N</c>:
</p>

<pre caption="Definiujemy maksymalną ilość połączeń z jednego IP">
@badhosts=grep {$hash{$_}>4} keys %hash;
</pre>

<p>
Jeśli będziemy używać tego skryptu, pamiętajmy o codziennej rotacji logów
serwera rsync, oraz o dopasowaniu skryptu do lokalizacji naszego pliku
<path>rsyncd.motd</path>. Skrypt ten został przetestowany na Gentoo Linux, 
jednak powinien on również działać na innych platformach, które posiadają
wsparcie zarówno dla rsync jak i perla.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Zakładanie własnego lokalnego serwera lustrzanego rsync</title>
<section>
<title>Wprowadzenie</title>
<body>

<p>
Wielu użytkowników posiada Gentoo na wielu komputerach przez to potrzebują na
każdym z nich uruchamiać polecenie <c>emerge --sync</c>. Używanie publicznych
serwerów lustrzanych jest zwyczajnym marnotrawienie przepustowości po obu
stronach. Synchronizowanie tylko jednego komputera z publicznym serwerem
lustrzanym, a całej reszty z tym komputerem oszczędzi zasoby serwerów
lustrzanych Gentoo jaki i przepustowość łącza użytkownika.
</p>

<p>
Wszystko co musimy zrobić to wybrać, który z komputerów zostanie lokalnym
serwerem lustrzanym rsync i ustawić go w takiej funkcji. Powinniśmy wybrać
komputer, którego parametry odpowiadają minimalnym parametrom jakich wymagają
serwery rsync. Lokalny serwer lustrzany powinien ponadto być dostępny zawsze
kiedy tylko którykolwiek z pozostałych komputerów zechce zsynchronizować swoje
drzewo Portage. Ponadto powinien posiadać stały adres IP lub nazwę, pod którą
serwer zawsze będzie osiągalny. Konfiguracja DHCP i/lub serwera DNS
wykracza poza zakres tego przewodnika.
</p>

</body>
</section>
<section>
<title>Instalowanie serwera.</title>
<body>

<p>
Nie potrzeba instalować żadnych dodatkowych pakietów, jeśli wymagane programy są
już zainstalowane na komputerze. Postawienie lokalnego serwera lustrzanego rsync
jest tylko kwestią konkurencji demona <e>rsyncd</e>, tak aby uczynić katalog
<path>/usr/portage</path> dostępnym dla synchronizacji. Stwórz plik
konfiguracyjny <path>/etc/rsyncd.conf</path>:
</p>

<pre caption="Przykładowy plik /etc/rsyncd.conf">
pid file = /var/run/rsyncd.pid
max connections = 5
use chroot = yes
uid = nobody
gid = nobody
<comment># Opcja: Ograniczamy dostęp do komputerów z zains/alowanym Gentoo</comment>
hosts allow = 192.168.0.1 192.168.0.2 192.168.1.0/24
hosts deny  = *

[gentoo-portage]
path=/usr/portage
comment=Gentoo Portage
exclude=distfiles/ packages/
</pre>

<p>
Nie musimy korzystać z opcji <c>hosts allow</c> i <c>hosts deny</c>. Domyślnie
wszyscy klienci mogą łączyć się bez problemu. Kolejność, w której wpiszemy te
opcje nie ma znaczenia. Serwer zawsze sprawdzi opcję <c>hosts allow</c> jako
pierwszą i zezwoli na połączenie jeśli host który łączy się do niego pasuje do
któregoś z adresów z listy. Potem, serwer sprawdzi opcję <c>hosts deny</c> i
odrzuci połączenie jeśli znajdzie wpis odpowiadający hostowi, który łączy się do
serwera. Każdemu hostowi, który nie znajduje się na tej liście, zostanie
przydzielony dostęp. Więcej informacji można znaleźć w <c>man rsyncd.conf</c>.
</p>

<p>
Następnie pora uruchomić demona rsync wpisując poniższą komendę jako root:
</p>

<pre caption="Uruchamiamy demona rsync">
<comment>(Uruchamiamy demona rsync)</comment>
# <i>/etc/init.d/rsyncd start</i>
<comment>(Dodajemy demona do domyślnego pozmiomu uruchomieniowego)</comment>
# <i>rc-update add rsyncd default</i>
</pre>

<p>
Przetestujmy teraz nasz serwer lustrzany rsync. Nie musimy tego robić z innego
komputera, ale takie rozwiązanie będzie dobrym wyjściem. Jeśli serwer nie jest
znany z nazwy, możemy zamiast tego użyć jego adresu IP.
</p>

<pre caption="Testujemy serwer lustrzany">
<comment>(Możemy użyć nazwy serwera lub jego adresu IP)</comment>
# <i>rsync 192.168.0.1::</i>
gentoo-portage     Gentoo Portage
# <i>rsync nazwa_serwera::gentoo-portage</i>
<comment>(Powinniśmy zobaczyć zawartość /usr/portage na naszym serwerze
lustrzanym)</comment>
</pre>

<p>
Serwer lustrzany rsync jest już ustawiony. Uruchamiajmy regularnie <c>emerge
--sync</c>, aby serwer cały czas posiadał aktualne drzewo Portage.
</p>

<note>
Prosimy zanotować, że większość administratorów publicznych serwerów lustrzanych
rsync uważa synchronizowanie więcej niż raz, czy dwa razy dziennie za nadużycie.
</note>

</body>
</section>
<section>
<title>Konifguracja klientów</title>
<body>

<p>
Teraz, skonfigurujemy pozostałe komputery tak, aby używały lokalnego serwera
lustrzanego rsync, zamiast publicznego. Edytujemy plik
<path>/etc/make.cong</path> i ustawiamy zmienną <c>SYNC</c> tak aby prowadziła
do naszego serwera.
</p>

<pre caption="Definujemy SYNC w pliku /etc/make.conf">
<comment>(Należy użyć adres IP serwera lokalnego)</comment>
SYNC="rsync://<i>192.168.0.1</i>/gentoo-portage"
<comment>(Lub nazwy tegoż serwera)</comment>
SYNC="rsync://<i>nazwa_naszego_serwera</i>/gentoo-portage"
</pre>

<p>
Możemy sprawdzić czy poprawnie ustawiliśmy komputer i czy synchronizuje się on z
naszym lokalnym serwerem lustrzanym, a nie robi tego z publicznym:
</p>

<pre caption="Sprawdzanie i synchronizacja">
<comment>(Sprawdzamy czy zmienna SYNC została poprawnie ustawiona)</comment>
# <i>emerge --info|grep SYNC</i>
SYNC="rsync://nazwa_naszego_serwera/gentoo-portage"
<comment>(Synchronizacja z naszego lokalnego serwera lustrzanego)</comment>
# <i>emerge --sync</i>
</pre>

<p>
To wszystko! Wszystkie komputery będą teraz używały lokalnego serwera
lustrzanego, każdorazowo kiedy wydamy polecenie <c>emerge --sync</c>.
</p>

</body>
</section>
</chapter>
</guide>
