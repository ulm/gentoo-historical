<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/handbook/Attic/hb-install-amd64-bootloader.xml,v 1.1 2004/12/24 10:55:12 neysx Exp $ -->

<sections>

<version>1.10</version>
<date>2004-10-20</date>

<section>
<title>Podejmowanie decyzji.</title>
<subsection>
<title>Wprowadzenie.</title>
<body>

<p>
Gdy skonfigurowałeś jądro i zmodyfikowałeś odpowiednio niezbędne systemowe
pliki konfiguracyjne nadeszła pora zainstalowania programu, który uruchomi jądro
w momencie startu systemu. Taki program nazywa się <e>bootloader</e>.
</p>

</body>
</subsection>
<subsection>
<title>Opcjonalnie: Obsługa framebuffera.</title>
<body>

<p>
<e>Gdy</e> skonfigurowałeś jądro z obsługą framebuffera i chcesz to wykorzystać,
musisz dodać parametr <c>video</c> do konfiguracji bootloadera.
</p>

<p>
Więcej informacji na temat framebuffera znajdziesz w dokumencie
<path>/usr/src/linux/Documentation/fb/vesafb.txt</path>.
</p>

<p>
Zapamiętaj (albo zapisz) wybraną wartość; niedługo Ci się ona przyda.
</p>

</body>
</subsection>
</section>
<section>
<title>Użycie programu GRUB.</title>
<subsection>
<title>Wyjaśnienie terminologii GRUB'a.</title>
<body>

<p>
Najważniejszym czynnikiem prowadzącym do zrozumienia programu
GRUB jest pojęcie jego sposobu odnoszenia się do dysków i partycji.
Twoja linuksowa partycja <path>/dev/hda1</path> jest określana
przez GRUBa jako <path>(hd0,0)</path>.
Zauważ nawiasy po obu stronach <path>hd0,0</path> - ich użycie jest wymagane.
</p>

<p>
Dyski twarde są liczone od zera, a nie od "a", partycje także zaczynają
się od zera, a nie od jedynki. Bądź świadom także tego, że w grupie
urządzeń pamięci masowej tylko twarde dyski są liczone, nie ma to
natomiast miejsca w przypadku napędów ATAPI-IDE takich jak cdromy
i nagrywarki. Ta sama sytuacja ma miejsce w przypadku dysków SCSI.
(Normalnie otrzymują one wyższe numery niż dyski IDE za wyjątkiem
sytuacji, gdy BIOS jest ustawiony na start systemu z urządzenia SCSI.)
</p>

<p>
Zakładając, że masz dysk twardy oznaczony jako <path>/dev/hda</path>,
odtwarzacz cdrom <path>/dev/hdb</path>, nagrywarkę <path>/dev/hdc</path>,
drugi dysk twardy <path>/dev/hdd</path> i nie posiadasz dysku SCSI,
urządzenie <path>/dev/hdd7</path> jest rozumiane jako <path>(hd1,6)</path>.
Całość wygląda dość pokrętnie, lecz jak się
niedługo przekonamy GRUB oferuje mechanizm uzupełniania wiersza polecenia
klawiszem TAB, co z pewnością jest wybawieniem dla tych, którzy mają
dużo dysków twardych i partycji, a gubią się nieco w sposobie numeracji
używanym przez program GRUB.
</p>

<p>
Już wiesz co Cię czeka, nadeszła pora zainstalować GRUB'a.
</p>

</body>
</subsection>
<subsection>
<title>Instalowanie GRUB'a.</title>
<body>

<p>
Do zainstalowania programu GRUB użyj komendy emerge:
</p>

<pre caption = "Instalowanie GRUBa">
# <i>emerge --usepkg grub</i>
# <i>cp -Rpv /usr/share/grub/i386-pc/* /boot/grub</i>
</pre>

<p>
GRUB został zainstalowany, teraz należy go jeszcze skonfigurować i umieścić w
MBR, tak by automatycznie uruchamiał nowo zainstalowane kernele. Najpierw przy
pomocy nano, lub dowolnego innego edytora utwórz plik
<path>/boot/grub/grub.conf</path>:
</p>

<pre caption = "Tworzenie pliku /boot/grub/grub.conf">
# <i>nano -w /boot/grub/grub.conf</i>
</pre>

<p>
Następnie zredagujmy plik <path>grub.conf</path>. Poniżej
znajdziesz trzy przykłady pliku <path>grub.conf</path>, odpowiadające
schematowi partycjonowania użytemu w tym przewodniku, z obrazem jądra
o nazwie <path>kernel-2.6.5-gentoo</path>. Wyczerpująco opatrzymy komentarzami
tylko pierwszy <path>grub.conf</path>.
</p>

<ul>
  <li>
    Pierwszy <path>grub.conf</path> jest dla osób, które nie wykorzystały
    programu <c>genkernel</c> do budowania jądra.
  </li>
  <li>
    Drugi <path>grub.conf</path> jest dla tych, którzy użyli programu
    <c>genkernel</c> do zbudowania jądra.
  </li>
</ul>

<pre caption = "grub.conf dla nie używających genkernela">
<comment># Która pozycja ma być uruchamiana domyślnie. 0 oznacza pierwszą, 1 drugą itd</comment>
default 0
<comment># Ile sekund oczekiwać przed uruchomieniem pozycji domyślnej.</comment>
timeout 30
<comment># Ładniutki, tłuściutki obrazek na zaostrzenie apetytu :)
# Zakomentuj jeśli nie masz zainstalowanej karty graficznej</comment>
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.5
<comment># Partycja na której znajduje się obraz jądra (lub system operacyjny) </comment>
root (hd0,0)
kernel /kernel-2.6.5-gentoo root=/dev/hda3

<comment># Następne cztery linie potrzebne są tylko gdy chcesz uruchamiać także Windows.</comment>
<comment># W tym przypadku, Windows mieści się na /dev/hda6.</comment>
title=Windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
</pre>

<pre caption = "grub.conf dla użytkowników genkernela">
default 0
timeout 30
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.5
root (hd0,0)
kernel /kernel-2.6.5-gentoo root=/dev/ram0 init=/linuxrc ramdisk=8192 real_root=/dev/hda3
initrd /initrd-2.6.5-gentoo

<comment># Tylko, gdy chcesz uruchamiać dwa systemy</comment>
title=Windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
</pre>


<note>
Jeśli partycjonowanie wykonałeś w inny sposób i/lub używasz innego obrazu jądra,
dokonaj niezbędnych poprawek. Warto pilnować, aby wszystko co dotyczy urządzenia
z GRUB'em (np. <path>(hd0,0)</path>) było względne w stosunku do punktu
montowania, a nie partycji root. Innymi słowy,
<path>(hd0,0)/grub/splash.xpm.gz</path>
w rzeczywistości znaczy <path>/boot/grub/splash.xpm.gz</path>, gdyż
<path>(hd0,0)</path>
to partycja <path>/boot</path>.
</note>

<p>
Jeśli chcesz przekazać do jądra przy starcie jakieś dodatkowe opcje po prostu
dopisz je na końcu polecenia kernel. W tym momencie już dodaliśmy jeden
parametr (<c>root=/dev/hda3</c> lub <c>real_root=/dev/hda3</c>), a Ty
bez problemu możesz wzbogacić polecenie o kolejne. Przykładowo
posłużymy się opcją <c>vga</c>, dotyczącą bufora ramki, którą
przedyskutowaliśmy kilka paragrafów wcześniej:
</p>

<pre caption = "Dodawanie vga jako parametru startowego dla jądra">
title=Gentoo Linux
  root (hd0,0)
  kernel /kernel-2.6.5 root=/dev/hda3 video=vesafb
</pre>

<p>
Użytkownicy programu <c>genkernel</c> powinni wiedzieć, że jądra, które zbudowali
używają tych samych opcji bootowania co LiveCD. Na przykład jeśli masz urządzenia
SCSI, powinieneś dodać parametr <c>doscsi</c>.
</p>

<p>
Następnie zapisz plik <path>grub.conf</path> i opuść edytor. Kolejnym krokiem
będzie dopisanie GRUB'a do MBR.
</p>

<p>

Twórcy GRUB'a zalecają użycie <c>grub-install</c>. Czasem jednak program ten z
jakiegoś powodu odmówi współpracy wciąż pozostanie Ci możliwość ręcznego
zainstalowania GRUB'a.
</p>

<p>
Teraz przejdź do paragrafu <uri link="#grub-install-auto">Domyślnie: Instalowanie
GRUB'a przy pomocy grub-install</uri> lub <uri link="#grub-install-manual">
Alternatywnie: Ręczne instalowanie GRUB'a</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-auto">
<title>Domyślnie: Instalowanie GRUB'a przy pomocy grub-install</title>
<body>

<p>
Żeby zainstalować GRUB'a wpisz komendę <c>grub-install</c>. Nie zadziała to
jednak bez pewnych zmian, bo wciąż działamy w chrootowanym
środowisku. Będziemy musieli uaktualnić plik <path>/etc/mtab</path> (plik z
informacjami dotyczącymi zamontowanych napędów). Na szczęście jest na to prosta
metoda, wystarczy nadpisać ten plik plikiem <path>/proc/mounts</path>.
</p>

<pre caption="Aktualizacja /etc/mtab">
# <i>cp /proc/mounts /etc/mtab</i>
</pre>

<p>
Teraz możemy zainstalować GRUB'a poleceniem <c>grub-install</c>:
</p>

<pre caption="Uruchamianie grub-install">
# <i>grub-install --root-directory=/boot /dev/hda</i>
</pre>

<p>
Więcej informacji o GRUB'ie znajdziesz w dokumentach:
<uri link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> i <uri
link="http://www.gnu.org/software/grub/manual/">GRUB Manual</uri>.
</p>

<p>
Następnie przejdź do części <uri link="#reboot">Ponowne uruchamianie
systemu</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-manual">
<title>Alternatnie: Ręczna instalacja GRUB'a.</title>
<body>

<p>
Aby zacząć wpisz <c>grub</c>. Znak zachęty zmieni się na taki:
<path>grub&gt;</path>. Teraz wpisujesz serię odpowiednich komend, aby nagrać
program GRUB na swój dysk.
</p>

<pre caption = "Uruchomienie powłoki GRUB'a">
# <i>grub</i>
</pre>

<note>
Jeżeli nie posiadasz stacji dyskietek, dodaj opcję <c>--no-floppy</c>
do powyższego polecenia by zapobiec wykrywaniu przez program nieistniejących
napędów.
</note>

<p>
Wyobraźmy sobie, że chcemy zainstalować GRUB tak aby odczytywał informacje z
bootowalnej partycji <path>/dev/hda1</path> i instalował swój boot record w MBR
twardego dysku, tak żeby pierwszą rzeczą jaką zobaczymy po uruchomieniu
komputera był znak zachęty GRUB'a. Oczywiście powinieneś odpowiednio dostosować
wszystkie opcje do swojej konfiguracji.
</p>

<p>
Mechanizm uzupełniania składni jest bardzo pomocny przy konfigurowaniu GRUB'a.
Na przykład wpisując "<c>root (</c>" i wciskając TAB możemy zobaczyć wszystkie
urządzenia (np. <path>hd0</path>). Jeśli wpiszemy "<c>root (hd0,</c>" i
wciśniemy TAB zobaczymy listę wszystkich dostępnych partycji na urządzeniu
(np.<path>hd0,0</path>).
</p>

<p>
Przy pomocy tego systemu skonfigurowanie GRUB'a powinno być proste. Zróbmy więc
to wreszcie ;]
</p>

<pre caption ="Instalacja GRUB in the MBR">
grub&gt; <i>root (hd0,0)</i>          <comment>(Wpisz swoją partycję
/boot)</comment>
grub&gt; <i>setup (hd0)</i>           <comment>(Instalacja GRUB'a w
MBR)</comment>
grub&gt; <i>quit</i>                  <comment>(Opuszczenie powłoki
GRUB)</comment>
</pre>

<note>
Jeśli chcesz mieć GRUB nie w MBR, a na jakieś wybranej partycji musisz
odpowiednio zmienić komendę <c>setup</c> tak by wskazywała na odpowiednie
urządzenie. Na przykład dla GRUB;a zainstalowanego w <path>/dev/hda3</path>
będzie to <c>setup (hd0,2)</c>.
</note>

<p>
Jeśli chcesz dowiedzieć się więcej poszukaj informacji na stronach: <uri
link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> i <uri
link="http://www.gnu.org/software/grub/manual/">GRUB Manual</uri>.
</p>

<p>
Następnie możesz przejść do sekcji <uri link="#reboot">Ponowne uruchamianie
systemu</uri>.
</p>


</body>
</subsection>

</section>
<section id="reboot">
<title>Ponowne uruchomienie Systemu</title>
<subsection>
<body>

<p>
Wyjdź ze środowiska chroot i odmontuj wszytskie zamontowane partycje. Następnie wpisz to
magiczne polecenie na które tak długo czekałeś: <c>reboot</c>
</p>

<pre caption="Wyjście z chroota, odmontowanie wszystkich zamontowanych partycji i ponowne uruchomienie">
# <i>exit</i>
cdimage ~# <i>cd</i>
cdimage ~# <i>umount /mnt/gentoo/boot /mnt/gentoo/proc /mnt/gentoo</i>
cdimage ~# <i>reboot</i>
</pre>

<p>
Nie zapomnij o wyłożeniu rozruchowej płyty CD, by wystartować system Gentoo z dysku, a nie
z płyty CD.
</p>

<p>
Następnie zakończ proces instalacji zgodnie ze wskazówkami spisanymi w rozdziale <uri
link="?part=1&amp;chap=11">Finalizowanie instalacji Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>

