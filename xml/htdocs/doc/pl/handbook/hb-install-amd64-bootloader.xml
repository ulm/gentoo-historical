<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/handbook/Attic/hb-install-amd64-bootloader.xml,v 1.4 2005/06/10 20:52:13 fox2mike Exp $ -->

<!-- Orig revision: 1.29 -->
<!-- Translator: sekretarz <sekretarz@gentoo.org> -->
<!-- Title: O instalacji Gentoo Linux -->
<!-- Status: Release  -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<sections>

<version>2.3</version>
<date>2005-04-16</date>

<section>
<title>Podejmowanie decyzji.</title>
<subsection>
<title>Wprowadzenie.</title>
<body>

<p>
Gdy skonfigurowałeś jądro i zmodyfikowałeś odpowiednio niezbędne systemowe
pliki konfiguracyjne nadeszła pora zainstalowania programu, który uruchomi jądro
w momencie startu systemu. Taki program nazywa się <e>bootloader</e>.
</p>

</body>
</subsection>
<subsection>
<title>Opcjonalnie: Obsługa framebuffera.</title>
<body>

<!-- Verbatim copy from x86 bootloader framebuffer explanation -->

<p>
<e>Gdy</e> skonfigurowałeś jądro z obsługą framebuffera (lub do kompilacji jądra
użyłeś domyślnej konfiguracji genkernel'a) i chcesz go wykorzystać,
musisz dodać parametr <c>vga</c> lub/i <c>video</c> do konfiguracji bootloadera.
</p>

<p>
Na początek musisz się dowiedzieć jakiego typu urządzenia framebuffera aktualnie
używasz. Jeżeli używasz jądra dostarczonego przez Gentoo (jak np. 
<c>gentoo-sources</c>) będziesz miał możliwość wyboru <c>vesafb-tng</c> jako 
<e>sterownika VESA</e> (który jest domyślną opcją w tych źródłach jądra).
W przypadku użycia <c>vesafb-tng</c> nie będziesz potrzebował ustawiać opcji
<c>vga</c> w konfiguracji bootloadera. Gdy chcesz używać sterownika <c>vesafb</c>
ta opcja będzie musiała byc dopisana.
</p>

<p>
Opcja <c>vga</c> kontroluje rozdzielczość oraz głębię kolorów ekranu framebuffera
dla sterownika <c>vesafb</c>. Jak zaznaczono w pliku 
<path>/usr/src/linux/Documentation/fb/vesafb.txt</path> (który instaluje się
wraz z pakietem, który zawiera źródła jądra), musisz wybrać numer VESA 
odpowiadający żądanej rozdzielczości oraz głębi kolorów.
</p>

<p>
Następująca tabela pokazuje dostępne rozdzielczości i głębie kolorów i dopasowuje
je do wartości jaką musisz przekazać do opcji <c>vga</c>.
</p>

<table>
  	 <tr>
  	   <ti></ti>
  	   <th>640x480</th>
  	   <th>800x600</th>
  	   <th>1024x768</th>
  	   <th>1280x1024</th>
  	 </tr>
  	 <tr>
  	   <th>256</th>
  	   <ti>0x301</ti>
  	   <ti>0x303</ti>
  	   <ti>0x305</ti>
  	   <ti>0x307</ti>
  	 </tr>
  	 <tr>
  	   <th>32k</th>
  	   <ti>0x310</ti>
  	   <ti>0x313</ti>
  	   <ti>0x316</ti>
  	   <ti>0x319</ti>
  	 </tr>
  	 <tr>
  	   <th>64k</th>
  	   <ti>0x311</ti>
  	   <ti>0x314</ti>
  	   <ti>0x317</ti>
  	   <ti>0x31A</ti>
  	 </tr>
  	 <tr>
  	   <th>16M</th>
  	   <ti>0x312</ti>
  	   <ti>0x315</ti>
  	   <ti>0x318</ti>
  	   <ti>0x31B</ti>
  	 </tr>
</table>

<p>
Opcja <c>video</c> kontroluje opcje wyświetlania framebuffera. Musi zawierać
rodzaj sterownika (<c>vesafb</c> dla jąder z serii 2.6 lub <c>vesa</c> dla serii
2.4) wraz ze zmiennymi, które chcesz mieć włączone. Wszystkie zmienne są
przedstawione w pliku <path>/usr/src/linux/Documentation/fb/vesafb.txt</path>.
My przedstawimy trzy najcześciej używane opcje:
</p>

<table>
  <tr>
     <th>Opcja</th>
     <th>Opis</th>
  </tr>
  <tr>
     <ti>ywrap</ti>
     <ti>
     Przyjmuje, że karta graficzna może dzielić bloki swojej pamięci (na 
     przyklad kiedy zbliża się do końca pamięci może kontynuować zapis na 
     poczatku).
     </ti>
  </tr>
  <tr>
     <ti>mtrr</ti>
     <ti>
     Ustawia rejestry MTRR
     </ti>
  </tr>
  <tr>
     <ti>mode</ti>
     <ti>
     (Tylko <c>vesafb-tng</c>)<br/>
     Ustawia rozdzielność, głębie koloru oraz odświeżanie. Na przykład,
     <c>1024x768-32@85</c> to rozdzielczość 1024-768 z 32 bitową głębią kolorów
     i częstotliwość odświeżania na poziomie 85 Hz. 
     </ti>
  </tr>
</table>

<p>
Rezultatem tych dwóch opcji może być coś podobnego do <c>vga=0x318
video=vesafb:mtrr,ywrap</c> lub <c>video=vesafb:mtrr,ywrap,1024x768-32@85</c>.
Zapamiętaj (albo zapisz) wybraną wartość; niedługo Ci się ona przyda.
</p>

<p>
Kontynuuj instalując <uri link="#grub">GRUBa</uri>.
</p>

</body>
</subsection>
</section>
<section id="grub">
<title>Użycie programu GRUB.</title>
<subsection>
<title>Wyjaśnienie terminologii GRUB'a.</title>
<body>

<p>
Najważniejszym czynnikiem prowadzącym do zrozumienia programu
GRUB jest pojęcie jego sposobu odnoszenia się do dysków i partycji.
Twoja linuksowa partycja <path>/dev/hda1</path> jest określana
przez GRUBa jako <path>(hd0,0)</path>.
Zauważ nawiasy po obu stronach <path>hd0,0</path> - ich użycie jest wymagane.
</p>

<p>
Dyski twarde są liczone od zera, a nie od "a", partycje także zaczynają
się od zera, a nie od jedynki. Bądź świadom także tego, że w grupie
urządzeń pamięci masowej tylko twarde dyski są liczone, nie ma to
natomiast miejsca w przypadku napędów ATAPI-IDE takich jak cdromy
i nagrywarki. Ta sama sytuacja ma miejsce w przypadku dysków SCSI.
(Normalnie otrzymują one wyższe numery niż dyski IDE za wyjątkiem
sytuacji, gdy BIOS jest ustawiony na start systemu z urządzenia SCSI.)
Kiedy ustawisz BIOS, aby startował system z innego dysku twardego (na przykład
z dysku primary slave), wtedy ten dysk jest widziany jako <path>hd0</path>.
</p>

<p>
Zakładając, że masz dysk twardy oznaczony jako <path>/dev/hda</path>,
odtwarzacz cdrom <path>/dev/hdb</path>, nagrywarkę <path>/dev/hdc</path>,
drugi dysk twardy <path>/dev/hdd</path> i nie posiadasz dysku SCSI,
urządzenie <path>/dev/hdd7</path> jest rozumiane jako <path>(hd1,6)</path>.
Całość wygląda dość pokrętnie, lecz jak się
niedługo przekonamy GRUB oferuje mechanizm uzupełniania wiersza polecenia
klawiszem TAB, co z pewnością jest wybawieniem dla tych, którzy mają
dużo dysków twardych i partycji, a gubią się nieco w sposobie numeracji
używanym przez program GRUB.
</p>

<p>
Już wiesz co Cię czeka, nadeszła pora zainstalować GRUB'a.
</p>

</body>
</subsection>
<subsection>
<title>Instalowanie GRUB'a.</title>
<body>

<p>
Do zainstalowania programu GRUB użyj komendy emerge:
</p>

<pre caption = "Instalowanie GRUBa">
# <i>emerge grub</i>
</pre>

<p>
GRUB został zainstalowany, teraz należy go jeszcze skonfigurować i umieścić w
MBR, tak by automatycznie uruchamiał nowo zainstalowane kernele. Najpierw przy
pomocy nano, lub dowolnego innego edytora utwórz plik
<path>/boot/grub/grub.conf</path>:
</p>

<pre caption = "Tworzenie pliku /boot/grub/grub.conf">
# <i>nano -w /boot/grub/grub.conf</i>
</pre>

<p>
Następnie zredagujmy plik <path>grub.conf</path>. Poniżej
znajdziesz trzy przykłady pliku <path>grub.conf</path>, odpowiadające
schematowi partycjonowania użytemu w tym przewodniku, z obrazem jądra
o nazwie <path>kernel-2.6.11-gentoo-r3</path>. Wyczerpująco opatrzymy komentarzami
tylko pierwszy <path>grub.conf</path>.
</p>

<ul>
  <li>
    Pierwszy <path>grub.conf</path> jest dla osób, które nie wykorzystały
    programu <c>genkernel</c> do budowania jądra.
  </li>
  <li>
    Drugi <path>grub.conf</path> jest dla tych, którzy użyli programu
    <c>genkernel</c> do zbudowania jądra.
  </li>
</ul>

<note>
Użytkownicy systemu plików JFS muszą dodać <c>ro</c> jako parametr dla jądra.
JFS musi mieć możliwość odtwarzania logów w trybie tylko do odczytu zanim
zostanie zamontowane w trybie zarówno odczytu i zapisu.
</note>

<pre caption = "grub.conf dla nie używających genkernela">
<comment># Która pozycja ma być uruchamiana domyślnie. 0 oznacza pierwszą, 1 drugą itd</comment>
default 0
<comment># Ile sekund oczekiwać przed uruchomieniem pozycji domyślnej.</comment>
timeout 30
<comment># Ładniutki, tłuściutki obrazek na zaostrzenie apetytu :)
# Zakomentuj jeśli nie masz zainstalowanej karty graficznej</comment>
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.11
<comment># Partycja na której znajduje się obraz jądra (lub system operacyjny) </comment>
root (hd0,0)
kernel /kernel-2.6.11-gentoo-r3 root=/dev/hda3

<comment># Następne cztery linie potrzebne są tylko gdy chcesz uruchamiać także Windows.</comment>
<comment># W tym przypadku, Windows mieści się na /dev/hda6.</comment>
title=Windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
</pre>

<pre caption = "grub.conf dla użytkowników genkernela">
default 0
timeout 30
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux 2.6.11
root (hd0,0)
kernel /kernel-2.6.11-gentoo-r3 root=/dev/ram0 init=/linuxrc ramdisk=8192 real_root=/dev/hda3
initrd /initrd-2.6.11-gentoo

<comment># Tylko, gdy chcesz uruchamiać dwa systemy</comment>
title=Windows XP
rootnoverify (hd0,5)
makeactive
chainloader +1
</pre>

<note>	
Wpis <c>udev</c> na końcu linii kernel jest potrzebny do ominięcia błędu w
niektórych wersjach genkernel, występującego gdy korzysta się z udev na
pierwszym miejscu.
</note>

<note>
Jeśli partycjonowanie wykonałeś w inny sposób i/lub używasz innego obrazu jądra,
dokonaj niezbędnych poprawek. Warto pilnować, aby wszystko co dotyczy urządzenia
z GRUB'em (np. <path>(hd0,0)</path>) było względne w stosunku do punktu
montowania, a nie partycji root. Innymi słowy,
<path>(hd0,0)/grub/splash.xpm.gz</path>
w rzeczywistości znaczy <path>/boot/grub/splash.xpm.gz</path>, gdyż
<path>(hd0,0)</path>
to partycja <path>/boot</path>.
</note>

<p>
Jeśli chcesz przekazać do jądra przy starcie jakieś dodatkowe opcje po prostu
dopisz je na końcu polecenia kernel. W tym momencie już dodaliśmy jeden
parametr (<c>root=/dev/hda3</c> lub <c>real_root=/dev/hda3</c>), a Ty
bez problemu możesz wzbogacić polecenie o kolejne. Przykładowo
posłużymy się opcją <c>vga</c>, dotyczącą bufora ramki, którą
przedyskutowaliśmy kilka paragrafów wcześniej.
</p>

<p>
Użytkownicy programu <c>genkernel</c> powinni wiedzieć, że jądra, które zbudowali
używają tych samych opcji bootowania co płyta instalacyjna. Na przykład jeśli masz urządzenia
SCSI, powinieneś dodać parametr <c>doscsi</c>.
</p>

<p>
Następnie zapisz plik <path>grub.conf</path> i opuść edytor. Kolejnym krokiem
będzie dopisanie GRUB'a do MBR.
</p>

<p>

Twórcy GRUB'a zalecają użycie <c>grub-install</c>. Czasem jednak program ten z
jakiegoś powodu odmówi współpracy wciąż pozostanie Ci możliwość ręcznego
zainstalowania GRUB'a.
</p>

<p>
Teraz przejdź do paragrafu <uri link="#grub-install-auto">Domyślnie: Instalowanie
GRUB'a przy pomocy grub-install</uri> lub <uri link="#grub-install-manual">
Alternatywnie: Ręczne instalowanie GRUB'a</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-auto">
<title>Domyślnie: Instalowanie GRUB'a przy pomocy grub-install</title>
<body>

<p>
Żeby zainstalować GRUB'a wpisz komendę <c>grub-install</c>. Nie zadziała to
jednak bez pewnych zmian, bo wciąż działamy w chrootowanym
środowisku. Będziemy musieli uaktualnić plik <path>/etc/mtab</path> (plik z
informacjami dotyczącymi zamontowanych napędów). Na szczęście jest na to prosta
metoda, wystarczy nadpisać ten plik plikiem <path>/proc/mounts</path>.
</p>

<pre caption="Aktualizacja /etc/mtab">
# <i>cp /proc/mounts /etc/mtab</i>
</pre>

<p>
Teraz możemy zainstalować GRUB'a poleceniem <c>grub-install</c>:
</p>

<pre caption="Uruchamianie grub-install">
# <i>grub-install /dev/hda</i>
</pre>

<p>
Więcej informacji o GRUB'ie znajdziesz w dokumentach:
<uri link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> i <uri
link="http://www.gnu.org/software/grub/manual/">GRUB Manual</uri>.
</p>

<p>
Następnie przejdź do części <uri link="#reboot">Ponowne uruchamianie
systemu</uri>.
</p>

</body>
</subsection>
<subsection id="grub-install-manual">
<title>Alternatnie: Ręczna instalacja GRUB'a.</title>
<body>

<p>
Aby zacząć wpisz <c>grub</c>. Znak zachęty zmieni się na taki:
<path>grub&gt;</path>. Teraz wpisujesz serię odpowiednich komend, aby nagrać
program GRUB na swój dysk.
</p>

<pre caption = "Uruchomienie powłoki GRUB'a">
# <i>grub</i>
</pre>

<note>
Jeżeli nie posiadasz stacji dyskietek, dodaj opcję <c>--no-floppy</c>
do powyższego polecenia by zapobiec wykrywaniu przez program nieistniejących
napędów.
</note>

<p>
Wyobraźmy sobie, że chcemy zainstalować GRUB tak aby odczytywał informacje z
bootowalnej partycji <path>/dev/hda1</path> i instalował swój boot record w MBR
twardego dysku, tak żeby pierwszą rzeczą jaką zobaczymy po uruchomieniu
komputera był znak zachęty GRUB'a. Oczywiście powinieneś odpowiednio dostosować
wszystkie opcje do swojej konfiguracji.
</p>

<p>
Mechanizm uzupełniania składni jest bardzo pomocny przy konfigurowaniu GRUB'a.
Na przykład wpisując "<c>root (</c>" i wciskając TAB możemy zobaczyć wszystkie
urządzenia (np. <path>hd0</path>). Jeśli wpiszemy "<c>root (hd0,</c>" i
wciśniemy TAB zobaczymy listę wszystkich dostępnych partycji na urządzeniu
(np.<path>hd0,0</path>).
</p>

<p>
Przy pomocy tego systemu skonfigurowanie GRUB'a powinno być proste. Zróbmy więc
to wreszcie ;]
</p>

<pre caption ="Instalacja GRUB in the MBR">
grub&gt; <i>root (hd0,0)</i>          <comment>(Wpisz swoją partycję
/boot)</comment>
grub&gt; <i>setup (hd0)</i>           <comment>(Instalacja GRUB'a w
MBR)</comment>
grub&gt; <i>quit</i>                  <comment>(Opuszczenie powłoki
GRUB)</comment>
</pre>

<note>
Jeśli chcesz mieć GRUB nie w MBR, a na jakieś wybranej partycji musisz
odpowiednio zmienić komendę <c>setup</c> tak by wskazywała na odpowiednie
urządzenie. Na przykład dla GRUB;a zainstalowanego w <path>/dev/hda3</path>
będzie to <c>setup (hd0,2)</c>.
</note>

<p>
Jeśli chcesz dowiedzieć się więcej poszukaj informacji na stronach: <uri
link="http://www.gnu.org/software/grub/grub-faq.html">GRUB FAQ</uri> i <uri
link="http://www.gnu.org/software/grub/manual/">GRUB Manual</uri>.
</p>

<p>
Następnie możesz przejść do sekcji <uri link="#reboot">Ponowne uruchamianie
systemu</uri>.
</p>


</body>
</subsection>

</section>
<section id="reboot">
<title>Ponowne uruchomienie Systemu</title>
<subsection>
<body>

<p>
Wyjdź ze środowiska chroot i odmontuj wszytskie zamontowane partycje. Następnie wpisz to
magiczne polecenie na które tak długo czekałeś: <c>reboot</c>
</p>

<pre caption="Wyjście z chroota, odmontowanie wszystkich zamontowanych partycji i ponowne uruchomienie">
# <i>exit</i>
cdimage ~# <i>cd</i>
cdimage ~# <i>umount /mnt/gentoo/boot /mnt/gentoo/proc /mnt/gentoo</i>
cdimage ~# <i>reboot</i>
</pre>

<p>
Nie zapomnij o wyłożeniu rozruchowej płyty CD, by wystartować system Gentoo z dysku, a nie
z płyty CD.
</p>

<p>
Następnie zakończ proces instalacji zgodnie ze wskazówkami spisanymi w rozdziale <uri
link="?part=1&amp;chap=11">Finalizowanie instalacji Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>

