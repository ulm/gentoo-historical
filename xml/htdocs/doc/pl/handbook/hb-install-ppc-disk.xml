<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/handbook/hb-install-ppc-disk.xml,v 1.10 2005/08/17 23:03:05 rane Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<sections>

<version>2.3</version>
<date>2005-08-09</date>

<section>
<title>Wprowadzenie do urządzeń blokowych</title>
<subsection>
<title>Urządzenia blokowe</title>
<body>

<p>
Rzućmy okiem na aspekty Gentoo Linux, oraz ogólnie Linuksa związane z dyskami.
Omówimy systemy plików, partycje oraz urządzenia blokowe. Następnie
przeprowadzimy Cię przez proces podziału twardego dysku, abyś mógł jak najlepiej
wykorzystać dostępne miejsce.
</p>

<p>
Zaczniemy od omówienia <e>urządzeń blokowych</e>. Najpopularniejszym z nich
prawdopodobnie jest <path>/dev/hda</path>, reprezentujący w Linuksie pierwszy
napęd IDE. Jeśli posiadasz urządzenia SCSI lub SATA pierwszym takim
dyskiem jest <path>/dev/sda</path>.
</p>

<p>
Urządzenia blokowe stanowią abstrakcyjny interfejs dysków. Programy
użytkownika mogą z nich korzystać nie martwiąc się czy napędy
są typu IDE, SCSI, czy nawet jakiegoś jeszcze innego. Przechowywane dane adresuje się
jako ciąg 512-bajtowych bloków.
</p>

</body>
</subsection>
<subsection>
<title>Partycje</title>
<body>

<p>
Teoretycznie możliwe jest przeznaczenie na system całego dysku, zazwyczaj nie
jest to jednak rozwiązanie zbyt praktyczne. Zamiast tego dzielimy napęd na
mniejsze, łatwiejsze w zarządzaniu urządzenia blokowe.  W większości platform
nazywane są one <e>partycjami</e>. 
</p>

</body>
</subsection>
</section>
<section>
<title>Projektowanie schematu podziału</title>
<subsection>
<title>Domyślny schemat podziału</title>
<body>

<p>
Jeśli nie masz ochoty samodzielnie rozrysowywać schematu podziału
swojego dysku, możesz skorzystać z domyślnego, którego
użyjemy w podręczniku:
</p>

<table>
<tr>
  <th>Partycja NewWorld</th>
  <th>Partycja OldWorld</th>
  <th>Partycja Pegasos</th>
  <th>Partycja RS/6000</th>
  <th>Syestem plików</th>
  <th>Rozmiar</th>
  <th>Opis</th>
</tr>
<tr>
  <ti><path>/dev/hda1</path></ti>
  <ti><path>/dev/hda1</path></ti>
  <ti>(Nie wymagana)</ti>
  <ti>(Nie wymagana)</ti>
  <ti>(Mapa partycji)</ti>
  <ti>32k</ti>
  <ti>Apple_partition_map</ti>
</tr>
<tr>
  <ti><path>/dev/hda2</path></ti>
  <ti>(Nie wymagana)</ti>
  <ti>(Nie wymagana)</ti>
  <ti>(Nie wymagana)</ti>
  <ti>(bootstrap)</ti>
  <ti>800k</ti>
  <ti>Apple_Bootstrap</ti>
</tr>
<tr>
  <ti>(Nie wymagana)</ti>
  <ti>(Nie wymagana)</ti>
  <ti>(Nie wymagana)</ti>
  <ti><path>/dev/sda1</path></ti>
  <ti>(PReP Boot)</ti>
  <ti>800k</ti>
  <ti>Typ 0x41</ti>
</tr>
<tr>
  <ti>(Nie wymagana)</ti>
  <ti>(<path>/dev/hda2</path> (Dla quik)</ti>
  <ti><path>/dev/hda1</path></ti>
  <ti>(Niepotrzebna)</ti>
  <ti>ext2</ti>
  <ti>32MB</ti>
  <ti>Partycja rozruchowa</ti>
</tr>
<tr>
  <ti><path>/dev/hda3</path></ti>
  <ti><path>/dev/hda2</path>(<path>/dev/hda3</path> dla quik)</ti>
  <ti><path>/dev/hda2</path></ti>
  <ti><path>/dev/sda2</path></ti>
  <ti>(swap)</ti>
  <ti>512M</ti>
  <ti>Partycja wymiany, typ 0x82</ti>
</tr>
<tr>
  <ti><path>/dev/hda4</path></ti>
  <ti><path>/dev/hda3</path><path>/dev/hda3</path> (<path>/dev/hda4</path> dla quik)</ti>
  <ti><path>/dev/hda3</path></ti>
  <ti><path>/dev/sda3</path></ti>
  <ti>ext3, xfs</ti>
  <ti>Reszta dysku</ti>
  <ti>Partycja główna, typ 0x83</ti>
</tr>

</table>

<note>
Są też partycje o nazwach w stylu: <path>Apple_Driver43, Apple_Driver_ATA,
Apple_FWDriver, Apple_Driver_IOKit, Apple_Patches</path>. Jeśli nie zamierzasz
używać MacOS 9 możesz je usunąć, ponieważ ani MacOS X, ani Linux ich nie
potrzebują. Do ich usunięcia musisz użyć programu parted, mac-fdisk nie jest na
razie w stanie ich skasować.
</note>

<warn>
<c>parted</c> ma możliwość zmiany rozmiaru partycji. Na płytach instalacyjnych
zawiera patche umożliwiające zmianę rozmiaru partycji HFS+. Niestety jest to
dużym ryzykiem w przypadku partycji HFS+ używających journalingu, nawet jeśli
zostanie on wyłączony w Mac OS X. Wszystkie próby zmiany rozmiaru partycji przy
pomocy parted to spore ryzyko, należy przedtem wykonać kopie zapasowe danych!
</warn>

<p>
Jeśli jesteś ciekaw ile i jak dużych partycji radzimy Ci założyć czytaj dalej,
jeśli nie jesteś zainteresowany tymi informacjami przejdź do paragrafu <uri
link="#mac-fdisk">Domyślnie: Użycie mac-fdisk</uri> lub <uri
link="#parted">Alternatywnie: Użycie parted (zwłaszcza dla Pegasosa)</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Jak dużo i jak wielkich?</title>
<body>

<p>
Ilość partycji ściśle zależy od danego środowiska. Na przykład, jeśli
administrujesz systemem mającym wielu użytkowników, prawdopodobnie uznasz za
stosowne oddzielenie <path>/home</path> aby poprawić bezpieczeństwo i uprościć
tworzenie kopii zapasowych. Jeżeli docelowym zastosowaniem Gentoo jest serwer
poczty, na osobnej partycji powinieneś umieścić <path>/var</path>, gdzie
przechowywane są listy. Dobry wybór systemu plików może znacznie zwiększyć
wydajność. Oddzielenie <path>/opt</path> jest dobrym rozwiązaniem na serwerach
gier, gdyż większość używanego oprogramowania zostanie tam zainstalowana. Powód
jest podobny jak przy <path>/home</path>: bezpieczeństwo i kopie zapasowe.  Na
pewno warto zapewnić dużo wolnego miejsca na <path>/usr</path>, ponieważ będą
tam się znajdowały nie tylko dane wszystkich zainstalowanych pakietów, ale
również ważące 500 MB drzewo Portage i kody źródłowe programów.
</p>

<p>
Jak widzisz, wiele zależy od oczekiwanego rezultatu. Wydzielenie partycji
lub woluminów ma wiele zalet:
</p>

<ul>
<li>
Masz możliwość dostosowania jak najwydajniejszego w danym zastosowaniu systemu
plików dla poszczególnych partycji lub woluminów.
</li>
<li>
W przypadku zapełnienia partycji przez nieprawidłowo działające narzędzie nie
padnie Ci cały system.
</li>
<li>
Jeśli to konieczne, można skrócić czas kontroli systemów plików, dzięki
możliwości jednoczesnego dokonywania jej na kilku partycjach (ma to znaczenie
zwłaszcza na sprzęcie z wieloma dyskami).
</li>
<li>
Montując część partycji lub woluminów z opcjami read-only (tylko do odczytu),
nosuid (ignorowane są bity setuid), noexec (ignorowane są bity wykonywalności)
itd. można znacznie poprawić bezpieczeństwo.
</li>
</ul>

<p>
Niestety zbyt rozbudowany podział niesie z sobą spore niebezpieczeństwo: źle
zaplanowany zaowocuje pustkami na zbyt dużych i ciasnotą na zbyt małych
partycjach. Ponadto dla dysków opartych na interfejsach SCSI jest limit
maksymalnie 15 partycji.
</p>

</body>
</subsection>
</section>
<section id="mac-fdisk">
<title>Domyślnie: Partycjonowanie dysku za pomocą mac-fdisk</title>
<body>

<p>
Aby utworzyć partycje skorzystamy z programu <c>mac-fdisk</c>:
</p>

<pre caption="Uruchamianie mac-fdisk">
# <i>mac-fdisk /dev/hda</i>
</pre>

<p>
Zacznij od pozbycia się starych partycji, aby zrobić miejsce na nowy system.
Skorzystaj w tym celu z polecenia <c>d</c>.  Zapyta ono o numer kasowanych
partycji. Zwykle pierwsza partycja na komputerach Apple (Apple_partition_map)
nie może zostać skasowana.
</p>

<p>
Następnie na komputerze NewWorld Mac załóż partycję <e>Apple_bootstrap</e> za
pomocą <c>b</c>. Zostaniesz zapytany o początkowy blok. Jeśli poprzednio
wybrałeś na ten cel trzecią partycję, wpisz <c>3p</c>.
</p>

<note>
To <e>nie</e> jest partycja "boot". Nie jest nawet używana
przez Linuksa; nie potrzebujesz na niej miejsca do założenia
systemu plików, nie powinieneś jej nawet montować. Użytkownicy
Apple nie potrzebują osobnej partycji rozruchowej.
</note>

<p>
Teraz stwórz partycję wymiany za pomocą <c>c</c>. <c>mac-fdisk</c> ponownie
zapyta o blok początkowy. Jako, że wcześniej skorzystaliśmy z <c>3</c>,
teraz wpisz <c>4p</c>. Gdy zostaniesz zapytany o rozmiar wpisz <c>512M</c>
(lub inny na jaki się zdecydowałeś - 512MB to zalecane minimum). Następnie
na pytanie o nazwę wpisz <c>swap</c> (koniecznie).
</p>

<p>
Żeby założyć partycję root, wpisz <c>c</c>, następnie <c>5p</c>, aby wybrać
blok od którego ma się zaczynać. Na pytanie o rozmiar ponownie wpisz <c>5p</c>,
<c>mac-fdisk</c> przydzieli jej całą pozostałą wolną przestrzeń
Koniecznie podaj nazwę <c>root</c>.
</p>

<p>
Na zakończenie zachowaj zmiany i opuść <c>mac-fdisk</c> poleceniami <c>w</c>
oraz <c>q</c>.
</p>

<note>
Aby się upewnić, że wszystko jest ok powinieneś uruchomić mac-fdisk jeszcze raz
i sprawdzić czy są tam wszystkie nowo utworzone partycje. Jeśli nie widzisz
żadnych partycji, lub też nie ma zmian, które przed chwilą wprowadziłeś
powinieneś ponownie wprowadzić zmiany, przy pomocy klawisza "i". Zauważ, że
polecenia to usuwa wszystkie obecne partycje i zastępuje je tymi odtworzonymi.
</note>

<p>
Kiedy skończysz przejdź do paragrafu <uri link="#filesystems">Zakładanie
systemów plików</uri>.
</p>

</body>
</section>
<section id="parted">
<title>Alternatywnie: Partycjonowanie dysku przy pomocy parted (zwłaszcza Pegasos)</title>
<body>

<p>
<c>parted</c>, czyli Partition Editor, jest w stanie obsłużyć partycje HFS+
używane przez Mac OS i Mac OS X. Dzięki niemu możesz zmienić rozmiar
obecnych partycji, aby zrobić miejsce na partycje dla Linuksa. W przykładzie
poniżej opiszemy jednak partycjonowanie dysku jedynie dla maszyn Pegasos.
</p>

<p>
Zacznijmy od uruchomienia programu <c>parted</c>:
</p>

<pre caption="Uruchamianie parted">
# <i>parted /dev/hda</i>
</pre>

<p>
Jeśli dysk nie jest jeszcze podzielony na partycje uruchom <c>mklabel amiga</c>, aby utworzyć nową etykietę dla napędu.
</p>

<p>
Zawsze możesz wpisać polecenie <c>print</c>, aby wyświetlić aktualną tabelę.
Zmiany jakie wprowadzisz nie zostaną zapisane do czasu wyjścia z aplikacji.
Przez cały czas możesz anulować omyłkowo wprowadzone zmiany przy pomocy
kombinacji klawiszy <c>Ctrl-C</c>, która przerwie działanie programu.
</p>

<p>
Jeśli zamierzasz na swojej maszynie zainstalować również MorphOS musisz
utworzyć system plików affs1, o nazwie "BI0" (BI zero) na początku napędu. Do
zainstalowania kernela MorphOS'a wystarczy 32MB miejsca. Jeśli masz Pegasos I
lub chcesz używać reiserfs, bądź xfs będziesz musiał ponadto trzymać na tej
partycji kernel Linuksa (Pegasos II może zostać zabootowany z partycji
ext2/ext3 lub affs1). Aby utworzyć partycję wpisz polecenie <c>mkpart primary
affs1 START END</c>, gdzie <c>START</c> i <c>END</c> to obszar w MB (np. <c>0
32</c> tworzy partycję o rozmiarze 32MB. zaczynającą się na 0 i kończącą na
32MB).
</p>

<p>
Musisz utworzyć dwie partycje dla Linuksa, jedną root, która będzie zawierała
programy itp. i drugą, która będzie partycją wymiany (swap). Przed utworzeniem
partycji root musisz wybrać system plików jakiego będziesz używał. Masz do
wyboru ext2, ext3, reiserfs i xfs. Jeśli nie jesteś pewien co wybrać polecamy
użycie ext3. Wpisz polecenie <c>mkpart primary ext3 START END</c> aby utworzyć
partycję ext3. Również tutaj zamień <c>START</c> i <c>END</c> obszarem w MB, na
którym chcesz utworzyć partycję.
</p>

<p>
Partycja swap powinna w większości przypadków mieć rozmiar równy ilości pamięci
RAM w komputerze pomnożonej przez dwa. Jeśli nie będziesz uruchamiał
jednocześnie ogromnej ilości programów powinna Ci wystarczyć ilość swap równa
ilości RAM (jednak nie mniejsza niż zalecane 512MB). Aby stworzyć partycję
wymiany wpisz polecenie <c>mkpart primary linux-swap START END</c>.
</p>

<p>
Wpisz polecenie <c>print</c>, dostaniesz listę numerów partycji, zapisz je
sobie, ponieważ będziech ich potrzebował w dalszej instalacji.
</p>

<p>
Kiedy skończysz pracę w parted wyłącz go wpisując po prostu <c>quit</c>.
</p>

</body>
</section>
<section id="filesystems">
<title>Tworzenie systemów plików</title>
<subsection>
<title>Wprowadzenie</title>
<body>

<p>
Po stworzeniu partycji nadszedł czas na założenie na nich systemów plików.
Jeśli nie obchodzi Cię jakie wybierzesz i jesteś zadowolony z domyślnych
ustawień w podręczniku, przejdź do <uri link="#fsza partycja została zaznaczona
ilesystems-apply">Zakładania na
Partycji Systemu Plików</uri>. W przeciwnym wypadku czytaj dalej aby dowiedzieć
się co nieco na ich temat.
</p>

</body>
</subsection>
<subsection>
<title>Systemy plików?</title>
<body>

<p>
Masz do dyspozycji następujące systemy plików: ext2, ext3 i XFS.
Wszystkie działają stabilnie na architekturze PPC. 
</p>

<p>
<b>ext2</b> to sprawdzony i popularny linuksowy system plików, którego główną
wadą jest to, że nie posiada księgowania. Powoduje to, iż jego regularne
kontrole przy starcie systemu bywają długotrwałe. Obecnie istnieją nowoczesne
systemy plików z księgowaniem, które można szybko sprawdzić i to właśnie te
polecamy naszym użytkownikom. Księgowanie zapobiega długotrwałym kontrolom
podczas uruchamiania systemu oraz ewentualnym błędom spójności danych.
</p>

<p>
<b>ext3</b> to odpowiednik ext2 posiadający księgowanie w trybach
full oraz ordered, dzięki czemu w razie awarii dane odzyskiwane są
błyskawicznie. Jest on bardzo dobrym i niezawodnym rozwiązaniem.
Posiada ukrytą opcję korzystania z drzewa b, co znacznie poprawia
wydajność niemal we wszystkich sytuacjach. W celu włączenia księgowania należy
dodać parametr <c>-O dir_index</c> do linii poleceń programu
<c>mke2fs</c>.Krótko mówiąc ext3 jest świetny.
</p>

<p>
<b>ReiserFS</b> to system plików oparty na drzewie B*, oferujący
dużą wydajność. Przy wielu małych plikach (poniżej 4k) może
być szybszy od ext3 nawet piętnastokrotnie. ReiserFS jest
wysoce skalowalny i posiada księgowanie, a począwszy od jądra 2.4.18,
charakteryzuje go niezawodność i użyteczność zarówno na partycjach ogólnego
przeznaczenia jak i w ekstremalnych przypadkach, takich jak ogromne
partycje, operacje na wielu bardzo małych, lub bardzo dużych plikach czy też
operacje na katalogach zawierających dziesiątki tysięcy plików. 
</p>

<p>
<b>XFS</b> to system plików z księgowaniem, w pełni wspierany
w Gentoo Linux przez jądro xfs-sources. Jest bardzo funkcjonalny i zoptymalizowany
do skalowalności. Zalecamy go wyłącznie do systemów z nowoczesnymi dyskami SCSI
i/lub ciągłego zapisu danych z nieprzerwanym dostępem zasilania. Ponieważ
XFS przechowuje dużo danych w pamięci RAM, źle zaprojektowane programy
(te nie zachowujące odpowiednich środków ostrożności podczas zapisywania plików
na dysk, których niestety jest sporo) mogą doprowadzić w razie awarii
systemu do utraty danych.
</p>

</body>
</subsection>
<subsection id="filesystems-apply">
<title>Zakładanie systemów plików na partycjach</title>
<body>

<p>
Aby założyć na woluminie lub partycji system plików powinieneś skorzystać z
odpowiednich narzędzi:
</p>

<table>
<tr>
<th>System plików</th>
<th>Program do zakładania</th>
</tr>
<tr>
<ti>ext2</ti>
<ti><c>mkfs.ext2</c></ti>
</tr>
<tr>
<ti>ext3</ti>
<ti><c>mkfs.ext3</c></ti>
</tr>
<tr>
<ti>reiserfs</ti>
<ti><c>mkfs.reiserfs</c></ti>
</tr>
<tr>
<ti>xfs</ti>
<ti><c>mkfs.xfs</c></ti>
</tr>
<tr>
<ti>jfs</ti>
<ti><c>mkfs.jfs</c></ti>
</tr>
</table>

<p>
Na przykład, aby założyć ext3 na partycji boot (w naszym przypadku
<path>/dev/hda4</path>), powinieneś wykonać następujące polecenia:
</p>

<pre caption="Zakładanie systemu plików na partycji">
# <i>mkfs.ext3 /dev/hda4</i>
</pre>

<note>
Na maszynach Pegasos II kernel musi znajdować się na systemach plików ext2 lub
ext3. Maszyny NewWorld można uruchomić z  ext2, ext3, ReiserFS, a nawet z
HFS/HFS+.
</note>

</body>
</subsection>
<subsection>
<title>Aktywacja partycji wymiany</title>
<body>

<p>
Aby utworzyć partycję wymiany skorzystaj z programu <c>mkswap</c>.
</p>

<pre caption="Tworzenie partycji wymiany">
# <i>mkswap /dev/hda2</i>
</pre>

<p>
Aby ją aktywować skorzystaj z polecenia <c>swapon</c>:
</p>

<pre caption="Aktywacja partycji wymiany">
# <i>swapon /dev/hda2</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Montowanie</title>
<body>

<p>
Po założeniu partycji i utworzeniu systemów plików nadszedł czas na ich
zamontowanie. Służy do tego program <c>mount</c>. Nie zapomnij utworzyć
odpowiednich katalogów dla każdego z nich. Pokażemy to na przykładzie
partycji boot oraz root:
</p>

<warn>
W związku z błędem w pakiecie e2fsprogs trzeba używać polecenia <c>mount -t
ext3</c> przy każdym montowaniu partycji ext3.
</warn>

<pre caption="Montowanie partycji">
# <i>mount /dev/hda3 /mnt/gentoo</i>
# <i>mkdir /mnt/gentoo/boot</i>
# <i>mount /dev/hda1 /mnt/gentoo/boot</i>
<comment>(Dla partycji ext3:)</comment>
# <i>mount -t ext3 /dev/hda4 /mnt/gentoo</i>
</pre>

<note>
Jeżeli chcesz przenieść <path>/tmp</path> na oddzielną partycję,
nie zapomnij po zamontowaniu odpowiednio poprawić praw dostępu: <c>chmod
1777 /mnt/gentoo/tmp</c>. Dotyczy to również <path>/var/tmp</path>.
</note>

<p>
Będziemy musieli zamontować system plików proc (wirtualny interfejs jądra)
w <path>/proc</path>. Najpierw jednak nagramy trochę plików na nasze partycje.
</p>

<p>
Kiedy skończysz przejdź do rozdziału <uri
link="?part=1&amp;chap=5">Wypakowywanie plików instalacyjnych</uri>.
</p>

</body>
</section>
</sections>
