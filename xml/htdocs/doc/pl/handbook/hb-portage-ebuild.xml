<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/handbook/Attic/hb-portage-ebuild.xml,v 1.16 2007/09/28 10:27:59 rane Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<sections>

<version>1.3</version>
<date>2004-10-24</date>

<section>
<title>Różnice między programami emerge i ebuild</title>
<body>

<p>
Aplikacja <c>ebuild</c> jest niskopoziomowym interfejsem systemu Portage. Przy
pomocy tej aplikacji można wykonywać konkretne czynności opisane w danych
plikach ebuild. Na przykład można samodzielnie wykonać poszczególne etapy
instalowania któregoś z pakietów.
</p>

<p>
Aplikacji <c>ebuild</c> zwykle używają deweloperzy. Więcej informacji o niej
można znaleźć w <uri link="/proj/pl/devrel/handbook/handbook.xml">Podręczniku
deweloperów</uri>. Mimo wszystko postaramy się wyjaśnić te funkcje aplikacji
<c>ebuild</c>, które są wykorzystywane w trakcie procesu instalowania pakietów
oraz umożliwiają przeprowadzenie działań konfiguracyjnych.
</p>

</body>
</section>
<section>
<title>Ręczna intalacja oprogramowania</title>
<subsection>
<title>Pobieranie źródeł i sprawdzanie sum kontrolnych</title>
<body>

<p>
Za każdym razem gdy uruchamiamy aplikację <c>ebuild</c> na pliku ebuild,
wszystkie związane z nim sumy kontrolne są porównywane z sumami zapisanymi w
plikach <path>Manifest</path> lub
<path>files/digest-&lt;nazwa&gt;-&lt;wersja&gt;</path>. Operacja ta jest
przeprowadzana tuż po ukończeniu pobierania źródeł programu.
</p>

<p>
Składnia <c>ebuild</c>, aby pobrać źródła pakietu:
</p>

<pre caption="Pobieranie źródeł">
# <i>ebuild ścieżka/do/pliku/z/ebuildem fetch</i>
</pre>

<p>
Jeśli suma kontrolna pliku ebuild nie zgadza się z sumą kontrolną zapisaną w
pliku <path>Manifest</path> lub gdy suma kontrolna jednego z pobranych plików
jest niezgodna z wartością zapisaną w pliku
<path>files/digest-&lt;pakiet&gt;</path>, wyświetli się następujący błąd:
</p>

<pre caption="Błąd sumy kontrolnej">
!!! File is corrupt or incomplete. (Digests do not match)
>>> our recorded digest: db20421ce35e8e54346e3ef19e60e4ee
>>>  your file's digest: f10392b7c0b2bbc463ad09642606a7d6
</pre>

<p>
W kolejnym wierszu zostanie podana nazwa pliku, który spowodował błąd.
</p>

<p>
Jeśli jesteśmy pewni, że pobrane źródła oraz plik ebuild są poprawne, możemy od
nowa wygenerować pliki <path>Manifest</path> i
<path>digest-&lt;pakiet&gt;</path> przy pomocy funkcji digest aplikacji
<c>ebuild</c>:
</p>

<pre caption="Regenerowanie Manifestu i pliku digest">
# <i>ebuild /ścieżka/do/pliku/z/ebuildem digest</i>
</pre>

</body>
</subsection>
<subsection>
<title>Rozpakowywanie źródeł</title>
<body>

<p>
Aby rozpakować źródła do <path>/var/tmp/portage</path> (lub dowolnego innego
katalogu wyznaczonego do tych celów określonego w <path>/etc/make.conf</path>),
używa się funkcji unpack aplikacji <c>ebuild</c>:
</p>

<pre caption="Rozpakowywanie źródeł">
# <i>ebuild ścieżka/do/pliku/z/ebuildem unpack</i>
</pre>

<p>
Powyższe polecenie wykona funkcję src_unpack() zapisaną w ebuildzie (która
sprowadza się do zwykłego rozpakowania plików, gdy funkcja ta nie jest
dokładniej zdefiniowana). W tym kroku są również aplikowane wszystkie niezbędne
poprawki.
</p>

</body>
</subsection>
<subsection>
<title>Kompilowanie źródeł</title>
<body>

<p>
Następnym krokiem w procesie instalowania pakietów jest kompilacja źródeł.
Zajmuje się tym kolejna funkcja aplikacji <c>ebuild</c> - compile, która po
kolei wykonuje instrukcje zapisane w sekcji src_compile() pliku ebuild. Proces
ten obejmuje również wszystkie działania związane z konfiguracją pakietu.
</p>

<pre caption="Kompilowanie źródeł">
# <i>ebuild ścieżka/do/pliku/z/ebuildem compile</i>
</pre>

<p>
Aby zmienić opcje kompilacji, należy odpowiednio zmienić sekcję src_compile()
pliku ebuild. Ponadto można nabrać Portage, aby wierzyło, że aplikacja
<c>ebuild</c> ukończyła wszystkie etapy kompilacji. W tym celu należy
samodzielnie wykonać wszystkie etapy kompilacji, a następnie utworzyć w katalogu
roboczym pusty plik <path>.compiled</path>:
</p>

<pre caption="Informowanie Portage o ukończonych zadaniach kompilacji">
# <i>touch .compiled</i>
</pre>

</body>
</subsection>
<subsection>
<title>Instalowanie plików do katalogu tymczasowego</title>
<body>

<p>
Kolejnym krokiem wykonywanym przez Portage jest instalacja wszystkich
potrzebnych plików do katalogu tymczasowego. Katalog ten będzie zawierał
wszystkie pliki, które muszą zostać zainstalowane do systemu. Dokonamy tego
używając kolejnej z funkcji aplikacji <c>ebuild</c> - install, która wykonuje
komendy zawarte w sekcji src_install() pliku ebuild.
</p>

<pre caption="Instalowanie plików">
# <i>ebuild ścieżka/do/pliku/z/ebuildem install</i>
</pre>

</body>
</subsection>
<subsection>
<title>Dodawanie plików do bieżącego systemu</title>
<body>

<p>
Ostatnią czynnością wykonywaną w procesie instalacji jest wgrywanie plików do
systemu i rejestrowanie ich w Portage. W języku aplikacji <c>ebuild</c> krok ten
nazywa się "qmerge" i składa się z następujących etapów:
</p>

<ul>
  <li>Uruchomienie funkcji pkg_preinst() jeśli jest zdefiniowana</li>
  <li>Skopiowanie wszystkich plików do systemu</li>
  <li>Zarejestrowanie plików w Portage backend</li>
  <li>Uruchomienie funkcji pkg_postinst() jeśli jest zdefiniowana</li>
</ul>

<p>
Wszystkie te czynności zostaną wykonane po wywołaniu funkcji qmerge aplikacji
<c>ebuild</c>.
</p>

<pre caption="Wgrywanie plików do systemu">
# <i>ebuild ścieżka/do/pliku/z/ebuildem qmerge</i>
</pre>

</body>
</subsection>
<subsection>
<title>Czyszczenie katalogu tymczasowego</title>
<body>

<p>
Na koniec można jeszcze wyczyścić tymczasowy katalog, za co odpowiedzialna jest
funkcja clean aplikacji <c>ebuild</c>.
</p>

<pre caption="Czyszczenie katalogu tymczasowego">
# <i>ebuild ścieżka/do/pliku/z/ebuildem clean</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Inne funkcje aplikacji ebuild</title>
<subsection>
<title>Uruchamianie wszystkich poleceń związanych z instalowaniem</title>
<body>

<p>
Przy pomocy funkcji merge aplikacji <c>ebuild</c> można wykonać naraz wszystkie
prezentowane wcześniej polecenia: fetch, unpack, compile, install i qmerge:
</p>

<pre caption="Instalacja oprogramowania">
# <i>ebuild ścieżka/do/pliku/z/ebuildem merge</i>
</pre>

</body>
</subsection>
<subsection>
<title>Konfigurowanie</title>
<body>

<p>
Niektóre aplikacje zawierają instrukcje, które pomagają skonfigurować dany
pakiet na potrzeby konkretnego systemu. Te instrukcje zwykle są interaktywne i
nie mogą zostać wykonane automatycznie. Aby wykonać te wymienione w sekcji
config() każdego ebuildu czynności konfiguracyjne, należy użyć funkcji config
aplikacji ebuild.
</p>

<pre caption="Konfigurowanie pakietu">
# <i>ebuild ścieżka/do/pliku/z/ebuildem config</i>
</pre>

</body>
</subsection>
<subsection>
<title>Budowanie pakietów RPM</title>
<body>

<p>
Możliwe jest nakazanie Portage budowy binarnego pakietu lub nawet pakietu RPM.
Potrzebna do tego jest jedna z funkcji aplikacji <c>ebuild</c>: funkcja package
lub funkcja rpm. Istnieje między nimi kilka różnic:
</p>

<ul>
  <li>
    Funkcja package bardzo przypomina funkcję merge, gdyż wykonuje wszystkie
    niezbędne kroki (fetch, unpack, compile, install) przed utworzeniem paczki.
  </li>
  <li>
    Funkcja rpm tworzy pakiet RPM z plików utworzonych <e>po</e> wykonaniu
    funkcji install aplikacji <c>ebuild</c>.
  </li>
</ul>

<pre caption="Tworzenie paczek">
<comment>(format kompatybilny z Portage)</comment>
# <i>ebuild ścieżka/do/pliku/z/ebuildem package</i>

<comment>(dla pakietów RPM)</comment>
# <i>ebuild ścieżka/do/pliku/z/ebuildem rpm</i>
</pre>

<p>
Utworzony w ten sposób pakiet RPM nie zawiera informacji na temat zależności.
</p>

</body>
</subsection>
</section>
<section>
<title>Więcej informacji</title>
<subsection>
<body>

<p>
Aby uzyskać więcej informacji na temat Portage, aplikacji oraz plików ebuild
warto zapoznać się z następującymi stronami man:
</p>

<pre caption="Manuale">
$ <i>man portage</i>    <comment>(Portage)</comment>
$ <i>man emerge</i>     <comment>(Polecenie emerge)</comment>
$ <i>man ebuild</i>     <comment>(Polecenie ebuild)</comment>
$ <i>man 5 ebuild</i>   <comment>(Składnia pliku ebuild)</comment>
</pre>

<p>
Inne informacje związane z pracą dewelopera można znaleźć w <uri
link="/proj/pl/devrel/handbook/handbook.xml">Podręczniku dewelopera</uri>
</p>

</body>
</subsection>
</section>
</sections>
