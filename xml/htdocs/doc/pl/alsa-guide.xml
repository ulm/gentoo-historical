<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/alsa-guide.xml,v 1.9 2005/09/10 09:50:57 rane Exp $ -->

<guide link="/doc/pl/alsa-guide.xml" lang="pl">
<title>Konfiguracja sterowników ALSA w Gentoo</title>

<author title="Autor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Tłumaczenie">
  <mail link="rane@gentoo.org">Łukasz Damentko</mail>
</author>

<abstract>
Dokument opisuje proces konfiguracji sterowników dźwięku ALSA w Gentoo.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.9</version>
<date>2005-09-09</date>

<chapter>
<title>Wprowadzenie</title>
<section>
<title>Czym jest ALSA?</title>
<body>

<p>
ALSA (<e>Advanced Linux Sound Architecture</e>) to system zapewniający obsługę
audio i MIDI (<e>Musical Instrument Digital Interface</e>) w systemach opartych
na jądrze Linux. Począwszy od jąder serii 2.6, ALSA stała się domyślnym
systemem dźwiękowym, wypierając nieco już przestarzały OSS (<e>Open Sound
System</e>), używany w jądrach 2.4.
</p>

<p>

Główne zalety systemu ALSA to wydajna obsługa wszystkich typów kart dźwiękowych,
poczynając od najtańszego sprzętu, a kończąc na w pełni profesjonalnych
rozwiązaniach, modularna budowa sterowników, bezpieczeństwo wątków i współpraca
z SMP oraz pełna wsteczna kompatybilność z OSS, a także biblioteki
<c>alsa-lib</c> znacznie ułatwiające tworzenie nowego oprogramowania.
</p>

</body>
</section>
<section>
<title>ALSA w Gentoo</title>
<body>

<p>
Jedną z głównych zalet Gentoo jest możliwość pełnej kontroli nad procesem
instalacji i konfiguracji systemu. Zasada ta dotyczy także systemu ALSA. Poniżej
zostały omówione dwie metody instalacji tego systemu obsługi dźwięku.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Instalowanie ALSA</title>
<section>
<title>Opcje</title>
<body>

<warn>
Dwie metody opisane poniżej wzajemnie się wykluczają. Nie można posiadać
jednocześnie obsługi ALSA wkompilowanej w jądro i zainstalowanej poprzez ebuild
<c>media-sound/alsa-driver</c>. <e>To się nie uda</e>.
</warn>

<p>
Możliwości są następujące:
</p>

<ol>
  <li>
    Sterowniki ALSA wbudowane w jądro - rozwiązanie zalecane
  </li>
  <li>
    Pakiet <c>media-sound/alsa-driver</c>
  </li>
</ol>

<p>
Warto pokrótce omówić oba rozwiązania.
</p>

<p>
Oto plusy i minusy sterowników ALSA wbudowanych w jądro:
</p>

<table>
<tr>
  <th>ALSA z kernela</th>
  <th>Plusy i minusy</th>
</tr>
<tr>
  <th>+</th>
  <ti>Sterowniki wbudowane w jądro są stabilniejsze</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Proste rozwiązanie, jednorazowa instalacja</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Mogą być nieco starsze niż sterowniki z pakietu <c>alsa-driver</c></ti>
</tr>
</table>

<p>
Plusy i minusy pakietu <c>alsa-driver</c>:
</p>

<table>
<tr>
  <th>alsa-driver</th>
  <th>Plusy i minusy</th>
</tr>
<tr>
  <th>+</th>
  <ti>Najświeższe sterowniki ALSA na rynku</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Każda kolejna zmiana jądra wymaga ponownej instalacji
    pakietu <c>alsa-driver</c>.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Aby pakiet działał prawidłowo określone opcje w jądrze muszą zostać
    wyłączone.</ti>
</tr>
</table>

</body>
</section>
<section>
<title>Podsumowując...</title>
<body>

<p>
Główną różnicą pomiędzy pakietem <c>alsa-driver</c>, a sterownikami jądra jest
to, że ten pierwszy jest zwykle aktualniejszy. Różnice są jednak na tyle nieznaczne,
że raczej nie warto męczyć się ze sterownikami spoza jądra, poza tym instalacja
systemu ALSA już w jądrze Linuksa jest na pewno znacznie prostsza. Przed zgłoszeniem do <uri
link="https://bugs.gentoo.org">Bugzilli</uri> jakichkolwiek błędów
związanych ze sterownikami znajdującymi się w jądrze należy sprawdzić, czy błąd
występuje także w tych z pakietu <c>alsa-driver</c>. Jednak niezależnie od
rezultatu tego testu i tak prosimy o zgłaszanie błędów.
</p>

</body>
</section>
<section id="lspci">
<title>Zanim zaczniemy</title>
<body>

<p>
Obojętnie z której metody korzystamy, konieczna jest znajomość modelu karty
dźwiękowej, aby móc wybrać dla niej odpowiedni sterownik. W większości
przypadków karty dźwiękowe (nieważne czy zintegrowane na płycie głównej czy nie)
to urządzenia PCI, dzięki czemu można skorzystać z programu <c>lspci</c> do
poznawania wymaganych o nich informacji. Jeśli nie ma takiego polecenia w
systemie to należy wykonać <c>emerge sys-apps/pciutils</c>, aby stało się ono
dostępne. Jeśli posiadamy kartę USB to pomocne <e>może</e> być polecenie
<c>lsusb</c> z pakietu <c>sys-apps/usbutils</c>. Dla kart ISA warto użyć
pakietu <c>sys-apps/isapnptools</c>. Poniżej znajduje się lista stron, na
których <e>można</e> znaleźć informacje o kartach ISA:
</p>

<ul>
  <li>
  <uri link="http://www.roestock.demon.co.uk/isapnptools/">Oficjalna strona
   pakietu ISAPNPTOOLS</uri>
  </li>
  <li>
  <uri link="http://www2.linuxjournal.com/article/3269">Artykuł z LinuxJournal
  na temat PnP
  Article</uri>
  </li>
  <li>
  <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">Przewodnik po
  dźwięku pochodzący z projektu dokumentacji Linuksa</uri>
  </li>
</ul>

<note>
Dla uproszczenia tego tekstu zakładamy, że użytkownik posiada kartę PCI.
</note>

<p>
Pora zatem dowiedzieć się jaką właściwie kartę dźwiękową posiadamy.
</p>

<pre caption="Szczegóły dotyczące karty dźwiękowej">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
Teraz wiemy, że karta dźwiękowa w komputerze to Sound Blaster Live! i że jej
producentem jest firma Creative Labs. Udajemy się zatem na stronę <uri
link="http://www.alsa-project.org/alsa-doc/">ALSA Soundcard Matrix</uri> i
wybieramy Creative Labs z listy na dole. Zostaniemy przeniesieni na podstronę
poświęconą tej firmie, na której będziemy mogli odczytać, że tę kartę obsługuje
sterownik <c>emu10k1</c>. I to jest właśnie informacja, której tu szukaliśmy.
Jeśli chcemy poznać szczegóły możemy kliknąć na nazwę sterownika i poczytać o
nim na jego podstronie.
</p>

</body>
</section>
<section id="kernel">
<title>Używanie sterowników ALSA dostarczanych razem z kernelem</title>
<body>

<p>
Jest to najlepszy wybór dla osób lubiących prostotę i wygodne rozwiązania.
</p>

<note>
Od wydania 2005.0 Gentoo korzysta domyślnie z jądra serii 2.6. Na
<e>większości</e> architektur, o ile nie wybrano innego profilu, domyślnym
jądrem są <c>gentoo-sources</c>. Warto sprawdzić czy używane jądro to na pewno
2.6. Metoda, z której będziemy korzystać nie zadziała na 2.4.
</note>

<p>
Włączmy i skonfigurujmy sterowniki ALSA:
</p>

<impo>
Użytkownicy programu <c>genkernel</c> muszą wpisać polecenie <c>genkernel
--menuconfig all</c> oraz postępować zgodnie ze wskazówkami z części <uri
link="#doc_chap2_pre3">Sterowniki ALSA w jądrze</uri>.
</impo>

<pre caption="Przechodzenie do konfiguracji kernela">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
Dowiązanie <path>/usr/src/linux</path> musi prowadzić do źródeł kernela, którego
zamierzamy używać. Warto sprawdzić czy to prawda przez rozpoczęciem
jakichkolwiek operacji opisanych poniżej.
</note>

<p>
Dokonamy teraz przeglądu dostępnych w jądrach serii 2.6 opcji konfiguracyjnych,
zapewniających obsługę określonej karty dźwiękowej.
</p>

<note>
Warto zwrócić uwagę, że dla uproszczenia we wszystkich przykładach budujemy
sterowniki w postaci modułów. Radzimy postąpić podobnie oraz nie zapominać o
czynnościach opisanych w akapicie <uri link="#alsa-config">Konfiguracja</uri>
tego tekstu. Dla sterowników wbudowanych na stałe w jądro trzeba dokonać
odpowiedniej korekty w pewnych punktach konfiguracji.
</note>

<pre caption="Sterowniki ALSA w jądrze">
Device Drivers  ---&gt;
   Sound  ---&gt;

<comment>(To trzeba włączyć)</comment>
&lt;M&gt; Sound card support

<comment>(Tej opcji nie włączamy!)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(Menu wyżej przechodzimy do opcji ALSA)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Włącza obsługę MIDI)</comment>
   &lt;M&gt; Sequencer support
<comment>(Obsługa /dev/mixer* u /dev/dsp* w starym stylu. Polecamy.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API

<comment>(Teraz należy wybrać urządzenia jakich obsługa jest konieczna. W
większości przypadków jest to tylko jedna karta. Jeśli jednak jest ich więcej
należy zaznaczyć sterowniki dla wszystkich jakie posiadamy)</comment>

<comment>(Nie jest to konieczne dla zwykłych użytkowników, a przeznaczone
głównie dla doświadczonych osób do różnego rodzaju testów)</comment>
Generic devices  ---&gt;

<comment>(Dla kart dźwiękowych na slocie ISA)</comment>
ISA devices   ---&gt;
<comment>(Dla posiadaczy karty Gravis)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Wracamy poziom wyżej i przechodzimy do urządzeń PCI. Większość kart
dźwiękowych obecnie to właśnie karty PCI)</comment>
PCI devices   ---&gt;
   <comment>(Wybieramy sterownik emu10k1 dla naszej karty)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(Dla karty Intela)</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(Dla karty VIA)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(Poziom wyżej znajduje się podobne menu do wyboru kart USB</comment>
USB Devices   ---&gt;
</pre>

<p>
Po skonfigurowaniu wszystkich opcji należy ponownie zbudować jądro i uruchomić z
niego system tak, aby obsługa ALSA stała się dostępna. Kolejny etap konfiguracji
to  <uri link="#alsa-utilities">Narzędzia do pracy z systemem ALSA</uri>.
</p>

</body>
</section>
<section id="alsa-driver">
<title>Użycie pakietu ze sterownikami ALSA</title>
<body>

<p>
Przed zainstalowaniem pakietu ze sterownikami (<c>alsa-driver</c>) należy
wykonać kilka drobnych czynności. Nie są one wprawdzie wymagane, ale znacznie
skrócą czas budowy pakietu poprzez wybranie do kompilacji tylko potrzebnego
sterownika, a nie wszystkich, jak to jest domyślnie.
</p>

<p>
Często nie wiadomo jaki sterownik będzie potrzebny. Wtedy należy po pierwsze
zapoznać się z akapitem tego tekstu dotyczącym <uri link="#lspci">lspci</uri>,
a następnie znając już nazwę odpowiedniego sterownika (np. <c>emu10k1</c>),
wyeksportować ją w postaci zmiennej <c>ALSA_CARDS</c> w pliku
<path>/etc/make.conf</path>.
</p>

<pre caption="Dodawanie zmiennej ALSA_CARDS do pliku make.conf">
<comment>(Dla jednej karty)</comment>
ALSA_CARDS="emu10k1"
<comment>(Dla wielu kart - poszczególne nazwy oddzielamy spacjami)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Przed rozpoczęciem instalacji pakietu <c>alsa-driver</c> należy się upewnić, że
w konfiguracji jądra uwzględniono poniższe opcje, w przeciwnym wypadku
instalacja się nie powiedzie. W przykładach poniżej pokażemy jeden ze sposobów
sprawdzenia czy wszystko jest ustawione prawidłowo.
</p>

<ol>
  <li>
    <c>CONFIG_SOUND</c> musi być włączony (opcja Basic Sound support)
  </li>
  <li>
    <c>CONFIG_SOUND_PRIME</c> jest wyłączony (opcja In-built OSS support)
  </li>
  <li>
    <c>CONFIG_SND</c> jest wyłączony (wyłączona wbudowana obsługa ALSA)
  </li>
  <li>
    <path>/usr/src/linux</path> wskazuje na dobry katalog ze źródłami
  </li>
</ol>

<pre caption=".config checks">
<comment>(Zakładając, że dowiązanie o nazwie linux wskazuje na dobry katalog)
</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(1 to prawda)</comment>
CONFIG_SOUND=y
<comment>(2 to prawda)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(i 3 to prawda)</comment>
CONFIG_SND is not set
</pre>

<p>
Na koniec wystarczy wpisać magiczne słowa:
</p>

<pre caption="Instalowanie pakietu alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Po każdym ponownym skompilowaniu jądra (co wiąże się ze skasowaniem wszystkich
dodatkowych sterowników) należy ponownie wykonać polecenie <c>emerge
alsa-driver</c>.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Konfigurowanie i testowanie ALSA</title>
<section id="alsa-utilities">
<title>Narzędzia do pracy z systemem ALSA</title>
<body>

<p>
<c>alsa-utils</c> to pakiet zawierający wiele bardzo użytecznych programów oraz
skrypty startowe dla ALSA. Jest on integralną częścią tego systemu i dlatego
bardzo mocno zachęcamy do jego zainstalowania.
</p>

<pre caption="Instalowanie alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Po odpowiednim skonfigurowaniu <uri link="#kernel">jądra</uri> <e>i</e>
dokompilowaniu dla ALSA odpowiednich modułów pozostaje jeszcze skonfigurować
odpowiednie <uri link="#initscript">skrypty startowe</uri>. Później zajmiemy się
dostosowywaniem systemu do naszych potrzeb za pomocą programu <c>alsaconf</c> z
pakietu <c>alsa-utils</c>.
</note>

</body>
</section>
<section id="alsa-config">
<title>Konfiguracja</title>
<body>

<note>
Przed uruchomieniem <c>alsaconf</c> należy zamknąć wszystkie programy,
które <e>mogą</e> korzystać z karty dźwiękowej w trakcie jej konfiguracji.
</note>

<p>
Najprostszym programem służącym do konfiguracji karty jest <c>alsaconf</c>.
Wpisujemy zatem to polecenie z konta roota.
</p>

<pre caption="Uruchamianie alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Pojawi się menu, które automatycznie sprawdzi wszystkie urządzenia w komputerze,
spróbuje uzyskać informację o karcie dźwiękowej i poprosi o wybranie modelu z
listy. Potem zapyta o pozwolenie na automatyczną zmianę pliku
<path>/etc/modules.d/alsa</path>, a później przystąpi do dostosowywania poziomów
głośności w celu wybrania optymalnych do danej sytuacji. Na koniec uruchomi
polecenie <c>modules-update</c> i wystartuje skrypt
<path>/etc/init.d/alsasound</path>. Kiedy <c>alsaconf</c> zakończy pracę będzie
można przystąpić do konfiguracji skryptu startowego.
</p>

</body>
</section>
<section id="initscript">
<title>Skrypt startowy ALSA</title>
<body>

<p>
To już niemal wszystko. Obojętnie którą metodę instalowania sterowników
wybrano, będzie potrzebne coś co je załaduje oraz odtworzy poziom głośności
przy każdym uruchomieniu komputera. Zajmuje się tym skrypt startowy o nazwie
<c>alsasound</c>. Należy go dodać do poziomu uruchomieniowego o nazwie "boot".
</p>

<pre caption="Dodawanie ALSA do poziomu boot">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Następnie należy sprawdzić plik <path>/etc/conf.d/alsasound</path> i upewnić
się, że zmienna SAVE_ON_STOP ma wartość "yes". Dzięki temu ustawienia głośności
będą zapisywane przed wyłączeniem komputera.
</p>

</body>
</section>
<section>
<title>Grupa audio</title>
<body>

<p>
Przed przystąpieniem do testowania nowych ustawień należy ustawić jeszcze jedną,
<e>ważną</e> rzecz. Jedną z głównych reguł w systemach UNIX-owych jest to, aby
nigdy nie uruchamiać programu z prawami roota jeśli nie jest to absolutnie
konieczne. Tę regułę można zastosować również w naszym przypadku. Czemu? Przez
większość czasu spędzanego przy komputerze jesteśmy zalogowani na konto
zwykłego użytkownika, a jeśli chcemy posłuchać muzyki, należy mieć
dostęp do odpowiednich urządzeń. Aby taki dostęp uzyskać, użytkownik
musi być członkiem grupy "audio". Za chwilę dodamy użytkownika do tej grupy,
dzięki czemu nie będzie miał problemów z korzystaniem z urządzeń dźwiękowych. Do
zmiany przynależności użytkownika do grup używamy programu <c>gpasswd</c>.
Do dokonania zmiany potrzebne są przywileje roota.
</p>

<pre caption="Dodawanie użytkownika do grupy audio">
<comment>(Należy zastąpić słowo &lt;username&gt; odpowiednią nazwą użytkownika)</comment>
# <i>gpasswd -a &lt;username&gt; audio </i>
Adding user &lt;username&gt; to group audio
</pre>

</body>
</section>
<section>
<title>Sprawdzanie głośności</title>
<body>

<p>
Teraz zakończyliśmy wszystkie przygotowania, możemy przystąpić do uruchomienia
ALSA. Użytkownicy <c>alsaconf</c> mogą pominąć ten krok, program uruchomił
dźwięk za nich.
</p>

<pre caption="Uruchamianie usług">
<comment>(ALSA w modułach)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Loading: snd-card-0 ...        [ ok ]
 * Loading: snd-pcm-oss ...       [ ok ]
 * Loading: snd-seq ...           [ ok ]
 * Loading: snd-emu10k1-synth ... [ ok ]
 * Loading: snd-seq-midi ...      [ ok ]
 * Restoring Mixer Levels ...     [ ok ]
<comment>(Wbudowane sterowniki)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Restoring Mixer Levels ...     [ ok ]
</pre>

<p>
Po zakończeniu etapu przygotowań możemy sprawdzić czy przypadkiem dźwięk nie
jest całkowicie wyciszony. Użyjemy do tego programu <c>alsamixer</c>.
</p>

<pre caption="Uruchamianie alsamixer">
<comment>(Otwiera konsolowy program, który pokazuje tylko wymagane ustawienia</comment>
# <i>alsamixer</i>
</pre>

<impo>
Jeśli podczas pracy z <c>alsamixer</c> wystąpią błędy, takie jak np. "alsamixer:
function snd_ctl_open failed for default: No such file or directory", oznacza to
najprawdopodobniej nieprawidłowo ustawione przez udev prawa dostępu do urządzeń.
W celu przeładowania wpisów w <path>/dev</path> i naprawienia tego problemu
należy wykonać polecenie <c>killall udevd; udevstart</c>.
</impo>

<p>
Oto jak mixer ALSA <e>może</e> wyglądać przy pierwszym uruchomieniu. Należy
zwrócić uwagę, że pod kanałami Master i PCM znajdują się literki MM. Oznacza to,
że są one wyciszone. To właśnie przez to nie słyszymy niczego ze swoich
głośników.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="Wyciszony ALSA mixer" caption="Główne okno Alsa Mixer, sytuacja przy wyciszonym dźwięku"/>

<p>
Musimy zatem włączyć dźwięk w obu kanałach i ustawić odpowiednio jego głośność.
</p>

<warn>
Aby usłyszeć jakikolwiek dźwięk należy włączyć oba kanały - PCM i Master
i ustawić odpowiednio głośność.
</warn>

<ul>
  <li>
    Do przemieszczanie się pomiędzy kanałami służą klawisze strzałek w
    prawo i w lewo
  </li>
  <li>
    Aby zmienić ustawienie wyciszenia należy wybrać jakiś kanał, na przykład
    Master i wcisnąć klawisz <e>m</e>
  </li>
  <li>
    Do pogłaśniania i przyciszania służą strzałki w górę i w dół
  </li>
</ul>

<note>
Należy uważać przy zmianie wartości Bass i Treble. 50 to w większości przypadków
odpowiednie rozwiązanie. Zbyt wysokie ustawienia mogą skutkować irytującymi
zniekształceniami dźwięku.
</note>

<p>
Po ustawieniu ALSA Mixer powinien wyglądać mniej więcej tak jak ten poniżej.
Warto zwrócić uwagę na wartość 00 w miejscu MM ze zdjęcia wyżej oraz na
dobrane odpowiednie ustawienia głośności.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="AlsaMixer po zmianach" caption="Alsa Mixer po dokonaniu zmian"/>

</body>
</section>
<section>
<title>Sprawdzanie dźwięku</title>
<body>

<p>
Jednym ze sposobów na sprawdzenie tego czy karta działa poprawnie jest
przekierowanie jakiegoś szumu do jej urządzenia. Nie jest to bardzo
profesjonalna metoda, ale na pewno potwierdza, czy karta została prawidłowo
skonfigurowana.
</p>

<pre caption="Słuchanie szumu">
# <i>cat /dev/urandom > /dev/dsp</i>
</pre>

<note>
<path>/dev/dsp</path> to automatycznie tworzone dowiązanie symboliczne do
<path>/dev/sound/dsp</path>. Wspominamy o tym na wypadek gdyby pojawił się błąd
o braku takiego urządzenia - "No such file or directory".
</note>

<p>
Z głośników powinien zacząć wydobywać się szum. Eksperyment można zakończyć za
pomocą kombinacji klawiszy <c>Ctrl+C</c>. Jeśli nic nie słychać warto zacząć od
nowa sprawdzając wszystkie ustawienia opisane w tym tekście, aby poznać przyczynę
błędu.
</p>

<p>
Jeśli wszystko poszło dobrze, można wreszcie posłuchać muzyki. Nada się do tego
zarówno jakiś mały i prosty program konsolowy, jak np.
<c>media-sound/madplay</c> lub coś znacznie popularniejszego i bardziej
skomplikowanego jak <c>mpg123</c> czy <c>xmms</c>. Fani formatu ogg mogą użyć
programu <c>ogg123</c> z pakietu <c>media-sound/vorbis-tools</c>. Można użyć do
tego dowolnego programu, jak zwykle wystarczy polecenie <c>emerge</c>.
</p>

<pre caption="Instalowanie programów">
<comment>(Instalowanie programu do odtwarzania plików .mp3 itp.)</comment>
# <i>emerge madplay mpg123 xmms</i>
<comment>(Instalowanie programu do odtwarzania plików .ogg)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
Później odtwarzamy swoją ulubioną piosenkę:
</p>

<pre caption="Playing Music">
# <i>madplay -v ~/mp3/Boys\ -\ Jesteś\ Szalona.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
Title: Jesteś Szalona
Artist: Boys
Album: 
Year: 
Genre: Disco Polo
00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 ~/mp3/Boys\ -\ Jesteś\ Szalona.mp3</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Boys - Jesteś Szalona.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Disco Polo
Transcoded: mp3;160
Title: Jesteś Szalona
Artist: Boys
Date: 
Album: 
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>

</body>
</section>
<section>
<title>ALSA i flagi USE</title>
<body>

<p>
Warto dodać flagę <c>alsa</c> do listy flag USE w pliku
<path>/etc/make.conf</path>, aby upewnić się, że wszystkie programy mogące
współpracować z ALSA będą zbudowane z jej obsługą. Niektóre architektury, jak
x86, czy amd64 mają tę flagę włączoną domyślnie.
</p>

</body>
</section>
<section>
<title>Problemy?</title>
<body>

<p>
Jeśli z jakichś powodów nie słychać dźwięku po pierwsze należy sprawdzić
ustawienia <uri link="#doc_chap3_pre6">alsamixer</uri>. Większość problemów z
dźwiękiem jest spowodowana jego wyciszeniem lub niedostatecznym pogłośnieniem.
Warto również sprawdzić pod kątem tych samych niepożądanych ustawień aplikację
zarządzającą poziomem głośności w używanym menedżerze okien.
</p>

<p>
System plików <path>/proc</path> również może okazać się tu przydatny, zwłaszcza
jego podkatalog - <path>/proc/asound</path>. Pokrótce omówimy zawarte tam
pozycje.
</p>

<pre caption="Informacje z /proc/asound">
<comment>(Jeśli w pliku /proc/asound/cards znajduje się właściwa nazwa karty to
ALSA sobie z nią doskonale radzi)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Poniższe polecenie wyświetli wersję używanych sterowników ALSA w
przypadku, gdyby np. potrzebna była informacja na temat tego o ile są starsze w
porównaniu z tymi z pakietu alsa-driver)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(Szczegóły emulacji OSS przez ALSA)</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
Kolejnym bardzo częstym problemem jest pojawiająca się informacja o nieznanym
symbolu w module - "Unknown symbol in module".
</p>

<pre caption="Nieznany symbol w module">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
Jeśli przyjrzymy się uważnie <c>dmesg</c>, zauważymy takie wpisy:
</p>

<pre caption="Wyjście dmesg">
<comment>(Only relevant portions are shown below)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) -> IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
Taki problem pojawia się po przejściu ze sterowników z pakietu
<c>alsa-driver</c> na te wbudowane w jądro, ponieważ mimo usunięcia
<c>alsa-driver</c>, moduły wciąż pozostają w systemie dzięki ochronie plików
konfiguracyjnych. Zatem mimo przejścia na moduły wbudowane w jądro polecenie
<c>modprobe</c> wciąż będzie ładowało mieszankę modułów z pakietu i z jądra.
</p>

<p>
Rozwiązanie jest proste, należy usunąć cały katalog z modułami tuż po
odinstalowaniu pakietu <c>alsa-driver</c>. Warto się upewnić, że wersja jądra z
poniższego wpisu jest prawidłowa.
</p>

<pre caption="Usuwanie modułów alsa-driver">
<comment>(Zastępujemy wpis KERNELVER wersją używanego jądra)</comment>
# <i>rm -rf /lib/modules/KERNELVER/alsa-driver</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Dodatkowe funkcje ALSA</title>
<section>
<title>Obsługa MIDI</title>
<body>

<p>
Jeśli karta dźwiękowa posiada syntezator MIDI i jeśli chcemy korzystać z
dźwięków zapisanych w formacie .mid, będziemy musieli wykorzystać zestaw programów o nazwie
<c>awesfx</c> kontrolujący sterowniki AWE32. Po pierwsze musimy go zainstalować.
Jeśli karta nie posiada sprzętowego syntezatora można użyć wirtualnego. Więcej
informacji o nim znajduje się w akapicie <uri link="#vsynth">wirtualne
syntezatory</uri>.
</p>

<pre caption="Instalowanie awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Potrzebne będzie też skopiowanie plików SoundFont (SF2) z płyty ze sterownikami
do karty dźwiękowej do katalogu <path>/usr/share/sounds/sf2/</path>.
Przykładowa nazwa pliku SoundFond dla karty Creative SBLive! to 8MBGMSFX.SF2.
</note>

<p>
Po przekopiowaniu plików SoundFont można odtwarzać pliki tak jak w poniższym
przykładzie. Warto dodać polecenie <c>asfxload</c> do skryptu
<path>/etc/conf.d/local.start</path> tak, aby pliki te były wczytywane przy
każdym uruchomieniu komputera.
</p>

<note>
Ścieżki do katalogów w <path>/mnt</path> <e>niemal na pewno</e> będą inne,
podajemy tu tylko przykład, wszystkie polecenia należy odpowiednio skorygować.
</note>

<pre caption="Przegrywanie plików soundfont">
<comment>(Najpierw kopiujemy plik)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(Jest też na płycie SoundBlastera)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(A następnie wczytujemy)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Od tej pory można odtwarzać midi za pomocą programów takich jak np.
<c>aplaymidi</c>. Polecenie <c>aplaymidi -l</c> wyświetli listę dostępnych
portów, należy wybrać jeden do odtworzenia określonego pliku.
</p>

<pre caption="Odtwarzanie MIDI">
<comment>(Sprawdzanie otwartych portów)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Wybieramy port i odtwarzamy plik)</comment>
# <i> aplaymidi --port=65:0 ~/mid/jestes_szalona.mid</i>
</pre>

</body>
</section>
<section id="vsynth">
<title>Wirtualne syntezatory</title>
<body>

<p>
Jeśli karta nie posiada sprzętowego syntezatora potrzebny będzie wirtualny, na
przykład <c>timidity++</c>. Jego instalacja to prosta sprawa.
</p>

<pre caption="Instalowanie timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Aby timidity odgrywało dźwięki również potrzebny jest soundfont. Jeśli nie
dysponuje się akurat żadnym, należy zainstalować pakiet
<c>timidity-eawpatches</c> lub <c>timidity-shompatches</c>, zawierający
odpowiednie pliki. Można posiadać kilka wersji soundfontów, a własną
konfigurację umieszcza się w pliku <path>/usr/share/timidity/</path>. Zmiany
pomiędzy jednym, a drugim ustawieniem dla timidity dokonuje się za pomocą
polecenia <c>timidity-update</c>, które jest dostępne po zemergowaniu pakietu
timidity++.
</p>

<pre caption="Instalowanie soundfontów">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(lub)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Warto dodać skrypt <c>timidity</c> do domyślnego poziomu uruchomieniowego.
</p>

<pre caption="Dodawanie timidity do domyślnego poziomu uruchomieniowego">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Od tej pory można już <uri link="#doc_chap4_pre3">odtwarzać pliki MIDI</uri>.
</p>

</body>
</section>
<section>
<title>Dodatkowe narzędzia i firmware</title>
<body>

<p>
Niektóre karty mogą skorzystać dzięki instalacji narzędzi z pakietów
<c>alsa-tools</c> i <c>alsa-firmware</c>. Przed zainstalowaniem pakietu
<c>alsa-tools</c> należy się upewnić, że zmienna ALSA_TOOLS w pliku
<path>/etc/make.conf</path> zawiera nazwy wszystkich niezbędnych narzędzi.
Na przykład:
</p>

<pre caption="Wybieranie narzędzi dla ALSA w /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Jeśli zmienna ALSA_TOOLS nie zostanie ustawiona to zostaną zbudowane wszystkie
programy. Ostatnią czynnością opisaną w tym tekście jest zainstalowanie pakietów
<c>alsa-tools</c> (i <c>alsa-firmware</c> - jeśli również jest konieczny).
</p>

<pre caption="Instalowanie narzędzi ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Podziękowania</title>
<body>

<p>
Dziękujemy wszystkim, którzy tworzyli poprzednią wersję tego tekstu, osoby te
to kolejno: Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy Huddleston,
John P. Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft and Erwin.
</p>

</body>
</section>
<section>
<title>Adresy stron związanych z tematem</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">Strona domowa projektu ALSA</uri></li>
  <li><uri link="http://linux-sound.org">Oprogramowanie Sound/MIDI w systemie Linux</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
