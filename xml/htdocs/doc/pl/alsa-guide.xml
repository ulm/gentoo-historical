<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/alsa-guide.xml,v 1.1 2004/11/28 14:29:14 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/pl/alsa-guide.xml" lang="pl">
<title>Gentoo Linux ALSA Guide</title>

<author title="Autor">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Autor">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Autor">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Autor">
  <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Redaktor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Redaktor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Redaktor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Redaktor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Redaktor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Tłumacz">
  <mail link="mitos@interia.pl">Paweł Mitosek</mail>
</author>

<abstract>
Przewodnik ten pokaże jak zainstalować alsę (ALSA - Zaawansowana linuxowa
architektura dźwięku) na Gentoo Linux. Dokument ten ma za zadanie dostarczyć
więcej informacji na temat alsy , podstawowe dane można uzyskać w przewodniku o
konfiguracji Gentoo Linux.
</abstract>

<license/>

<version>1.5.5</version>
<date>2004-10-31</date>

<chapter>
<title>Zaawansowana Linuxowa Architektura Dźwięku (ALSA)</title>
<section>
<title>Czym jest ALSA?</title>
<body>

<p>
ALSA - <e>Advanced Linux Sound Architecture</e>, projekt, który ma na celu
rozwijanie wysokiej jakości linuxowego podsystemu dźwięku. Zastąpił on OSS
(<e>Open Sound System(Otwarty System Dźwięku)</e>) jako domyslny podsystem
dźwiękowy w serii jądra 2.6.
</p>

<p>
ALSA to efektywne wsparcie dla wszystkich interfejsów dźwiękowych,jest w pełni
zmodułowany, wykorzystuje możliwości maszyn wieloprocesorowych SMP i zapewnia
bezpieczeństwo wątków i dostarcza wysokiej jakości biblioteki przestrzeni
użytkownika <e>alsa-lib</e>, by ułatwić programowanie aplikacji. Dostarcza
również wstęczną zgodność z OSS.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Instalacja alsy</title>
<section>
<title>Znaczniki USE</title>
<body>

<p>
Gentoo dostarcza <c>alsa</c> flagi USE, które powinno się ustawić w
<path>/etc/make.conf</path>, by pozwolić naszym pakietom skompilować się ze
wsparciem dla alsy. Jeśli masz także ustawioną flagę <c>oss</c> w zmiennej USE,
ALSA skompiluje się ze wsteczną zgodnością z OSS.
</p>

</body>
</section>
<section>
<title>Moduły jądra</title>
<body>

<p>
Zanim zaczniemy, upewnij się, że jądro ma włączone <e>Sound Card Support</e>.
Jeśli użyliśmy <c>genkernela</c> do budowy jądra, wtedy jest to automatycznie
włączone. W innym przypadku należy przekonfigurować jądro.
</p>

<p>
Jeśli używamy jądra wersji 2.6 wtedy możemy pominąć resztę tej sekcji i
kontynuować na <uri link="#alsa-utils">Installing the ALSA Utils</uri>, jako że
jądro 2.6 ma niezbędne sterowniki alsy. Oczywiście należy włączyć współpracę
dla karty dźwiękowej podczas konfiguracji jądra.
</p>

<p>
Użytkownicy jądra w wersji 2.4 muszą zainstalować niezbędne sterowniki alsy dla
swoich kart dźwiękowych. Najpierw należy dowiedzieć się, jaką ma się kartę
dźwiękową posiadamy. Prostym sposobem jest poszukanie frazy "audio", w tym co
wyświetli polecenie <c>lspci</c>. Można to zainstalować przez <c>emerge
pciutils</c>.
</p>

<pre caption="Znajdywanie rodzaju karty dźwiękowej">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
Teraz należy przejść do <uri link="http://www.alsa-project.org/alsa-doc">ALSA
Soundcard Matrix</uri> i znaleźć rodzaj swojej karty dźwiękowej. W powyższym
przykładzie powinniśmy się udać się  do producenta "VIA". Tam też otrzymamy
tabelkę ze znanymi chipsetami sprzedawcy. Chipset z powyższego przykładu to
"via82c686"; Link ze szczegółami (Details) informuje nas, że sterownik nazywa
się <path>via82xx</path>. To wszystkie informacje, jakie są nam potrzebne i
resztę dokumentu możemy pominąć.
</p>

<p>
W oparciu o te informacje, możemy teraz zainstalować <c>alsa-driver</c>.
Najpierw należy wyedytować <path>/etc/make.conf</path> i <e>dodać</e> nową
opcję ALSA_CARDS do tego. W środku tej zmiennej deklarujemy sterownik do karty
dźwiękowej, którą chcemy użyć:
</p>

<pre caption="Edytowanie /etc/make.conf dla ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<p>
Teraz instalujemy <c>alsa-driver</c>:
</p>

<pre caption="Instalowanie sterowników alsy">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Kiedykolwiek będziemy kompilować jądro, sterowniki alsy mogą być nadpisane.
Dlatego radzimy ponownie uruchamiać <c>emerge alsa-driver</c> za każdym razem,
gdy przekompilujemy jądro i uruchomimy na tym jądrze system.
</impo>

</body>
</section>
<section id="alsa-utils">
<title>Instalowanie narzędzi ALSA</title>
<body>

<p>
Jeśli chcesz wstęczną zgodność z OSS, potrzebujesz zainstalować
<c>alsa-oss</c>:
</p>

<pre caption="Instalowanie warstwy zgodnośći ALSA OSS">
# <i>emerge alsa-oss</i>
</pre>

<p>
Teraz instalacja narzędzi ALSA w systemie (ta część jest obowiązkowa):
</p>

<pre caption="Instalowanie narzędzi ALSA">
# <i>emerge alsa-utils</i>
</pre>

<p>
Teraz kiedy narzędzia są zainstalowane, należy skonfigurować alsę...
</p>

</body>
</section>
</chapter>

<chapter>
<title>Konfiguracja alsy</title>
<section>
<title>Automatyczne ładowanie modułów jądra</title>
<body>

<p>
Jeśli używamy modułowego jądra (tak jak wtedy gdy używamy <c>genkernela</c>)
należy wyedytować <path>/etc/modules.d/alsa</path>, ażeby aktywować niezbędne
moduły podczas uruchamiania systemu. Dla karty z naszego przykładu będzie to:
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># Poniższe potrzebne jest tylko, jeśli potrzebujemy zgodność z OSS</comment>
alias sound-slot-0 snd-card-0
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Teraz uruchamiamy <c>modules-update</c>, by zachować zmiany jakie
wprowadziliśmy do <path>alsy</path> w pliku <path>/etc/modules.conf</path>:
</p>

<pre caption="Aktualizacja modułów">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>Weryfikacja plików urządzeń</title>
<body>

<p>
Jeśli używamy DevFS (który jest domyślny dla Instalacji Gentoo), należy się
upewnić, że <path>/etc/devfsd.conf</path> ma właściwie zarejestrowane
urządzenia alsy i uprawnienia:
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>Ustawienie uruchamiania alsy z systemem</title>
<body>

<p>
Aby aktywować wsparcie alsy podczas uruchamiania, należy dodać skrypt
uruchomieniowy <c>alsasound</c> do poziomu uruchomienia:
</p>

<pre caption="Dodawanie alsasound do poziomu uruchomienia">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>Odblokowanie kanałów</title>
<body>

<p>
Domyśnie wszytkie kanały są ściszone do zera. Aby to naprawić wpisujemy
polecenie <c>amixer</c>:
</p>

<pre caption="Uruchamianie amixer">
# <i>amixer</i>
</pre>

<p>
Jeśli polecenie <c>amixer</c> daje na wyjście mnóstwo linii, wtedy jesteśmy
gotowi by odblokować kanały. Jeśli zaś otrzymamy błąd, musimy dwukrotnie
sprawdzić, czy moduł karty dźwiękowej jest włączony.
</p>

<p>
Teraz odblokowujemy kanały <e>Master</e> i <e>PCM</e>. Jeśli to nie jest
wystarczające, odblokowujemy również kanał <e>Center</e> i <e>Surround</e>.
</p>

<pre caption="Odblokowywanie kanałów dźwiękowych">
# <i>amixer set Master 100 unmute</i>
# <i>amixer set PCM 100 unmute</i>
<comment>(Tylko wtedy , gdy jest to niewystarczające:)</comment>
# <i>amixer set Center 100 unmute</i>
# <i>amixer set Surround 100 unmute</i>
</pre>

<p>
By sprawdzić, czy dźwięk działa, uruchamiamy plik wave (używając <c>aplay</c>),
mp3 (używając <c>mpg123</c> czy nawet <c>mplayer</c>) czy też jakikolwiek inny
format dźwięku.
</p>

<p>
By dobrze dostroić kanały dźwiękowe, możemy zmienić ich ustawienia używajac
aplikacji <c>alsamixer</c>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aktywacja wsparcia dla MIDI</title>
<section>
<title>Instalacja niezbędnych pakietów</title>
<body>

<p>
Część kart dźwiękowych ma wbudowane syntezatory MIDI. Aby ich użyć, musimy
najpierw zainstalować pakiet <c>awesfx</c>:
</p>

<pre caption="Instalowanie pakietu awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Jeśli mamy kolekcję próbek dźwięku, umieszczamy je w
<path>/usr/share/sfbank</path>. Na przykład, SBLive ma plik dźwiękowy z
próbkami o nazwie <path>8MBGMSFX.SF2</path> lub <path>CT4GMSFX.SF2</path>.
</p>

<p>
Po skopiowaniu pliku z próbkami, wybieramy je poleceniem <c>asfxload</c>:
</p>

<pre caption="Wgrywanie próbek dźwięku">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
To polecenie musi być użyte za każdym razem jeśli uruchamiasz system, więc
dobrze jest dodać je także do <path>/etc/conf.d/local.start</path>.
</p>

<p>
Jeśli nie możemy znaleźć żadnych próbek dźwięku na płycie CD, możemy je
ściągnąć z <uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>.
</p>

</body>
</section>
<section>
<title>Wirtualny syntezator Timidity++</title>
<body>

<p>
Jeśli nasza karta dźwiękowa nie działa ze sprzętowym syntezatorem (lub jeśli
nie chcemy go używać) możemy używać <c>timidity++</c>, który to dostarczy nam
wirtualny syntezator. Zacznijmy od pobrania pakietu:
</p>

<pre caption="Instalowanie Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Timidity będzie odtwarzało dźwięk, ale potrzebuje do tego próbek dźwięku. Jeśli
żadnych nie posiadamy, instalujemy <c>timidity-eawpatches</c>, co dostarczy nam
nieco próbek.
</p>

<pre caption="Instalowanie timidity-eawpatches">
# <i>emerge timidity-eawpatches</i>
</pre>

<p>
Nie zapomnij dodać <c>timidity</c> do domyślnego poziomu uruchamiania.
</p>

<pre caption="Dodawanie timidity do domyślnego poziomu uruchamiania">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>Testowanie wsparcia dla MIDI</title>
<body>

<p>
Możemy użyć <c>aplaymidi</c> z narzędzi alsa, by sprawdzić konfigurację MIDI.
</p>

<p>
By zobaczyć, które porty wyjściowe MIDI są dostępne w naszym systemie, użyj
<c>-l</c> w opcji:
</p>

<pre caption="Oglądanie portów wyjściowych MIDI">
# <i>aplaymidi -l</i>
</pre>

<p>
Jeśli wygląda dobrze, próbujemy uruchomić plik MIDI, by upewnić się, czy
wszystko działa. Robimy to przy pomocy opcji <c>-p</c> po której wpisujemy
numer portu MIDI, który chcemy zobaczyć.
</p>

<pre caption="Odtwarzanie pliku MIDI">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith' Theme.mid"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Uwagi końcowe</title>
<section>
<title>Narzędzia i oprogramowanie sprzętowe</title>
<body>

<p>
Niektóre karty dźwiękowe mogą korzystać z pewnych narzędzi dostarczanych przez
pakiety <c>alsa-tools</c> i <c>alsa-firmware</c>. Jeśli potrzebujemy
<c>alsa-tools</c>,musimy się upewnić, że mamy zdefiniowaną zmienną ALSA_TOOLS w
<path>/etc/make.conf</path> z przypisanymi narzędziami, które potrzebujemy. Na
przykład:
</p>

<pre caption="Wybór narzędzi alsy w /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Teraz instalujemy pakiet <c>alsa-tools</c> (i/lub pakiet <c>alsa-firmware</c>):
</p>

<pre caption="Instalacja narzędzi ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Aktywacja wsparcia dla Dżojstika</title>
<body>

<p>
Jeśli nasza karta dźwiękowa ma wejście dla dżojstika, pewnie będziemy
zainteresowani aktywacją wsparcia dla dżojstika. Jeśli tak, to zaczynamy od
sprawdzenia, czy karta posiada parametr joystick. Możemy to zrobić uruchamiając
<c>modinfo</c>. Na przykład, dla <c>snd-via82xx</c>:
</p>

<pre caption="Uruchomienie modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Jeśli znajdziemy parametr <c>joystick</c>, dołączamy <c>joystick=1</c> do
polecenia <c>options</c> w <path>/etc/modules.d/alsa</path>. Na przykład:
</p>

<pre caption="Dodawanie parametru joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>Zasoby</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">Projekt ALSA</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto's and FAQs</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
