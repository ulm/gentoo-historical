<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/liveusb.xml,v 1.10 2007/05/11 10:59:28 rane Exp $ -->

<guide link="/doc/pl/liveusb.xml" lang="pl">
<title>Instalacja Gentoo Linux przy użyciu USB (LiveUSB)</title>

<author title="Autor">
  <mail link="brix@gentoo.org">Henrik Brix Andersen</mail>
</author>
<author title="Tłumaczenie">
  <mail link="ttofel@o2.pl">Tomasz Tofel</mail>
</author>
<author title="Tłumaczenie">
  <mail link="stawrul@gmail.com">Waldemar Korłub</mail>
</author>

<abstract>
Ten dokument wyjaśnia jak stworzyć dysk instalacyjny Gentoo Linux na USB lub
innymi słowy, jak emulować płyty instalacyjne Gentoo Linux wykorzystując do
tego urządzenie flash USB.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.7</version>
<date>2006-12-21</date>

<chapter>
<title>Wprowadzenie</title>
<section>
<title>USB na "żywo"</title>
<body>

<p>
Ten dokument wyjaśnia jak stworzyć <e>dysk instalacyjny Gentoo Linux na USB</e>
lub innymi słowy, jak emulować płyty instalacyjne Gentoo Linux wykorzystując do
tego urządzenie flash USB. Jest to szczególnie przydatne dla osób instalujących
Gentoo Linux na laptopie, który nie posiada napędu CD-ROM.
</p>

<p>
Mimo, że instrukcje, które znajdują się w tym dokumencie dotyczą emulacji dysku
instalacyjnego Gentoo Linux na urządzeniu flash USB, powinny działać na
dowolnym urządzeniu blokowym przy odpowiedniej zmianie nazw urządzeń.
</p>

</body>
</section>
<section>
<title>Uwagi wstępne</title>
<body>

<p>
Aby używać dysku instalacyjnego Gentoo Linux na USB potrzebujemy:
</p>

<ul>
  <li>Urządzenia flash USB (co najmniej 64MB)</li>
  <li>Komputer x86 z możliwością uruchamiania systemu z USB</li>
</ul>

<p>
Jak również dostępu do:
</p>

<ul>
  <li>Komputera z Gentoo Linux (lub z inną dystrybucją Linuksa)</li>
</ul>

</body>
</section>
</chapter>
<chapter>
<title>Przygotowanie urządzenia flash USB</title>
<section>
<title>Partycjonowanie pamięci</title>
<body>

<warn>
Podane poniżej instrukcje skasują wszystkie dane znajdujące się w pamięci flash
USB. Należy pamiętać o zarchiwizowaniu wszystkich danych znajdujących się w
urządzeniu flash USB.
</warn>

<impo>
Zakładamy, że węzęł urządzenia <path>/dev/sda</path> odpowiada urządzeniu flash
USB. Jeżeli w komputerze znajdują się inne urządzenia typu SCSI, należy upewnić
się, że używany jest odpowiedni węzeł.
</impo>

<p>
Tworzymy partycję FAT32 na urządzeniu flash USB i ustawiamy ją jako startową
używając <c>fdisk</c>. Przykład partycjonowania został podany poniżej:
</p>

<pre caption="Przykładowy schemat partycjonowania">
# <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 1048 MB, 1048313856 bytes
33 heads, 61 sectors/track, 1017 cylinders
Units = cylinders of 2013 * 512 = 1030656 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1        1017     1023580    b  W95 FAT32
</pre>

</body>
</section>
<section>
<title>Tworzenie systemu plików</title>
<body>

<p>
Tworzymy system plików FAT32 na urządzeniu flash USB używając <c>mkdosfs</c>:
</p>

<pre caption="Uruchamianie mkdosfs">
<comment>(Należy się upewnić że pakiet sys-fs/dosfstools jest zainstalowany)</comment>
# <i>emerge -av sys-fs/dosfstools</i>
# <i>mkdosfs -F 32 /dev/sda1</i>
mkdosfs 2.11 (12 Mar 2005)
</pre>

</body>
</section>
<section>
<title>Instalowanie MBR</title>
<body>

<p>
Instalujemy prekompilowany Master Boot Record (MBR) z <c>syslinux</c> na
urządzeniu flash USB:
</p>

<pre caption="Instalacja MBR">
<comment>(Należy się upewnić że pakiet sys-boot/syslinux-3.00 (lub nowszy) jest zainstalowany)</comment>
# <i>emerge -av '>sys-boot/syslinux-3'</i>
# <i>dd if=/usr/lib/syslinux/mbr.bin of=/dev/sda</i>
0+1 records in
0+1 records out
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Kopiowanie plików</title>
<section>
<title>Montowanie płyty instalacyjnej Gentoo</title>
<body>

<warn>
Przewodnik ten został napisany w opraciu o wersję Gentoo 2006.0 i takiej należy
używać. Jeżeli użyjemy nowszej wersji nasz dysk USB nie będzie się uruchamiał.
</warn>

<p>
Pobieramy plik <path>install-x86-minimal-2006.0.iso</path> z <uri
link="/main/pl/where.xml">serwera lustrzanego</uri> Gentoo i montujemy obraz
ISO w <path>/mnt/cdrom/</path> jak pokazano poniżej:
</p>

<pre caption="Montowanie obrazu ISO płyty instalacyjnej Gentoo">
<comment>(Tworzymy katalog montowania /mnt/cdrom/, jeśli nie istnieje)</comment>
# <i>mkdir -p /mnt/cdrom</i>
# <i>mount -o loop,ro -t iso9660 install-x86-minimal-2006.0.iso /mnt/cdrom/</i>
</pre>

<note>
Jeżeli otrzymamy błąd o treści <e>Could not find any loop device</e>, w czasie
montowania obrazu iso, będziemy musieli zaznaczyć opcję <c>Loopback device
support</c> w konfiguracji jądra.
</note>

</body>
</section>
<section>
<title>Montowanie urządzenia flash USB</title>
<body>

<p>
Montujemy sformatowane urządzenie flash USB w <path>/mnt/usb/</path> jak
pokazano poniżej:
</p>

<pre caption="Montowanie urządzenia flash USB">
<comment>(Tworzymy katalog montowania /mnt/usb/, jeżeli to potrzebne)</comment>
# <i>mkdir -p /mnt/usb</i>
# <i>mount -t vfat /dev/sda1 /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Kopiowanie plików</title>
<body>

<p>
Kopiujemy pliki z płyty instalacyjnej Gentoo na urządzenie flash USB. Pliki
muszą zostać troszeczkę zreorganizowane, ponieważ będziemy używać
<c>syslinux</c> zamiast <c>isolinux</c>:
</p>

<pre caption="Kopiowanie plików">
# <i>cp -r /mnt/cdrom/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux.cfg /mnt/usb/syslinux.cfg</i>
# <i>rm -rf /mnt/usb/isolinux*</i>

<comment>(Nazwa jądra memtest86 musi zostać zmieniona, aby mogło być ono załadowane przez syslinux)</comment>
# <i>mv /mnt/usb/memtest86 /mnt/usb/memtest</i>
</pre>

<p>
Możemy teraz odmontować obraz ISO:
</p>

<pre caption="Odmotowywanie obrazu ISO">
# <i>umount /mnt/cdrom/</i>
</pre>

</body>
</section>
<section>
<title>Dopasowywanie konfiguracji bootloadera</title>
<body>

<p>
Konfigurację syslinux dopasowujemy używając programu <c>sed</c> tak, jak
pokazano poniżej. Parametr <c>dobladecenter</c> wprowadzi dodatkowe opóźnienie
przed usiłowaniem zamontowania systemu plików. Jest to potrzebne, aby umożliwić
urządzeniu flash USB zainstalowanie przed detekcją.
</p>

<pre caption="Dopasowywanie parametrów ładowania">
# <i>sed -i \
    -e "s:cdroot:cdroot dobladecenter:" \
    -e "s:kernel memtest86:kernel memtest:" \
    /mnt/usb/syslinux.cfg</i>
</pre>

<note>
Rozważmy dodanie <c>docache</c> do parametrów uruchamiania. Powinno to pozwolić
na uruchomienie polecenia <c>umount /mnt/cdrom/</c> po załadowaniu systemu,
abyśmy mogli odłączyć urządzenie flash USB. Opcji tej nie należy używać jeśli
nie mamy pewności, że komputer, na którym będziemy uruchamiać system z USB nie
ma co najmniej 128MB RAM.
</note>

<!--
(2006.1 workaround) posted by nightmorph

Background:
After some lengthy discussion with Robin Johnson (robbat2) on IRC, it turns out
that the reason why 2006.1 fails to work with this guide is because inside the
initramfs, it specifies -t iso9660..but usb flash isn't this filetype, it's
vfat. 2006.0 was much better and just specified mount -t auto. so the thing is
to install an ~arch version of genkernel (3.4.4, still ~arch as of 2006-11-04)
and reconfigure syslinux.config to point at the renamed files.

Obviously, unmasking an ~arch version is never desirable in documentation, so
we
need some more alternatives...since 3.4.4 was only created at the end of
october; not likely to go stable all that soon.

Procedure:
After adjusting the parameters, and before the disk is unmounted/bootloader
installed, the following must be done for ~arch genkernel. Please replace
(dash)
with an actual - , since the damned xmllint throws a "comment not terminated"
error.

# echo "sys-kernel/genkernel" &gt;&gt; /etc/portage/package.keywords
# genkernel (dash)(dash)bootdir=/mnt/usb (dash)(dash)install all
(not sure if syslinux has been installed previously yet)
# nano -w syslinux.cfg
(Edit it to point at the new filenames installed by genkernel)
(might be worth renaming to the ones normally used by syslinux, as
if the kernel name is too long, "vfat might bite")

(might need to re-run syslinux as specified below to pick up the new names,
though maybe this renaming step should be in the section below?)
# syslinux /dev/sda1

TODO:
- if/when this document changes, brix requested some time ago that he be
  renamed
  "Original Author" and be moved to the bottom of the credits list.
- if/when this fix goes in, robbat2 deserves credit: this is his solution
    after
      all, and it works.

-->


</body>
</section>
</chapter>
<chapter>
<title>Instalowanie bootloadera</title>
<section>
<title>Odmontowywanie urządzenia</title>
<body>

<p>
Upewnijmy się czy urządzenie flash USB jest odmontowane przed instalacją
bootloadera:
</p>

<pre caption="Odmontowywanie urządzenia flash USB">
# <i>umount /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Instalowanie syslinux</title>
<body>

<p>
Na koniec instalujemy bootloader <c>syslinux</c> na urządzeniu flash USB:
</p>

<pre caption="Uruchamiamy syslinux">
# <i>syslinux /dev/sda1</i>
</pre>

<impo>
Należy ponownie uruchomić <c>syslinux /dev/sda1</c> za każdym razem gdy
modyfikujemy plik <path>syslinux.cfg</path>, aby zmiany konfiguracji odniosły
zamierzony skutek.
</impo>

</body>
</section>
</chapter>
<chapter>
<title>Używanie LiveUSB</title>
<section>
<title>Uruchamianie</title>
<body>

<p>
Umieszczamy urządzenie flash USB w porcie USB i uruchamiamy komputer,
upewniając się, że BIOS jest ustawiony w trybie uruchamiania z USB. Jeżeli
wszystko pójdzie dobrze, powinniśmy otrzymać standardowy znak zachęty syslinux.
</p>

<p>
Od teraz możemy zastosować ogólne instrukcje instalacyjne, które znajdują się w
<uri link="/doc/pl/handbook/">Podręczniku Gentoo</uri>.
</p>

</body>
</section>
</chapter>
</guide>
