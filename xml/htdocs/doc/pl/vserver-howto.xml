<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/vserver-howto.xml,v 1.7 2005/10/06 22:16:05 rane Exp $ -->

<guide link="/doc/pl/vserver-howto.xml" lang="pl">
<title>Opis technologii Gentoo Linux-VServer</title>

<author title="Autor">
  <mail link="hollow@gentoo.org">Benedikt Boehm</mail>
</author>
<author title="Edytor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Tłumacz">
   Paweł Kwiatkowski
</author>

<abstract>
W poradniku nauczymy się konfigurować podstawowy wirtualny serwer, wykorzystując
do tego technologię Linux-VServer.
</abstract>

<license/>

<version>1.1</version>
<date>2005-10-06</date>

<chapter>
<title>Wprowadzenie</title>
<section>
<title>Idea technologii Linux-VServer</title>
<body>

<p>
U podstaw rozwiązania Linux-VServer leży pomysł rozdzielenia przestrzeni
użytkownika na osobne jednostki (zwane czasem Wirtualnymi Serwerami Prywatnymi
[ang. VPS]), w taki sposób, aby dla procesów uruchomionych w obrębie VPS,
wyglądały i zachowywały się jak prawdziwe serwery,
</p>

</body>
</section>
<section>
<title>Terminologia stosowana w poradniku</title>
<body>

<table>
<tr>
  <th>Zwrot</th>
  <th>Opis</th>
</tr>
<tr>
  <th>Linux-VServer, VServer</th>
  <ti>Linux-VServer to oficjalna nazwa projektu i jest używana w poradniku
  właśnie w tym znaczeniu</ti>
</tr>
<tr>
  <th>wirtualny serwer, vserver</th>
  <ti>stosowane wymiennie, odnoszą się pojedynczej instancji serwera (tj.
    jednego serwera wirtualnego)</ti>
</tr>
<tr>
  <th>komputer host, host</th>
  <ti>fizyczna maszyna, na której zainstalowane jest Gentoo i na której
  będą znajdować się wszystkie wirtualne serwery</ti>
</tr>
<tr>
  <th>util-vserver</th>
  <ti>pakiet <c>util-vserver</c> zawiera programy niezbędne do zarządzania
  naszymi serwerami wirtualnymi</ti>
</tr>
</table>

</body>
</section>
</chapter>

<chapter>
<title>Konfiguracja hosta</title>
<section>
<title>Instalacja kernela wspierającego VServer</title>
<body>

<pre caption="Instalacja kernela obsługującego VServer - vserver-sources">
# <i>emerge vserver-sources</i>
</pre>

<p>
Po tym jak źródła vserver-sources zostały zainstalowane, musimy je skonfigurować
wpisując polecenie <c>make menuconfig</c>.
</p>

<pre caption="Konfiguracja kernela vserver-sources">
# <i>cd /usr/src/linux-&lt;KERNELVERSION&gt;-vserver-&lt;VSERVERVERSION&gt;</i>
# <i>make menuconfig</i>

Linux VServer ---&gt;
  [ ] Enable Legacy Kernel API
<comment>(Nie ustawiamy!)</comment>
  [ ] Disable Legacy Networking Kernel API
<comment>(Zalecane)</comment>
  [*] Enable Proc Security
  [*] Enable Hard CPU Limits
  Persistent Inode Context Tagging (UID24/GID24)  ---&gt;
  [ ] Tag NFSD User Auth and Files
  [ ] Compile Debugging Code
</pre>

<p>
Po zbudowaniu jądra należy uaktualnić konfigurację programu ładującego, a
następnie ponownie uruchomić system i sprawdzić czy kernel startuje poprawnie.
</p>

<pre caption="Instalacja kernela">
<comment>(Budowanie kernela)</comment>
# <i>make</i>
<comment>(Instalacja)</comment>
# <i>make modules_install</i>
# <i>cp arch/i386/boot/bzImage /boot/kernel-&lt;KERNELVERSION&gt;-vserver-&lt;VSERVERVERSION&gt;</i>
<comment>(Jeśli to potrzebne, to edytujemy plik konfiguracyjny bootloadera i uruchamiamy ponownie system)</comment>
# <i>reboot</i>
</pre>

</body>
</section>
<section>
<title>Konfiguracja środowiska na maszynie host</title>
<body>

<p>
Do zarządzania serwerami wirtualnymi potrzebujemy pakietu util-vserver, który
zawiera wszystkie potrzebne do tego programy.
</p>

<note>
Narzędzia z jakich korzystamy na potrzeby tego przewodnika muszą być co
najmniej w wersji <c>&gt;=sys-apps/util-vserver-0.30.208-r3</c>. Czasami trzeba
je odmaskować.
</note>

<pre caption="Instalacja pakietu util-vserver">
# <i>emerge util-vserver</i>
</pre>

<p>
W celu zapewnienia odpowiednich praw dostępu do systemu plików /proc, po każdym
ponownym uruchomieniu komputera trzeba będzie wykonać polecenie
<c>vprocunhide</c>.
</p>

<pre caption="Skrypt startowy vprocunhide">
# <i>rc-update add vprocunhide default</i>
# <i>/etc/init.d/vprocunhide start</i>
</pre>

<p>
Skrypt vshelper używany jest do prawidłowego zatrzymywania i ponownego
uruchamiania wirtualnych serwerów. Musimy wskazać kernelowi lokalizację, w
której znajduje się ów skrypt:
</p>

<pre caption="Konfiguracja vshelper">
# <i>echo 'kernel.vshelper = /usr/lib/util-vserver/vshelper' &gt;&gt; /etc/sysctl.conf</i>
# <i>sysctl -p</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Tworzenie szkieletu</title>
<section>
<title>Instalowanie stage3 vservera</title>
<body>

<p>
W tym celu skorzystamy ze skryptu <c>vserver-new</c>. Należy pobrać plik stage3
vservera ze strony <uri>http://dev.gentoo.org/~hollow/vserver/stages</uri>, a
następnie postępować zgodnie ze wskazówkami jakie drukuje skrypt.
</p>

<p>
Dla naszego vservera musimy wybrać identyfikator kontekstowy
(odradzamy używania dynamicznych identyfikatorów), a także
ustawić potrzebne parametry urządzenia sieciowego (w tym przykładzie jest to
interfejs eth0, skonfigurowany dla 192.168.1.254/24 oraz identyfikator
kontekstowy, który powstał z dwóch ostatnich części adresu IP wirtualnego serwera).
</p>

<pre caption="Rozpoczynanie instalacji ze stage3">
# <i>vserver-new gentoo-template \</i>
  <i>--hostname gentoo \</i>
  <i>--context 1253 \</i>
  <i>--interface eth0:192.168.1.253/24 \</i>
  <i>stage3 /ścieżka/do/stage3-tarball.tar.bz2</i>
</pre>

<note>
By odzwierciedlić konfigurację sieci, powinniśmy dostosować do naszych potrzeb
pliki <path>/etc/conf.d/hostname</path>, <path>/etc/conf.d/domainname</path> i
<path>/etc/hosts</path>. Szczegóły znajdują się w <uri
link="/doc/pl/handbook/handbook-x86.xml?part=1&amp;chap=8#doc_chap2_sect1">
rozdziale 8.b.1</uri> oraz <uri
link="/doc/pl/handbook/handbook-x86.xml?part=1&amp;chap=8#doc_chap2_sect4">
rozdziale 8.b.4</uri>. Pozostała część konfiguracji sieci dla wirtualnych
serwerów zostanie przeprowadzona na maszynie host.
</note>

</body>
</section>
<section>
<title>Tworzenie tarball z szablonem</title>
<body>

<p>
Nie trzeba budować tego pliku dla każdego komputera gościa, ponieważ skrypt
<c>vserver-new</c> umożliwia stworzenie szablonów w postaci tarballi z
istniejącej konfiguracji vservera.
</p>

<pre caption="Tworzenie tarballa szablonu">
# <i>cd /vservers/gentoo-template</i>
# <i>tar cjvpf ../gentoo-template.tar.bz2 ./</i>
</pre>

<p>
Ze skryptu <c>vserver-new</c> korzysta się również do rozpakowywania
powyższego pliku.
</p>

<pre caption="Rozpakowywanie szablonu">
# <i>cd /vservers</i>
# <i>vserver-new myguest \</i>
  <i>--hostname myguest \</i>
  <i>--context 1252 \</i>
  <i>--interface eth0:192.168.1.252/24 \</i>
  <i>template ./gentoo-template.tar.bz2</i>
</pre>

<note>
Korzystanie ze wspólnego drzewa Portage dla wszystkich gości umożliwi
oszczędzenie sporej ilości wolnego miejsca. W tym celu otwieramy plik
<path>/etc/vservers/myguest/fstab</path> i odkomentowujemy wpisy dla
<path>/usr/portage</path> i <path>/usr/portage/distfiles</path>. Goście będą
mogli dzięki temu czytać i zapisywać w katalogu
<path>/usr/portage/distfiles</path>.
</note>

</body>
</section>
<section>
<title>Testowanie wirtualnego serwera</title>
<body>

<p>
Powinniśmy mieć możliwość uruchomienia wirtualnego serwera, a następnie
przejścia do niego przy pomocy poniższych poleceń. Jeśli brakuje komend takich jak
<c>mount</c> lub <c>dmesg</c> należy zainstalować pakiet util-linux, wydając w
obrębie serwera wirtualnego polecenie <c>emerge util-linux</c>. Standardowo
profil wirtualnego serwera nie zawiera wspomnianego pakietu.
</p>

<pre caption="Testowanie wirtualnego serwera">
# <i>vserver myguest start</i>

# <i>vserver-stat</i>
CTX   PROC    VSZ    RSS  userTIME   sysTIME    UPTIME NAME
0       90   1.4G 153.4K  14m00s11   6m45s17   2h59m59 root server
1252     2     3M   286    0m00s45   0m00s42   0m02s91 myguest
# <i>vserver gentoo enter</i>
# <i>ps ax</i>
PID   TTY      STAT   TIME COMMAND
    1 ?        S      0:00 init [3]
22887 ?        Ss     0:00 /usr/sbin/syslog-ng
20496 pts/0    S      0:00 /bin/bash -login
20508 pts/0    R+     0:00 ps ax
# <i>logout</i>
</pre>

</body>
</section>
<section>
<title>Kontakt</title>
<body>

<p>
W przypadku problemów można kontaktować się z autorem tekstu lub zgłosić
problem do <uri link="http://bugs.gentoo.org">Bugzilli</uri>.
</p>

</body>
</section>
</chapter>
</guide>
