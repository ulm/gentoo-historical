<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/pl/mysql-upgrading.xml,v 1.8 2006/03/16 00:20:56 rane Exp $ -->

<guide link="/doc/pl/mysql-upgrading.xml" lang="pl">
<title>Opis aktualizacji MySQL do wersji 4.1.x</title>

<author title="Autor">
  <mail link="citizen428@gentoo.org">Michael Kohl</mail>
</author>
<author title="Autor">
  <mail link="vivo@gentoo.org">Francesco Riosa</mail>
</author>
<author title="Tłumaczenie">
  <mail link="claudiush@gmail.com">Dawid Węgliński</mail>
</author>

<abstract>
Zespół MySQL Gentoo z dumą ogłasza, że  MySQL 4.1 jest już dostępna w
niestabilnej wersji drzewa Gentoo (~arch). Zarazem ma nadzieję, że wkrótce
ebuild ten zostanie ustabilizowany. Tutaj opisujemy jak możliwie bezboleśnie
przejść na tę wersję.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.7</version>
<date>2006-03-11</date>

<chapter>
<title>Rozbudowa starej wersji MySQL</title>
<section>
<body>

<p>
Użytkownicy rozbudowujący starą wersję (&lt;4.0.24) MySQL najpierw muszą
zainstalować MySQL 4.0.25. Jeśli już działa ta wersja, możemy upuścić tę część
tekstu i przejść do następnej.
</p>

<pre caption="Rozbudowa">
# <i>emerge -av --buildpkg "&lt;mysql-4.1"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Robimy kopię zapasową danych</title>
<section>
<body>

<p>
Jednym z podstawowych zadań każdego administratora bazy danych jest robienie
kopii zapasowych. Zaczynamy:
</p>

<pre caption="Kopia awaryjna wszystkich danych">
# <i>mysqldump \</i>
  <i>-uroot \</i>
  <i>-p$PASSWORD \</i>
  <i>-hlocalhost \</i>
  <i>--all-databases \</i>
  <i>--opt \</i>
  <i>--allow-keywords \</i>
  <i>--flush-logs \</i>
  <i>--hex-blob \</i>
  <i>--master-data \</i>
  <i>--max_allowed_packet=16M \</i>
  <i>--quote-names \</i>
  <i>--result-file=BACKUP_MYSQL_4.0.SQL</i>
</pre>

<p>
Teraz powinien zostać stworzony plik o nazwie <path>BACKUP_MYSQL_4.0.SQL</path>, który będzie nam dalej potrzebny do odtworzenia danych. Dane zawarte w MySQL są napisane
językiem SQL - Structured Query Language.
</p>

<p>
Warto sprawdzić czy kopia zapasowa działa.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Rozszerzanie z ostatniej wersji MySQL</title>
<section>
<body>

<p>
Teraz stworzymy kopię pakietu (bazy danych, nie samych danych) obecnie
zainstalowanej wersji:
</p>

<pre caption="Kopia pakietu binarnego">
# <i>quickpkg dev-db/mysql</i>
</pre>

<p>
Nadszedł czas, aby pozbyć się obecnej wersji oraz wszystkich jej danych:
</p>

<pre caption="Deinstalacja MySQL-a">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>tar cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
</pre>

<note>
Powinniśmy mieć dwie, różne kopie zapasowe: jedna SQL, przenośna, pomiędzy
różnymi wersjami MySQL, oraz druga, która pozwoli ci szybko odzyskać bazę
danych. Więcej szczegółów na ten temat w dalszej części tego dokumentu.
</note>

<p>
Po tym jak usuniemy starą instalację MySQL, możemy zainstalować nową wersję.
Warto zauważyć, że <c>revdep-rebuild</c> jest niezbędny do odbudowy pakietów
łączonych z MySQL.
</p>

<pre caption="Kompilowanie nowych wersji plików binarnych">
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
</pre>

<p>
Teraz konfigurujemy nowo zainstalowaną wersję MySQL i restartujemy demona:
</p>

<pre caption="Konfiguracja MySQL-a 4.1">
# <i>emerge --config =mysql-4.1.&lt;micro_version&gt;</i>
# <i>/etc/init.d/mysql start</i>
</pre>

<p>
Teraz można przejść do importowania kopii zapasowej, utworzonej w punkcie 2.
</p>

<impo>
Plik <path>/etc/mysql/my.cnf</path> ustawia logowanie binarne (<c>log-bin</c>)
jako standardowe. Zaowocuje to tym, że każde polecenie ingerujące w zawartość
lub nazwę pliku będzie logowane. Jeśli zostanie uruchomione na dużej bazie
danych (np. 1 GB), spowoduje to utworzenie niesamowicie wielkiego pliku, który
szybko rozrośnie się do rozmiarów całej partycji - zabierając cenne miejsce.
Jeśli nie dysponujemy wystarczającą przestrzenią dyskową, warto zastanowić się
nad wyłączeniem opcji logowania binarnego.
</impo>

<pre caption="Import kopii zapasowej SQL-a">
# <i>cat BACKUP_MYSQL_4.0.SQL \</i>
     <i>| mysql \</i>
     <i>-uroot \</i>
     <i>--password=</i><comment>'hasło'</comment><i> \</i>
     <i>-hlocalhost \</i>
     <i>--max_allowed_packet=16M</i>

# <i>mysql_fix_privilege_tables \</i>
     <i>--defaults-file=/etc/mysql/my.cnf \</i>
     <i>--user=root \</i>
     <i>--password=</i><comment>'hasło'</comment><i></i>
</pre>

<p>
Jeśli zrestartujemy demona MySQL, a wszystko poszło zgodnie z planem, będziemy
mieli sprawnie działającą wersję 4.1.x! :-)
</p>

<pre caption="Restart MySQL-a">
# <i>/etc/init.d/mysql restart</i>
</pre>

<p>
Jeśli podczas procesu rozbudowy pojawią się jakiekolwiek problemy, prosimy
zgłosić je do naszej <uri link="https://bugs.gentoo.org">Bugzilli</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Odzyskiwanie starej instalacji MySQL 4.0</title>
<section>
<body>

<p>
Jeśli MySQL 4.1 nie spełnia oczekiwań, zawsze można wrócić do MySQL 4.0.
</p>

<pre caption="Powrót do przeszłości ;-)">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
# <i>emerge --usepkgonly "&lt;mysql-4.1"</i>
# <i>tar -xjpvf mysql.[tag] -C /</i>
# <i>/etc/init.d/mysql start</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Bezpośrednia rozbudowa, niewspierane i niebezpieczne rozwiązanie</title>
<section>
<body>

<p>
Przy wykorzystaniu pewnej sztuczki możliwe jest też bezpośrednie uaktualnienie
do wersji 4.1.
</p>

<pre caption="Bezpośrednia rozbudowa">
# <i>quickpkg dev-db/mysql</i>
# <i>/etc/init.d/mysql stop</i>
# <i>tar -cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>export MYSQL_STRAIGHT_UPGRADE=1</i>
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>unset MYSQL_STRAIGHT_UPGRADE</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
# <i>/etc/init.d/mysql start</i>
# <i>mysql_fix_privilege_tables --defaults-file=/etc/mysql/my.cnf \</i>
         <i>-uroot --password=</i><comment>'hasło'</comment><i></i>
# <i>mysql --database=mysql -uroot --password=</i><comment>'hasło'</comment><i> &lt; /tmp/new_pieces.sql</i>
</pre>

<p>
Powodzenia, a jeśli coś zawiedzie, nie mów, że nie ostrzegaliśmy ;-)
</p>

</body>
</section>
</chapter>
</guide>
