<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ro/quick-samba-howto.xml,v 1.7 2006/03/11 11:58:14 alin Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/ro/quick-samba-howto.xml" lang="ro">
<title>Ghid Samba3/CUPS/ClamAV</title>
<author title="Autor">
  <mail link="daff at dword dot org">Andreas "daff" Ntaflos</mail>
</author>
<author title="Autor">
  <mail link="joshua@sungentoo.homeunix.com">Joshua Preston</mail>
</author>
<author title="Translator">
  <mail link="robert.datcu@gentoo.ro">Robert Datcu</mail>
</author>

<abstract>
Pregătirea, instalarea şi configurarea unui server Samba sub Gentoo care
partajează fişiere, imprimante fără necesitatea instalării de drivere şi oferă
scanare împotriva viruşilor în mod automat.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.13</version>
<date>2006-03-06</date>

<chapter>
<title>Introducere</title>
<section>
<title>Scop</title>
<body>

<p>
Acest ghid este conceput în a vă ajuta să transformaţi o reţea avănd mulţi
clienţi ce înţeleg limbaje diferite, într-una în care diferitele maşini înţeleg
un limbaj comun. Scopul final este ca ahitecturile şi tehnologiile diferite să
poată fi coexista într-un mediu productiv.
</p>

<p>
Urmărirea intrucţiunilor schiţate în acest ghid ar trebui să constituie un pas
excelent spre o coabitare paşnică între Windows, şi virtual, toate variaţiile
de *nix cunoscute.
</p>

<p>
Acest ghid, la origine, nu a pornit ca un ghid, ci ca un set de întrebări
frecvente. S-a urmărit la început explorarea funcţionalităţii şi puterii
sistemului Gentoo, a sistemului Portage şi a flexibilităţii indicatorilor USE.
Ca în multe alte proiecte, s-a descoperit repede ce lipsea în domeniul Gentoo:
nu exista nici un Ghid Samba furnizat utilizatorilor Gentoo. Aceşti utilizatori
cer mai mult decăt cei mai mulţi; ei cer performanţă, flexibilitate şi
adaptare. Aceasta nu înseamnă că acest ghid nu este menit pentru alte
distribuţii; mai degrabă a fost conceput pentru a fi folosit cu o versiune
foarte adaptata a Samba.
</p>

<p>
Acest ghid va descrie cum se pot partaja fişiere şi imprimante între staţii
Windows şi staţii *nix. De asemenea, va demonstra folosirea caracteristicii VFS
(Virtual File System - Sistem de Fişiere Virtual) a Samba în a încorpora
protecţie antivirus automată. În final, vă va indica modalităţile de mount-are
şi manipulare a resurselor partajate.
</p>

<p>
Sunt câteva subiecte care vor fi menţionate, dar care sunt în afara scopului
propus de acest ghid. Vor fi luate în seamă pe măsura prezentării.
</p>

<p>
Acest document este bazat pe compilarea şi alipirea excelentului ghid oferit pe
<uri link="http://forums.gentoo.org">Forumurile Gentoo</uri> de Andreas "daff"
Ntaflos şi cunoştiinţele adunate de Joshua Preston. Adresa către aceasta
discuţie este oferit pentru referinţă mai jos:
</p>

<ul>
  <li>
    <uri link="http://forums.gentoo.org/viewtopic.php?t=110931">HOWTO 
    CUPS+Samba: Imprimarea din Windows &amp; Linux</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>Înainte de a folosi acest ghid</title>
<body>

<p>
Există mai multe ghiduri pentru setarea CUPS şi/sau Samba, vă rugăm să le
citiţi de asemenea, acestea putându-vă prezenta elemente necuprinse în acest
document (intenţionat sau altfel). Un astfel de document este foarte folositor
şi bine scris <uri link="/doc/ro/printing-howto.xml">Ghid de Imprimare în
Gentoo</uri>, întrucât problemele de configurare şi setarea diferitelor
imprimante nu sunt tratate aici.
</p>

</body>
</section>
<section>
<title>Sumar</title>

<body>

<p>
După prezentarea diferiţilor indicatori USE, lista următoare va schiţa toate
subiectele acoperite, aşa cum sunt prezentate:
</p>

<ul>
  <li>
  La serverul Samba:
    <ul>
      <li>
      Instalare şi configurare CLAMAV
      </li>
      <li>
      Instalare şi configurare Samba
      </li>
      <li>
      Instalare şi configurare CUPS
      </li>
      <li>
      Adăugarea imprimantei în CUPS
      </li>
      <li>
      Adăugarea driver-elor PS pentru clienţii Windows
      </li>
    </ul>
  </li>
  <li>
  La clienţii Unix:
    <ul>
      <li>
      Instalarea şi configurarea CUPS
      </li>
      <li>
      Configurarea imprimantei implicite
      </li>
      <li>
      Mount-area unei resurse partajate Windows sau Samba
      </li>
    </ul>
  </li>
  <li>
  La clienţii Windows:
    <ul>
       <li>
       Configurarea imprimantei
       </li>
       <li>
       Accesarea resurselor partajate Samba
       </li>
    </ul>
  </li>
</ul>

</body>
</section>
<section>
<title>Cerinţe</title>
<body>

<p>
Avem nevoie de următoarele:
</p>

<ul>
  <li>
  net-fs/samba
  </li>
  <li>
  app-antivirus/clamav
  </li>
  <li>
  net-print/cups
  </li>
  <li>
  net-print/foomatic
  </li>
  <li>
  net-print/hpijs (dacă aveţi o imprimantă HP)  
  </li>
  <li>
  Un kernel potrivit (preferabil 2.4.24+ sau 2.6.x)
  </li>
  <li>
  O imprimantă (PS sau non-PS, poate nu CHIAR AŞA DE nouă sau plină de facilităţi)
  </li>
  <li>
    O reţea funcţională (acasa/birou/etc) care conţine mai mult de o maşină
  </li>
</ul>

<p>
Pachetul principal folosit este net+fs/samba, totuşi, aveţi nevoie de un kernel
cu suportul smbfs activat pentru a mount-a o resursă partajată samba sau
windows de pe un alt computer. CUPS va fi instalat, dacă nu există deja.
app-antivirus/clamav va fi utilizat, de asemenea, dar alte aplicaţii ar trebui
să fie adaptate la fel de uşor pentru integrarea cu Samba. Fişierul ebuild
pentru samba din Gentoo suportă toate tipurile de tehnologii pentru scanarea de
viruşi, cum ar fi Sophos, FProt, Fsav, Trend, Icap, Nai, ...
</p>

</body>
</section>
</chapter>

<chapter>
<title>Familiarizarea cu Samba</title>
<section>
<title>Indicatorii USE</title>
<body>

<p>
Înainte de a instala ceva, aruncaţi o privire asupra diverşilor indicatori USE
disponibili pentru Samba.
</p>

<pre caption="Samba foloseşte următoarele valori USE:">
kerberos mysql xml acl cups ldap pam readline python oav libclamav
</pre>

<p>
În funcţie de topologia reţelei şi cerinţelor specifice server-ului,
indicatorii USE prezentaţi mai jos vor defini ce se include sau exclude pentru
instalarea Samba.
</p>

<table>
<tr>
  <th><b>
  Indicator USE
  </b></th>
  <th>
  Descriere
  </th>
</tr>
<tr>
  <th><b>
  kerberos
  </b></th>
  <ti>
    Se include suport pentru kerberos. Serverul va avea nevoie de acesta dacă
    se intenţionează legarea cu un domeniu existent sau Active Directory. 
    Citiţi nota de mai jos pentru mai multe informaţii.
  </ti>
</tr>
<tr>
  <th><b>
  mysql
  </b></th>
  <ti>
    Acesta va permite Samba să folosească MySQL cu scopul de a autentifica
    parolele. Va reţine ACL (Liste Control Acces), numele de utilizatori, 
    parolele, etc. într-o bază de date în locul unui fişier obişnuit. Dacă 
    Samba este necesară pentru efectuarea autentificării parolelor, cum ar fi
    funcţionarea ca un server de validare al parolelor sau un Controler Primar
    de Domeniu (PDC).
  </ti>
</tr>
<tr>
  <th><b>
  xml      
  </b></th>
  <ti>
    Indicatorul USE xml pentru Samba asigură functionarea bazei de date cu parole
    permiţând Samba să stocheze detaliile conturilor în fişiere XML, din aceleaşi 
    considerente ca în cazul indicatorului USE mysql.
   </ti>
</tr>
<tr>
  <th><b>acl</b></th>
  <ti>
    Activează Access Control Lists (Listele Control Acces). Suportul pentru
    aceste liste în Samba foloseşte ext2/ext3 sau sistemul de fişiere XFS al SGI,
    cărora li s-au aplicat patch-uri, în vederea funcţionării corespunzătoare
    pe măsura ce extinde accesul la fişiere şi directoare; deci mult mai mult
    decăt schemele *nix GID/UID tipice. 
  </ti>
</tr>
<tr>
  <th><b>
  cups
  </b></th>
  <ti>
    Acest indicator activează suportul pentru Sistemul de Imprimare Comun din 
    Unix. Acesta oferă o interfaţă permiţând imprimantelor locale CUPS să fie
    partajate altor sisteme din reţea.
  </ti>
</tr>
<tr>
  <th><b>
  ldap
  </b></th>
  <ti>
    Activează Lightweight Directory Access Protocol (LDAP). Dacă se doreşte
    ca Samba să folosească Active Directory, această opţiune trebuie folosită.
    Acest indicator este folosit în cazul în care Samba trebuie să se efectueze 
    sau să ofere suport de login pentru un server Domain/Active Directory.
    Indicatorul USE kerberos este necesar pentru funcţionarea corespunzătoare
    a acestei opţiuni. 
  </ti>
</tr>
<tr>
  <th><b>
  pam
  </b></th>
  <ti>
    Acest indicator USE include suportul pentru modulele de autentificare ataşabile
    (PAM). Acesta oferă capacitatea de a autentifica utilizatorii în server-ul Samba,
    ceea ce este necesar dacă utilizatorii doresc să efectueze login la server.
    Indicatorul USE kerberos este recomandat alături de această opţiune.
  </ti>
</tr>
<tr>
  <th><b>
  readline
  </b></th>
  <ti>
    Leagă Samba de libreadline. Indicatorul este extrem de recomandat şi
    probabil nu trebuie dezactivat.
  </ti>
</tr>
<tr>
  <th><b>
  python
  </b></th>
  <ti>
    Asigură cadrul pentru API-ul Python. Oferă un API ce va permite Python să 
    comunice cu Samba. 
  </ti>
</tr>
<tr>
  <th><b>
  oav
  </b></th>
  <ti>
    Oferă scanare la-acces pentru resursele partajate Samba cu FRISK F-Prot,
    Kaspersky AntiVirus, daemon+ul OpenAntiVirus.org, Sophos Sweep (SAVI),
    Symantec CarrierScan şi Trend Micro (VSAPI).
  </ti>
</tr>
<tr>
  <th><b>libclamav</b></th>
  <ti>
    Activează utilizarea librăriei ClamAV în locul aplicaţiei daemon clamd.
  </ti>
</tr>
</table>

<p>
Căteva lucruri merită menţionate despre indicatorii USE şi diferitele
facilităţi Samba incluse: 
</p>

<ul>
  <li>
    ACL sunt implementate prin atributele extinse (EA). Opţiunile de kernel
    EA şi ACL pentru etx2 şi/sau ext3 vor trebui activate (în funcţie de care
    din sistemele de fişiere va fi folosit - pot fi activate amândouă).
  </li>
  <li>
    Cât funcţiunile Active directory, ACL şi PDC, sunt în afara scopului propus de
    acest ghid, aţi putea găsi aceste adrese de ajutor demersului dvs.: 
    <ul>
      <li><uri>http://www.bluelightning.org/linux/samba_acl_howto/</uri></li>
      <li><uri>http://open-projects.linuxcare.com/research-papers/winbind-08162000.html</uri></li>
      <li><uri>http://www.wlug.org.nz/HowtoSamba3AndActiveDirectory</uri></li>
    </ul>
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Instalarea Software a Server-ului</title>
<section>
<title>
Instalarea Samba
</title>
<body>

<p>
În primul rând: asiguraţi-vă că toate numele-gazdă (hostname) sunt precizate
corect. Fie aveţi un sistem al numelor de domenii funcţional în reţeaua dvs.,
fie nume corespunzătoare în fişierul <path>/etc/hosts</path>. Adesea,
<c>cupsaddsmb</c> nu funcţionează corespunzător dacă numele-gazdă nu indica
maşinile corecte. 
</p>

<p>
Din fericire acum putem face o evaluare a ceea ce aveţi de fapt nevoie pentru a
folosi Samba cu propriile setări. Setările folosite pentru acest ghid sunt: 
</p>

<ul>
  <li>oav</li>
  <li>cups</li>
  <li>readline</li>
  <li>pam</li>
</ul>

<p>
Pentru optimizarea performanţei, mărimii şi timpului de compilare ale
pachetului, indicatorii USE sunt anume incluşi sau excluşi. 
</p>

<pre caption="Instalarea Samba">
# <i>echo "net-fs/samba oav readline cups pam" &gt;&gt; /etc/portage/package.use</i>
# <i>emerge net-fs/samba</i>
</pre>

<note>
Pentru următoarele arhitecturi va trebui adăugat <e>~</e> la <e>KEYWORDS</e>:
x86,ppc, sparc, hppa, ia64 şi alpha 
</note>

<p>
Această comandă va instala Samba şi CUPS (dacă CUPS nu este deja instalat).
</p>

</body>
</section>
<section>
<title>Instalarea ClamAV</title>
<body>

<p>
Deoarece indicatorul USE <e>oav</e> doar oferă o interfată pentru scanarea
antivirus în momentul accesului, un program antivirus trebuie efectiv instalat.
Porgramul folosit în acest ghid este ClamAV.  
</p>

<pre caption="Instalarea clam-av">
# <i>emerge app-antivirus/clamav</i>
</pre>

</body>
</section>
<section>
<title>
Instalarea foomatic
</title>
<body>

<pre caption="Instalarea foomatic">
# <i>emerge net-print/foomatic</i>
</pre>

</body>
</section>
<section>
<title>
Instalarea net-print/hpijs
</title>
<body>

<p>
Următorul pachet trebuie instalat doar dacă folosiţi o imprimantă HP.
</p>

<pre caption="Instalarea hpijs">
# <i>emerge net-print/hpijs</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configurarea Server-ului</title>
<section>
<title>Configurarea Samba</title>
<body>

<p>
Fişierul principal de configurarare al Samba este
<path>/etc/samba/smb.conf</path>. Este împărţit în secţiuni indicate de
[numesectiune]. Comentariile încep fie cu # fie cu ;. Un exemplu
<path>smb.conf</path> este prezentat mai jos, conţinând comentarii şi sugestii
pentru modificări. Dacă sunt necesare mai multe detalii, citiţi pagina de
manual pentru <path>smb.conf</path>, fişierul instalat
<path>smb.conf.example</path>, pagina web Samba sau una din numeroasele cărţi
Samba disponibile.
</p>

<pre caption="A Sample /etc/samba/smb.conf">
[global]
<comment># Înlocuiţi MYWORKGROUPNAME cu numele de workgroup/domeniu al dvs.</comment>
workgroup = <comment>MYWORKGROUPNAME</comment>
<comment># Desigur, acesta nu are alt scop REAL în afara de a spune
# tuturor că nu este Windows !
# %v arată versiunea de Samba pe care o folosim.</comment>
server string = Samba Server %v
<comment># Intenţionăm să folosim cups, deci trebuie să îl indicăm aici ;-)</comment>
printcap name = cups
printing = cups
load printers = yes
<comment># Dorim un fişier log şi nu vrem să fie mai mare de 50kO.</comment>
log file = /var/log/samba/log.%m
max log size = 50
<comment># Vom configura câteva opţiuni pentru interfeţele noastre... </comment>
socket options = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192
<comment># Aceasta este o idee bună, ceea ce vom face este să legăm
# server-ul samba de reţeaua noastră locală.
# Spre exemplu, dacă eth0 este dispozitivul nostru legat de reţeaua locală</comment>
interfaces = lo <i>eth0</i>
bind interfaces only = yes
<comment># Acum vom specifica cui acordăm permisiuni, suntem în cele din urmă
# foarte conştienţi de securitate, cât timp acest fişier de
# configurare nu foloseşte parole!</comment>
hosts allow = 127.0.0.1 <i>192.168.1.0/24</i>
hosts deny = 0.0.0.0/0
<comment># Alte opţiuni în acest caz sunt USER, DOMAIN, ADS şi SERVER
# Implicit este USER</comment>
security = share
<comment># Fără parole, deci vom folosi un cont "guest"!</comment>
guest account = samba
guest ok = yes
<comment># Vom introduce scanarea antivirus la accesare.
# NOTĂ: Adăugând această opţiune în secţiunea [Global], vom activa
# scanarea TUTUROR resurselor partajate, opţional se poate folosi
# această opţiune doar pentru o anumită resursă partajată, 
# pe care doar o vom scana.</comment>

<comment># Pentru Samba 3.x. Activează scanarea la acces cu ClamAV</comment>
vfs object = vscan-clamav
vscan-clamav: config-file = /etc/samba/vscan-clamav.conf

<comment># Vom preciza acum informaţiile necesare legate de driver-ele pentru imprimare!</comment>
[print$]
comment = Printer Drivers
path = /etc/samba/printer <comment># această cale conţine structura driver-ului</comment>
guest ok = yes
browseable = yes
read only = yes
<comment># Modificaţi în "username,root" dacă doriţi ca utilizatorul root
# să nu fie singurul administrator al imprimantei</comment>
write list = <i>root</i>

<comment># Acum vom configura o imprimantă pentru partajare, deşi numele este arbitrar
# ar trebui să fie acelaşi şi pentru Samba şi in CUPS!</comment>
[HPDeskJet930C]
comment = HP DeskJet 930C Network Printer
printable = yes
path = /var/spool/samba
public = yes
guest ok = yes
<comment># Modificaţi în "username,root" dacă doriţi ca utilizatorul root
# să nu fie singurul administrator al imprimantei</comment>
printer admin = <i>root</i>

<comment># Vom partaja acum, imprimantele. Acestea trebuie să poată fi
# navigabile, imprimabile, publice.</comment>
[printers]   
comment = All Printers
browseable = no 
printable = yes   
writable = no
public = yes   
guest ok = yes
path = /var/spool/samba
<comment># Modificaţi în "username,root" dacă doriţi ca utilizatorul root
# să nu fie singurul administrator al imprimantei</comment>
printer admin = <i>root</i>

<comment># Vom crea o nouă resursă partajată pe care o putem citi/scrie de oriunde
# Este un fel de resursă partajată publică, temporară, în care oricine
# poate face ce dori.</comment>
[public]
comment = Public Files
browseable = yes
public = yes
create mode = 0766
guest ok = yes
path = /home/samba/public
</pre>

<warn>
Dacă doriţi să folosiţi contul guest din Samba pentru a face totul, legat de
imprimarea de pe staţiile client Windows: nu folosiţi <c>guest only = yes</c>
în secţiunea <c>[global]</c>. Contul guest se pare că produce probleme când se
rulează uneori <c>cupsaddsmb</c> când se incearcă conectarea de pe maşini
Windows. Citiţi mai jos, de asemenea, unde vom explica despre <c>cupsaddsmb</c>
şi problemele care pot apărea. Utilizaţi un utilizator pentru imprimare
dedicat, cum ar fi <c>printeruser</c>, <c>printer</c> sau <c>printme</c> sau
orice altceva. Nu vă afectează şi vă va proteja cu siguranţă de o mulţime de
probleme.
</warn>

<warn>
Activarea scanării la acces în secţiunea <c>[global]</c> va încetini
performanţele Samba în mod dramatic.
</warn>

<p>
Vom creea directoarele cerute de minima configurare a Samba pentru partajarea
în toată reţeaua a unei imprimante instalate.  
</p>

<pre caption="Crearea directoarelor">
# <i>mkdir /etc/samba/printer</i>
# <i>mkdir /var/spool/samba</i>
# <i>mkdir /home/samba/public</i>
</pre>

<p>
Cel puţin un utilizator Samba este cerut pentru a instala driver-ele
imprimantei şi pentru a permite utilizatorilor să se contecteze la imprimantă.
Utilizatorii trebuie să existe în fişierul <path>/etc/passwd</path> al
sistemului.
</p>

<pre caption="Crearea utilizatorilor">
# <i>smbpasswd -a root</i> 

<comment>(Dacă un alt utilizator va fi admnistratorul imprimantei)</comment>
# <i>smbpasswd -a username</i>
</pre>

<p>
Parolele Samba nu trebuie să fie aceleaşi ca parolele de acces în sistem din
<path>/etc/passwd</path>.
</p>

<p>
Va trebui, de asemenea, să actualizaţi <path>/etc/nsswitch.conf</path> astfel
încât sistemele Windows să fie găsite uşor folosind NetBIOS:
</p>

<pre caption="Editarea /etc/nsswitch.conf">
# <i>nano -w /etc/nsswitch.conf</i>
<comment>(Editaţi hosts: linia)</comment>
hosts: files dns <i>wins</i>
</pre>

</body>
</section>
<section>
<title>Configurarea ClamAV</title>
<body>

<p>
Fişierul de configurare specificat a fi folosit în <path>smb.conf</path> este
<path>/etc/samba/vscan-clamav.conf</path>. Cât timp aceste opţiuni sunt cele
implicite, acţiunea în cazul fişierelor infectate ar trebui să fie schimbată.
</p>

<pre caption="/etc/samba/vscan-clamav.conf">
[samba-vscan]
<comment>; configuraţia run-time pentru vscan-samba folosind
; clamd
; toate opţiunile sunt lăsate pe valorile implicite</comment>

<comment>; nu scanaţi fişiere mai mari decât X octeţi. Dacă este lăsat 0 (implicit),
; această caracteristică este dezactivată (adică toate fişierele sunt scanate)</comment>
max file size = 0

<comment>; realizarea unui log pentru fiecare acces la fişiere (yes/no). Dacă este setat ca
; yes, orice acces va fi înregistrat. Dacă este lăsat pe no (implicit), doar accesul
; la fişierele infectate va fi înregistrat</comment>
verbose file logging = no

<comment>; dacă este lăsat pe yes (implicit), un fişier va fi scanat la deschidere</comment>
scan on open = yes
<comment>; dacă este lăsat pe yes, un fişier va fi scanat la inchidere (yes este implicit)</comment>
scan on close = yes

<comment>; (default: yes)
; dacă comunicarea cu daemon-ul clamd eşuează, ar trebui accesul la fişier interzis?
; (implicit: yes)</comment>
deny access on error = yes

<comment>; dacă daemon-ul nu funcţionează, cu o eroare minoră (corupere, etc.),
; ar trebui accesul la fişier interzis?
; (implicit: yes)</comment>
deny access on minor error = yes

<comment>; se trimite un mesaj de avertizare folosind serviciul Windows Messenger
; când un virus este găsit?
; (implicit: yes)</comment>
send warning message = yes

<comment>; tratarea unui fişier infectat
; quarantine: se încearcă mutarea în directorul de carantină; se va şterge dacă mutarea eşuează
; delete:     ştergerea fişierului infectat
; nothing:    neefectuarea nici unei acţiuni</comment>
infected file action = <comment>delete</comment>

<comment>; unde să se stocheze fişierele infectate - sigur vreţi să modificaţi locaţia!
; trebuie să fie pe acelaşi dispozitiv fizic ca şi resursa partajată!</comment>
quarantine directory  = /tmp
<comment>; prefixul pentru fişierele din carantină</comment>
quarantine prefix = vir-

<comment>; cum Windows încearcă să deschidă un fişier de multe ori într-o perioadă
; scurtă de timp, samba-vscan foloseşte mecanismul ultimului fişier folosit
; pentru a evita multiple scanări ale unui fişier. Această opţiune specifică
; numărul maxim de poziţii ale listei cu ultimele fişiere utilizate recent.
; (implicit:100)</comment>
max lru files entries = 100

<comment>; o înregistrare devine invalidă după o vechime a acesteia în
; lista cu ultimele fişiere utilizate recent (în secunde)</comment>
lru file entry lifetime = 5

<comment>; locaţia şi numele daemon-ului clamd (implicit: /var/run/clamd)</comment>
clamd socket name = /tmp/clamd

<comment>; numărul portului pe care ascultă ScannerDaemon</comment>
oav port = 8127
</pre>

<p>
În general este o bună idee să porniţi scanarea antivirus imediat. Adăugaţi-o
la nivelul de rulare <e>implicit</e> şi apoi porniţi serviciul <c>clamd</c>
imediat. Serviciul are două procese: freshclam menţine baza de date de definiţii actualizată în timp ce clamd este, de fapt, aplicaţia daemon anti-virus. Mai întâi aţi putea să setaţi căile către fişierele de log astfel încât să vă satisfacă preferinţele.
</p>

<pre caption="Verificarea locaţiei fişierelor de log">
# <i>vim /etc/clamd.conf</i>
<comment>(Verificaţi linia "LogFile /var/log/clamd.log")</comment>
# <i>vim /etc/freshclam.conf</i>
<comment>(Verificaţi linia "UpdateLogFile /var/log/freshclam.log")</comment>
# <i>vim /etc/conf.d/clamd</i>
<comment>(Setaţi "START_CLAMD=yes" şi "START_FRESHCLAM=yes")</comment>
</pre>

<p>
Acum, porniţi aplicaţia de scanare de viruşi.
</p>

<pre caption="Adăugaţi clamd la pornire şi pornirea acestuia">
# <i>rc-update add clamd default</i>
# <i>/etc/init.d/clamd start</i>
</pre>

</body>
</section>
<section>
<title>Configurarea CUPS</title>
<body>

<p>
Această parte este un pic mai complicată. Fişierul principal de configurare al
CUPS este <path>/etc/cups/cupsd.conf</path>. Structura sa este similară cu cea
a server-ului Apache <path>httpd.conf</path>, multe elemente le puteţi găsi ca
fiind familiare. În acest exemplu sunt scoase in evidenţă directivele care
trebuiesc modificate:
</p>

<pre caption="/etc/cups/cupsd.conf">
ServerName <i>PrintServer</i>          <comment># numele server-ului dvs. de imprimare</comment>
ServerAdmin <i>root@PrintServer</i>    <comment># relaţii pentru problemele legate de imprimare, adica dvs.</comment> 

AccessLog /var/log/cups/access_log <comment># probabil nu trebuie să modificaţi</comment>
ErrorLog  /var/log/cups/error_log  <comment># nu trebuie neapărat să modificaţi nimic, de asemenea</comment>

LogLevel  debug <comment># doar în perioada instalării şi testării, trebuie schimbat
                # mai târziu cu 'info'</comment>

MaxClients 100 <comment># A trebuit să stabilesc la 1000000000 sau aproape deoarece cu timp în
               # urmă se părea că există un bug în controlul CUPS din interfaţa web,
               # făcând CUPS să considere că un atac denial of service se desfăşura când
               # încercam să configurez o imprimantă prin interfaţa web. ciudat.</comment>

BrowseAddress @IF(<i>eth0</i>) <comment># Schimbaţi cu interfaţa de reţea internă a dvs.</comment>

&lt;Location /&gt;
Order Deny,Allow
Deny From All
Allow From <i>192.168.1.*</i>  <comment># adresele reţelei dvs. interne
                        # ex. 192.168.1 * va permite conexiuni de la orice host în reţeaua 
                        # 192.168.1.0. schimbaţi cu ceea ce vi se potriveşte</comment>

&lt;/Location&gt;

&lt;Location /admin&gt;
AuthType Basic
AuthClass System
Allow From <i>192.168.1.*</i>  <comment># la fel ca înainte, permite oricărui host din
                        # reţeaua 192.168.1.0 să se conecteze şi să ruleze servicii  
                        # administrative după autentificare</comment>

Order Deny,Allow
Deny From All
&lt;/Location&gt;
</pre>

<p>
Modificaţi <path>/etc/cups/mime.convs</path> prin a decomenta unele linii.
Schimbările la <path>mime.convs</path> şi <path>mime.types</path> sunt necesare
pentru a face CUPS să imprime fişiere document Microsoft Office.
</p>

<pre caption="/etc/cups/mime.convs">
<comment>(Linia următoare se găseşte aproape de sfărşitul fişierului. Decomentaţi-o)</comment>
application/octet-stream        application/vnd.cups-raw        0       
</pre>

<p>
Modificaţi <path>/etc/cups/mime.types</path> pentru a decomenta unele linii.
</p>

<pre caption="/etc/cups/mime.types">
<comment>(Linia următoare se găseşte aproape de sfărşitul fişierului. Decomentaţi-o)</comment>
application/octet-stream 
</pre>

<p>
CUPS trebuie să fie pornit la boot, şi pornit imediat. 
</p>

<pre caption="Configurarea serviciului CUPS">
<comment>(Pentru a porni CUPS la boot)</comment>
# <i>rc-update add cupsd default</i>
<comment>(Pentru a porni sau a reporni CUPS, acum)</comment>
# <i>/etc/init.d/cupsd restart</i>
</pre>

</body>
</section>
<section>
<title>Instalarea unei imprimante pentru şi cu CUPS</title>
<body>

<p>
În primul rând, accesaţi <uri
link="http://linuxprinting.org">LinuxPrinting.Org</uri> pentru a găsi şi
descărca fişierul PPD corespunzător imprimantei dvs. şi pentru CUPS. Pentru a
face asta, efectuaţi click pe link-ul Printer Listings din stănga. Selectaţi
producătorul imprimantei dvs. şi modelul în meniul flotant, de exemplu HP şi
DeskJet 930C. Efectuaţi click pe "Show". În pagina ce se va deschide efectuaţi
click pe link-ul "recommended driver" după ce aţi citit diversele note şi
informaţii. Apoi descărcaţi fişierul PPD din pagina următoare, din nou după ce
aţi citit notele şi cunoştiinţele de acolo. Trebuie să selectaţi producătorul
imprimantei şi modelul din nou. Citirea <uri
link="http://www.linuxprinting.org/cups-doc.html">Ghidului rapid CUPS</uri>
este de asemenea de foarte mare ajutor în lucrul cu CUPS.
</p>

<p>
Acum aveţi un fişier PPD pentru imprimanta dvs. care să funcţioneze sub CUPS.
Mutaţi-l în <path>/usr/share/cups/model</path>. Fişierul PPD pentru HP DeskJet
930C se numea <path>HP-DeskJet_930C-hpijs.ppd</path>. Acum ar trebui să
instalaţi imprimanta. Aceasta se poate face fie prin interfaţa web CUPS sau fie
prin linie de comanda. Interfaţa web se gaseşte la
<path>http://PrintServer:631</path> odată ce CUPS rulează.
</p>

<pre caption="Instalarea imprimantei în linia de comandă">
# <i>lpadmin -p HPDeskJet930C -E -v usb:/dev/ultp0 -m HP-DeskJet_930C-hpijs.ppd</i>
# <i>/etc/init.d/cupsd restart</i>
</pre>

<p>
Ţineţi minte să modificaţi la ceea ce aveţi dvs. Asiguraţi-vă că aveţi numele
corect (argumentul <c>-p</c>) (numele introdus în timpul configurării Samba!)
şi că introduceţi corect <c>usb:/dev/usb/blah</c>, <c>parallel:/dev/blah</c>
sau ce dispozitiv utilizaţi pentru imprimantă.
</p>

<p>
Ar trebui acum să fiţi capabili să accesaţi imprimanta din interfaţa web şi să
imprimaţi o pagină test.
</p>

</body>
</section>
<section>
<title>Instalarea driver-elor Windows pentru imprimantă</title>
<body>

<p>
Acum că imprimanta ar trebui să funcţioneze, este timpul să instalăm driver-ele
pentru funcţionarea Clienţilor Windows. Samba 2.2 a introdus această
funcţionalitate. Căutând server-ul de imprimare în Network Neighbourhood,
efectuând click-dreapta pe printershare şi selectând "connect" se vor descărca
automatic driver-ele corespunzătoare pentru clientul care se conectează,
evitând problemele prilejuite de instalarea locală a driver-elor imprimantei. 
</p>

<p>
Există două seturi de driver-e de imprimantă pentru aceasta. În primul rănd,
driver-ele Adobe PS ce pot fi obţinute de la <uri
link="http://www.adobe.com/support/downloads/main.html">Adobe</uri> (driver-ele
de imprimantă PostScript). În al doilea rând, sunt driver-ele de imprimantă
CUPS, care se pot obţine de pe <uri
link="http://www.cups.org/software.php">pagina CUPS</uri> şi selectând "CUPS
Driver for Windows" din meniul flotant. Se pare că nu există vreo diferenţă în
ceea ce priveşte funcţionalitatea celor două, dar driver-ele Adobe PS trebuiesc
despachetate pe un sistem Windows pentru că sunt binare Windows. De asemenea,
întreaga procedură de găsire şi copiere a driver-elor corecte este un pic mai
mult problematică. Driver-ele CUPS se pare că suportă unele opţiuni nesuportate
de driver-ele Adobe PS.
</p>

<p>
Acest ghid foloseşte driver-ele CUPS pentru Windows. Fişierul descărcat se
numeşte <path>cups-samba-5.0rc2.tar.gz</path>. Despachetaţi fişierele conţinute
într-un director.
</p>

<pre caption="Despachetaţi driver-ele şi rulaţi procesul de instalare">
# <i>tar -xzf cups-samba-5.0rc2.tar.gz</i>
# <i>cd cups-samba-5.0rc2</i>
<comment>(Folosiţi acest script doar dacă CUPS se găseşte în /usr/share/cups)</comment>
# <i>./cups-samba.install</i>
</pre>

<p>
<path>cups-samba.ss</path> este o arhivă TAR conţinând trei fişiere:
<path>cups5.hlp</path>, <path>cupsdrvr5.dll</path> şi <path>cupsui5.dll</path>.
Acestea sunt de fapt fişierele driver.
</p>

<warn>
Script-ul <c>cups-samba.install</c> ar putea să nu funcţioneze pentru toate
*nix-urile (ex. FreeBSD) deoarece aproape tot ce nu este parte a sistemului de
bază este instalat undeva sub prefixul <path>/usr/local/</path>. Acesta se pare
că nu este cazul pentru multe programe pe care le-aţi instalat sub GNU/Linux.
Totuşi, dacă instalarea dvs. CUPS este în alt loc decât
<path>/usr/share/cups/</path> consultaţi exemplul de mai jos.
</warn>

<p>
Presupunând că instalarea dvs. CUPS se găseşte sub
<path>/usr/local/share/cups/</path>, şi doriţi să instalaţi driver-ele acolo.
Faceţi cum urmează:
</p>

<pre caption="Instalare manuală a driver-elor">
# <i>cd /path/you/extracted/the/CUPS-driver/tarball/into</i>
# <i>tar -xf cups-samba.ss</i>
<comment>(Această comandă despachetează fişierele în usr/share/cups/drivers din DIRECTORUL DE LUCRU CURENT)</comment>
# <i>cd usr/share/cups/drivers</i>
<comment>(fără / la început!)</comment>
# <i>cp cups* /usr/local/share/cups/drivers</i>
# <i>/etc/init.d/cupsd restart</i>
</pre>

<p>
Acum vom folosi script-ul <c>cupsaddsmb</c> conţinut de distribuţia CUPS.
Pagina man a acestui script este o lectură interesantă.
</p>

<pre caption="Rularea cupsaddsmb">
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -v HPDeskJet930C</i>
<comment>(În locul HPDeskJet930C puteţi specifica "-a", care va
"exporta toate imprimantele cunoscute".)</comment>
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -a</i>
</pre>

<warn>
Rularea acestei comenzi cauzează adesea cele mai multe probleme. Citiţi
mesajele din <uri link="http://forums.gentoo.org/viewtopic.php?t=110931">aceast
subiect</uri>.
</warn>

<p>
Erori obişnuite ce pot apare:
</p>

<ul>
  <li>
    Numele host-ului dat ca parametru pentru <c>-h</c> şi <c>-H</c>
    (<c>PrintServer</c>) adesea nu este introdus corect şi nu identifică server-ul
    de imprimare pentru interacţiunea CUPS/Samba. Dacă o eroare ca: <b>Warning: No 
    PPD file for printer "CUPS_PRINTER_NAME" - skipping!</b> apare, primul lucru 
    pe care ar trebui să îl faceţi este să înlocuiţi <c>PrintServer</c> cu
    <c>localhost</c> şi să încercaţi din nou.
   </li>
  <li>
    Comanda eşuează cu <b>NT_STATUS_UNSUCCESSFUL</b>. Acest mesaj de eroare este destul
    de obişnuit, dar poate fi declanşat de multe probleme. Din nefericire nu este de 
    foarte mare ajutor. Un lucru de încercat este stabilirea temporară a <c>security = 
    user</c> în <path>smb.conf</path>. După/dacă instalarea se încheie cu succes,
    ar trebui modificat imediat în share, sau orice era prevăzut înainte.
  </li>
</ul>

<p>
Acesta ar trebui să instaleze corect structura de directoare a driver-ului sub
<path>/etc/samba/printer</path>. Aceasta ar fi
<path>/etc/samba/printer/W32X86/2/</path>. Fişierele conţinute ar trebui să fie
cele 3 fişiere driver şi fişierul PPD, redenumit în NumeleImprimanteiDvs.ppd
(numele pe care l-aţi dat imprimantei în momentul instalării - vedeţi anterior)
</p>

<p>
Neaparând nici o eroare sau altă complicaţie, driver-ele dvs. sunt acum
instalate.
</p>

</body>
</section>
<section>
<title>Finalizarea instalării</title>
<body>

<p>
Lastly, setup our directories.
Ultimele sunt configurate directoarele.
</p>

<pre caption="Schimbări finale necesare">
# <i>mkdir /home/samba</i>
# <i>mkdir /home/samba/public</i>
# <i>chmod 755 /home/samba</i>
# <i>chmod 755 /home/samba/public</i>
</pre>

</body>
</section>
<section>
<title>Testarea configuraţiei noastre Samba</title>
<body>

<p>
We will want to test our configuration file to ensure that it is formatted
properly and all of our options have at least the correct syntax.  To do this
we run <c>testparm</c>.  Vom dori să testăm fişierele noastre de configurare
pentru a ne asigura că sunt alcătuite corespunzător şi toate opţiunile noastre
nau măcar sintaxa corectă. Pentru a face aceasta vom rula <c>testparm</c>.
</p>

<pre caption="Rularea testparm">
<comment>(Implicit, testparm verifică /etc/samba/smb.conf)</comment>
# <i>/usr/bin/testparm</i>
Load smb config files from /etc/samba/smb.conf
Processing section &quot;[printers]&quot;
Global parameter guest account found in service section!
Processing section &quot;[public]&quot;
Global parameter guest account found in service section!
Loaded services file OK.
Server role: ROLE_STANDALONE
Press enter to see a dump of your service definitions
 ...
 ...
</pre>

</body>
</section>
<section>
<title>Pornirea serviciului Samba</title>
<body>

<p>
Acum vom configura Samba să pornească la boot-are; apoi, continuăm şi o pornim. 
</p>

<pre caption="Configurarea serviciului Samba">
# <i>rc-update add samba default</i>
# <i>/etc/init.d/samba start</i>
</pre>

</body>
</section>
<section>
<title>Verificarea serviciilor noastre</title>
<body>

<p>
Este probabil prudent să verificăm în acest moment şi log-urile. Vom dori, de
asemenea, să aruncăm o privire asupra resurselor partajate Samba, folosind
<c>smbclient</c>.
</p>

<pre caption="Verificarea resurselor partajate cu smbclient">
# <i>smbclient -L localhost</i>
Password:
<comment>(Ar trebui să vedeţi o listă MARE de servicii aici.)</comment>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configurarea Clienţilor</title>
<section>
<title>Configurarea imprimantei pentru clienţii bazaţi pe *nix</title>
<body>

<p>
În ciuda variaţiilor sau distribuţiilor, singurul lucru cerut este CUPS. Faceţi
acelaşi lucru pe oricare alt client UNIX/Linux/BSD.  
</p>

<pre caption="Configurarea unui sistem Gentoo">
# <i>emerge cups</i>
# <i>nano -w /etc/cups/client.conf</i>
ServerName <i>PrintServer</i>      <comment># numele server-ului dvs. de imprimare</comment>
</pre>

<p>
Asta ar trebui să fie. Nimic altceva nu este cerut.
</p>

<p>
Dacă folosiţi doar o imprimantă, va fi imprimanta dvs. implicită. Dacă
server-ul dvs. de imprimare serveşte mai multe imprimante, administratorul dvs.
trebuie să definească o imprimantă implicită pentru server. Dacă doriţi să
definiţi o imprimantă implicită diferită pentru dvs., folosiţi comanda
<c>lpoptions</c>.
</p>

<pre caption="Stabilirea imprimantei dvs. implicite">
<comment>(Lista imprimantelor disponibile)</comment>
# <i>lpstat -a</i>
<comment>(Exemplu de rezultat, al dvs. va fi diferit)</comment>
HPDeskJet930C accepting requests since Jan 01 00:00
laser accepting requests since Jan 01 00:00
<comment>(Definiţi HPDeskJet930C ca imprimanta dvs. implicită)</comment>
# <i>lpoptions -d HPDeskJet930C</i>
</pre>

<pre caption="Imprimarea în *nix">
<comment>(Specificaţi imprimanta ce va fi folosită)</comment>
# <i>lp -d HPDeskJet930C anything.txt</i>
<comment>(Folosiţi imprimanta dvs. implicită)</comment>
# <i>lp foobar.whatever.ps</i>
</pre>

<p>
Direcţionaţi browser-ul web către <c>http://printserver:631</c> la client, dacă
doriţi să administraţi imprimantele dvs. şi sarcinile lor printr-o frumoasă
interfaţă web. Înlocuiţi <c>printserver</c> cu numele <e>machine</e> ce
acţionează ca server-ul dvs. de imprimare, nu cu numele pe care l-aţi dat
server-ului de imprimare cups, dacă folosiţi nume diferite.
</p>

</body>
</section>
<section>
<title>Mount-area unei resurse partajate Windows sau Samba în GNU/Linux</title>
<body>

<p>
Acum este timpul să configurăm kernel-ul pentru a suporta smbfs. Considerând că
toţi am compilat cel puţin un kernel, va trebui să fim siguri că avem toate
opţiunile corespunzătoare selectate în kernel-ul nostru. Pentru simplicitate,
compilaţi-l ca modul, pentru a uşura utilizarea. Părerea autorului este că
modulele de kernel reprezintă un lucru bun şi ar trebui utilizate oricând este
posibil.
</p>

<pre caption="Optiunile relevante în kernel">
CONFIG_SMB_FS=m
CONFIG_SMB_UNIX=y
</pre>

<p>
Apoi compilaţi/instalaţi modulele; le inseraţi cu:
</p>

<pre caption="Încărcarea modulelor din kernel">
# <i>modprobe smbfs</i>
</pre>

<p>
Odată ce modulele sunt incărcate, mount-area unei resurse partajate Windows sau
Samba este acum posibilă. Utilizaţi <c>mount</c> pentru această operaţie, aşa
cum este detaliat mai jos:
</p>

<pre caption="Montarea unei resurse partajate Windows/Samba">
<comment>(Sintaxa comenzii de mount-are a unei resurse partajate Windows/Samba este:
  mount -t smbfs [-o username=xxx,password=xxx]) //server/resursă  /mnt/punct montare
Dacă nu utilizaţi parole sau nu este necesară introducerea parolei)</comment>

# <i>mount -t smbfs //PrintServer/public /mnt/public</i>

<comment>(Dacă este necesară o parolă)</comment>
# <i>mount -t smbfs -o username=USERNAME,password=PASSWORD //PrintServer/public /mnt/public</i>
</pre>

<p>
După mount-area resursei partajate, o puteţi accesa ca şi cum ar fi locală.
</p>

</body>
</section>
<section>
<title>
Configurarea Imprimantei pentru Clienţii Windows NT/2000/XP
</title>
<body>

<p>
Este o operaţie mai mult din categoria "point-and-click". Accesaţi
<path>\\PrintServer</path> şi efectuaţi click dreapta pe imprimantă
(HPDeskJet930C); efectuaţi click pe connect. Astfel, se vor descărca driver-ele
pentru clientul Windows şi acum fiecare aplicaţie (cum ar fi Word sau Acrobat)
vor dispune de HPDeskJet930C ca imprimană disponibilă, cu care puteţi imprima.
:-)
</p>

</body>
</section>
</chapter>

<chapter>
<title>Note Finale</title>
<section>
<title>În loc de bun rămas</title>
<body>

<p>
Ei bine, asta ar trebui să fie totul. Acum ar trebui să imprimaţi cu succes,
într-un mediu prietenos atât pentru Windows cât şi *nix, precum şi cu resurse
partajate funcţionabile şi nevirusate!
</p>

</body>
</section>
</chapter>

<chapter>
<title>Adrese şi Resurse</title>
<section>
<title>Adrese</title>
<body>

<p>
Acestea sunt câteva adrese care ar putea să vă ajute în instalarea,
configurarea şi rezolvarea problemelor instalării dvs.:
</p>

<ul>
  <li><uri link="http://www.cups.org/">Pagina Oficială CUPS</uri></li>
  <li><uri link="http://www.samba.org/">Pagina Oficială Samba</uri></li>
  <li><uri link="http://linuxprinting.org/">LinuxPrinting punct Org</uri></li>
  <li>
    <uri link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/">
    Ghidul de imprimare din Samba al lui Kurt Pfeifle</uri>
    (Acest HOWTO acoperă cu adevărat <e>ORICE</e> şi <e>TOTUL</e>, 
    plus MULT MAI MULTE lucruri legate de CUPS şi Samba, şi în general 
    suportul pentru imprimare în reţele. O foarte interesantă lectură, 
    cu multe, multe detalii)
  </li>
  <li><uri link="http://www.freebsddiary.org/cups.php">Topicul CUPS din Jurnalul FreeBSD</uri></li>
</ul>

</body>
</section>
<section>
<title>Rezolvarea Problemelor</title>
<body>

<p>
Citiţi <uri
link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/Samba-HOWTO-Collection-3.0-PrintingChapter-11th-draft.html#37">această
pagină </uri> din manualul lui Kurt Pfeifle "Printing Support in Samba 3.0".
Foarte multe sfaturi folositoare acolo! Asiguraţi-vă că veţi căuta în acesta
mai întâi, înainte de a pune întrebări şi prezenta probleme! Poate că soluţia
pe care o căutaţi se află chiar acolo.
</p>

</body>
</section>
</chapter>
</guide>
