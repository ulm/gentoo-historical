<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ro/alsa-guide.xml,v 1.6 2005/05/09 16:19:40 alin Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/ro/alsa-guide.xml" lang="ro">
<title>Ghid ALSA pentru Gentoo Linux</title>
<author title="Autor">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Autor">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Autor">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Autor">
  <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Editor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Translator Iniţial">
  <mail link="diaboliq@petar.ro">Ciortea Cristian</mail>
</author>
<author title="Translator">
  <mail link="alin@gentoo.org">Alin Dobre</mail>
</author>

<abstract>
Acest ghid vă va indica modul de setare a Advanced Linux Sound Architecture
(ALSA) (Arhitectura Avansată de Sunet în Linux) în Gentoo Linux. În completarea
Ghidului de Configurare pentru Desktop în Gentoo Linux, acest ghid trebuie să
vă ofere mai multe informaţii legate de acest subiect.
</abstract>

<license/>

<version>1.5.12</version>
<date>2005-04-24</date>

<chapter>
<title>Sistemul Advanced Linux Sound Architecture</title>
<section>
<title>Ce este ALSA?</title>
<body>

<p>
ALSA este <e>Advanced Linux Sound Architecture</e> (Arhitectura Avansată de
Sunet în Linux), un proiect dedicat dezvoltării unui subsistem de sunet de
înaltă fidelitate în Linux. Acesta a înlocuit OSS (<e>Open Sound System</e> -
Sistemul Deschis pentru Sunet) ca subsistem de sunet implicit în seriile de
kernel 2.6.
</p>

<p>
ALSA oferă un suport eficient pentru toate tipurile de interfeţe audio, este
modularizat în totalitate, poate funcţiona în sistemele SMP şi este thread-safe
(nota trad.: alocă eficient şi sigur resursele între thread-uri) şi oferă o
bibliotecă, denumită <e>alsa-lib</e>, pentru spaţiul-utilizator, de înaltă
calitate pentru a simplifica programarea aplicaţiilor. De asememea, oferă un
nivel de compatibilitate precedentă cu OSS.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Instalarea ALSA</title>
<section>
<title>Indicatori USE</title>
<body>

<p>
Gentoo oferă un indicator USE <c>alsa</c> pe care ar trebui să-l setaţi în
<path>/etc/make.conf</path> pentru a permite aplicaţiilor noastre disponibile
să se compileze cu suport ALSA. Dacă aveţi şi <c>oss</c> în variabila dvs. USE,
ALSA se va compila cu suport de compatibilitate anterioara cu OSS.
</p>

</body>
</section>
<section>
<title>Module de Kernel</title>
<body>

<p>
Mai întâi, înainte de a continua, asiguraţi-vă că kernel-ul dvs. are activat
<e>Sound Card Support</e>. Dacă aţi utilizat <c>genkernel</c> pentru a vă
configura kernel-ul, atunci aceasta este activată automat. Altfel,
reconfiguraţi-vă kernel-ul. În plus, asiguraţi-vă că dezactivaţi <e>Open Sound
System</e> în configuraţi dvs. de kernel. Dacă nu aţi dezactivat-o, sistemul
dvs. va încerca să utilizeze aceste driver-e în locul celor alsa. Dacă
observaţi un mesaj despre 'sound card not detected' (nota trad.: placa de sunet
nu a fost detectată) şi sunteţi sigur că aveţi driver-ul corect, atunci acesta
este, probabil, motivul.
</p>

<warn>
Dacă utilizaţi un kernel 2.6, puteţi utiliza driver-ele oferite de kernel, dar
noi tot recomandăm să utilizaţi media-sound/alsa-driver, deoarece acestea sunt
mult mai actualizate decât cele oferite în structura kernel-ului. Dacă totuşi,
doriţi să utilizaţi driver-ele oferite în kernel, puteţi omite restul acestei
secţiuni, şi să continuaţi cu <uri link="#alsa-utils">Instalarea Utilitarelor
ALSA</uri>.
</warn>

<p>
Primul pas în instalarea driver-elor dvs. pentru sunet, este determinarea
modelului plăcii dvs. Dacă nu ştiţi deja acest lucru, un truc uşor este să
căutaţi cuvântul "audio" în textul afişat de comanda <c>lspci</c>. Puteţi
instala acest utilitar cu <c>emerge pciutils</c>.
</p>

<pre caption="Aflarea tipului de placă de sunet">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
Acum, vizitaţi <uri link="http://www.alsa-project.org/alsa-doc">Matricea
Plăcilor de Sunet ALSA</uri> şi căutaţi-vă placa de sunet. În exemplul de mai
sus ar trebui să navigaţi la producătorul "VIA". Vi se va expune un tabel cu
chipset-urile cunoscute ale acestui producător. Chipset-ul din exemplul de mai
sus este "via82c686"; Link-ul "Details" ne informează, apoi, că driver-ul se
numeşte <path>via82xx</path>. Aceasta este toată informaţia necesară, şi puteţi
să omiteţi în siguranţă restul acelui document.
</p>

<p>
Pe baza acestei informaţii, putem acum instala <c>alsa-driver</c> pentru placa
noastră de sunet. Mai întâi, editaţi <path>/etc/make.conf</path> şi
<e>adăugaţi</e> o nouă opţiune denumită ALSA_CARDS. În interiorul acestei
variabile declaraţi driver-ul plăcii de sunet pe care doriţi să-l utilizaţi:
</p>

<pre caption="Editarea /etc/make.conf pentru ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<warn>
Dacă aveţi mai multe plăci de sunet în sistemul dvs., separaţi-le cu o virgulă
în variabila ALSA_CARDS. Ex: ALSA_CARDS="via82xx,emu10k1"
</warn>

<p>
Dacă doriţi compatibilitate cu OSS (foarte recomandat), ar trebui să adăugaţi
'oss' indicatorilor USE din <path>/etc/make.conf</path>. După aceasta, sunteţi
gata să instalaţi <c>alsa-driver</c>:
</p>

<pre caption="Instalarea Modulelor ALSA">
# <i>emerge alsa-driver</i>
</pre>

<impo>
De câte ori (re)compilaţi sursele dvs. de kernel, există şanse ca modulele ALSA
să fie şterse. Este, deci, recomandat să rulaţi din nou <c>emerge
alsa-driver</c> de câte ori (re)compilaţi kernel-ul. Notaţi faptul că aceasta
va compila modulele pentru kernel în /usr/src/linux, NU în kernel-ul care
rulează.
</impo>

</body>
</section>
<section id="alsa-utils">
<title>Instalarea Utilitarelor ALSA</title>
<body>

<p>
Dacă compatibilitatea OSS din kernel nu este suficientă pentru nevoile dvs., va
trebui să instalaţi <c>alsa-oss</c>. Acesta vă va oferi executabilul 'aoss' ce
poate fi utilizat, ca în demonstraţia următoare:
</p>

<pre caption="Mai multă compatibilitate OSS">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
Acum, instalaţi Utilitarele ALSA pe sistemul dvs. (acest pas este obligatoriu):
</p>

<pre caption="Instalarea Utilitarelor ALSA">
# <i>emerge alsa-utils</i>
</pre>

<p>
Acum, că utilitarele sunt instalate, este timpul să configurăm ALSA...
</p>

</body>
</section>
</chapter>
<chapter>
<title>Configurarea ALSA</title>
<section>
<title>Încărcarea Automată a Modulelor de Kernel</title>
<body>

<p>
Dacă utilizaţi un kernel modular (ca atunci când utilizaţi <c>genkernel</c>)
trebuie să editaţi <path>/etc/modules.d/alsa</path> pentru a activa modulele
necesare la boot. Pentru placa de sunet din exemplul nostru:
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># Următoarele linii sunt necesare doar când doriţi compatibilitate OSS</comment>
alias sound-slot-0 snd-via82xx
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Acum, rulaţi <c>modules-update</c> pentru a salva modificările efectuate în
fişierul <path>alsa</path> din <path>/etc/modules.conf</path>:
</p>

<pre caption="Rularea modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>Verificarea Fişierelor Dispozitiv</title>
<body>

<p>
Aceasta ar trebui să se efectueze automat pentru instalările recente, dar, dacă
apar probleme, verificaţi dacă dispozitivele ALSA şi permisiunile sunt setate
corect de către aplicaţia manager pentru /dev. Dacă utilizaţi DevFS, verificaţi
<path>/etc/devfsd.conf</path>.
</p>

<pre caption="/etc/devfsd.conf">
# Intrări ALSA/OSS
# Comentaţi/modificaţi aceaste linii dacă doriţi să schimbaţi permisiunile
# pe fişierele dispozitiv audio
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>Activarea ALSA la Boot</title>
<body>

<p>
Pentru a activa suportul ALSA la boot, adăugaţi script-ul de iniţializare
<c>alsasound</c> în nivelul de iniţializare boot:
</p>

<pre caption="Adăugarea alsasound în nivelul de iniţializare boot">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>Activarea Sunetului pe Canale</title>
<body>

<p>
Implicit, toate canalele de sunet au volumul dezactivat. Pentru a rezolva
această problemă, rulaţi <c>amixer</c>:
</p>

<pre caption="Rularea amixer">
# <i>amixer</i>
</pre>

<p>
Dacă <c>amixer</c> produce mult text afişat, atunci sunteţi gata să activaţi
volumul pentru canale. Dacă primiţi vreo eroare, verificaţi încă o dată faptul
că modulul plăcii dvs. de sunet este încărcat.
</p>

<p>
Acum, activaţi canalele <e>Master</e> şi <e>PCM</e>. Dacă aceasta nu este
suficient, activaţi, de asemenea, canalele <e>Center</e> şi <e>Surround</e>. Nu
dezactivaţi canalele pentru care nu puteţi modifica volumul; aceasta poate, de
fapt, să aibă ca rezultat neproducerea nici unui sunet de către ALSA...
</p>

<pre caption="Activarea canalelor de sunet">
<comment>(Dacă perferaţi o metodă ncurses:)</comment>

# <i>alsamixer</i>

<comment>(sau)</comment>

# <i>amixer set Master 100% unmute</i>
# <i>amixer set PCM 100% unmute</i>
<comment>(Doar dacă comenzile de mai sus nu sunt suficiente:)</comment>
# <i>amixer set Center 100% unmute</i>
# <i>amixer set Surround 100% unmute</i>
# <i>amixer set Headphone 100% unmute</i>
</pre>


<p>
Pentru a verifica dacă placa dvs. de sunet funcţionează, rulaţi un fişier wave
(utilizând <c>aplay</c>), mp3 (utilizând <c>mpg123</c> sau chiar
<c>mplayer</c>) sau orice alt fişier de sunet.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Activarea Suportului MIDI</title>
<section>
<title>Instalarea Pachetelor Necesare</title>
<body>

<p>
Unele plăci de sunet sunt distribuite cu sintetizatoare MIDI integrate. Pentru
a le utiliza, trebuie, mai întâi, să instalaţi pachetul <c>awesfx</c>:
</p>

<pre caption="Instalarea pachetului awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Dacă aveţi o colecţie de fonturi de sunet într-o locaţie, stocaţi-le în
<path>/usr/share/sfbank</path>. Spre exemplu, SBLive deţine un fişier de font
de sunet denumit <path>8MBGMSFX.SF2</path> sau <path>CT4GMSFX.SF2</path>.
</p>

<p>
După copierea fişierul de font de sunet, selectaţi-l utilizând <c>asfxload</c>:
</p>

<pre caption="Încărcarea fontului de sunet">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Trebuie să rulaţi această comandă la fiecare proces de boot, deci este
recomandată adăugarea acestuia în <path>/etc/conf.d/local.start</path>, de
asemenea.
</p>

<p>
Dacă nu găsiţi fonturi de sunet pe mediul CD cu driver-e, puteţi descărca unele
online de la <uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>.
</p>

</body>
</section>
<section>
<title>Sintetizatorul Virtual Timidity++</title>
<body>

<p>
Dacă placa dvs. de sunet nu deţine un sinetizator integrat (sau dacă nu doriţi
să-l utilizaţi), puteţi folosi <c>timidity++</c> pentru a avea un sintetizator
virtual. Începeţi prin a instala acest pachet:
</p>

<pre caption="Instalarea Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Pentru ca timidity să poată rula sunete, are nevoie de un font de sunet. Dacă
nu aveţi nici unul, instalaţi <c>timidity-eawpatches</c> sau
<c>timidity-shompatches</c> ce vă vor oferi câteva fonturi. Puteţi avea
multiple configuraţii de fonturi de sunet instalate, şi vi le puteţi stoca pe
cele proprii în <path>/usr/share/timidity/</path>. Pentru a comuta între
diverse configurări timidity, ar trebui să utilizaţi utilitarul
<e>timidity-update</e> oferit în pachetul timidity++.
</p>

<pre caption="Instalarea fonturilor de sunet">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(sau)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Nu uitaţi să adăugaţi <c>timidity</c> nivelului de iniţializare default.
</p>

<pre caption="Adăugarea timidity nivelului de iniţializare default">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>Testarea Suportului MIDI</title>
<body>

<p>
Puteţi utiliza <c>aplaymidi</c> din pachetul ALSA Utils pentru a vă testa
configuraţia MIDI.
</p>

<p>
Pentru a vedea ce porturi de ieşire MIDI sunt disponibile pe sistemul dvs.,
utilizaţi opţiunea <c>-l</c>:
</p>

<pre caption="Vizualizarea porturilor de ieşire MIDI">
# <i>aplaymidi -l</i>
</pre>

<p>
Dacă totul arată bine, încercaţi să rulaţi un fişier MIDI pentru a vă asigura
că totul funcţionează corect. Cu ajutorul opţiunii <c>-p</c>, puteţi defini ce
port MIDI doriţi să utilizaţi.
</p>

<pre caption="Rularea unui fişier MIDI">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith' Theme.mid"</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Remarci Finale</title>
<section>
<title>Utilitare şi Suport Firmware</title>
<body>

<p>
Anumite plăci de sunet pot beneficia de anumite utilitare oferite de către
pachetele <c>alsa-tools</c> şi <c>alsa-firmware</c>. Dacă aveţi nevoie de
<c>alsa-tools</c>, asiguraţi-vă că definiţi variabila ALSA_TOOLS în
<path>/etc/make.conf</path> cu utilitarele de care aveţi nevoie. Spre exemplu:
</p>

<pre caption="Selectarea Utilitarelor ALSA în /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Apoi, instalaţi pachetul(ele) <c>alsa-tools</c> (şi/sau <c>alsa-firmware</c>):
</p>

<pre caption="Instalarea ALSA Tools">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Activarea Suportului pentru Joystick</title>
<body>

<p>
Dacă placa dvs. de sunet deţine o mufă pentru joystick, aţi putea fi interesaţi
în activarea suportului pentru joystick pentru placa dvs. de sunet. În acest
caz, începeţi prin verificarea dacă modulul plăcii dvs. de sunet are un
parametru joystick. Puteţi verifica acest lucru prin rularea <c>modinfo</c>
pentru modulul dvs. de kernel. Spre exemplu, pentru <c>snd-via82xx</c>:
</p>

<pre caption="Rularea modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Dacă are parametrul <c>joystick</c>, adăugaţi <c>joystick=1</c> pe linia
<c>options</c> din <path>/etc/modules.d/alsa</path>. Spre exemplu:
</p>

<pre caption="Adăugarea parametrului joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>Resurse</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">Proiectul ALSA</uri></li>
  <li><uri link="http://www.djcj.org">Ghiduri şi Întrebări Frecvente despre ALSA</uri></li>
  <li><uri link="http://linux-sound.org">Aplicatii Linux pentru Sunet/MIDI</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
