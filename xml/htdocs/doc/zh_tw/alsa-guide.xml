<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/zh_tw/alsa-guide.xml,v 1.8 2004/12/21 01:06:51 ccpz Exp $ -->
<!-- rev 1.47 by ccpz -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="alsa-guide.xml" lang="zh_tw">

<title>Gentoo Linux ALSA 指南</title>
<author title="Author">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Author">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Author">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Author">
  <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Editor"><!-- zhen@gentoo.org -->
	John P. Davis
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Editor,Translator,Reviewer">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Translator">
  <mail link="palatis@gentoo.org.tw">【Palatis】</mail>
</author>

<abstract>
這篇文章教您怎樣在 Gentoo Linux 上設定 Advanced Linux Sound Architecture (進
階 Linux 音效架構)。給讀過 Gentoo Linux 桌面系統設定指南的讀者，希望這篇指
南能給您有關 ALSA 的進一步資訊。
</abstract>

<license/>

<version>1.5.9</version>
<date>2004-12-09</date>

<chapter>
<title>介紹</title>
<section>
<title>什麼是 ALSA？</title>
<body>

<p>
ALSA (<e>Advanced Linux Sound Architecture</e> - 進階 Linux 音效架構) 是個透
過重寫程式碼來增進 Linux 音效子系統的計畫。在 2.6 核心中，取代了 OSS（<e>Open
Sound System</e>）的地位成為預設的音效子系統。
</p>

<p>
ALSA 有效率地支援幾乎所有的音效介面。他擁有完整的模組化設計、多處理器以及執行
緒安全性支援、更提供了一個高品質的使用者函式庫以檢化成是設計。它同時還提供
與舊式音效系統 - OSS 的向下相容性。
</p>

</body>
</section>
</chapter>
<chapter>
<title>安裝 ALSA</title>
<section>
<title>USE 參數</title>
<body>

<p>
您應該將 Gentoo 提供的 <c>alsa</c> USE 參數加入至您 <path>/etc/make.conf</path>
讓我們提供的套件於編譯時加入對 ALSA 支援。如果您也有將 <c>oss</c> 放至您的
USE 參數中，ALSA 瓜會提供 OSS 模擬。
</p>

</body>
</section>
<section>
<title>核心模組</title>
<body>

<p>
首先，在您繼續之前，請確定您的核心有啟動 <e>Sound Card Support</e> 選項。如果
您使用 <c>genkernel</c> 幫助您編譯核心，那麼這個選項會自動開啟。否則，請重
新設定您的核心。此外，確定關閉核心設定中的 <e>Open Sound System</e>。如果沒有關
閉的話，系統會先嘗試使用他而不是 alsa。假如你看到 'sound card not detected' 的
錯誤訊息而你確定選了正確的驅動程式，可能就是因為你沒關閉他。
</p>

<warn>
如果你是使用 2.6 版核心，你可能會享用核心內附的驅動程式，但是因為
media-sound/alsa-driver 比核心內的還要新，我們仍然建議你使用
media-sound/alsa-driver。假如你仍然想要使用核心內的驅動程式，你可以跳過接下來的
部份繼續閱讀 <uri link="#alsa-utils">安裝 ALSA 工具</uri>。
</warn>

<p>
安裝驅動程式第一步就是找出你用那張音效卡。如果你還不知道的話，有一個技巧是搜尋
<c>lspci</c> 輸出中的 "audio"。你可以用 <c>emerge pciutils</c> 安裝這個工具。
</p>

<pre caption="辨認音效卡型號">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio 
Controller (rev 64).
</pre>

<p>
然後至 <uri link="http://www.alsa-project.org/alsa-doc">ALSA Soundcard Matrix
</uri> 並搜尋您的音效卡。在上面的例子中，您應該找 "VIA" 製造商，尋找已知晶片
清單。上例中的晶片是 "via82c686"；"Details" 連結中告訴我這個晶片驅動程式叫
做 <path>via82xx</path>。這就是你所需要的全部資訊，你可以掠過那份文件其他部
分。
</p>

<p>
有了這些資訊，我們現在可以為音效卡安裝 <c>alsa-driver</c> 了！首先編輯
<path>/etc/make.conf</path> 並<e>新增</e>一個新的選項 - "ALSA_CARDS"。於這個
變數中指派您想使用的音效卡驅動程式：
</p>

<pre caption="編輯 /etc/make.conf 並加入 ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<warn>
如果系統上有多個音效卡，在 ALSA_CARDS 變數中使用 , 分隔，如：
ALSA_CARDS="via82xx,emu10k1"
</warn>

<p>
如果你要支援 OSS (非常建議這麼做)，你要在 <path>/etc/make.conf</path> 中的 USE
設定加上 'oss'。接下來就可以安裝 <c>alsa-driver</c>：
</p>

<pre caption="安裝 ALSA 驅動程式">
# <i>emerge alsa-driver</i>
</pre>

<impo>
當您（重新）編譯並安裝核心時，ALSA 驅動程式有可能會被刪除。這表示，當您以後重
新編譯核心的時候，必須重新執行 <c>emerge alsa-driver</c>。要注意的是這會編譯適
合 /usr/src/linux 中核心的驅動程式，而不是現在執行的核心。
</impo>

</body>
</section>
<section id="alsa-utils">
<title>安裝 ALSA 工具</title>
<body>

<p>
假如核心中的 OSS 支援不能滿足你的需要，你可以安裝 <c>alsa-oss</c>。這提供一個叫
'aoss' 的程式作為展示用。
</p>

<pre caption="更多的 OSS 相容層">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
然後安裝 ALSA 工具（這是必須的）：
</p>

<pre caption="安裝 ALSA 工具">
# <i>emerge alsa-utils</i>
</pre>

<p>
現在您的 ALSA 工具應該已經安裝好，是時候設定 ALSA 了！
</p>

</body>
</section>
</chapter>
<chapter>
<title>設定 ALSA</title>
<section>
<title>自動載入核心模組</title>
<body>

<p>
若您使用支援模組的核心（例如 <c>genkernel</c> 做出來的那種），您必須編輯
<path>/etc/modules.d/alsa</path> 讓它在開機時期啟動必須的模組。在我們的例子中：
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># 下面的只有在您需要 OSS 相容模式的話才需要</comment>
alias sound-slot-0 snd-card-0
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
接著執行 <c>modules-update</c> 讓您在 <path>alsa</path> 中所作的變更存進
<path>/etc/modules.conf</path> 中：
</p>

<pre caption="執行 modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>檢察設備檔</title>
<body>

<p>
在你安裝時這些事應該就會處理好了，但如果你碰到一些問題的話，檢查 /dev 管理程式
有沒有正確設定 ALSA 裝置及權限。如果使用 DevFS，檢查 <path>/etc/devfsd.conf</path>
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>於開機時啟動 ALSA</title>
<body>

<p>
想在開機時啟動 ALSA 支援，您必須將 <c>alsasound</c> 加入至 boot runlevel：
</p>

<pre caption="將 ALSA 加到 boot runlevel">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>取消靜音</title>
<body>

<p>
所有聲道預設都是靜音的，我們需要 <c>amixer</c> 為我們取消靜音：
</p>

<pre caption="執行 amixer">
# <i>amixer</i>
</pre>

<p>
若 <c>amixer</c> 吐初一大堆訊息，表示您準備好可以取消靜音了。若它只吐出了一個
錯誤訊息，則請重新檢查您已經載入了音效卡模組。
</p>


<p>
如果您做到了這裡，現在可以解除 Master 和 PCM 聲道的靜音了。有些硬體還必須解除
中央聲道和環繞聲道的靜音。
</p>

<pre caption="解除聲道靜音">
<comment>(如果你比較喜歡透過 ncurses：)</comment>
# <i>alsamixer</i>
<comment>(或)</comment>
# <i>amixer set Master 100 unmute</i>
# <i>amixer set PCM 100 unmute</i>
<comment>（若必須的話...）</comment>
# <i>amixer set Center 100 unmute</i>
# <i>amixer set Surround 100 unmute</i>
# <i>amixer set Headphone 100 unmute</i>
</pre>

<p>
想檢查您的音效卡是否能用，請隨意播放個 wave 檔（使用 <c>aplay</c>）、mp3（使用
<c>mpg123</c> 甚至 <c>mplayer</c>）或其他任何音效檔。
</p>

</body>
</section>
</chapter>
<chapter>
<title>啟動 MIDI 支援</title>
<section>
<title>安裝必須的套件</title>
<body>

<p>
某些音效卡附有 MIDI 合成器。想使用它們，您必須先安裝 <c>awesfx</c>：
</p>

<pre caption="安裝 awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
若您有一些音色集合檔，將它們放到 <path>/usr/share/sfbank</path> 下。例如 SBLive
有隨附的音色檔 <path>8MBGMSFX.SF2</path> 或 <path>CT4GMSFX.SF2</path>。
</p>

<p>
在複製音色檔之後，使用 <c>asfxload</c> 來啟用它們：
</p>

<pre caption="載入音色檔">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
您必須在每次開機之後執行這個指令一次，所以我們建議您將它加入
<path>/etc/conf.d/local.start</path> 檔案中。
</p>

<p>
若您在驅動程式光碟中找不到音色檔，也許您可以從網路上下載：
<uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>。
</p>

</body>
</section>
<section>
<title>Timidity++ 虛擬合成器</title>
<body>

<p>
若您的音效卡沒有硬體合成器（或您只是單純的不想使用它），您可以使用
<c>timidity++</c> 來提供虛擬的合成器。首先安裝這個套件：
</p>

<pre caption="安裝 Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
要讓 timidity++ 播放聲音，它需要一些音色檔。若您沒有任何音色檔，安裝
<c>timidity-eawpatches</c> 或 <c>timidity-shompatches</c> 會提供一些。
你可以同時使用多個音色檔，也可以將你自己的音色檔放在
<path>/usr/share/timidity/</path>。要切換不同設定的話，可以使用
timidity++ 套件提供的 <e>timidity-update</e>。
</p>

<pre caption="安裝音色檔">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(或)</comment>
		   	 
# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
別忘了將 <c>timidity</c> 加入 default runlevel。
</p>

<pre caption="將 timidity 加入至 default runlevel">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>測試 MIDI 支援</title>
<body>

<p>
您可以使用 ALSA Utils 提供的<c>aplaymidi</c> 測試您的 MIDI 設定：
</p>

<p>
要查詢系統上有那些 MIDI 埠可以使用，使用 -l 選項：
</p>

<pre caption="檢視 MIDI 輸出埠">
# <i>aplaymidi -l</i>
</pre>

<p>
若一切看起來都很好，試著播放個 MIDI 檔案好檢查是否一切都真的很好。您可以使用
<c>-p</c> 選項指定您想使用的 MIDI 埠。
</p>

<pre caption="播放 MIDI 檔案">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith' Theme.mid"</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>最後的筆記</title>
<section>
<title>工具及韌體</title>
<body>

<p>
某些特定的音效卡可以從某些工具中得到些好處 - 例如從 <c>alsa-tools</c> 以及
<c>alsa-firmware</c> 套件。若您需要 <c>alsa-tools</c>，請先於
<path>/etc/make.conf</path> 中設定 ALSA_TOOLS 變數，告訴它您需要的工具。例如：
</p>

<pre caption="選擇 ALSA 工具 /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
接著安裝 <c>alsa-tools</c> (和/或 <c>alsa-firmware</c>) 套件：
</p>

<pre caption="安裝 ALSA 工具">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>啟用搖桿支援</title>
<body>

<p>
如果您的音效卡有搖桿的接口，您應該會有興趣啟用音效卡上的搖桿接口支援。請先確
定音效卡的驅動程式上有搖桿的參數。您可以使用 <c>modinfo</c> 查看您的 
<path>snd-&lt;晶片&gt;</path>。舉例來說，您的音效卡是 <c>snd-via82xx</c>：
</p>

<pre caption="執行 modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec 
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for 
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 = 
             no VRA)
</pre>
  	 
<p>
如果有找到 <c>搖桿</c> 參數，然後將 <c>joystick=1</c> 加到
<path>/etc/modules.d/alsa</path> 裡面的 <c>options</c> 後面。舉例來說，
<c>snd-via82xx</c>將要使用：
</p>
 	 
<pre caption="增加搖桿參數">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>
  	 
</body>
</section>

<section>
<title>資源</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">The ALSA Project</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto's and FAQs</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
