<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/zh_tw/handbook/hb-install-ppc64-disk.xml,v 1.12 2006/01/27 13:56:11 ccpz Exp $ -->

<!-- rev 1.23 by ccpz -->

<sections>

<version>2.6</version>
<date>2006-01-20</date>

<section>
<title>介紹區塊裝置</title>
<subsection>
<title>區塊裝置（Block Devices）</title>
<body>

<p>
我們將仔細的介紹 Gentoo Linux 和 整體的Linux 的磁碟方式，包括 Linux 檔案系統，
分割區，和區塊裝置。然後，當您了解磁碟和檔案系統，您將會學到如何為您的 Gentoo 
Linux 安裝設定分割區和檔案系統。
</p>

<p>
首先，我們將要介紹 <e>區塊裝置</e>。最有名的區塊裝置大概就是代表 Linux 系統上的
第一個 IDE 磁碟，<path>/dev/hda</path> 如果您的系統使用 SCSI 磁碟，那您的第一個
磁碟將會是 <path>/dev/sda</path>。Serial ATA 裝置也是 <path>/dev/sda</path>，即
使他們是 IDE 裝置。
</p>

<p>
以上的區塊裝置代表著磁碟的介面。使用者可以不用擔心您的磁碟是否為 IDE，SCSI
或是其他，並且使用程式來使用這些區塊裝置。這個程式可以在磁碟上寫入多個隨機的 
512 byte 區塊。
</p>

</body>
</subsection>
<subsection>
<title>分割區和 Slices</title>
<body>

<p>
理論上雖然您可以使用整個磁碟放置您的 Linux 系統，但是實務上幾乎沒有人這麼做。
整個磁碟將會被分為其他小一點的大小，並可以更好的管理。大部份的系統將叫他 
<e>分割區（partitions）</e>。其他架構使用類似的技術，叫做 <e>slices</e>。
</p>

</body>
</subsection>
</section>
<section>
<title>策劃一個分割區計畫</title>
<subsection>
<title>預設的分割區策劃</title>
<body>

<p>
如果您不打算策劃一個分割計畫，您可以使用我們手冊的分割區規劃：
</p>

<table>
<tr>
  <th>分割區</th>
  <th>檔案系統</th>
  <th>大小</th>
  <th>說明</th>
</tr>
<tr>
  <ti><path>/dev/sda1</path></ti>
  <ti>Partition map</ti>
  <ti>31.5k</ti>
  <ti>Partition map</ti>
</tr>
<tr>
  <ti><path>/dev/sda2</path></ti>
  <ti>(bootstrap)</ti>
  <ti>800k</ti>
  <ti>Apple_Bootstrap</ti>
</tr>
<tr>
  <ti><path>/dev/sda3</path></ti>
  <ti>(swap)</ti>
  <ti>512M</ti>
  <ti>Swap 分割區</ti>
</tr>
<tr>
  <ti><path>/dev/sda4</path></ti>
  <ti>ext3</ti>
  <ti>磁碟剩下的空間</ti>
  <ti>根 或是 主分割區（Root partition）</ti>
</tr>
</table>

<note>
這裡有一些像這類名稱的分割區：<path>Apple_Driver43，Apple_Driver_ATA，
Apple_FWDriver，Apple_Driver_IOKit，Apple_Patches</path>。如果你不打算使用
MacOS 9 那你就可以把他們刪了，因為 MacOS X 和 Linux 並不需要。你可能需要使用
parted 來刪除，因為 mac-fdisk 並不能刪除他們。
</note>

<p>
如果您對於一個分割區需要多大，或是需要幾個分割區，請繼續閱讀。不然接著讀
<uri link="#mac-fdisk">Apple G5: 使用 mac-fdisk 分割硬碟</uri> 或 
<uri link="#fdisk">IBM pSeries: 使用 fdisk 分割硬碟</uri>
</p>

</body>
</subsection>
<subsection>
<title>多少和多大？</title>
<body>

<p>
多少分割區通常是按照您的使用環境。舉例來說，如果您有很多個使用者，您就會因為安全
問題和能夠簡易備份將您的 <path>/home</path> 分開。如果您將 Gentoo 安裝為郵件伺服
器那您的 <path>/var</path>應該分開，因為郵件通常是放在 <path>/var</path>。選擇好
的檔案系統將會提昇您的效能。遊戲伺服器因為大多數的遊戲伺服器都是安裝在 
<path>/opt</path> 所以通常會將 <path>/opt</path> 分開。原因很和 
<path>/home</path> 類似：安全問題和備份。你一定會想分給 <path>/usr</path> 比較
大的空間：不只是因為他包含大部份的程式，Portage 樹，除了他儲存的各種原始碼知外
，本身需要 500 Mb 的空間。
</p>

<p>
如您所見，不同的方式是彼此相依的。不同的分割區或是容量將會有以下優點：
</p>

<ul>
<li>
  您可以選擇適合個別分割區的檔案系統提高效能
</li>
<li>
  您的系統不會因為一個分割區或是容量失效而完全終止
</li>
<li>
  如果必要，檔案系統檢查所費的時間將會減少，並且可以以平行方式進行（雖然這個優點
  比較適合多分割區）
</li>
<li>
  安全性可以因為某些分割區以分割成唯讀而加強，nosuid（setuid機會被略過），
  noexec（執行檔將會被掠過）等等。
</li>
</ul>

<p>
但是，多個分割區也有一個很大的缺點：如果沒有完好的設定，您將會看到一個分割區上的
空間不夠或是一個分割區上的空間太多。SCSI 也有最多 15 個分割區的限制。
</p>

</body>
</subsection>
</section>
<section id="mac-fdisk">
<title>Apple G5: 使用 mac-fdisk 分割硬碟</title>
<body>

<p>
在這邊，使用 <c>mac-fdisk</c> 建立您的分割區：
</p>

<pre caption="使用 mac-fdisk">
# <i>mac-fdisk /dev/sda</i>
</pre>

<p>
當 <c>fdisk</c> 開始後，您將會看到以下的畫面：
</p>

<p>
首先刪除您之前為了保留給 Linux 的分割區。使用 <c>mac-fdisk</c> 內的 <c>d</c> 來
刪除這些分割區。它將會問您要刪除那一個分割區。
</p>

<p>
這個磁碟包含著七個 Linux 檔案系統（顯示為 "Linux"）和一個 swap 分割區（顯示為
"Linux Swap"）。
第二，使用 <c>b</c> 建立一個 <e>Apple-bootstrap</e> 分割區。它將會問您要從那個區
塊開始。輸入您的第一個空閒的分割區，然後加上 <c>p</c>。舉例來說 <c>2p</c> 為第一
個分割區。
</p>

<note>
這個分割區 <e>不是</e> 一個 "開機" 分割區。它完全不被 Linux 所使用；您不應該掛載
它也不能將檔案系統放到它上面。 PPC 使用者不需要<path>/boot</path>開機分割區。
</note>

<p>
現在輸入 <c>c</c> 建立 swap 分割區。<c>mac-fdisk</c> 將會問您要從那個分割區開始。
以我們的範例來說，剛剛使用了 <c>2</c> 來建立 Apple_Bootstrap 分割區，您現在將需
要輸入 <c>3p</c>。當您被問到大小時，輸入 <c>512M</c>（或是適合您的大小）。當您
被問到名字時，輸入 <c>swap</c>（必需）。
</p>

<p>
要建立主分割區，輸入 <c>c</c> 然後 <c>4p</c> 來選擇主分割區應該開始的區塊。當您
被問到大小，再輸入一次 <c>4p</c>。<c>mac-fdisk</c> 將會判斷成 "使用所有可用的空
間"。當問到名子時，輸入 <c>root</c> （必需）。
</p>

<p>
要結束，輸入 <c>w</c> 將分割區寫入磁碟然後 <c>q</c> 離開 <c>mac-fdisk</c>。
</p>

<note>
為了確定全部都完成了，你應該再一次執行 mac-fdisk 並檢查所有的分割區是否都還在。
如果你沒有看到任何你建立，修改的分割區，你應該在 mac-fdisk 中按下 "i" 重新初始
化分割區。注意這會重新建立分割區地圖，因此移除所有分割區。
</note>

<p>
現在您的分割區已經建立完成了，您可以從 <uri link="#filesystems">建立檔案系統
</uri>繼續。
</p>

</body>
</section>
<section id="fdisk">
<title>IBM pSeries，iSeries 和 OpenPower: 使用 fdisk 分割硬碟</title>
<subsection>
<body>

<note>
如果在安裝 gentoo 時你想要使用 RAID 磁碟陣列，而且你是用 POWER5 為基礎的硬體，
你現在應該執行  <c>iprutils</c> 來格式化磁碟及建立磁碟陣列。
</note>

<p>
底下這部份說明如何建立如之前所說的分割區分配：
</p> 

<table>
<tr>
  <th>分割區</th>
  <th>說明</th>
</tr>
<tr>
  <ti><path>/dev/sda1</path></ti>
  <ti>PPC PReP 開機分割區</ti>
</tr>
<tr>
  <ti><path>/dev/sda2</path></ti>
  <ti>Swap 分割區</ti>
</tr>
<tr>
  <ti><path>/dev/sda3</path></ti>
  <ti>根目錄分割區</ti>
</tr>
</table>

<p>
依照你自己的喜好來調整分割區配置。
</p>
 
</body>
</subsection>
<subsection>
<title>檢視目前的分割區配置</title>
<body>

<p>
<c>fdisk</c> 是一個受歡迎且具有威力的的工具，把你的硬碟跟割成一個個分割區。啟動
<c>fdisk</c> 分割你的硬碟(在我們得範例使用 <path>/dev/sda</path>)：
</p>

<pre caption="開始 fdisk">
# <i>fdisk /dev/sda</i>
</pre>

<p>
一旦進入 <c>fdisk</c> 後，你可以看到類似這樣的提示符號：
</p>

<pre caption="fdisk 提示符號">
Command (m for help):
</pre>

<p>
輸入 <c>p</c> 列出目前的硬碟分割狀況：
</p>

<pre caption="一個分割設定範例">
Command (m for help): p

Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes

   Device Boot      Start         End      Blocks   Id  System
  /dev/sda1               1          12       53266+  83  Linux
  /dev/sda2              13         233      981571+  82  Linux swap
  /dev/sda3             234         674     1958701+  83  Linux
  /dev/sda4             675        6761    27035410+   5  Extended
  /dev/sda5             675        2874     9771268+  83  Linux
  /dev/sda6            2875        2919      199836   83  Linux
  /dev/sda7            2920        3008      395262   83  Linux
  /dev/sda8            3009        6761    16668918   83  Linux
  
  Command (m for help):
</pre>

<p>
這一個磁碟設定成放置六個 Linux 檔案系統(每個都有一個相對應印的分割區後面加上
"Linux")，還有 swap 分割區(以 "Linux swap" 顯示)。
</p>

</body>
</subsection>
<subsection>
<title>移除所有分割區</title>
<body>

<p>
我們首先需要移除目前硬碟上存在的分割區。輸入 <c>d</c> 來刪除分割區。例如說，刪
除已存在的 <path>/dev/sda1</path>：
</p>

<pre caption="刪除分割區">
Command (m for help): <i>d</i>
Partition number (1-4): <i>1</i>
</pre>

<p>
這個分割區已經語定要刪除了。如果你輸入 <c>p</c> 他將不再顯示出來，但是在你儲存
你的設定前，他都不會被清除。如果你犯了一個錯誤並且希望不儲存設定離開，輸入
<c>q</c> 你的分割區就不會被刪除了。
</p>

<p>
現在假設你想直接請除硬碟上的所有分割區，重覆的輸入 <c>p</c> 列出分割區，然後輸入
<c>d</c> 還有分割區號碼來刪除他。最後，你有一個完全空白的分割區列表：
</p>

<pre caption="一個完全空白的分割區列表">
Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes

Device Boot    Start       End    Blocks   Id  System

Command (m for help):
</pre>

</body>
</subsection>
<subsection>
<title>建立 PPC PReP 開機分割區</title>
<body>

<p>
我們先建立一個小的 PPC PReP 開機分割區。輸入 <c>n</c> 建立一個新的分割區，然後
輸入 <c>p</c> 選擇主分割區。後面接著 <c>1</c> 選擇第一個分割區。當他提示你輸入
第一個磁柱 (cylinder) 時，按下 enter。當輸入最後一個磁柱時，輸入 <c>+7M</c> 建
立一個 7Mb大小的分割區。當你完成後，輸入 <c>t</c> 設定分割區類型，<c>1</c> 選擇
你剛剛建立的分割區然後輸入 <c>41</c> 設定成 "PPC PReP Boot" 分割區類型。最後，
你需要讓 PReP 分割區可開機。
</p>

<note>
PReP 分割區一定要小於 8 MByte!
</note>

<pre caption="建立 PReP 開機分割區">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes

   Device Boot      Start         End      Blocks   Id  System

Command (m for help): <i>n</i>
Command action
      e   extended
      p   primary partition (1-4)
<i>p</i>
Partition number (1-4): <i>1</i>
First cylinder (1-6761, default 1): 
Using default value 1
Last cylinder or +size or +sizeM or +sizeK (1-6761, default 6761): <i>+8M</i>

Command (m for help): <i>t</i>
Selected partition 1
Hex code (type L to list codes): <i>41</i>
Changed system type of partition 1 to 41 (PPC PReP Boot)
 
Command (m for help): <i>a</i>
Partition number (1-4): <i>1</i>
Command (m for help):
</pre>

<p>
現在當你輸入 <c>p</c>，你應該會看到底下的輸出結果。
</p>
 
<pre caption="已建立的開機分割區">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes
 
   Device Boot      Start         End      Blocks   Id  System
/dev/sda1  *            1           3       13293   41  PPC PReP Boot

Command (m for help):
</pre>


</body>
</subsection>
<subsection>
<title>建立 Swap 分割區</title>
<body>

<p>
現在來建立 Swap 分割區，輸入 <c>n</c> 來建立新分割區，然後輸入 <c>p</c> 告訴
fdisk 建立主分割區。再來是鍵入 <c>2</c> 建立第二個主分割區，我們的例子中是
<path>/dev/sda2</path>。當提示你輸入第一個磁柱時，按下 enter。然後提示你輸入最
後一個磁柱時，輸入 <c>+512M</c> 建立一個 512MB 大小的分割區。當你完成後，輸入
<c>t</c> 設定分割區類型，輸入 <c>2</c> 選擇你剛剛建立的分割區然後輸入 <c>82</c>
設定分割區類型為 "Linux Swap"。在完成這些步驟後，輸入 <c>p</c> 應該看到類似這樣
的分割區列表：
</p>

<pre caption="建立 swap 分割區後的分割區列表">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1           3       13293   41  PPC PReP Boot
/dev/sda2               4         117      506331   82  Linux swap

Command (m for help):
</pre>
 
</body>
</subsection>
<subsection>
<title>建立根目錄分割區</title>
<body>

<p>
最後，建立根目錄分割區。輸入 <c>n</c> 建立新分割區，然後 <c>p</c> 告訴 fdisk 你
想要建立主分割區。再來輸入 <c>3</c> 建立第三個主分割區。我們的範例是
<path>/dev/sda3</path>。當提示你輸入第一個磁柱時，按下 enter。然後提示你輸入最
後一個磁柱時，按下 enter來建立使用所有剩餘空間的分割區。在完成這些步驟後，輸入
<c>p</c> 應該看到類似這樣的分割區列表：
</p>
 
<pre caption="建立根目錄分割區後的分割區列表">
Command (m for help): p

Disk /dev/sda: 30.7 GB, 30750031872 bytes
141 heads, 63 sectors/track, 6761 cylinders
Units = cylinders of 8883 * 512 = 4548096 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1           3       13293   41  PPC PReP Boot
/dev/sda2               4         117      506331   82  Linux swap
/dev/sda3             118        6761    29509326   83  Linux

Command (m for help):
</pre>
</body>
</subsection>
<subsection>
<title>儲存分割區配置</title>
<body>

<p>
按下 <c>w</c> 儲存分割區配置並且離開 <c>fdisk</c>。
</p>

<pre caption="儲存並且離開 fdisk">
Command (m for help): <i>w</i>
</pre>
 
<p>
現在你的分割區已經建好了，你可以繼續閱讀
<uri link="#filesystems">建立檔案系統</uri>.
</p>
 
</body>
</subsection>
</section>
<section id="filesystems">
<title>建立檔案系統</title>
<subsection>
<title>介紹</title>
<body>
  
<p>
現在你的分割區都建立好，是在上面設置檔案系統的時候了。如果你並不在意使用那種檔案
系統，並且滿意我在我們手冊中的預設設定，就繼續閱讀
<uri link="#filesystems-apply">將檔案系統套用到分割區上</uri>。不然閱讀下面的內
容了解有那些檔案系統可以用。
</p>

</body>
</subsection>
<subsection>
<title>檔案系統？</title>
<body>

<note>
你有多種檔案系統可以選擇。Ext2 和 ext3 在 PPC64 架構上很穩定。reiserfs 和 xfs
仍然在實驗階段。jfs 並不支援。
</note>
 

<p>
<b>ext2</b> 是一個舊的 Linux 檔案系統，沒有日誌功能. 啟用的時間通常需要很久。目
前有許多 <e>日誌型態</e> 的檔案系統可以以更快的速度及更好的效率完成系統啟用和檢
查。
</p>

<p>
<b>ext3</b> 為 ext2 的日誌版，提供了 metadata 日誌系統 並且可以快速地使用日誌系
統復原。ext3 是個相當不錯並且可靠的檔案系統. 它有額外的 hashed b-tree 索引功能
，開啟他後幾乎任何情況內都是高效能。你可以在 <c>mke2fs</c> 指令加上
<c>-O dir_index</c> 開啟這個功能。簡單來說，ext3 是一個很棒的檔案系統。
</p>

<p>
<b>ReiserFS</b> 整體來說是個相當不錯的系統，它處理小型檔案(少於4kb)時效能會比 
ext2 和 ext3 來的好。他使用的是 B*-tree 為基礎的檔案系統. 另外也能很有效率地處理
大型檔案。Linux 核心版本 2.4.18+ 後，ReiserFS 是一個相當有值得推薦的系統, 從很少
，到很多檔案。ReiserFS 都可以處理的非常好。開機分割區並不建議使用此檔案系統。
</p>

<p>
<b>XFS</b> 是一個 metadata 日誌系統，並且擁有完整的功能及針對延展性最佳化，在
Gentoo 的 xfs-sources 核心中有完整的支援。如果您使用高速 SCSI 或是纖維的儲存裝
置，並且有持續不斷的電源供應，我們才推薦您使用 XFS。 如果沒有，請使用其他檔案系
統。因為 XFS 大量的將要轉送的資料快取在記憶體中，設計不好的程式(的確有一些程式
在寫入磁碟時不做一般的預防措施)可能當系統意外斷電時損失大量的資料。
</p>

<p>
JFS 是 IBM 發展的高效能日誌系統。目前雖然已經可以算是個完成品，關於他的穩地度並
沒有太多的優點及缺點。
</p>

</body>
</subsection>
<subsection id="filesystems-apply">
<title>將檔案系統套用到分割區上</title>
<body>

<p>
要把檔案系統建立到一個分割區或是容量上可使用一些為個別檔案系統所設計的工具：
</p>

<table>
<tr>
  <th>檔案系統</th>
  <th>建立指令</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti><c>mke2fs</c></ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti><c>mke2fs -j</c></ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti><c>mkreiserfs</c></ti>
</tr>
<tr>
  <ti>xfs</ti>
  <ti><c>mkfs.xfs</c></ti>
</tr>
<tr>
  <ti>jfs</ti>
  <ti><c>mkfs.jfs</c></ti>
</tr>
</table>

<p>
以我們的範例來說，主分割區（在我們的例子為 <path>/dev/sda4</path>）為 ext3，您將
要使用：
</p>

<pre caption="將檔案系統套用到分割區上">
# <i>mke2fs -j /dev/sda4</i>
</pre>

<p>
現在檔案系統已經建立到我們剛建立完成的分割區上了（或是logical 容量）。
</p>

</body>
</subsection>
<subsection>
<title>啟用 Swap 分割區</title>
<body>

<p>
<c>mkswap</c> 是用來起始 swap 分割區的指令：
</p>

<pre caption="建立 swap 簽名">
# <i>mkswap /dev/sda3</i>
</pre>

<p>
要啟用 swap，使用 <c>swapon</c> 指令：
</p>

<pre caption="啟動 swap">
# <i>swapon /dev/sda3</i>
</pre>

<p>
現在使用上面的指令建立然後啟動 swap。
</p>

</body>
</subsection>
</section>
<section>
<title>掛載</title>
<body>

<p>
現在您的分割區已經起始和放置檔案系統了，接下來我們該把這些分割區掛載起來。使用
<c>mount</c> 的指令。不要忘了建立相關的掛載目錄，以我們的範例分割來說只掛載主
分割區和開機分割區：
</p>

<pre caption="掛載分割區">
# <i>mkdir /mnt/gentoo</i>
# <i>mount /dev/sda4 /mnt/gentoo</i>
</pre>

<note>
如果您要將 <path>/tmp</path> 放在不同的分割區，記得掛載後將它的權限更改為：
<c>chmod 1777 /mnt/gentoo/tmp</c>。這也適用於 <path>/var/tmp</path>。
</note>

<p>
現在從 <uri link="?part=1&amp;chap=5">使用安裝檔安裝 Gentoo</uri> 繼續。
</p>

</body>
</section>
</sections>
