<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/zh_tw/gentoolkit.xml,v 1.2 2004/11/27 10:25:20 ccpz Exp $ -->
<!-- rev 1.3 by mongala -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/zh_tw/gentoolkit.xml" lang="zh_tw">
<title>Gentoolkit</title>

<author title="Author">
  <mail link="mbutcher@aleph-null.tv">Matt Butcher</mail>
</author>

<author title="Editor">
  <!-- zhen@gentoo.org -->John P. Davis
</author>

<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>

<author title="Translator">
  <mail link="mctsai@gmail.com">Meng-Chia Tsai</mail>
</author>

<!-- Licensed under GFDL -->

<abstract>
Gentoolkit 是一套使 gentoo 系統管理簡便的工具。這份文件涵蓋了一些現有
gentoolkit 工具的基礎。
</abstract>

<version>1.3</version>
<date>2003年9月1日</date>

<chapter>
<title>簡介</title>
<section>
<title>什麼是 Gentoolkit?</title>
<body>

<p>
Gentoo 是一套獨一無二的發行版，有著一些別的發行版所沒有的複雜度。當 gentoo
開發者及貢獻者發現這些複雜度，他們會寫出工具程式來幫助使用者和管理者解決這
些問題。這些工具滿多貢獻給 Gentoo 專案，包括<c>app-portage/gentoolkit</c>
這個套件裡。
</p>

<p>
Gentoolkit 包含一大堆有用的套件來幫助管理 Portage 和 ebuild 架構。大部分
的使用者 -- 特別是那些時常更新系統的 -- 將得益於安裝 gentoolkit 之後。
</p>

</body>
</section>

<section>
<title>安裝</title>
<body>

<p>
就和其他的 Gentoo 套件一樣，安裝只要簡單的 emerge 就可以了。
</p>

<pre>
# <i>emerge gentoolkit</i>
</pre>

<note>
許多 gentoolkit 裡的工具透露關於你系統的重要訊息或是需要 root 權限。
因為這個原因(或是函式特性)，有些程式只能由具有 root 權限的使用者執行。
</note>

</body>
</section>

<section>
<title>尋找文件</title>
<body>

<p>
在寫這篇時，不是所有的 gentoolkit 都寫好文件了。有些有使用手冊，但不
是全部。程式所附的文件(不是使用手冊)會放在
<path>/usr/doc/gentoolkit-[version]/[program-name]/</path>下。
</p>

</body>
</section>
</chapter>

<chapter>
<title>使用 qpkg 來查詢套件資料</title>
<section>
<title>簡介</title>
<body>

<p>
<c>qpkg</c> 是個有彈性的工具用來判斷 ebuilds 是否安裝的訊息，也可以
提供關於檔案是屬於哪個 ebuild 的資訊，不管是重複安裝多個版本的同一
套件，還有這個套件做了什麼。
</p>

<p>
沒加參數呼叫 <c>qpkg</c> 會列出所有的 ebuilds，後面有星號(*)的表示已
經安裝在系統上了。
</p>

<note>
預設 <c>qpkg</c> 會以彩色的方式輸出。如果要在命令列關掉這個功能，
加上 <c>--no-color</c> 或 <c>-nc</c> 旗標。
</note>

</body>
</section>

<section>
<title>查詢套件資訊</title>
<body>

<p>
<c>qpkg</c> 常用的功能之一就是確定給定的套件是什麼。舉例來說，在 
<path>net-misc</path>目錄下，我看到一個叫做 <path>neon</path>的
套件。對它毫無頭緒之下，我會執行 qpkg。
</p>

<pre>
# <i>qpkg -i net-misc/neon</i>
net-misc/neon-0.15.3-r1
       HTTP and WebDAV client library [ http://www.webdav.org/neon ]
net-misc/neon-0.18.5
       HTTP and WebDAV client library [ http://www.webdav.org/neon ]
net-misc/neon-0.19.2
       HTTP and WebDAV client library [ http://www.webdav.org/neon ]
net-misc/neon-0.19.2-r1
       HTTP and WebDAV client library [ http://www.webdav.org/neon ]
net-misc/neon-0.21.1
       HTTP and WebDAV client library [ http://www.webdav.org/neon ]
</pre>

<p>
<c>qpkg</c> 讀取所有五個在 <path>net-misc/neon</path> 目錄下的 ebuilds 
然後印出儲存在 DESCRIPTION 和 HOMEPAGE 下的資訊。
</p>

</body>
</section>

<section>
<title>列出屬於某個 Ebuild 的檔案</title>
<body>

<p>
<c>qpkg</c> 也可以列出屬於已安裝套件的檔案。我知道 gentoolkit 安裝了
一些工具，但是我不知道它們全部是什麼。為了找出來，我可以打 <c>qpkg -l</c>。
</p>

<pre>
# <i>qpkg -l app-portage/gentoolkit</i>
app-portage/gentoolkit-0.1.14-r1 *
CONTENTS:
/usr
/usr/share
/usr/share/gentoolkit
/usr/share/gentoolkit/histogram.awk
/usr/share/doc
/usr/share/doc/gentoolkit-0.1.14-r1
/usr/share/doc/gentoolkit-0.1.14-r1/gentool
/usr/share/doc/gentoolkit-0.1.14-r1/gentool/ChangeLog.gz
/usr/share/doc/gentoolkit-0.1.14-r1/lintool
/usr/share/doc/gentoolkit-0.1.14-r1/lintool/checklist-for-ebuilds.gz
/usr/share/doc/gentoolkit-0.1.14-r1/lintool/ChangeLog.gz
/usr/share/doc/gentoolkit-0.1.14-r1/etc-update
/usr/share/doc/gentoolkit-0.1.14-r1/etc-update/ChangeLog.gz
/usr/share/man
/usr/share/man/man1
/usr/share/man/man1/qpkg.1.gz
/usr/share/man/man1/lintool.1.gz
/usr/share/man/man1/etc-update.1.gz
/usr/bin
/usr/bin/gentool-bump-revision
/usr/bin/gentool-total-coverage
/usr/bin/gentool-author-coverage
/usr/bin/gentool-package-count
/usr/bin/qpkg
/usr/bin/pkg-size
/usr/bin/lintool
/usr/sbin
/usr/sbin/pkg-clean
/usr/sbin/mkebuild
/usr/sbin/emerge-webrsync
/usr/sbin/epm
/usr/sbin/etc-update
/etc
/etc/etc-update.conf
</pre>

</body>
</section>

<section>
<title>尋找檔案的來源是哪個套件</title>
<body>

<p>
為了找出檔案的來源是哪個套件，可以用 <c>-f</c> 或 <c>--find-file</c>
旗標。
</p>

<pre>
# <i>qpkg -f /usr/lib/mozilla</i>
net-www/mozilla *
</pre>

</body>
</section>

<section>
<title>列出重複的套件</title>
<body>

<p>
有時候會存在同一個套件但是多個版本。<c>qpkg --dups</c> 會列出重複
安裝的套件。重複版本的存在並不是說就要移除舊的版本。它們有不同使用
的時機。找出使用於同一時機的重複套件，用 <c>qpkg --dups --slot</c>
。我剛把 KDE 從 3.0 升到 3.0.2，所以我有一些使用於同一時間的重複版本。
</p>

<pre>
# <i>qpkg --dups --slot</i>
app-portage/gentoolkit
kde-base/kdeaddons
kde-base/kdeadmin
kde-base/kdeartwork
kde-base/kdebase
kde-base/kdegames
kde-base/kdelibs
kde-base/kdemultimedia
kde-base/kdenetwork
kde-base/kdetoys
kde-base/kdeutils
media-libs/freetype
x11-libs/qt
</pre>

</body>
</section>

<section>
<title>確認套件完整</title>
<body>

<p>
有時候檢查套件的完整性來知道檔案沒有在安裝時被置換掉是非常有用的。
<c>qpkg</c> 可以確認 md5 sums 在安裝時這個套件的檔案是否受到了修改
、替換或移除。
</p>

<p>
要檢查 mtimes 和 md5 sums, 用 <c>-c</c> 旗標。
</p>

<pre>
# <i>qpkg gnupg -c -v</i>
app-crypt/gnupg-1.0.6 *
/usr/lib/gnupg/rndunix !md5! !mtime!
/usr/lib/gnupg/rndegd !md5! !mtime!
/usr/lib/gnupg/tiger !md5! !mtime!
/usr/bin/gpg !md5! !mtime!
/usr/bin/gpgv !md5! !mtime!
/usr/share/gnupg/options.skel !md5! !mtime!
/usr/share/gnupg/FAQ !md5! !mtime!
/usr/share/gnupg/faq.html !md5! !mtime!
/usr/share/locale/da/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/de/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/eo/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/et/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/fr/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/id/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/it/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/ja/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/nl/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/pl/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/pt_BR/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/sv/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/locale/tr/LC_MESSAGES/gnupg.mo !md5! !mtime!
/usr/share/info/gpgv.info.gz !md5! !mtime!
/usr/share/man/man1/gpg.1.gz !md5! !mtime!
/usr/share/man/man1/gpgv.1.gz !md5! !mtime!
24/92

app-crypt/gnupg-1.0.7 *
0/101
</pre>

<p>
就像你看到，我安裝了一個版本以上的 GnuPG。<c>qpkg</c> 回報了許多
舊版本的檔案在我安裝時被改變了。這些套件的改變就像我從
<path>gnupg-1.0.6</path> 升級到 <path>gnupg-1.0.7</path>一樣。
注意最後兩行指出 <path>gnupg-1.0.7</path> 101 個檔案中有 0 個檔
案在我安裝時被改變了。這很好。如果它們全部都改變了，
那就用不著我費心了。
</p>

</body>
</section>

<section>
<title>但是等等... 好像還有更多</title>
<body>

<p>
<c>qpkg</c> 還有很多其他的功能是我沒提到的。<c>qpkg</c>
有一份很詳細的使用手冊。查閱它以得到更多資訊。
</p>

</body>
</section>
</chapter>

<chapter>
<title>lintool</title>
<section>
<title>簡介</title>
<body>

<p>
<c>lintool</c> 是一個檢查 ebuilds 腳本是否標準和符合需
求的程式。對於 ebuild 開發者來說滿重要的是使用 <c>lintool</c>
來保證他們做的事是正確的還有不會需要核心成員來做多餘包
含在 Gentoo 收藏區已經需要做的事情。
</p>

</body>
</section>

<section>
<title>使用</title>
<body>

<p>
執行 <c>lintool</c> 會產生一個執行檢查和結果的格式化好的表單。
</p>

<pre>
# <i>lintool app-crypt/gnupg/gnupg-1.0.7.ebuild</i>
app-crypt/gnupg/gnupg-1.0.7.ebuild                                     : Not OK

-------------------------------------------------------------------------------
 Summary for all 1 ebuild(s) checked                             # errors/warns
 -------------------------------------------------------------------------------
 Testing for illegal space characters, weird backslash formatting  : 0 / 0
 Testing for malformed headers                                     : 0 / 1
 Testing for occurence of deprecated try                           : 0 / 0
 Testing for superfluous A=${P}.tar.gz                             : 0 / 0
 Testing for empty DEPEND                                          : 0 / 0
 Testing for empty HOMEPAGE                                        : 0 / 0
 Testing for empty DESCRIPTION                                     : 0 / 0
 Testing for presence of env vars                                  : 1 / 1
 Testing for sane USE flag usage                                   : 0 / 0

 Total number of ebuilds with errors                               : 1 (100%)
 Total number of ebuilds with warnings                             : 1 (100%)
</pre>

<p>
第一行是總結這個 ebuild 是可行的還是有問題的。例如 
<c>gnupg-1.0.7.ebuild</c> 就不行。看過所有的檢查列表，我們可
以看到在 malformed headers 和 presence of env vars 處有警告訊息。
</p>

<p>
看看這份 ebuild，我看到缺少了一對必須的環境變數 (LICENSE 
和 RDEPEND)。加上他們來修復錯誤。但是還是有兩個警告在 --
一個是異常的標頭另一個是環境變數。為了幫我找出來，我可以
再次執行 <c>lintool</c> 加上 <c>--show-details</c>
</p>

<pre> 
# <i>lintool --show-details ./gnupg-1.0.7.ebuild</i>

-------------------------------------------------------------------------------
# Some data cut for brevity....

 Status for ./gnupg-1.0.7.ebuild
* Testing for malformed headers                                         : passed
- (W) Has illegal or suspect headers:
 |Suspect copyright year: # Copyright 1999-2000 Gentoo Technologies, Inc.
 * Testing for occurence of deprecated try                               : passed
 * Testing for superfluous A=${P}.tar.gz                                 : passed
 * Testing for empty DEPEND                                              : passed
 * Testing for empty HOMEPAGE                                            : passed
 * Testing for empty DESCRIPTION                                         : passed
 * Testing for presence of env vars                                      : passed
 - (W) Missing SLOT=
 * Testing for sane USE flag usage                                       : passed

 -------------------------------------------------------------------------------
  Summary for all 1 ebuild(s) checked                             # errors/warns
  -------------------------------------------------------------------------------
  Testing for illegal space characters, weird backslash formatting  : 0 / 0
  Testing for malformed headers                                     : 0 / 1
  Testing for occurence of deprecated try                           : 0 / 0
  Testing for superfluous A=${P}.tar.gz                             : 0 / 0
  Testing for empty DEPEND                                          : 0 / 0
  Testing for empty HOMEPAGE                                        : 0 / 0
  Testing for empty DESCRIPTION                                     : 0 / 0
  Testing for presence of env vars                                  : 0 / 1
  Testing for sane USE flag usage                                   : 0 / 0

  Total number of ebuilds with errors                               : 0 (0%)
  Total number of ebuilds with warnings                             : 1 (100%)
</pre>

<p>
現在我可以看到這個 ebuild 的年份可能錯了，它也可能缺少 SLOT
變數。修正他們以去除所有的警告。
</p>

</body>
</section>
</chapter>

<chapter>
<title>epm</title>
<section>
<title>簡介</title>
<body>

<p>
<c>epm</c> 是一個管理 Red Hat rpm 命令的工具套件。以它現在
的狀況，它還不能提供 rpm 所有的功能，但是可以提供某些有
威力的 rpm 查詢選項。 
</p>

<p>
它也可以處理移除套件，就算它沒有包含在這裡面。用 <c>epm --help</c>
來學習更多有關使用 <c>epm</c>來移除套件。
</p>

</body>
</section>
<section>

<title>用 epm 來移除套件</title>
<body>

<p>
<c>epm</c> 基本函式有和 Red Hat rpm 一樣的命令列函式。
<c>epm -qa</c> 列出所有已安裝的套件。<c>epm -ql</c> 
列出所有來自指定套件的檔案。
</p>

<pre>
# <i>epm -ql ethereal</i>
/usr/lib/ethereal/plugins/0.8.20/gryphon.so
/usr/lib/ethereal/plugins/0.8.20/gryphon.la
/usr/lib/ethereal/plugins/0.8.20/gryphon.a
/usr/lib/ethereal/plugins/0.8.20/mgcp.so
/usr/lib/ethereal/plugins/0.8.20/mgcp.la
/usr/lib/ethereal/plugins/0.8.20/mgcp.a
/usr/lib/ethereal/plugins/0.8.20/cosnaming.so
/usr/lib/ethereal/plugins/0.8.20/cosnaming.la
/usr/lib/ethereal/plugins/0.8.20/cosnaming.a
/usr/lib/ethereal/plugins/0.8.20/coseventcomm.so
/usr/lib/ethereal/plugins/0.8.20/coseventcomm.la
/usr/lib/ethereal/plugins/0.8.20/coseventcomm.a
/usr/bin/ethereal
/usr/bin/editcap
/usr/bin/mergecap
/usr/bin/tethereal
/usr/bin/text2pcap
/usr/bin/idl2eth
/usr/share/man/man1/idl2eth.1.gz
/usr/share/man/man1/tethereal.1.gz
/usr/share/man/man1/text2pcap.1.gz
/usr/share/man/man1/editcap.1.gz
/usr/share/man/man1/ethereal.1.gz
/usr/share/man/man1/mergecap.1.gz
/usr/share/doc/ethereal-0.8.20/AUTHORS.gz
/usr/share/doc/ethereal-0.8.20/COPYING.gz
/usr/share/doc/ethereal-0.8.20/NEWS.gz
/usr/share/doc/ethereal-0.8.20/ChangeLog.gz
/usr/share/doc/ethereal-0.8.20/README.gz
/usr/share/doc/ethereal-0.8.20/INSTALL.configure.gz
/usr/share/doc/ethereal-0.8.20/TODO.gz
/usr/share/doc/ethereal-0.8.20/README.aix.gz
/usr/share/doc/ethereal-0.8.20/README.bsd.gz
/usr/share/doc/ethereal-0.8.20/README.hpux.gz
/usr/share/doc/ethereal-0.8.20/README.irix.gz
/usr/share/doc/ethereal-0.8.20/README.linux.gz
/usr/share/doc/ethereal-0.8.20/README.tru64.gz
/usr/share/doc/ethereal-0.8.20/README.win32.gz
/usr/share/doc/ethereal-0.8.20/README.vmware.gz
/etc/ethereal/manuf
</pre>

<p>
再寫這篇時 <c>epm</c> 提供少許進階現在沒有包含在 <c>qpkg</c> 的查詢選項。
舉例來說，它可以只查詢設定檔或是文件檔案。
</p>

<pre>
# <i>epm -qc ethereal</i>
/etc/ethereal/manuf

# <i>epm -qd ethereal</i>
/usr/share/man/man1/idl2eth.1.gz
/usr/share/man/man1/tethereal.1.gz
/usr/share/man/man1/text2pcap.1.gz
/usr/share/man/man1/editcap.1.gz
/usr/share/man/man1/ethereal.1.gz
/usr/share/man/man1/mergecap.1.gz
/usr/share/doc/ethereal-0.8.20/AUTHORS.gz
/usr/share/doc/ethereal-0.8.20/COPYING.gz
/usr/share/doc/ethereal-0.8.20/NEWS.gz
/usr/share/doc/ethereal-0.8.20/ChangeLog.gz
/usr/share/doc/ethereal-0.8.20/README.gz
/usr/share/doc/ethereal-0.8.20/INSTALL.configure.gz
/usr/share/doc/ethereal-0.8.20/TODO.gz
/usr/share/doc/ethereal-0.8.20/README.aix.gz
/usr/share/doc/ethereal-0.8.20/README.bsd.gz
/usr/share/doc/ethereal-0.8.20/README.hpux.gz
/usr/share/doc/ethereal-0.8.20/README.irix.gz
/usr/share/doc/ethereal-0.8.20/README.linux.gz
/usr/share/doc/ethereal-0.8.20/README.tru64.gz
/usr/share/doc/ethereal-0.8.20/README.win32.gz
/usr/share/doc/ethereal-0.8.20/README.vmware.gz
</pre>

<note>
<c>epm --help</c> 列出 epm <e>到最後</e> 會支援的選項。
注意，然而，前面有星號(*)的表示還沒有實做進去。
</note>

</body>
</section>
</chapter>

<chapter>
<title>其他</title>
<section>
<title>etc-update</title>
<body>
<!-- 
- Feel free to add more to this. It probably deserves its own chapter, but I don't 
- use it, so I can't really write much about it.
-->

<p>
<c>etc-update</c> 提供一個方便的替代方案來手動升級設定檔。執行 emerge
之後會更動設定檔，你可以執行 etc-update 一步一步升級影響比較嚴重的設定檔。
</p>

<p>
它是一個選單式的介面包含再決定怎麼做之前觀察和合併之前的設定檔的能力。
</p>

</body>
</section>

<section>
<title>gentool</title>
<body>

<p>
gentool 是一個統稱泛指某些分析 ebuild 狀態的小腳本程式。比方說，
gentool-total-coverage 印出一列電子郵件位址還有 portage tree 
裡面的 ebuilds 數目。
</p>

</body>
</section>

<section>
<title>pkg-size</title>
<body>

<p>
<c>pkg-size</c> 印出給定的套件中已安裝檔案的大小。
</p>

<pre>
# <i>pkg-size nmap</i>
net-analyzer/nmap-2.54_beta24-r1 897024 (876KB)
</pre>

</body>
</section>

<section>
<title>mkebuild</title>
<body>

<p>
<c>mkebuild</c> 自動簡化了大量建立新 ebuild 檔的流程。執行 
<c>mkebuild [filename]</c> 會建立一個那個檔案的 ebuild，這
個檔案是某些種類的檔案庫。執行之後，它會提供關於你需要做的
改變的回饋。
</p>

</body>
</section>

<section>
<title>emerge-webrsync</title>
<body>
<!-- Can't find any documentation on this anywhere... not even a comment in the
code. -->

<p>
用wget經過HTTP下載每日快照，還有(選擇性的)同步 portage。
</p>

</body>
</section>
</chapter>
</guide>
