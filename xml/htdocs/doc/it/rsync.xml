<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/it/rsync.xml">
<title>Gentoo Linux rsync Mirrors Policy</title>
<author title="Author"><mail link="mirror-admin@gentoo.org">Gentoo Mirror Administrators</mail></author>
<author title="Translator"><mail link="dragoon@interfree.it">Gerasimos Grammatikopoulos aka KiTaSuMbA</mail></author>

<version>1.1</version>
<date>13 Dec 2002</date>

<chapter>
<title>Requisiti</title>
<section>
<title>Minima Larghezza di Banda (Bandwidth)</title>
<body>
<p>
Per ospitare in maniera appropriata un mirror dovrete avere un minimo di banda full duplex (sia upload che download) pari a 5Mbps.
</p>
</body>
</section>
<section>
<title>Minimo Conto di Utenti</title>
<body>
<p>Vi chiediamo di supportare un minimo di 15 simultanee connessioni di utenti.</p>
</body>
</section>
<section>
<title>Frequenza di Aggiornamento</title>
<body>
<p>Aggiornamenti del mirror devono occorrere a :00 e :30 di ogni ora, 24 ore al giorno. E' <e>molto</e> importante che questo orario viene seguito strettamente siccome usiamo un stile di DNS "round robin"per selezionare il server rsync degli utenti.</p>
<impo>Questo deve essere strettamente implementato visto che un server fuori sincronizzazione con questo tipo di impostazione provocherebbe molto più traffico per tutti i server coinvolti nel processo (vedi la FAQ inclusa per ulteriori dettagli.)</impo>
</body>
</section>
<section>
<title>MOTD (<path>/etc/rsync/rsyncd.motd</path>)</title>
<body>
<p>
Per favore,  includete le informazioni seguenti nel vostro file MOTD di rsync:</p>
<ul>
	<li>nome del server</li>
	<li>indirizzo IP del server</li>
	<li>specifiche tecniche del server (CPU e RAM)</li>
	<li>larghezza di banda disponibile al server</li>
	<li>limite di connessioni utente, se esiste</li>
	<li>collocazione del server (città e paese)</li>
	<li>un nome ed indirizzo e-mail per contatti</li>
</ul>
<p>Includendo le informazioni sovrastanti nel vostro MOTD rende facile identificare il vostro mirror in caso di problemi.</p>
</body>
</section>
</chapter>
<chapter>
<title>Dettagli di Implementazione</title>
<section>
<body>
<p>Per impostare un nuovo mirror, seguite i passi descritti in seguito:</p>
<ul>
	<li>Impostate il vostro mirror a sincronizzarsi con un pubblico rsync mirror di Gentoo Linux già esistente. Non ha importanza quale. Assicuratevi di sincronizzare in accordo con il nostro orario di <e>Frequenza di Aggiornamento</e> come descritto sopra.</li>
	<li>Compilate un "bug report" a <uri link="http://bugs.gentoo.org">bugs.gentoo.org</uri> che contiene il vostro nome di server, indirizzo IP, informazioni di contatto e il fatto che intendete diventare un nuovo mirror rsync.  Esamineremo il vostro server per assicurare che si sincronizza in maniera appropriata. Se il vostro server non è sincronizzato esattamente a :00 e :30,vi contaterremo e chiederemo di aggiustare il vostro orario di aggiornamento.</li>
	<li>Verificata la corretta sincronizzazione, aggiungeremo l'indirizzo IP del server nella lista di accesso di rsync1.us.gentoo.org.</li>
	<li>Aggiornate il vostro cron job di rsync a puntare su <path>rsync1.us.gentoo.org</path>.  Il vostro server sarrà monitorato per le prossime 48-72 ore per assicurare la corretta sincronizzazione.</li>
</ul>

<p>Se tutti i passi sono stati seguiti senza problemi, imposteremo un DNS entry del tipo rsync[num].[countrycode].gentoo.org ufficiale e vi aggiungeremo nel nostro DNS round-robin per rsync.gentoo.org e rsync.[countrycode].gentoo.org. Brevemente dopo essere aggiunti al nostro DNS, dovreste vedere traffico rsync.</p>

<p>Ulteriormente l'amministratore del mirror verra' aggiunto alla mailing list di gentoo mirrors (lista a basso traffico) così da poter seguire tutte le tematiche riguardanti i mirror rsync.
</p>
<note>
Grazie per l'aiuto verso gli utenti e sviluppatori di Gentoo Linux! :) Per ogni tema o problema sulla amministrazione di rsync, visitate http://bugs.gentoo.org e compilate un "bug report" sul prodotto "Rsync".
</note>
</body>
</section>
</chapter>
<chapter>
<title>Task Paralleli</title>
<section>
<body>
<p> Presto avremo una pagina creata con rrdtool che conterà semplicemente dei link a grafici (ordinati per continente, paese, server) della disponibilità di mirror rsync ufficiali (questi grafici saranno prodotti da risultati di sping).
I grafici saranno controllati  almeno una volta al giorno, e le macchine non raggiungibili verano rimosse dallo schema di RR DNS finchè i problemi sono risolti.

Avremo scripts che controllerano che ogni 30 minuti tutti i mirror si stano effettivamente sincronizzando con noi.
</p>
<warn>
Se un mirror presenta periodicamente dei problemi e, mentre l'amministrattore è stato contattato, la situazione non migliora, la macchina verrà rimossa dallo schema RR in maniera permanente.
</warn>
</body>
</section>
</chapter>
<chapter>
<title>Breve FAQ</title>
<section>
<title>Q: Chi dovrei contattare per problemi e la manutenzione di rsync?</title>
<body>
<p>A: Visita http://bugs.gentoo.org e crea un bug sul prodotto "Rsync".</p>
</body>
</section>
<section>
<title>Q: Mantengo un mirror rsync privato per la mia ditta.  Posso accedere a rsync1.us.gentoo.org comunque?</title>
<body>
<p>A: Visto che le nostre risorse sono limitate, dobbiamo assicurare di usarle in maniera tale che offriamo il massimo beneficio ai nostri utenti. Così, limitiamo le connessioni nel nostro master rsync e mirror solo a mirror pubblici. Gli utenti sono benvenuti a usare il nostro sistema di mirror normale per stabilire un mirror rsync privato, anche se richiesti di seguire certe <uri link="http://www.gentoo.org/news/en/gwn/20030505-newsletter.xml#doc_chap1_sect3">linee guida di etiquette per rsync</uri> di base.
</p>
</body>
</section>
<section>
<title>Q: E' importante che sincronizzo il mio mirror a :00 e :30 di ogni ora?</title>
<body>
<p>A: Sì è importante. Mentre ogni utente sincronizza con un mirror, si trasferisce la differenza tra quel mirror e quello che c'è nel loro file system. Se il vostro mirror è diverso ed un utente usa un hostname assegnato da round robin, aumentate la larghezza di banda richiesta per l'utente, voi e tutti gli altri mirror.

Per esempio:

Un utente è configurato a fare rsync con  <path>rsync://rsync.gentoo.org/gentoo-portage</path> .

Supponiamo che <path>rsync.gentoo.org</path> è un DNS Round Robin per <path>rsync1.gentoo.org</path>, <path>rsync2.gentoo.org</path>, e <path>rsync3.gentoo.org</path>.

Quindi, supponiamo che rsync1 e rsync3 si sincronizzano ai tempi raccomandati ma rsync2 si sincronizza yncs solo a mezzanotte e l'ora corrente è pomeriggio.
</p>
<ol>
<li>L'utente si sincronizza con rsync1 e così aggiorna il suo tree in /usr/portage. Diciamo che tale operazione ha usato 5 mega di larghezza di banda.</li>
<li>L'utente si sincronizza di nuovo, stavolta con rsync2. Adesso si è reso il suo tree non aggiornato e la banda usata nel primo passo è stata sprecata. Diciamo che la differenza era di 5 mega.</li>
<li>L'utente si sincronizza con rsync3 stavolta e riporta gli ultimi aggiornamenti nel suo tree. A causa del essere in stalo del rsync2, l'utente è stato obligato di trasferire i 5 mega di nuovo.</li>
</ol>
<p> Nel esempio sopra l'utente ha dovuto trasferire 5 mega * 3 = 15 mega di larghezza di banda, cioè 3 volte il necessario e questo diminuirà la sua impressione generale per il sistema Portage di Gentoo.

Inoltre, entrambi rsync2 e rsync3 hanno trasferito 5 mega in più dal dovuto se rsync2 fosse corrente.

Moltiplicando tale valore per il numero di utenti che usano DNS Round Robin ci si rende conto della grande quantità di larghezza di banda sprecata che aumenta il costo di banda non solo per il vostro mirror ma anche di tutti gli altri.

Capiamo che avremmo sempre un certo slitamento di orario (clock drift) tra ogni mirror e che ogni mirror non si sincronizzerà allo stesso esatto momento. Per cercare di minimizzare questa finistra temporale, vi incorragiamo di usare un demone NTP per tenere al minimo lo slitamento di orario.

Se questa ragione non vi basta per usare ntpd, allora dovreste sapere che i vostri files di log avranno maggior peso legale se potete dimostrare che l'orologio del vostro server è corretto e sincronizzato col resto del mondo.

Se non volete far girare ntpd in maniera continua, considerate almeno di eseguire ntpdate almeno una volta al giorno attraverso cron.
</p>
</body>
</section>
<section>
<title>Q: Come trovo il mirror più vicino a me?</title>
<body>
<p>A: netselect è stato disegnato per fare questo per voi. Se non avete già eseguito <c>emerge netselect</c> fattelo.
Eseguite: <c>netselect rsync.gentoo.org</c>. Dopo circa un minuto netselect vi darà un indirizzo IP.
Copiate questo indirizzo e usatelo come unico parametro per rsync con due "due punti" appesi a esso.
per es.: <c>rsync 1.2.3.4::</c>.
Dovreste poter capire di quale mirror si tratta dal messaggio di benvenuto. Aggiornate il vostro /etc/make.conf  in accordo.
</p>
</body>
</section>
</chapter>
<chapter>
<title>Script di Esempio</title>
<section>
<body>
<p>Attualmente, avere un mirror del nostro Portage tree richiede circa 60Mb, quindi non consuma molto spazio; avendo almeno 200Mb disponibili dovrebbe permettere future espansioni. Impostare un mirror del Portage tree è semplice -- prima, assicuratevi che sul vostro mirror è installato rsync. Quindi, impostate il vostro file rsyncd.conf in maniera simile alla seguente:</p>
<pre caption="rsyncd.conf">
#uid = nobody
#gid = nobody
use chroot = no
max connections = 20
pid file = /var/run/rsyncd.pid
motd file = /etc/rsync/rsyncd.motd
transfer logging = yes
log format = %t %a %m %f %b
syslog facility = local3
timeout = 300

[gentoo-x86-portage]
#this entry is for compatibility
path = /space/gentoo/rsync
comment = Gentoo Linux Portage tree


[gentoo-portage]
#modern versions of portage use this entry
path = /gentoo/rsync
comment = Gentoo Linux Portage tree mirror
exclude = distfiles
</pre>
<p>Sopra, il mirror gentoo-x86-portage punta sugli stessi dati di gentoo-portage. Nonostante abbiamo recentemente cambiato il nome ufficiale del nostro mirror a gentoo-portage, gentoo-x86-portage serve ancora per ragioni di compatibilità, quindi includete entrambi campi.</p>
<p>Adesso, bisogna fare il mirror del Gentoo Linux Portage tree. Usate lo script di seguito: </p>
<pre caption="rsync-gentoo-portage.sh">
#!/bin/bash

RSYNC="/usr/bin/rsync"
OPTS="--quiet --recursive --links --perms --times --devices --compress --delete --timeout=600"
#Uncomment the following line only if you have been granted access to rsync1.us.gentoo.org
#SRC="rsync://rsync1.us.gentoo.org/gentoo-portage"
#If you are waiting for access to our master mirror, select one of our mirrors to mirror from:
SRC="rsync://rsync2.de.gentoo.org/gentoo-portage"
DST="/space/gentoo/rsync/"

echo "Started update at" `date` >> $0.log 2>&amp;1
logger -t rsync "re-rsyncing the gentoo-portage tree"
${RSYNC} ${OPTS} ${SRC} ${DST} >> $0.log 2>&amp;1

echo "End: "`date` >> $0.log 2>&amp;1
</pre>
<pre caption="/etc/init.d/rsyncd">
#!/sbin/runscript
# Copyright 1999-2002 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License, v2
or later
# $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/rsync.xml,v 1.1 2003/07/17 22:41:36 mush Exp $

depend() {
need net
}

# FYI: --sparce seems to cause problems.
RSYNCOPTS="--daemon --safe-links --compress --bwlimit=700 --timeout=1800"

start() {
ebegin "Starting rsync daemon"
start-stop-daemon --start --quiet --pidfile /var/run/rsyncd.pid --nicelevel 15 --exec /usr/bin/rsync -- ${RSYNCOPTS}
eend $?
}

stop() {
ebegin "Stopping rsync daemon"
start-stop-daemon --stop --quiet --pidfile /var/run/rsyncd.pid
eend $?
}
</pre>
<p>Il vostro rsyncd.motd deve contenere il vostro indirizzo IP ed altre informazioni rilevanti, come informazione sul host ed un contatto amministrativo. Dopo l'approvazione come mirror rsync ufficiale, il vostro host sarà assegnato un alias nella forma di:
<path>rsync[num].[country code].gentoo.org</path>
</p>
</body>
</section>
</chapter>
</guide>
