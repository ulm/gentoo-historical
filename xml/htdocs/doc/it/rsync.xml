<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/it/rsync.xml" lang="it">
<title>Gentoo Linux rsync Mirrors Policy</title>
<author title="Autore">
 <mail link="mirror-admin@gentoo.org">Gentoo Mirror Administrators</mail>
</author>
<author title="Traduzione">
 <mail link="dragoon@interfree.it">Gerasimos Grammatikopoulos aka KiTaSuMbA</mail>
</author>
<author title="Traduzione">
 <mail link="sogentoo@katamail.com">sogentoo</mail>
</author>

<abstract>
Questo documento spiega come impostare un mirror ufficiale rsync.
</abstract>

<license/>

<version>1.4</version>
<date>29 Giugno 2004</date>

<chapter>
<title>Richiesta hardware</title> 
<section>
<title>Donazione delle macchine</title>
<body>

<p>
Gentoo Linux ha due differenti tipi di mirror: mirror principali di rotazione e mirror della comunità. I mirror principali di rotazione sono server dedicati a rsync e sono responsabili della cura dell'enorme quantità del nostro traffico rsync. Tutti i mirror principali di rotazione eseguono Gentoo Linux e sono controllati dai membri del team di sviluppo di Gentoo. I mirror della comunità sono server forniti e controllati dai membri della comunità. Questi server possono o meno essere dedicati all'uso di rsync e possono o meno eseguire Gentoo Linux.
</p>

<p>
Attualmente abbiamo abbastanza mirror della comunità, mentre stiamo cercando ulteriori mirror principali di rotazione. Le specifiche per i mirror principali di rotazione includono:
</p>
<ul>
<li>Minimo un processore Pentium 4 2GHz (o equivalente)</li>
<li>Minimo 1GB di RAM (1.5GB - 2GB è ideale)</li>
<li>10GB di spazio su disco (IDE va bene)</li>

</ul>

<p>
Questi server possono essere donati con la propria larghezza di banda e nella propria collocazione, se li avete. Altrimenti, possiamo fornire questi servizi e voi potete mandare la macchina nella nostra collocazione. Il consumo medio della larghezza di banda per un mirror principale di rotazione è di circa 7Mbps. Questo numero dovrebbe diminuire, poichè aumenta il numero di mirror principali di rotazione.
</p>

<p>
Se desiderate donare la vostra macchina, mandate un'e-mail con tutte le informazioni a <mail link="jforman@gentoo.org">Jeffrey Forman</mail>.
</p>

</body>
</section>
</chapter>
<!--
<chapter>
<title>Requisiti</title>
<section>
<title>Minima Larghezza di Banda (Bandwidth)</title> 
<body>

<p>
Per ospitare in maniera appropriata un mirror dovrete avere un minimo di banda full duplex (sia upload che download) pari a 5Mbps.
</p>

</body>
</section>
<section>
<title>Minimo Conto di Utenti</title>
<body>

<p>
Vi chiediamo di supportare un minimo di 15 simultanee connessioni di utenti.
</p>

</body>
</section>
<section>
<title>Hardware Minimo</title>
<body>

<p>
Per servire efficacemente almeno 15 simultanee connessioni di utenti, chiediamo che abbiate almeno i seguenti requisiti hardware minimi:
</p>

<ul>
<li>Processore PIII 500</li>
<li>256MB RAM</li>
</ul>

</body>
</section>
<section>
<title>Frequenza di Aggiornamento</title>
<body>

<p>
Aggiornamenti del mirror devono occorrere a :00 e :30 di ogni ora, 24 ore al giorno. E' <e>molto</e> importante che questo orario viene seguito strettamente siccome usiamo un stile di DNS "round robin" per selezionare il server rsync degli utenti.
</p>

</body>
</section>
<section>
<title>MOTD (/etc/rsync/rsyncd.motd)</title>
<body>

<p>
Per favore, includete le informazioni seguenti nel vostro file MOTD di rsync:
</p>

<ul>
	<li>nome del server</li>
	<li>indirizzo IP del server</li>
	<li>specifiche tecniche del server (CPU e RAM)</li>
	<li>larghezza di banda disponibile al server</li>
	<li>limite di connessioni utente, se esiste</li>
	<li>collocazione del server (città e paese)</li>
	<li>un nome ed indirizzo e-mail per contatti</li>
</ul>

<p>
Includendo le informazioni sovrastanti nel vostro MOTD rende facile identificare il vostro mirror in caso di problemi.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Dettagli di Implementazione</title>
<section>
<body>

<p>
Per impostare un nuovo mirror, seguite i passi descritti in seguito:
</p>

<ul>
	<li>Impostate il vostro mirror a sincronizzarsi con un pubblico rsync mirror di Gentoo Linux già esistente. Non ha importanza quale. Assicuratevi di sincronizzare in accordo con il nostro orario di <e>Frequenza di Aggiornamento</e> come descritto sopra.</li>
	<li>Compilate un "bug report" a <uri link="http://bugs.gentoo.org">bugs.gentoo.org</uri> che contiene il nome della vostra organizzazione, nome di server, indirizzo IP, informazioni di contatto e il fatto che intendete diventare un nuovo mirror rsync. Esamineremo il vostro server per assicurare che si sincronizza in maniera appropriata. E' importante che il vostro server si sincronizzi due volte in un'ora, con la prima sincronizzazione tra :00 e :10, e la seconda tra :30 e :40. Potete selezionare queste due in qualsiasi momento, con finestre di 10 minuti per programmare la vostra sincronizzazione.</li>
	<li>Verificata la corretta sincronizzazione, aggiungeremo l'indirizzo IP del server nella lista di accesso di rsync1.us.gentoo.org.</li>
	<li>Aggiornate il vostro cron job di rsync a puntare su <path>rsync1.us.gentoo.org</path>.  Il vostro server sarà monitorato per le prossime 48-72 ore per assicurare la corretta sincronizzazione.</li>
</ul>

<p>
Se tutti i passi sono stati seguiti senza problemi, imposteremo un DNS entry del tipo <path>rsync[num].[countrycode].gentoo.org</path> ufficiale e vi aggiungeremo nel nostro DNS round-robin per rsync.[continentcode].gentoo.org e rsync.[countrycode].gentoo.org. Brevemente dopo essere stati aggiunti al nostro DNS, dovreste vedere traffico rsync.
</p>

<p>
Ulteriormente l'amministratore del mirror verra' aggiunto alla mailing list di gentoo mirrors (lista a basso traffico) così da poter seguire tutte le tematiche riguardanti i mirror rsync.
</p>

<note>
Grazie per l'aiuto verso gli utenti e sviluppatori di Gentoo Linux! :) Per ogni tema o problema sulla amministrazione di rsync, visitate <uri
link="http://bugs.gentoo.org">http://bugs.gentoo.org</uri> e compilate un "bug report" sul prodotto "Rsync".
</note>

</body>
</section>
</chapter>

<chapter>
<title>Task Paralleli</title>
<section>
<body>
<p> Presto avremo una pagina creata con rrdtool che conterà semplicemente dei link a grafici (ordinati per continente, paese, server) della disponibilità di mirror rsync ufficiali (questi grafici saranno prodotti da risultati di sping).
I grafici saranno controllati almeno una volta al giorno, e le macchine non raggiungibili verranno rimosse dallo schema di RR DNS finchè i problemi sono risolti. Avremo scripts che controlleranno che ogni 30 minuti tutti i mirror si stanno effettivamente sincronizzando con noi.
</p>

<warn>
Se un mirror presenta periodicamente dei problemi e, mentre l'amministratore è stato contattato, la situazione non migliora, la macchina verrà rimossa dallo schema RR in maniera permanente.
</warn>

</body>
</section>
</chapter>
-->
<chapter>
<title>Breve FAQ (fornito come un riferimento per gli amministratori di mirror)</title>
<section>
<title>Q: Chi dovrei contattare per problemi e la manutenzione di rsync?</title>
<body>

<p>
A: Visita http://bugs.gentoo.org e crea un bug sul prodotto "Rsync".
</p>

</body>
</section>
<section>
<title>Q: Mantengo un mirror rsync privato per la mia ditta. Posso accedere a rsync1.us.gentoo.org comunque?</title>
<body>

<p>
A: Visto che le nostre risorse sono limitate, dobbiamo assicurare di usarle in maniera tale da offrire il massimo beneficio ai nostri utenti. Così, limitiamo le connessioni nel nostro master rsync e distfile mirror solo a mirror pubblici. Gli utenti sono benvenuti a usare il nostro sistema di mirror normale per stabilire un mirror rsync privato, anche se richiesti di seguire certe <uri link="http://www.gentoo.org/news/en/gwn/20030505-newsletter.xml#doc_chap1_sect3">linee guida di etiquette per rsync</uri> di base.
</p>

</body>
</section>
<section>
<title>Q: E' importante che sincronizzo il mio mirror due volte in un'ora?</title>
<body>
<p>A: Sì è importante. Non dovete effettuare le sincronizzazioni esattamente a :00 e a :30, ma dovrebbero avvenire fra le due finestre seguenti:
</p>

<ol>
     <li>:00 e :10</li>
     <li>:30 e :40</li>
</ol>

<p>
Assicuratevi ulteriormente che le vostre sincronizzazioni siano fatte ogni 30 minuti. Così, se programmate la prima sincronizzazione di ogni ora a :08, programmate la seconda a :38.
</p>

</body>
</section>
<section>
<title>Q: Come trovo il mirror più vicino a me?</title>
<body>

<p>
A: netselect è stato designato per fare questo per voi. Se non avete già eseguito <c>emerge netselect</c> fatelo.
Eseguite: <c>netselect rsync.gentoo.org</c>. Dopo circa un minuto netselect vi darà un indirizzo IP.
Copiate questo indirizzo e usatelo come unico parametro per rsync con due "due punti" appesi a esso.
per es.: <c>rsync 1.2.3.4::</c>. Dovreste poter capire di quale mirror si tratta dal messaggio di benvenuto. Aggiornate il vostro /etc/make.conf  in accordo.
</p>

</body>
</section>
<section>
<title>Q: Posso usare la compressione nella sincronizzazione con rsync1.gentoo.org?</title>
<body>

<p>
A: No. La compressione utilizza troppe risorse sul server, così l'abbiamo disabilitata con forza su <path>rsync1.us.gentoo.org</path>. Per favore <e>non</e> tentate di usare la compressione nel sincronizzarvi a quel server.
</p>

</body>
</section>
<section>
<title>Q: Ci sono parecchi processi di rsync vecchi e probabilmente guasti, come posso eliminarli?</title>
<body>

<p>
A: Vedere la sezione Script di Esempio.
</p>

</body>
</section>
<section>
<title>Q: Ci sono molti utenti che si connettono al mio server rsync troppo frequentemente, a volte causando un DoS al mio mirror, c'è un modo per impedirlo?</title>
<body>

<p>
A: Di nuovo, vedere la sezione Script di Esempio.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Script di Esempio</title>
<section>
<body>

<p>
Attualmente, avere un mirror del nostro Portage tree richiede circa 250Mb, quindi non consuma molto spazio; avendo almeno 500Mb disponibili dovrebbe permettere future espansioni. Impostare un mirror del Portage tree è semplice -- prima, assicuratevi che sul vostro mirror è installato rsync. Quindi, impostate il vostro file rsyncd.conf in maniera simile alla seguente:
</p>

<pre caption="rsyncd.conf">
uid = nobody
gid = nobody
use chroot = yes
max connections = 15
pid file = /var/run/rsyncd.pid
motd file = /etc/rsync/rsyncd.motd
log file = /var/log/rsync.log
transfer logging = yes
log format = %t %a %m %f %b
syslog facility = local3
timeout = 300

[gentoo-x86-portage]
#this entry is for compatibility
path = /space/gentoo/rsync
comment = Gentoo Linux Portage tree


[gentoo-portage]
#modern versions of portage use this entry
path = /gentoo/rsync
comment = Gentoo Linux Portage tree mirror
exclude = distfiles
</pre>

<p>
Sopra, il mirror gentoo-x86-portage punta sugli stessi dati di gentoo-portage. Nonostante abbiamo recentemente cambiato il nome ufficiale del nostro mirror a gentoo-portage, gentoo-x86-portage serve ancora per ragioni di compatibilità, quindi includete entrambi campi.
</p>

<p>
Per motivi di sicurezza, è richiesto l'uso dell'ambiente chrooted!
</p>

<p>
Adesso, bisogna fare il mirror del Gentoo Linux Portage tree. Usate lo script di seguito:
</p>
<pre caption="rsync-gentoo-portage.sh">
#!/bin/bash

RSYNC="/usr/bin/rsync"
OPTS="--quiet --recursive --links --perms --times --devices --delete --timeout=300"
#Uncomment the following line only if you have been granted access to rsync1.us.gentoo.org
#SRC="rsync://rsync1.us.gentoo.org/gentoo-portage"
#If you are waiting for access to our master mirror, select one of our mirrors to mirror from:
SRC="rsync://rsync2.de.gentoo.org/gentoo-portage"
DST="/space/gentoo/rsync/"

echo "Started update at" `date` >> $0.log 2>&amp;1
logger -t rsync "re-rsyncing the gentoo-portage tree"
${RSYNC} ${OPTS} ${SRC} ${DST} >> $0.log 2>&amp;1

echo "End: "`date` >> $0.log 2>&amp;1
</pre>

<pre caption="/etc/init.d/rsyncd">
#!/sbin/runscript
# Copyright 1999-2004 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# &#36;Header: /var/cvsroot/gentoo-x86/net-misc/rsync/files/rsyncd.init.d,v 1.2 2004/05/02 22:45:02 mholzer Exp &#36;
depend() {
need net
}

# FYI: --sparce seems to cause problems.
RSYNCOPTS="--daemon --safe-links --timeout=300"

start() {
ebegin "Starting rsync daemon"
start-stop-daemon --start --quiet --pidfile /var/run/rsyncd.pid --nicelevel 15 --exec /usr/bin/rsync -- ${RSYNCOPTS}
eend $?
}

stop() {
ebegin "Stopping rsync daemon"
start-stop-daemon --stop --quiet --pidfile /var/run/rsyncd.pid
eend $?
}
</pre>

<p>
Il vostro rsyncd.motd deve contenere il vostro indirizzo IP ed altre informazioni rilevanti, come informazione sull'host ed un contatto amministrativo. Dopo l'approvazione come mirror rsync ufficiale, al vostro host sarà assegnato un alias nella forma di:
<path>rsync[num].[country code].gentoo.org</path>
</p>

<p>
Questo comando vi aiuterà a eliminare vecchi processi di rsync, che a volte si trovano perchè causati da problemi di connessione. E' importante eliminarli poichè contano come connessioni valide nell'opzione 'connessioni massime'. Potete eseguire questo comando ogni ora con crontab, cercherà e eliminerà i processi di rsync più vecchi di un'ora.
</p>

<pre caption="Eliminare i vecchi processi di rsync">
/bin/kill -9 `/bin/ps --no-headers -Crsync -o etime,user,pid,command|/bin/grep nobody | \
  	              /bin/grep "[0-9]\{2\}:[0-9]\{2\}:" |/bin/awk '{print $3}'`
</pre>

<p>
In alcuni casi, ci sono utenti che abusano del sistema mirror rsync, sincronizzando più di 1-2 volte al giorno. Nei casi più estremi, utenti programmano cron per far sincronizzare ogni 15 minuti. Ciò porta ad un attacco di tipo Denial of Service, occupando continuamente uno slot di sincronizzazione che potrebbe essere usato da un altro utente. Per cercare di impedire questi attacchi, potete usare il seguente <uri link="/proj/en/infrastructure/mirrors/rsyncd.conf_pl.txt">perl script</uri>, che esplorerà i vostri log file rsync, selezionerà gli indirizzi IP che sono stati connessi quel giorno per più di <c>N</c> volte, e creerà un file rsyncd.conf includendo gli indirizzi IP 'hosts deny'. La riga seguente controlla a quanto è uguale <c>N</c>:
</p>

<pre caption="Definire il massimo numero di connessioni per IP">
@badhosts=grep {$hash{$_}>4} keys %hash;
</pre>

<p>
Se usate questo script, ricordatevi di ruotare giornalmente i vostri log file rsync, e modificare lo script per abbinare la posizione del vostro file rsyncd.conf. Questo script è testato su Gentoo Linux, ma dovrebbe funzionare su altre architetture che supportano sia rsync che perl.
</p>

</body>
</section>
</chapter>
</guide>
