<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/gentoo-sparc-netboot-howto.xml,v 1.4 2007/12/12 22:18:51 scen Exp $ -->

<guide link="/doc/it/gentoo-sparc-netboot-howto.xml" lang="it">
<title>Guida al Netboot su Gentoo Linux</title>

<author title="Sviluppatore SPARC">
  <mail link="weeve@gentoo.org">Jason Wever</mail>
</author>
<author title="Traduttore">
  <mail link="luna80@gmail.com">Diana Fossati</mail>
</author>

<abstract>
Guida per impostare un server netboot da usare con l'immagine per
l'installazione netboot di Gentoo/SPARC.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.2</version>
<date>2005-08-18</date>

<chapter>
<title>Introduzione</title>
<section>
<body>

<note>
Questo documento è al momento centrato su SPARC e ha come scopo quello di fare
impostare il proprio server netboot su di una macchina con già installato Gentoo
Linux.
</note>

<p>
Questo documento descrive come impostare un ambiente con boot da rete per
sistemi Sun Microsystem SPARC o su computer basati su UltraSPARC. Questo
documento presuppone che si abbia già una macchina con Gentoo Linux da usare
come server di netboot.
</p>

<p>
Siccome il protocollo ARP tipicamente non redirige su differenti subnet di rete,
entrambi i netboot server e netboot client necessitano di essere nella stessa
subnet.
</p>

<p>
Una panoramica generica di quanto succede durante il processo di netboot è la
seguente:
</p>

<ol>
  <li>
    Il client invia una richiesta ARP inversa (RARP) per avere un indirizzo IP.
  </li>
  <li>Una macchina server ritorna la risposta al client con l'indirizzo IP:</li>
  <li>
    Il client può così tentare di scaricare un immagine di boot dal server RARP
    utilizzando il protocollo tftp.
  </li>
  <li>Quando l'immagine è scaricata, il client netboot avvia l'immagine.</li>
</ol>

<p>
In base a questa panoramica, c'è la necessità di installare un demone ARP e un
demone tftp.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installazione del software e configurazione</title>
<section>
<title>Il demone per ARP</title>
<body>


<p>
AL momento, ci sono due possibili scelte per un demone ARP. Queste due scelte
sono net-misc/iputils (installato come parte del profilo di sistema) e
net-misc/rarpd.
</p>

<note>
L'installazione di net-misc/rarpd sovrascrive rarpd e le pagine del manuale
rarpd di net-misc/iputils.
</note>

<p>
<b>Impostazione di elementi comuni per rarpd</b>: <path>/etc/ethers</path>
</p>

<p>
Non importa quale rarpd si decida di utilizzare, bisogna impostare il file
<path>/etc/ethers</path> in entrambe i casi. Il file indica quali host rarpd
devono rispondere quando viene inviata una richiesta, e a che indirizzo devono
rispondere.
</p>

<p>
Il file <path>/etc/ethers</path> deve contenere l'indirizzo MAC della periferica
di rete da cui si dovrà fare il netboot e il suo hostname. Gli spazi delimitano
gli indirizzi MAC dal nome dell'host e ogni copia MAC hostname deve essere su di
una riga. Il seguente esempio per per un host chiamato sparc-netboot.gentoo.org:
</p>

<pre caption="Esempio di /etc/ethers">
08:00:20:77:1f:3e  sparc-netboot.gentoo.org
</pre>

<note>
Se l'indirizzo MAC inizia o è 0, si può scegliere di omettere il primo 0 (per
esempio 08:00:20:77:1f:3e diventa 8:0:20:77:1f:3e).
</note>

<p>
Siccome il file <path>/etc/ethers</path> viene controllato ogni volta che viene
ricevuta una richiesta, quando si aggiunge un nuovo host non c'è bisogno di
riavviare il servizio rarpd.
</p>

<p>
<b>Traduzione degli hostnames</b>: <path>/etc/hosts</path>
</p>

<p>
Dal momento che ogni elemento del file <path>/etc/ethers</path> possiede un
hostname, il server netboot necessita di poter tradurre il nome dell'host con il
suo relativo indirizzo IP. Questo può essere fatto in due modi: tramite
<path>/etc/hosts</path> oppure tramite il nameserver del server netboot.
</p>

<p>
Un elemento del file <path>/etc/hosts</path> deve essere molto simile a quello
che probabilmente esiste da quando si ha installato Gentoo sul server netboot.
Per esempio, per il proprio host, sparc-netboot.gentoo.org, presupporre che
abbia  un IP 10.0.1.15. Così il file <path>/etc/hosts</path> sarà simile a:
</p>

<pre caption="/etc/hosts">
10.0.1.15  sparc-netboot.gentoo.org
</pre>

<note>
In base all'ambiente, per avviare l'host da rete si potrebbe avere la necessità
di dover consultare l'amministratore di rete per avere un indirizzo IP oppure
l'indirizzo del server.
</note>

<p>
Se si usa un nameserver, l'amministratore del server DNS deve aggiungere un
record per l'hostname, nell'esempio di questa guida sparc-netboot.gentoo.org,
deve puntare ad un appropriato indirizzo IP. Consultare il proprio
amministratore del server DNS e/o la documentazione per il software DNS del
server DNS per sapere come aggiungere un elemento.
</p>

<note>
Se sia <path>/etc/hosts</path> che il nameserver hanno un elemento per l'host
che necessita di fare in boot da rete, viene usato per primo
<path>/etc/hosts</path> (a meno che l'ordine di <path>/etc/nsswitch.conf</path>
non sia diverso da quello predefinito).
</note>

<p>
<b>Impostare net-misc/iputils rarpd</b>
</p>

<p>
Anche se ci sono più opzioni di quelle spiegate qui, queste opzioni dovrebbero
permettere di cominciare. Dato che attualmente non c'è nessuno script init.d
per la versione rarpd di net-misc/putils, un'aggiunta sarà necessaria al file
<path>/etc/conf.d/local.start</path> se si vogliono abilitare i servizi rarpd
all'avvio. Un esempio di aggiunta è la seguente;
</p>

<pre caption="/etc/conf.d/local.start">
/usr/sbin/rarpd -v -e eth0
</pre>

<p>
La spiegazione dell'opzione mostrata è questa (presa dal man):
</p>

<ul>
  <li>-v modo verbose</li>
  <li>
    -e non controlla la presenza di un'immagine di boot, risponde se
    l'indirizzo MAC si traduce in un IP valido utilizzando /etc/ethers e il DNS
  </li>
  <li>eth0 rappresenta l'interfaccia rarpd da associare</li>
</ul>

<p>
Per maggiori informazioni, consultare la sezione 8 delle pagine man di rarpd
</p>

<p>
<b>Impostazioni per net-misc/rarpd</b>
</p>

<p>
Prima bisogna installare rarpd con il seguente comando:
</p>

<pre caption="Installazione di rarpd">
# <i>emerge net-misc/rarpd</i>
</pre>

<p>
Poi, si devono impostare le opzioni in <path>/etc/conf.d/rarpd</path>. Per una
configurazione equivalente a quella utilizzata precedentemente per
/net-misc/iputils, sistemare <path>/etc/conf.d/rarpd</path> in modo che
assomigli al seguente esempio:
</p>

<pre caption="/etc/conf.d/rarpd">
RARPD_OPTS="-v -i eth0"
</pre>

<p>
La spiegazione di questo comando (presa dal man):
</p>

<ul>
  <li>
    <c>-v</c> modo prolisso. Visualizza le richieste a cui il demone sta
    ripondendo.
  </li>
  <li>
    <c>-i</c> associa all'interfaccia menzionata. L'impostazione predefinita
    prevede che rarpd associ l'interfaccia predefinita per il tipo di sistema
    locale, se disponibile.
  </li>
</ul>

<p>
Per maggiori informazioni, consultare la sezione 8 nelle pagine man di rarpd e
rarpd --help.
</p>

</body>
</section>
<section>
<title>Il servizio tftpd</title>
<body>

<p>
La scelta di un demone tftp si basa su tre possibilità, net-misc/atftp,
net-misc/netkit-tftp e net-misc/tftp-hpa. Per operare correttamente bisogna
installare soltanto uno di questi tre.
</p>

<p>
<b>Impostazione degli elementi comuni di tftpd</b>
</p>

<p>
Ogni servizio tftp necessita di una directory in cui mettere i file per i client
tftp. La directory che verrà usata in questa guida sarà /tftpboot. Quando le
richieste dei client verranno ricevute, tale directory apparirà come la
directory root (<path>/</path>) per i client. Si può inoltre dire al servizio
tftp di girare con utente e gruppo nobody.
</p>

<p>
Se la directory scelta non esiste ancora, deve essere creata con il comando
mkdir. Il comando di esempio per /tftpboot è;
</p>

<pre caption="Creazione della directory /tftpboot">
# <i>/bin/mkdir /tftpboot</i>
</pre>

<p>
Dopo bisogna cambiare il proprietario di <path>/tftpboot</path> in modo che sia
dell'utente nobody e gruppo nobody.
</p>

<pre caption="Cambiamento del proprietario">
# <i>chown nobody:nobody /tftpboot</i>
</pre>

</body>
</section>
<section>
<title>Il servizio atftp</title>
<body>

<p>
Per prima cosa, installare il pacchetto net-misc/atftp come segue;
</p>

<pre caption="Installazione di atftp">
# <i>emerge net-misc/atftp</i>
</pre>

<p>
Dopo che il pacchetto net-misc/atftp è stato installato, deve essere
configurato. Se si desidera che il servizio tftp sia avviato ad ogni boot è
necessario inserirlo nel file <path>/etc/conf.d/local.start</path> in quanto
tftp non ha un suo init.d, inetd o xinetd script. Se si vuole usare inetd o
xinetd per controllare il servizio tftp, guardare le loro rispettive pagine man.
</p>

<p>
Qui sotto è mostrato un esempio di file <path>/etc/conf.d/local.start</path>
per atftpd;
</p>

<pre caption="/etc/conf.d/local.start">
/usr/sbin/in.tftpd -v --daemon /tftpboot
</pre>

<p>
La spiegazione del comando appena mostrato è (presa dalle pagine man);
</p>

<ul>
  <li>
    <c> -v</c> Aumenta o imposta il livello di log. Nessun argomento aumenta di
    uno il valore corrente. Come impostazione predefinita il livello è
    LOG_NOTICE, guardare syslog(3) per il livello di log. I livelli disponibili
    sono da 0 (LOG_EMERG) a 7 (LOG_DEBUG).
  </li>
  <li>
    <c>--daemon</c> Gira come demone. Non usare questa opzione se atftpd viene
    avviato tramite inetd.
  </li>
</ul>

<p>
Per maggiori informazioni, consultare la sezione 8 delle pagine man di atfptd.
</p>

</body>
</section>
<section>
<title>Il servizio netkit-tftp</title>
<body>

<p>
Per prima cosa, installare il pacchetto net-misc/tftp come segue;
</p>

<pre caption="Installazione di netkit-tftp">
# <i>emerge net-misc/netkit-tftp</i>
</pre>

<p>
Successivamente, se non è già presente sul sistema installare sys-apps/xinetd.
Dopo che net-misc/netkit-tftp e sys-apps/xinetd sono stati installati, è
necessario configurare netkit-tftp. netkit-tftp necessita di girare da xinetd,
tuttavia non dispone di propri script d'esempio. Un esempio di file xinetd è
fornito qui sotto;
</p>

<pre caption="Esempio di /etc/xinetd.d/tftp">
service tftp
{
    protocol        = udp
    port            = 69
    socket_type     = dgram
    wait            = yes
    user            = nobody
    group           = nobody
    server          = /usr/sbin/in.tftpd
    server_args     = /tftpboot
    only_from       = 10.0.1.0
    disable         = no
}
</pre>

<note>
Questo esempio di configurazione per tftp utilizza la riga "disable = no", che
abilita il servizio in modo predefinito. Questa opzione è opposta a quella
fornita dai pacchetti di Gentoo, che per impostazione predefinita prevedono di
avere i relativi file xinetd con disable impostato a yes.
</note>

<p>
La spiegazione delle opzioni appena mostrate può essere cambiata;
user        user in.tftpd.Le richieste tftpd sono gestite da
group       group in.tftpd.Le richieste tftpd sono gestite da
server_args root directory per il demone tftp daemon dal quale fornire i file
only_from   dice a xinetd quali host sono autorizzati a ricevere connessioni da
            tftp
</p>

<p>
Maggiori informazioni sulla configurazione di xinetd possono essere trovate
nella sezione 5 delle pagine man di xinetd.
</p>

<p>
Se xinetd è avviato, è possibile inviargli il segnale HUP per fargli rileggere i
suoi file di configurazione;
</p>

<pre caption="Invio del segnale HUP a xinetd">
# <i>/bin/killall -HUP xinetd</i>
</pre>

<p>
Se xinetd non è avviato, avviarlo con il comando init.d;
</p>

<pre caption="Avvio di xinetd">
# <i>/etc/init.d/xinetd start</i>
</pre>

<p>
Per maggiori informazioni, consultare la sezione 8 delle pagine man di in.tftpd.
</p>

</body>
</section>
<section>
<title>Il demone tftp-hpa</title>
<body>
<p>
Prima di tutto, installare il pacchetto tftp-hpa usando il seguente comando;
</p>

<pre caption="Installazione di tftp-hpa">
# <i>emerge net-misc/tftp-hpa</i>
</pre>

<p>
tftp-hpa possiede un suo init.d ed il relativo file di configurazione conf.d.
Controllare per sicurezza che INIITFTPD_PATH e INITFTP_OPTS in
<path>/etc/conf.d/in.tftpd</path> siano impostati come nel seguente esempio;
</p>

<pre caption="/etc/conf.d/in.tftpd">
INTFTPD_PATH="/tftpboot"
INTFTPD_OPTS="-s -v -l ${INTFTPD_PATH}"
</pre>

<p>
Il demone tftp può ora essere avviato tramite lo script init.d;
</p>

<pre caption="Avviare in.tftpd">
# <i>/etc/init.d/in.tftpd start</i>
</pre>

<p>
Per maggiori opzioni, consultare la sezione 8 delle pagine man di tftpd.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Preparazione di una immagine tftpboot utilizzabile dal client</title>
<section>
<body>

<p>
Assicurarsi di avere un'immagine da usare per l'avvio da rete. Per avere
un'appropriata immagine per il boot da rete per macchine sparc o sparc64 cercare
in un mirror locale per i distfiles di Gentoo sotto
<path>experimental/sparc/tftpboot</path>.  Ora assumere che si stia pianificando
di avviare un host sparc64 usando l'immagine
<path>gentoo-sparc64-1.4_rc4-20040102.tftpboot</path>.
</p>

<p>
dopo aver recuperato l'immagine, copiarla in <path>/tftpboot</path>;
</p>

<pre caption="Copiare l'immagine">
# <i>cp gentoo-sparc64-1.4_rc4-20040102.tftpboot /tftpboot</i>
</pre>

<p>
Adesso, quando il client netboot fa una richiesta tftp, controlla l'essistenza
di un file che è il numero esadecimale del suo corrente indirizzo IP, e in
alcune piattaforme un suffisso <path>.ARCH</path>. Il numero esadecimale deve
essere formato da caratteri in <e>stampatello</e>.
</p>

<p>
Una guida per la conversione decimale-esadecimale è disponibile all'indirizzo
<uri>http://www.permadi.com/tutorial/numDecToHex/</uri>
</p>

<p>
E per i pigri/impazienti, si può trovare uno strumento di conversione
decimale-esadecimale all'indirizzo <uri>http://dan.drydog.com/hextemp.html</uri>
</p>

<note>
Bisognerà convertire ogni ottetto dell'IP (il 10 in 10.0.1.15 per esempio), in
esadecimale e non convertire l'intero numero IP in una sola volta.
</note>

<p>
Per l'IP d'esempio in questa guida, 10.0.1.15, l'equivalente in esadecimale
sarà;
</p>

<pre caption="Esempio di indirizzo IP">
decimale       10  0   1   15
esadecimale    0A  00  01  0F
</pre>

<p>
Così, il proprio client netboot sparc64, quando farà un boot tftp cercherà un
file chiamato 0A00010F.
</p>

<p>
Su sparc, invece, il file dovrà essere 0A00010F.SUN4M, 0A00010F.SUN4C o
0A00010F.SUN4D in base al sistema sparc.
</p>

<p>
Se si è veramente pigri (come l'autore di questa guida), per avere il nome del
file corretto si può far fare il netboot dell'host e poi guardare nei log del
server per vedere quale file viene cercato.
</p>

<p>
Assicurarsi che entrambi i servizi rarpd e tftpd scelti in precedenza siano
avviati, poi avviare l'host come descritto nel capitolo "Netboot del client"
</p>

<p>
Il client viene avviato dopo che è stato dato il comando per l'avvio da rete.
Controllare in seguito il log di sistema per individuare un riferimento a
in.tftpd.
</p>

<p>
L'esempio di una linea aggiunta al log di un netboot server che utilizza
sysklogd e tftp-hpa assomiglierà alla seguente;
</p>

<pre caption="Log per un netboot server">
Jan  3 22:48:59 stargazer in.tftpd[8368]: RRQ from 10.0.1.15 filename 0A00010F
</pre>

<p>
Il nome del file è mostrato sopra, dopo "filename" della linea del log che in
questo caso è 0A00010F.
</p>

<p>
Un modo per tenere sotto controllo quale immagine netboot si sta usando e per
permettere a più macchine di usare la stessa immagine, è quello di usare un link
simbolico per creare il file con il valore esadecimale. Per creare questa
immagine, usando in nostro esempio per sparc64 e
<path>gentoo-sparc64-1.4_rc4-20040102.tftpboot</path>, usare il seguente
comando;
</p>

<pre caption="Creare un collegamento al file d'immagine">
# <i>/bin/ln -s /tftpboot/gentoo-sparc64-1.4_rc4-20040102.tftpboot \
/tftpboot/0A00010F</i>
</pre>

<p>
Adesso tutto è impostato per l'avvio da rete!
</p>

</body>
</section>
</chapter>

<chapter>
<title>Netboot del client</title>

<section>
<body>

<p>
Sun SPARC, da OpenBoot PROM (OBP), dare il comando;
</p>

<pre caption="Boot di OBP">
ok <i>boot net</i>
</pre>

<p>
Alternativa per alcune macchine:
</p>

<pre caption="Boot di OBP, alternativa">
ok <i>boot net-tpe</i>
</pre>

<note>
Se il proprio sistema al boot non si presenta con OBP, bisognerà premere i tasti
Stop e A, o inviare un segnale di break dalla console seriale prima che il
sistema avvii il sistema operativo. Se la propria macchina non trova un sistema
operativo, si può anche provare il boot dall'interfaccia di rete (che è quello
che si desidera) o restituire un prompt di OBP.
</note>

<p>
Questo inizializza il processo di avvio da rete. Verranno visualizzate delle
stringhe esadecimali. Quando l'immagine avrà finito di essere caricata,
interverrà il kernel che avvierà il processo di boot del sistema operativo. In
questo caso con sparc64, si verrà lasciato ad una shell dalla quale puoi
iniziare il processo di installazione.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Problemi</title>
<section>
<body>

<p>
<b>Preparazione dei prerequisiti del software</b>
</p>

<p>
Se il netboot server è un sistema Gentoo/Linux e si hanno problemi con
l'installazione dei pacchetti rarpd e tftpd, cercare su
<uri>http://forums.gentoo.org</uri> e <uri>http://bugs.gentoo.org</uri> per
vedere se i propri stessi problemi sono stati riscontrati da qualcun'altro. Se
non si trova niente, o la soluzione trovata non funziona, allora aprire un bug
su <uri>http://bugs.gentoo.org</uri>.
</p>

<p>
<b>È stato dato il comando per il netboot ma l'avvio si blocca</b>
</p>

<p>
Questo succede presumibilmente perchè il file system che si sta cercando di
caricare da tftpboot non è disponibile. Nei sistemi SPARC, si vedrà
probabilmente il seguente avviso;
</p>

<pre caption="L'avvio si blocca">
Rebooting with command: boot
Boot device: net  File and args:
</pre>

<p>
Controllare ancora che esista il file del client in <path>/tftpboot</path>.
Si può vedere il nome del file che viene richiesto nel log di sistema. Quando il
file richiesto esisterà, il client proverà a caricarlo. A volte, quando non c'è
il file, il client mette in attesa il download fino a quando il file compare.
Per risolvere questo problema, ritornare al prompt OBP, e dare nuovamente il
comando "boot net". L'host ora dovrebbe avviare il download dell'immagine
tftpboot ed avviare il sistema operativo.
</p>

<p>
<b>Si sta tentando di fare l'avvio da rete ma tutto quello che si vede è il
messaggio "Timeout waiting for ARP/RARP packet".
</b>
</p>

<p>
Questo può essere dovuto da diversi problemi;
</p>

<ol>
  <li>
    Assicurarsi che nel file <path>/etc/ethers</path> esista la voce per il
    client in questione. Se l'indirizzo MAC è sbagliato e/o il server non può
    associare il nome dell'host per il client, non può rispondere con le
    informazioni dovute.
  </li>
  <li>
    Verificare che lo switch o l'hub di rete che collegano server e client siano
    connessi e permettano al traffico RARP di viaggiare liberamente. Se la
    richiesta del client non può raggiungere il server, o vice versa, l'host non
    può procedere.
  </li>
  <li>
    Nessuno risponde alla richiesta del client perchè non ci sono servizi in
    ascolto. Verificare che il servizio rarpd è avviato correttamente.
  </li>
  <li>
    Il client non pensa che la sua interfaccia di rete sia collegata ad un
    hub/switch. Controllare che la porta dello switch o dell'hub relativa
    all'interfaccia di rete abbia il led acceso. Se il led è acceso, controllare
    le impostazioni di tpe-link-test? presenti in OBP con il comando;
    <c>printenv tpe-link-test?</c>. Si dovrebbe ricevere un messaggio tipo
    <path>tpe-link-test?  false     true</path>. La prima colonna rappresenta
    il nome del parametro, la seconda colonna, mostra il valore corrente del
    parametro, mentre la terza colonna mostra il valore predefinito per il
    parametro. Nell'esempio riportato, si può vedere che il valore corrente è
    false, che significa che il client non sta controllando se può stabilire la
    connessione con lo switch o l'hub prima di mandare una richiesta RARPD.
    Molte volte questa è la causa del problema.
  </li>
</ol>

<p>
Per cambiare i valori di tpe-link-test? tramite il prompt OBP, dare il seguente
comando;
</p>

<pre caption="Cambiamento del valore di tpe-link-test">
ok <i>setenv tpe-link-test? true</i>
tpe-link-test? =      true
</pre>

<p>
Questo mostra che il valore di tpe-link-test? è ora true. Provare di nuovo a
riavviare il client.
</p>

</body>
</section>
</chapter>
</guide>