<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/gentoo-x86+raid+lvm2-quickinstall.xml,v 1.6 2007/09/12 20:47:46 scen Exp $ -->

<guide link="/doc/it/gentoo-x86+raid+lvm2-quickinstall.xml" lang="it">
<title>Guida rapida all'installazione di Gentoo Linux x86 con RAID Software e
LVM2</title>

<author title="Autore">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Autore">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Autore">
  Steven Wagner
</author>
<author title="Traduttore">
  <mail link="lucamarturana@gmail.com">Luca Marturana</mail>
</author>
<author title="Traduzione">
  <mail link="deadhead@wooow.it">Andrea Perotti</mail>
</author>

<abstract>
La guida rapida all'installazione spiega il processo di installazione di Gentoo
senza però scendere molto nei particolari. Lo scopo di questa guida è quello di
permettere agli utenti di eseguire una installazione da stage3 con RAID
software e LVM2 in poco tempo. L'utente che vuole seguire questa guida deve già
avere precedenti esperienze con l'installazione di Gentoo Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>12</version>
<date>2007-09-11</date>

<chapter>
<title>Introduzione</title>
<section>
<body>

<p>
Questa guida contiene tutti i comandi necessari per una completa installazione
da stage3 con LVM2 e RAID software ed è indirizzata ad utenti avanzati. È
inoltre necessaria una connessione ad Internet per poter scaricare lo stage3 e
una snapshot di Portage.
</p>

<p>
Tutti i comandi che necessitano un pò di tempo per completare sono eseguiti con
<c>time</c> e quindi viene indicato il tempo di esecuzione. I tempi sono stati
registrati su un AMD 2000 1,66 Ghz, 512 Mb di RAM e due dischi SATA connessi ad
un controller hardware configurato come JBOD (cioè da Gentoo vengono visti due
dischi separati). Se si possiede un controller RAID "hardware" integrato nella
propria scheda madre, attenzione perché potrebbe <b>non</b> essere un vero e
proprio controller hardware, ma un cosiddetto "Fake" RAID.
</p>

<pre caption="Specifiche della macchina di test">
<comment>(Le seguenti specifiche e le informazioni sul tempo di esecuzione dei
programmi possono aiutare a fare una stima del tempo necessario per completare
l'installazione.)</comment>

# <i>grep bogo /proc/cpuinfo</i>
bogomips       : 3337.81

# <i>hdparm -tT /dev/sda /dev/sdb</i>
/dev/sda:
reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

/dev/sdb:
 Timing cached reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

# <i>grep MemTotal /proc/meminfo</i>
MemTotal:       509248 kB
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Guida rapida all'installazione</title>
<section>
<title>Supporto di installazione</title>
<body>

<p>
Scaricare un CD da uno dei <uri link="/main/en/mirrors.xml">mirror</uri>. Si
può trovare il CD minimal su <path>releases/x86/&lt;release&gt;/installcd
</path> oppure il LiveCD completo su <path>releases/x86/&lt;release&gt;/livecd
</path>. Il CD <e>minimal</e> è adatto solo per installazioni tramite Internet.
Il <e>LiveCD</e> completo invece può essere usato anche per installare senza
rete come spiegato nel <uri link="/doc/it/handbook/2007.0/handbook-x86.xml">
Manuale x86 2007.0 di Gentoo Linux</uri>. È raccomandato utilizzare il primo
metodo.
</p>

<p>
<uri link="/doc/it/faq.xml#isoburning">Masterizzare</uri> il CD e avviarlo.
</p>

</body>
</section>
<section>
<title>Avviare il CD</title>
<body>

<p>
Al prompt che appare al boot si può premere <c>F2</c> per vedere tutte le
opzioni che possono essere passate al kernel. Poi si può anche scegliere se
avviare il kernel <c>gentoo</c> o <c>gentoo-nofb</c>: il secondo disabilita il
framebuffer. Chi ha scelto di usare il LiveCD, non deve dimenticare di
aggiungere <c>nox</c> tra i parametri di boot in modo tale che l'ambiente
grafico non venga fatto partire all'avvio. Ci sono inoltre altre opzioni che
permettono di abilitare o disabilitare varie funzionalità. Se tutto va per il
verso giusto, l'hardware presente nel PC viene riconosciuto e tutti i moduli
vengono caricati. Se il kernel non riesce ad avviarsi correttamente o se il
computer si blocca durante la procedura di avvio, conviene aggiungere l'opzione
<c>nodetect</c> al boot in modo da caricare i moduli a mano che servono in
seguito.
</p>

<pre caption="Avviare il CD minimal">
Gentoo Linux Installation LiveCD                     http://www.gentoo.org
Enter to Boot; F1 for kernels  F2 for options.
boot: <i>gentoo-nofb</i>
  <comment>(oppure in caso di problemi)</comment>
boot: <i>gentoo-nofb nodetect</i>
</pre>

</body>
</section>
<section>
<title>Opzionale: caricare i moduli</title>
<body>

<p>
Chi ha usato l'opzione <c>nodetect</c>, dopo che il PC si è avviato, deve
caricare a mano i moduli necessari. È necessario abilitare la rete e poter
accedere ai propri dischi. Il comando <c>lspci</c> può essere molto utile per
identificare l'hardware presente nella macchina.
</p>

<pre caption="Caricare i moduli necessari">
livecd root # <i>lspci</i>
<comment>(Usare l'output di lspci per identificare i moduli necessari)</comment>

<comment>(Il seguente è solo un esempio, adattarlo al proprio hardware)</comment>
livecd root # <i>modprobe 3w-9xxx</i>
livecd root # <i>modprobe r8169</i>
</pre>

</body>
</section>
<section>
<title>Configurazione della rete</title>
<body>

<p>
Se la rete non funziona ancora, è possibile usare <c>net-setup</c> per
configurarla. Probabilmente prima di procedere bisogna caricare con
<c>modprobe</c> il modulo necessario per la propria scheda di rete. Se si
possiede una connessione ADSL, usare <c>pppoe-setup</c> e <c>pppoe-start</c>.
Chi invece ha un router ADSL, non ha bisogno di questi script perché è il router
che si occupa di stabilire la connessione. Per il supporto a PPTP, prima bisogna
prima modificare <path>/etc/ppp/chap-secrets</path> e
<path>/etc/ppp/options.pptp </path> e poi usare <c>pptp
&lt;server&nbsp;ip&gt;</c>.
</p>

<p>
Per la rete wireless, usare <c>iwconfig</c> per impostare i parametri della
scheda e poi usare <c>net-setup</c> oppure fare tutto manualmente con i vari
<c>ifconfig</c>, <c>dhcpcd</c> e <c>route</c>.
</p>

<p>
Se si usa una connessione tramite proxy, non bisogna dimenticare di esportare
le variabili necessarie: <c>http_proxy</c>, <c>ftp_proxy</c> e
<c>RSYNC_PROXY</c>.
</p>

<pre caption="Configurare la rete tramite procedura guidata">
livecd root # <i>net-setup eth0</i>
</pre>

<p>
In alternativa, è possibile configurare la rete manualmente. L'esempio seguente
assegna l'IP 192.168.1.10 al PC e usa 192.168.1.1 come router e server DNS.
</p>

<pre caption="Configurare la rete manualmente">
livecd root # <i>ifconfig eth0 192.168.1.10/24</i>
livecd root # <i>route add default gw 192.168.1.1</i>
livecd root # <i>echo nameserver 192.168.1.1 > /etc/resolv.conf</i>
</pre>

<p>
Il CD di installazione permette inoltre di avviare un server <c>sshd</c>,
aggiungere altri utenti al sistema, chattare su irc tramite <c>irssi</c> e
navigare in internet usando <c>lynx</c> o <c>links</c>.
</p>

</body>
</section>
<section>
<title>Opzionale: connettersi al nuovo sistema tramite ssh</title>
<body>

<p>
La funzionalità più interessante è sicuramente <c>sshd</c>. È possibile avviarlo
e connettersi da un'altra macchina per poter copiare e incollare i comandi
presenti in questa guida.
</p>

<pre caption="Avviare sshd">
livecd root # <i>time /etc/init.d/sshd start</i>
 * Generating hostkey ...
<comment>(sshd genera le chiavi e mostra più output)</comment>
 * starting sshd ...                            [ok]

real   0m13.688s
user   0m9.420s
sys    0m0.090s
</pre>

<p>
Adesso, impostare la password di root per il LiveCD in modo che ci si possa
connettere da un altro PC. Notare che abilitare root per connettersi con ssh
non è raccomandato in circostanze normali. Se non ci si fida della rete locale,
usare un password lunga e complessa, essa non verra comunque memorizzata perché
sparirà al prossimo riavvio.
</p>

<pre caption="Impostare la password di root">
livecd root # <i>passwd</i>
New UNIX password: <comment>inserire_una_password</comment>
Retype new UNIX password: <comment>inserire_una_password</comment>
passwd: password updated successfully
</pre>

<p>
In questo modo si può avviare un terminale da un altro PC e connettersi al
nuovo sistema, inoltre si può seguire il resto della guida da un'altra finestra
e copiare i comandi nel terminale.
</p>

<pre caption="Connettersi al nuovo sistema da un altro PC">
<comment>(Usare l'indirizzo IP del nuovo sistema)</comment>
$ <i>ssh root@192.168.1.10</i>
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
RSA key fingerprint is 96:e7:2d:12:ac:9c:b0:94:90:9f:40:89:b0:45:26:8f.
Are you sure you want to continue connecting (yes/no)? <i>yes</i>
Warning: Permanently added '192.168.1.10' (RSA) to the list of known hosts.
Password: <comment>inserire_la_password</comment>
</pre>

</body>
</section>
<section>
<title>Preparare i dischi</title>
<body>

<p>
Caricare i moduli per il RAID software e LVM2.
</p>

<pre caption="Caricare i moduli RAID e LVM2">
livecd ~ # <i>modprobe raid0</i>
livecd ~ # <i>modprobe raid1</i>
<comment>(sono disponibili pure raid5, raid6 and raid10)</comment>

livecd ~ # <i>modprobe dm-mod</i>
</pre>

<p>
Usare <c>fdisk</c> o <c>cfdisk</c> per creare il proprio schema di
partizionamento. I nomi dei dispositivi saranno probabilmente <path>/dev/sda
</path> e <path>/dev/sdb</path> se si usano dischi SATA o SCSI, mentre
<path>/dev/hda</path> e <path>/dev/hdb</path> per i dischi IDE. In questa
guida viene utilizzato il seguente schema:
</p>

<table>
  <tr>
    <ti/>
    <th><path>/dev/sda</path></th>
    <th><path>/dev/sdb</path></th>
    <th>Tipo</th>
  </tr>
  <tr>
    <th><path>/dev/md1</path></th>
    <th><path>/boot</path></th>
    <th><path>/boot</path></th>
    <ti>Raid-1 (mirroring)</ti>
  </tr>
  <tr>
    <th/>
    <th>swap</th>
    <th>swap</th>
    <ti>Partizioni normali</ti>
  </tr>
  <tr>
    <th><path>/dev/md3</path></th>
    <th><path>/</path></th>
    <th><path>/</path></th>
    <ti>Raid-1 (mirroring)</ti>
  </tr>
  <tr>
    <th><path>/dev/md4</path></th>
    <th colspan="2">Volumi LVM2</th>
    <ti>Raid-0 (striped)</ti>
  </tr>
</table>

<impo>
La partizione di avvio non può essere in RAID striping. Quindi non si può usare
nè raid-5 nè raid-0.
</impo>

<note>
Se si vuole una maggiore stabilità, si può creare un raid-1 (oppure raid-5) pure
per le partizioni di swap, così che un guasto ad uno dei dischi non causi la
corruzione della partizione di swap e il conseguente crash delle applicazioni
che la stavano usando. D'altro canto, se si vogliono migliorare le performance,
è meglio usare partizioni di swap distinte, in quanto il kernel effettuerà
automaticamente lo striping.
</note>

<pre caption="Creare le partizioni">
livecd ~ # <i>fdisk /dev/sda</i>
<comment>(Assicurarsi di assegnare come tipo fd)</comment>

<comment>(Il resto di questa guida utilizza il seguente schema di partizionamento)</comment>
livecd ~ # <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 299.9 GB, 299989204992 bytes
255 heads, 63 sectors/track, 36471 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1          11       88326   fd  Linux raid autodetect
/dev/sda2              12          61      401625   82  Linux swap / Solaris
/dev/sda3              62         311     2008125   fd  Linux raid autodetect
/dev/sda4             312       36471   290455200   fd  Linux raid autodetect

<comment>(Partizionate il secondo disco esattamente come al primo)</comment>
livecd ~ # <i>fdisk /dev/sdb</i>
</pre>

<p>
Quindi creare i nodi RAID:
</p>

<pre caption="Creare i dispositivi e i nodi">
livecd ~ # <i>mknod /dev/md1 b 9 1</i>
livecd ~ # <i>mknod /dev/md3 b 9 3</i>
livecd ~ # <i>mknod /dev/md4 b 9 4</i>

livecd ~ # <i>mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/sda1 /dev/sdb1</i>
mdadm: array /dev/md1 started.
livecd ~ # <i>mdadm --create /dev/md3 --level=1 --raid-devices=2 /dev/sda3 /dev/sdb3</i>
mdadm: array /dev/md3 started.
livecd ~ # <i>mdadm --create /dev/md4 --level=0 --raid-devices=2 /dev/sda4 /dev/sdb4</i>
mdadm: array /dev/md4 started.

<comment>(Attendere finché tutte le unità sono pronte)</comment>
livecd ~ # <i>cat /proc/mdstat</i>
Personalities : [raid0] [raid1]
md4 : active raid0 sdb4[1] sda4[0]
581006592 blocks 64k chunks

md3 : active raid1 sdb3[1] sda3[0]
1959808 blocks [2/2] [UU]

md1 : active raid1 sdb1[1] sda1[0]
88256 blocks [2/2] [UU]
</pre>

<p>
Creare quindi i volumi LVM2 in <path>/dev/md4</path>. Il seguente schema viene
utilizzato come <b>esempio</b>:
</p>

<table>
<tr>
  <th>Directory</th>
  <th>Dimensione</th>
  <th>Filesystem</th>
</tr>
<tr>
  <ti>/usr</ti>
  <ti>8 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/usr/portage</ti>
  <ti>2 GB</ti>
  <ti>ext2, dimensione dei blocchi ridotta, molti inode</ti>
</tr>
<tr>
  <ti>/usr/portage/distfiles</ti>
  <ti>4 GB</ti>
  <ti>ext2, blocchi più grandi, pochi inode</ti>
</tr>
<tr>
  <ti>/home</ti>
  <ti>10 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/opt</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var/tmp</ti>
  <ti>6 GB</ti>
  <ti>ext2</ti>
</tr>
<tr>
  <ti>/tmp</ti>
  <ti>2 GB</ti>
  <ti>ext2</ti>
</tr>
</table>

<pre caption="Creare i volumi LVM2">
livecd ~ # <i>vgscan</i>
  Reading all physical volumes.  This may take a while...
  No volume groups found
livecd ~ # <i>vgchange -a y</i>
  No volume groups found

<comment>(Creare i volumi fisici, in questo esempio ce n'è solo uno)</comment>
livecd ~ # <i>pvcreate /dev/md4</i>
  Physical volume "/dev/md4" successfully created

<comment>(Creare i gruppi, in questo esempio ce n'è solo uno)</comment>
livecd ~ # <i>vgcreate vg /dev/md4</i>
  Volume group "vg" successfully created

<comment>(Creare i volumi logici)</comment>
livecd ~ # <i>lvcreate -L8G -nusr vg</i>
  /dev/cdrom: open failed: Read-only file system
  Logical volume "usr" created <comment>(Gli altri messaggi simili non sono mostrati)</comment>
livecd ~ # <i>lvcreate -L2G -nportage vg</i>
livecd ~ # <i>lvcreate -L4G -ndistfiles vg</i>
livecd ~ # <i>lvcreate -L10G -nhome vg</i>
livecd ~ # <i>lvcreate -L4G -nopt vg</i>
livecd ~ # <i>lvcreate -L4G -nvar vg</i>
livecd ~ # <i>lvcreate -L6G -nvartmp vg</i>
livecd ~ # <i>lvcreate -L2G -ntmp vg</i>

<comment>(Mostrare i gruppi e i volumi logici)</comment>
livecd ~ # <i>vgs</i>
  VG   #PV #LV #SN Attr  VSize   VFree
  vg     1   8   0 wz--n 554.09G 514.09G
livecd ~ # <i>lvs</i>
  LV        VG   Attr   LSize  Origin Snap%  Move Copy%
  distfiles vg   -wi-a-  4.00G
  home      vg   -wi-a- 10.00G
  opt       vg   -wi-a-  4.00G
  portage   vg   -wi-a-  2.00G
  tmp       vg   -wi-a-  2.00G
  usr       vg   -wi-a-  8.00G
  var       vg   -wi-a-  4.00G
  vartmp    vg   -wi-a-  6.00G
</pre>

<p>
Usare <c>mke2fs</c>, <c>mke2fs -j</c>, <c>mkreiserfs</c>, <c>mkfs.xfs</c> e
<c>mkfs.jfs</c> per creare i filesystem. Per inizializzare la swap usare
<c>mkswap</c> e <c>swapon</c>.
</p>

<pre caption="Creare i filesystem e attivare la swap">
<comment>(ext2 è più che sufficiente per la partizione /boot)</comment>
livecd ~ # <i>mke2fs /dev/md1</i>

<comment>(Per la partizione di root utilizzare ext3)</comment>
livecd ~ # <i>mke2fs -j /dev/md3</i>

<comment>(Adesso creare i filesystem nei volumi logici)</comment>
livecd ~ # <i>mke2fs -b 4096 -T largefile /dev/vg/distfiles</i>
livecd ~ # <i>mke2fs -j /dev/vg/home</i>
livecd ~ # <i>mke2fs -j /dev/vg/opt</i>
livecd ~ # <i>mke2fs -b 1024 -N 200000 /dev/vg/portage</i>
livecd ~ # <i>mke2fs /dev/vg/tmp</i>
livecd ~ # <i>mke2fs -j /dev/vg/usr</i>
livecd ~ # <i>mke2fs -j /dev/vg/var</i>
livecd ~ # <i>mke2fs /dev/vg/vartmp</i>

<comment>(Creare e attivare le partizioni di swap)</comment>
livecd ~ # <i>mkswap /dev/sda2 &amp;&amp; mkswap /dev/sdb2</i>
livecd ~ # <i>swapon -p 1 /dev/sda2 &amp;&amp; swapon -p 1 /dev/sdb2</i>
<comment>(Controllare che tutte le partizioni di swap abbiano la stessa priorità)</comment>
livecd ~ # <i>swapon -v -s</i>
Filename                   Type            Size    Used    Priority
/dev/sda2                  partition       401616  0       1
/dev/sdb2                  partition       401616  0       1
</pre>

<p>
Montare i nuovi filesystem in <path>/mnt/gentoo</path>. Creare le directory per
gli altri punti di mount e montare anche quest'ultimi.
</p>

<pre caption="Montare i filesystem">
livecd ~ # <i>mount /dev/md3 /mnt/gentoo</i>
livecd ~ # <i>cd /mnt/gentoo</i>
livecd gentoo # <i>mkdir boot home usr opt var tmp</i>
livecd gentoo # <i>mount /dev/md1 /mnt/gentoo/boot</i>
livecd gentoo # <i>mount /dev/vg/usr /mnt/gentoo/usr</i>
livecd gentoo # <i>mount /dev/vg/home /mnt/gentoo/home</i>
livecd gentoo # <i>mount /dev/vg/opt /mnt/gentoo/opt</i>
livecd gentoo # <i>mount /dev/vg/tmp /mnt/gentoo/tmp</i>
livecd gentoo # <i>mount /dev/vg/var /mnt/gentoo/var</i>
livecd gentoo # <i>mkdir usr/portage var/tmp</i>
livecd gentoo # <i>mount /dev/vg/vartmp /mnt/gentoo/var/tmp</i>
livecd gentoo # <i>mount /dev/vg/portage /mnt/gentoo/usr/portage</i>
livecd gentoo # <i>mkdir usr/portage/distfiles</i>
livecd gentoo # <i>mount /dev/vg/distfiles /mnt/gentoo/usr/portage/distfiles</i>

<comment>(Impostare i permessi corretti nelle directory temporanee)</comment>
livecd gentoo # <i>chmod 1777 /mnt/gentoo/tmp /mnt/gentoo/var/tmp</i>
</pre>

</body>
</section>
<section>
<title>Estrarre lo stage</title>
<body>

<p>
Per prima cosa assicurarsi che la data e l'ora siano corrette usando <c>date
MMDDhhmmYYYY</c>. Usate l'ora UTC.
</p>

<pre caption="Impostare la data e l'ora UTC">
<comment>(Controllare l'orologio)</comment>
livecd gentoo # <i>date</i>
Mon Mar  6 00:14:13 UTC 2006

<comment>(Impostare la data e l'ora corrente se è necessario)</comment>
livecd gentoo # <i>date 030600162006</i> <comment>(Il formato è MMDDhhmmYYYY)</comment>
Mon Mar  6 00:16:00 UTC 2006
</pre>

<p>
Dopo, scaricare uno stage da uno dei <uri link="/main/en/mirrors.xml">mirror
</uri>. Andare su <path>/mnt/gentoo</path> ed estrarre lo stage usando <c>tar
xjpf &lt;stage3 tarball&gt;</c>.
</p>

<pre caption="Scaricare uno stage3">
livecd gentoo # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Scegliere un mirror, spostarsi sulla directory releases/x86/current/stages, selezionare lo stage3
che interessa, probabilmente quello per architettura i686 e premere D per scaricarlo)</comment>

<comment>(<b>Oppure</b> scaricarlo direttamente con wget senza scegliere il mirror più vicino)</comment>
livecd gentoo # <i>wget http://gentoo.osuosl.org/releases/x86/current/stages/stage3-i686*.tar.bz2</i>
</pre>

<pre caption="Estrarre lo stage3">
livecd gentoo # <i>time tar xjpf stage3*</i>

real  1m14.157s
user  1m2.920s
sys   0m7.530s
</pre>

<p>
Installare il più recente snapshot di Portage disponibile. Procedere in maniera
simile a quella dello stage3: scegliere il mirror più vicino dalla <uri
link="/main/en/mirrors.xml">lista</uri>, scaricare la snapshot ed estrarlo.
</p>

<pre caption="Scaricare il più recente snapshot di Portage">
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Scegliere un mirror, spostarsi nella directory snapshots/, selezionare <b>portage-latest.tar.bz2</b> e premete D per scaricarlo)</comment>

<comment>(<b>Oppure</b> scaricarlo direttamente con wget senza scegliere il mirror più vicino)</comment>
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>wget http://gentoo.osuosl.org/snapshots/portage-latest.tar.bz2</i>
</pre>

<pre caption="Estrarre lo snapshot di Portage">
livecd usr # <i>time tar xjf portage-lat*</i>

real  0m40.523s
user  0m28.280s
sys   0m8.240s
</pre>

</body>
</section>
<section>
<title>Chroot</title>
<body>

<p>
Montare il file system <path>/proc</path>, copiare il file
<path>/etc/resolv.conf</path> e infine effettuare il chroot nel proprio ambiente
Gentoo.
</p>

<pre caption="Chroot">
livecd usr # <i>cd /</i>
livecd / # <i>mount -t proc proc /mnt/gentoo/proc</i>
livecd / # <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/</i>
livecd / # <i>chroot /mnt/gentoo /bin/bash</i>
livecd / # <i>env-update &amp;&amp; source /etc/profile</i>
>>> Regenerating /etc/ld.so.cache...
</pre>

</body>
</section>
<section>
<title>Impostare il fuso orario (Time Zone)</title>
<body>

<p>
Impostare il fuso orario scegliendolo tra quelli elencati in
<path>/usr/share/zoneinfo</path>.
</p>



<pre caption="Impostare il fuso orario">
livecd / # <i>ls /usr/share/zoneinfo</i>
<comment>(Ad es. Bruxelles)</comment>
livecd / # <i>cp /usr/share/zoneinfo/Europe/Brussels /etc/localtime</i>

livecd / # <i>date</i>
Wed Mar  8 00:46:05 CET 2006
</pre>

</body>
</section>
<section>
<title>Impostare l'hostname e il domain name</title>
<body>

<p>
Impostare l'hostname in <path>/etc/conf.d/hostname</path> e <path>/etc/hosts
</path>. Nell'esempio seguente, si usa <c>mybox</c> come hostname e
<c>at.myplace</c> come domain name. Si possono indifferentemente modificare i
file con <c>nano</c> oppure usando i comandi seguenti:
</p>

<pre caption="Impostare l'hostname e il domain name">
livecd / # <i>cd /etc</i>
livecd etc # <i>echo "127.0.0.1 mybox.at.myplace mybox localhost" &gt; hosts</i>
livecd etc # <i>sed -i -e 's/HOSTNAME.*/HOSTNAME="mybox"/' conf.d/hostname</i>
<comment>(Use defined host name and check)</comment>
livecd etc # <i>hostname mybox</i>
livecd etc # <i>hostname -f</i>
mybox.at.myplace
</pre>

</body>
</section>
<section>
<title>Configurazione del Kernel</title>
<body>

<p>
Installare i sorgenti del kernel (solitamente <c>gentoo-sources</c>),
configurarli, compilarli e copiare il file
<path>arch/i386/boot/bzImage</path> in <path>/boot</path>.
</p>

<pre caption="Installare i sorgenti del kernel, compilarli e installarli">
livecd etc # <i>time emerge gentoo-sources</i>

real  3m3.110s
user  1m2.320s
sys   0m34.990s
livecd etc # <i>cd /usr/src/linux</i>
livecd linux # <i>make menuconfig</i>

<comment>(Configurare il kernel normalmente e assicurarsi che i moduli raid e
lvm siano compilati come built-in, cioè <b>non</b> come moduli. Stessa cosa vale
per i driver dei dischi e per quelli dei filesystem.)</comment>
Multi-device support (RAID and LVM)  ---&gt;
[*] Multiple devices driver support (RAID and LVM)
  &lt;*&gt;   RAID support
  &lt; &gt;     Linear (append) mode (NEW)
  &lt;*&gt;     RAID-0 (striping) mode
  &lt;*&gt;     RAID-1 (mirroring) mode
  &lt; &gt;     RAID-10 (mirrored striping) mode (EXPERIMENTAL) (NEW)
  &lt; &gt;     RAID-4/RAID-5 mode (NEW)
  &lt; &gt;     RAID-6 mode (NEW)
  &lt; &gt;     Multipath I/O support (NEW)
  &lt; &gt;     Faulty test module for MD (NEW)
  &lt;*&gt;   Device mapper support
  &lt; &gt;     Crypt target support (NEW)
  &lt; &gt;     Snapshot target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Mirror target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Zero target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Multipath target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Bad Block Relocation Device Target (EXPERIMENTAL) (NEW)

livecd linux # <i>time make -j2</i>

<comment>(Il tempo impiegato dipende molto dalle opzioni che sono state selezionate)</comment>
real  5m5.869s
user  4m32.320s
sys   0m32.930s

livecd linux # <i>make modules_install</i>
livecd linux # <i>cp arch/i386/boot/bzImage /boot/kernel</i>
</pre>

</body>
</section>
<section>
<title>Configurare il sistema</title>
<body>

<p>
Modificare <path>/etc/fstab</path> sostituendo <c>BOOT</c>, <c>ROOT</c> e
<c>SWAP</c> con i nomi delle partizioni reali e aggiungere i volumi logici. Non
dimenticarsi di controllare se i filesystem rispecchiano la propria
installazione.
</p>

<pre caption="fstab di esempio">
livecd linux # <i>cd /etc</i>
livecd etc # <i>nano -w fstab</i>
/dev/<i>md1</i>          /boot                   ext2  noauto,noatime  1 2
/dev/<i>md3</i>          /                       ext3  noatime         0 1
/dev/<i>sda2</i>         none                    swap  sw,pri=1        0 0
/dev/<i>sdb2</i>         none                    swap  sw,pri=1        0 0
/dev/vg/usr       /usr                    ext3  noatime         1 2
/dev/vg/portage   /usr/portage            ext2  noatime         1 2
/dev/vg/distfiles /usr/portage/distfiles  ext2  noatime         1 2
/dev/vg/home      /home                   ext3  noatime         1 2
/dev/vg/opt       /opt                    ext3  noatime         1 2
/dev/vg/tmp       /tmp                    ext2  noatime         1 2
/dev/vg/var       /var                    ext3  noatime         1 2
/dev/vg/vartmp    /var/tmp                ext2  noatime         1 2
</pre>

<p>
Configurare la rete modificando <path>/etc/conf.d/net</path>. Aggiungere lo
script <c>net.eth0</c> al runlevel default. Se si hanno più schede di rete,
creare i necessari collegamenti simbolici allo script di init <c>net.eth0</c> e
aggiungere anch'essi al runlevel default. È possibile modificare
<path>/etc/conf.d/net</path> sia con <c>nano</c> che usando i seguenti comandi:
</p>

<pre caption="Configurare la rete">
livecd etc # <i>cd conf.d</i>
livecd conf.d # <i>echo 'config_eth0=( "192.168.1.10/24" )' >> net</i>
livecd conf.d # <i>echo 'routes_eth0=( "default via 192.168.1.1" )' >> net</i>
livecd conf.d # <i>rc-update add net.eth0 default</i>
<comment>(Se i driver della scheda di rete sono stati compilati come moduli,
è necessario aggiungerli nel file /etc/modules.autoload.d/kernel-2.6)</comment>
livecd conf.d # <i>echo r8169 >> /etc/modules.autoload.d/kernel-2.6</i>
<comment>(Se si vuole usare ssh dopo aver avviato il nuovo sistema operativo)</comment>
livecd conf.d # <i>rc-update add sshd default</i>
</pre>

<note>
Se si necessita del supporto alle schede PCMCIA installare <c>pcmciautils</c> e
aggiungerlo al runlevel default.
</note>

<p>
Impostare la password di root con <c>passwd</c>.
</p>

<pre caption="Impostare la password di root">
livecd conf.d # <i>passwd</i>
New UNIX password: <comment>inserire_una_password</comment>
Retype new UNIX password: <comment>inserire_la_password_di_nuovo</comment>
passwd: password updated successfully
</pre>

<p>
Modificare <path>/etc/conf.d/clock</path> per indicare il fuso orario usato in
precedenza.
</p>

<pre caption="Modificare /etc/conf.d/clock">
livecd conf.d # <i>nano -w /etc/conf.d/clock</i>
TIMEZONE="Europe/Brussels"
</pre>

<p>
Controllare la configurazione di sistema in <path>/etc/rc.conf</path>,
<path>/etc/conf.d/rc</path>, <path>/etc/conf.d/keymaps</path>,
<path>/etc/conf.d/clock</path>, <path>/etc/conf.d/clock</path> e modificare
questi file se necessario.
</p>

<pre caption="Opzionale: modificare i file di configurazione">
livecd conf.d # <i>nano -w /etc/rc.conf</i>
livecd conf.d # <i>nano -w /etc/conf.d/rc</i>
livecd conf.d # <i>nano -w /etc/conf.d/keymaps</i>
</pre>

</body>
</section>
<section>
<title>Installare gli strumenti di sistema</title>
<body>

<p>
Installare i programmi per il RAID e per LVM2
</p>

<pre caption="Installare i programmi per RAID e LVM2">
livecd conf.d # <i>emerge mdadm lvm2</i>
</pre>

<p>
Installare un logger di sistema tipo <c>syslog-ng</c> e un demone cron (ad
esempio <c>vixie-cron</c>) e aggiungerli al runlevel default.
</p>

<note>
I demoni di cron dipendono da un MTA (Mail Transport Agent, programma usato dal
sistema per inviare mail, NdT). <c>mail-mta/ssmtp</c> viene proposto da emerge
come dipendenza. Se si vuole usare un MTA più completo, conviene installarlo
adesso. Se si è di fretta, lasciare che venga installato ssmtp e rimuoverlo in
seguito, quando si installerà l'MTA preferito.
</note>

<pre caption="Installare un logger di sistema e un demone cron">
livecd conf.d # <i>time emerge syslog-ng vixie-cron</i>

real  1m54.099s
user  1m2.630s
sys   0m34.620s
livecd conf.d # <i>rc-update add syslog-ng default</i>
livecd conf.d # <i>rc-update add vixie-cron default</i>
</pre>

<p>
Installare i programmi di gestione dei filesystem necessari(<c>xfsprogs</c>,
<c>reiserfsprogs</c> o <c>jfsutils</c>) ed i programmi di rete (<c>dhcpcd</c>
o <c>ppp</c>).
</p>

<pre caption="Installare programmi extra (se necessari)">
livecd conf.d # <i>emerge xfsprogs</i>           <comment>(Se si usa il filesystem XFS)</comment>
livecd conf.d # <i>emerge jfsutils</i>           <comment>(Se si usa il filesystem JFS)</comment>
livecd conf.d # <i>emerge reiserfsprogs</i>      <comment>(Se si usa il filesystem Reiser)</comment>
livecd conf.d # <i>emerge dhcpcd</i>             <comment>(Se serve un client DHCP)</comment>
livecd conf.d # <i>USE="-X" emerge ppp</i>       <comment>(Se si usa una connessione ADSL PPPoE)</comment>
</pre>

</body>
</section>
<section>
<title>Configurare il Bootloader</title>
<body>

<p>
Installare e configurare <c>grub</c>.
</p>

<pre caption="Installare grub e modificarne il file di configurazione">
livecd conf.d # <i>time emerge grub</i>

real  1m4.634s
user  0m39.460s
sys   0m15.280s
livecd conf.d # <i>nano -w /boot/grub/grub.conf</i>
</pre>

<pre caption="grub.conf di esempio">
default 0
timeout 10

title=Gentoo
root (hd0,0)
kernel /boot/kernel root=/dev/md3
</pre>

<pre caption="Installare grub su entrambi i dischi">
livecd conf.d # <i>grub</i>
Probing devices to guess BIOS drives. This may take a long time.

grub> <i>root (hd0,0)</i>
 Filesystem type is ext2fs, partition type 0xfd

grub> <i>setup (hd0)</i>
 Checking if "/boot/grub/stage1" exists... yes
 Checking if "/boot/grub/stage2" exists... yes
 Checking if "/boot/grub/e2fs_stage1_5" exists... yes
 Running "embed /boot/grub/e2fs_stage1_5 (hd0)"...  16 sectors are embedded.
succeeded
 Running "install /boot/grub/stage1 (hd0) (hd0)1+16 p (hd0,0)/boot/grub/stage2 /boot/
grub/menu.lst"... succeeded
Done.

grub> <i>root (hd1,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd1)</i>

grub> <i>quit</i>
</pre>

</body>
</section>
<section>
<title>Riavvio</title>
<body>

<p>
Uscire dall'ambiente in chroot, smontare tutti i filesystem e riavviare:
</p>

<pre caption="Riavvio">
livecd conf.d # <i>exit</i>
livecd / # <i>umount /mnt/gentoo/usr/portage/distfiles /mnt/gentoo/usr/portage /mnt/gentoo/usr</i>
livecd / # <i>umount /mnt/gentoo/var/tmp /mnt/gentoo/tmp /mnt/gentoo/var /mnt/gentoo/opt</i>
livecd / # <i>umount /mnt/gentoo/proc /mnt/gentoo/home /mnt/gentoo/boot /mnt/gentoo</i>
livecd / # <i>reboot</i>
<comment>(Non dimenticarsi di rimuovere il CD)</comment>
</pre>

<p>
Infine seguire la sezione <uri
link="gentoo-x86-quickinstall.xml#after-reboot">Completare l'installazione
</uri> della guida rapida all'installazione di Gentoo generica.
</p>

</body>
</section>
</chapter>
</guide>