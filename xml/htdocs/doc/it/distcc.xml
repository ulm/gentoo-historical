<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/distcc.xml,v 1.3 2004/05/24 17:52:52 mush Exp $ -->

<!-- 
  Synchronised with rev 1.15 on
  http://www.thedoh.com/viewcvs/distcc/html/distcc.xml
-->

<guide link="/doc/it/distcc.xml" lang="it">

<title>Documentazione Gentoo distcc</title>

<author title="Autore">
  <mail link="lisa@gentoo.org">Lisa Seelye</mail>
</author>
<author title="Redazione">
  <mail link="vapier@gentoo.org">Mike Frysinger</mail>
</author>
<author title="Redazione">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Redazione">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Revisione">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Traduzione">
  <mail link="myzelf@omnidea.it">Gilberto De Faveri</mail>
</author>

<abstract>
Questo documento rappresenta l'HOWTO per utilizzare distcc con Gentoo.
</abstract>

<license/>

<version>1.6</version>
<date>12 Maggio 2004</date>

<chapter>
<title>Introduzione</title>
<section>
<title>Cos'è distcc?</title>
<body>

<p>
Distcc è un programma ideato per distribuire i task di compilazione in una
rete di host partecipanti. E' composto da un server, <c>distccd</c> e da un
programma client, <c>distcc</c>. Distcc può funzionare in modo trasparente con
<uri link="http://ccache.samba.org">ccache</uri> e portage previa opportuna
configurazione.
</p>

</body>
</section>
<section>
<title>Utilizzare distcc per il bootstrap</title>
<body>

<p>
Se si prevede di utilizzare distcc per il bootstrap di una installazione Gentoo,
si veda la sezione relativa all'<uri link="#bootstrapping">utilizzo di distcc per il bootstrap</uri> di questo documento.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Configurazione</title>
<section>
<title>Dipendenze</title>
<body>

<p>
Per cominciare ad utilizzare distcc sui computer di una rete, è necessatio che
abbiano tutti la stessa versione di GCC. È possibile mescolare ad esempio versioni
3.3.x (dove x varia), ma non 3.3.x e 3.2.x: i programmi <b>conterranno</b> errori.
</p>

</body>
</section>
<section>
<title>Installazione di distcc</title>
<body>

<p>
Esistono alcune opzioni di cui è bene parlare prima di cominciare l'installazione
di distcc.
</p>

<p>
Distcc contiene un monitor grafico per tenere sotto controllo i task che il
tuo computer sta inviando per la compilazione. Se usi Gnome, metti 'gnome'
nelle tue USE flags. Se non usi Gnome e vuoi comunque utilizzare il monitor,
metti 'gtk' nelle tue USE flags.
</p>

<pre caption="Installazione di distcc">
# <i>emerge distcc</i>
</pre>

</body>
</section>
<section>
<title>Configurare portage per l'utilizzo di distcc</title>
<body>

<p>
Configurare distcc è molto facile con Portage. È necessario seguire questi semplici passi per
ogni computer sul quale si desideri utilizzare distcc:
</p>

<pre caption="Integrare Distcc e Portage">
# <i>emerge distcc</i>
# <i>nano -w /etc/make.conf</i>
<comment>(Impostare N ad un numero adeguato alla tua configurazione)</comment>
<comment>(Un algoritmo euristico comune consiste nell'impostarlo al doppio
del numero dell CPU + 1)</comment>
MAKEOPTS="-jN"
<comment>(Aggiungere distcc alla variabile FEATURES)</comment>
FEATURES="distcc"
<comment>(Impostare la directory temporanea di distcc)</comment>
DISTCC_DIR="${PORTAGE_TMPDIR}/.distcc"
</pre>

<p>
Ora bisogna specificare quali host vuoi utilizzare. Puoi usare
il comando <c>distcc-config</c> per impostare la lista degli host. Ecco un
esempio di alcuni host che potrebbero essere nella tua lista:
</p>

<pre caption="Esempio di definizione degli host">
192.168.0.1          192.168.0.2                       192.168.0.3
192.168.0.1/2        192.168.0.2                       192.168.0.3/10
192.168.0.1:4000/2   192.168.0.2/1                     192.168.0.3:3632/4
@192.168.0.1         @192.168.0.2:/usr/bin/distccd     192.168.0.3
<codenote>Esistono molti altri metodi per impostare gli host.</codenote>
<codenote>Si veda il man di distcc per ulteriori informazioni.</codenote>
</pre>

<p>
Potrebbe sembrare complicato, ma nella maggior parte dei casi una variante della
riga 1 o 2 sarà  sufficiente.</p>

<ul>
  <li>La riga 1 è semplicemente una lista di host delimitata da spazi</li>
  <li>
    La riga 3 è una lista di host che spacifica il numero massimo di jobs 
    (definiti attraverso l'impostazione <c>/N</c>) da inviare alla volta 
    ad un determinato host
  </li>
</ul>

<p>
La maggior parte degli utenti non userà le righe 3 o 4: per maggiori informazioni
si veda la <uri link="http://distcc.samba.org/man/distcc_1.html">documentazione 
di distcc</uri>.
</p>

<p>
Ad esempio, per impostare la riga 1 del listato precedente:
</p>

<pre caption="Comando di esempio per impostare gli host">
# <i>/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"</i>
</pre>

<p>
A questo punto si deve avviare il demone distcc su tutti i computer della rete:
</p>

<pre caption="Avvio del demone distcc">
<comment>(Aggiungere distcc al runlevel default)</comment>
# <i>rc-update add distccd default</i>
<comment>(Avviare il demone distcc)</comment>
# <i>/etc/init.d/distccd start</i>
</pre>

</body>
</section>
<section>
<title>Configurare distcc per il funzionamento con Automake</title>
<body>

<p>
È generalmente più semplice rispetto alla configurazione di Portage. È necessario
aggiornare la tua variabile d'ambiente <c>PATH</c> in modo che includa
<path>/usr/lib/distcc/bin</path> prima della locazione di gcc (<path>/usr/bin</path>).
Un avvertimento: se usi ccache devi mettere distcc dopo ccache:
</p>

<pre caption="Configurazione del path">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>

<p>
A questo punto, anzichè digitare normalmente <c>make</c>, dovrai digitare
<c>make -jN</c> (dove N è un intero). Un valore adatto per N dipende dalla
rete e dal tipo di computer che stai utilizzando per compilare. Io ho un
biprocessore P3 e un K6-2/400 che compilano per il mio desktop (un Athlon
Thunderbird 1200MHz) e utilizzo -j5. Si provi con diverse impostazioni per trovare
il numero più adeguato.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Cross-compiling</title>
<section>
<title>Una nota sul cross-compiling</title>
<body>

<p>
Il cross-compiling è l'utilizzo di un'architettura per compilare programmi
per un'altra architettura. Questo potrebbe voler dire semplicemente utilizzare
un Athlon (i686) per compilare un programma per un K6-2 (i585) oppure utilizzare
una Sparc per compilare un programma per ppc.
</p>

</body>
</section>
<section>
<title>Una nota personale sul cross-compiling</title>
<body>

<p>
Mi piacerebbe contribuire agli sforzi per migliorare il cross-compiling
su Gentoo, ma non ho nessuna macchina non-x86. Potrei creare cose che
funzionano, <e>in teoria</e>, ma dovrei basarmi su altre persone per
testare quello che scrivo. Funzionerebbe per un po', ma sarebbe dura. ;-)
</p>

<p>
Spero di acquistare a breve un qualche tipo di Sparc per installare Gentoo e
poterci smanettare in casa.
</p>

</body>
</section>
</chapter>

<chapter id="bootstrapping">
<title>Usare distcc per il bootstrap</title>
<section>
<title>1: Configurare portage</title>
<body>

<p>
È necessario effettuare il boot della nuova macchina con un LiveCD di Gentoo Linux
e seguire la <uri link="/doc/en/handbook/handbook-x86.xml?part=1">guida
all'installazione</uri> fino al bootstrap. A questo punto si proceda a 
configurare portage per usare distcc.
</p>

<pre caption="Configurazione preliminare">
# <i>nano -w /etc/make.conf</i>
<comment>(Aggiungere distcc alla variabile FEATURES)</comment>
FEATURES="distcc"
<comment>(Impostare la directory temporanea di distcc)</comment>
DISTCC_DIR="${PORTAGE_TMPDIR}/.distcc"
<comment>(Modificare MAKEOPTS con -jN dove N è un intero adeguato)</comment>
MAKEOPTS="-jN"
</pre>

</body>
</section>
<section>
<title>2: Installare distcc</title>
<body>

<p>
Si installi distcc:
</p>

<pre caption="Installare distcc nella nuova box">
# <i>USE='-*' emerge --nodeps distcc</i>
</pre>

</body>
</section>
<section>
<title>3: Configurazione di distcc</title>
<body>

<p>
Si aggiunga un utente "distcc" al file <path>/etc/passwd</path> e si esegua
<c>distcc-config</c> per configuare distcc:
</p>

<pre caption="Configurazione finale di distcc">
# <i>echo "distcc:x:240:2:distccd:/dev/null:/bin/false" &gt;&gt; /etc/passwd</i>
<comment>(Sostituire host1, host2, ... con l'IP degli host che partecipano alla compilazione)</comment>
# <i>/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."</i>
</pre>

<p>
Adesso distcc dovrebbe essere configurato per il bootstrap! Si segua la guida
all'installazione ufficiale e si ricordi di ri-emergere distcc dopo 
l'<c>emerge system</c>. Ciò serve per assicurarsi che vengano
installate tutte le dipendenze.
</p>

<note>
Durante il bootstrap e l'<c>emerge system</c> distcc
potrebbe non essere utilizzato. Questo è possibile, poichè alcuni ebuilds o
pacchetti non funzionano bene con distcc, quindi lo disabilitano esplicitamente.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Risoluzione dei problemi</title>
<section>
<title>Mozilla e Xfree</title>
<body>

<p>
Emergendo alcuni pacchetti, noterai che non vengono distribuiti (e quindi non vengono
compilati in modo parallelo). Ciò è dovuto al fatto che gli sviluppatori degli ebuild di
Mozilla e Xfree hanno disabilitato la compilazione parallela perché è noto che causa
problemi. Questo non è necessariamente un problema di distcc.
</p>

<p>
Per lo stesso motivo, è possibile che, in alcuni casi, distcc causi il fallimento
della compilazione di un pacchetto. Se succede, <uri link="http://bugs.gentoo.org">segnala un bug</uri>.
</p>

</body>
</section>
<section>
<title>Una mescolanza di host con hardened-gcc e non-hardened-gcc causa problemi</title>
<body>

<p>
Con un titolo così lungo, ogni ulteriore spiegazione è superflua. Comunque, se
prevedi di usare distcc in una rete in cui alcuni host usano il <uri
link="http://www.gentoo.org/proj/en/hardened/etdyn-ssp.xml">PaX/hardened-gcc</uri>
ed altri no, avrai problemi.
</p>

<p>
La soluzione ti richiede di essere un po' previdente; dovrai eseguire
<c>hardened-gcc -R</c> sugli host che hanno il PaX/hardened-gcc, oppure dovrai
abilitare le protezioni PaX nel tuo kernel e lanciare <c>emerge hardened-gcc</c>.
La seconda soluzione è consigliata, visto che la maggior parte delle protezioni
offerte da entrambi i pacchetti sono vantaggiose e trasparenti per l'utente.
</p>

</body>
</section>
<section>
<title>Mescolanza di versioni GCC</title>
<body>

<p>
Se utilizzi versioni diverse di GCC sui tuoi host, avrai sicuramente strani problemi.
La soluzione consiste nell'assicurarsi che tutti gli host usino la stessa versione
di GCC.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Gli extra di distcc</title>
<section>
<title>Distcc monitor</title>
<body>

<p>
Distcc contiene due monitor. Quello testuale è sempre compilato ed
e chiamato <c>distccmon-text</c>. Usarlo per la prima volta potrebbe essere
un po' complicato, ma in realtà è molto semplice. Se viene lanciato senza
parametri verrà  eseguito una volta. Al contrario, se gli viene passato un numero,
verrà aggiornato ogni N secondi, dove N è l'argomento passato.
</p>

<p>
L'altro monitor viene abilitato se <c>gtk</c> o <c>gnome</c> sono presenti
tra le <c>USE</c> flags. Questo monitor è molto carino: è basato su GTK+ e
gira sotto X.
</p>

<pre caption="Avvio dei monitor">
# <i>distccmon-text N</i>
<comment>(o ...)</comment>
# <i>distccmon-gnome</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>I futuri piani per distcc e Gentoo</title>
<section>
<title>distcc-subnetscan</title>
<body>

<p>
<c>distcc-subnetscan</c> è un programma perl in sviluppo che scansiona
una sottorete alla ricerca di host che abbiano un demone distcc disponibile.
Questa funzione sarà  potenziata in modo da verificare la conformità ad un certo
<c>CHOST</c> del demone sull'host, in modo da rendere più facile il cross-compiling.
</p>

<p>
Lo script perl sarà disponibile <uri link="http://dev.gentoo.org/~lisa/distcc/distcc-subnetscan/distcc-subnetscan.pl">
qui</uri> fino a che non gli verrà trovata una sistemazione ufficiale.
</p>

</body>
</section>
</chapter>
</guide>
