<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/distcc.xml,v 1.1 2004/01/25 23:19:21 mush Exp $ -->

<guide link="/doc/en/distcc.xml">

<title>Documentazione Gentoo distcc</title>

<author title="Autore">
  <mail link="lisa@gentoo.org">Lisa Seelye</mail>
</author>
<author title="Redattore">
  <mail link="vapier@gentoo.org">Mike Frysinger</mail>
</author>
<author title="Redattore">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Recensore">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Recensore, Redattore">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Traduttore">
  <mail link="myzelf@omnidea.it">Gilberto De Faveri</mail>
</author>

<license/>

<version>1.4</version>
<date>19 Gennaio 2004</date>

<abstract>
Questo documento rappresenta l'HOWTO per utilizzare distcc con Gentoo.
</abstract>

<chapter>
<title>Introduzione</title>
<section>
<title>Cos'è distcc?</title>
<body>

<p>
Distcc è un programma ideato per distribuire i task di compilazione in una
rete di host partecipanti. E' composto da un server, <c>distccd</c> e da un
programma client, <c>distcc</c>. Distcc può funzionare in modo trasparente con
<uri link="http://ccache.samba.org">ccache</uri> e Portage previa opportuna
configurazione.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Configurazione</title>
<section>
<title>Dipendenze</title>
<body>

<pre caption="Dipendenze di distcc (dalla versione 2.8 alla 2.10)">
&gt;=sys-apps/portage-2.0.46-r11
<codenote>Distcc-2.11 e superiori richiedono &gt;=sys-apps/portage-2.0.49-r6</codenote>
&gt;=sys-devel/gcc-config-1.3.1
sys-apps/shadow
<codenote>(Dalla versione 2.8 alla 2.11) Le seguenti dipendenze sono opzionali se <i>gtk</i> è tra le <i>USE</i> flags</codenote>
&gt;=x11-libs/gtk+-2.2.1
</pre>

<pre caption="Dipendenze di distcc (a partire dalla versione 2.11.1)">
&gt;=sys-apps/portage-2.0.49-r6
&gt;=sys-devel/gcc-config-1.3.1
sys-apps/shadow
<codenote>A partire da questa versione è possibile scegliere un monitor con interfaccia grafica Gnome o GTK,
con le seguenti dipendenze</codenote>
<codenote>GTK:</codenote>
&gt;=x11-libs/gtk+-2.0.0
&gt;=gnome-base/libglade-2.0.0
x11-libs/pango
<codenote>Gnome:</codenote>
&gt;=x11-libs/gtk+-2.0.0
&gt;=gnome-base/libglade-2.0.0
x11-libs/pango
&gt;=gnome-base/libgnomeui-2.0.0.0
&gt;=gnome-base/libgnome-2.0.0
</pre>

</body>
</section>
<section>
<title>Installazione di distcc</title>
<body>

<p>
Installare distcc è molto facile. Imposta le tue USE flags e usa il comando
<c>emerge distcc</c>. Ci sono inoltre un paio di opzioni che è importante
conoscere.
</p>

<p>
Distcc contiene un monitor grafico per tenere sotto controllo i task che il
tuo computer sta inviando per la compilazione. Se usi Gnome, metti 'gnome'
nelle tue USE flags. Se non usi Gnome e vuoi comunque utilizzare il monitor,
metti 'gtk' nelle tue USE flags.
</p>

</body>
</section>
<section>
<title>Configurare Portage per l'utilizzo di distcc</title>
<body>

<p>
Configurare distcc è molto facile con Portage. Segui questi semplici passi per
ogni computer sul quale desideri utilizzare distcc:
</p>

<pre caption="Integrare Distcc e Portage">
# <i>emerge distcc</i>
# <i>nano -w /etc/make.conf</i>
</pre>

<impo>
Se usi distcc-2.11.1 o superiore con &gt;=portage-2.0.49-r6, devi solo impostare
il tuo host (vedi il prossimo passo), modificare MAKEOPTS in <path>/etc/make.conf</path>,
e aggiungere 'distcc' a FEATURES in <path>/etc/make.conf</path>.
</impo>

<note>
Modifica la variabile FEATURES in modo che includa &quot;distcc&quot;
</note>

<p>
Ora bisogna specificare quali host vuoi utilizzare. Puoi usare
il comando <c>distcc-config</c> per impostare la lista degli host. Ecco un
esempio di alcuni host che potrebbero essere nella tua lista:
</p>

<pre caption="Esempio di definizione degli host">
192.168.0.1          192.168.0.2                       192.168.0.3
192.168.0.1/2        192.168.0.2                       192.168.0.3/10
192.168.0.1:4000/2   192.168.0.2/1                     192.168.0.3:3632/4
@192.168.0.1         @192.168.0.2:/usr/bin/distccd     192.168.0.3
<codenote>Esistono molti altri metodi per impostare gli host.</codenote>
<codenote>Si veda il man di distcc per ulteriori informazioni.</codenote>
</pre>

<p>
Potrebbe sembrare complicato, ma nella maggior parte dei casi una variante della
linea 1 o 2 sarà sufficiente. Una spiegazione: la linea 1 è solo una lista delimitata
da spazi di host che useranno le impostazioni di default. La linea 2 è una lista di
host che specifica (usando /N) il numero massimo di job da mandare contemporaneamente
a quell'host (specificato con <c>/n</c>). Visto che la maggior parte di voi non userà
le linee 3 o 4, vi rimando alla <uri link="http://distcc.samba.org/man/distcc_1.html">
documentazione di distcc</uri> per maggiori informazioni.
</p>

<p>
Un comando di esempio per impostare gli hosts (linea 1) è:
</p>

<pre caption="Comando di esempio per impostare gli host">
# <i>/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"</i>
</pre>

<p>
L'ultimo passo per integrare distcc in Portage consiste nel ri-aprire il
proprio <path>/etc/make.conf</path> e modificare <c>MAKEOPTS</c> in modo
che includa <c>-jN</c> (dove N è un intero). Tipicamente si vorrà impostare
questo valore al numero totale dei processori disponibili nella propria
rete, più uno.
</p>

<pre caption="Ultime modifiche in make.conf">
# <i>nano -w /etc/make.conf</i>
MAKEOPTS=-jN
</pre>

<impo>
Ricorda di avviare il demone distcc! <c>/etc/init.d/distccd start</c>
</impo>

<note>
E' necessario trovare il numero 'N' adatto alla propria configurazione.
Un'altra strategia è 2 x #numero di CPU + 1.
</note>

</body>
</section>
<section>
<title>Configurare distcc per il funzionamento con Automake</title>
<body>

<p>
E' generalmente più semplice rispetto alla configurazione di Portage. E' necessario
aggiornare la tua variabile d'ambiente <c>PATH</c> in modo che includa
<path>/usr/lib/distcc/bin</path> prima della locazione di gcc (<path>/usr/bin</path>).
Un avvertimento: se usi ccache devi mettere distcc dopo ccache. Così:
</p>

<pre caption="Configurazione del path">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>

<p>
A questo punto, anzichè digitare normalmente <c>make</c>, dovrai digitare
<c>make -jN</c> (dove N è un intero). Un valore adatto per N dipende dalla
rete e dal tipo di computer che stai utilizzando per compilare. Io ho un
biprocessore P3 e un K6-2/400 che compilano per il mio desktop (un Athlon
Thunderbird 1200MHz) e utilizzo -j5. Prova con diverse impostazioni per trovare
il numero più adeguato.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Usare distcc per il bootstrap</title>
<section>
<title>1: Configurazione di una nuova box</title>
<body>

<p>
E' necessario effettuare il boot della nuova macchina con un LiveCD di Gentoo Linux
e seguire tutti i passi fino al bootstrap. A questo punto procedi con un po'
di configurazione preliminare.
</p>

<pre caption="Configurazione preliminare">
<codenote>Aggiunta di distcc a FEATURES</codenote>
# <i>nano -w /etc/make.conf</i>
<codenote>Aggiungi &quot;distcc&quot; a FEATURES</codenote>
<codenote>Modifica MAKEOPTS in <path>/etc/make.conf</path> includendo -jN (come descritto sopra)</codenote>
</pre>

<p>
Ora aggiungi l'utente distcc al tuo <path>/etc/passwd</path>:
</p>

<pre caption="Aggiunta dell'utente distcc a /etc/passwd">
# <i>echo "distcc:x:240:2:distccd:/dev/null:/bin/false" &gt;&gt;/etc/passwd</i>
<codenote>Non dimenticare il '<i>&gt;&gt;</i>'</codenote>
</pre>

</body>
</section>
<section>
<title>2: Installare distcc</title>
<body>

<p>
A questo punto dovrai eseguire il seguente comando all'interno del chroot della
nuova box.
</p>

<pre caption="Installare distcc nella nuova box">
# <i>USE='-*' emerge --nodeps distcc</i>
</pre>

<note>
Secondo il <uri link="http://bugs.gentoo.org/show_bug.cgi?id=34262">bug
34262</uri>, se il comando appena menzionato fallisce con un errore
del tipo 'pkg-config: command not found', dovrai eseguire il comando
<c>emerge --nodeps pkgconfig</c> e riprovare.
</note>

</body>
</section>
<section>
<title>3: Configurazione di distcc</title>
<body>

<p>
Ora configuriamo distcc stesso...
</p>

<pre caption="Configurazione finale di distcc">
# <i>/usr/bin/distcc-config --install</i>
# <i>/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."</i>
</pre>

<p>
Adesso distcc dovrebbe essere configurato per il bootstrap! Segui la guida
all'installazione ufficiale e ricordati di ri-emergere distcc dopo l'<c>emerge system</c>.
</p>

<note>
E' importante notare che durante il bootstrap e l'<c>emerge system</c> distcc
potrebbe non essere utilizzato. Questo è possibile, poichè alcuni ebuilds o
pacchetti non funzionano bene con distcc, quindi lo disabilitano esplicitamente.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Risoluzione dei problemi</title>
<section>
<title>Mozilla e Xfree</title>
<body>

<p>
Emergendo alcuni pacchetti, noterai che non vengono distribuiti (e quindi non vengono
compilati in modo parallelo). Ciò è dovuto al fatto che gli sviluppatori degli ebuild di
Mozilla e Xfree hanno disabilitato la compilazione parallela perchè è noto che causa
problemi. Questo non è necessariamente un problema di distcc.
</p>

<p>
Per lo stesso motivo, è possibile che, in alcuni casi, distcc causi il fallimento
nella compilazione di un pacchetto.
</p>

</body>
</section>
<section>
<title>Una mescolanza di host con hardened-gcc e non-hardened-gcc causa problemi</title>
<body>

<p>
Con un titolo così lungo, ogni ulteriore spiegazione è superflua. Comunque, se
prevedi di usare distcc in una rete in cui alcuni host usano il <uri
link="http://www.gentoo.org/proj/en/hardened/etdyn-ssp.xml">PaX/hardened-gcc</uri>
ed altri no, avrai problemi.
</p>

<p>
La soluzione ti richiede di essere un po' previdente; dovrai eseguire
<c>hardened-gcc -R</c> sugli host che hanno il PaX/hardened-gcc, oppure dovrai
abilitare le protezioni PaX nel tuo kernel ed lanciare <c>emerge hardened-gcc</c>.
La seconda soluzione è consigliata, visto che la maggior parte delle protezioni
offerte da entrambi i pacchetti sono vantaggiose e trasparenti per l'utente.
</p>

</body>
</section>
<section>
<title>Mescolanza di versioni GCC</title>
<body>

<p>
Se utilizzi versioni diverse di GCC sui tuoi host, avrai sicuramente strani problemi.
La soluzione consiste nell'assicurarsi che tutti gli host usino la stessa versione
di GCC.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Cross-compiling</title>
<section>
<title>Una nota sul cross-compiling</title>
<body>

<p>
Cross-compiling significa utilizzare un'architettura per compilare programmi
per un'altra architettura. Questo potrebbe voler dire semplicemente utilizzare
un Athlon (i686) per compilare un programma per un K6-2 (i585) oppure utilizzare
una Sparc per compilare un programma per ppc.
</p>

</body>
</section>
<section>
<title>Una nota personale sul cross-compiling</title>
<body>

<p>
Mi piacerebbe contribuire agli sforzi per migliorare il cross-compiling
su Gentoo, ma non ho nessuna macchina non-x86. Potrei creare cose che
funzionano, <e>in teoria</e>, ma dovrei basarmi su altre persone per
testare quello che scrivo. Funzionerebbe per un po', ma sarebbe dura. ;-)
</p>

<p>
Spero di acquistare a breve un qualche tipo di Sparc per installare Gentoo e
poterci smanettare in casa.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Gli extra di distcc</title>
<section>
<title>Distcc monitor</title>
<body>

<p>
Distcc contiene due monitor. Quello testuale è sempre compilato ed
e chiamato <c>distccmon-text</c>. Usarlo per la prima volta potrebbe essere
un po' complicato, ma in realtà è molto semplice. Se viene lanciato senza
parametri verrà eseguito una volta. Al contrario, se gli viene passato un numero,
verrà aggiornato ogni N secondi, dove N è l'argomento passato.
</p>

<p>
L'altro monitor viene abilitato se <c>gtk</c> o <c>gnome</c> sono presenti
tra le <c>USE</c> flags. Questo monitor è molto carino: è basato su GTK+ e
gira sotto X.
</p>

<p>
Un avvertimento per l'utilizzo di questi programmi: se si desidera visualizzare
ogni emerge, è necessario lanciare il monitor così:
</p>

<pre caption="Avviare i monitor">
# <i>DISTCC_DIR=/path/to/distccdir distccmon-text N</i>
<codenote>Or you can start the graphical monitor...</codenote>
# <i>DISTCC_DIR=/path/to/distccdir distccmon-gnome</i>
</pre>

<impo>
Se stai utilizzando portage, per l'esempio qui sopra, sarà
<c>DISTCC_DIR=/var/tmp/portage/.distcc</c>.
</impo>

<note>
Se non stai utilizzando Portage, non c'è bisogno di specificare
DISTCC_DIR (ad esempio digita semplicemente distccmon-text N).
</note>

</body>
</section>
</chapter>

<chapter>
<title>I futuri piani per distcc e Gentoo</title>
<section>
<title>distcc-subnetscan</title>
<body>

<p>
<c>distcc-subnetscan</c> è un programma perl in sviluppo che scansionerà
una sottorete alla ricerca di host che abbiano un demone distcc disponibile.
Questa funzione sarà potenziata in modo da verificare la conformità ad un certo
<c>CHOST</c> del demone sull'host, in modo da rendere più facile il cross-compiling.
</p>

<p>
Lo script perl sarà disponibile <uri link="http://dev.gentoo.org/~lisa/distcc/distcc-subnetscan/distcc-subnetscan.pl">
qui</uri> fino a che non gli verrà trovata una sistemazione ufficiale.
</p>

</body>
</section>
</chapter>
</guide>
