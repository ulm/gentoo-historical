<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/hb-install-stage.xml,v 1.16 2006/05/28 20:35:42 mascherpa Exp $ -->

<sections>

<version>2.11</version>
<date>2006-05-27</date>

<section>
<title>Installazione di uno stage</title>
<subsection>
<title>Impostare la data e l'ora</title>
<body>

<p>
Prima di continuare è necessario controllare la data e l'ora ed aggiornarle. Un
orologio impostato male può portare problemi in futuro.
</p>

<p>
Per visualizzare l'ora e la data attuali eseguire <c>date</c>:
</p>

<pre caption="Verificare la data e l'ora">
# <i>date</i>
Fri Mar 29 16:21:18 UTC 2005
</pre>

<p>
Se la data o l'ora fossero errate, è possibile aggiornarle utilizzando il
comando
<c>date MMDDhhmmCCYY</c> ( dove <b>M</b> è il mese, <b>D</b> è il giorno,
<b>h</b> l'ora, <b>m</b> il monuto, <b>C</b> il secolo e
<b>Y</b> l'anno). A questo punto è consigliabile impostare l'ora UTC, è possib
ile poi regolare la timezone in seguito. Ad esempio per impostare la data al 29
marzo 2005 e l'ora alle 16:21:
</p>

<pre caption="Impostare data e ora in UTC">
# <i>date 032916212005</i>
</pre>

</body>
</subsection>
<subsection>
<title>La scelta</title>
<body>

<p>
Il passo successivo consiste nell'installazione dello <e>stage3</e> sul
sistema. E' possibile sia scaricare l'archivio tar da internet, sia, se si è
bootato da un CD di Installazione Universale, copiarlo dal CD stesso. Se si sta
utilizzando il CD di Installazione Universale e lo stage che si intende
utilizzare è già sul CD, non è necessario scaricarlo da Internet. Nella maggior
parte dei casi lanciare il comando <c>uname -m</c> può essere utile
per capire che tipo di stage è necessario utilizzare.
</p>

<ul>
<li><uri link="#doc_chap2">Default: Scaricare da Internet</uri></li>
<li><uri link="#doc_chap3">Alternativa: Usare uno stage dal CD di
Installazione</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Default: Scaricare lo stage da Internet</title>
<subsection>
<title>Scaricare lo stage</title>
<body>

<p>
Andare al punto sul quale si è montato il filesystem (molto probabilmente
<path>/mnt/gentoo</path>):
</p>

<pre caption="Andare al mountpoint di Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Secondo la modalità di installazione, sono disponibili un paio di tool per
scaricare lo stage. Se si ha <c>links</c>, allora si può visitare
immediatamente la <uri link="/main/en/mirrors.xml">lista dei mirror di
Gentoo</uri> e scegliere un mirror vicino.
</p>

<p>
Se non si dispone di <c>links</c>, si dovrebbe poter almeno contare su
<c>lynx</c>. Se è necessario un proxy, espostare le variabili <c>http_proxy</c>
e <c>ftp_proxy</c>:
</p>

<pre caption="Impostare i proxy per lynx">
# <i>export http_proxy="http://proxy.server.com:port"</i>
# <i>export ftp_proxy="http://proxy.server.com:port"</i>
</pre>

<p>
D'ora in poi si suppone che l'utente utilizzi <c>links</c>.
</p>

<p>
Selezionare la directory <path>releases/</path>, seguita dall'architettura (per
esempio <path>x86/</path>), dalla versione di Gentoo (<path>2006.0/</path>),
e infine la directory
<path>stages/</path>. Si dovrebbero vedere tutti gli stage disponibili per
l'architettura, eventualmente suddivisi in sottodirectory a seconda della
sottoarchitettura. Selezionarne uno e premere <c>D</c> per scaricarlo. Quando si
è finito, premere <c>Q</c> per chiudere il browser.
</p>

<pre caption="Cercare i mirror con links">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>

<comment>(Se si necessita di proxy in links:)</comment>
# <i>links -http-proxy proxy.server.com:8080
http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Assicurarsi di scaricare un archivio <b>stage3</b>, le installazioni con stage1
o
stage2 non sono più supportate.
</p>

<p>
Se si desidera controllare l'integrità dello stage scaricato, usare
<c>md5sum</c> e confrontare l'output con il checksum MD5 fornito sul mirror. Ad
esempio per controllaree la validità di un pacchetto x86:
</p>

<pre caption="Controllare l'integrità di un tarball dello stage">
# <i>md5sum -c stage3-x86-2006.0.tar.bz2.DIGESTS</i>
stage3-x86-2006.0.tar.bz2: OK
</pre>

</body>
</subsection>
<subsection>
<title>Estrazione dello stage</title>
<body>

<p>
Decomprimere ora lo stage nel sistema. Utilizzare l'utility <c>tar</c> per
procedere poichè è il metodo più facile:
</p>

<pre caption="Estrazione  dello stage">
# <i>tar xvjpf stage3-*.tar.bz2</i>
</pre>

<p>
Assicurarsi di usare le stesse opzioni (<c>xvjpf</c>). La <c>x</c> sta per
<e>Estrarre</e>, la <c>v</c> per <e>Verbose</e> e mostra ciò che accade nel
processo di estrazione (opzionale), la <c>j</c> per <e>Decomprimere con
bzip2</e>, la <c>p</c> per <e>Conservare i permessi</e> e la <c>f</c> per
denotare che si vuole estrarre un file, non un input standard.
</p>

<note>
I liveCD e le immagini di boot di alcune architetture (ad esempio MIPS) si
appoggiano alla versione
di <c>tar</c> inclusa nella BusyBox che non supporta l'opzione <c>v</c>. Usare
invece <c>xjpf</c>.
</note>

<p>
Ora si è pronti per procedere con la prossima sezione riguardante come <uri
link="#installing_portage">Installare Portage</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Alternativa: Usare uno stage dal CD di Installazione</title>
<subsection>
<title>Estrazione delo stage</title>
<body>

<impo>
Se si è su piattaforma x86 e si sta utilizzando il LiveCD di installazione
<e>non</e> sono disponibili gli stage sul proprio CD. E' necessario invece
seguire le istruzioni per
l'<uri link="#doc_chap2">utilizzo di uno stage scaricato da Internet</uri>.
</impo>

<p>
Gli stage sul CD risiedono nella directory <path>/mnt/cdrom/stages</path>. Per
vedere un elenco degli stage disponibili, usare <c>ls</c>:
</p>

<pre caption="Elenco di tutti gli stage disponibili">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Se il sistema risponde con un errore, si dovrebbe montare il CD-ROM prima:
</p>

<pre caption="Montare il CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Andare ora sul punto di mount di Gentoo (di solito <path>/mnt/gentoo</path>):
</p>

<pre caption="Cambiamento della directory a /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Estrarre ora lo stage scelto. E' possibile farlo con il tool <c>tar</c>.
Assicurarsi di usare le stesse opzioni (<c>xvjpf</c>)! Di nuovo l'opzione
<c>v</c> è opzionale ed è supportata solo in alcuni casi. Nel prossimo esempio,
si estrae lo stage <path>stage3-&lt;subarch&gt;-2006.0.tar.bz2</path>.
Assicurarsi ancora di sostituire il nome del file del tarball con quello scelto.
</p>

<pre caption="Estrazione lo stage">
# <i>tar xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2006.0.tar.bz2</i>
</pre>

<p>
Ora si è pronti per procedere con la prossima sezione riguardante come <uri
link="#installing_portage">Installare Portage</uri>.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Installazione di Portage</title>
<subsection>
<title>Estrarre lo snapshot di Portage</title>
<body>

<p>
Ora è necessario procedere all'installazione dello snapshot di Portage: si
tratta di un archivio
che contiene tutti i software che è possibile installare con le relative
informazioni.
</p>

</body>
</subsection>
<subsection id="installing_from_Internet">
<title>Scaricare ed installare uno snapshot di Portage</title>
<body>

<p>
Posizionarsi nella directory in cui si è montato il filesystem (di solito
<path>/mnt/gentoo</path>):
</p>

<pre caption="Posizionarsi sul punto di mount">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Avviare <c>links</c> (o <c>lynx</c>) e recarsi alla <uri
link="/main/en/mirrors.xml">lista dei mirror Gentoo</uri>. Scegliere poi un
mirror vicino ed
entrare nella directory <path>snapshots/</path>. Scaricare l'ultimo snapshot di
Portage selezionando il file e premendo <c>D</c>.
</p>

<pre caption="Visitare la lista dei mirror">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Uscire dal browser premendo <c>Q</c>. Al momento si è in possesso di uno
snapshot di Portage in <path>/mnt/gentoo</path>.
</p>

<p>
Se si desidera verificare l'integrità dello snapshot scaricato, è possibile
utilizzare il comando <c>md5sum</c> e confrontarne l'output con il checksum M
D5 fornito sul mirror.
</p>

<pre caption="Controllo di integrità su uno snapshot di Portage">
# <i>md5sum -c portage-latest.tar.bz2.md5sum</i>
portage-latest.tar.bz2: OK
</pre>

<p>
Il passo successivo consiste nell'estrarre l'archivio sul filesystem. Digitare
il comando esettamente come indicato, l'ultima è una <c>C</c> maiuscola, non una
<c>c</c>.
</p>

<pre caption="Estrazione dello snapshot di Portage">
<comment>(Sostituire &lt;data&gt; con la data dello snapshot scaricato)</comment>
# <i>tar xvjf /mnt/gentoo/portage-&lt;data&gt;.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

</body>
</subsection>
</section>
<section id="compile_options">
<title>Configurare le opzioni di compilazione</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Per ottimizzare Gentoo, si possono impostare alcune variabili che hanno effetto
sul comportamento di Portage. Tutte queste variabili possono essere impostate
come variabili di ambiente (usando <c>export</c>), ma non in modo permanente.
Per mantenere le impostazioni, Portage fornisce il file di configurazione
<path>/etc/make.conf</path>. E' il file da modificare adesso.
</p>

<note>
Un elenco commentato di tutte le variabili possibili si trova in
<path>/mnt/gentoo/etc/make.conf.example</path>. Ma per una installazione di
Gentoo è soltanto necessario impostare le variabili che sono menzionate sotto.
</note>

<p>
Si prenda il proprio editor preferito (in questa guida si usa <c>nano</c>) per
poter cambiare le variabili di ottimizzazione che di cui si sta trattando.
</p>

<pre caption="Aprire /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Come è evidente, il file <path>make.conf.example</path> è strutturato in modo
molto semplice: le righe commentate iniziano con "#", le altre righe definiscono
le variabili, usando la sintassi <c>VARIABILE="valore"</c>. Molte di queste
variabili vengono trattate in seguito.
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<p>
La variabile <c>CHOST</c> imposta il tipo di compilazione da effettuare.
Dovrebbe già essere impostata al valore corretto. <brite>Non modificarla
</brite> perchè potrebbe causare seri malfunzionamenti. Se la variabile
<c>CHOST</c> non sembra essere quella corretta è probabile che sia stato scelto
lo stage sbagliato.
</p>

</body>
</subsection>
<subsection>
<title>CFLAGS e CXXFLAGS</title>
<body>

<p>
Le variabili <c>CFLAGS</c> e <c>CXXFLAGS</c> definiscono le opzioni di
ottimizzazione per i compilatori  C e C++ rispettivamente di <c>gcc</c>. Anche
se qui vengono definite in generale, le massime performance si ottengono quando
si impostano le variabili per ogni programma separatamente perchè ogni programma
è differente.
</p>

<p>
In <path>make.conf</path> si dovrebbero definire le impostazioni di
ottimizzazione che si ritiene possano rendere il sistema più reattivo <e>in
generale</e>. Non mettere impostazioni sperimentali in questa variabile; troppa
ottimizzazione può far funzionare male i programmi (crash, o peggio ancora,
malfunzionamento).
</p>

<p>
Non vengono spiegate tutte le possibili opzioni di ottimizzazione. Chi volesse
conoscerle, legga il <uri link="http://gcc.gnu.org/onlinedocs/">Manuale Online
GNU</uri> o la pagina di informazioni <c>gcc</c> (<c>info gcc</c> -- funziona
solo su un sistema Linux). Lo stesso file <path>make.conf.example</path>
contiene molti esempi e informazioni da consultare.
</p>

<p>
Una prima impostazione è la flag <c>-march=</c>, che specifica il nome
dell'architettura. Le possibili opzioni sono descritte nel file
<path>make.conf.example</path> (come commenti). Per esempio, per l'architettura
x86 Athlon XP:
</p>

<pre caption="Impostazione della flag march di GCC">
<comment># Gli utenti AMD64 che desiderino avere un sistema 64 bit nativo dovrebbero impostare -march=k8</comment>
<comment># Gli utenti EM64T utilizzino -march=nocona</comment>
-march=athlon-xp
</pre>

<p>
Una seconda impostazione è la flag <c>-O</c> (o maiuscola, non zero), che
specifica la classe di ottimizzazione di <c>gcc</c>. Possibili classi sono
<c>s</c> (per ottimizzazioni di formato), <c>O</c> (per nessuna ottimizzazione),
<c>1</c>, <c>2</c> o <c>3</c> per più ottimizzazioni di velocità (ogni classe ha
le stesse flag di quella precedente, più alcuni extra). Per esempio, per una
ottimizzazione di classe 2:
</p>

<pre caption="L'impostazione O di GCC">
-O2
</pre>

<p>
Altre flag di ottimizzazione molto usate sono <c>-pipe</c> (si usa pipe
piuttosto che i file temporanei, per la comunicazione tra i vari stage di
compilazione).
</p>

<p>
L'utilizzo di <c>-fomit-frame-pointer</c> (che non tiene il puntatore al frame
per funzioni che non ne hanno bisogno) potrebbe avere serie ripercussioni nel
caso sia necessario effettuare il debug dell'applicazione.
</p>

<p>
Quando si definiscono <c>CFLAGS</c> e <c>CXXFLAGS</c>, si dovrebbero mettere
insieme molte flag di ottimizzazione, come nel seguente esempio:
</p>

<pre caption="Definizione delle variabili CFLAGS e CXXFLAGS">
CFLAGS="-march=athlon-xp -pipe -O2" <comment># Gli utenti AMD64 devono impostare march=k8</comment>
<comment># Gli utenti EM64T utilizzino -march=nocona</comment>
CXXFLAGS="${CFLAGS}" <comment># Usare le stesse impostazioni per entrambe le variabili</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Con <c>MAKEOPTS</c> si definisce quante compilazioni parallele sono possibili
quando si installa un pacchetto. Il numero suggerito è il numero di CPU più uno,
ma non è detto che sia l'impostazione migliore.
</p>

<pre caption="MAKEOPTS per un normale sistema con 1-CPU">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Pronti</title>
<body>

<p>
Aggiornare <path>/mnt/gentoo/etc/make.conf</path> in base alle proprie
preferenze, e salvarlo. Si è ora pronti per continuare con l'<uri
link="?part=1&amp;chap=6">Installazione del sistema base Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>

