<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->



<sections>
<section>
<title>Installazione di uno stage</title>
<subsection>
<title>Impostare la data e l'ora</title>
<body>

<p>
Prima di continuare è necessario controllare la data e l'ora ed aggiornarle. Un
orologio impostato male può portare problemi in futuro.
</p>

<p>
Per visualizzare l'ora e la data attuali eseguire <c>date</c>:
</p>

<pre caption="Verificare la data e l'ora">
# <i>date</i>
Thu Apr  1 16:21:18 CEST 2004
</pre>

<p>
Se la data o l'ora fossero errate, è possibile aggiornarle utilizzando il comando
<c>date MMDDhhmmCCYY</c> ( dove <b>M</b> è il mese, <b>D</b> è il giorno, <b>h</b> l'ora, <b>m</b> il monuto, <b>C</b> il secolo e
<b>Y</b> l'anno). Ad esempio per impostare la data all'1 Aprile 2004 e l'ora alle 16:21:
</p>

<pre caption="Impostare data e ora">
# <i>date 040116212004</i>
</pre>

</body>
</subsection>
<subsection>
<title>La scelta</title>
<body>

<p>
Il passo successivo consiste nell'installazione dello <e>stage</e> scelto sul sistema.
E' possibile sia scaricare l'archivio tar da internet, sia, se si è bootato da un
LiveCD Universale, copiarlo dal CD stesso.
</p>

<ul>
<li><uri link="#doc_chap2">Default: Scaricare da Internet</uri></li>
<li><uri link="#doc_chap3">Alternativa: Usare uno stage dal LiveCD</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Default: Scaricare da Internet</title>
<subsection>
<title>Scaricare lo stage</title>
<body>

<p>
Andare al punto sul quale si è montato il filesystem (molto probabilmente <path>/mnt/gentoo</path>):
</p>

<pre caption="Andare al mountpoint di Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Secondo la modalità di installazione, sono disponibili un paio di tool per scaricare lo stage. Se si ha <c>lynx</c>, allora si può visitare immediatamente la <uri link="/main/en/mirrors.xml">lista dei mirror di Gentoo</uri> e scegliere un mirror vicino. Poi selezionare la directory <path>releases/</path>, seguita dalla versione di Gentoo (<path>2004.0/</path>), dall'architettura (per esempio <path>x86/</path>), e infine la directory <path>stages/</path>. Si dovrebbero vedere tutti gli stage disponibili per l'architettura. Selezionarne uno e premere <c>D</c> per scaricarlo. Quando si è finito, premere <c>Q</c> per chiudere il browser.
</p>

<note>
Gli stage di <uri link="http://hardened.gentoo.org">Gentoo Hardened</uri> (solo per piattaforma x86) sono nella sottodirectory <path>hardened/stages/</path>.
</note>

<pre caption="Cercare i mirror con lynx">
# <i>lynx http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Se non si dispone di <c>lynx</c>, si dovrebbe poter contare su <c>links2</c>. <c>links2</c> è più potente di <c>lynx</c>, ma ha alcuni svantaggi. Uno di questi è che non tiene conto delle impostazioni per il proxy definite in precedenza. Se è necessario un proxy, eseguire <c>links2 -http-proxy proxy.server.com:8080</c>. Poi si seguiranno gli stessi passi fatti con <c>lynx</c>, allo stesso modo.
</p>

<pre caption="Andare all'elenco dei mirror con links2">
<comment>(Senza proxy:)</comment>
# <i>links2 http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Con proxy:)</comment>
# <i>links2 -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Se si desidera controllare l'integrità del tarball dello stage scaricato, usare <c>md5sum</c> e confrontare l'output con il checksum MD5 fornito sul mirror.
</p>

<pre caption="Controllare l'integrità di un tarball dello stage">
# <i>md5sum stage1-x86-20030910.tar.bz2</i>
6cda1cc745ba882731ac07fbae0dd973  stage1-x86-20030910.tar.bz2
</pre>

</body>
</subsection>
<subsection>
<title>Estrazione dello stage</title>
<body>

<p>
Decomprimere ora lo stage nel sistema. Utilizzare l'utility <c>tar</c> di GNU per procedere poichè è il metodo più facile:
</p>

<pre caption="Estrazione  dello stage">
# <i>tar -xvjpf stage?-*.tar.bz2</i>
</pre>

<p>
Assicurarsi di usare le stesse opzioni (<c>-xvjpf</c>). La <c>x</c> sta per <e>Estrarre</e>, la <c>v</c> per <e>Verbose</e> (opzionale), la <c>j</c> per <e>Decomprimere con bzip2</e>, la <c>p</c> per <e>Conservare i permessi</e> e la <c>f</c> per denotare che si vuole estrarre un file, non un input standard.
</p>

<p>
Ora si è pronti per procedere con la prossima sezione riguardante come <uri link="#installing_portage">Installare Portage</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Alternativa: Usare uno stage dal LiveCD</title>
<subsection>
<title>Estrazione delo stage</title>
<body>

<p>
Gli stage sul CD risiedono nella directory <path>/mnt/cdrom/stages</path>. Per vedere un elenco degli stage disponibili, usare <c>ls</c>:
</p>

<pre caption="Elenco di tutti gli stage disponibili">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Se il sistema risponde con un errore, si dovrebbe montare il CD-ROM prima:
</p>

<pre caption="Montare il CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Andare ora sul punto di mount di Gentoo (di solito <path>/mnt/gentoo</path>):
</p>

<pre caption="Cambiamento della directory a /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Estrarre ora lo stage scelto. E' possibile farlo con il tool GNU <c>tar</c>. Assicurarsi di usare le stesse opzioni (<c>-xvjpf</c>)! Nel prossimo esempio, si estrae lo stage <path>stage3-20031011.tar.bz2</path>. Assicurarsi ancora di sostituire il nome del file del tarball con quello scelto.
</p>

<pre caption="Estrazione lo stage">
# <i>tar -xvjpf /mnt/cdrom/stages/stage3-20031011.tar.bz2</i>
</pre>

<p>
Ora si è pronti per procedere con la prossima sezione riguardante come <uri link="#installing_portage">Installare Portage</uri>.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Installazione di Portage</title>
<subsection>
<title>Supporto di rete</title>
<body>

<p>
Se non si dispone di una connessione di rete, è necessario installare una immagine
di portage fornita insieme ad uno dei LiveCD. Se in seguito si desidera usare dei pacchetti
precompilatiper accelerare l'installazione è <e>indispensabile</e> usare una immagine di
portage del LiveCD. Gli altri utenti possono scaricare una immagine di Portage aggiornata
in seguito con <c>emerge</c>.
</p>

<p>
Continuare con la sezione corrispondente alla scelta:
</p>

<ul>
  <li>
    <uri link="#installing_from_LiveCD">Installazione di una immagine di Portage e
    del codice sorgente dal LiveCD</uri> (per installazioni senza supporto di rete o con GRP)
  </li>
  <li>
    <uri link="#compile_options">Configurazione delle opzioni di compilazione</uri> (per tutte le altre installazioni)
  </li>
</ul>

</body>
</subsection>
<subsection id="installing_from_LiveCD">
<title>Installazione di una immagine di Portage e del codice sorgente dal LiveCD</title>
<body>

<p>
C'è un'immagine dell'albero di Portage disponibile sul LiveCD Universale. Dato che si sta leggendo questa parte, è lecito pensare che si stia usando un LiveCD. Per installare quest'immagine, si dia uno sguardo a <path>/mnt/cdrom/snapshots/</path> per vedere quale immagine è disponibile:
</p>

<pre caption="Controllare il contenuto di /mnt/cdrom/snapshots">
# <i>ls /mnt/cdrom/snapshots</i>
</pre>

<p>
Ora si estrae l'immagine nel modo seguente: di nuovo, assicurarsi di usare la corretta opzione per <c>tar</c>, e che la <c>C</c> in <c>-C</c> sia maiuscola. Nel prossimo esempio si utilizza <path>portage-20031011.tar.bz2</path> come nome del file dell'immagine. Assicurarsi di sosutuire il nome con quello dell'immagine scelta.
</p>

<pre caption="Estrazione dell'immagine di Portage">
# <i>tar -xvjf /mnt/cdrom/snapshots/portage-20031011.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

<p>
E' necessario inoltre copiare tutto il codice sorgente dal CD.
</p>

<pre caption="Copia del codice sorgente">
# <i>mkdir /mnt/gentoo/usr/portage/distfiles</i>
# <i>cp /mnt/cdrom/distfiles/* /mnt/gentoo/usr/portage/distfiles/</i>
</pre>

<p>
Continuare ora con la sezione su come <uri link="#dcompile_options">Configurare le opzioni di compilazione</uri>.
</p>

</body>
</subsection>
</section>
<section id="compile_options">
<title>Configurare le opzioni di compilazione</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Per ottimizzare Gentoo, si possono impostare alcune variabili che hanno effetto sul comportamento di Portage. Tutte queste variabili possono essere impostate come variabili di ambiente (usando <c>export</c>), ma non in modo permanente. Per mantenere le impostazioni, Portage fornisce il file di configurazione <path>/etc/make.conf</path>. E' il file da modificare adesso.
</p>

<note>
Un elenco commentato di tutte le variabili possibili si trova in <path>/mnt/gentoo/etc/make.conf.example</path>. Per una installazione riuscita di Gentoo è soltanto necessario impostare le variabili che sono menzionate sotto.
</note>

<p>
Si prenda il proprio editor preferito (in questa guida si usa <c>nano</c>) per poter cambiare le variabili di ottimizzazione che di cui si sta trattando.
</p>

<pre caption="Aprire /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Come è evidente, il file <path>make.conf(.example)</path> è strutturato in modo molto semplice: le righe commentate iniziano con "#", le altre righe definiscono le variabili, usando la sintassi <c>VARIABILE="valore"</c>. Molte di queste variabili vengono trattate in seguito.
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<warn>
Anche se potrebbe essere interessante, gli utenti che non hanno scelto lo stage1, <e>non</e> devono cambiare le impostazioni <c>CHOST</c> in <path>make.conf</path>. Facendolo si può rendere il sistema inutilizzabile. Di nuovo: cambiare questa variabile esclusivamente se si sta utilizzando l'installazione con lo <e>stage1</e>.
</warn>

<p>
La variabile <c>CHOST</c> definisce per quale architettura <c>gcc</c> deve compilare i programmi. Le possibilità sono:
</p>

<table>
<tr>
  <th>Architettura</th>
  <th>Sottoarchitettura</th>
  <th>Impostazione CHOST</th>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i386</ti>
  <ti>i386-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i486</ti>
  <ti>i486-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i586</ti>
  <ti>i586-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i686 e superiore (anche athlon)</ti>
  <ti>i686-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>alpha</ti>
  <ti></ti>
  <ti>alpha-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc</ti>
  <ti></ti>
  <ti>powerpc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>sparc</ti>
  <ti></ti>
  <ti>sparc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>(generica)</ti>
  <ti>hppa-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa7000</ti>
  <ti>hppa1.1-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa8000 e superiore</ti>
  <ti>hppa2.0-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>mips</ti>
  <ti></ti>
  <ti>mips-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>amd64</ti>
  <ti></ti>
  <ti>x86_64-pc-linux-gnu</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>CFLAGS e CXXFLAGS</title>
<body>

<p>
Le variabili <c>CFLAGS</c> e <c>CXXFLAGS</c> definiscono le opzioni di ottimizzazione per i compilatori  C e C++ rispettivamente di <c>gcc</c>. Anche se qui vengono definite in generale, le massime performance si ottengono quando si impostano le variabili per ogni programma separatamente perchè ogni programma è differente.
</p>

<p>
In <path>make.conf</path> si dovrebbero definire le impostazioni di ottimizzazione che si ritiene possano rendere il sistema più reattivo <e>in generale</e>. Non mettere impostazioni sperimentali in questa variabile; troppa ottimizzazione può far funzionare male i programmi (crash, o peggio ancora, malfunzionamento).
</p>

<p>
Non vengono spiegate tutte le possibili opzioni di ottimizzazione. Chi volesse conoscerle, legga il <uri link="http://www.gnu.org/software/gcc/onlinedocs/">Manuale Online GNU</uri> o la pagina di informazioni <c>gcc</c> (<c>info gcc</c> -- funziona solo su un sistema Linux). Lo stesso file <path>make.conf.example</path> contiene molti esempi e informazioni da consultare.
</p>

<p>
Una prima impostazione è la flag <c>-march=</c>, che specifica il nome dell'architettura. Le possibili opzioni sono descritte nel file <path>make.conf.example</path> (come commenti). Per esempio, per l'architettura x86 Athlon XP:
</p>

<pre caption="Impostazione della flag march di GCC">
-march=athlon-xp
</pre>

<p>
Una seconda impostazione è la flag <c>-O</c>, che specifica la classe di ottimizzazione di <c>gcc</c>. Possibili classi sono <c>s</c> (per ottimizzazioni di formato), <c>O</c> (per nessuna ottimizzazione), <c>1</c>, <c>2</c> o <c>3</c> per più ottimizzazioni di velocità (ogni classe ha le stesse flag di quella precedente, più alcuni extra). Per esempio, per una ottimizzazione di classe 2:
</p>

<pre caption="L'impostazione O di GCC">
-O2
</pre>

<p>
Altre flag di ottimizzazione molto usate sono <c>-pipe</c> (si usa pipe piuttosto che i file temporanei, per la comunicazione tra i vari stage di compilazione) e <c>-fomit-frame-pointer</c> (che non tiene il puntatore al frame per funzioni che non ne hanno bisogno).
</p>

<p>
Quando si definiscono <c>CFLAGS</c> e <c>CXXFLAGS</c>, si dovrebbero mettere insieme molte flag di ottimizzazione, come nel seguente esempio:
</p>

<pre caption="Definizione delle variabili CFLAGS e CXXFLAGS">
CFLAGS="-march=athlon-xp -pipe -O2"
CXXFLAGS="${CFLAGS}"
<comment># Usare le stesse impostazioni per entrambe le variabili</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Con <c>MAKEOPTS</c> si definisce quante compilazioni parallele sono possibili quando si installa un pacchetto. Il numero suggerito è il numero di CPU più uno.
</p>

<pre caption="MAKEOPTS per un normale sistema con 1-CPU">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Pronti</title>
<body>

<p>
Aggiornare <path>/mnt/gentoo/etc/make.conf</path> in base alle proprie preferenze, e salvarlo. Si è ora pronti per continuare con l'<uri link="?part=1&amp;chap=6">Installazione del sistema base Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>

