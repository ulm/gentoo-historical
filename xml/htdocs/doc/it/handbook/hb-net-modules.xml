<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/hb-net-modules.xml,v 1.1 2005/09/24 18:43:48 so Exp $ -->

<sections>

<version>1.4</version>
<date>2005-09-07</date>

<section>
<title>Moduli di rete</title>
<body>

<p>
Si supportano gli script di rete modulari, il che significa che si può
aggiungere il supporto per nuovi tipi di interfaccia e moduli di configurazione
mentre si mantiene la compatibilità con quelli esistenti.
</p>

<p>
I moduli si caricano di default se il pacchetto che essi necessitano è
installato. Se si specifica un modulo che non ha installato il suo pacchetto,
si ottiene un errore che avvisa quale pacchetto si ha bisogno di installare.
Si usano solo le impostazioni di moduli quando si hanno due o più pacchetti
installati che forniscono lo stesso servizio e si deve preferire uno rispetto
ad un altro.
</p>

<pre caption="Preferenza di moduli">
<comment># Si preferisce iproute2 su ifconfig</comment>
modules=( "iproute2" )

<comment># Si può anche specificare altri moduli per una interfaccia
# In questo caso si preferisce udhcpc su dhcpcd</comment>
modules_eth0=( "udhcpc" )

<comment># Si possono anche specificare quali moduli non usare - per esempio
# si potrebbe usare un supplicant o un linux-wlan-ng per controllare
# la configurazione wireless ma volere ancora configurare le impostazioni di
# rete per ESSID che sono associate.</comment>
modules=( "!iwconfig" )
</pre>

</body>
</section>
<section>
<title>Utility di configurazione delle interfacce</title>
<body>

<p>
Sono fornite due utility di configurazione delle interfacce: ifconfig e
iproute2. Si ha bisogno di una di esse per fare qualsiasi tipo di
configurazione di rete.
</p>

<p>
ifconfig è il default di Gentoo e è incluso nel profilo di sistema. iproute2
è un pacchetto più potente e flessibile, ma non è incluso di default.
</p>

<pre caption="Installare iproute2">
# <i>emerge sys-apps/iproute2</i>

<comment># Preferire iproute2 su ifconfig se entrambi sono installati</comment>
modules=( "iproute2" )
</pre>

<p>
Poichè ifconfig e iproute2 fanno un lavoro molto simile, si permette che le
loro configurazioni di base funzionino con le altre. Per esempio entrambi i
codici funzionano con il modulo che si sta usando.
</p>

<pre caption="Esempi di ifconfig e iproute2">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># Si può anche specificare il broadcast</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>

</body>
</section>
<section id="dhcp">
<title>DHCP</title>
<body>

<p>
DHCP è la possibilità di ottenere informazioni di rete (indirizzo IP, server
DNS, Gateway, etc) da un server DHCP. Se c'è un server DHCP funzionante sulla
rete, si deve dire a ogni client di usare DHCP e si imposta la rete da sola.
Si deve configurare altre cose come wireless, ppp o altre se sono
richieste, prima di usare DHCP.
</p>

<p>
DHCP può essere fornito da dhclient, dhcpcd, pump o udhcpc. Ogni modulo DHCP
ha i suoi pro e i suoi contro - eccone un breve riassunto.
</p>

<table>
<tr>
  <th>Modulo DHCP</th>
  <th>Pacchetto</th>
  <th>Pro</th>
  <th>Contro</th>
</tr>
<tr>
  <ti>dhclient</ti>
  <ti>net-misc/dhcp</ti>
  <ti>
    Fatto da ISC, gli stessi che fanno il software BIND DNS. Molto
    configurabile
  </ti>
  <ti>
    La configurazione è complessa, il software è enorme, non si possono
    ottenere server NTP da DHCP, non manda hostname di default
  </ti>
</tr>
<tr>
  <ti>dhcpcd</ti>
  <ti>net-misc/dhcpcd</ti>
  <ti>
    Da tanto tempo default di Gentoo, nessuna fiducia sugli altri tool
  </ti>
  <ti>
    Non più mantenuto da sviluppatori, può essere lento, rimane lanciato
    anche quando è allocato all'infinito
  </ti>
</tr>
<tr>
  <ti>pump</ti>
  <ti>net-misc/pump</ti>
  <ti>
    Leggero, nessuna fiducia sugli altri tool
  </ti>
  <ti>
    Non è più mantenuto da sviluppatori, non sicuro, specialmente su alcuni
    modem, non si possono ottenere server NIS da DHCP
  </ti>
</tr>
<tr>
  <ti>udhcpc</ti>
  <ti>net-misc/udhcp</ti>
  <ti>
    Leggero - piccolo dhcp client, fatto per sistemi embedded
  </ti>
  <ti>
    Poco testato - nessuna distro lo usa di default, non può definire un
    timeout oltre 3 secondi
  </ti>
</tr>
</table>

<p>
Se si ha installato più di un client DHCP, si deve specificare quale è quello
da usare - altrimenti si usa di default dhcpcd se disponibile.
</p>

<p>
Per mandare opzioni specifiche al modulo dhcp, usare module_eth0="..."
<e>(cambiare module con il module DHCP che si sta usando - ie dhcpcd_eth0)</e>
</p>

<p>
Si cerca di rendere DHCP più semplice - si supportano i seguenti comandi
usando la variabile dhcp_eth0. Di default non è impostata nessuna di queste.
</p>

<ul>
  <li>release - rilascia l'indirizzo IP per ri-usarlo</li>
  <li>nodns - non sovrascrivere /etc/resolv.conf</li>
  <li>nontp - non sovrascrivere /etc/ntp.conf</li>
  <li>nonis - non sovrascrivere /etc/yp.conf</li>
</ul>

<pre caption="Esempio di configurazione DHCP in /etc/conf.d/net">
<comment># Solo necessario se si ha installato più di un modulo DHCP</comment>
modules=( "dhcpcd" ) 

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># Timeout dopo 10 secondi</comment>
dhcp_eth0="release nodns nontp nonis" <comment># Ottiene solo un indirizzo</comment>
</pre>

<note>
dhcpcd, udhcpc e pump mandano l'attuale hostname al server DHCP di default
così non si deve specificarlo ancora.
</note>

</body>
</section>
<section>
<title>Modem ADSL</title>
<body>

<p>
Si deve installare il software ADSL.
</p>

<pre caption="Installare il pachetto rp-pppoe">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
baselayout-1.11.x supporta solo PPPOE. Si spera che le future versioni
supportino PPPOA.
</warn>

<p>
C'è bisogno di istruire configure eth0 affinchè sia una interfaccia ADSL e
entrare nel proprio username.
</p>

<pre caption="Configure eth0 per ADSL">
config_eth0=( "adsl" )
adsl_user_eth0="username"
</pre>

<p>
Alla fine si deve definire il proprio username e la password in
<path>/etc/ppp/pap-secrets</path>
</p>

<pre caption="Esempio /etc/ppp/pap-secrets">
<comment># L'asterisco * è importante</comment>
"username"  *  "password"
</pre>

</body>
</section>
<section id="apipa">
<title>APIPA (Automatic Private IP Addressing)</title>
<body>

<p>
APIPA cerca di trovare un indirizzo libero tra 169.254.0.0-169.254.255.255
con un arping di un indirizzo a caso, tra quelli di cui sopra,
all'interfaccia. Se non si trova nessuna replica allora si assegna questo
indirizzo all'interfaccia.
</p>

<p>
L'uso di APIPA è utile per le LAN in cui non c'è nessun server DHCP e non ci
si connette direttamente a Internet e a tutti gli altri computer.
</p>

<p>
Per il supporto di APIPA emergere net-misc/iputils o net-analyzer/arping.
</p>

<pre caption="Configurazione di APIPA in /etc/conf.d/net">
<comment># Cercare DHCP - se fallisce ritornare a APIPA</comment>
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># Usare APIPA</comment>
config_eth0=( "apipa" )
</pre>

</body>
</section>
<section>
<title>Insieme di collegamenti (Bonding)</title>
<body>

<p>
Per poter fare un insieme di collegamenti (bonding/trunking) emergere
net-misc/ifenslave.
</p>

<p>
L'insieme di collegamenti (bonding) è usato per aumentare la larghezza di
banda della rete. Se si hanno due schede di rete sulla stessa rete, si possono
collegarle così le applicazioni vedono una sola interfaccia ma in realtà
usano entrambe le due schede di rete.
</p>

<pre caption="Configurazione di bonding in /etc/conf.d/net">
<comment>Per collegare le interfacce</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># Si può non assegnare un IP all'interfaccia collegata</comment>
config_bond0=( "null" )

<comment># Dipende da eth0, eth1 e eth2 poichè essi possono richiedere una
# configurazione extra</comment>
depend_bond0() {
  need net.eth0 net.eth1 net.eth2
}
</pre>

</body>
</section>
<section>
<title>Ponte di rete (Bridging) (supporto 802.1d)</title>
<body>

<p>
Per il supporto del ponte di rete (bridging) emergere net-misc/bridge-utils
</p>

<p>
Il ponte di rete è usato per unire reti. Per esempio, si ha un server che si
connette a Internet con un modem ADSL e una scheda wireless access che permette
a altri computer di connettersi a Internet con il modem ADSL. Si può creare un
ponte per unire le due interfacce.
</p>

<pre caption="Configurazione di bridge in /etc/conf.d/net">
<comment># Configurare il ponte - "man btctl" per ulteriori dettagli</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># Per aggiungere porte al ponte br0</comment>
bridge_br0="eth0 eth1"

<comment># Si devono configurare le porte con valori null così dhcp non si
# avvia</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># Dare un indirizzo al ponte - si può usare DHCP</comment>
config_br0=( "192.168.0.1/24" )

<comment># Dipende da eth0 e eth1 poichè essi possono richiedere una
# configurazione extra</comment>
depend_br0() {
  need net.eth0 net.eth1
}
</pre>

<impo>
Per usare alcune impostazioni per il ponte di rete, si dovrebbe consultare
la guida
<uri link="?part=4&amp;chap=2#variable_name">nomi di variabili</uri>
</impo>

</body>
</section>
<section>
<title>Indirizzo MAC (MAC Address)</title>
<body>

<p>
Non si deve emergere niente per cambiare l'indirizzo MAC di una interfaccia
se si cambia a un indirizzo specifico. Se si deve cambiare a un indirizzo o
indirizzi a caso di un dato tipo, allora si deve emergere
net-analyzer/macchanger.
</p>

<pre caption="Esempio di cambio di un Indirizzo MAC">
<comment># Impostare l'indirizzo MAC all'interfaccia</comment>
mac_eth0="00:11:22:33:44:55"

<comment># Per randomizzare solo gli ultimi 3 byte</comment>
mac_eth0="random-ending"

<comment># Per randomizzare tra lo stesso tipo fisico di connessione (esempio
# fibra, copper, wireless), tutti i fornitori</comment>
mac_eth0="random-samekind"

<comment># Per randomizzare tra qualsiasi tipo fisico di connessione (esempio
# fibra, copper, wireless), tutti i fornitori</comment>
mac_eth0="random-anykind"

<comment># Randomizzazione completa - ATTENZIONE: alcuni indirizzi MAC generati
# da questo esempio NON funzionano come aspettato</comment>
mac_eth0="random-full"
</pre>

</body>
</section>
<section>
<title>Tunnelling</title>
<body>

<p>
Non si deve emergere niente per tunnelling poichè è fatto dall'utility
di configurazione delle interfacce.
</p>

<pre caption="Configurazione di tunnelling in /etc/conf.d/net">
<comment># Per tunnel GRE</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># Per tunnel IPIP</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># Per configurare l'interfaccia</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" ) 
</pre>

</body>
</section>
<section>
<title>VLAN (supporto 802.1q)</title>
<body>

<p>
Per il supporto di VLAN emergere net-misc/vconfig.
</p>

<p>
Virtual LAN è un gruppo di dispositivi di rete che si comportano come
se sono state connesse a un singolo segmento di rete - anche se non lo sono.
I membri VLAN possono solo vedere membri della stessa VLAN anche se potrebbero
condividere la stessa rete.
</p>

<pre caption="Configurazione di VLAN in /etc/conf.d/net">
<comment># Specificare i numeri VLAN per le interfacce come seguenti</comment>
<comment># Assicurarsi che gli ID di VLAN NON siano zeri</comment>
vlans_eth0="1 2"

<comment># Si può anche configurare la VLAN</comment>
<comment># vedere la man page di vconfig per ulteriori dettagli</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># Configurare l'interfaccia come al solito</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Per usare alcune imostazioni di VLAN, si dovrebbe consultare
la guida
<uri link="?part=4&amp;chap=2#variable_name">nomi di variabili</uri>.
</impo>

</body>
</section>

</sections>
