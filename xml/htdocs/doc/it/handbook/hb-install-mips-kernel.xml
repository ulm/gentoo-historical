<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/hb-install-mips-kernel.xml,v 1.5 2005/04/17 22:23:16 so Exp $ -->

<sections>

<version>1.11</version>
<date>2005-04-16</date>

<section>
<title>Timezone</title>
<body>

<p>
Innanzitutto è necessario selezionare la propria timezone, in modo che il sistema riconosca in che parte del globo è collocato. Per la propria timezone, consultare <path>/usr/share/zoneinfo</path>. Creare dunque un link simbolico a <path>/etc/localtime</path> usando <c>ln</c>:
</p>

<pre caption="Abilitare le informazioni sulla timezone">
# <i>ln -sf /usr/share/zoneinfo/GMT /etc/localtime</i>
</pre>

</body>
</section>
<section>
<title>Installare i sorgenti</title>
<subsection>
<title>Scegliere un Kernel</title>
<body>

<p>
Il cuore, intorno al quale sono sviluppate tutte le distribuzioni, è il Kernel di Linux. E' la parte di software compresa tra i programmi e l'hardware. Gentoo dà la possibilità ai suoi utenti di scegliere tra diversi sorgenti del kernel. Una lista completa delle descrizioni dei kernel disponibili, è consultabile nella <uri link="http://www.gentoo.org/doc/it/gentoo-kernel.xml">Guida ai Kernel Gentoo</uri>.
</p>

<p>
Sistemi basati su MIPS possono scegliere tra <c>mips-sources</c> (il sorgente del kernel di default per l'architettura MIPS) e <c>mips-prepatch-sources</c> (versione prerilascio del kernel).
</p>

<p>
Dopo la scelta del kernel, è necessario installarlo con <c>emerge</c>. Sostituire il kernel con quello scelto, il seguente è solo un esempio:
</p>

<note>
Sono necessarie patch speciali per far funzionare un kernel su server Cobalt. La flag USE <c>cobalt</c> deve essere definita per ottenere e  applicare le patch.
</note>

<pre caption="Installare un sorgente del kernel">
<comment>(Per macchine SGI)</comment>
# <i>emerge mips-sources</i>

<comment>(Per macchine Cobalt)</comment>
# <i>mkdir -p /etc/portage</i>
# <i>echo "sys-kernel/mips-sources cobalt" &gt;&gt; /etc/portage/package.use</i>
# <i>emerge mips-sources</i>
</pre>

<p>
Se si dà un'occhiata a <path>/usr/src</path>, si dovrebbe vedere un link simbolico chiamato <path>linux</path>, che punta al sorgente del kernel:
</p>

<pre caption="Il link simbolico al sorgente del kernel">
# <i>ls -l /usr/src/linux</i>
lrwxrwxrwx    1 root     root           12 Oct 13 11:04 /usr/src/linux -&gt; linux-2.4.24
</pre>

<p>
Se così non fosse (cioè il link simbolico punta a un sorgente del kernel differente), prima di continuare è necessario cambiare il link simbolico:
</p>

<pre caption="Cambiare il link simbolico al sorgente del kernel">
# <i>rm /usr/src/linux</i>
# <i>cd /usr/src</i>
# <i>ln -s linux-2.4.24 linux</i>
</pre>

<p>
Ora si procede a configurare e compilare il sorgente del kernel.
</p>

</body>
</subsection>
</section>
<section>
<title>Compilazione &amp; installazione del kernel</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Di solito si è vista la configurazione manuale del sorgente del kernel. Adesso invece si vedranno alcuni esempi di configurazione, sui quali si può basare la propria. Si deve scegliere tra le opzioni che più si avvicinano alla combinazione tra il proprio sistema e il kernel che si usa. Si possono trovare altri esempi di configurazione nei link qui sotto.
</p>

<table>
  <tr>
    <th>Sistema</th>
    <th>Versione del kernel</th>
  </tr>
  <tr>
    <ti>SGI IP22 (Indy, Indigo 2, Challenge S)</ti>
    <ti>
      <uri link="http://www.longlandclan.hopto.org/~stuartl/mips-linux/sgi/ip22/config/2.4.29-mipscvs-20050130.gz">2.4.29</uri>
    </ti>
  </tr>
  <tr>
    <ti>Cobalt Qube/Raq 2800</ti>
    <ti>
      <uri link="http://dev.gentoo.org/~kumba/mips/cobalt/kernel/cobalt-2605.config">2.6.5</uri>
      <uri link="http://dev.gentoo.org/~kumba/mips/cobalt/kernel/cobalt-2606.config">2.6.6</uri>
      <uri link="http://dev.gentoo.org/~kumba/mips/cobalt/kernel/cobalt-config-2609">2.6.9</uri>
    </ti>
  </tr>
</table>

<ul>
  <li>
    Configurazioni IP22 (Indy, Indigo2, Challenge S)
    <uri link="http://www.longlandclan.hopto.org/~stuartl/mips-linux/sgi/ip22/config">
      http://www.longlandclan.hopto.org/~stuartl/mips-linux/sgi/ip22/config
    </uri>
  </li>
  <li>
    Configurazioni Cobalt Server
    <uri link="http://dev.gentoo.org/~kumba/mips">
      http://dev.gentoo.org/~kumba/mips
    </uri>
  </li>
</ul>

<note>
Ulteriori esempi di configurazioni del kernel possono essere trovati sul Gentoo/MIPS Hardware Support Database, che si trova in <uri>http://stuartl.longlandclan.hopto.org/gentoo/mips</uri>.
</note>

<p>
Una volta trovata una configurazione, si deve scaricarla nella directory del sorgente del kernel, e rinominarla in <path>.config</path>. Da lì, si può eseguire <c>make oldconfig</c> per aggiornare e per cambiare la configurazione prima della compilazione.
</p>

<pre caption="Configurare il kernel">
# <i>cd /usr/src/linux</i>
# <i>cp /path/to/example-config .config</i>
# <i>make oldconfig</i>
<comment>(Premere invio ad ogni prompt per accettare il default, cambiamenti sono fatti più avanti)</comment>
# <i>make menuconfig</i>
</pre>

</body>
</subsection>
<subsection id="compiling">
<title>Compilazione e Installazione</title>
<body>

<p>
Ora che il kernel è configurato, il prossimo passo sarà la sua compilazione e la sua installazione. Uscire dal menu di configurazione e avviare il processo di compilazione:
</p>

<pre caption="Compilare il kernel">
<comment>(Per kernel 2.4)</comment>
# <i>make dep &amp;&amp; make vmlinux modules modules_install</i>

<comment>(Per kernel 2.6)</comment>
# <i>make &amp;&amp; make modules_install</i>
</pre>

<p>
Quando la compilazione è finita, è necessario copiare l'immagine del kernel in <path>/boot</path>.
</p>

<note>
I server Cobalt, si aspettano di vedere una immagine del kernel compressa. Ricordarsi di fare <c>gzip -9</c> al file dopo che si è entrati in <path>/boot</path>.
</note>

<pre caption="Installare il kernel">
# <i>cp vmlinux /boot/kernel-2.4.24</i>
# <i>cp System.map /boot/System.map-2.4.24</i>
<comment>(Cobalt Servers -- Comprimere la immagine del kernel)</comment>
# <i>gzip -9v /boot/kernel-2.4.24</i>
</pre>

<p>
E' inoltre consigliato copiare il file di configurazione del kernel in <path>/boot</path>.
</p>

<pre caption="Back up della configurazione del kernel">
# <i>cp .config /boot/config-2.4.24</i>
</pre>

<!--
<p>
Se il sistema non avvia i kernel ELF, compilare il kernel con <c>make vmlinux.ecoff</c> invece di <c>make vmlinux</c>. L'immagine del kernel sarà salvata come <path>arch/mips/boot/vmlinux.ecoff</path>, invece di <path>vmlinux</path>.
</p>
-->
</body>
</subsection>
</section>
<section id="kernel_modules">
<title>Installare i moduli del kernel separati</title>
<subsection>
<title>Configurare i moduli</title>
<body>

<p>
Si dovrebbero inserire i moduli che si vogliono caricare in uno dei file elencati qui sotto. Se si vuole, si possono anche aggiungere altre opzioni ai moduli.
</p>

<ul>
  <li><path>/etc/modules.autoload.d/kernel-2.4</path> - Solo kernel 2.4</li>
  <li><path>/etc/modules.autoload.d/kernel-2.6</path> - Solo kernel 2.6</li>
  <li><path>/etc/modules.autoload</path> - Tutti i kernel</li>
</ul>

<p>
Se si desidera caricare un modulo del kernel, comune al 2.4 e al 2.6, metterlo in <path>/etc/modules.autoload</path>. Altrimenti, nel file appropriato.
</p>

<p>
Per vedere tutti i moduli disponibili, eseguire il comando <c>find</c>. Non dimenticarsi di sostituire "&lt;kernel version&gt;" con la versione del kernel che si è compilata:
</p>

<pre caption="Vedere tutti i moduli disponibili">
# <i>find /lib/modules/&lt;kernel version&gt;/ -type f -iname '*.o' -or -iname '*.ko'</i>
</pre>

<p>
Per esempio, per caricare automaticamente il modulo <c>3c59x.o</c>, modificare il file appropriato e inserire il nome.
</p>

<pre caption="Modificare /etc/modules.autoload.d/kernel-2.4">
# <i>nano -w /etc/modules.autoload.d/kernel-2.4</i>
</pre>

<pre caption="/etc/modules.autoload.d/kernel-2.4 o kernel-2.6">
3c59x
</pre>

<p>
Questo può essere fatto anche con una riga sola:
</p>

<pre caption="Aggiungere un modulo -- con una riga sola">
# <i>echo '3c59x' >> /etc/modules.autoload.d/kernel-2.4</i>
<comment>(o kernel-2.6, o /etc/modules.autoload.....)</comment>
</pre>

<p>
Continuare l'installazione con la <uri link="?part=1&amp;chap=8">Configurazione del sistema</uri>.
</p>

</body>
</subsection>
</section>
</sections>
