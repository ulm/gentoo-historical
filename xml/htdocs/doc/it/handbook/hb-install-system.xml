<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->


<sections>
<section>
<title>Effettuare il chroot</title>
<subsection>
<title>Opzionale: Selezionare i mirror</title>
<body>

<p>
Se si è eseguito il boot da un LiveCD, si può usare <c>mirrorselect</c> per aggiornare <path>/etc/make.conf</path>, in modo tale che siano usati i mirror più veloci sia per Portage sia per il codice sorgente (ovviamente nel caso si disponga
di una connessione funzionante):
</p>

<pre caption="Selezionare i mirror più veloci">
# <i>mirrorselect -a -s4 -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Se per qualche motivo <c>mirrorselect</c> non dovesse funzionare, non bisogna spaventarsi. Questo passo è completamente opzionale. Se <c>mirrorselect</c> non funziona, sono sufficienti i valori di default.
</p>

</body>
</subsection>
<subsection>
<title>Copiare le informazioni del DNS</title>
<body>

<p>
C'è ancora una cosa da fare prima di poter entrare nel nuovo ambiente, si devono copiare le informazioni del DNS in <path>/etc/resolv.conf</path>. Questo passo è necessario per fare in modo che la rete funzioni ancora, anche dopo esser entrati nel nuovo ambiente. <path>/etc/resolv.conf</path> contiene i nameserver per la rete.
</p>

<pre caption="Copiare le informazioni del DNS">
<comment>(L'opzione "-L" serve per assicurarsi di non copiare un link simbolico)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Entrare nel nuovo ambiente</title>
<body>

<p>
Adesso che tutte le partizioni sono pronte e che l'ambiente di base è installato, è arrivato il momento di entrare nel nuovo ambiente di installazione effettuando il <e>chroot</e>. Significa che ci si sposta dall'attuale ambiente di installazione (LiveCD o altre modalità di installazione) al sistema di installazione nel proprio sistema (nelle partizioni create).
</p>

<p>
Il chroot è costituito di tre parti. Nella prima si cambia root, da <path>/</path> (sul supporto di installazione) a <path>/mnt/gentoo</path> (nelle partizioni create), usando <c>chroot</c>. Nella seconda si crea un nuovo ambiente usando <c>env-update</c>, il quale inizializza le variabili di ambiente. Nella terza si caricano queste variabili in memoria, con <c>source</c>.
</p>

<pre caption="Chroot nel nuovo ambiente">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
Regenerating /etc/ld.so.cache...
# <i>source /etc/profile</i>
</pre>

<p>
Congratulazioni! Da adesso si è dentro Gentoo Linux. Naturalmente la fine dell'installazione è lontana, poichè mancano ancora alcune sezioni.
</p>

</body>
</subsection>
<subsection>
<title>Opzionale: Aggiornare Portage</title>
<body>

<p>
Se non si è installata una immagine di Portage nel precedente capitolo,
si deve scaricare da Internet una immagine recente di Portage. L'operazione si effettua con <c>emerge sync</c>. Gli
altri utenti possono saltare questa sezione e continuare con quella su come
<uri link="#configure_USE">Configurare le variabili USE</uri>.
</p>

<pre caption="Aggiornare Portage">
# <i>emerge sync</i>
<comment>(Nel caso che non si possa usare rsync, utilizzare "emerge-webrsync"
che scarica ed installa portage via web)</comment>
# <i>emerge-webrsync</i>
</pre>

<p>
Se si riceve l'avviso che è disponibile una nuova versione di Portage e che si dovrebbe aggiornarlo, si può tranquillamente ignorare questo avviso. Portage viene aggiornato in seguito, durante l'installazione.
</p>

</body>
</subsection>
<subsection id="configure_USE">
<title>Configurare la variabile USE</title>
<body>

<p>
<c>USE</c> è una delle variabili più potenti che Gentoo fornisce agli utenti. Molti programmi possono essere compilati con o senza il supporto opzionale per certi elementi. Per esempio, alcuni programmi possono essere compilati con il supporto per gtk, o con il supporto per qt. Altri con o senza il supporto per SSL. Alcuni programmi possono essere compilati con il suporto per framebuffer (svgalib), anzichè con quello per X11 (server X).
</p>

<p>
La maggior parte delle distribuzioni compila i propri pacchetti con il più alto supporto possibile, aumentando le dimensioni dei programmi e il tempo di avvio, per non parlare dell'enorme quantità di dipendenze. Con Gentoo si può definire con quali opzioni un pacchetto deve essere compilato. Questa è la funzione di <c>USE</c>.
</p>

<p>
Nella variabile <c>USE</c> si definiscono keywords che sono vengono poi tradotte in opzioni di compilazione. Per esempio, <e>ssl</e> abilita il supporto ssl nei programmi che lo supportano. <e>-X</e> (notare il trattino davanti) rimuove il supporto per il server X. <e>gnome gtk -kde -qt</e> abilita i programmi al supporto gnome (e gtk), ma non a quello kde (e qt), rendendo il sistema ottimizzato per GNOME.
</p>

<p>
Le impostazioni di default di <c>USE</c> sono conservate in <path>/etc/make.profile/make.defaults</path>. Ciò che viene specificato in <path>/etc/make.conf</path> è considerato rispetto alle impostazioni di default. Se si aggiunge qualcosa alle impostazioni di <c>USE</c>, si aggiunge anche all'elenco di default. Se si rimuove qualcosa dalle impostazioni di <c>USE</c> (mettendo un trattino davanti), si rimuove anche dall'elenco di default (se era nell'elenco). Non si deve cambiare <e>mai</e> nessuna opzione nella directory <path>/etc/make.profile</path>; in quanto essa viene sovrascritta quando si aggiorna Portage.
</p>

<p>
Una descrizione completa di <c>USE</c> si trova nella seconda parte del Manuale Gentoo, <uri link="?part=2&amp;chap=1">Capitolo 1: flag USE</uri>. Una descrizione completa sulle flag USE disponibili si trova in <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Vedere le flag USE disponibili">
# <i>less /usr/portage/profiles/use.desc</i>
</pre>

<p>
Come esempio ecco le impostazioni di <c>USE</c> per un sistema basato su KDE, e con il supporto per DVD, ALSA e masterizzazione CD:
</p>

<pre caption="Si apre /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Impostazioni USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: Usare una compilazione distribuita</title>
<body>

<p>
Se si è interessati ad usare un gruppo di sistemi che collaborino nella compilazione, si può fare riferimento alla <uri link="http://www.gentoo.org/doc/it/distcc.xml">Guida a DistCC</uri>. Con l'aiuto di <c>distcc</c>, si può usare la potenza di elaborazione di molti sistemi per rendere più rapida l'installazione.
</p>

</body>
</subsection>
</section>
<section>
<title>Differenze tra stage1, stage2 e stage3</title>
<body>

<p>
Si prendano ora un momento in considerazione i passi precedenti. E' stato chiesto di scegliere tra uno stage tra <e>stage1</e>, <e>stage2</e> e <e>stage3</e>. Ed è stato anche detto che la scelta è importante perchè influisce su ulteriori punti di installazione. Questa è la prima parte in cui lo stage scelto definisce quali sono questi ulteriori punti.
</p>

<ul>
<li>
  Se si è scelto lo <e>stage1</e>, si devono seguire <e>entrambe</e> le parti di questo capitolo (iniziando con le istruzioni su come <uri link="#doc_chap3">Passare dallo stage1 allo stage2</uri>)
</li>
<li>
  Se si è scelto lo <e>stage2</e>, si può saltare la prima parte e iniziare con la seconda (<uri link="#doc_chap4">Passare dallo stage2 allo stage3</uri>)
</li>
<li>
  Se si è scelto lo <e>stage3</e> (con o senza i GRP), allora si possono saltare entrambe le parti e continuare con la prossima sezione: <uri link="?part=1&amp;chap=7">Configurazione del Kernel</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Passare dallo stage1 allo stage2</title>
<subsection>
<title>Introduzione al bootstrapping</title>
<body>

<p>
Si è scelto di compilare tutto partendo da zero.
</p>

<p>
In questa parte si esegue il <e>bootstrap</e> di Gentoo. Questo richiede un bel po' di tempo, ma il risultato è un sistema ottimizzato per la propria macchina e per le proprie necessità.
</p>

<p>
Fare il <e>bootstrap</e> significa compilare la GNU C Library, la GNU Compiler Collection e molti altri programmi di sistema.
</p>

<p>
Prima di fare il bootstrap, si elencano un po' di opzioni che potrebbero essere utili. Se non si desidera leggerle,
si può continuare con le istruzioni su come <uri link="#doc_chap3_sect4">Fare il bootstrap del sistema</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Opzionale: Diminuire il tempo di compilazione</title>
<body>

<p>
Se si desidera velocizzare il bootstrap, si può temporaneamente deselezionare il supporto java. Ciò significa che la GNU Compiler Collection e la GNU C Library vengono compilati senza il supporto java (il che diminuisce considerevolmente il tempo di compilazione). Nonostante non si abbia il GNU Java Compiler (<c>gcj</c>), <e>non</e> vuol dire che il sistema non può usare applicazioni java e altri programmi che richiedono java.
</p>

<p>
Per deselezionare il supporto java, assegnare <e>USE="-java"</e>, prima di iniziare il bootstrap.
</p>

<pre caption="Deselezionare il supporto java">
# <i>export USE="-java"</i>
</pre>

<p>
E' necessario ricordarsi di disabilitare la variabile subito dopo il bootstrap:
</p>

<pre caption="Disabilitare USE">
# <i>unset USE</i>
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: Scaricare subito i sorgenti</title>
<body>

<p>
Se non si è copiato prima tutto il codice sorgente, lo script di bootstrap provvede al download di tutti i file necessari. Per farlo è necessaria una connessione a internet. Se si vuole prima scaricare il codice sorgente e dopo fare il bootstrap del sistema (per esempio, se non si vuole avere aperta una connessione a internet durante la compilazione), utilizzare l'opzione <e>-f</e> dello script di bootstrap, che provvede a scariocare tutto il codice sorgente.
</p>

<pre caption="Scaricare il sorgente necessario">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection>
<title>Fare il bootstrap del sistema</title>
<body>

<p>
Inserire il prossimo comando per iniziare il bootstrap. Questa fase richiede molto tempo prima che sia conclusa.
</p>

<pre caption="Fare il bootstrap del sistema">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Se precedentemente si è cambiata l'impostazione di <c>CHOST</c> in <path>/etc/make.conf</path>, è necessario reinizializzare alcune variabili per far funzionare <c>gcc</c> in un modo più veloce:
</p>

<pre caption="Reinizializzare le variabili di ambiente">
# <i>source /etc/profile</i>
</pre>

<p>
Continuare con il prossimo punto su come <uri link="#doc_chap4">Passare dallo stage2 allo stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Passare dallo stage2 allo stage3</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Se si sta leggendo questa sezione, si ha un sistema con il bootstrap già fatto (o è stato fatto precedentemente, o si sta usando lo <e>stage2</e>). Adesso si devono compilare tutti i pacchetti del sistema.
</p>

<p>
Non proprio <e>tutti</e> in realtà, si compilano solo i pacchetti del sistema dei quali non si può fare a meno. Alcuni pacchetti del sistema hanno molte alternative (come i logger di sistema), e poichè Gentoo si basa sulle scelte, non si vuole costringere nessuno ad utilizzare una scelta piuttosto di un'altra.</p>

</body>
</subsection>
<subsection>
<title>Opzionale: Vedere cosa si sta per fare</title>
<body>

<p>
Se si vuole sapere quali pacchetti stanno per essere installati, eseguire <c>emerge --pretend system</c>. Si ottiene una lista di tutti i pacchetti che si stanno per installare. Questa lista è molto lunga e si dovrebbe usare un pager come <c>less</c> o <c>more</c> per andare su o giù per lista.
</p>

<pre caption="Vedere l'effetto 'emerge system'">
# <i>emerge --pretend system | less</i>
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: Scaricare i sorgenti</title>
<body>

<p>
Se si vuole usare <c>emerge</c> per scaricare i sorgenti prima di continuare (per esempio non si vuole avere aperta una connessione a internet mentre si stanno compilando tutti i pacchetti), si può usare l'opzione di <c>emerge</c> <e>--fetchonly</e>, la quale scarica tutti i sorgenti necessari.
</p>

<pre caption="Scaricare i sorgenti">
# <i>emerge --fetchonly system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Compilare il sistema</title>
<body>

<p>
Per iniziare a compilare il sistema, eseguire <c>emerge system</c>. Questo processo richiede molto tempo prima di completarsi.
</p>

<pre caption="Compilare il sistema">
# <i>emerge system</i>
</pre>

<p>
Si può tranquillamente ignorare qualsiasi avviso riguardante l'aggiornamento dei file di
configurazione e l'esecuzione di <c>etc-update</c>.
Una volta che il sistema è installato completamente può essere interessante leggere la
documentazione riguardante la <uri
link="?part=2&amp;chap=4#doc_chap1">Protezione dei file di configurazione</uri>.
</p>

<p>
Quando emerge system ha terminato l'esecuzione, continuare con la <uri link="?part=1&amp;chap=7">Configurazione del Kernel</uri>.
</p>

</body>
</subsection>
</section>
</sections>
