<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->


<sections>

<version>1.66</version>
<date>2005-02-25</date>

<section>
<title>Effettuare il chroot</title>
<subsection>
<title>Opzionale: Selezionare i mirror</title>
<body>

<p>
Per scaricare rapidamente i codici sorgenti si raccomanda di selezionare un mirror
rapido. Portage cerca in <path>make.conf</path> la variabile GENTOO_MIRRORS ed
utilizza i mirror in essa elencati. E' possibile visitare la
<uri link="/main/en/mirrors.xml">lista dei mirror</uri> e cercare uno o più
mirror vicini, visto che spesso sono i più rapidi. E' anche possibile utilizzare
uno strumento chiamato <c>mirrorselect</c> che fornisce una comoda
interfaccia per la seleziona dei mirror preferiti.
</p>
  
<pre caption="Utilizzo di mirrorselect per la  variabile GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Non selezionare i mirror IPv6, gli stage non supportano ancora IPv6.
</warn>

<p>
Una seconda impostazione importante è la variabile SYNC di <path>make.conf</path>.
La variabile contiene il server rsync che si desidera utilizzare al momento
di aggiornare l'albero di Portage, ovversossia la collezione di ebuild e script
che contengono tutte le informazioni necessarie a scaricare ed installare il software.
Sebbene sia possibile impostare manualmente un server SYNC, <c>mirrorselect</c>
può farlo automaticamente:
</p>

<pre caption="Selezionare un mirror rsync tramite mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Dopo l'esecuzione di <c>mirrorselect</c> è consigliabile controllare la correttezza
delle impostazioni in <path>/mnt/gentoo/etc/make.conf</path> !
</p>

</body>
</subsection>
<subsection>
<title>Copiare le informazioni del DNS</title>
<body>

<p>
C'è ancora una cosa da fare prima di poter entrare nel nuovo ambiente, si devono copiare le informazioni del DNS in <path>/etc/resolv.conf</path>. Questo passo è necessario per fare in modo che la rete funzioni ancora, anche dopo esser entrati nel nuovo ambiente. <path>/etc/resolv.conf</path> contiene i nameserver per la rete.
</p>

<pre caption="Copiare le informazioni del DNS">
<comment>(L'opzione "-L" serve per assicurarsi di non copiare un link simbolico)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Montare il filesystem proc</title>
<body>

<p>
Montare il filesystem <path>/proc</path> su <path>/mnt/gentoo/proc</path> per permettere all'installazione di usare informazioni fornite dal kernel anche dentro l'ambiente in cui si è effettuato il chroot.
</p>

<pre caption="Montare /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>


</body>
</subsection>
<subsection>
<title>Entrare nel nuovo ambiente</title>
<body>

<p>
Adesso che tutte le partizioni sono pronte e che l'ambiente di base è installato, è arrivato il momento di entrare nel nuovo ambiente di installazione effettuando il <e>chroot</e>. Significa che ci si sposta dall'attuale ambiente di installazione (LiveCD o altre modalità di installazione) al sistema di installazione nel proprio sistema (nelle partizioni create).
</p>

<p>
Il chroot è costituito di tre parti. Nella prima si cambia root, da <path>/</path> (sul supporto di installazione) a <path>/mnt/gentoo</path> (nelle partizioni create), usando <c>chroot</c>. Nella seconda si crea un nuovo ambiente usando <c>env-update</c>, il quale inizializza le variabili di ambiente. Nella terza si caricano queste variabili in memoria, con <c>source</c>.
</p>

<pre caption="Chroot nel nuovo ambiente">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Congratulazioni! Da adesso si è dentro Gentoo Linux. Naturalmente la fine dell'installazione è lontana, poichè mancano ancora alcune sezioni.
</p>

</body>
</subsection>
<subsection>
<title>Aggiornare Portage</title>
<body>

<p>
Si procede ora all'aggiornamento di Portage tramite il comando <c>emerge 
--sync</c>.
</p>

<pre caption="Aggiornare Portage">
# <i>emerge --sync</i>
</pre>

<p>
Se si riceve l'avviso che è disponibile una nuova versione di Portage e che si dovrebbe aggiornarlo, si può tranquillamente ignorare questo avviso. Portage viene aggiornato in seguito, durante l'installazione.
</p>

</body>
</subsection>
<subsection id="configure_USE">
<title>Configurare la variabile USE</title>
<body>

<p>
<c>USE</c> è una delle variabili più potenti che Gentoo fornisce agli utenti. Molti programmi possono essere compilati con o senza il supporto opzionale per certi elementi. Per esempio, alcuni programmi possono essere compilati con il supporto per gtk, o con il supporto per qt. Altri con o senza il supporto per SSL. Alcuni programmi possono essere compilati con il suporto per framebuffer (svgalib), anzichè con quello per X11 (server X).
</p>

<p>
La maggior parte delle distribuzioni compila i propri pacchetti con il più alto supporto possibile, aumentando le dimensioni dei programmi e il tempo di avvio, per non parlare dell'enorme quantità di dipendenze. Con Gentoo si può definire con quali opzioni un pacchetto deve essere compilato. Questa è la funzione di <c>USE</c>.
</p>

<p>
Nella variabile <c>USE</c> si definiscono keywords che sono vengono poi tradotte in opzioni di compilazione. Per esempio, <e>ssl</e> abilita il supporto ssl nei programmi che lo supportano. <e>-X</e> (notare il trattino davanti) rimuove il supporto per il server X. <e>gnome gtk -kde -qt</e> abilita i programmi al supporto gnome (e gtk), ma non a quello kde (e qt), rendendo il sistema ottimizzato per GNOME.
</p>

<p>
Le impostazioni di default di <c>USE</c> sono conservate nel file <path>make.defaults</path> del proprio profilo. I file <path>make.defaults</path> si trovano nella directory a cui punta il collegamento <path>/etc/make.profile</path> e in tutte le directory a pari livello. L'impostazione <c>USE</c> che viene utilizzata di default è la somma di tutte le <c>USE</c> in tutti i file <path>make.defaults</path>. Ciò che viene specificato in <path>/etc/make.conf</path> è considerato rispetto alle impostazioni di default. Se si aggiunge qualcosa alle impostazioni di <c>USE</c>, si aggiunge anche all'elenco di default. Se si rimuove qualcosa dalle impostazioni di <c>USE</c> (mettendo un trattino davanti), si rimuove anche dall'elenco di default (se era nell'elenco). Non si deve cambiare <e>mai</e> nessuna opzione nella directory <path>/etc/make.profile</path>; in quanto essa viene sovrascritta quando si aggiorna Portage.
</p>

<p>
Una descrizione completa di <c>USE</c> si trova nella seconda parte del Manuale Gentoo, <uri link="?part=2&amp;chap=1">Capitolo 1: flag USE</uri>. Una descrizione completa sulle flag USE disponibili si trova in <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Vedere le flag USE disponibili">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(E' possibile muoversi con le frecce ed uscire con 'q')</comment>
</pre>

<p>
Come esempio ecco le impostazioni di <c>USE</c> per un sistema basato su KDE, e con il supporto per DVD, ALSA e masterizzazione CD:
</p>

<pre caption="Si apre /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Impostazioni USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: GLIBC Locale</title>
<body>

<p>
Di solito su un sistema vengono utilizzate le impostazioni per una o due lingue. Al momento
la compilazione di <c>glibc</c> creerebbe un set di lingue completo, ma attivando la USE flag <c>userlocales</c> è possibile specificare solo le località di cui si ha bisogno nel file <path>/etc/locales.build</path>. Il passo è utile solo se si conosce queli impostazioni attivare:
</p>

<pre caption="Attivare la flasg userlocales in glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Specificare ora le lingue che si intende utilizzare:
</p>

<pre caption="Modificare /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Le seguenti impostazioni installano i caratteri per l'Inglese (US) e tedesco
(Germania) con i relativi formati di carattere (come UTF-8).
</p>

<pre caption="Impostaazione del locale">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

</body>
</subsection>
</section>
<section>
<title>Differenze tra stage1, stage2 e stage3</title>
<body>

<p>
Si prendano ora un momento in considerazione i passi precedenti. E' stato chiesto di scegliere tra uno stage tra <e>stage1</e>, <e>stage2</e> e <e>stage3</e>. Ed è stato anche detto che la scelta è importante perchè influisce su ulteriori punti di installazione. Questa è la prima parte in cui lo stage scelto definisce quali sono questi ulteriori punti.
</p>

<ul>
<li>
  Se si è scelto lo <e>stage1</e>, si devono seguire <e>entrambe</e> le parti di questo capitolo (iniziando con le istruzioni su come <uri link="#doc_chap3">Passare dallo stage1 allo stage2</uri>)
</li>
<li>
  Se si è scelto lo <e>stage2</e>, si può saltare la prima parte e iniziare con la seconda (<uri link="#doc_chap4">Passare dallo stage2 allo stage3</uri>)
</li>
<li>
  Se si è scelto lo <e>stage3</e> allora si possono saltare entrambe le parti e continuare con la prossima sezione: <uri link="?part=1&amp;chap=7">Configurazione del Kernel</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Passare dallo stage1 allo stage2</title>
<subsection>
<title>Introduzione al bootstrapping</title>
<body>

<p>
Si è scelto di compilare tutto partendo da zero.
</p>

<p>
In questa parte si esegue il <e>bootstrap</e> di Gentoo. Questo richiede un bel po' di tempo, ma il risultato è un sistema ottimizzato per la propria macchina e per le proprie necessità.
</p>

<p>
Fare il <e>bootstrap</e> significa compilare la GNU C Library, la GNU Compiler Collection e molti altri programmi di sistema.
</p>

<p>
Prima del bootstrap, è possibile scaricare subito tutto il codice sorgente necessario.
Se non si desidera farlo è possibile continuare con il
<uri link="#bootstrap">Bootstrap del sistema</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Opzionale: Scaricare subito i sorgenti</title>
<body>

<p>
Se non si è copiato prima tutto il codice sorgente, lo script di bootstrap provvede al download di tutti i file necessari. Per farlo è necessaria una connessione a internet. Se si vuole prima scaricare il codice sorgente e dopo fare il bootstrap del sistema (per esempio, se non si vuole avere aperta una connessione a internet durante la compilazione), utilizzare l'opzione <e>-f</e> dello script di bootstrap, che provvede a scariocare tutto il codice sorgente.
</p>

<pre caption="Scaricare il sorgente necessario">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Fare il bootstrap del sistema</title>
<body>

<p>
Inserire il prossimo comando per iniziare il bootstrap. Questa fase richiede molto tempo prima che sia conclusa.
</p>

<pre caption="Fare il bootstrap del sistema">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Se si è impostata la flag USE <c>nptl</c> eseguire nuovamente <c>bootstrap.sh</c>
potrebbe dare un errore per cui <c>linux-headers</c> blocca <c>linux26-headers</c>.
Se si riceve questo errore, rimuovere <c>linux-headers</c> e provare nuovamente:
</p>

<pre caption="Rimuovere linux-headers dal sistema">
# <i>emerge -C linux-headers</i>
# <i>emerge --oneshot --nodeps linux26-headers</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Continuare con il prossimo punto su come <uri link="#doc_chap4">Passare dallo stage2 allo stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Passare dallo stage2 allo stage3</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Se si sta leggendo questa sezione, si ha un sistema con il bootstrap già fatto (o è stato fatto precedentemente, o si sta usando lo <e>stage2</e>). Adesso si devono compilare tutti i pacchetti del sistema.
</p>

<p>
Non proprio <e>tutti</e> in realtà, si compilano solo i pacchetti del sistema dei quali non si può fare a meno. Alcuni pacchetti del sistema hanno molte alternative (come i logger di sistema), e poichè Gentoo si basa sulle scelte, non si vuole costringere nessuno ad utilizzare una scelta piuttosto di un'altra.</p>

</body>
</subsection>
<subsection>
<title>Opzionale: Vedere cosa si sta per fare</title>
<body>

<p>
Se si vuole sapere quali pacchetti stanno per essere installati, eseguire <c>emerge --pretend system</c>. Si ottiene una lista di tutti i pacchetti che si stanno per installare. Questa lista è molto lunga e si dovrebbe usare un pager come <c>less</c> o <c>more</c> per andare su o giù per lista.
</p>

<pre caption="Vedere l'effetto 'emerge system'">
# <i>emerge --pretend system | less</i>
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: Scaricare i sorgenti</title>
<body>

<p>
Se si vuole usare <c>emerge</c> per scaricare i sorgenti prima di continuare (per esempio non si vuole avere aperta una connessione a internet mentre si stanno compilando tutti i pacchetti), si può usare l'opzione di <c>emerge</c> <e>--fetchonly</e>, la quale scarica tutti i sorgenti necessari.
</p>

<pre caption="Scaricare i sorgenti">
# <i>emerge --fetchonly system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Compilare il sistema</title>
<body>

<p>
Per iniziare a compilare il sistema, eseguire <c>emerge system</c>. Questo processo richiede molto tempo prima di completarsi.
</p>

<pre caption="Compilare il sistema">
# <i>emerge --emptytree system</i>
</pre>

<p>
Si può tranquillamente ignorare qualsiasi avviso riguardante l'aggiornamento dei file di
configurazione e l'esecuzione di <c>etc-update</c>.
Una volta che il sistema è installato completamente può essere interessante leggere la
documentazione riguardante la <uri
link="?part=3&amp;chap=2#doc_chap3">Protezione dei file di configurazione</uri>.
</p>

<p>
Quando emerge system ha terminato l'esecuzione, continuare con la <uri link="?part=1&amp;chap=7">Configurazione del Kernel</uri>.
</p>

</body>
</subsection>
</section>
</sections>
