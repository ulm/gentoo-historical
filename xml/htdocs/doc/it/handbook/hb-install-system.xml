<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/hb-install-system.xml,v 1.17 2006/03/12 22:07:20 mascherpa Exp $ -->

<sections>

<version>2.19</version>
<date>2006-03-06</date>

<section>
<title>Effettuare il chroot</title>
<subsection>
<title>Opzionale: Selezionare i mirror</title>
<body>

<p>
Per scaricare rapidamente i codici sorgenti si raccomanda di selezionare un
mirror
rapido. Portage cerca in <path>make.conf</path> la variabile GENTOO_MIRRORS ed
utilizza i mirror in essa elencati. E' possibile visitare la
<uri link="/main/en/mirrors.xml">lista dei mirror</uri> e cercare uno o più
mirror vicini, visto che spesso sono i più rapidi. E' anche possibile utilizzare
uno strumento chiamato <c>mirrorselect</c> che fornisce una comoda
interfaccia per la seleziona dei mirror preferiti.
</p>
  
<pre caption="Utilizzo di mirrorselect per la  variabile GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Non selezionare i mirror IPv6, gli stage non supportano ancora IPv6.
</warn>

<p>
Una seconda impostazione importante è la variabile SYNC di
<path>make.conf</path>.
La variabile contiene il server rsync che si desidera utilizzare al momento
di aggiornare l'albero di Portage, ovversossia la collezione di ebuild e script
che contengono tutte le informazioni necessarie a scaricare ed installare il
software.
Sebbene sia possibile impostare manualmente un server SYNC, <c>mirrorselect</c>
può farlo automaticamente:
</p>

<pre caption="Selezionare un mirror rsync tramite mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Dopo l'esecuzione di <c>mirrorselect</c> è consigliabile controllare la
correttezza
delle impostazioni in <path>/mnt/gentoo/etc/make.conf</path> !
</p>

</body>
</subsection>
<subsection>
<title>Copiare le informazioni del DNS</title>
<body>

<p>
C'è ancora una cosa da fare prima di poter entrare nel nuovo ambiente, si devono
copiare le informazioni del DNS in <path>/etc/resolv.conf</path>. Questo passo è
necessario per fare in modo che la rete funzioni ancora, anche dopo esser
entrati nel nuovo ambiente. <path>/etc/resolv.conf</path> contiene i nameserver
per la rete.
</p>

<pre caption="Copiare le informazioni del DNS">
<comment>(L'opzione "-L" serve per assicurarsi di non copiare un link simbolico)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Montare i filesystem /proc e /dev</title>
<body>

<p>
Montare il filesystem <path>/proc</path> su <path>/mnt/gentoo/proc</path> per
permettere all'installazione di usare informazioni fornite dal kernel anche
dentro l'ambiente in cui si è effettuato il chroot; montare poi tramite bind il
filesystem <path>/dev</path>.
</p>

<pre caption="Montare /proc e /dev">
# <i>mount -t proc none /mnt/gentoo/proc</i>
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>


</body>
</subsection>
<subsection>
<title>Entrare nel nuovo ambiente</title>
<body>

<p>
Adesso che tutte le partizioni sono pronte e che l'ambiente di base è
installato, è arrivato il momento di entrare nel nuovo ambiente di installazione
effettuando il <e>chroot</e>. Significa che ci si sposta dall'attuale ambiente
di installazione (CD di Installazione o altre modalità di installazione) al
sistema di installazione nel proprio sistema (nelle partizioni create).
</p>

<p>
Il chroot è costituito di tre parti. Nella prima si cambia root, da
<path>/</path> (sul supporto di installazione) a <path>/mnt/gentoo</path> (nelle
partizioni create), usando <c>chroot</c>. Nella seconda si crea un nuovo
ambiente usando <c>env-update</c>, il quale inizializza le variabili di
ambiente. Nella terza si caricano queste variabili in memoria, con
<c>source</c>.
</p>

<pre caption="Chroot nel nuovo ambiente">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
>> Regenerating /etc/ld.so.cache...
# <i>source /etc/profile</i>
# <i>export PS1="(chroot) $PS1"</i>
</pre>

<p>
Congratulazioni! Da adesso si è dentro Gentoo Linux. Naturalmente la fine
dell'installazione è lontana, poichè mancano ancora alcune sezioni.
</p>

</body>
</subsection>
</section>

<section>
<title>Configurazione di Portage</title>
<subsection>
<title>Aggiornare Portage</title>
<body>

<p>
Si procede ora all'aggiornamento di Portage tramite il comando <c>emerge 
--sync</c>.
</p>

<pre caption="Aggiornare Portage">
# <i>emerge --sync</i>
<comment>(Se si sta usando un terminale lento come alcuni in framebuffer o
la console seriale si può utilizzare l'opzione --quiet per ridurre l'output)</comment>
# <i>emerge --sync --quiet</i>
</pre>

<p>
Se si è dietro ad un firewall che blocca il traffico rsync è possibile usare
<c>emerge-webrsync</c> che scarica ed installa una immagine completa di Portage.
</p>

<p>
Se si riceve l'avviso che è disponibile una nuova versione di Portage e che si
dovrebbe aggiornarlo, si può tranquillamente ignorare questo avviso. Portage
viene aggiornato in seguito, durante l'installazione.
</p>

</body>
</subsection>
<subsection>
<title>Scelta del profilo adatto</title>
<body>

<p>
Innanzitutto qualche definizione.
</p>

<p>
Il profilo è una parte integrante di ciascun sistema Gentoo. Non solo specifica
i valori
di default per CHOST, CFLAGS ed altre impostanti variabili, ma posiziona il
sistema
all'interno di un certo intervallo di versioni di pacchetti. Il profilo viene
mantenuto dagli sviluppatori Gentoo.
</p>

<p>
In precedenza il profilo non doveva essere modificato dall'utente. Tuttavia
adesso
gli utenti x86, hppa e alpha possono scegliere tra due profili, uno per il
kernel
24, e uno per il kernel 2.6. Questa richiesta è stata imposta per aumentare
l'integrazione del kernel 2.6.
Le architetture ppc e ppc64 hanno anch'esse diversi profili disponibili che
verranno trattati in seguito.
</p>

<p>
E' possibile visualizzare l'attuale profilo in uso con il seguente comando:
</p>

<pre caption="Visualizzare il profilo del sistema">
# <i>ls -FGg /etc/make.profile</i>
lrwxrwxrwx  1 48 Apr  8 18:51 /etc/make.profile -> ../usr/portage/profiles/default-linux/x86/2006.0/
</pre>

<p>
Se si sta utilizzando una delle piattaforma citate il profilo di default
implementa un sistema basato su kernel 2.6. Questa è l'impostazione
raccomandata, ma
è anche possibile modificare il profilo.
</p>

<p>
Alcuni utenti potrebbero voler installare uun sistema basato sul vecchio profilo
di Linux 2.4. Se c'è una buona ragione per farlo è possibile controllare
l'esistenza di un profilo adatto. Su una macchina x86 è possibile farlo con
il seguente comando:
</p>

<pre caption="Trovare un profilo alternativo">
# <i>ls -d /usr/portage/profiles/default-linux/x86/no-nptl/2.4</i>
/usr/portage/profiles/default-linux/x86/no-nptl/2.4
</pre>

<p>
L'esempio evidenziato mostra l'esistenza di un profilo alternativo per Linux
2.4, cioè
non sono stati mostrati errori di file o directory mancanti. Si raccomanda di
utilizzare
il profilo di default, ma per cambiaro è possibile seguirer questa procedura:
</p>

<pre caption="Passare al profilo 2.4">
<comment>(Assicurarsi di utilizzare la architettura corretta, l'esempio si riferisce a x86)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/x86/no-nptl/2.4 /etc/make.profile</i>
<comment>(Elenca i file nel profilo 2.4)</comment>
# <i>ls -FGg /etc/make.profile/</i>
total 12
-rw-r--r--  1 939 Dec 10 14:06 packages
-rw-r--r--  1 347 Dec  3  2004 parent
-rw-r--r--  1 573 Dec  3  2004 virtuals
</pre>

<p>
Esistono diversi profili per ppc forniti direttamente con 2006.0.
</p>

<pre caption="Profili PPC">
<comment>(Profilo PPC generico per tutte le macchine, minimale)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0 /etc/make.profile</i>
<comment>(Profilo G3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G3 /etc/make.profile</i>
<comment>(Profilo G3 Pegasos)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G3/Pegasos/ /etc/make.profile</i>
<comment>(Profilo G4 Altivec)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G4 /etc/make.profile</i>
<comment>(Profilo G4 Pegasos Altivec)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G4/Pegasos/ /etc/make.profile</i>
</pre>

<p>
Esistono diversi profili per ppc64 forniti direttamente con 2006.0.
</p>

<pre caption="Profili PPC64">
<comment>(Profilo PPC generico a 64 bit per tutte le macchine PPC64)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/64bit-userland /etc/make.profile</i>
<comment>(Profilo PPC generico a 32 bit per tutte le macchine PPC64)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/32bit-userland /etc/make.profile</i>
<comment>(Ogni tipo di ambiente ha sottoprofili, sostituire (userland) con al propria scelta</comment>
<comment>(profilo 970 per JS20)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/970 /etc/make.profile</i>
<comment>(profilo G5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/970/pmac /etc/make.profile</i>
<comment>(profilo POWER3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power3 /etc/make.profile</i>
<comment>(profilo POWER4)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power4 /etc/make.profile</i>
<comment>(profilo POWER5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power5 /etc/make.profile</i>
<comment>(Il profilo multilib non è ancora stabile al momento dell'uscita di questa release.)</comment>
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Configurare la variabile USE</title>
<body>

<p>
<c>USE</c> è una delle variabili più potenti che Gentoo fornisce agli utenti.
Molti programmi possono essere compilati con o senza il supporto opzionale per
certi elementi. Per esempio, alcuni programmi possono essere compilati con il
supporto per gtk, o con il supporto per qt. Altri con o senza il supporto per
SSL. Alcuni programmi possono essere compilati con il suporto per framebuffer
(svgalib), anzichè con quello per X11 (server X).
</p>

<p>
La maggior parte delle distribuzioni compila i propri pacchetti con il più alto
supporto possibile, aumentando le dimensioni dei programmi e il tempo di avvio,
per non parlare dell'enorme quantità di dipendenze. Con Gentoo si può definire
con quali opzioni un pacchetto deve essere compilato. Questa è la funzione di
<c>USE</c>.
</p>

<p>
Nella variabile <c>USE</c> si definiscono keywords che sono vengono poi tradotte
in opzioni di compilazione. Per esempio, <e>ssl</e> abilita il supporto ssl nei
programmi che lo supportano. <e>-X</e> (notare il trattino davanti) rimuove il
supporto per il server X. <e>gnome gtk -kde -qt</e> abilita i programmi al
supporto gnome (e gtk), ma non a quello kde (e qt), rendendo il sistema
ottimizzato per GNOME.
</p>

<p>
Le impostazioni di default di <c>USE</c> sono conservate nel file
<path>make.defaults</path> del proprio profilo. I file
<path>make.defaults</path> si trovano nella directory a cui punta il
collegamento <path>/etc/make.profile</path> e in tutte le directory a pari
livello. L'impostazione <c>USE</c> che viene utilizzata di default è la somma di
tutte le <c>USE</c> in tutti i file <path>make.defaults</path>. Ciò che viene
specificato in <path>/etc/make.conf</path> è considerato rispetto alle
impostazioni di default. Se si aggiunge qualcosa alle impostazioni di
<c>USE</c>, si aggiunge anche all'elenco di default. Se si rimuove qualcosa
dalle impostazioni di <c>USE</c> (mettendo un trattino davanti), si rimuove
anche dall'elenco di default (se era nell'elenco). Non si deve cambiare
<e>mai</e> nessuna opzione nella directory <path>/etc/make.profile</path>; in
quanto essa viene sovrascritta quando si aggiorna Portage.
</p>

<p>
Una descrizione completa di <c>USE</c> si trova nella seconda parte del Manuale
Gentoo, <uri link="?part=2&amp;chap=1">Capitolo 1: flag USE</uri>. Una
descrizione completa sulle flag USE disponibili si trova in
<path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Vedere le flag USE disponibili">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(E' possibile muoversi con le frecce ed uscire con 'q')</comment>
</pre>

<p>
Come esempio ecco le impostazioni di <c>USE</c> per un sistema basato su KDE, e
con il supporto per DVD, ALSA e masterizzazione CD:
</p>

<pre caption="Si apre /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Impostazioni USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Opzionale: GLIBC Locale</title>
<body>

<p>
Di solito su un sistema vengono utilizzate le impostazioni per una o due lingue.
Al momento
la compilazione di <c>glibc</c> creerebbe un set di lingue completo, ma
attivando la USE flag <c>userlocales</c> è possibile specificare solo le
località di cui si ha bisogno nel file <path>/etc/locales.build</path>. Il passo
è utile solo se si conosce queli impostazioni attivare.
</p>

<pre caption="Attivare la flasg userlocales in glibc">
# <i>mkdir -p /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Specificare ora le lingue che si intende utilizzare:
</p>

<pre caption="Modificare /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Le seguenti impostazioni installano i caratteri per l'Inglese (US) e tedesco
(Germania) con i relativi formati di carattere (come UTF-8).
</p>

<pre caption="Impostaazione del locale">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

<p>
Continuare ora con la <uri link="?part=1&amp;chap=7">Configurazione del
Kernel</uri>.
</p>

</body>
</subsection>
</section>
</sections>
