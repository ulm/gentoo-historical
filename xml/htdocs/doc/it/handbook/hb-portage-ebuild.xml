<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/Attic/hb-portage-ebuild.xml,v 1.1 2004/11/22 21:18:34 mush Exp $ -->

<sections>

<version>1.3</version>
<date>24 Ottobre 2004</date>

<section>
<title>Emerge e ebuild</title>
<body>

<p>
L'applicazione  <c>ebuild</c> è un'interfaccia a basso livello per il sistema
Portage. Usando questa applicazione si possono eseguire specifiche azioni
con dati ebuild. Per esempio, si possono eseguire i singoli passi di un'installazione.
</p>

<p>
L'uso di  <c>ebuild</c> è a scopo di sviluppo; per maggiori informazioni
su <c>ebuild</c> si rimanda il lettore al
<uri link="/proj/en/devrel/handbook/handbook.xml">Developers Handbook</uri>.
Verranno comunque esaminate le istanze di ebuild che vengono invocate 
dal Portage durante il processo di installazione di un certo titolo software,
e come invocare certi passi di post installazione che alcuni ebuild permettono
di eseguire.
</p>

</body>
</section>
<section>
<title>Installazione manuale del software</title>
<subsection>
<title>Scaricare i sorgenti e controllo del checksum</title>
<body>

<p>
Ogni volta che si usa <c>ebuild</c> con un dato file ebuild, viene verificato
il checksum di tutti i file coinvolti affinché sia uguale a quello
dato nel file <path>Manifest</path> o 
<path>files/digest-&lt;name&gt;-&lt;version&gt;</path>. 
Questo succede dopo che i sorgenti sono stati scaricati.
</p>

<p>
Per scaricare i sorgenti usando <c>ebuild</c> eseguire:
</p>

<pre caption="Scaricare i sorgenti">
# <i>ebuild path/to/ebuild fetch</i>
</pre>

<p>
Se l'md5sum dell'ebuild non corrisponde con uno listato nel file
<path>Manifest</path>, o uno dei sorgenti scaricati non corrisponde
a quelli listati nei file  <path>files/digest-&lt;package&gt;</path>, 
si riceverà un errore simile al seguente:
</p>

<pre caption="Ebuild checksum fallito">
!!! File is corrupt or incomplete. (Digests do not match)
>>> our recorded digest: db20421ce35e8e54346e3ef19e60e4ee
>>>  your file's digest: f10392b7c0b2bbc463ad09642606a7d6
</pre>

<p>
Segue una riga che menziona il file coinvolto.
</p>

<p>
Se si è certi che il sorgente scaricato e l'ebuild stesso sono
validi, si può rigenerare il <path>Manifest</path> e il file
<path>digest-&lt;package&gt;</path> usando la funzionalità
digest di <c>ebuild</c>:
</p>

<pre caption="Regenerare Manifest e il digest">
# <i>ebuild path/to/ebuild digest</i>
</pre>

</body>
</subsection>
<subsection>
<title>Estrarre i sorgenti</title>
<body>

<p>
Per estrarre i sorgenti in <path>/var/tmp/portage</path> (o in un'altra directory specificata in <path>/etc/make.conf</path>), eseguire la funzionalità unpack di <c>ebuild</c>:
</p>

<pre caption="Estrarre i sorgenti">
# <i>ebuild path/to/ebuild unpack</i>
</pre>

<p>
Il precedente comando esegue la funzione src_unpack() dell'ebuild (che è anche 
la funzione predefinita se nell'ebuild non è definita nessuna funzione src_unpack()), è ancora in questo passaggio che vengono applicate le patch necessarie.
</p>

</body>
</subsection>
<subsection>
<title>Compilare i sorgenti</title>
<body>

<p>
Il passo che segue nel processo di installazione è la compilazione dei sorgenti.
La funzionalità compile di <c>ebuild</c> si prende in carico di eseguire
la funzione src_compile() dell'ebuild. Questo passo include anche la configurazione attraverso l'esecuzione del comando configure.
</p>

<pre caption="Compilare i sorgenti">
# <i>ebuild path/to/ebuild compile</i>
</pre>

<p>
Si consiglia di editare la funzione src_compile() dell'ebuild se si vogliono
modificare le istruzioni di compilazione. Si può anche far credere al Portage
che l'applicazione <c>ebuild</c> abbia terminato la compilazione eseguendo manualmente tutti i comandi necessari e creando un file vuoto chiamato <path>.compiled</path>
nella directory di lavoro:
</p>

<pre caption="Informare Portage dell'avvenuta compilazione">
# <i>touch .compiled</i>
</pre>

</body>
</subsection>
<subsection>
<title>Installare i file in un'ubicazione temporanea</title>
<body>

<p>
Il passo successivo prevede l'installazione di tutti i file necessari in una locazione
temporanea. Questa directory contiene tutti i file che saranno installati
nel filesystem. Si può ultimare questo passaggio eseguendo la funzionalità 
install di <c>ebuild</c> che esegue la funzione src_install() dell'ebuild:
</p>

<pre caption="Installare i file">
# <i>ebuild path/to/ebuild install</i>
</pre>

</body>
</subsection>
<subsection>
<title>Installare i file nel filesystem</title>
<body>

<p>
Il passo finale è l'installazione di tutti i file nel filesystem reale e 
registrarli nel Portage backend. <c>ebuild</c> chiama questo passo "qmerge"
e coinvolge i seguenti passaggi:
</p>

<ul>
  <li>Eseguire la funzione pkg_preinst() se specificata</li>
  <li>Copiare tutti i file nel filesystem reale</li>
  <li>Registrare i file nel Portage backend</li>
  <li>Eseguire la funzione pkg_postinst() se specificata</li>
</ul>

<p>
L'esecuzione della funzionalità qmerge di <c>ebuild</c> coinvolge i 
seguenti passi:
</p>

<pre caption="Installazione di tutti i file nel filesystem">
# <i>ebuild path/to/ebuild qmerge</i>
</pre>

</body>
</subsection>
<subsection>
<title>Ripulire la directory temporanea</title>
<body>

<p>
Al termine, si può ripulire la directory temporanea usando la funzionalità clean
di <c>ebuild</c>:
</p>

<pre caption="Ripulire la directory temporanea">
# <i>ebuild path/to/ebuild clean</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Caratteristiche aggiuntive di ebuild</title>
<subsection>
<title>Eseguire tutti i comandi dell'installazione</title>
<body>

<p>
Usando la funzionalità merge di <c>ebuild</c> si possono eseguire i comandi
fetch, unpack, compile. install e qmerge in una colpo solo:
</p>

<pre caption="Installare del software">
# <i>ebuild path/to/ebuild merge</i>
</pre>

</body>
</subsection>
<subsection>
<title>Eseguire delle configurazioni</title>
<body>

<p>
Alcune applicazioni includono istruzioni che permettono delle configurazioni
aggiuntive di un pacchetto. Queste istruzioni possono essere interattive e perciò
non possono essere eseguite automaticamente. Per eseguire queste configurazioni,
che sono ottenute dalla funzione opzionale dell'ebuild config(), usare
la funzionalità config di <c>ebuild</c>:
</p>

<pre caption="Configurare un pacchetto">
# <i>ebuild path/to/ebuild config</i>
</pre>

</body>
</subsection>
<subsection>
<title>Costruire un pacchetto RPM</title>
<body>

<p>
Si può istruire il Portage a creare pacchetti binari di un ebuild o anche
di un file RPM. Per creare questi archivi si usano le funzionalità package o rpm di <c>ebuild</c>. Ci sono piccole differenze tra queste funzionalità:
</p>

<ul>
  <li>
    La funzionalità package è come la funzionalità merge, eseguendo tutti
i passi necessari  (fetch, unpack, compile, install) prima della creazione
del pacchetto.
  </li>
  <li>
    La funzionalità rpm costruisce un pacchetto RPM dai file creati
<e>dopo</e> aver eseguito la funzionalità install di <c>ebuild</c>.
  </li>
</ul>

<pre caption="Creare pacchetti">
<comment>(Per un pacchetto binario compatibile Portage)</comment>
# <i>ebuild path/to/ebuild package</i>

<comment>(Per un pacchetto RPM)</comment>
# <i>ebuild path/to/ebuild rpm</i>
</pre>

<p>
Il file RPM comunque non contiene le informazioni delle dipendenze.
</p>

</body>
</subsection>
</section>
<section>
<title>Maggiori informazioni</title>
<subsection>
<body>

<p>
Consultare le seguenti pagine di manuale per maggiori informazioni sul Portage,
l'applicazione ebuild e i file ebuild:
</p>

<pre caption="Pagine di manuale">
$ <i>man portage</i>    <comment>(Portage)</comment>
$ <i>man emerge</i>     <comment>(Il comando emerge )</comment>
$ <i>man ebuild</i>     <comment>(Il comando ebuild )</comment>
$ <i>man 5 ebuild</i>   <comment>(La sintassi dei file ebuild)</comment>
</pre>

<p>
Si possono trovare maggiori informazioni sullo sviluppo nel
<uri link="/proj/en/devrel/handbook/handbook.xml">Developers Handbook</uri>.
</p>

</body>
</subsection>
</section>
</sections>
