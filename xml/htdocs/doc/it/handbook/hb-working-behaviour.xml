<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->


<sections>
<section>
<title>Protezione dei file di configurazione</title>
<subsection>
<title>Protezione</title>
<body>

<p>
Portage riconosce il concetto di "file protetti". Ciò significa che quando si aggiorna il software, alcuni file non saranno sovrascritti con le versioni più nuove, ma si viene informati dell'esistenza di versioni più aggiornate. Questo è molto utile per i file di configurazione (i file che sono in <path>/etc</path>).
</p>

<p>
Invece di sovrascrivere i file, si crea un nuovo file chiamato <path>._cfg0000_&lt;nome&gt;</path>, se <path>&lt;nome&gt;</path> è il nome del file originale. Spetta all'utente unire le differenze tra il nuovo file e il file già presente. Per facilitare questo procedimento, si può usare il comando <c>etc-update</c>di cui si tratta in seguito.
</p>

</body>
</subsection>
<subsection>
<title>Dichiarare CONFIG_PROTECT</title>
<body>

<p>
Portage non può proteggere un singolo file. Può invece proteggere intere directory. La variabile <c>CONFIG_PROTECT</c> elenca tutte le directory protette. Sono protette anche tutte le sottodirectory delle directory elencate. La variabile <c>CONFIG_PROTECT</c> è definita in <path>/etc/make.globals</path>, ma se si desidera cambiarla, si dovrebbe dichiararla in <path>/etc/make.conf</path> (per mantenere 
centralizzare la configurazione, si usa <path>/etc/make.conf</path> per tutta la configurazione di Portage).
</p>

<pre caption="Un esempio di impostazione di CONFIG_PROTECT">
CONFIG_PROTECT="/etc /usr/share/config /usr/kde/3.1/share/config"
</pre>

<p>
Se si desidera proteggere una directory, ma non tutte le sue sottodirectory, si possono rendere queste ultime non protette elencandole nella variabile <c>CONFIG_PROTECT_MASK</c>, che ha anche un valore di default dichiarato in <path>/etc/make.globals</path>, ma che può essere cambiato, dichiarandolo in <path>/etc/make.conf</path>:
</p>

<pre caption="Un esempio di setting di CONFIG_PROTECT_MASK">
CONFIG_PROTECT_MASK="/etc/init.d"
</pre>

<p>
Ulteriori informazioni sulla protezione dei file di configurazione, possono essere trovate nell'aiuto online di <c>emerge</c>:
</p>

<pre caption="Informazioni sulla protezione dei file di configurazione">
# <i>emerge --help config</i>
</pre>

</body>
</subsection>
<subsection>
<title>etc-update</title>
<body>

<p>
<c>etc-update</c> è un tool che aiuta ad integrare i file <path>._cfg0000_&lt;name&gt;</path>. Fornisce un procedimento di integrazione interattivo e può anche integrare automaticemente i cambiamenti non importanti.
</p>

<p>
Eseguire <c>etc-update</c> è molto facile:
</p>

<pre caption="Eseguire etc-update">
# <i>etc-update</i>
</pre>

<p>
Dopo aver effettuato l'integrazione dei cambiamenti banali, viene elencata una lista di file protetti che sono in attesa di aggiornamento. Infine si presantano le possibili opzioni:
</p>

<pre caption="Opzioni di etc-update">
Please select a file to edit by entering the corresponding number.
              (-1 to exit) (-3 to auto merge all remaining files)
                           (-5 to auto-merge AND not use 'mv -i'):
</pre>

<p>
Se si preme <c>-1</c>, <c>etc-update</c> si chiude senza aver effettuato nessun cambiamento. Se si preme <c>-3</c> o <c>-5</c>, <e>tutti</e> i file di configurazione elencati vengono sovrascritti con le versioni più nuove. Quindi è molto importante selezionare prima i file di configurazione che non dovrebbero essere aggiornati automaticamente. Per selezionare i file, si deve premere il numero alla sinistra del file di configurazione.
</p>

<p>
Come esempio si seleziona il file di configurazione <path>/etc/pear.conf</path>:
</p>

<pre caption="Aggiornare uno specifico file di configurazione">
Beginning of differences between /etc/pear.conf and /etc/._cfg0000_pear.conf
<comment>[...]</comment>
End of differences between /etc/pear.conf and /etc/._cfg0000_pear.conf
1) Replace original with update
2) Delete update, keeping original as is
3) Interactively merge original with update
4) Show differences again
</pre>

<p>
Ora si possono vedere le differenze tra i due file. Se si pensa che il file di configurazione aggiornato possa essere usato senza problemi, premere <c>1</c>. Se si pensa che non è necessario aggiornare il file di configurazione, o che non siano fornite informazioni nuove o utili, premere <c>2</c>. Se si desidera aggiornare interattivamente l'attuale file di configurazione, premere <c>3</c>.
</p>

<p>
In questo contesto non è utile approfondire l'integrazione interattivo. Per completezza, si elencano i comandi che si possono usare. Venono presentate due righe (quella originale e quella nuova) e un prompt in cui si può inserire uno dei seguenti comandi:
</p>

<pre caption="Comandi disponibili per il merging interattivo">
ed:     Modifica e utilizzo di entrambe le versioni, ciascuna con un header
eb:     Modifica e utilizzo di entrambe le versioni
el:     Modifica e utilizzo della versione a sinistra
er:     Modifica e utilizzo della versione a destra
e:      Creazione di una nuova versione
l:      Utilizzo della versione di sinistra
r:      Utilizzo della versione di destra
s:      Inclusione automatica delle linee comuni
v:      Inclusione esplicita delle linee comuni
q:      Uscita.
</pre>

<p>
Dopo aver finito di aggiornare i file di configurazione importanti, si può aggiornare automaticamente tutti gli altri file di configurazione. <c>etc-update</c> si chiude quando non trova nessun altro file di configurazione da aggiornare.
</p>

</body>
</subsection>
</section>
<section>
<title>Opzioni di rete</title>
<subsection>
<title>Mirror</title>
<body>

<p>
Dato che Gentoo sta diventando sempre più popolare, è notevolmente apprezzato l'uso dei mirror. Portage usa tre variabili per i mirror: la prima per i mirror rsync (i quali sono usati per sincronizzare il Portage Tree), la seconda per il mirror distfile (il quale è usato per scaricare il codice sorgente), la terza per i mirror di pacchetti precompilati.
</p>

<p>
Tutti i possibili mirror distfile sono elencati nella <uri link="/main/en/mirrors.xml">Pagina dei mirror Gentoo</uri>. Inoltre si può usare <c>mirrorselect</c> per semplificare l'impostazione dei mirror nel sistema.
</p>

<p>
La variabile <c>SYNC</c> contiene una lista di mirror rsync che si desidera usare. Per esempio, per usare come prima scelta <uri>rsync://rsync.namerica.gentoo.org/gentoo-portage</uri>, e come seconda <uri>rsync://rsync.samerica.gentoo.org/gentoo-portage</uri>, si dovrebbe definirli così in <path>/etc/make.conf</path>:
</p>

<pre caption="Definire SYNC in /etc/make.conf">
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage
      rsync://rsync.samerica.gentoo.org/gentoo-portage"
</pre>

<p>
La variabile <c>GENTOO_MIRRORS</c> contiene una lista di mirror distfiles che si desidera usare. Per esempio, per usare come prima scelta <uri>ftp://ibiblio.org/pub/Linux/distributions/gentoo</uri>, e come seconda <uri>http://www.gtlib.cc.gatech.edu/pub/gentoo</uri>, si dovrebbe definirli così in <path>/etc/make.conf</path>:
</p>

<pre caption="Definire GENTOO_MIRRORS in /etc/make.conf">
GENTOO_MIRRORS="ftp://ibiblio.org/pub/Linux/distributions/gentoo
                http://www.gtlib.cc.gatech.edu/pub/gentoo"
</pre>

<p>
La variabile <c>PORTAGE_BINHOST</c> contiene una lista di mirror di pacchetti precompilati che si desidera usare. Per esempio, per usare <uri>ftp://login:pass@grp.mirror.site/pub/grp/i686/athlon-xp</uri>, si dovrebbe definirlo così in <path>/etc/make.conf</path>:
</p>

<pre caption="Definire PORTAGE_BINHOST in /etc/make.conf">
PORTAGE_BINHOST="ftp://login:pass@grp.mirror.site/pub/grp/i686/athlon-xp"
</pre>

</body>
</subsection>
<subsection>
<title>Mirrorselect</title>
<body>

<p>
Se si desidera usare <c>mirrorselect</c>, prima si deve installarlo (se non lo si è già fatto).
</p>

<pre caption="Installare mirrorselect">
# <i>emerge mirrorselect</i>
</pre>

<p>
Si può scegliere se <c>mirrorselect</c> seleziona automaticamente il miglior mirror, o se la selezione avviene manualmente da una lista. Per ulteriori informazioni su <c>mirrorselect</c>, eseguire <c>mirrorselect</c> dalla riga di comando - viene fornita una rapida descrizione di <c>mirrorselect</c>.
</p>

<pre caption="Eseguire mirrorselect">
# <i>mirrorselect</i>
</pre>

</body>
</subsection>
<subsection>
<title>Download dei pacchetti</title>
<body>

<p>
Il programma con il quale Portage scarica i file di archivio può essere specificato dall'impostazione delle variabili <c>FETCHCOMMAND</c> e <c>RESUMECOMMAND</c>. Ci sono molti esempi in <path>/etc/make.conf</path> e <path>/etc/make.globals</path>. Portage usa di default <c>wget</c>:
</p>

<pre caption="Default FETCHCOMMAND &amp; RESUMECOMMAND">
FETCHCOMMAND="/usr/bin/wget -t 5 --passive-ftp -P \${DISTDIR} \${URI}"
RESUMECOMMAND="/usr/bin/wget -c -t 5 --passive-ftp -P \${DISTDIR} \${URI}"
</pre>

<p>
La variabile <c>${DISTDIR}</c> indica la posizione in cui sono salvati i file scaricati (<path>/usr/portage/distfiles</path>), mentre la variabile <c>${URI}</c> indica il file che Portage deve scaricare.
</p>

<p>
Dato che Portage usa di default <c>wget</c>, si può configurarlo per usare i proxy, definendo le variabili di ambiente <c>http_proxy</c> e <c>ftp_proxy</c>. Si può anche farlo in <path>/etc/make.conf</path>, ma è consigliabile usare un approccio più generale, poichè le variabili <c>http_proxy</c> e <c>ftp_proxy</c> sono usate anche da altri tool (<path>/etc/make.conf</path> è usato soltanto da Portage). Si legga il capitolo sulle <uri link="?part=2&amp;chap=6">Variabili di ambiente</uri>, per come dichiarare le variabili di ambiente di tutto il sistema.
</p>

</body>
</subsection>
<subsection>
<title>Configurare rsync</title>
<body>

<p>
<c>rsync</c> è usato da <c>emerge sync</c> per aggiornare il Portage tree. Le tre variabili usate da Portage per controllare il comportamento di <c>rsync</c> sono <c>RSYNC_EXCLUDEFROM</c>, <c>RSYNC_RETRIES</c> e <c>RSYNC_TIMEOUT</c>.
</p>

<p>
Un modo di "proteggere" le ebuilds dal venire aggiornati o rimossi da <c>emerge sync</c> è quello di usare la variabile <c>RSYNC_EXCLUDEFROM</c>. La variabile è impostata con il nome di un file usato da <c>rsync</c> per escludere alcuni file, di default è <path>/etc/portage/rsync_excludes</path>. <e>Non</e> è consigliabile usare questo metodo poichè , se non si è attenti, può rompere le dipendenze. Si tratta più avanti di <c>PORTDIR_OVERLAY</c> che è il metodo raccomandato. Per ulteriori informazioni si legga la manpage di <c>rsync</c>.
</p>

<pre caption="La variabile RSYNC_EXCLUDEFROM">
RSYNC_EXCLUDEFROM="/etc/portage/rsync_excludes"
</pre>

<p>
Quando <c>rsync</c> non funziona, riprova un certo numero di volte prima di passare al prossimo server rsync disponibile. Il numero di tentativi è definito da <c>RSYNC_RETRIES</c>, di default a <c>3</c>:
</p>

<pre caption="La variabile RSYNC_RETRIES">
RSYNC_RETRIES="3"
</pre>

<p>
Se si sta usando un server rsync (molto) lento, <c>rsync</c> si chiude se non riceve traffico. I secondi che si devono aspettare prima di terminare, sono definiti dalla variabile <c>RSYNC_TIMEOUT</c>, di default a <c>180</c>:
</p>

<pre caption="La variabile RSYNC_TIMEOUT">
RSYNC_TIMEOUT="180"
</pre>

</body>
</subsection>
</section>
<section>
<title>Posizioni delle directory</title>
<subsection>
<title>Introduzione</title>
<body>

<p>
Qualsiasi cosa di Portage è configurabile, incluse le directory usate per le varie operazioni e i file necessari a Portage. Per cambiare la posizione di default (come definita in <path>/etc/make.globals</path>), si devono definire le variabili corrette in <path>/etc/make.conf</path>.
</p>

<warn>
Se si cambia una variabile per puntare a una differente posizione, non si deve <e>mai</e> terminare il percorso con <path>/</path> !
</warn>

</body>
</subsection>
<subsection>
<title>Portage Tree</title>
<body>

<p>
La posizione del Portage tree è definita nella variabile <c>PORTDIR</c>. Di default è <path>/usr/portage</path>:
</p>

<pre caption="La variabile PORTDIR">
PORTDIR="/usr/portage"
</pre>

<p>
Se si desidera mantenere un Portage tree locale oltre a quello "ufficiale", si deve definire la variabile <c>PORTDIR_OVERLAY</c>. La posizione della directory elencata in questa variabile non è interessata dalle azioni di <c>emerge sync</c>: gli ebuilds in queste posizioni non vengono aggiornati o rimossi, ma fanno comunque parte del Portage tree.
</p>

<pre caption="La variabile PORTDIR_OVERLAY">
PORTDIR_OVERLAY="/usr/local/portage"
</pre>

</body>
</subsection>
<subsection>
<title>I Distfile</title>
<body>

<p>
La posizione dei pacchetti di codice sorgente scaricati (chiamati distfile) è definita nella variabile <c>DISTDIR</c>. Di default è <path>${PORTDIR}/distfiles</path>:
</p>

<pre caption="La variabile DISTDIR">
DISTDIR="${PORTDIR}/distfiles"
</pre>

</body>
</subsection>
<subsection>
<title>Pacchetti e RPM</title>
<body>

<p>
La posizione dei pacchetti precompilati è definita nella variabile <c>PKGDIR</c>. Di default è <path>${PORTDIR}/packages</path>:
</p>

<pre caption="La variabile PKGDIR">
PKGDIR="${PORTDIR}/packages"
</pre>

<p>
La posizione degli RPM (alcuni pacchetti sono disponibili come RPM) è definita nella variabile <c>RPMDIR</c>. Di default è <path>${PORTDIR}/rpm</path>:
</p>

<pre caption="La variabile RPMDIR">
RPMDIR="${PORTDIR}/rpm"
</pre>

</body>
</subsection>
<subsection>
<title>File temporanei di Portage</title>
<body>

<p>
Portage usa una posizione temporanea per compilare le suoe ebuild. Questa posizione è definita nella variabile <c>PORTAGE_TMPDIR</c>. Di default è <path>/var/tmp</path>:
</p>

<pre caption="La variabile PORTAGE_TMPDIR">
PORTAGE_TMPDIR="/var/tmp"
</pre>

<p>
Di default, Portage crea una directory <path>portage</path> in <c>PORTAGE_TMPDIR</c>. Questo è dichiarato nella variabile <c>BUILD_PREFIX</c>:
</p>

<pre caption="La variabile BUILD_PREFIX">
BUILD_PREFIX="${PORTAGE_TMPDIR}/portage"
</pre>

<p>
Se si vuole cambiare la posizione, assicurarsi che questa directory temporanea sia su una partizione con una sufficiente quantità di spazio libero: durante la compilazione di grandi pacchetti, la directory può crescere a 2 Gb e oltre!
</p>

</body>
</subsection>
<subsection>
<title>Logging</title>
<body>

<p>
<c>PORT_LOGDIR</c> è una variabile speciale e non impostata di default. Dopo averla definita, Portage crea i log per ogni ebuild nella directory assegnata:
</p>

<pre caption="La variabile PORT_LOGDIR">
PORT_LOGDIR="/var/log/portage"
</pre>

</body>
</subsection>
</section>
<section>
<title>Altre opzioni di Portage</title>
<subsection>
<title>Nice value</title>
<body>

<p>
Portage supporta la compilazione con un nice-value differente (inteso come un valore di priorietà). Se si desidera che Portage compili pacchetti con un nice-value più alto (rendendo il sistema più sensibile durante il processo di compilazione, e un aumento del tempo di compilazione), si può definire la variabile <c>PORTAGE_NICENESS</c> con un numero positivo:
</p>

<pre caption="La variabile PORTAGE_NICENESS">
PORTAGE_NICENESS="3"
</pre>

</body>
</subsection>
<subsection>
<title>Pacchetti SLOT e cancellazione automatica</title>
<body>

<p>
In molte situazioni si desidera che siano disponibili sul sistema differenti versioni di un pacchetto (incluse le librerie). Portage supporta questo, definendo la variabile <c>SLOT</c> nelle ebuild. All'utente può anche non interessare come funziona <c>SLOT</c>, ma è importante sapere che è supportato.
</p>

<p>
Se si sta installando una versione più nuova di un pacchetto, Portage controlla se la variabile <c>SLOT</c> è dichiarata per quel pacchetto. Se è così, e la variabile <c>SLOT</c> è differente per entrambi i pacchetti (il vecchio e il nuovo), Portage non modifica il pacchetto vecchio.</p>

<p>
Se la variabile <c>SLOT</c> è la stessa (come di solito accade), il pacchetto più vecchio di default viene rimosso. Se un utente desidera interrompere questa rimozione, Portage lascia disponibili alcuni secondi. I secondi sono definiti nella variabile <c>CLEAN_DELAY</c>, di default a <c>5</c> secondi:
</p>

<pre caption="La variabile CLEAN_DELAY">
CLEAN_DELAY="5"
</pre>

<p>
Se non si desidera che Portage rimuova automaticamente le versioni più vecchie, si può impostare la variabile <c>AUTOCLEAN</c> a <c>no</c>:
</p>

<pre caption="La variabile AUTOCLEAN">
AUTOCLEAN="no"
</pre>

</body>
</subsection>
<subsection>
<title>Variabili relative alla compilazione</title>
<body>

<p>
Alcune variabili sono state già incontrate. Chi ha installato Gentoo conosce le variabili <c>CHOST</c>, <c>CFLAGS</c> e <c>CXXFLAGS</c>, usate dal compilatore per compilare e ottimizzare i pacchetti.
</p>

<p>
Ulteriori informazioni su queste variabili si trovano nelle pagine di info di <c>gcc</c>, o online nei <uri link="http://www.gnu.org/software/gcc/onlinedocs/">Manuali online di GCC</uri>.
</p>

<pre caption="Ottenere informazioni su CHOST, CFLAGS e CXXFLAGS">
# <i>info gcc</i>
<comment>(Selezionare "Invoking gcc")</comment>
<comment>(Selezionare "Optimize options")</comment>
</pre>

<p>
Se è definita <c>DEBUGBUILD</c>, Portage non elimina i binari e le librerie per rendere il debug più facile. Questo rallenta il sistema e aumenta la grandezza dei file.
</p>

<pre caption="La variabile DEBUGBUILD">
<comment># Non impostare a "false", eliminare la riga. Portage non controlla il valore,</comment>
<comment># ma solo che la variabile sia definita o meno</comment>
DEBUGBUILD="true"
</pre>

<p>
La variabile <c>MAKEOPTS</c> è usata da <c>make</c>, un tool usato per facilitare la compilazione di un pacchetto. E' definita per dire a <c>make</c> di eseguire molte compilazioni simultaneamente (in special modo se si ha un sistema multi-CPU, o si sta usando <c>distcc</c> come descritto in precedenza).
</p>

<p>
Per far si che <c>make</c> esegua tre compilazioni simultaneamente, impostare la variabile <c>MAKEOPTS</c> a <c>-j3</c>:
</p>

<pre caption="La variabile MAKEOPTS">
MAKEOPTS="-j3"
</pre>

<p>
La variabile <c>ROOT</c> non dovrebbe essere impostata in <path>/etc/make.conf</path>, ma come una variabile di ambiente. Portage controlla questa variabile per vedere dove un pacchetto deve essere installato. Di default è <path>/</path>. Come esempio, ecco come installare <c>gnumeric</c> in <path>/mnt/gentoo</path> invece che sul sistema:
</p>

<pre caption="La variabile ROOT">
# <i>ROOT="/mnt/gentoo" emerge gnumeric</i>
</pre>

</body>
</subsection>
<subsection>
<title>Formattazione output</title>
<body>

<p>
Di default, Portage colora il suo output per migliorare la leggibilità. Se non si desidera questo, impostare la variabile <c>NOCOLOR</c> a <c>true</c>:
</p>

<pre caption="La variabile NOCOLOR">
NOCOLOR="true"
</pre>

</body>
</subsection>
</section>
<section>
<title>Risorse</title>
<subsection>
<title>Man page</title>
<body>

<p>
Se si ha bisogno di un riferimento rapido su tutte le variabili elencate, si legga la man page di <path>make.conf</path>:
</p>

<pre caption="Consultare la man page di make.conf">
# <i>man make.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Esempi commentati</title>
<body>

<p>
Il file <path>/etc/make.conf</path> contiene molti commenti, inclusi esempi che si potrebbero trovare interessanti. La maggior parte degli utenti non aggiorna interattivamente <path>/etc/make.conf</path> e si dimentica gli aggiornamenti ai file. Si può trovare l'ultimo file <path>etc/make.conf</path> nel <uri link="http://www.gentoo.org/cgi-bin/viewcvs.cgi/*checkout*/portage/cnf/make.conf?rev=HEAD&amp;cvsroot=gentoo-src&amp;content-type=text/plain">CVS via web</uri>.
</p>

</body>
</subsection>
</section>
</sections>
