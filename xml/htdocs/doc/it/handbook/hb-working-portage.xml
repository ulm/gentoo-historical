<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/handbook/hb-working-portage.xml,v 1.9 2006/03/16 21:17:23 so Exp $ -->

<sections>

<version>1.51</version>
<date>2005-06-30</date>

<section>
<title>Benvenuti in Portage</title>
<body>

<p>
Portage è probabilmente l'innovazione di Gentoo più rilevante nella gestione software. La grande flessibilità e l'enorme quantità di caratteristiche ne fanno
uno dei migliori programmi per la gestione del software disponibili
per Linux.
</p>
<p>
Portage è completamente scritto in <uri link="http://www.python.org">Python</uri> e <uri link="http://www.gnu.org/software/bash">Bash</uri> e perciò
completamente visibile agli utenti essendo entrambi linguaggi di scripting.
</p>

<p>
Molti utenti useranno Portage attraverso il tool <c>emerge</c>. Questo
capitolo non è un duplicato delle informazioni disponibili attraverso
le pagine man di emerge. Per avere la lista completa delle opzioni di
emerge, consultare la pagina man:
</p>

<pre caption="Leggere la pagina man di emerge">
# <i>man emerge</i>
</pre>

</body>
</section>
<section>
<title>L'albero del Portage</title>
<subsection>
<title>Gli ebuild</title>
<body>

<p>
Quando si parla di pacchetti si intendono spesso titoli software che sono
disponibili agli utenti Gentoo attraverso l'albero del Portage.
L'albero del Portage è una collezione di file <e>ebuild</e> che contengono
tutte le informazioni necessarie al Portage per manutenere il software
(installare, ricercare,....). Questi ebuild risiedono di default in <path>/usr/portage</path>.
</p>

<p>
Ogni qualvolta si chiede al Portage di eseguire alcune azioni riguardanti
i titoli software, vengono usati gli ebuild del sistema come base.
Diviene, così, importante aggiornare regolarmente gli ebuild del sistema
in modo tale che Portage sia a conoscenza del nuovo software, degli aggiornamenti, ecc.
</p>

</body>
</subsection>
<subsection>
<title>Aggiornamento dell'albero del Portage</title>
<body>
<p>
L'albero del Portage viene di solito aggiornato con  <uri
link="http://rsync.samba.org">rsync</uri>, una utility
per il trasferimento incrementale di file.
L'aggiornameto è realmente semplice dato che il comando <c>emerge</c>
fornisce un'interfaccia per rsync:
</p>

<pre caption="Aggiornamento dell'albero del Portage">
# <i>emerge --sync</i>
</pre>

<p>
Se non si riesce ad usare rsync a causa di un firewall si può aggiornare
l'albero del Portage usando lo snapshot che viene generato giornalmente.
Il tool <c>emerge-webrsync</c> scarica ed installa automaticamente l'ultimo
snapshot dai sistemi Gentoo.
</p>

<pre caption="Eseguire emerge-webrsync">
# <i>emerge-webrsync</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Manutenzione del software</title>
<subsection>
<title>Ricerca del software</title>
<body>

<p>
La ricerca dei titoli software attraverso l'albero del Portage si esegue
utilizzando la funzione di ricerca di <c>emerge</c>. Di default
<c>emerge --search</c> restituisce i nomi dei pacchetti i cui titoli
corrispondono (per intero o parzialmente) a quelli forniti per la ricerca.
</p>

<p>
Per esempio, dovendo cercare tutti i pacchetti che hanno "pdf" nel
loro nome:
</p>
<pre caption="Cercare i pacchetti che contengono pdf nel nome">
$ <i>emerge --search pdf</i>
</pre>

<p>
Se si vuole cercare attraverso la descrizione si può usare l'opzione
<c>--searchdesc</c> ( o <c>-S</c>):
</p>

<pre caption="Cercare i pacchetti che contengono pdf nella descrizione">
$ <i>emerge --searchdesc pdf</i>
</pre>

<p>
Da uno sguardo all'output si nota che vengono fornite diverse informazioni.
I campi sono chiaramente identificati così che non saranno esaminati:
</p>
<pre caption="Esempio dell'output di 'emerge --search'">
*  net-print/cups-pdf
      Latest version available: 1.5.2
      Latest version installed: [ Not Installed ]
      Size of downloaded files: 15 kB
      Homepage:    http://cip.physik.uni-wuerzburg.de/~vrbehr/cups-pdf/
      Description: Provides a virtual printer for CUPS to produce PDF files.
      License:     GPL-2
</pre>

</body>
</subsection>
<subsection>
<title>Installazione del software</title>
<body>

<p>
Una volta trovato il titolo del software che interessa, lo si può facilmente
installare con <c>emerge</c> facendolo seguire dal nome del pacchetto.
Per esempio, per installare <c>gnumeric</c>:
</p>

<pre caption="Installare gnumeric">
# <i>emerge gnumeric</i>
</pre>


<p>
Dato che molte applicazioni dipendono da altre ogni tentativo di installare
certi pacchetti software potrebbe portare all'installazione di alcuni
pacchetti aggiuntivi. Se si vuol sapere cosa verrà installato dal
Portage quando viene richiesta un'installazione, si deve aggiungere l'opzione
<c>--pretend</c>. Per esempio:
</p>
<pre caption="Fingere di installare gnumeric">
# <i>emerge --pretend gnumeric</i>
</pre>

<p>
Quando si chiede al Portage di installare un pacchetto, verrà scaricato il
codice sorgente necessario da internet e memorizzato di default in 
<path>/usr/portage/distfiles</path>. Il pacchetti verrà quindi scompresso, compilato e installato. Se si vuole che Portage scarichi solo i sorgenti senza
installarli, si aggiunga al comando <c>emerge</c> l'opzione <c>--fetchonly</c>:
</p>

<pre caption="Scaricare il codice sorgente di gnumeric">
# <i>emerge --fetchonly gnumeric</i>
</pre>

</body>
</subsection>
<subsection>
<title>Trovare la documentazione di pacchetti installati</title>	
 	 <body>	
 	 	
 	 <p>	
        Molti pacchetti forniscono la propria documentazione. Alcune volte
        il flag USE <c>doc</c> determina se la documentazione del pacchetto
        verrà installata o no. Si può controllare l'esistenza di un flag USE
        <c>doc</c> con il comando
 	 <c>emerge -vp	
 	 &lt;nome pacchetto&gt;</c>.	
 	 </p>	
 	 	
 	 <pre caption="Controllo dell'esistenza di un flag USE doc">	
 	 <comment>(Naturalmente, alsa-lib è solamente un esempio.)</comment>	
 	 # <i>emerge -vp alsa-lib</i>	
 	 [ebuild  N    ] media-libs/alsa-lib-1.0.9_rc3  +doc -jack 674 kB	
 	 </pre>	
 	 	
 	 <p>	
        Si può abilitare o disabilitare il flag USE <c>doc</c> sia globalmente
nel file
 	 <path>/etc/make.conf</path> o per pacchetto nel file
 	 <path>/etc/portage/package.use</path>. 
         Il capitolo <uri	
 	 link="?part=2&amp;chap=2">USE Flag</uri> copre in dettaglio questo aspetto.
 	 </p>	
 	 	
 	 <p>	
        Una volta che il pacchetto è stato installato, la sua documentazione
viene generalmente trovata in una sottodirectory col nome del pacchetto
nella directory
 	 <path>/usr/share/doc</path>.
Si può avere la lista dei file installati col tool <c>equery</c> che fa
parte del <uri	
 	 link="/doc/en/gentoolkit.xml">pacchetto</uri> 
 	 <c>app-portage/gentoolkit</c> .	
 	 </p>	
 	 	
 	 <pre caption="Trovare la documentazione di un pacchetto">	
 	 # <i>ls -l /usr/share/doc/alsa-lib-1.0.9_rc3</i>	
 	 total 28	
 	 -rw-r--r--  1 root root  669 May 17 21:54 ChangeLog.gz	
 	 -rw-r--r--  1 root root 9373 May 17 21:54 COPYING.gz	
 	 drwxr-xr-x  2 root root 8560 May 17 21:54 html	
 	 -rw-r--r--  1 root root  196 May 17 21:54 TODO.gz	
 	 	
 	 <comment>(Alternativamente, usare equery per localizzare file interessanti:)</comment>	
 	 # <i>equery files alsa-lib | less</i>	
 	 media-libs/alsa-lib-1.0.9_rc3	
 	 * Contents of media-libs/alsa-lib-1.0.9_rc3:	
 	 /usr	
 	 /usr/bin	
 	 /usr/bin/alsalisp	
 	  <comment>(output troncato)</comment>
 	 </pre>	
 	 	
 	 </body>	
</subsection>
<subsection>
<title>Rimozione del software</title>
<body>

<p>
Se si vuole rimuovere un pacchetto dal sistema, usare <c>emerge --unmerge</c>.
Questo comando rimuoverà tutti i file installati dal pacchetto 
<e>eccetto</e> i  file di configurazione che sono stati alterati
dopo l'installazione. In questo modo si permette di
continuare a lavorare con il pacchetto nel caso si decidesse di installarlo 
nuovamente.
</p>

<p>
<brite>Attenzione</brite>: Portage <e>non</e> controllerà se il
 pacchetto che si vuole rimuovere sia richiesto da un altro pacchetto.
Verrà solo emesso un avviso del fatto che la rimozione di pacchetti importanti
potrebbe danneggiare il sistema.
</p>

<pre caption="Rimozione di gnumeric">
# <i>emerge --unmerge gnumeric</i>
</pre>

<p>
Quando si rimuove un pacchetto dal sistema, le sue dipendenze saranno 
lasciate. Per far trovare al Portage tutte le dipendenze che potrebbero
essere rimosse, usare la funzionalità <c>--depclean</c> di <c>emerge</c>.
Se ne parlerà in seguito.
</p>
</body>
</subsection>
<subsection>
<title>Aggiornare il software</title>
<body>

<p>
Per mantenere il sistema in perfetta forma (e non solo con gli ultimi
aggiornamenti sulla sicurezza) si dovrà mantenere aggiornato il sistema
regolarmente. Dato che Portage controlla gli ebuild dell'albero del Portage
si dovrà prima aggiornare l'albero. Quindi, si potrà aggiornare il sistema
con <c>emerge --update world</c>:
</p>

<pre caption="Aggiornare il sistema">
# <i>emerge --update world</i>
</pre>

<p>
Portage cercherà quindi le nuove versioni delle applicazioni installate.
Verranno comunque verificate solo le versioni per le applicazioni che 
si sono esplicitamente installate e non le dipendenze.
Se si vuole aggiornare ogni singolo pacchetto del sistema, occorre
aggiungere l'argomento <c>--deep</c>:
</p>

<pre caption="Aggiornare l'intero sistema">
# <i>emerge --update --deep world</i>
</pre>

<p>	
        Dato che aggiornamenti che riguardano la sicurezza possono
essere correlati a pacchetti che non si sono esplicitamente installati
nel sistema (ma che sono stati installati quali dipendenze di altri programmi),
si raccomanda di eseguire questo comando una volta ogni tanto.
</p>
<p>
Se è stato alterato qualche <uri link="?part=2&amp;chap=2">USE flag</uri>
si può aggiungere l'opzione <c>--newuse</c>. Portage verificherà
se la modifica richiede l'installazione di nuovi pacchetti o la ricompilazione
di quelli esistenti:
</p>

<pre caption="Eseguire un aggiornamento completo">
# <i>emerge --update --deep --newuse world</i>
</pre>

</body>
</subsection>
<subsection>
<title>Metapacchetti</title>
<body>

<p>
Alcuni pacchetti presenti nell'albero del Portage non hanno un contenuto reale
ma sono usati per installare una collezione di pacchetti. Per esempio,
il pacchetto <c>kde</c> installa un ambiente KDE sul sistema ricercando tra
i vari pacchetti legati al KDE come dipendenze.
</p>

<p>
La rimozione di un tale pacchetto dal sistema usando <c>emerge --unmerge</c>,
non avrà successo dato che le numerose dipendenze rimarranno sul sistema.
</p>

<p>
Portage ha anche la funzionalità di rimozione delle dipendenze orfane, ma dato che
la disponibilità del software è dinamicamente dipendente, occorre prima
aggiornare completamente l'intero sistema, includendo, se ci sono state, le
modifiche alle flag USE. Quindi sarà possibile eseguire <c>emerge --depclean</c>
per rimuovere le dipendenze orfane. Fatto ciò, ci sarà bisogno di 
ricompilare le applicazioni che erano dinamicamente linkate al software
rimosso ma non più richiesto.
</p>

<p>
Tutto ciò può essere fatto con un seguenti tre comandi:
</p>
<pre caption="Rimozione delle dipendenze orfane">
# <i>emerge --update --deep --newuse world</i>
# <i>emerge --depclean</i>
# <i>revdep-rebuild</i>
</pre>

<p>
<c>revdep-rebuild</c> viene provveduto col pacchetto <c>gentoolkit</c>, che deve
essere quindi emerso prima:
</p>
<pre caption="Installazione del pacchetto gentoolkit">
# <i>emerge gentoolkit</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Errori durante l'uso del Portage</title>
<subsection>
<title>Slot, virtualità, branche, architetture e profili</title>
<body>

<p>
Portage è estremamente potente e supporta molte
caratteristiche che altri gestori di software omettono. Si vedranno ora
altri aspetti del Portage senza andare troppo nei dettagli.
</p>

<p>
Portage permette la coesistenza di differenti versioni dello stesso pacchetto.
A differenza di altre distribuzioni che tendono a chiamare i propri pacchetti
con le versioni (come <c>freetype</c> e <c>freetype2</c>), Portage usa una
tecnica chiamata <e>SLOT</e>. Un ebuild dichiara un certo SLOT per le proprie
versioni. Ebuild con SLOT differenti possono coesistere sullo stesso sistema.
Per esempio, il pacchetto <c>freetype</c> ha un ebuild con <c>SLOT="1"</c>
e <c>SLOT="2"</c>.
</p>

<p>
Ci sono anche pacchetti che provvedono la stessa funzionalità ma
con un'implementazione diversa. Per esempio, <c>metalogd</c>, <c>sysklogd</c>
e <c>syslog-ng</c>, tutti gestori di eventi di sistema. Applicazioni che fanno
assegnamento sulla disponibilità di un gestore di eventi di sistema, non 
possono dipendere da uno in particolare. Per esempio, <c>metalogd</c>, come altri
sistemi di gestione di eventi, sono tutti un'ottima scelta. Portage permette
l'uso di <e>virtualità</e>: ogni sistema di gestione degli eventi provvede
un <c>virtual/syslog</c> in modo tale che le applicazioni possano dipendere
da tale <c>virtual/syslog</c>.
</p>

<p>
Il software all'interno dell'albero del Portage, può risiedere in differenti
branche. Di default il sistema accetta solo pacchetti che Gentoo giudica
stabili. Molti nuovi software una volta raccomandati, vengono aggiunti
ad una branca di test, il che significa che sarà necessario procedere 
ad ulteriori verifiche prima di marcarli come stabili. Anche se gli ebuild
per tali software sono presenti nell'albero del Portage, non vengono aggiornati
prima di raggiungere la branca stabile.
</p>

<p>
Alcuni software sono disponibili solo per alcune architetture. Oppure
il software non gira su altre architetture o ha necessità di essere
ulteriormente testato o gli sviluppatori che raccomandano il software
non sono in grado di verificare se il pacchetto gira su differenti architetture.
</p>

<p>
Ogni installazione di Gentoo aderisce ad un certo <c>profilo</c> che contiene
tra le altre informazioni, la lista dei pacchetti che sono richiesti
affinché un sistema funzioni normalmente.
</p>
</body>
</subsection>
<subsection id="blocked">
<title>Pacchetti bloccati</title>
<body>

<pre caption="Portage avverte circa i pacchetti bloccati (con --pretend)">
[blocks B     ] mail-mta/ssmtp (from pkg mail-mta/postfix-2.2.2-r1)
</pre>
<pre caption="Portage avverte circa i pacchetti bloccati (senza --pretend)">
!!! Error: the mail-mta/postfix package conflicts with another package.
!!!        both can't be installed on the same system together.
!!!        Please use 'emerge --pretend' to determine blockers. 
</pre>

<p>
Gli ebuild contengono specifici campi che informano il Portage sulle
dipendenze. Ci sono due possibili dipendenze: dipendenze in fase di compilazione dichiarate in <c>DEPEND</c> e dipendenze per l'esecuzione dichiarate in <c>RDEPEND</c>.
Quando una di queste dipendenze marca un pacchetto o un virtuale come
<e>non</e> compatibile, questo viene bloccato.
</p>

<p>
Per correggere il blocco, si può scegliere tra il non installare il pacchetto
o rimuovere prima il pacchetto che causa il conflitto. Nel precedente
esempio si può scegliere tra il non installare <c>postfix</c> o rimuovere
prima <c>ssmtp</c>.
</p>
 <p>	
    E' anche possibile che due pacchetti che devono essere ancora installati
siano in conflitto tra loro. In questo raro caso, si dovrebbe capire
perché si vogliono installare entrambi dato che in molti casi può bastare
l'installazione di un solo pacchetto. Se non è questo il caso, aprire un bug sul

 	 <uri link="http://bugs.gentoo.org">Gentoo bugtracking system</uri>.	
 	 </p>
</body>
</subsection>
<subsection id="masked">
<title>Pacchetti mascherati</title>
<body>
<pre caption="Portage avverte circa i pacchetti mascherati">
!!! all ebuilds that could satisfy "bootsplash" have been masked. 
</pre>

<pre caption="Portage avverte circa i pacchetti mascherati - la ragione">
!!! possible candidates are:

- gnome-base/gnome-2.8.0_pre1 (masked by: <i>~x86 keyword</i>)
- lm-sensors/lm-sensors-2.8.7 (masked by: <i>-sparc keyword</i>)
- sys-libs/glibc-2.3.4.20040808 (masked by: <i>-* keyword</i>)
- dev-util/cvsd-1.0.2 (masked by: <i>missing keyword</i>)
- media-video/ati-gatos-4.3.0 (masked by: <i>package.mask</i>)
- sys-libs/glibc-2.3.2-r11 (masked by: <i>profile</i>)
</pre>

<p>
Quando si desidera installare un pacchetto che non è disponibile per il 
nostro sistema, si riceverà un errore di pacchetto mascherato.
Si dovrà quindi installare un'applicazione differente disponibile per
il nostro sistema oppure aspettare finché il pacchetto divenga
disponibile. C'è sempre una ragione perché un pacchetto viene mascherato:
</p>
<ul>
  <li>
    <b>~arch keyword</b> significa che l'applicazione non è stata sufficientemente testata per essere inserita nella branca stabile.
Aspettare alcuni giorni o alcune settimane e provare nuovamente.
  </li>
  <li>
    <b>-arch keyword</b> o <b>-* keyword</b> significa che l'applicazione non funziona sulla nostra architettura. Se si crede che il pacchetto giri, aprire un 
bug sul <uri link="http://bugs.gentoo.org">bugzilla</uri> di Gentoo.
  </li>
  <li>
    <b>missing keyword</b> significa che l'applicazione non è ancora stata testata sulla nostra architettura.
    Chiedere al gruppo che si occupa del porting per l'architettura di
testare il pacchetto o testarlo per loro e riportare i risultati sul 
    <uri link="http://bugs.gentoo.org">bugzilla</uri> di Gentoo.
  </li>
  <li>
    <b>package.mask</b> significa che il pacchetto è corrotto, instabile o difettoso ed è stato deliberatamente marcato come non-usare.
  </li>
  <li>
    <b>profile</b> significa che il pacchetto non è stato trovato appropriatamente nel vostro profilo.
Le applicazioni potrebbero danneggiare il sistema se installate o sono solo
non compatibili col profilo in uso.
  </li>
</ul>

</body>
</subsection>
<subsection id="missingdependencies">
<title>Dipendenze omesse</title>
<body>
<pre caption="Portage avverte circa le dipendenze omesse">
emerge: there are no ebuilds to satisfy "&gt;=sys-devel/gcc-3.4.2-r4".

!!! Problem with ebuild sys-devel/gcc-3.4.2-r4
!!! Possibly a DEPEND/*DEPEND problem. 
</pre>

<p>
L'applicazione che si sta provando ad installare dipende da un altro 
pacchetto che non è disponibile per il sistema. Controllare
su <uri
link="http://bugs.gentoo.org">bugzilla</uri> se la cosa è segnalata
altrimenti la si può riportare. A meno che non si stia mescolando
le branche, questo non dovrebbe accadere ed è perciò un bug.
</p>
</body>
</subsection>
<subsection id="ambiguousebuild">
<title>Nomi di ebuild ambigui</title>
<body>

<pre caption="Portage avverte circa l'ambiguità di nomi di ebuild">
!!! The short ebuild name "aterm" is ambiguous.  Please specify
!!! one of the following fully-qualified ebuild names instead:

    dev-libs/aterm
    x11-terms/aterm
</pre>

<p>
L'applicazione che si vuole installare ha un nome che corrisponde con un altro
pacchetto. Occorre specificare la categoria. Portage informa sulle scelte
possibili.
</p>
</body>
</subsection>
<subsection id="circulardependencies">
<title>Dipendenze circolari</title>
<body>

<pre caption="Portage avverte circa le dipendenze circolari">
!!! Error: circular dependencies: 

ebuild / net-print/cups-1.1.15-r2 depends on ebuild / app-text/ghostscript-7.05.3-r1
ebuild / app-text/ghostscript-7.05.3-r1 depends on ebuild / net-print/cups-1.1.15-r2 
</pre>

<p>
Due (o più) pacchetti che si vuole installare dipendono l'uno dall'altro e non
possono perciò essere installati. Questo è probabilmente un bug del Portage.
Provare ad eseguire un rsync e provare nuovamente. Si può anche controllare
su  <uri link="http://bugs.gentoo.org">bugzilla</uri> se è un caso conosciuto
oppure no, nel qual caso lo si può riportare.
</p>
</body>
</subsection>
<subsection id="fetchfailed">
<title>Scaricamento non riuscito</title>
<body>

<pre caption="Portage avverte circa un download non riuscito">
!!! Fetch failed for sys-libs/ncurses-5.4-r5, continuing...
<comment>(...)</comment>
!!! Some fetch errors were encountered.  Please see above for details.
</pre>

<p>
Portage non è riuscito a scaricare i sorgenti per una data applicazione
e proverà a proseguire con l'installazione delle altre applicazioni
se ci sono. Questo problema può essere causato da un mirror che non è
stato sincronizzato appropriatamente o perché l'ebuild punta ad una locazione
incorretta. Il server dove risiedono i sorgenti potrebbe anche non essere 
disponibile per qualche ragione.
</p>

<p>
Riprovare dopo un'ora e vedere se la situazione persiste.
</p>
</body>
</subsection>
<subsection id="profileprotect">
<title>Protezione dei profili di sistema</title>
<body>

<pre caption="Portage avverte circa la protezione dei profili">
!!! Trying to unmerge package(s) in system profile. 'sys-apps/portage'
!!! This could be damaging to your system.
</pre>

<p>
Si è richiesto la rimozione di un pacchetto che fa parte del core del
sistema. Tale pacchetto è listato nel vostro profile come richiesto e
dovrebbe perciò non essere rimosso dal sistema.
</p>
</body>
</subsection>
</section>
</sections>

