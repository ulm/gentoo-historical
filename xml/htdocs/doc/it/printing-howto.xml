<?xml version='1.0' encoding="UTF-8"?> 

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/it/printing-howto.xml" lang="it"> 

<title>Guida alla Stampa in Gentoo</title> 

<author title="Autore"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Redazione">
  <mail link="wleggette@gate.net">Wesley Leggette</mail>
</author>
<author title="Redazione">
  <mail link="carl@gentoo.org">Carl Anderson</mail>
</author>
<author title="Redazione">
  <mail link="lanius@gentoo.org">Heinrich Wendel</mail>
</author>
<author title="Redazione">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Copyeditor">
  <mail link="phil@thenexusproject.org">Phil Bordelon</mail>
</author> 
<author title="Traduzione">
  <mail link="f_a_b_i_o_99@yahoo.it">Fabio Rosati</mail>
</author> 

<abstract>
Una guida completa alla stampa per Gentoo Linux.
Questo documento tratta sia la stampa in locale che in rete.
</abstract>

<license/>

<version>1.20</version>
<date>25 Ottobre 2004</date>

<chapter> 
<title>Installazione di CUPS e foomatic</title> 
<section>
<body> 

<p>
Configurare la stampa in Gento Linux è un'operazine relativamente semplice grazie ad
alcuni eccellenti programmi come CUPS (Common Unix Printing System) e foomatic. Entrambe
questi programmi sono attualmente presenti nell'albero di Portage e sono molto semplici
da configurare per l'utente finale.
</p> 

<p>
Dato che CUPS è cross-desktop, si possono seguire queste indicazioni per far funzionare
la stampa sia in GNOME che in KDE.
Ci sono altre possibilità, come ad esempio il setup di stampa di KDE, ma probabilmente CUPS è
quello più semplice da configurare ed il più scalabile.
</p>

<p>
Prima di installare CUPS è buona norma aggiungere le flag USE necessarie in
<path>/etc/make.conf</path>.
</p>

<pre caption = "Modificare /etc/make.conf">
<comment>aggiungere cups, foomaticdb, ppds ed usb (se si sta utilizzando una stampante USB)
alla lista già presente per la variabile USE.</comment>
USE="cups foomaticdb ppds usb altra_var1 altra_var2"
</pre>

<p>
Per maggiori informazioni sulle flag USE si può far riferimento al capitolo 
<uri link = "http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=2&amp;chap=2">flag USE</uri> del manuale di Gentoo.
(NdT: la versione in italiano è disponibile <uri link = "http://www.gentoo.org/doc/it/handbook/handbook-x86.xml?part=2&amp;chap=1">qui</uri>)
</p>

<pre caption = "Installazione dei pacchetti necessari">
# <i>emerge cups</i>
# <i>emerge foomatic</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configurare i Moduli del Kernel</title> 
<section>
<title>Generale</title>
<body>

<p>
Ora che i pacchetti necessari sono stati installati, è il momento di installare la stampante.
</p>

<p>
A seconda del tipo di connessione alla stampante che si utilizzerà, sarà necessario
abilitare nel kernel la connessione attraverso la porta parallela o quella attraverso la porta USB.
</p>

<note>
Questo è necessario soltanto per la stampa in locale, se si vuole stampare via samba si può saltare questa sezione.
</note>

<note>
Se non si è certi di come compilare il kernel, si possono trovare istruzioni specifiche nel 
<uri link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">Kernel Howto</uri> (attualmente non disponibile).
Meglio sapere come compilare ed installare nuovi moduli senza dover ricompilare il kernel o
riavviare il computer. E' un consistente risparmio di tempo.
</note>

</body>
</section>
<section>
<title>Moduli USB</title>
<body>

<p>
Per attivare il supporto alle stampanti USB, andare in <c>USB support</c> ed abilitare
<c>Support for USB</c> ed <c>USB Printer support</c>. Abilitare entrambi come moduli
installerà usbcore.o e printer.o nella directory dei moduli. E' preferibile utilizzare
i moduli per il fatto che così facendo non è necessario riavviare il computer.
Per il kernel 2.6 queste opzioni si trovano sotto <c>Device Drivers</c>.
</p>

<p>
Dopo che il kernel è stato compilato ed il computer riavviato (se occorre), è il momento
di caricare i moduli necessari:
</p>

<pre caption = "Caricamento dei Moduli USB">
# <i>modprobe usbcore</i> 

<comment>(Per il kernel 2.4:)</comment>
# <i>modprobe printer</i>
<comment>(Per il kernel 2.6:)</comment>
# <i>modprobe usblp</i>
</pre>

<p>
Dopo aver caricato con successo i moduli, collegare la stampante e controllare
<c>dmesg</c> per verificare che sia stata rilevata.
</p> 

<pre caption = "Controllo dei Mesaggi del Kernel">
# <i>dmesg | tail</i>
</pre> 

<p>
Si dovrebbe trovare qualcosa di simile a questo:
</p>

<pre caption = "Output di dmesg">
hub.c: USB new device connect on bus2/2, assigned device number 2 
printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104
</pre>

</body>
</section> 
<section>
<title>Moduli per la Porta Parallela</title>
<body>

<p>
Per attivare il supporto alla porta parallela andare in <c>Parallel port support</c> ed
abilitare <c>Parallel port support</c> e <c>PC-style hardware</c>. A seconda della stampante
che si utilizza si dovrà attivare anche <c>Multi-IO cards (parallel and serial)</c>,
<c>Support for foreign hardware</c> e <c>IEEE 1284 transfer mode</c>. Dopodiché andare in
<c>Character devices</c> ed abilitare <c>Parallel Printer Support</c>.
Per il kernel 2.6 queste opzioni si trovano sotto <c>Device Drivers</c>.
</p>

<p>
Dopo che il kernel è stato compilato, assicurarsi che la stampante sia collegata e riavviare il
computer. Ora è il momento di caricare i moduli necessari:
</p>

<pre caption = "Caricare i moduli per la Porta Parallela">
# <i>modprobe lp</i> <comment>(Solo per il kernel 2.6)</comment>
# <i>modprobe parport</i> 
# <i>modprobe parport_pc</i>
</pre> 

<p>
Dopo che i moduli sono stati caricati con successo, controllare <path>/var/log/messages</path>
per verificare che la stampante sia stata rilevata.
</p> 

<note>
Se si sta utilizzando qualcosa di diverso rispetto a sysklogd, il file di log del kernel
sarà differente.
</note>

<pre caption = "Controllo dei Mesaggi del Kernel">
# <i>tail /var/log/messages</i>
</pre> 

<p>
Si dovrebbe trovare qualcosa di simile a questo:
</p>

<pre caption = "Contenuto di /var/log/messages">
lp0: using parport0 (polling).
</pre>

</body>
</section>
<section>
<title> Test di basso livello</title>
<body>

<p>
Prima di configurare la stampante con CUPS, possiamo testarla con alcuni
comandi di basso livello.
</p> 

<note>
Alcune stampanti (specialmente quelle basate su <uri 
link="http://pnm2ppa.sourceforge.net">PPA</uri> come le HP serie 720, 820 e 1000)
non accettano input ASCII. Se si utilizza una di queste stampanti, quindi
<e>basata su PPA</e>, bisogna tener conto che questo test fallirà anche se
la stampante funziona correttamente.
</note>

<note>
Alcune stampanti (ad esempio diverse HP LaserJet) necessitano di un ^L (Control-L)
alla fine del file per avviare la stampa.
In assenza del ^L il cat funziona e la stampante riceve i dati, ma non inizia a stampare.
</note>

<pre caption = "Test di Stampa Utilizzando cat">
# <i>touch test.txt</i>
# <i>echo "Hello World" > test.txt</i>
# <i>cat test.txt > /dev/usb/lp0 </i>

<comment> In alternativa, per le stampanti su porta parallela: </comment>
# <i>cat test.txt > /dev/lp0 </i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Driver Speciali per la Stampante</title> 
<section>
<body> 

<p>
Prima di utilizzare foomatic per generare un file PPD, può essere necessario
individuare il driver fornito da terze parti per la propria stampante. Ad esempio,
Epson fornisce <uri link="http://www.epkowa.co.jp/english/linux_e/linux.html">diversi driver
per stampante</uri> per sistemi operativi open source. Ad ogni modo, come accade per quelli Epson,
molti di questi driver speciali non sono open source.
</p>

<p>
I seguenti driver per stampante sono disponibili come ebuilds in Portage: gimp-print,
omni, hpijs, pnm2ppa.
</p>

<p>
Per molte stampanti, escluse le HP Inkjet, sarà possibile utilizzare i
i driver standard di Linux. Visitare il
<uri link="http://www.linuxprinting.org/printer_list.cgi"> database di supporto
per stampanti di linuxprinting.org</uri> per trovare informazioni sulla propria stampante.
Leggere la documentazione fornita con qualsiasi driver si scarichi per informazioni
sull'installazione e la licenza.
</p> 

<p>
Se si utilizza una stampante HP Inkjet, è necessario installare il driver per stampante
<c>hpijs</c>. Questo driver si occupa dell'interpretazione del Postscript
necessaria per far funzionare la stampante HP. Il driver <c>hpijs</c> è soltanto per
le stampanti HP Inkjet, ma è disponibile in Portage per comodità. La documentazione di HP per
il driver <c>hpijs</c> sarà messa in <path>/usr/share/doc/hpijs-&lt;version&gt;</path>.
L'autore raccomanda <e>caldamente</e> di leggerla.
</p>

<p>
Se si sta utiizzando una stampante basata su PPA è necessario installare il
driver <c>pnm2ppa</c>.
</p>

<pre caption="Installazione di hpijs">
# <i>emerge hpijs</i>
</pre>

<note>
Se si sta utilizzando una HP LaserJet, questa potrebbe essere già supportata nel
sistema di stampa di GNOME. Se si sta utilizzando una stampante che non sia una HP
Inkjet non c'è bisogno di installare questo speciale driver.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Configurazione del file PPD</title>
<section>
<body>

<p>
Ora è il momento di configurare la stampante e CUPS. Per fare in modo che la stampante
interpreti correttamente Postscript, CUPS ha bisogno di un file PPD (Printer Postscript
Definition). Il modo più semplice per generare un PPD è utilizzare foomatic.
</p>

<note>
Un altro metodo è quello di scaricare un file PPD da <uri link="http://www.linuxprinting.org">
LinuxPrinting.org</uri> e copiarlo in <path>/usr/share/cups/model</path>. Se si utilizza questo
metodo si può saltare il resto della sezione e continuare con <uri link="#doc_chap5">Configurazione
di CUPS</uri>.
</note>

<p>
Tre informazioni sono necessarie per far funzionare il comando qui sotto;
L'ID della stampante, il dispositivo di stampa, ed il driver di stampa (questo sarà hpijs
se c'è stato bisogno di installare il driver speciale in questione).
L'ID della stampante ed il driver possono essere individuati eseguendo un <c>grep</c> sul
database di foomatic, mentre il dispositivo di stampa è il nodo al quale la stampante è collegata
(ad esempio <path>file:/dev/lp0</path>, <path>file:/dev/usb/lp0</path> o per le stampanti samba
<path>smb://user:password@server/share</path>).
</p>

<p>
Prima di utilizzare <c>foomatic-configure</c>, avviare <c>cupsd</c>.
</p>

<pre caption = "Avvio di cupsd">
# <i>/etc/init.d/cupsd start</i>
</pre>

<pre caption = "Utilizzo Generico di foomatic">
<comment>(Sostituire il modello della propria stampante a $printer_model e l'ID della stessa a $printer_ID)</comment>
<comment>(Utilizzare l'output dei primi due comandi grep per completare il comando foomatic-configure)</comment>
# <i>grep $printer_model /usr/share/foomatic/db/source/printer/* </i>
# <i>grep $printer_ID /usr/share/foomatic/db/source/driver/* </i>
# <i>foomatic-configure -s cups -p $numero_modello_stampante -c file:$percorso_dispositivo_stampante -n nome_coda -d driver </i>
</pre>

<p>
Se l'utilizzo di grep non si è rivelato utile, si può cercare la propria stampante su 
<uri link="http://www.linuxprinting.org">LinuxPrinting.org</uri> e controllare quali driver
sono utilizzabili con essa. Poi scaricare uno di questi driver ed installarlo:
</p>

<pre caption="Installare un driver PPD">
<comment>(Se si hanno più stampanti utilizzare nomi di code distinti. Altrimenti sarà sufficiente
un nome di coda facile da ricordare, come ad esempio "predefinita")</comment>
# <i>foomatic-configure -s cups -p &lt;modello stampante&gt; -c file:&lt;dispositivo stampante&gt; -n &lt;nome coda&gt; -d &lt;driver&gt;</i>
</pre>

<p>
Ora facciamo un esempio più specifico. Il codice che segue assume che si stia utilizzando
una Epson Stylus Color 980, ovviamente lo si deve modificare inserendo il modello di stampante
che si sta utilizzando.
</p>

<pre caption="Utilizzo di foomatic specifico per una Stylus Color 980">
# <i>grep "Stylus Color 980" /usr/share/foomatic/db/source/printer/* </i>
<comment> Cercare la riga che riporta: </comment>
/usr/share/foomatic/db/source/printer/Epson-Stylus_Color_980.xml:   &lt;model>Stylus Color 980&lt;/model>
<comment> Epson-Stylus_Color_980 è l'ID della stampante. </comment>

# <i>grep Epson-Stylus_Color_980 /usr/share/foomatic/db/source/driver/* </i>
/usr/share/foomatic/db/source/driver/gimp-print-ijs.xml:  &lt;printer>&lt;id>printer/Epson-Stylus_Color_980&lt;/id>&lt;/printer>
<comment> Qui, il driver della stampante è gimp-print-ijs.</comment>

# <i>foomatic-configure -s cups -p Epson-Stylus_Color_980 -c file:/dev/lp0 -n Epson -d gimp-print-ijs </i>
</pre>

</body> 
</section>
</chapter> 

<chapter> 
<title>Configurazione di CUPS</title> 
<section>
<body> 

<p>
Ora che la stampante è stata configurata, si può procedere con la configurazione
di CUPS per la gestione delle code di stampa. CUPS può essere acceduto tramite un
browser web sulla porta 631 del server di stampa.
</p>

<p>
CUPS è dotato di un file di configurazione per il daemon che andrebbe modificato,
almeno per permettere una nomenclatura di tipo URI dei dispositivi. Aprire con
un editor di testo <path>/etc/cups/cupsd.conf</path> ed impostare <c>FileDevice</c> a
<c>Yes</c>:
</p>

<pre caption="Impostare FileDevice a Yes">
# <i>nano -w /etc/cups/cupsd.conf</i>
<comment>(Imposta FileDevice a Yes)</comment>
</pre>

<p>
Se si vogliono configurare i client utilizzando il nuovo server di stampa
modificare il file <path>/etc/cupsd/client.conf</path> sulla macchina client in modo
da far puntare il parametro <c>ServerName</c> al nome di rete del server di stampa.
</p>

<pre caption = "Aggiungere CUPS al runlevel di default, e riavviare CUPS">
# <i>rc-update add cupsd default</i>
# <i>/etc/init.d/cupsd restart</i>
</pre>

<p>
Il daemon di CUPS dovrebbe ora essere in esecuzione, aprire quindi il proprio browser, accedere
<uri link="http://localhost:631">qui</uri> e cliccare su <c>Manage Printer</c>.
Qui si può trovare la propria stampante appena installata, configurarla o stampare una pagina di prova.
Accertarsi di aver impostato la dimensione di pagina predefinita alla dimensione
che si utilizza (ad esempio A4 anziché Letter).
</p> 

<note>
Se la stampante non funziona per qualche motivo, andare nella directory in cui
CUPS scrive i propri file di log (indicata nel file di configurazione) e
controllare <c>error_log</c>.
</note>

</body> 
</section>
</chapter>

<chapter>
<title>Configurazione dei programmi per l'utilizzo di CUPS.</title>
<section>
<title>Generale</title>
<body>

<p>
Molti programmi oggi hanno un'interfaccia cups nativa, per questi non
c'è bisogno di modificare nulla, basta semplicemente provare a stampare dal
programma.
</p>

</body>
</section>
<section>
<title>The GIMP</title>
<body>

<p>
Per poter stampare da The Gimp è necessario (re)installare il package <c>gimp</c> con
la flag USE "gimpprint" attiva. Così facendo verrà installato <c>gimp-print</c> se non è
già presente.
</p>

<pre caption="Installazione di gimp con funzionalità di stampa">
<comment>(Accertarsi di avere USE="gimpprint" abilitata)</comment>
# <i>emerge gimp</i>
</pre>

<p>
Ora, avviare The GIMP, aprire un'immagine esistente o anche un'immagine vuota,
non fa differenza perché tutto quel che ci interessa è ottenere il suo menu <c>File</c>.
Cliccare con il destro sull'immagine ed andare in <c>File/Print</c> la finestra di dialogo
per la stampa dovrebbe comparire, quando questo avviene, cliccare su new printer.
Se la stampante non è già presente in lista, digitare il nome della propria stampante,
poi selezionare il tipo di stampante. Ok, ora The GIMP è configurato per stampare, se 
si vuole si possono modificare le varie altre impostazioni di stampa.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Utilizzare linux come server di stampa compatibile con Windows</title>

<section>
<body>

<p>
Linux è un eccellente server di stampa, o meglio, è un eccellente server per qualsiasi cosa.
La prima cosa da fare è modificare <path>/etc/samba/smb.conf</path> per adattare 
le impostazioni alle proprie esigenze. Il file <path>smb.conf</path> contiene tutte le impostazioni
che permettono di far apparire la propria macchina Linux come un server Windows NT ad ogni macchina Windows.
Qui sotto è riportato un esempio di file <path>smb.conf</path> molto utile, va modificato dove necessario
per adattarlo alla propria rete.
</p>

<pre caption = "Esempio di smb.conf">
[global]

workgroup = YOUR_WORKGROUP
server string = Gentoo Linux Server
encrypt passwords = True
security = user
smb passwd file = /etc/samba/private/smbpasswd
log file = /var/log/samba/log.%m
socket options = IPTOS_LOWDELAY TCP_NODELAY
domain master = Yes
local master = Yes
preferred master = Yes
os level = 65
dns proxy = No
name resolve order = lmhosts host bcast
bind interfaces only = True
interfaces = eth0
hosts deny = ALL
hosts allow = 192.168.1.4 127.0.0.1 (list of allow hosts here) 
debug level = 1
create mask = 0644
directory mask = 0755
level2 oplocks = True
read raw = no
write cache size = 262144

[printers]
comment = All Printer
path = /var/spool/samba
browseable = no
</pre>

<p>
Molti driver per Windows sono driver PCL. Le stampe inviate da Windows dovrebbero essere interpretate da CUPS come <c>application/octet-stream</c> ed inviate alla stampante senza alcuna modifica.
Quindi se si utilizza CUPS, aprire <path>/etc/cups/mime.types</path> e togliere il commento
alla seguente riga per renderla attiva:
</p>

<pre caption="Togliere il commento ad una riga in /etc/cups/mime.types">
application/octet-stream
</pre>

<p>
Fare la stessa cosa per la seguente riga in <path>/etc/cups/mime.convs</path>:
</p>

<pre caption="Togliere il commento ad una riga in /etc/cups/mime.convs">
application/octet-stream application/vnd.cups-raw   0 -
</pre>

<p>
Ora che Samba è configurato, riavviare samba, andare sulla macchina Windows ed
aggiungere una stampante di rete.
Facile no?
</p>

</body>
</section>
</chapter>
</guide>