<?xml version='1.0' encoding="UTF-8" ?>

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/it/altinstall.xml">
<title>Gentoo Linux: metodi di installazione alternativi HOWTO</title>

<author title="Contributor"><mail link="gerrynjr@gentoo.org">Gerald Normandin Jr.</mail></author>
<author title="Contributor"><mail link="lordviram@rebelpacket.net">Travis Tilley</mail></author>
<author title="Contributor"><mail link="volontir@yahoo.com">Oleg Raisky</mail></author>
<author title="Contributor"><mail link="luminousit@hotmail.com">Alex Garbutt</mail></author>
<author title="Contributor"><mail link="alex@openvs.com">Alexandre Georges</mail></author>
<author title="Contributor"><mail link="vargen@b0d.org">Magnus Backanda</mail></author>
<author title="Contributor"><mail link="davoid@gentoo.org">Faust A. Tanasescu</mail></author>
<author title="Contributor"><mail link="aliz@gentoo.org">Daniel Ahlberg</mail></author>
<author title="Editor"><mail link="swift@gentoo.org">Sven Vermeulen</mail></author>
<author title="Reviewer"><mail link="antifa@gentoo.org">Ken Nowack</mail></author>
<author title="Editor"><mail link="blubber@gentoo.org">Tiemo Kieft</mail></author>
<author title="Traduttore"><mail link="whitenoise@tiscali.it">Giorgio Vielmini</mail></author>
<author title="Revisore"><mail link="sogentoo@katamail.com">so</mail></author>
<abstract> Questo HOWTO vuole essere una raccolta dei metodi alternativi di installazione, per chi necessita di procedimenti di installazione particolari,per esempio quando non è disponibile un lettore cdrom o quando il sistema non può effettuare il bootstrap di un cd.</abstract>

<license/>

<version>0.36</version>
<date>11 Marzo 2004</date>
<chapter>
<title>Introduzione</title>
<section>
<body>
<p>
Se la procedura standard di installazione non è adatta per voi (o semplicemente non vi piace), qui troverete aiuto. Questo documento è una raccolta di tecniche alternative per l'installazione di Gentoo Linux a chi ne ha bisogno. O se preferite, rende disponibile un luogo dove raccogliere i vostri metodi di installazione personalizzati . Se hai ideato una metodologia di installazione cha ti si è rivelata utile, o hai scoperto una strategia di installazione divertente, non esitare a scriverne una descrizione e <mail link="whitenoise@tiscali.it"> a spedirla.</mail></p>

</body>
</section>
</chapter>


<chapter>
<title>Boot del LiveCD con Smart BootManager</title>
<section>

<body>
<p>
Effettuare il download  di Smart BootManager <uri link="http://btmgr.sourceforge.net/index.php3?body=download.html">http://btmgr.sourceforge.net/index.php3?body=download.html</uri>. Sono disponibili i sorgenti e i binari per Linux, le versioni .exe di windows e molti pacchetti di localizzazione. Al momento, il metodo preferito prevede l'impiego dei binari poichè i sorgenti non vengono compilati dalle ultime versioni di NASM.
</p>

<p>
Scaricare e compilare i sorgenti oppure limitarsi al download dei binari. Si vedrà come esistano molte opzioni che possono essere scelte nel momento in cui si crea il floppy di boot.
</p>

<pre caption="Opzioni di Smart BootManager">
<i>sbminst [-t theme] [-d drv] [-b backup_file] [-u backup_file]

   -t theme     select the theme to be used, in which the theme could be:
                   us = English theme       de = German theme 
                  hu = Hungarian theme     zh = Chinese theme 
                  ru = Russian theme       cz = Czech theme
                  es = Spanish theme       fr = French theme 
                   pt = Portuguese theme 

                 
  -d drv       set the drive that you want to install Smart BootManager on;
                for Linux:
                  /dev/fd0 is the first floppy driver, 
                  /dev/hda is the first IDE harddisk driver.
                   /dev/sda is the first SCSI harddisk driver.
                for DOS:
                   0   is the first floppy drive
                   128 is the first hard drive;

   -c             disable CD-ROM booting feature;

   -b backup_file backup the data that will be overwritten for
                  future uninstallation;

   -u backup_file uninstall Smart BootManager, should be used alone;

   -y             do not ask any question or warning.</i>
</pre>

<pre caption="Utilizzo di sbminst per la creazione del floppy di boot">
# <i>sbminst -t us  -d /dev/fd0</i>
</pre>

<note> 
Sostituire fd0 con il nome del proprio dispositivo floppy se differente. 
</note>

<p>
A questo punto è sufficiente inserire il dischetto nel lettore del computer per cui si vuole effettuare un boot con il LiveCD, inserire il LiveCD nel lettore CD-ROM ed effettuare il boot.
</p>

<p>
Verrete salutati da una finestra di Smart BootManager. Selezionare il proprio CD-ROM  e premere ENTER per effettuare il boot del LiveCD. Da questo punto in poi si può seguire la guida di installazione standard.
</p>

<p>
Ulteriori informazioni relative a Smart BootManager si trovano all'indirizzo: <uri>http://btmgr.sourceforge.net/</uri>
</p>
</body>
</section>
</chapter>

<chapter>
<title>Installazione con Knoppix</title>
<section>

<body>
<p>
Eseguire il boot con un <uri link="http://www.knoppix.org/">Knoppix</uri> LiveCD permette di avere un sistema completo disponibile durante la fase di compilazione di Gentoo. Tux Racer vi aiuterà a far passare il tempo durante l'attesa per il completamento della fase di bootstrap.
</p>

<p>
Eseguire il boot dal CD di Knoppix. Generalmente il riconoscimento automatico dell'hardware risulta ottimo. Esistono comunque alcune opzioni per la fase di boot. 
</p>

<p>
Knoppix termina la fase di boot attivando KDE 3.0. La prima cosa da fare è aprire una konsole e digitare <c>sudo passwd root</c>. In questo modo è possibile impostare la password di root di Knoppix.
</p>

<p> 
Successivamente si devono ottenere i diritti di root con su e digitare <c>usermod -d /root -m root</c>. In questo modo la home directory diventa /root (standard di Gentoo) anzichè /home/root (standard di Knoppix). Se non venisse eseguita questa operazione si otterebbero errori del tipo "/home/root: not found" (o qualcosa di simile) durante le fasi di emerge.
</p>

<p>
Digitare <c>exit</c> e quindi <c>su</c> per ritornare root nella nuova home directory. Ciò carica il cambiamento fatto con il comando usermod. Ora create il mountpoint <path>/mnt/gentoo</path> usando <c>mkdir</c>:
</p>

<pre caption="Creare il mountpoint /mnt/gentoo">
# <i>mkdir /mnt/gentoo</i>
</pre>

<p>
Da questo momento in poi si può continuare la fase di installazione facendo riferimento al punto 6 della guida di installazione standard, ad esclusione della fase di mount del filesystem proc, che deve essere eseguita in questo modo: 
</p>

<pre caption = "Bind mount del filesystem proc">
# <i>mount -o bind /proc /mnt/gentoo/proc</i>
</pre>

</body>
</section>
</chapter>



<chapter>
<title>Installazione a partire dallo Stage 1 senza accesso alla rete</title>
<section>
<body>


<p>
Masterizzare un LiveCD a partire dal file iso.
</p>

<p>
Ottenere uno snapshot di portage aggiornato da <uri>http://distro.ibiblio.org/pub/linux/distributions/gentoo/snapshots/</uri> (o dal vostro <uri link="http://www.gentoo.org/main/en/mirrors.xml">mirror</uri> preferito). E' possibile salvare il tarball sia su un CD che su una partizione esistente sul computer su cui si sta per installare Gentoo.
</p>

<p>
E' necessaria anche la lista dei pacchetti per lo stage disponibile. Copiare quindi lo script seguente (dl-list.sh) dove è stato salvato lo snapshot di portage.
</p>

<pre caption="dl-list.sh">
#!/bin/bash

# set your defaults here:
user_defs() {
 
  # portage directory (without a trailing "/"):
  portage_dir="/usr/portage"
 
  # default download mirror (without a trailing "/"):
  gentoo_mirror="http://www.ibiblio.org/pub/Linux/distributions/gentoo"
 
  # default sourceforge mirror (unc, telia, belnet):
  sourceforge_mirror="unc"
 
  # fix gnu mirror entries
  gnu_url="ftp:\/\/ftp.gnu.org\/pub\/gnu"
 
}


#------------------------------------------------------------

# function to remove temporary files
cleanup() {
 
  rm -f $temp_file_1 $temp_file_2
  exit $1
 
}

# set user defaults
user_defs

# set the complete url for the sourceforge mirror
# (the \'s are needed because this goes in a sed command)
sourceforge_mirror_complete="http:\/\/$sourceforge_mirror.dl.sourceforge.net\/sourceforge"

# initialize counters
num_files=0
num_alt_urls=0
total_size=0

# initialize lists (arrays)
declare -a def_urls_arr
declare -a alt_urls_arr

# create 2 temporary files
temp_file_1=`mktemp -t dl-list.XXXXXX` || cleanup 1
temp_file_2=`mktemp -t dl-list.XXXXXX` || cleanup 1

# run "emerge -p &lt;args&gt;" (too easy to forget the "-p" in the command line...)
emerge -p $@ &gt; $temp_file_1 || cleanup 1

# remove the lines that do not contain the word "ebuild"
sed -n -e '/ebuild/p' $temp_file_1 &gt; $temp_file_2

# count how many lines were left
num_ebuilds=`wc -l $temp_file_2 | sed -e 's/\(.*\) \(.*\)/\1/'`

# extract the useful information from those lines: category, package and version
#sed -e 's:\(.*\) \(.*\)/\(.*\)-\([0-9].*\) \(.*\) \(.*\):\2 \3 \4:' $temp_file_2 &gt; $temp_file_1
sed -e 's:\(.*\) \(.*\)/\(.*\)-\([0-9].*\):\2 \3 \4:' $temp_file_2 &gt; $temp_file_1

# display starting message :)
echo -n "Generating list " &gt;&amp;2

# process each package in turn
while read category package version rest
do
 
  # form the name of the digest file

digest_file="$portage_dir/$category/$package/files/digest-$package-$version"
 
  # process the contents of the digest file
  while read md5_flag md5_sum file_name file_size
  do
   
    # form the default url to download the file
    def_urls_arr[$num_files]="$gentoo_mirror/distfiles/$file_name"
   
    # increment the file counter
    num_files=$(($num_files + 1))
   
    # update the size accumulator (in kilobytes)
    total_size=$(($total_size + $file_size / 1024))
   
  done &lt; $digest_file

  # form the "ebuild depend" command line
  ebuild_depend_cmd="ebuild $portage_dir/$category/$package/$package-${version}.ebuild depend"

  # execute the "ebuild depend" command
  $ebuild_depend_cmd || cleanup 1

  # form the name of the dependency file
  dependency_file="/var/cache/edb/dep/$category/$package-$version"

  # read in the 4th line from the dependency file,
  # which contains the official download urls
  alt_urls=`head -n 4 $dependency_file | tail -n 1`
 
  # ignore empty url list
  if [ -n "$alt_urls" ]
  then
   
    # split the urls list into $1..$N
    set $alt_urls
   
    # process each url in turn
    for i in $@
    do
     
      # remove the (use)? strings from the url list
      alt_url_tmp=`echo "$i" | sed -e '/\?$/d'`
     
      # remove the "mirror://gnome" urls
      alt_url_tmp=`echo "$alt_url_tmp" | sed -e '/^mirror:\/\/gnome/d'`
     
      # remove the "mirror://kde" urls
      alt_url_tmp=`echo "$alt_url_tmp" | sed -e '/^mirror:\/\/kde/d'`
     
      # remove the "mirror://gentoo" urls (already included)
      alt_url_tmp=`echo "$alt_url_tmp" | sed -e '/^mirror:\/\/gentoo/d'`
     
      # translate the "mirror://sourceforge" urls into valid urls
      alt_url_tmp=`echo "$alt_url_tmp" | sed -e "s/mirror:\/\/sourceforge/$sourceforge_mirror_complete/"`

      # translate the "mirror://gnu" urls into valid urls
      alt_url_tmp=`echo "$alt_url_tmp" | sed -e "s/mirror:\/\/gnu/$gnu_url/"`
      # ignore empty urls
      if [ -n "$alt_url_tmp" ]
      then
       
        # add the url to the list
        alt_urls_arr[$num_alt_urls]=$alt_url_tmp
       
        # increment the alternate url counter
        num_alt_urls=$(($num_alt_urls + 1))
       
      fi
     
    done
   
  fi

  # a progress bar :)
  echo -n "." &gt;&amp;2

done &lt; $temp_file_1

# display ending message :)
echo " done." &gt;&amp;2

# display default urls list
for i in ${def_urls_arr[@]}; do echo $i; done | sort

# display alternate urls list
for i in ${alt_urls_arr[@]}; do echo $i; done | sort

# display totals
echo "Totals:" $num_ebuilds "ebuilds," $num_files "files," $num_files "default urls," \n
$num_alt_urls "alternate urls," "${total_size}Kb." &lt;&amp;2

# remove temporary files and exit
cleanup 0
</pre>

<p>
Seguire le istruzioni della guida di installazione fino al punto 8 in cui si richiede <c>chroot /mnt/gentoo</c>. Se si sta utilizzando un CD-ROM ricordarsi di usare l'opzione <c>cdcache</c> durante il boot per poter smontare il LiveCD e montare il CD contenente lo snapshot di Portage.
</p>

<p>
Aprire una nuova console (Alt-F2), e continuare con l'installazione tradizionale eseguendo lo script the bootstrap.sh.
</p>

<warn>
Le versioni meno recenti di livecd richiedono di cambiare la password con <c>passwd</c>, prima di effettuare manualmente il login.
</warn>
				   
<p>
Ritornare alla prima console (Alt-F1, senza chroot) e montare il secondo CD su <path>/mnt/gentoo/mnt/cdrom2</path>. Copiare il tarball di portage da cdrom2 e scompattarlo in <path>/mnt/gentoo/usr/portage</path>. Copiare anche lo script dl-list.sh in <path>/usr/sbin</path> e renderlo eseguibile.
</p>

<pre caption="Mount the snapshot cd">
# <i>umount /mnt/cdrom</i>
# <i>mkdir /mnt/gentoo/mnt/cdrom2</i>
# <i>mount /dev/cdroms/cdrom0 /mnt/gentoo/mnt/cdrom2</i>
# <i>cp /mnt/gentoo/mnt/cdrom2/portage-$date.tar.bz2 /mnt/gentoo/usr/portage</i>
# <i>cp /mnt/gentoo/mnt/cdrom2/dl-list.sh /mnt/gentoo/usr/sbin</i>
# <i>cd /mnt/gentoo/usr/portage</i>
# <i>tar xvjpf portage-$date.tar.bz2</i>
# <i>chmod +x /mnt/gentoo/usr/sbin/dl-list.sh</i>
</pre>

<p>
Ritornare alla seconda console (F2). Se si tenta adesso di eseguire bootstrap.sh si verificheranno degli errori perchè non si è in grado di effettuare il download di nessun file. Bisogna ottenere i files necessari da qualche altra parte e copiarli in /usr/portage/distfiles (sulla console F2). 
</p>

<p>
E' indispensabile almeno una serie di pacchetti dello Stage1: glibc, baselayout, texinfo, gettext, zlib, binutils, gcc, ncurses e le loro dipendenze.
</p>

<note>
Sono necessarie le versioni di ciascun pacchetto sincronizzate con il database di portage.
</note>

<p>
Utilizzare lo script dl-list.sh per generare la lista dei pacchetti necessari. Copiare la lista ottenuta su un floppy.
</p>

<pre caption="Utilizzo di dl-list.sh">
# <i>dl-list.sh glibc baselayout texinfo gettext zlib binutils gcc ncurses > stage1.list</i>
# <i>mount -t vfat /dev/fd0 /mnt/floppy</i>
# <i>cp /mnt/gentoo/stage1.list /mnt/floppy</i>
# <i>umount /mnt/floppy</i>
</pre>

<p>
Portare il floppy sul computer che ha un accesso alla rete veloce e ottenere quanto necessario con wget:
</p>

<pre caption="Utilizzo di wget per ottenere i sorgenti">
# <i>wget -N -i stage1.list</i>
</pre>


<p>
Una volta ottenuti i file portarli sul computer e copiarli in <path>/mnt/gentoo/usr/portage/distfiles</path>. A questo punto si può eseguire <c>bootstrap.sh</c>. Ripetere quanto detto per gli stage 2 e 3.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installazione diskless usando il PXE boot</title>

<section>
<title>Requisiti</title>
<body>
<p>
Avrete bisogno di una scheda di rete sul client senza disco che usa il protocollo PXE al boot, come molte schede 3com. Avrete anche bisogno di un BIOS che supporta il boot dal PXE.
</p>
</body>
</section>

<section>
<title>Setup del server base</title>
<body>
<p>
Creare le directory: La prima cosa da fare è creare le directory in cui il vostro sistema diskless sarà messo. Create una directory chiamata <path>/diskless</path> che ospita una directory per ogni client diskless. Nella continuazione di questo howto lavoreremo sul client 'eta'. 
</p>

<pre caption="setup della directory">
# <i>mkdir /diskless</i>
# <i>mkdir /diskless/eta</i>
# <i>mkdir /diskless/eta/boot</i>
</pre>

<p>
Setup di DHCP e di TFTP: Il client otterrà informazioni di boot usando DHCP e scaricherà tutti i file richiesti usando TFTP. Emergete DHCP e configuratelo per le vostre necessità di base. Poi, aggiungete le seguenti righe in <path>/etc/dhcp/dhcpd.conf</path>.
</p>

<note>
Ciò fornisce un indirizzo IP statico per il client e il percorso dell'immagine di PXE boot, qui pxegrub. Dovete rimettere l'indirizzo MAC della scheda Ethernet del client e la directory dove metterete i file del client con quella che usate.
</note>

<pre caption="dhcp.conf">
option option-150 code 150 = text ;
host eta {
hardware ethernet 00:00:00:00:00:00;
fixed-address <c>ip.add.re.ss</c>;
option option-150 "/eta/boot/grub.lst";
filename "/eta/boot/pxegrub";
}
</pre>

<p>
Per TFTP, emergete <c>app-admin/tftp-hpa</c>. In <path>/etc/conf.d/in.tftpd</path>, mettete le seguenti righe :
</p>

<pre caption="in.tftpd">
INTFTPD_PATH="/diskless"
INTFTPD_USER="nobody"
INTFTPD_OPTS="-u ${INTFTPD_USER} -l -vvvvvv -p -c -s ${INTFTPD_PATH}"
</pre>

<p>
Setup di GRUB: Per fornire il PXE boot usiamo GRUB. Dovete compilarlo per abilitare la compilazione dell'immagine di PXE ... ma è abbastanza facile. Primo, prendete l'ultima versione del codice sorgente di GRUB (<c>emerge -f grub</c> posizionerà il tarball in <path>/usr/portage/distfiles</path>). Copiate il tarball in <path>/diskless</path> e poi compilatelo per ottenere il binario pxe. Una volta fatto, copiatelo nella directory di boot del client diskless. Poi editate il suo file di configurazione grub.lst.
</p>

<pre caption="setup di grub">
# <i>tar zxvf grub-0.92.tar.gz</i>
# <i>cd grub-0.92</i>
# <i>./configure --help</i>
<codenote>Nelle opzioni vedrete un elenco di drivers supportati di interfacce di rete. </codenote>
<codenote>Selezionate il driver compatibile con la vostra scheda. Qui è chiamato $nic</codenote>
# <i>./configure --enable-diskless --enable-$nic</i>
# <i>make</i>
# <i>cd stage2</i>
# <i>cp pxegrub /diskless/eta/boot/pxegrub</i>
# <i>nano -w /diskless/eta/boot/grub.lst</i>
</pre>

<pre caption="grub.lst">
default 0
timeout 30

title=Diskless Gentoo
root (nd)
kernel /eta/bzImage ip=dhcp root=/dev/nfs nfsroot=<c>ip.add.re.ss</c>:/diskless/eta

<codenote>Per l'opzione nfsroot, l'indirizzo IP è quello del server e </codenote>
<codenote>la directory è quella dove sono messi i file del vostro client diskless (sul server).</codenote>
</pre>

<p>
Setup di NFS: NFS è abbastanza facile da configurare. La sola cosa che dovete fare è aggiungere una riga nel file di configurazione <path>/etc/exports</path> :
</p>

<pre caption="/etc/exports">
# <i>nano -w /etc/exports</i>
NFS file systems being exported. See exports(5).
/diskless/eta eta(rw,sync,no_root_squash)
</pre>

<p>
Aggiornate i vostri host: Un'importante cosa da fare adesso è modificare il vostro file <path>/etc/hosts</path> secondo le vostre necessità. 
</p>

<pre caption="/etc/hosts">
127.0.0.1 localhost

192.168.1.10 eta.example.com eta
192.168.1.20 sigma.example.com sigma
</pre>
</body>
</section>

<section>
<title>Creare il sistema sul server</title>

<body>

<p>
Fate il reboot del server con un LiveCD di Gentoo. Seguite la procedura standard di installazione come spiegato nel Gentoo Install Howto MA con le seguenti differenze. Quando montate il filesystem, fate come nel seguente modo (dove hdaX è la partizione in cui avete creato la directory /diskless). Non avete bisogno di montare altre partizioni poichè tutti i file risiederanno nella directory <path>/diskless/eta</path>.
</p>

<pre caption="montare il filesystem">
#<i> mount /dev/hda3 /mnt/gentoo</i>
</pre>

<p>
I tarball dello stage e chroot: In questo esempio usiamo un tarball dello stage3. Montate <path>/proc</path> nella vostra directory diskless e effettuate chroot per continuare l'installazione. Seguite il manuale di installazione fino alla configurazione del kernel.
</p>

<warn>
Dovete stare molto attenti a dove estraete il vostro tarball dello stage. Non dovete far finire l'estrazione sopra la vostra installazione esistente.
</warn>

<pre caption="estrarre il tarball dello stage">
# <i>cd /mnt/gentoo/diskless/eta/</i>
# <i>tar -xvjpf  /mnt/cdrom/gentoo/stage3-*.tar.bz2</i>
# <i>mount -t proc /proc /mnt/gentoo/diskless/eta/proc</i>
# <i>cp /etc/resolv.conf /mnt/gentoo/diskless/eta/etc/resolv.conf</i>
# <i>chroot /mnt/gentoo/diskless/eta/ /bin/bash</i>
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

<p>
Configurazione del kernel: Quando fate il <c>make menuconfig</c> della vostra configurazione del kernel, non dimenticatevi di abilitare le seguenti opzioni insieme alle altre presenti nell'install howto.
</p>

<pre caption="opzioni del menuconfig">
- Your network card device support

- Under "Networking options" :

[*] TCP/IP networking
[*] IP: kernel level autoconfiguration
[*] IP: DHCP support
[*] IP: BOOTP support


- Under "File systems --> Network File Systems" :

&lt;*&gt; NFS file system support
[*] Provide NFSv3 client support
[*] Root file system on NFS
</pre>

<p>
Poi configurate <path>/etc/fstab</path> del vostro client diskless.
</p>

<pre caption="/etc/fstab">
# <i>nano -w /etc/fstab</i>
/dev/cdroms/cdrom0 /mnt/cdrom iso9660 noauto,ro 0 0
proc /proc proc defaults 0 0
tmpfs /dev/shm tmpfs defaults 0 0
</pre>

<p>
Bootloader. Non installate un altro bootloader perchè già ce lo abbiamo - pxegrub. Semplicemente finite l'installazione e restartate il server. Startate i servizi di cui avrete bisogno al boot del nuovo client: DHCP, TFTPD, e NFS.
</p>

<pre caption="Far partire i servizi">
# <i>/etc/init.d/dhcp start</i>
# <i>/etc/init.d/tftpd start</i>
# <i>/etc/init.d/nfs start</i>
</pre>

</body>
</section>

<section>
<title>Boot del nuovo client</title>
<body>
<p>
Per fare in modo che il nuovo client si avvii correttamente, sarà necessario configurare il bios e la scheda di rete per usare PXE al primo boot - prima del CD-ROM o del floppy. Per aiutarvi consultate i manuali o i siti dei fornitori del vostro hardware. La scheda di rete dovrebbe avere un indirizzo IP usando DHCP e scaricate l'immagine PXE per GRUB usando TFTP. Dovreste vedere un carino bootmenu bianco e nero di GRUB in cui selezionerete il kernel da avviare e premete Enter. Se tutto è ok il kernel si dovrebbe avviare, montate il filesystem root usando NFS e avrete un prompt di login. Buon divertimento.
</p>
</body>
</section>

</chapter>
<chapter>
<title>Installazione di Gentoo a partire da una distribuzione Linux esistente </title>
<section>
<title> Requisiti </title>
<body>
<p>
Per poter installare Gentoo a partire da una distribuzione Linux esistente è necessario avere installato chroot e disporre di una copia dei tarball di installazione o le ISO che si desidera installare. E' consigliabile un collegamento di rete se volete aggiungere funzionalità non incluse nei tarball di installazione. (Per inciso, un tarball è un file con estensione .tbz o .tar.gz). L'autore ha utilizzato RedHat Linux 7.3 come sistema operativo "host", ma non è importante. Si parte!
</p>
</body>
</section>

<section>
<title> Panoramica </title>
<body>
<p>
Per prima cosa verrà creata una partizione dedicata a Gentoo modificando la dimensione della partizione Linux esistente, monteremo tale partizione, monteremo un tarball e lo decomprimeremo,  effettueremo un chroot all'interno del nostro nuovo sistema e ne inizieremo la costruzione. Una volta terminato il processo di boot, effettueremo le ultime fasi di configurazione del sistema per accertarsi che sia in grado di effettuare il boot, e saremo quindi pronti per un reboot ed il successivo utilizzo di Gentoo.
</p>
</body>
</section>

<section>
<title> Come ottenere spazio per Gentoo? </title>
<body>
<p>
La partizione root è la porzione di filesystem montata come <path>/</path>. Un'esecuzione del comando mount sulla macchina mostra di cosa stiamo parlando. Possiamo usare il comando df (disk free) per controllare quanto spazio abbiamo a disposizione e, di conseguenza, decidere di quanto debbano essere ridimensionate le partizioni esistenti. Non è indispensabile ridimensionare la partizione di root! Possiamo ridimensionare qualunque altra partizione supportata dal programma che andremo ad utilizzare per questo scopo, ma ne parleremo più avanti.
</p>

<pre caption="Informazioni sul filesystem">
# <i>mount</i>
/dev/hdb2 on / type ext3 (rw) 
none on /proc type proc (rw) 
none on /dev/pts type devpts (rw,gid=5,mode=620) 
none on /dev/shm type tmpfs (rw) 
# <i>df -h </i>
Filesystem           Size Used Avail Use% Mounted on 
/dev/hdb2            4.0G 1.9G  2.4G  82% /
none		      38M    0    38M   0% /dev/shm 
</pre>

<p>
Come possiamo vedere, la partizione montata come <path>/</path> si chiama <path>/dev/hdb2</path> e ha 2.4 gigabytes di spazio libero. In questo caso si potrebbe ridimensionare questa partizione lasciando 400Mb di spazio libero e creando una partizione per Gentoo di 2 gigabyte. Non c'è male, in questo modo è disponibile una buona quantità di spazio per le nostre applicazioni. In ogni modo, un gigabyte è più che sufficiente per la maggior parte degli utenti. 
</p>
</body>
</section>

<section>
<title> Preparazione di parted per il ridimensionamento delle partizioni </title>
<body>

<p>
Parted  è un'utility fornita dalla fondazione GNU, un vecchio e grande progetto che ha creato il software che stai utilizzando in questo momento. Esiste un tool che ci è estremamente utile in questa situazione. Si chiama parted (partition editor, editor delle partizioni) e lo si può ottenere da <uri>http://www.gnu.org/software/parted/</uri>
</p>

<note> 
Esistono altri tool che permettono di ridimensionare le partizioni, ma l'autore non è certo e non ha interesse ad accertarsi che  PartitionMagic(tm) o altri software di questo tipo ne siano in grado. E' un compito del lettore verificarlo.  
</note>

<p> 
Ricontrolla su questa pagina che il tipo di filesystem che vuoi ridimensionare sia supportato. Se non lo è, sei sfortunato, e dovrai distruggere alcune partizioni per far spazio a Gentoo. Scarica il sofware e effettua l'installazione. Ora però abbiamo un problema. Vogliamo ridimensionare la nostra partizione di root di Linux, quindi dobbiamo fare il boot con un disco floppy che contiene un sistema linux minimo e utilizzare una copia precompilata di parted precedentemente copiata sul dischetto, per poter ridimensionare <path>/</path>. Comunque, se si può smontare la partizione mentre si è ancora all'interno di Linux si è fortunati, e si può evitare la fase successiva. E' sufficiente compilare parted ed eseguirlo sulla partizione (non montata) che si vuole ridimensionare. Ecco come ho agito sul mio sistema.
</p>

<impo>  
Accertatevi che le operazioni che volete eseguire sulla vostra partizione siano supportate da parted! 
</impo>

<p> 
Scaricate tomsrtbt, un disco di boot/root (gratuito) da <uri>http://freshmeat.net/tomsrtbt </uri>, create un floppy come indicato nella Documentazione che accompagna il pacchetto e preparate un nuovo dischetto per la prossima fase dell'installazione.
</p>

<note>  
Notate come ancora una volta Linux sia sinonimo di "C'e più di un modo per farlo". Il vostro scopo era di eseguire parted su una partizione non montata. Potete usare altri dischetti di boot/root oltre a tomsrtbt. Potreste anche non dover effettuare questa parte dell'installazione, smontando il filesystem che volete ridimensionare e utilizzando parted per i vostri scopi.
</note>

<pre caption="Creazione del dischetto di utility">
# <i>mkfs.minix /dev/fd0</i>
480 inodes
1440 blocks
Firstdatazone=19 (19)
Zonesize=1024
Maxsize=268966912
</pre>

<p>
La fase successiva consiste nella compilazione di parted. Se non lo avete ancora scaricato e decompresso, fatelo ora e spostatevi nella directory corrispondente. Ora eseguite questa serie di comandi per compilare il pacchetto e copiarlo sul floppy.
</p>

<pre caption="Fase di build del dischetto di utility">
# <i> mkdir /floppy; mount -t minix /dev/fd0 /floppy &amp;&amp; 
export CFLAGS="-O3 -pipe -fomit-frame-pointer -static" &amp;&amp; ./configure 
&amp;&amp; make &amp;&amp; cp parted/parted /floppy &amp;&amp; umount /floppy </i>
</pre>

<p>
Congratulazioni, siete pronti per il reboot e il ridimensionamento della vostra partizione. Fatelo solo dopo aver letto velocemente la documentazione sul sito GNU. Il ridimensionamento può richiedere fino a 30 minuti per i dischi rigidi più grandi. Effettuate il reboot del sistema con il disco di boot tomsrtbt (basta inserirlo nel lettore),  e una volta effettuato il login, sostituite il disco nel lettore con il disco di utilità che avete appena creato e montatelo con il comando mount /dev/fd0 /floppy per avere parted all'interno di /floppy. Spostatevi all'interno di floppy e una volta lanciato parted potrete ridimensionare le partizioni. Una volta terminato questo lento processo, sarete pronti per installare Gentoo. Effettuate un reboot e utilizzate la precedente installazione di Linux. Dovrete operare sul disco che contiene la partizione da ridimensionare. Per esempio, se volete ridimensionare /dev/hda3, dovrete lavorare sull'unità /dev/hda
</p>

<pre caption="Comandi da eseguire una volta effettuato il login all'interno del sistema tomsrtbt">
# <i>mount /dev/fd0 /floppy </i>
# <i>cd /floppy; ./parted [drive su cui volete operare]</i>
(parted) <i> print </i>
Disk geometry for /dev/hdb: 0.000-9787.148 megabytes
Disk label type: msdos
Minor    Start       End     Type      Filesystem  Flags
1          0.031   2953.125  primary   ntfs        
3       2953.125   3133.265  primary   linux-swap  
2       3133.266   5633.085  primary   ext3        
4       5633.086   9787.148  extended              
5       5633.117   6633.210  logical               
6       6633.242   9787.148  logical   ext3        
(parted) <i> help resize </i>
  resize MINOR START END        resize filesystem on partition MINOR

        MINOR is the partition number used by Linux.  On msdos disk labels, the
        primary partitions number from 1-4, and logical partitions are 5
        onwards.
        START and END are in megabytes
(parted) <i> resize 2 3133.266 4000.000 </i>
</pre>

<impo> 
Siate pazienti! Il computer sta lavorando! Controllate i LED del vostro case per accertarvi che il computer stia realmente lavorando. Questa fase può richiedere da 2 a 30 minuti. 
</impo>

<p>
Una volta terminato il procedimento ritornate alla precedente installazione di linux come descritto. Dopodichè consultate <uri link="/doc/it/handbook/handbook.xml?part=1&amp;chap=5">Manuale Gentoo: Copia dei file di installazione di Gentoo</uri> e seguite le istruzioni. Quando effettuate il chroot, usate il seguente comando per svuotare il vostro ambiente:
</p>

<pre caption = "Svuotare l'ambiente durante il chroot">
# <i>env -i chroot /mnt/gentoo /bin/bash</i>
</pre>

<p>
Buon divertimento!
</p>
</body>
</section>
</chapter>
</guide>
