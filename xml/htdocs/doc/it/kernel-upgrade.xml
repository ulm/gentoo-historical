<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/kernel-upgrade.xml,v 1.1 2005/01/30 20:38:20 mush Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="kernel-upgrade.xml" lang="it">

<title>Guida all'aggiornamento del kernel</title>

<author title="Autore">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>

<author title="Traduzione">
	<mail link="toro2k@quipo.it">Andrea Torelli</mail>
</author>


<abstract>
Questa guida illustra il processo di aggiornamento da una versione del kernel a un'altra.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>0.1.1</version>
<date>6 Dicembre 2004</date>

<chapter>
<title>Introduzione</title>
<section>
<body>

<p>
Il kernel é uno dei pochi tipi di pacchetto presenti in Portage che richiede un intervento manuale per completare l'installazione. Portage si occupa di scaricare e installare i sorgenti del kernel, ma é compito dell'utente compilare e installare il nuovo kernel prima che qualsiasi cambiamento abbia effetto sul sistema.
</p>

<p>
Nonostante questa guida sia indirizzata a chi aggiorna il kernel da una versione a una successiva, potrebbe anche essere utile a chi ha intenzione di migrare da un pacchetto del kernel a un altro.
</p>

<p>
Nella guida viene usato come esempio <c>gentoo-dev-sources</c>, comunque le istruzioni qui riportate sono applicabile a qualsiasi altro pacchetto del kernel.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Perché aggiornare il kernel?</title>
<section>
<body>

<p>
Generalmente aggiornare il kernel da una release minore a una successiva non comporta nessun grosso cambiamento. Le ragioni per aggiornare il kernel sono l'introduzione di una nuova caratteristica o di un driver che si intendono sfruttare, la correzzione di un bug che porta a una falla nella sicurezza o semplicemente per mantenere il proprio sistema aggiornato.
</p>

<p>
Non è necessario aggiornare il kernel a ogni versione rilasciata, nonostante ciò si raccomanda di aggiornarlo di tanto in tanto. Si raccomanda calorosamente di aggiornare immediatamente il kernel se la nuova versione risolve qualche problema legato alla sicurezza.
</p>


</body>
</section>
</chapter>

<chapter>
<title>Ottenere i nuovi sorgenti con Portage</title>
<section>
<body>

<p>
Per aggiornare i sorgenti del kernel bisogna utilizzare, come per ogni altro pacchetto, il programma <c>emerge</c>. Per esempio:
</p>

<pre caption="Un nuovo kernel nella lista degli aggiornamenti">
# <i>emerge -Dup world</i>
Calculating dependencies ...done!
[ebuild     U ] sys-kernel/gentoo-dev-sources-2.6.9-r2 [2.6.8-r5]
</pre>

<p>
Succesivamente si procede con l'installazione dell'aggiornamento. Per esempio:
</p>

<pre caption="Aggiornare i sorgenti del kernel">
# <i>emerge -u gentoo-dev-sources</i>
</pre>

<p>
I nuovi sorgenti del kernel verranno installati in una in una directory in <path>/usr/src</path>. Nell'esempio di cui sopra i sorgenti verrano installati nella directory <path>/usr/src/linux-2.6.9-gentoo-r2</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aggiornare il link simbolico /usr/src/linux</title>
<section>
<body>

<p>
Gentoo richiede la presenza del link simbolico <path>/usr/src/linux</path>, il quale dovrebbe puntare alla directory contenente i sorgenti del kernel che é in esecuzione.
</p>

<p>
Nel nostro caso é necessario aggiornare il link in modo che punti alla directory contenente i sorgenti appena installati.
</p>

<pre caption="Aggiornare il link simbolico /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>

</body>
</section>
</chapter>

<chapter id="install">
<title>Configurare, compilare e installare il nuovo kernel</title>
<section>
<body>

<p>
Per ognuna delle opzioni seguenti si dovrebbe fare riferimento alle sezioni <c>Configurazione del kernel</c> e <c>Configurazione del bootloader</c> del <uri link="http://www.gentoo.org/doc/it/handbook/index.xml">Manuale Gentoo</uri>. Di seguito viene fatto un breve riassunto.
</p>

</body>
</section>
<section>
<title>Opzione 1: Configurazione automatica del kernel usando Genkernel</title>
<body>

<p>
Se si utilizza genkernel per installare il kernel, é sufficiente ripetere la procedura effettuata per installare il kernel la prima volta.
</p>

<p>
Basta semplicemente lanciare genkernel:
</p>

<pre caption="Lanciare genkernel">
# <i>genkernel all</i>
</pre>

<p>
Si possono anche usare altri parametri per attivare altre funzionalitá di genekernel. Per esempio se si vogliono configurare altre opzioni del kernel usando <c>menuconfig</c> e se si vuole che genkernel aggiorni automaticamente la configurazione di grub, si deve lanciare genekernel con le seguenti opzioni
</p>

<pre caption="Lanciare genkernel con alcuni comuni parametri" >
# <i>genkernel --menuconfig --bootloader=grub all</i>
</pre>

<p>
Per ulteriori informazioni fare riferimento alla <uri link="http://www.gentoo.org/doc/it/genkernel.xml">Gentoo Linux Genkernel Guide</uri> o al <uri link="http://www.gentoo.org/doc/it/handbook/index.xml">Manuale Gentoo</uri>.
</p>

</body>
</section>
<section>
<title>Opzione 2: Configurazione manuale</title>
<body>

<p>
Per cominciare bisogna lanciare l'utility <c>menuconfig</c>:
</p>

<pre caption="Lanciare menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Si selezionano le opzioni richieste dal proprio hardware e dal proprio ambiente operativo. Fare riferimento al <uri link="http://www.gentoo.org/doc/it/handbook/index.xml">Manuale Gentoo</uri> per ulteriori informazioni
</p>

<p>
Successivamente il kernel va compilato e installato nella propria partizione di boot. Nuovamente si consiglia di seguire le istruzioni riportate ne manuale. Non bisogna dimenticarsi di montare prima la partizione <path>/boot</path>!
</p>

<pre caption="Compilare e installare il nuovo kernel">
# <i>make &amp;&amp; make modules_install</i>
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Ora é necessario aggiornare la configurazione del bootlader, aggiungendo le informazioni riguardanti il nuovo kernel (per il momento non rimuore ancora le informazioni riguardanti il vecchio kernel!) e smontare la partizione <path>/boot</path>. </p>

</body>
</section>
</chapter>

<chapter>
<title>Reinstallazione di moduli esterni</title>
<section>
<body>

<p>
Se si stanno usando moduli del kernel che non sono inclusi nei sorgenti ufficiali (Es. i driver grafici per Nvidia o ATI), questi vanno reinstallati dopo ogni aggiornamento del kernel. E' sufficiente ri-emergere il pacchetto interessato. Si consiglia di consultare la sezione <e>Configurazione del kernel</e> del <uri link="http://www.gentoo.org/doc/it/handbook/index.xml">Manuale Gentoo</uri> per avere maggiori informazioni. La reinstallazione di questi pacchetti assicura che vengano compilati usando i sorgenti del kernel presenti in <path>/usr/src/linux</path> e che i moduli vengano installati 
correttamente per il kernel in uso.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Riavviare con il nuovo kernel</title>
<section>
<body>

<p>
Ora si devono chiudere tutte le applicazioni aperte e riavviare il sistema. Se sono state seguite correttamente tutte le istruzioni precedenti, nel menú del bootloader sará presente la voce relativa al nuovo kernel. Selezionare il nuovo kernel e aspettare che il sistema si avvii.
</p>

<p>
Se é stato fatto tutto correttamente e non ci sono stati problemi il sistema dovrebbe ripartire normalmente. Se tutto funziona come dovrebbe, l'aggiornamento fino a questo punto ha avuto successo.
</p>
 
<p>
Se si dovvessero essere commessi degli errori e il sistema non dovesse avviarsi con il nuovo kernel, basta semplicemente riavviare il sistema usando il vecchio kernel funzionante. A questo punto è necessario ripartire dalla sezione <uri link="#install">Configurare, compilare e installare il nuovo kernel</uri> di questa guida, facendo gli opportuni cambiamenti per correggere gli errori effettuati precedentemente. In alcuni casi ( per esempio se si è dimenticato di configurare i driver di una scheda di rete) non è necessario riavviare il sistema per correggere gli errori.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Usare piú di un kernel</title>
<section>
<body>

<p>
Si sarà notato che quando vengono installati dei nuovi sorgenti del kernel queli vecchi non vengono rimossi. Questo fatto è voluto e consente di avviare il sistema usando kernel diversi.
</p>

<p>
Per poter passare da un kernel a un altro è sufficiente lasciare l'albero dei sorgenti in <path>/usr/src/</path> e il file binario <path>bzImage</path> nella partizione <path>/boot</path>, con il rispettivo riferiemento all'interno del file di configurazione del bootloader. Ogni volta che si avvia il sistema si potrà scegliere dal menù del bootloader quale kernel avviare.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Rimuovere vecchi kernel</title>
<section>
<body>

<p>
Per rimuovere facilmente tutti i sorgenti di vecchi kernel si può usare l'opzione <e>prune</e> di <c>emerge</c>. Continuando con l'esempio di gentoo-dev-sources:
</p>

<pre caption="Rimuovere vecchie versioni">
# <i>emerge -P gentoo-dev-sources</i>
</pre>

<p>
Nella maggior parte dei casi i file temporanei usati durante la compilazione del kernel rimarranno nella directory appropriata all'interno della directory <path>/usr/src</path>. Si consiglia di rimuoverli utilizzando il comando <c>rm</c>.
</p>

<p>
Si possono anche eliminare i moduli usati dai vecchi kernel. Per farlo bisogna cancellare la directory relativa alla versione del kernel che si sta rimuovendo da <path>/lib/modules/</path>. Si raccomanda di prestare attenzione a non rimuovere i moduli del kernel attualmente in uso!
</p>

<p>
Ora si può montare la partizione <path>/boot</path> e rimuovere i file <path>bzImage</path> e <path>System.map</path> del kernel che si sta eliminando. E' anche possibile modificare il file di configurazione del bootloader in modo che non faccia più riferimento al kernel appena eliminato.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Problemi dopo l'aggiornamento del kernel?</title>
<section>
<body>

<p>
Il rapido sviluppo di Linux rende inevitabile che con i cambiamenti tra una versione e l'altra possano nascere dei problemi. Se si dovessero avere dei problemi aggiornando il kernel si consiglia di fare riferimento all'ultima versione dei <uri link="http://www.gentoo.org/doc/it/gentoo-kernel.xml#doc_chap2">Pacchetti di kernel disponibili</uri> e poi rendere noto il problema agli sviluppatori di Gentoo.
</p>

</body>
</section>
</chapter>

</guide>

