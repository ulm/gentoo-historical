<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/it/guide-to-mutt.xml" lang="it">
<title>Guida rapida all'uso di Mutt</title>
<author title="Autore"><mail link="mikpolniak@adelphia.net">Mike Polniak</mail></author>
<author title="Redazione"><mail link="antifa@gentoo.org">Ken Nowack</mail></author>
<author title="Contributi"><mail link="hitch17@gmail.com">John Hitchings</mail></author>
<author title="Traduzione">Corrado 'Fizban' Ignoti</author>
<author title="Traduzione">Team Italiano</author>
<author title="Revisione"><mail link="posta@massimo.biz">Massimo Canali</mail></author>

<abstract>Questa guida mostra come iniziare ad usare gli strumenti per la
consultazione delle email quali fetchmail, procmail, mutt, and nbsmtp.
</abstract>

<license/>

<version>1.3</version>
<date>2004-12-26</date>

<chapter>
<title>Introduzione all'E-Mail</title>
<section>
<body>

<p>Se non siete fan dei client e-mail con interfacce grafiche elaborate, o se
volete soltanto provare un altro client di posta elettronica prima di decidere
qual'è il migliore per voi, ecco il modo per iniziare ad utilizzare questi potenti
strumenti a linea di comando:
</p>

<p><b>fetchmail->procmail->mutt->smtp</b></p>

<p>Questi programmi non sono solo potenti e altamente personalizzabili, ma sono
anche piccoli ed efficenti. Una volta che li avrete configurati sarete sbalorditi
da quello che potrete farci.
</p>

<p>
Dato che questa è una guida veloce, elimineremo l'uso dei "Mail Transfer Agent
(MTA)" quali sendmail, postfix o exim. Questo significa evitare complesse
configurazione degli MTA. Questa scelta elimina, inoltre, l'uso della porta 25
per i servizi legati all'email
</p>

<p>Possiamo fare tutto questo perché fetchmail può ridirigere la mail che recupera
direttamente al "Mail Delivery Agent (MDA)", invece di mandarla alla porta 25.
Non è, nemmeno, necessario utilizzare un MTA per la spedizione della posta
elettronica verso INTERNET.
</p>

<p>
Questi sono i programmi che dovrete utilizzare per avere il sistema di posta
elettronica funzionante.
</p>

<pre>
# <i>emerge fetchmail procmail mutt nbsmtp</i>
</pre> 

<p>
E adesso qualche configurazione e alla fine avrete funzionante un nuovo sistema 
per l'invio e la ricezione della posta elettronica.
</p>

<impo>
Dopo ogni configurazione potete fare un test per essere sicuri che la 
configurazione fatta sia corretta.
</impo>

</body>
</section>
</chapter>
<chapter>
<title>Fetchmail</title>  
<section>
<body>

<p>
Fetchmail prende la mail dai server remoti e la redirige al local delivery system
installato sulla macchina. Per utilizzarlo è necessario configurare un file 
<path>.fetchmailrc</path> posizionato nella propria home direcotory, come in questo
esempio:
</p>

<pre caption="Esempio di file .fetchmailrc">
<i>poll mail.myisp.net  protocol pop3 user "myname" password "mypasswd"</i> 
</pre>

<p>
Una volta creato il file <path>.fetchmail.rc</path>, dovrete cambiare i permessi
sul file utilizzando il comando chmod. Questo file deve essere leggibile solo dal
prorpietario del file stesso. Impostate i permessi utilizzando il seguente
comando:
</p>

<pre>
# <i>chmod 710 .fetchmailrc</i>
</pre>

<p>
Per vedere fetchmail in azione, usate la modalità "verbose". Per scaricare tutti i 
messaggi utilizzate l'opzione -a. Dovete utilizzare l'opzione -m per dire a
fetchmail di mandare la mail al procmail
</p>

<warn>
Mentre siete nella fase di test, è una buona idea dire a fetchmail di mantenere
tutta la mail sul server remoto (attraverso l'opzione -k), nel caso qualcosa vada 
storto, potrete recuperare nuovamente la mail.
</warn> 

<p>Ora lanciate fetchmail per vederlo in azione!</p>

<pre caption="Fetchmail test #1">
# <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i> 
</pre>

<p>
Una volta che il vostro sistema è funzionante, potete inserire il comando
nel cron o metterlo in un monitor come gkrellm. Fetchmail, può anche funzionare
come un demone, specificando un intervallo di tempo (in secondi) per il controllo
della posta.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Procmail</title>
<section>  
<body>

<p>
Procmail è il processore che filtra le email che gli vengono redeirette da
fetchmail. Esegue la funzionalità di MDA per consegnare la mail alle vostre
mailbox, dalle quali mutt (il vostro client di posta elettronica) le potrà leggere.
</p>

<p>
Per utilizzare procmail, è necessario creare un file <path>.procmailrc</path>
nella vostra home directory. Per la nostra guida "veloce" ne utilizzeremo uno
molto semplice che filtrerà la posta proveniente da tre mailing list di gentoo e
ne metterà le email in tre mailbox: <e>gentoo-dev</e>, <e>gentoo-user</e> e
<e>gentoo-announce</e>.
</p>

<note>
I filtri di procmail vengono chiamati "ricette", ne sono state inserite alcune
per filtrare del possibile spam.
</note>

<pre caption="Sample .procmailrc">
MAILDIR=$HOME/MuttMail                ##meglio sapere che c'è
LOGFILE=$HOME/.procmaillog
LOGABSTRACT=no
#VERBOSE=on... suggerito solo in caso di debug
VERBOSE=off
FORMAIL=/usr/bin/formail
NL="
"
##le linee delle ricette inziano con :0
##non mettete commenti sulle linee delle ricette
##disabilitate le ricette inserendo una condizione di "FALSE" !
##le linee delle condizioni iniziano con un * e le espressioni regolari
##sono vostre amiche
##le condizioni sono concatenate con un "and" logico e tutto ciò che viene
##messo dopo un * viene dato in pasto direttamente ad un egrep
##una linea delle azioni segue le condizione, in questo caso è stato 
##inserito il nome di una mailbox

#trova i duplicati utilizzando formail
:0 Whc: .msgid.lock
| $FORMAIL -D 16384 .msgid.cache

:0 a
$MAILDIR/duplicates

#gente dalla quale vogliamo sempre ricevere email
:0 
* ^From:.*(craig\@hotmail|renee\@local.com)
$MAILDIR/friends 

#adesso togliamo un po' di spam 
:0  
* ^Subject:.*(credit|cash|money|debt|sex|sale|loan)
$MAILDIR/spam

#non voglio mail in HTML
:0
* ^Content-Type:.*html
$MAILDIR/junk

#mettiamo le mailing list nelle mailbox
:0 
* ^List-Id:.*gentoo-user
gentoo-user

:0 
* ^List-Id:.*gentoo-dev
gentoo-dev

:0 
* ^List-Id:.*gentoo-announce
gentoo-announce

#trova tutte le email che vengono da gentoo
:0 
* ^From:.*gentoo.org
gentoo

:0 
* ^From:.*@freshmeat\.net
freshmeat

################################
# ultima regola: tutte le mail  #
# che non rientrano nelle altre #  
# regole finiscono nella inbox  #
################################
:0 
* .*
default

# Fine del file
</pre>

<note>
È necessario creare solo la MAILDIR <path>$HOME/MuttMail</path>, sarà Procmail
a creare tutti i file di mailbox necessari in questa directory utilizzando i nomi
contenuti nelle linee delle azioni. Per trovare alcuni link utili visitate
<uri>http://www.procmail.org/</uri>.
</note>

<p>
Adesso potete testare il file <path>.procmailrc</path> rilanciando il comando
fetchmail che abbiamo utilizzato precedentemente. Ricordate l'opzione -k per
mantenere la posta sul server remoto, in questo modo, la potremo recuperare se ci
servirà nuovamente
</p>

<pre caption="Procmail test #1">
# <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i> 
</pre>

<p>
Adesso che fetchmail e procmail funzionano, andate nella directory
<path>$HOME/MuttMail</path> e leggete i vostri messaggi attraverso <c>less</c> o
attraverso il vostro file manager.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Il client email Mutt</title>
<section>
<body>

<p>
Mutt è utilizzato per leggere e comporre email. È potente e molto personalizzabile
ma è anche piccolo ed efficiente.
</p>

<p>
Mutt supporta la lettura e la scrittura di quattro formati differenti di mailbox:
mbox, MMDF, MH e Maildir. Il tipo di mailbox da utilizzare è rilevato
automaticamente. Nel nostro caso utilizzimao il formato mbox, dove tutti i
messaggi di una mailbox sono memorizzati in un singolo file.
</p>

<p>
Mutt può anche operare con delle cartelle posizionate su un server IMAP remoto. Si
veda "Supporto IMAP" nella sezione 4.11 del manuale di Mutt all'indirizzo
<uri>http://www.mutt.org/</uri>.
</p>

<p>
Durante l'installazione mutt cra un file di configurazione globale in
<path>/etc/mutt/Muttrc</path>. È però necessario creare un'altro file di
configurazione, <path>.muttrc</path>, nella propria home dirsctory.
</p>

<pre caption="Esempio di  .muttrc">
<comment>(Assicuratevi di leggere il manuale di Mutt in /usr/share/doc/mutt*)</comment>
<comment>(Le impostazioni di questo file hanno la precedenza su quelle che si
trovano in /etc/mutt/Muttrc)</comment>

# <i>cp /etc/mutt/Muttrc ~/.muttrc</i>
# <i>nano -w .muttrc</i>
set pager_context=1                        
set pager_index_lines=6                 #mostra un mini-indice nel pager
set menu_scroll  
set pgp_verify_sig=no                   #non mostrare il pgp nel pager
set status_on_top                       #metti la linea di stato in alto
set sort=threads                        #visualizza i messaggi per argomento nell'indice

set status_format=" %r %b %f %n      Del %d      Msgs %m %l %> (%P)"
set pager_format="%-10.10i %[!%a %b %d %R]"
set date_format="!%H:%M %a %d %b     "
set index_format="%4C %Z %[%b%d] %-15.15F %s"
set folder_format="%2C %t %8s %d %N %f"

#set sendmail="/usr/bin/nbsmtp -d isp.net -h smtp.isp.net -f yourname@isp.net"

#set from="default-mailaddress"         #imponi il tuo campo from
#set realname="myname"

set record="$HOME/MuttMail/sent"        #le email inviate sono salvate qui
set delete=yes                          #cancella senza chiederlo
set include=yes	#quota i messaggi alla risposta	
set fast_reply=yes			#non chiedere se devi rispondere
set beep=no				#niente rumore
set markers=no				#non aggiungere un "+" quoando vai a capo
set confirmappend=no			#no prompt for save to =keep           
set to_chars=" +TCF"                    #niente "L" per mail_list

set folder = $HOME/MuttMail
mailboxes =gentoo-user
mailboxes =gentoo-dev
mailboxes =gentoo-announce
mailboxes =gentoo   
mailboxes =freshmeat
mailboxes =duplicates
mailboxes =default  
mailboxes =sent     
mailboxes =friends  
mailboxes =junk
mailboxes =spam
mailboxes =keep

save-hook .* =keep                      #la mbox di default per (s)alvare le mail è =keep
subscribe gentoo-user gentoo-dev        #iscritto a queste mailing list

bind pager h display-toggle-weed	#fai vedere gli header con il tasto h

# simula il vecchio menu delle url
macro index \cb |urlview\n 'call urlview to extract URLs out of a messagè
macro pager \cb |urlview\n 'call urlview to extract URLs out of a messagè

#esegui fetchmail premendo il tasto G
macro index G "!fetchmail -a -m 'procmail -d %T'\r"
macro pager G "!fetchmail -a -m 'procmail -d %T'\r"  

#usato per editare .muttrc e quindi farne il source... non bisgona
#far ripartire mutt
macro generic ,sm ":source $HOME/.muttrc\r"
macro generic \cj "!rxvt -bg wheat -e joe $HOME/.muttrc\r"

#Questa è la lista degli header da togliere quando la mail viene 
#visualizzata
ignore *
unignore  Date To From: Subject X-Mailer Organization User-Agent
hdr_order Date From To Subject X-Mailer User-Agent Organization 

##Mutt deve avere qualche colore
##questi sono per quattro livelli di testo quotato
##vengono sovrascritte le impostazioni di sistema contenute in /etc/mutt/Muttrc

#color quoted green  default
color quoted1 magenta blue 
#color quoted2 yellow default
#color quoted3 red default   
#color signature cyan cyan   


#Queste impostazioni di colori sono copiate da /etc/mutt/Muttrc.color
#commentatele se volete i colori di default contenuti in /etc/mutt/Muttrc
#Je vois la vie en rose :-) 
color	hdrdefault	brightcyan	blue
color	header		brightwhite	blue "^from:"
color   header          brightwhite    	blue   "^subject:"

color   quoted          brightgreen     blue
color   signature       brightwhite	blue

color   indicator       blue	        green

color   error           red             black
mono    error           bold
color   status          black cyan
mono	status		bold
color   tree            yellow   	blue

color   tilde           brightmagenta   blue
color	body	brightwhite		blue	"[-a-z_0-9.]+@[-a-z_0-9.]+"
mono    body    bold                    "[-a-z_0-9.]+@[-a-z_0-9.]+"
color   body            brightyellow    black   "^Good signature"
mono    body            bold                    "^Good signature"
color   body            brightwhite     red     "^Bad signature from.*"
mono    body            bold                    "^Bad signature from.*"
color   normal          white		blue
color	message		green	black
color	attachment	brightgreen	blue

# fine del file...ma potrebbe andare avanti e avanti e avanti....:)
</pre>

<p>
Per la cronaca, questo è semplicemente un esempio di <path>.muttrc</path>. Ci
sono molte più opzioni che possono essere configurate, per esempio quelle relative
a gpg. Date un'occhiata a <uri>http://mutt.netliberte.org/</uri> per vedere più
esempi ed ottenere aiuto.
</p>

<p>
Adesso siete pronti per testare il vostro <path>.muttrc</path>.
</p>

<pre caption="Testare .muttrc">
# <i>mutt -y</i>
</pre>

<p>
Questo dovrebbe aprire Mutt con un menu che mostra le mailbox che avete creato
precedentemente quando avete lanciato il comando fetchmail.
</p>

<p>
Premete il tasto ? per informazioni sulla navigazione delle Mailbox in mutt.
</p>

</body>
</section>
</chapter>
<chapter>
<title>SMTP</title>
<section>
<body>

<p>
Il passo finale consiste nel configurare nbsmtp il 'No-Brainer SMTP' usato per
mandare mail al server SMTP del vostro provider. Questa configurazione è la
più semplice di tutte, richiede solo di aggiungere una riga al vostro file
<path>.muttrc</path>.</p>

<p>
domain (dominio): il dominio a cui volete che nbsmtp dica di appartenere.
Sarà quasi sempre identico a quello del vostro indirizzo di posta.
</p>

<p>
from@addr: questo è l'indirizzo di provenienza della mail che volete che nbsmtp
annunci. Notate che questo indirizzo può essere diverso dal campo "From:" (Da)
nel vostro Mail User Agent (in questo caso... Mutt).
</p>

<p>
host: Questo è il server SMTP a cui state mandando le email.
</p>

<pre caption="Aggiungere il supporto smtp">
# <i>nano -w .muttrc</i>
set sendmail="/usr/bin/nbsmtp -d isp.net -h smtp.isp.net -f urname@isp.net"
</pre>

<p>
Adesso siete pronti per ricevere e mandare messaggi. Nel pager oppure nell'indice
di mutt premete il tasto <c>m</c> e componete un messagio di prova da mandare al
vostro indirizzo di posta elettronica. Mutt utilizzerà il valore di EDITOR o quello
di VISUAL per lanciare l'editor per la composizione del messaggio, questo nel caso
non abbiate settato la variabile <c>editor=</c> nel file <path>.muttrc</path>.
Quando avrete finito con la composizione del messaggio premete il tasto <c>y</c>
per inviare il vostro messaggio. Se non ci sono errori apparirà il messaggio
'invio della posta in corso' seguito da 'Nuova posta in =sent'.
</p>

<p>
Ricordate che in <path>.muttrc</path> abbiamo impostato dove salvare la posta
inviata con <c>set record="$HOME/MuttMail/sent"</c>.
</p>

<p>
Adesso, per completare il test, eseguite di nuovo fetchmail per ricevere tutta
la vostra posta e verificate se avete ricevuto il messaggio che avete appena
spedito al vostro indirizzo. Quando trovate il vostro messaggio di prova premete
il tasto <c>h</c> per visualizzare tutti gli header e vedere tutto il percoso di
trasferimento seguito dalla vosta mail.
</p>

<note>
C'è probabilmente un altro programma che vorrete installare: urlview. Questo
tool estrae gli URL dai messaggi di posta e li invia al vostro browser.
</note>

<pre>
# <i>emerge urlview</i> 
</pre>

<p>
create quindi il file <path>~/.urlview</path> copiandolo da
<path>/usr/share/doc/urlview*/</path> e impostate il comando usato per lanciare
il browser.
</p>

<p>
Adesso avete un potente ed altamente personalizzabile sistema di posta
elettronica. A questo punto consigliamo di leggere i manuali e la documentazione
disponibile e di cercare sul web esempi di configurazione dei file
<path>.procmailrc</path> e <path>.muttrc</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>SMTP autenticati</title>
<section>
<title>Usare nbSMTP</title>
<body>

<p>
Se il tuo server SMTP richiede l'autenticazione tramite 'nome utente' e
'password', devi modificare <c>set sendmail</c> nel file <path>.muttrc</path>
includendo <c>-U &lt;nome utente&gt; -P &lt;password&gt;</c>, come in questo
esempio:
</p>

<pre caption="Impostare 'nome utente' e 'password' per l'autenticazione SMTP">
set sendmail="/usr/bin/nbsmtp -U <i>nome utente</i> -P <i>password</i> -d isp.net -h smtp.isp.net -f urname@isp.net"
</pre>

<p>
Se preferisci che queste informazioni non siano presenti in
<path>.muttrc</path>, puoi inserirle nel file <path>.nbsmtprc</path> (che va
creato) in questo modo:
</p>

<pre caption="Esempio di ~/.nbsmtprc">
auth_user = <i>nome utente</i>
auth_pass = <i>password</i>
</pre>

</body>
</section>
<section>
<title>Alternativa: usare msmtp</title>
<body>

<p>
<c>msmtp</c> è una semplice alternativa a <c>nbsmtp</c> con funzionalità molto
simili.
</p>

<pre caption="Installare msmtp">
# <i>emerge msmtp</i>
</pre>

<p>
Per configurare msmtp è necessario inserire le impostazioni del server SMTP nel
file <path>~/.msmtprc</path> (che va creato). Ricordati di impostare i permessi
di questo file in regime di sicurezza.
</p>

<pre caption="Configurare msmtp">
# <i>nano -w .msmtprc</i>
account default
host <i>smtp.your_provider.net</i>
from <i>your_username@provider1.net</i>
<comment>#consulta le pagine man per altre opzioni di auth</comment>
auth login 
user <i>your_username</i>
password <i>your_password</i>
<comment>#se il tuo server SMTP supporta la crittografia TLS, togli il commento
a questa riga</comment>
#tls
</pre>

<p>
Come già detto, si devono impostare i permessi del file in modo adeguato, in
questo modo:
</p>

<pre caption="Impostare i permessi del file di configurazione">
# <i>chmod 600 .msmtprc</i>
</pre>

<p>
Infine, aggiungi questa linea al file <path>.muttrc</path>:
</p>

<pre caption="Usare msmtp con Mutt">
# <i>nano -w .muttrc</i>
set sendmail="/usr/bin/msmtp"
</pre>

<p>
Avvia <c>mutt</c> e inviati una email di prova per vedere se tutto funziona
corretamente. Per altri esempi di configurazione consulta le pagine man di msmtp.
</p>

</body>
</section>
</chapter>
</guide>
