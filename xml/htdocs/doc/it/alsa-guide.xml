<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/alsa-guide.xml,v 1.15 2006/10/11 16:15:28 so Exp $ -->
<guide link = "/doc/it/alsa-guide.xml" lang="it">
<title>Gentoo Linux ALSA Guide</title>

<author title="Author">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Traduzione">
   <mail link="whitenoise@tiscali.it">Giorgio Vielmini</mail>
</author>
<author title="Traduzione">
   <mail link="so@gentoo.org">Stefano Pacella</mail>
</author>

<abstract>
Questo documento aiuta gli utenti a installare ALSA su Gentoo Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.10</version>
<date>2005-09-10</date>

<chapter>
<title>Introduzione</title>
<section>
<title>Che cosa è ALSA?</title>
<body>

<p>
ALSA, <e>Advanced Linux Sound Architecture</e>, fornisce funzionalità audio e
MIDI (<e>Musical Instrument Digital Interface</e>) al sistema operativo Linux.
ALSA è il sottosistema audio di default nei kernel 2.6 e ha sostituito OSS
(<e>Open Sound System</e>) usato nei kernel 2.4.
</p>

<p>
Le principali caratteristiche di ALSA includono supporto efficiente per tutti
i tipi di interfacce audio, da quelle normali a quelle professionali, driver
totalmente modularizzati, SMP e sicuro, retro-compatibilità con OSS e una
libreria per gli utenti, <c>alsa-lib</c>, per facilitare la programmazione
delle applicazioni.
</p>

</body>
</section>
<section>
<title>ALSA su Gentoo</title>
<body>

<p>
Una delle maggiori forze di Gentoo è dare agli utenti il massimo controllo
sulla installazione/configurazione di un sistema. ALSA su Gentoo segue lo
stesso principio. Ci sono due modi per fare funzionare ALSA sul vostro sistema.
Nel prossimo capitolo li vedremo in dettaglio.
</p>
 
</body>
</section>
</chapter>

<chapter>
<title>Installare ALSA</title>
<section>
<title>Opzioni</title>
<body>

<warn>
I metodi descritti sotto sono da usare in maniera esclusiva. Non si può avere
ALSA compilato e usare <c>media-sound/alsa-driver</c>. Ci <e>saranno</e>
problemi.
</warn>

<p>
Le due opzioni sono:
</p>

<ol>
  <li>
  Usare ALSA fornito dal kernel. Questo è il metodo raccomandato.
  </li>
  <li>
  Pacchetto <c>media-sound/alsa-driver</c>.
  </li>
</ol>

<p>
Prendiamo in considerazione entrambe le opzioni.
</p>

<p>
Se si sceglie di usare ALSA fornito dal kernel, questi sono i pro e i contro:
</p>

<table>
<tr>
  <th>Kernel ALSA</th>
  <th>Pro e Contro</th>
</tr>
<tr>
  <th>+</th>
  <ti>Stabile poichè i driver sono integrati nel kernel.</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Basta una sola soluzione, senza ripetere emerge.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Potrebbe essere una versione più vecchia di <c>alsa-driver</c>.</ti>
</tr>
</table>

<p>
Se si sceglie di usare alsa-driver,
</p>

<table>
<tr>
  <th>alsa-driver</th>
  <th>Pro e Contro</th>
</tr>
<tr>
  <th>+</th>
  <ti>Ultimi driver dal ALSA Project.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
  Ogni kernel che si compila richiede un re-emerge di <c>alsa-driver</c>.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
  Ha bisogno che siano disabilitate alcune opzioni di configurazione del kernel
  per funzionare in maniera corretta.
  </ti>
</tr>
</table>

</body>
</section>
<section>
<title>E allora...</title>
<body>

<p>
La principale differenza tra <c>alsa-driver</c> e ALSA fornito dal kernel è
che <c>alsa-driver</c> è più aggiornato della versione nel kernel. Non è una
grande differenza, e si raccomanda di usare ALSA fornito dal kernel per un
facile uso. Prima di riportare problemi relativi al suono in
<uri link="https://bugs.gentoo.org">Gentoo Bugzilla</uri>, cercate di
riprodurli usando <c>alsa-driver</c> e inserite il bug report.
</p>

</body>
</section>
<section id="lspci">
<title>Prima di andare avanti</title>
<body>

<p>
Qualsiasi metodo di installazione avete scelto, è necessario sapere quali
driver usa la vostra scheda sonora. Nella maggior parte dei casi, le schede
sonore (onboard e altre) sono basate PCI e <c>lspci</c> vi aiuterà nella
ricerca delle informazioni. Emergere <c>sys-apps/pciutils</c> per ottenere
<c>lspci</c>, se non è già installato. Se si ha una scheda sonora USB,
<c>lsusb</c> da <c>sys-apps/usbutils</c> <e>potrebbe</e> essere di aiuto. Per
schede ISA, cercate di usare <c>sys-apps/isapnptools</c>. Le seguenti pagine
<e>potrebbero</e> aiutare gli utenti con schede sonore basate ISA.
</p>

<ul>
  <li>
  <uri link="http://www.roestock.demon.co.uk/isapnptools/">The ISAPNPTOOLS
  Page</uri>
  </li>
  <li>
  <uri link="http://www2.linuxjournal.com/article/3269">LinuxJournal PnP
  Article</uri>
  </li>
  <li>
  <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">TLDP Sound
  HowTo</uri>
  </li>
</ul>

<note>
Per facilità di uso/spiegazione, si assume di avere una scheda sonora PCI nel
resto della guida.
</note>

<p>
Troviamo i dettagli della scheda sonora.
</p>

<pre caption="Dettagli della scheda sonora">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
Sappiamo che la scheda sonora è una Sound Blaster Live! della Creative Labs.
Andare in <uri link="http://www.alsa-project.org/alsa-doc/">
ALSA Soundcard Matrix</uri> e selezionare Creative Labs dal menu in basso. Si
andrà nella pagina Creative Labs matrix dovo si può vedere che la SB Live!
usa il modulo <c>emu10k1</c>. Questa è l'informazione che ci serve. Se siete
interessati ad ulteriori informazioni, cliccate sul link "Details" per andare
nella pagina <c>emu10k1</c>.
</p>

</body>
</section>
<section id="kernel">
<title>Usare ALSA fornito dal kernel</title>
<body>

<p>
Questo è il metodo più facile.
</p>

<note>
Dal rilascio 2005.0, Gentoo Linux usa il 2.6 come kernel di default. A meno che
non state usando un profilo 2.4, <c>gentoo-sources</c> è un kernel 2.6 sulla
<e>maggior</e> parte delle architetture. Controllate se il vostro kernel è
della serie 2.6. Questo metodo <e>non</e> funzionerà con un kernel 2.4.
</note>

<p>
Configuriamo il kernel per abilitare ALSA.
</p>

<impo>
Gli utenti che hanno usato <c>genkernel</c> dovrebbero eseguire
<c>genkernel --menuconfig all</c> e poi seguire le istruzioni in
<uri link="#doc_chap2_pre3">Opzioni del kernel per ALSA</uri>.
</impo>

<pre caption="Andare sul sorgente">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
L'esempio sopra assume che il symlink <path>/usr/src/linux</path> punti al
sorgente del kernel che si desidera usare. Assicuratevi che sia così prima
di continuare.
</note>

<p>
Vediamo alcune delle opzioni da abilitare nel kernel 2.6 per il supporto ALSA
della scheda sonora.
</p>

<p>
Notate che tutti gli esempi mostrano ALSA compilato come modulo. E' consigliato
seguire questa impostazione poichè dopo permette di usare <c>alsaconf</c> che
è un vantaggio per configurare la scheda. <e>Non</e> saltate la sezione
<uri link="#alsa-config">Configurazione</uri> di questo documento. Se volete
avere le opzioni comilate non come moduli, cambiate la configurazione di
conseguenza.
</p>

<pre caption="Opzioni del kernel per ALSA">
Device Drivers  ---&gt;
   Sound  ---&gt;
   
<comment>(Questo deve essere abilitato)</comment>
&lt;M&gt; Sound card support

<comment>(Assicuratevi che OSS è disabilitato)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(Un altro passo per entrare in ALSA)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Selezionare questo se si vuole MIDI sequencing e routing)</comment>
   &lt;M&gt; Sequencer support
   <comment>(Vecchio stile supporto /dev/mixer* e /dev/dsp*. Raccomandato.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API 

<comment>(Si deve scegliere il dispositivo per abilitare il supporto. Di solito
se ne ha uno solo, se avete più di una scheda sonora abilitateli tutti.)</comment>

<comment>(Per scopo di test e sviluppo, non necessario per utenti normali a
meno che sapete quello che state facendo.)</comment>
Generic devices  ---&gt;
   
<comment>(Per schede sonore ISA)</comment>
ISA devices   ---&gt;
<comment>(Se avete Gravis, selezionate questa opzione)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Entrare in PCI device. Molte schede sonore sono PCI device)</comment>
PCI devices   ---&gt;
   <comment>(Selezionare il driver emu10k1 per la scheda)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(O per una scheda Intel))</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(O per una scheda VIA)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(Se si ha una scheda sonora USB)</comment>
USB Devices   ---&gt;
</pre>

<p>
Le opzioni sono impostate, si può (ri)compilare il kernel e il supporto ALSA
per la vostra scheda dovrebbe funzionare dopo il reboot. Non dimenticate di
aggiornare la configurazione GRUB per usare il nuovo kernel. Si può procedere
con <uri link="#alsa-utilities">ALSA Utility</uri> e vedere se tutto funziona.
</p>

</body>
</section>
<section id="alsa-driver">
<title>Usare il pacchetto ALSA driver</title>
<body>

<p>
Avete deciso di installare <c>alsa-driver</c>. Ci sono un pò di cose da fare
per assicurarsi che i driver per la vostra scheda sonora sono compilati. Non
sono necessarie ma non saranno compilati driver che non serviranno.
</p>

<p>
Se non sapete di quali driver la vostra scheda sonora ha bisogno, guardate la
sezione <uri link="#lspci">lspci</uri> di questa guida. Dopo aver visto il nome
del driver (<c>emu10k1</c> nel nostro esempio), modificare
<path>/etc/make.conf</path> e aggiungere una variabile, <c>ALSA_CARDS</c>.
</p>

<pre caption="Aggiungere ALSA_CARDS a make.conf">
<comment>(Per una scheda sonora)</comment>
ALSA_CARDS="emu10k1"
<comment>(Per più di una scheda sonora, separare i nomi con spazi)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Se avete compilato il kernel e volete usare <c>alsa-driver</c>, assicuraratevi
che le seguenti opzioni siano impostate correttamente.
</p>

<note>
Gli utenti che hanno usato <c>genkernel</c> possono procedere con
<uri link="#doc_chap2_pre6">Installare alsa-driver</uri> poichè la
configurazione è già impostata.
</note>

<ol>
  <li>
  <c>CONFIG_SOUND</c> è impostato. (Basic Sound support enabled)
  </li>
  <li>
  <c>CONFIG_SOUND_PRIME</c> non è impostato. (In-built OSS support disabled)
  </li>
  <li>
  <c>CONFIG_SND</c> non è impostato. (In-built ALSA support disabled)
  </li>
  <li>
  <path>/usr/src/linux</path> punta al kernel con cui si vuole fare funzionare
  ALSA.
  </li>
</ol>

<pre caption=".config controlli">
<comment>(Il symlink linux punta al corretto kernel)</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(1. vero)</comment>
CONFIG_SOUND=y
<comment>(2. vero)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(e 3. vero)</comment>
CONFIG_SND is not set
</pre>

<p>
Emergere alsa-driver.
</p>

<pre caption="Installare alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Si deve eseguire <c>emerge alsa-driver</c> dopo ogni volta che si (ri)compila
il kernel, poichè i driver precedenti sono cancellati.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Configurare/Testare ALSA</title>
<section id="alsa-utilities">
<title>ALSA Utility</title>
<body>

<p>
<c>alsa-utils</c> è una parte integrante di ALSA e ha molti programmi molto
utili, incluso ALSA Initscripts. E' raccomandato emergere <c>alsa-utils</c>.
</p>

<pre caption="Installare alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Se avete attivato ALSA nel vostro <uri link="#kernel">kernel</uri> <e>e</e>
non avete compilato ALSA come modulo, procedete alla sezione
<uri link="#initscript">ALSA Initscript</uri>. Gli altri devono configurare
ALSA. Molto facile con <c>alsaconf</c> fornito da <c>alsa-utils</c>.
</note>

</body>
</section>
<section id="alsa-config">
<title>Configurazione</title>
<body>

<note>
Chiudete i programmi che <e>potrebbero</e> accedere alla scheda sonora mentre
si esegue <c>alsaconf</c>.
</note>

<p>
Il modo più facile per configurare la vostra scheda sonora è eseguire
<c>alsaconf</c>. Digitare <c>alsaconf</c> in una shell come root.
</p>

<pre caption="Aprire alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Si è accolti da un menu guidato che controlla i vostri dispositivi e cerca di
trovare la vostra scheda sonora. Viene chiesto di scegliere la vostra scheda
sonora da un elenco. Dopo si chiede il permesso di fare i cambimenti richiesti
a <path>/etc/modules.d/alsa</path>. Poi setta il volume in modo ottimizzato,
esegue <c>modules-update</c> e fa partire il servizio
<path>/etc/init.d/alsasound</path>. Quando <c>alsaconf</c> si chiude, si può
procedere con impostare initscript ALSA.
</p>

</body>
</section>
<section id="initscript">
<title>ALSA Initscript</title>
<body>

<p>
E' necessario avere qualcosa che carichi i moduli o inizializzi ALSA e
riprendere le impostazioni del volume quando il sistema si avvia. Initscript
ALSA gestisce tutto questo e è chiamato <c>alsasound</c>. Aggiungerlo al
runlevel di boot.
</p>

<pre caption="Aggiungere ALSA al runlevel di boot">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Controllare il file <path>/etc/conf.d/alsasound</path> e assicurarsi che la
variabile SAVE_ON_STOP è impostata a yes. Questo salva le impostazioni sonore
quando si spegne il sistema.
</p>

</body>
</section>
<section>
<title>Gruppo audio</title>
<body>

<p>
C'è ancora una cosa <e>importante</e> da impostare. Una regola nei sistemi
operativi *nix è quella di non eseguire qualcosa come root se non necessario.
Questa si applica bene anche qui. Molte volte siete loggati come user e
volete ascoltare musica o accedere alla scheda sonora. Per questo dovete essere
nel gruppo "audio". Si aggiungono gli utenti al gruppo audio, così non si
avranno problemi. Si usa <c>gpasswd</c> e è necessario essere loggati come
root.
</p>

<pre caption="Aggiungere utenti al gruppo audio">
<comment>(Sostituire &lt;username&gt; con il vostro utente)</comment>
# <i>gpasswd -a &lt;username&gt; audio </i>
Adding user &lt;username&gt; to group audio
</pre>

</body>
</section>
<section>
<title>Controllare il volume</title>
<body>

<p>
Facciamo partire ALSA. Se avete eseguito <c>alsaconf</c> si può saltare questo
passo.
</p>

<pre caption="Fare partire il servizio">
<comment>(ALSA come moduli)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Loading: snd-card-0 ...        [ ok ]
 * Loading: snd-pcm-oss ...       [ ok ]
 * Loading: snd-seq ...           [ ok ]	
 * Loading: snd-emu10k1-synth ... [ ok ]	
 * Loading: snd-seq-midi ...      [ ok ]	
 * Restoring Mixer Levels ...     [ ok ]
<comment>(ALSA compilato)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Restoring Mixer Levels ...     [ ok ]
</pre>

<p>
Controlliamo il volume poichè in certi casi è muto. Usiamo <c>alsamixer</c>
per questo scopo.
</p>

<pre caption="Fare partire alsamixer">
<comment>(Aprire una console. Sono mostrate le impostazioni richieste)</comment>
# <i>alsamixer</i>
</pre>

<impo>
Se si hanno problemi a fare partire <c>alsamixer</c> e ottenete errori come
alsamixer: function snd_ctl_open failed for default: No such file or directory,
è un problema comune con udev e la impostazione del device. Eseguire
<c>killall udevd; udevstart</c> per ricaricare le voci <path>/dev</path> e
ri-eseguire <c>alsamixer</c>. Dovrebbe risolvere il problema.
</impo>

<p>
Questo è come ALSA Mixer <e>dovrebbe</e> essere la prima volta che lo aprite.
Attenzione ai canali Master e PCM che hanno un MM. Significa che sono muti. Se
si prova a ascoltare qualcosa con <c>alsamixer</c> non si sente niente.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="AlsaMixer Muted" caption="Finestra principale di Alsa Mixer, Muto"/>

<p>
Si attivano i canali, e si imposta il livello del volume come necessario.
</p>

<warn>
Master <e>e</e> PCM devono essere attivati e impostati con un livello di volume
ascolabile per ascoltare qualche suono dalle vostre casse.
</warn>

<ul>
  <li>
  Per spostarsi tra i canali usare i tasti sinistra e destra.
  (&lt;- &amp; -&gt;)
  </li>
  <li>
  Per cambiare il livello mute, spostarsi sul canale specifico, per esempio
  Master e premere il tasto <e>m</e>.
  </li>
  <li>
  Per aumentare e diminuire il livello di volume, usare i tasti sù e giù.
  </li>
</ul>

<note>
Attenzione a impostare i valori Bass e Treble. 50 è un buon numero per tutte e
due. Alti valori di Bass potrebbe causare <e>stonatura</e> sulle casse
difficili da risolvere.
</note>

<p>
ALSA Mixer dovrebbe essere simile a quello sotto. Notare 00 invece di MM e
anche il livello del volume per alcune impostazioni ottimizzate.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="AlsaMixer Unmuted" caption="Alsa Mixer pronto"/>

</body>
</section>
<section>
<title>Controllare il suono</title>
<body>

<p>
Vediamo se si sente un suono statico dalle casse. E' un modo per vedere se la
scheda sonora è configurata e funzionante.
</p>

<pre caption="Suono statico">
# <i>cat /dev/urandom > /dev/dsp</i>
</pre>

<note>
<path>/dev/dsp</path> è un symlink a <path>/dev/sound/dsp</path> e dovrebbe
essere automaticamente creato. Re-dirigere l'output a
<path>/dev/sound/dsp</path> se si ottiene un errore
"No such file or directory".
</note>

<p>
Si dovrebbe sentire un suono statico. Premere <c>Ctrl + C</c> per fermarlo. Se
non si sente niente rileggere la guida e correggere l'errore.
</p>

<p>
Sentiamo qualche canzone. Un modo veloce è quello di usare tool a riga di
comando come <c>media-sound/madplay</c>. Si potrebbe usare anche <c>mpg123</c>
o <c>xmms</c>. Se siete fan di ogg, usate <c>ogg123</c> fornito da
<c>media-sound/vorbis-tools</c>. Usate qualsiasi player volete. <e>Emergete</e>
quello che volete usare.
</p>

<pre caption="Ottenere il software">
<comment>(Installare applicazione che volete))</comment>
# <i>emerge madplay mpg123 xmms</i>
<comment>(Per ascoltare file .ogg)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
E ascoltate la vostra canzone preferita.
</p>

<pre caption="Ascoltare musica">
# <i>madplay -v /mnt/shyam/Music/Paul\ Oakenfold\ -\ Dread\ Rock.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Dread Rock
         Artist: Paul Oakenfold
          Album: Matrix Reloaded
           Year: 2003
          Genre: Soundtrack
                 Soundtrack
 00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 Paul\ Oakenfold\ -\ Dread\ Rock.ogg</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Paul Oakenfold - Dread Rock.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Soundtrack
Transcoded: mp3;160
Title: Dread Rock
Artist: Paul Oakenfold
Date: 2003
Album: Matrix Reloaded
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>

</body>
</section>
<section>
<title>ALSA e USE</title>
<body>

<p>
Si può aggiungere la flag use <c>alsa</c> a <path>/etc/make.conf</path> per
assicurare che tutte le applicazioni che supportano ALSA sono compilate con
essa. Architetture come x86 e amd64 hanno la flag abilitata di default.
</p>

</body>
</section>
<section>
<title>Problemi?</title>
<body>

<p>
Se per qualche ragione non sentite il sonoro, la prima cosa da controllare
sono le impostazioni <uri link="#doc_chap3_pre6">alsamixer</uri>. 80%
dei problemi si risolvono perchè i canali erano muti o il volume era
basso. Controllare anche Window Manager's sound applet e verificare che i
volumi sono impostati per stare a un livello ascoltabile.
</p>

<p>
<path>/proc</path> e <path>/proc/asound</path> sono altre cose da controllare.
</p>

<pre caption="/proc/asound">
<comment>(Primo, se /proc/asound/cards mostra la vostra scheda, ALSA l'ha
scelta bene.)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Se eseguite ALSA fuori dal kernel, questo visualizza la versione
di ALSA che si esegue)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(Dettagli ALSA OSS emulazione)</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
Altro errore comune è "Unknown symbol in module". Un esempio è mostrato
sotto.
</p>

<pre caption="Errore Unknown symbol in module">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)                             
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)                             
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
Quando si guarda <c>dmesg</c> si vede:
</p>

<pre caption="dmesg output">
<comment>(Sono mostrate solo parti rilevanti)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) -> IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
Il problema è causato dal passaggio da <c>alsa-driver</c> a ALSA nel kernel
perchè quando si unmerge <c>alsa-driver</c> i moduli sono protetti e quindi
lasciati. Quando si passa a driver nel kernel, eseguendo <c>modprobe</c> si
vedono un mix di moduli di <c>alsa-driver</c> e del kernel e causa gli errori.
</p>

<p>
La soluzione è abbastanza semplice. Si deve rimuovere manualmente il problema
dopo unmerge <c>alsa-driver</c>. Assicurarsi di rimuovere la versione del
kernel corretta e non quella attuale.
</p>

<pre caption="Rimuovere moduli alsa-driver">
<comment>(Sostituire KERNELVER con la versione del kernel)</comment>
# <i>rm -rf /lib/modules/KERNELVER/alsa-driver</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Altre cose</title>
<section>
<title>Impostare il supporto MIDI</title>
<body>

<p>
Se la vostra scheda sonora ha un sintetizzatore MIDI e volete ascoltare file
.mid, dovete installare <c>awesfx</c> un insieme di programmi per controllare
il driver AWE32. Si deve installarlo prima. Se non si ha un sintetizzatore
hardware si può usare uno virtuale. Vedere la sezione
<uri link="#vsynth">Sintetizzatore virtuale</uri> per altre informazioni.
</p>

<pre caption="Installare awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Si devono copiare i file SoundFont (SF2) dal CD con i driver della scheda
sonora o da una installazione Windows in <path>/usr/share/sounds/sf2/</path>.
Per esempio un file di font audio per la scheda Creative SBLive! potrebbe
essere 8MBGMSFX.SF2.
</note>

<p>
Dopo aver copiato i file Soundfont, si può ascoltare un file midi. Si può
anche aggiungere il comando <c>asfxload</c> in
<path>/etc/conf.d/local.start</path>, e il font audio è caricato ogni volta
che parte il sistema.
</p>

<note>
<path>/mnt</path> qui sotto potrebbe non essere lo stesso sulla vostra
macchina. E' solo un esempio. Cambiate il percorso in base alle vostre opzioni.
</note>

<pre caption="Caricare Soundfonts">
<comment>(Copiare Soundfont)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i> 
<comment>(O scaricarlo dal CD SoundBlaster)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(Caricare lo specifico Soundfont)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Si possono ascoltare i file midi con un programma come
<c>aplaymidi</c>. Eseguire <c>aplaymidi -l</c> per avere
la lista delle porte disponibili e selezionarne una per ascoltare il file.
</p>

<pre caption="Ascoltare un MIDI">
<comment>(Controllare le porte aperte)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Scegliere una porta e ascoltare un file mid)</comment>
# <i> aplaymidi --port=65:0 /mnt/shyam/music/midi/mi2.mid</i>
</pre>

</body>
</section>
<section id="vsynth">
<title>Sintetizzatore virtuale</title>
<body>

<p>
Se la vostra scheda sonora non ha un sintetizzatore hardware, potete utilizzare
<c>timidity++</c>.
</p>

<pre caption="Installare timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
C'è bisogno di un font audio per far funzionare timidity. Se non l'avete,
installate <c>timidity-eawpatches</c> o <c>timidity-shompatches</c>, ve ne
darà alcuni. Si possono avere varie configurazioni di font audio installate,
e potete mettere la vostra in <path>/usr/share/timidity/</path>. Per passare da
una configurazione ad un'altra, si dovrebbe usare <e>timidity-update</e>
fornito nel pacchetto timidity++.
</p>

<pre caption="Installare font audio">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(o)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Non dimenticatevi di aggiungere <c>timidity</c> al runlevel di default.
</p>

<pre caption="Aggiungere timidity al runlevel di default">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Si può provare a <uri link="#doc_chap4_pre3">Ascoltare MIDI</uri> file.
</p>

</body>
</section>
<section>
<title>Tool e firmware</title>
<body>

<p>
Alcune schede audio possono beneficiare di alcuni tool forniti dai pacchetti
<c>alsa-tools</c> e <c>alsa-firmware</c>. Se avete bisogno di
<c>alsa-tools</c>, definite la variabile ALSA_TOOLS in
<path>/etc/make.conf</path>, con il tool che volete. Per esempio:
</p>

<pre caption="Selezionare ALSA Tools in /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Se la variabile ALSA_TOOLS non è impostata, saranno compilati tutti i tool
disponibili. Poi installate i pacchetti <c>alsa-tools</c>
(e/o <c>alsa-firmware</c>):
</p>

<pre caption="Installare ALSA Tools">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Un grande ringraziamento a...</title>
<body>

<p>
Tutti quelli che hanno contribuito alla versione precedente della Guida ALSA
Gentoo: Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy Huddleston,
John P. Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft e Erwin.
</p>

</body>
</section>
<section>
<title>Riferimenti</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">The ALSA Project</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
