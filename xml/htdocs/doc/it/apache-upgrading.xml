<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/apache-upgrading.xml,v 1.4 2007/08/02 16:13:20 scen Exp $ -->

<guide link="/doc/it/apache-upgrading.xml" lang="it">
<title>Aggiornamento di Apache</title>

<author title="Autore">
  <mail link="vericgar@gentoo.org">Michael Stewart</mail>
</author>
<author title="Traduzione">
  <mail link="sergio.bevilacqua@yoda2000.net">Sergio Bevilacqua</mail>
</author>
<author title="Traduzione">
  <mail link="scen@gentoo.org">Davide Cendron</mail>
</author>

<abstract>
Questo documento descrive le procedure necessarie all'utente finale per
aggiornare la propria installazione di Apache.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.5</version>
<date>2007-07-30</date>

<chapter>
<title>Introduzione</title>
<section>
<body>

<p>
Lo stato di Apache e dei suoi moduli in Gentoo stava peggiorando, in quanto
c'era un certo numero di problemi che causavano problemi nel supporto e
rendevano difficoltoso il mantenimento del pacchetto:
</p>

<ul>
  <li>
    La configurazione fornita con Gentoo era drasticamente diversa da quella
    distribuita da apache.org usata da molti utenti e distribuzioni.
  </li>
  <li>
    Molti moduli usavano porzioni di codice simili, ma ognuno di essi
    implementava funzioni in modo personale.
  </li>
  <li>
    Alcuni moduli non erano mantenuti con cura, a causa anche del grande numero
    di moduli disponibile
  </li>
  <li>I moduli non avevano una configurazione standard</li>
  <li>
    Alcuni moduli supportavano entrambe le versioni di Apache, ma gli ebuild
    non erano in grado di gestirlo
  </li>
  <li>
    Scelte disponibili normalmente in Apache non lo erano per gli utenti Gentoo
    (per esempio gli MPMs)
  </li>
  <li>I bug di Apache si stavano accumulando</li>
</ul>

<p>
La soluzione? Il gruppo di Apache è stato allargato, aggiungendo molti nuovi
membri, che hanno lavorato insieme per generare un'eclass, aggiornare tutti i
moduli e risolvere un buon numero di bug.
</p>

<p>
Questo documento spiega come aggiornare senza danneggiare il proprio sistema. Se
si è sviluppatori o si vuole sapere cosa è stato cambiato, o come gli ebuild
devono essere modificati per utilizzare le eclass, visitare <uri
link="/doc/en/apache-developer.xml">la guida di riferimento per Apache</uri>.
</p>

</body>
</section>
</chapter>

<chapter id="upgrade">
<title>Istruzioni per l'aggiornamento</title>
<section>
<body>

<p>
Sono stati fatti molti cambiamenti riguardo il modo in cui Apache lavora
all'interno di Gentoo. Ogni pacchetto direttamente collegato con Apache deve
essere aggiornato, ed alcune cose che prima funzionavano, ora non funzioneranno
più.
</p>

<p>
Prima di tutto bisogna capire cosa necessita di aggiornamento. Questo è
possibile usando lo strumento <c>equery</c>, del pacchetto
<c>app-portage/gentoolkit</c>.
</p>

<pre caption="Individuazione dei pacchetti obsoleti">
$ <i>equery depends www-servers/apache</i>
[ Searching for packages depending on www-servers/apache... ]
dev-db/phpmyadmin-2.5.6
dev-php/mod_php-4.3.10
dev-php/phpsysinfo-2.1-r2
net-www/mod_bandwidth-2.0.5
net-www/mod_layout-4.0.1a
net-www/mod_mp3-0.40
net-www/mod_random-2.0
net-www/mod_throttle-3.1.2-r1
net-www/mod_ldap_userdir-1.1.4
net-www/mod_loopback-1.04
net-www/mod_watch-3.18
www-apps/viewcvs-0.9.2_p20030430
</pre>

<impo>
I pacchetti installati possono variare molto da un sistema all'altro,
assicurarsi di eseguire questo comando.
</impo>

<warn>
Esistono alcuni moduli e pacchetti dipendenti da Apache che non sono stati
aggiornati. <uri link="http://bugs.gentoo.org">Effettuare una ricerca su
bugzilla</uri> per ogni pacchetto di importanza critica usato insieme ad Apache.
</warn>

<p>
Molte applicazioni web non sono influenzate da questo aggiornamento perché si
appoggiano alla eclass <c>webapp</c> che si occupa di garantirne la corretta
installazione e funzionamento. È comunque consigliabile controllare la
disponibilità di nuove revisioni.
</p>

<p>
Sono state aggiunte alcune nuove flag USE, è consigliabile rivedere il contenuto
di <path>/etc/portage/package.use</path>. Consultare la <uri link="#use">lista
delle flag USE di Apache</uri> per ulteriori dettagli.
</p>

<pre caption="Verifica delle flag USE e ricompilazione">
<comment>(Verifica delle flag USE e degli aggiornamenti richiesti)</comment>
# <i>emerge --pretend --verbose --update --newuse --deep apache subversion \
mod_php mod_bandwidth mod_layout mod_ldap_userdir mod_loopback mod_mp3 \
mod_random mod_throttle mod_watch</i>

<comment>(Aggiornamento)</comment>
# <i>emerge --verbose --update --newuse --deep apache subversion mod_php \
mod_bandwidth mod_layout mod_ldap_userdir mod_loopback mod_mp3 mod_random \
mod_throttle mod_watch</i>

<comment>(È più semplice effettuare l'aggiornamento di world)</comment>
# <i>emerge --ask --verbose --update --newuse --deep world</i>
</pre>

<p>
Ora bisogna riconfigurare Apache ed i suoi moduli. Si inizia con un
<c>etc-update</c> o <c>dispatch-conf</c> per aggiornare i file in
<path>/etc/init.d</path> e <path>/etc/conf.d</path>. Si riceverà la segnalazione
che i file di configurazione di Apache sono stati aggiornati (questo perché
tutti i file di configurazione sono stati spostati)
</p>

<p>
Se sono stati fatti dei cambiamenti al precedente <path>apache.conf</path> e
<path>commonapache.conf</path> è necessario fare la migrazione di tali
cambiamenti a <path>/etc/apache{|2}/httpd.conf</path>. Anche la locazione
per moduli e virtual-host è stata cambiata: adesso si trovano rispettivamente in
<path>/etc/apache2/modules.d</path> e <path>/etc/apache2/vhosts.d</path>.
</p>

<p>
Una volta completata la migrazione dei cambiamenti al nuovo file di
configurazione, è necessario cancellare il vecchio file di configurazione (o
spostarlo in una diversa posizione). Il nuovo script
<path>/etc/init.d/apache{|2}</path> verifica che non esistano copie dei vecchi
file, e non permette l'avvio di Apache fino a che questi files non sono stati
rimossi, indicando l'avvenuta riconfigurazione di Apache usando i nuovi
percorsi.
</p>

<note>
Molti moduli in precedenza abilitati in modo predefinito sono ora disabilitati.
Se si tratta di moduli compilati internamente, rimuovere il commento dalla riga
corrispondente in httpd.conf. Se si tratta di moduli esterni si deve ricercare
nel file .conf del modulo, un <c>IfDefine</c> e aggiungere la stringa
corrispondente in <path>/etc/conf.d/apache{|2}</path> per abilitarlo.
</note>

<p>
Ora è possibile riavviare apache.
</p>

<pre caption="Riavvio di apache">
# <i>/etc/init.d/apache stop</i>
# <i>/etc/init.d/apache start</i>
</pre>

<p>
Se si presentano dei problemi, consultare la guida per la <uri
link="/doc/it/apache-troubleshooting.xml">Risoluzione dei problemi in
Apache</uri> e se questa non risolve la questione, segnalare il problema su
<uri link="http://bugs.gentoo.org">Gentoo Bugzilla</uri>. Assicurarsi di
includere l'elenco dei moduli che sono stati abilitati e (se si usa Apache 2)
quale MPM USE-flag è stata usata per la compilazione. È possibile trovare
supporto anche nel canale IRC <path>#gentoo-apache</path> su
<path>irc.freenode.net</path>.
</p>

</body>
</section>
</chapter>

<chapter id="use">
<title>Flag USE supportate da Apache</title>
<section>
<body>

<p>
Ci sono alcuni USE-flags locali per Apache ed i suoi moduli. Apache supporta
molte altre flag USE generiche come <c>ssl</c>, ma l'effetto che hanno non è
molto diverso da quello che manifestano in altri contesti, quindi non vengono
incluse in questa lista. <c>emerge --verbose --pretend apache</c> mostra tutte
le flag USE supportate.
</p>

<table>
<tr>
  <th>Flag USE</th>
  <th>Pacchetti</th>
  <th>Descrizione</th>
</tr>
<tr>
  <ti>apache2</ti>
  <ti>depend.apache eclass (tutti i moduli)</ti>
  <ti>
    Deve sempre essere impostata se si desidera utilizzare Apache 2.0,
    diversamente verrà usato Apache 1.3. L'eclass utilizza questa USE per
    determinare da quale versione di Apache dipende.
  </ti>
</tr>
<tr>
  <ti>mpm-leader</ti>
  <ti>apache-2*</ti>
  <ti>
    Compila il MPM <uri
    link="http://httpd.apache.org/docs/2.0/mod/leader.html">leader</uri>
    </ti>
</tr>
<tr>
  <ti>mpm-metux</ti>
  <ti>apache-2*</ti>
  <ti>Compila il MPM <uri link="http://www.metux.de/mpm/">metux</uri></ti>
</tr>
<tr>
  <ti>mpm-peruser</ti>
  <ti>apache-2*</ti>
  <ti>
    Compila il MPM <uri link="http://www.telana.com/peruser.php">peruser</uri>
  </ti>
</tr>
<tr>
  <ti>mpm-prefork</ti>
  <ti>apache-2*</ti>
  <ti>
    Compila il MPM <uri
    link="http://httpd.apache.org/docs/2.0/mod/prefork.html">prefork</uri>
  </ti>
</tr>
<tr>
  <ti>mpm-threadpool</ti>
  <ti>apache-2*</ti>
  <ti>
    Compila il MPM <uri
    link="http://httpd.apache.org/docs/2.0/mod/threadpool.html">
    threadpool</uri>
  </ti>
</tr>
<tr>
  <ti>mpm-worker</ti>
  <ti>apache-2*</ti>
  <ti>
    Compila il MPM <uri
    link="http://httpd.apache.org/docs/2.0/mod/worker.html">worker</uri>
    </ti>
</tr>
<tr>
  <ti>no-suexec</ti>
  <ti>apache</ti>
  <ti>
    Disabilita la compilazione del modulo suexec (per coloro che non vogliono
    avere un binario suid potenzialmente pericoloso all'interno del sistema)
  </ti>
</tr>
<tr>
  <ti>static-modules</ti>
  <ti>apache</ti>
  <ti>
    Effettua il linking statico dei moduli all'interno del binario di Apache,
    in modo che non sia richiesto LoadModule per il caricamento degli stessi.
  </ti>
</tr>
<tr>
  <ti>lingerd</ti>
  <ti>apache-1*</ti>
  <ti>
    Aggiunge il supporto per <uri
    link="http://www.iagora.com/about/software/lingerd/">lingerd</uri>
  </ti>
</tr>
<tr>
  <ti>no-htdocs</ti>
  <ti>gentoo-webroot-default</ti>
  <ti>
    Disabilita l'installazione della webroot predefinita in
    <path>/var/www/localhost</path> in modo che i file in quella posizione non
    siano sovrascritti. La webroot viene installata in
    <path>/usr/share/doc/gentoo-webroot-default-*/webroot/</path>.
  </ti>
</tr>
</table>

<note>
Le mpm-* USE-flags sono mutuamente esclusive. Solo una deve essere abilitata
tramite le flag USE mpm-*. (Se non ne viene abilitata una, viene compilato
mpm-prefork o mpm-worker, a seconda che la flag globale threads sia impostata
o no.)
</note>

</body>
</section>
</chapter>
</guide>