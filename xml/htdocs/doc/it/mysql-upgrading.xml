<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/it/mysql-upgrading.xml,v 1.5 2006/04/13 19:55:21 so Exp $ -->

<guide link="/doc/it/mysql-upgrading.xml" lang="it">
<title>Guida di aggiornamento a MySQL 4.1.x</title>

<author title="Autore">
  <mail link="citizen428@gentoo.org">Michael Kohl</mail>
</author>
<author title="Autore">
  <mail link="vivo@gentoo.org">Francesco Riosa</mail>
</author>
<author title="Traduttore">
  <mail link="lucamarturana@gmail.com">Luca Marturana</mail>
</author>

<abstract>
Il team MySQL è fiero di annunciare che MySQl 4.1 può essere trovato nel ramo
instabile di Gentoo (~arch). Il team comunque spera di poter renderlo al più
presto stabile, questa è la procedura da seguire per tutti i volenterosi
tester.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.7</version>
<date>2006-03-11</date>

<chapter>
<title>Aggiornamento da precedenti versioni di MySQL</title>
<section>
<body>

<p>
Gli utenti che aggiornano da una vecchia versione di MySQL (&lt;4.0.24) devono
prima installare MySQL 4.0.25. Chi invece già usa la versione corrente può
tranquillamente saltare questa sezione e continuare con la prossima.
</p>

<pre caption="Semplice aggiornamento">
# <i>emerge -av --buildpkg "&lt;mysql-4.1"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Creazione backup di tutti i dati correnti</title>
<section>
<body>

<p>
Uno dei più importanti compiti di ogni amministratore è quello di fare un
backup di tutti i dati. Ecco come fare:
</p>

<pre caption="Backup di tutti i database">
# <i>mysqldump \</i>
  <i>-uroot \</i>
  <i>--password=</i><comment>'propria_password'</comment><i> \</i>
  <i>-hlocalhost \</i>
  <i>--all-databases \</i>
  <i>--opt \</i>
  <i>--allow-keywords \</i>
  <i>--flush-logs \</i>
  <i>--hex-blob \</i>
  <i>--master-data \</i>
  <i>--max_allowed_packet=16M \</i>
  <i>--quote-names \</i>
  <i>--result-file=BACKUP_MYSQL_4.0.SQL</i>
</pre>

<p>
Adesso dovrebbe esserci il file  <path>BACKUP_MYSQL_4.0.SQL</path>, che più
avanti può essere utilizzato per ripristinare i dati. I dati sono stati
scritti in sintassi SQL, Structured Query Language.
</p>

<p>
Probabilmente converrà controllare se il backup funziona prima di procedere
ulteriormente.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aggiornamento da versioni recenti di MySQL</title>
<section>
<body>

<p>
Se si è saltato il passo #1, adesso si deve creare un pacchetto di backup
(del server database, non dei dati) della versione correntemente installata:
</p>

<pre caption="Pacchetto binario di backup">
# <i>quickpkg dev-db/mysql</i>
</pre>

<p>
Ora bisogna eliminare la versione installata con tutti i suoi dati:
</p>

<pre caption="Disinstallazione MySQL">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>tar cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
</pre>

<note>
Esistono due differenti tipi di backup: SQL, il quale è possibile usarlo con
varie versioni di MySQL, e un altro che permette di ripristinare velocemente
tutti i database. Quest'ultimo verrà trattato più dettagliatamente in
seguito.
</note>

<p>
Dopo aver eliminato completamente la vecchia installazione di MySQL, si può
procedere con l'installazione della nuova versione. Notare che
<c>revdep-rebuild</c> è necessario per riemergere i pacchetti linkati a
MySQL.
</p>

<pre caption="Aggiornamento dei binari">
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
</pre>

<p>
Adesso si deve configurare la nuova versione installata di MySQL e riavviare il
demone:
</p>

<pre caption="Configurazione di base MySQL 4.1">
# <i>emerge --config =mysql-4.1.&lt;micro_version&gt;</i>
# <i>/etc/init.d/mysql start</i>
</pre>

<p>
Infine bisogna importare il backup creato in precedenza:
</p>

<impo>
Per default il file <path>/etc/mysql/my.cnf</path> imposta il logging binario
(<c>log-bin</c>). Ciò logghera ogni singola transazione che modifica i dati. Se
si possiede un database molto grande (per esempio di 1GB), si può arrivare a
creare file estremamente grandi che possono consumare velocemente lo spazio del
disco. Se si possiede poco spazio, può essere utile disattivare il logging
binario.
</impo>

<pre caption="Importazione backup SQL">
# <i>cat BACKUP_MYSQL_4.0.SQL \</i>
     <i>| mysql \</i>
     <i>-uroot \</i>
     <i>--password=</i><comment>'propria_password'</comment><i> \</i>
     <i>-hlocalhost \</i>
     <i>--max_allowed_packet=16M</i>

# <i>mysql_fix_privilege_tables \</i>
     <i>--defaults-file=/etc/mysql/my.cnf \</i>
     <i>--user=root \</i>
     <i>--password=</i><comment>'propria_password'</comment><i> \</i>
</pre>

<p>
Adesso, riavviando il demone di MySQL, se tutto va come previsto si avrà MySQL
con versione 4.1.x perfettamente funzionante. :-)
</p>

<pre caption="Riavviare MySQL">
# <i>/etc/init.d/mysql restart</i>
</pre>

<p>
Se ci sono stati problemi durante il processo di upgrade, per favore riportarli
su <uri link="https://bugs.gentoo.org">Gentoo Bugzilla</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Ripristinare la vecchia versione di MySQL 4.0</title>
<section>
<body>

<p>
Se non si è soddisfatti di MySQL 4.1, è possibile ritornare indietro alla
4.0.
</p>

<pre caption="Ritorno alla vecchia versione">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
# <i>emerge --usepkgonly "&lt;mysql-4.1"</i>
# <i>tar -xjpvf mysql.[tag] -C /</i>
# <i>/etc/init.d/mysql start</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Upgrade diretto, non supportato, pericoloso</title>
<section>
<body>

<p>
Sotto certe condizioni è possibile aggiornare MySQL in maniera diretta alla
successiva versione. Se si è coscienti di ciò che si sta facendo, qui
c'è un piccolo trucco che permette di aggiornare MySQL alla 4.1 direttamente.
</p>

<pre caption="Upgrade diretto">
# <i>quickpkg dev-db/mysql</i>
# <i>/etc/init.d/mysql stop</i>
# <i>tar -cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>export MYSQL_STRAIGHT_UPGRADE=1</i>
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>unset MYSQL_STRAIGHT_UPGRADE</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
# <i>/etc/init.d/mysql start</i>
# <i>mysql_fix_privilege_tables --defaults-file=/etc/mysql/my.cnf \</i>
     <i>-uroot --password=</i><comment>'propria_password'</comment><i></i>
# <i>mysql --database=mysql -uroot --password=</i><comment>'propria_password'</comment><i> &lt; /tmp/new_pieces.sql</i>
# <i>/etc/init.d/mysql restart</i> # just to be sure
</pre>

<p>
Buona fortuna e se qualcosa non dovesse andare, non dire che non si è stati
avvertiti. ;-)
</p>

</body>
</section>
</chapter>

</guide>
