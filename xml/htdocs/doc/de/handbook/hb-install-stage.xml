<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- English CVS Version: 1.113 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/handbook/hb-install-stage.xml,v 1.51 2008/02/15 04:55:58 grahl Exp $ -->

<sections>

<abstract>
Installationen von Gentoo funktionieren mit einem stage3-Archiv. In diesem
Kapitel wird beschrieben wie Sie ein stage3-Archiv entpacken und Portage
konfigurieren.
</abstract>

<version>8.5</version>
<date>2007-12-31</date>

<section>
<title>Ein Stagearchiv installieren</title>
<subsection>
<title>Setzen von Zeit/Datum</title>
<body>

<p>
Bevor Sie fortfahren, sollten Sie Ihre Zeit/Datum Einstellung überprüfen und
gegebenenfalls anpassen. Eine falsch eingestellte Uhr kann zu merkwürdigen
Resultaten in der Zukunft führen.
</p>

<p>
Um Zeit und Datum zu überprüfen, führen Sie <c>date</c> aus:
</p>

<pre caption="Zeit/Datum überprüfen">
# <i>date</i>
Fri Mar 29 16:21:18 UTC 2005
</pre>

<p>
Wenn Zeit oder Datum falsch angezeigt wird, passen Sie die Einstellung mit der
<c>date MMDDhhmmYYYY</c> Syntax (<b>M</b>onth, <b>D</b>ay, <b>h</b>our,
<b>m</b>inute und <b>Y</b>ear) an. Zu diesem Zeitpunkt sollten Sie UTC-Zeit
verwenden. Sie werden später die Gelegenheit dazu haben Ihre lokale Zeitzone
anzugeben. Um die Zeiteinstellung auf den 29. März 2005, 16 Uhr 21 zu setzen,
führen Sie zum Beispiel folgenden Befehl aus:
</p>

<pre caption="Setzen von UTC-Zeit/Datum">
# <i>date 032916212005</i>
</pre>

</body>
</subsection>
<subsection>
<title>Eine Wahl treffen</title>
<body>

<p>
Der nächste Schritt ist die Installation des <e>Stage3</e>-Archivs auf Ihrem
System. Sie können den entsprechenden Tarball aus dem Internet laden oder, wenn
Sie von einer der Gentoo Universal-Installations-CDs oder LiveDVDs gebootet
haben, von der CD/DVD selbst kopieren. Wenn Sie die Universal CD haben und das
Stage-Archiv welches Sie nutzen möchten auf dieser CD enthalten ist, ist es eine
reine Bandbreitenverschwendung das Stagearchiv noch einmal herunterzuladen, da
diese Stages gleich sind. In den meisten Fällen hilft Ihnen der Befehl
<c>uname -m</c> die Entscheidung abzunehmen, welches Stagearchiv für Sie das
geeignete ist.
</p>

<p>
Minimal-CDs und LiveCDs enthalten keine stage3-Archive, die LiveDVDs schon.
</p>

<ul test="not(contains('AMD64 x86', func:keyval('arch')))">
<li><uri link="#doc_chap2">Standard: Herunterladen aus dem Internet</uri></li>
<li><uri link="#doc_chap3">Alternativ: Stagearchiv von der Installations-CD
benutzen</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Standard: Herunterladen aus dem Internet</title>
<subsection>
<title>Herunterladen des Stagearchivs</title>
<body>

<p>
Wechseln Sie nun zum Gentoo-Mountpoint, jenes Verzeichnis unter dem
Sie vorhin Ihre zukünftige Gentoo-Partition eingebunden haben
(wahrscheinlich <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln zum Gentoo-Mountpoint">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Abhängig vom Installationsmedium finden Sie verschiedene Programme um das
Stagearchiv herunter zu laden. Falls <c>links</c> verfügbar ist, können Sie
sofort die <uri link="http://www.gentoo.org/main/en/mirrors.xml">Gentoo
Mirrorliste</uri> ansteuern und und einen Mirror in Ihrer Nähe auswählen.
</p>

<p>
Wenn <c>links</c> nicht verfügbar ist sollte Ihnen <c>lynx</c> bereit stehen.
Wenn Sie über einen Proxy in das Internet gehen, exportieren Sie die
<c>http_proxy</c> und <c>ftp_proxy</c> Variablen:
</p>

<pre caption="Konfiguration der Proxy Informationen für lynx">
# <i>export http_proxy="http://proxy.server.com:port"</i>
# <i>export ftp_proxy="http://proxy.server.com:port"</i>
</pre>

<p>
Wir gehen ab jetzt davon aus, dass Ihnen <c>links</c> zur Verfügung steht.
</p>

<p>
Wechseln Sie nun in das Verzeichnis
<path><keyval id="release-dir"/>stages/</path>. Dort sollten Sie nun alle
verfügbaren stage-Dateien für Ihre Rechnerarchitektur vorfinden (evtl. auch in
weiteren Unterverzeichnissen, die nach der individuellen Subarchitektur benannt
sind). Wählen Sie eine Datei aus und starten den Download mit der Taste
<c>D</c>. Nach dem Download können Sie den Browser mit der taste <c>Q</c>
schließen.
</p>

<p test="'x86'=func:keyval('arch')">
Die meisten PC-Anwender sollten das <b><keyval id="stage3"/></b> stage3-Archiv
verwenden. Alle modernen PCs werden als i686-Architektur betrachtet.
Falls Sie einen nicht ganz so aktuellen Rechner verwenden, schauen Sie mal auf
die <uri link="http://en.wikipedia.org/wiki/I686">Liste der i686-kompatiblen
Prozessoren</uri>. Ältere Prozessoren, wie der Pentium, K5, K6 oder Via C3 und
Ähnliche, benötigen das etwas generischere <b>x86</b> stage3-Archiv. Prozessoren
die älter sind als <b>i486</b> werden nicht unterstützt.
</p>

<pre caption="Mirrorliste mit links anschauen">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Wenn Sie Proxy-Unterstützung in links benötigen:)</comment>
# <i>links -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Stellen Sie sicher, dass Sie ein stage3-Archiv herunterladen. Installationen
mit einem stage1- oder stage2-Archiv werden nicht länger unterstützt.
</p>

<p>
Wenn Sie die Integrität des heruntergeladenen Stagearchives prüfen wollen,
benutzen Sie <c>md5sum</c> und vergleichen Sie die Ausgabe mit den auf dem
Mirror gespeicherten MD5-Prüfsummen.
</p>

<pre caption="Integrität eines Stagearchivs prüfen">
# <i>md5sum -c <keyval id="stage3"/>.DIGESTS</i>
<keyval id="stage3"/>: OK
</pre>

</body>
</subsection>
<subsection>
<title>Entpacken des Stagearchivs</title>
<body>

<p>
Nun entpacken Sie das heruntergeladene Stagearchiv auf Ihrem System.
Wir benutzen <c>tar</c> dafür, weil es die einfachste Methode ist:
</p>

<pre caption="Entpacken des Stagearchivs">
# <i>tar xvjpf stage3-*.tar.bz2</i>
</pre>

<p>
Stellen Sie sicher, dass Sie die gleichen Schalter (<c>xvjpf</c>) verwenden.
Das <c>x</c> steht für <e>Auspacken</e> (engl. <e>Extract</e>), das <c>v</c>
für <e>Auskunftsfreudig</e> (engl. <e>Verbose</e>) um zu sehen, was während des
Entpackvorgangs passiert (optional), das <c>j</c> für
<e>Dekomprimieren mit bzip2</e>, das <c>p</c> für <e>Erhalt der Dateirechte</e>
(engl. <e>Preserve permissions</e>) und das <c>f</c> zeigt an, dass wir eine
Datei auspacken wollen und nicht die Standardeingabe benutzen.
</p>

<!-- MIPS hat ein eigenes hb-install-stage.xml File, andere Architekturen evtl.
auch?
<note>
Die Installations-CDs und Boot-Images einiger Architekturen (zum Beispiel MIPS)
beinhalten das in BusyBox enthaltene <c>tar</c>, welches die <c>-v</c> Option
momentan nicht unterstützt. Verwenden Sie die <c>xjpf</c> Optionen stattdessen.
</note>
-->

<p>
Wenn das Stagearchiv installiert ist, fahren Sie nun mit der
<uri link="#installing_portage">Installation von Portage</uri> fort.
</p>

</body>
</subsection>
</section>
<section test="not(contains('AMD64 x86', func:keyval('arch')))">
<title>Alternativ: Stagearchiv von der Installations-CD benutzen</title>
<subsection>
<title>Entpacken des Stagearchiv</title>
<body>

<p>
Die Stagearchiv auf der CD liegen im Verzeichnis <path>/mnt/cdrom/stages</path>.
Um eine Auflistung zu erhalten, benutzen Sie <c>ls</c>:
</p>

<pre caption="Liste aller verfügbarer Stagearchive">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Falls das System mit einem Fehler wie unten antwortet, müssen Sie die
CD-ROM mounten:
</p>

<pre caption="Mounten der CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Nun gehen Sie zu Ihrem Gentoo-Mountpunkt (gewöhnlich <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln des Verzeichnisses zu /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Wir werden nun das von Ihnen gewählte Stagearchiv entpacken. Dies erledigt
<c>tar</c>. Benutzen Sie die gleichen Schalter (<c>xvjpf</c>). Das <c>v</c>
Argument ist optional und in einigen <c>tar</c> Versionen nicht unterstützt.
Beispielhaft entpacken wir das Stagearchiv
<path>stage3-&lt;Subarchitektur&gt;-2007.0.tar.bz2</path>. Ersetzen Sie den
Dateinamen durch den Ihres Stagearchivs.
</p>

<pre caption="Entpacken des Stagearchivs">
# <i>tar xvjpf /mnt/cdrom/stages/stage3-&lt;Subarchitektur&gt;-2007.0.tar.bz2</i>
</pre>

<p>
Wenn das Stagearchiv installiert ist, fahren Sie nun mit der
<uri link="#installing_portage">Installation von Portage</uri> fort.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Installation von Portage</title>
<subsection>
<title>Einen Portage-Snapshot entpacken</title>
<body>

<p>
Sie müssen einen Snapshot des Portage-Tree installieren, eine Sammlung von
Dateien, die Portage informieren, welche Porgramme installiert werden können,
welche Profile es gibt, etc.
</p>

</body>
</subsection>
<subsection id="installing_from_internet">
<title>Herunterladen und Installieren eines Portage-Snapshots</title>
<body>

<p>
Wechseln Sie zu dem Mountpoint, an den Sie Ihre Dateisystem gemountet haben
(meistens <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln zum Mountpoint">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Starten Sie <c>links</c> (oder <c>lynx</c>) und wechseln Sie auf die <uri
link="http://www.gentoo.org/main/en/mirrors.xml">Gentoo Mirror Liste</uri>.
Wählen Sie einen nahegelegenen Mirror aus und öffnen Sie das
<path>snapshots/</path> Verzeichnis. Laden Sie von dort den aktuellsten
Snapshot (<path>portage-latest.tar.bz2</path>) herunter, indem Sie <c>D</c>
drücken.
</p>

<pre caption="Anschauen der Gentoo Mirror Liste">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Schliessen Sie den Browser nun mittles <c>Q</c>. Sie haben nun einen Snapshot
in <path>/mnt/gentoo</path> liegen.
</p>

<p>
Wenn Sie die Integrität des heruntergeladenen Snapshosts überprüfen wollen
können Sie <c>md5sum</c> verwenden und die Ausgabe mit der auf unserem Mirror
bereitgestellten MD5-Prüfsumme vergleichen.
</p>

<pre caption="Integrität eines Portage-Snapshots überprüfen">
# <i>md5sum -c portage-latest.tar.bz2.md5sum</i>
portage-latest.tar.bz2: OK
</pre>

<p>
Im nächsten Schritt werden wir den Snapshot in Ihrem Dateisystem entpacken.
Kontrollieren Sie, dass Sie den exakten Befehl verwenden; die letzte Option
ist ein großes <c>C</c>, nicht <c>c</c>.
</p>

<pre caption="Einen Portage-Snapshot entpacken">
# <i>tar xvjf /mnt/gentoo/portage-latest.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

</body>
</subsection>
</section>
<section id="compile_options">
<title>Konfiguration der Compiler-Optionen</title>
<subsection>
<title>Einführung</title>
<body>

<p>
Um Gentoo zu optimieren, können Sie einige Variablen setzen, die Einfluss
auf das Verhalten von Portage nehmen. Alle diese Variablen können als
Umgebungsvariablen (mit <c>export</c>) gesetzt werden, dies ist aber keine
dauerhafte Lösung. Um Ihre Einstellungen zu behalten, bietet Portage Ihnen
<path>/etc/make.conf</path>, eine Konfigurationsdatei für Portage. Diese Datei
werden wir nun bearbeiten.
</p>

<note>
Eine kommentierte Auflistung aller verfügbaren Variablen finden Sie in
<path>/mnt/gentoo/etc/make.conf.example</path>. Für eine erfolgreiche Gentoo
Installation müssen Sie aber nur die im folgenden beschriebenen Variablen
setzen.
</note>

<p>
Starten Sie Ihren Lieblingseditor (in diesem Leitfaden nutzen wir <c>nano</c>)
um die im Folgenden vorgestellten Optimierungsvariablen zu ändern.
</p>

<pre caption="Öffnen von /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Wie Sie sicher sofort bemerkt haben, schaut die Datei
<path>make.conf.example</path> wie eine typische Konfigurationsdatei aus:
auskommentierte Zeilen beginnen mit einem "#", andere Zeilen definieren
Variablen mittels einer <c>VARIABLE="content"</c> Syntax. Die
<path>make.conf</path> Datei nutzt die gleiche Syntax. Einige dieser Variablen
werden nun vorgestellt.
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<p>
Die <c>CHOST</c> Variable deklariert den Zielerstellungs-Host für Ihr System.
Diese Variable sollte schon auf den korrekten Wert gesetzt sein.
<brite>Verändern Sie diese nicht</brite>, denn es kann Ihr System immens
beschädigen. Wenn die <c>CHOST</c> Variable Ihnen falsch zu sein scheint,
verwenden Sie unter Umständen ein falsches stage3 Archiv.
</p>

</body>
</subsection>
<subsection>
<title>CFLAGS und CXXFLAGS</title>
<body>

<p>

Die <c>CFLAGS</c> und <c>CXXFLAGS</c> Variablen definieren die Optimierungen
beispielsweise für den <c>gcc</c> C und C++ Compiler. Obgleich wir diese hier
nur allgemein definieren, erhalten Sie die maximale Leistung nur, wenn Sie die
Flags für jedes Programm einzeln optimieren. Als Begründung sei genannt: Jedes
Programm verhält sich anders.
</p>

<p>
In <path>make.conf</path> sollten Sie die Optimierungs-Flags definieren, von
denen Sie erwarten, dass diese Ihr System <e>insgesamt</e> zu
Geschwindigkeitssteigerungen verhelfen. Machen Sie keine Experimente bei dieser
Variable; zu forsche Optimierung kann dazu führen, dass Programme sich böswillig
verhalten (Abstürze, oder noch viel schlimmer: Fehlfunktionen).
</p>

<p>
Wir werden nicht alle möglichen Optimierungsoptionen erklären. Wenn Sie
diese gerne komplett kennenlernen möchten, schauen Sie sich das
<uri link="http://gcc.gnu.org/onlinedocs/">GNU Online Manual</uri>
oder die <c>gcc</c> Info-Seite (<c>info gcc</c> -- funktioniert erst auf einem
installierten System) an. Die <path>make.conf.example</path> Datei selbst
enthält weitere Beispiele und Informationen; vergessen Sie nicht, diese zu
lesen.
</p>

<p test="not(contains('AMD64 x86', func:keyval('arch')))">
Die erste Einstellung ist das <c>-march=</c> oder <c>-mcpu=</c> Flag, dieses
spezifiziert den Namen der Zielarchitektur. Mögliche Optionen werden in
<path>make.conf.example</path> in den Kommentaren beschrieben.
</p>

<p test="contains('AMD64 x86',func:keyval('arch'))">
Die erste Einstellung ist das <c>-march=</c> oder <c>-mtune=</c> Flag, dieses
spezifiziert den Namen der Zielarchitektur. Mögliche Optionen werden in
<path>make.conf.example</path> in den Kommentaren beschrieben.
</p>

<p>
Die zweite ist das <c>-O</c> Flag (das ist ein großes O, keine Null), welches
für eine <c>gcc</c> Optimierungsklasse steht.
Mögliche Klassen sind <c>s</c> (schlankes Kompilat, engl. size-optimized),
<c>0</c> (eine Null für keine Optimierung), <c>1</c>, <c>2</c> oder <c>3</c>
für auf höhere Geschwindigkeit optimierte Flags (jede Klasse erbt die Flags
der kleineren, zuzüglich ein paar Extras). Die empfohlene Standardeinstellung
ist <c>-O2</c>.
</p>

<p>
Ein weiteres, gerne benutztes Optimierungsflag, ist <c>-pipe</c> (benutzt Pipes
statt temporärer Dateien für die Kommunikation zwischen den verschiedenen
Stufen des Übersetzungsvorganges). Dies hat keinen Einfluss auf den generierten
Code.
</p>

<p>
Die Nutzung von <c>-fomit-frame-pointer</c> (welches den Frame-Pointer nicht in
einem Register bereithält, für Funktionen, die es nicht benötigen) kann
gravierende Auswirkungen auf das Debuggen von Anwendung haben.
</p>

<p>
In <c>CFLAGS</c> und <c>CXXFLAGS</c> sollten Sie gleich mehrere
Optimierungsflags kombinieren. Die im stage3-Archiv enthaltenen Vorgaben
sind für die erste Installation schon richtig eingestellt. Der folgende
Abschnitt dient nur als Beispiel:
</p>

<pre test="not(func:keyval('arch')='AMD64')" caption="Setzen der CFLAGS- und CXXFLAGS-Variablen">
CFLAGS="<keyval id="CFLAGS"/>"
<comment># Benutzen Sie die gleichen Einstellungen für beide Variablen.</comment>
CXXFLAGS="${CFLAGS}"
</pre>

<pre test="func:keyval('arch')='AMD64'" caption="Setzen der CFLAGS- und CXXFLAGS-Variablen">
CFLAGS="<keyval id="CFLAGS"/>"   <comment># EM64T Anwender sollten -march=nocona verwenden</comment>
CXXFLAGS="${CFLAGS}"             <comment># Benutzen Sie die gleichen Einstellungen für beide Variablen</comment>
</pre>


</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Mit <c>MAKEOPTS</c> können Sie festlegen, wie viele Kompilerprozesse parallel
gestartet werden, wenn Sie ein Paket installieren. Eine gute Wahl ist die
Anzahl der CPUs in Ihrem System erhöht um Eins.
</p>

<pre caption="MAKEOPTS eines gewöhnlichen 1-CPU Systems">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Auf die Plätze, fertig, los!</title>
<body>

<p>
Aktualisieren Sie <path>/mnt/gentoo/etc/make.conf</path> nach Ihren
Bedürfnissen und speichern Sie die Datei (<c>nano</c> Benutzer drücken
<c>Strg-X</c>). Nun sind Sie bereit um mit der
<uri link="?part=1&amp;chap=6">Installation des Gentoo Basis-Systems</uri>
fort zu fahren.
</p>

</body>
</subsection>
</section>
</sections>
