<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- English CVS Version: 1.98 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/handbook/hb-install-stage.xml,v 1.40 2006/06/01 00:20:35 grahl Exp $ -->

<sections>

<version>2.11</version>
<date>2006-05-27</date>

<section>
<title>Ein Stagearchiv installieren</title>
<subsection>
<title>Setzen von Zeit/Datum</title>
<body>

<p>
Bevor Sie fortfahren, sollten Sie Ihre Zeit/Datum Einstellung überprüfen und
gegebenenfalls anpassen. Eine falsch eingestellte Uhr kann zu merkwürdigen
Resultaten in der Zukunft führen.
</p>

<p>
Um Zeit und Datum zu überprüfen, führen Sie <c>date</c> aus:
</p>

<pre caption="Zeit/Datum überprüfen">
# <i>date</i>
Fri Mar 29 16:21:18 UTC 2005
</pre>

<p>
Wenn Zeit oder Datum falsch angezeigt wird, passen Sie die Einstellung mit der
<c>date MMDDhhmmYYYY</c> Syntax (<b>M</b>onth, <b>D</b>ay, <b>h</b>our,
<b>m</b>inute und <b>Y</b>ear) an. Zu diesem Zeitpunkt sollten Sie UTC-Zeit
verwenden. Sie werden später die Gelegenheit dazu haben Ihre lokale Zeitzone
anzugeben. Um die Zeiteinstellung auf den 29. März 2005, 16 Uhr 21 zu setzen,
führen Sie zum Beispiel folgenden Befehl aus:
</p>

<pre caption="Setzen von UTC-Zeit/Datum">
# <i>date 032916212005</i>
</pre>

</body>
</subsection>
<subsection>
<title>Eine Wahl treffen</title>
<body>

<p>
Der nächste Schritt ist die Installation des <e>Stage3</e>-Archivs auf Ihrem
System. Sie können den entsprechenden Tarball aus dem Internet laden oder, wenn
Sie von einer der Gentoo Universal-Installations-CDs gebootet haben, von einer
CD kopieren. Wenn Sie die Universal CD haben und das Stage-Archiv welches Sie
nutzen möchten auf dieser CD enthalten ist, ist es eine reine
Bandbreitenverschwendung das Stagearchiv noch einmal herunterzuladen, da diese
Stages gleich sind. In den meisten Fällen hilft Ihnen das Kommando <c>uname
-m</c> die Entscheidung abzunehmen, welches Stagearchiv für Sie das geeignete
ist.
</p>

<ul>
<li><uri link="#doc_chap2">Standard: Herunterladen aus dem Internet</uri></li>
<li><uri link="#doc_chap3">Alternativ: Stagearchiv von der Installations-CD 
benutzen</uri></li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Standard: Herunterladen aus dem Internet</title>
<subsection>
<title>Herunterladen des Stagearchivs</title>
<body>

<p>
Wechseln Sie nun zum Gentoo-Mountpoint, jenes Verzeichnis unter dem
Sie vorhin Ihre zukünftige Gentoo-Partition eingebunden haben
(wahrscheinlich <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln zum Gentoo-Mountpoint">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Abhängig vom Installationsmedium finden Sie verschiedene Programme um das
Stagearchiv herunter zu laden. Falls <c>links</c> verfügbar ist, können Sie 
sofort die <uri link="http://www.gentoo.org/main/en/mirrors.xml">Gentoo
Mirrorliste</uri> ansteuern und und einen Mirror in Ihrer Nähe auswählen.
</p>

<p>
Wenn <c>links</c> nicht verfügbar ist sollte Ihnen <c>lynx</c> bereit stehen.
Wenn Sie über einen Proxy in das Internet gehen, exportieren Sie die
<c>http_proxy</c> und <c>ftp_proxy</c> Variablen:
</p>

<pre caption="Konfiguration der Proxy Informationen für lynx">
# <i>export http_proxy="http://proxy.server.com:port"</i>
# <i>export ftp_proxy="http://proxy.server.com:port"</i>
</pre>

<p>
Wir gehen ab jetzt davon aus, dass Ihnen <c>links</c> zur Verfügung steht.
</p>

<p>
Wechseln Sie nun in das Verzeichnis <path>releases/</path>, gefolgt von Ihrer
Rechnerarchitektur (zum Beispiel <path>x86/</path>) und der Gentoo-Version
(<path>2006.0</path>). In dem Verzeichnis <path>stages/</path> finden Sie die
für Ihren Rechnertypen verfügbaren Stagearchiv, die gegebenenfalls in
individuellen Unterverzeichnissen abgelegt sind. Wählen Sie das passende
Archiv und starten den Download mit der Taste <c>D</c>. Nach dem Download
können Sie den Browser mit der Taste <c>Q</c> schließen.
</p>

<pre caption="Mirrorliste mit links anschauen">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Wenn Sie Proxy-Unterstützung in links benötigen:)</comment>
# <i>links -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Stellen Sie sicher, dass Sie ein stage3-Archiv herunterladen. Installationen
mit einem stage1- oder stage2-Archiv werden nicht länger unterstützt.
</p>

<p>
Wenn Sie die Integrität des heruntergeladenen Stagearchives prüfen wollen,
benutzen Sie <c>md5sum</c> und vergleichen Sie die Ausgabe mit den auf dem
Mirror gespeicherten MD5 Prüfsummen. So würden Sie zum Beispiel die Integrität
eines x86-Stagearchivs kontrollieren:
</p>

<pre caption="Integrität eines Stagearchivs prüfen">
# <i>md5sum -c stage3-x86-2006.0.tar.bz2.DIGESTS</i>
stage3-x86-2006.0.tar.bz2: OK
</pre>

</body>
</subsection>
<subsection>
<title>Entpacken des Stagearchivs</title>
<body>

<p>
Nun entpacken Sie das heruntergeladene Stagearchiv auf Ihrem System.
Wir benutzen <c>tar</c> dafür, weil es die einfachste Methode ist:
</p>

<pre caption="Entpacken des Stagearchivs">
# <i>tar xvjpf stage3-*.tar.bz2</i>
</pre>

<p>
Stellen Sie sicher, dass Sie die gleichen Schalter (<c>xvjpf</c>) verwenden.
Das <c>x</c> steht für <e>Auspacken</e> (engl. <e>Extract</e>), das <c>v</c>
für <e>Auskunftsfreudig</e> (engl. <e>Verbose</e>) um zu sehen, was während des
Entpackvorgangs passiert (optional), das <c>j</c> für
<e>Dekomprimieren mit bzip2</e>, das <c>p</c> für <e>Erhalt der Dateirechte</e>
(engl. <e>Preserve permissions</e>) und das <c>f</c> zeigt an, dass wir eine
Datei auspacken wollen und nicht die Standardeingabe benutzen.
</p>

<note>
Die Installations-CDs und Boot-Images einiger Architekturen (zum Beispiel MIPS)
beinhalten das in BusyBox enthaltene <c>tar</c>, welches die <c>-v</c> Option
momentan nicht unterstützt. Verwenden Sie die <c>xjpf</c> Optionen stattdessen.
</note>

<p>
Wenn das Stagearchiv installiert ist, fahren Sie nun mit der
<uri link="#installing_portage">Installation von Portage</uri> fort.
</p>

</body>
</subsection>
</section>
<section>
<title>Alternativ: Stagearchiv von der Installations CD benutzen</title>
<subsection>
<title>Entpacken des Stagearchiv</title>
<body>

<impo>
Wenn Sie x86 verwenden und die Installer LiveCD benutzen werden Sie
<e>keine</e> Stages auf Ihrer CD haben. Sie werden den Anweisungen für <uri
link="#doc_chap2">Verwenden eines Stage-Tarballs aus dem Internet</uri> folgen
müssen.
</impo>

<p>
Die Stagearchiv auf der CD liegen im Verzeichnis <path>/mnt/cdrom/stages</path>.
Um eine Auflistung zu erhalten, benutzen Sie <c>ls</c>:
</p>

<pre caption="Liste aller verfügbarer Stagearchive">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Falls das System mit einem Fehler wie unten antwortet, müssen Sie die
CD-ROM mounten:
</p>

<pre caption="Mounten der CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Nun gehen Sie zu Ihrem Gentoo-Mountpunkt (gewöhnlich <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln des Verzeichnisses zu /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Wir werden nun das von Ihnen gewählte Stagearchiv entpacken. Dies erledigt
<c>tar</c>. Benutzen Sie die gleichen Schalter (<c>xvjpf</c>). Das <c>v</c>
Argument ist optional und in einigen <c>tar</c> Versionen nicht unterstützt.
Beispielhaft entpacken wir das Stagearchiv 
<path>stage3-&lt;Subarchitektur&gt;-2006.0.tar.bz2</path>. Ersetzen Sie den
Dateinamen durch den Ihres Stagearchivs.
</p>

<pre caption="Entpacken des Stagearchivs">
# <i>tar xvjpf /mnt/cdrom/stages/stage3-&lt;Subarchitektur&gt;-2006.0.tar.bz2</i>
</pre>

<p>
Wenn das Stagearchiv installiert ist, fahren Sie nun mit der
<uri link="#installing_portage">Installation von Portage</uri> fort.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Installation von Portage</title>
<subsection>
<title>Einen Portage-Snapshot entpacken</title>
<body>

<p>
Sie müssen einen Snapshot des Portage-Tree installieren, eine Sammlung von
Dateien, die Portage informieren, welche Porgramme installiert werden können,
welche Profile es gibt, etc.
</p>

</body>
</subsection>
<subsection id="installing_from_internet">
<title>Herunterladen und Installieren eines Portage-Snapshots</title>
<body>

<p>
Wechseln Sie zu dem Mountpoint, an den Sie Ihre Dateisystem gemountet haben
(meistens <path>/mnt/gentoo</path>):
</p>

<pre caption="Wechseln zum Mountpoint">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Starten Sie <c>links</c> (oder <c>lynx</c>) und wechseln Sie auf die <uri
link="http://www.gentoo.org/main/en/mirrors.xml">Gentoo Mirror Liste</uri>.
Wählen Sie einen nahegelegenen Mirror aus und üffnen Sie das
<path>snapshots/</path> Verzeichnis. Laden Sie von dort den aktuellsten Snapshot
herunter, indem Sie <c>D</c> drücken.
</p>

<pre caption="Anschauen der Gentoo Mirror Liste">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Schliessen Sie den Browser nun mittles <c>Q</c>. Sie haben nun einen Snapshot
in <path>/mnt/gentoo</path> liegen.
</p>

<p>
Wenn Sie die Integrität des heruntergeladenen Snapshosts überprüfen wollen
können Sie <c>md5sum</c> verwenden und die Ausgabe mit der auf unserem Mirror
bereitgestellten MD5-Prüfsumme vergleichen.
</p>

<pre caption="Integrität eines Portage-Snapshots überprüfen">
# <i>md5sum -c portage-latest.tar.bz2.md5sum</i>
portage-latest.tar.bz2: OK
</pre>

<p>
Im nächsten Schritt werden wir den Snapshot in Ihrem Dateisystem entpacken.
Kontrollieren Sie, dass Sie den exakten Befehl verwenden; die letzte Option
ist ein großes <c>C</c>, nicht <c>c</c>.
</p>

<pre caption="Einen Portage-Snapshot entpacken">
<comment>(Ersetzen Sie &lt;datum&gt; mit dem Datum des heruntergeladenen Snapshot)</comment>
# <i>tar xvjf /mnt/gentoo/portage-&lt;datum&gt;.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

</body>
</subsection>
</section>
<section id="compile_options">
<title>Konfiguration der Compiler-Optionen</title>
<subsection>
<title>Einführung</title>
<body>

<p>
Um Gentoo zu optimieren, können Sie einige Variablen setzen, die Einfluss
auf das Verhalten von Portage nehmen. Alle diese Variablen können als
Umgebungsvariablen (mit <c>export</c>) gesetzt werden, dies ist aber keine
dauerhafte Lösung. Um Ihre Einstellungen zu behalten, bietet Portage Ihnen
<path>/etc/make.conf</path>, eine Konfigurationsdatei für Portage. Diese Datei
werden wir nun bearbeiten.
</p>

<note>
Eine kommentierte Auflistung aller verfügbaren Variablen finden Sie in
<path>/mnt/gentoo/etc/make.conf.example</path>. Für eine erfolgreiche Gentoo
Installation müssen Sie aber nur die im folgenden beschriebenen Variablen
setzen.
</note>

<p>
Starten Sie Ihren Lieblingseditor (in diesem Leitfaden nutzen wir <c>nano</c>)
um die im Folgenden vorgestellten Optimierungsvariablen zu ändern.
</p>

<pre caption="Öffnen von /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Wie Sie sicher sofort bemerkt haben, schaut die Datei <path>make.conf.example</path>
wie eine typische Konfigurationsdatei aus: auskommentierte Zeilen beginnen mit
einem "#", andere Zeilen definieren Variablen mittels einer
<c>VARIABLE="content"</c> Syntax. Die <path>make.conf</path> Datei nutzt die
gleiche Syntax. Einige dieser Variablen werden nun vorgestellt.
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<p>
Die <c>CHOST</c> Variable deklariert den Zielerstellungs-Host für Ihr System.
Diese Variable sollte schon auf den korrekten Wert gesetzt sein. 
<brite>Verändern Sie diese nicht</brite>, denn es kann Ihr System immens
beschädigen. Wenn die <c>CHOST</c> Variable Ihnen falsch zu sein scheint,
verwenden Sie unter Umständen ein falsches stage3 Archiv.
</p>

</body>
</subsection>
<subsection>
<title>CFLAGS und CXXFLAGS</title>
<body>

<p>

Die <c>CFLAGS</c> und <c>CXXFLAGS</c> Variablen definieren die Optimierungen
beispielsweise für den <c>gcc</c> C und C++ Compiler. Obgleich wir diese hier
nur allgemein definieren, erhalten Sie die maximale Leistung nur, wenn Sie die
Flags für jedes Programm einzeln optimieren. Als Begründung sei genannt: Jedes
Programm verhält sich anders.
</p>

<p>
In <path>make.conf</path> sollten Sie die Optimierungs-Flags definieren, von
denen Sie erwarten, dass diese Ihr System <e>insgesamt</e> zu Geschwindigkeitssteigerungen
verhelfen. Machen Sie keine Experimente bei dieser Variable; zu forsche
Optimierung kann dazu führen, dass Programme sich böswillig verhalten (Abstürze,
oder noch viel schlimmer: Fehlfunktionen).
</p>

<p>
Wir werden nicht alle möglichen Optimierungsoptionen erklären. Wenn Sie 
diese gerne komplett kennenlernen möchten, schauen Sie sich das
<uri link="http://gcc.gnu.org/onlinedocs/">GNU Online Manual</uri>
oder die <c>gcc</c> Info-Seite (<c>info gcc</c> -- funktioniert erst auf einem
installierten System) an. Die <path>make.conf.example</path> Datei selbst
enthält weitere Beispiele und Informationen; vergessen Sie nicht, diese zu
lesen.
</p>

<p>
Die erste Einstellung ist das <c>-march=</c> Flag, dieses spezifiziert den
Namen der Zielarchitektur. Mögliche Optionen werden in <path>make.conf.example</path>
in den Kommentaren beschrieben. Ein Beispiel wäre die Einstellung für eine x86 
Athlon-XP Architektur:
</p>

<pre caption="Die GCC march Einstellung">
<comment># AMD64 Benutzer die ein natives 64-Bit-System nutzen möchten sollten -march=k8 benutzen</comment>
<comment>#EM64T Benutzer sollten -march=nocona verwenden</comment>
-march=athlon-xp
</pre>

<p>
Die zweite ist das <c>-O</c> Flag (das ist ein großes O, keine Null), welches
für eine <c>gcc</c> Optimierungsklasse steht.
Mögliche Klassen sind <c>s</c> (schlankes Kompilat, engl. size-optimized),
<c>0</c> (eine Null für keine Optimierung), <c>1</c>, <c>2</c> oder <c>3</c>
für auf höhere Geschwindigkeit optimierte Flags (jede Klasse erbt die Flags
der kleineren, zuzüglich ein paar Extras). Zum Beispiel eine Klasse-2-Optimierung:
</p>

<pre caption="Die GCC O Einstellung">
-O2
</pre>

<p>
Ein weiteres, gerne benutztes Optimierungsflag, ist <c>-pipe</c> (benutzt Pipes
statt temporärer Dateien für die Kommunikation zwischen den verschiedenen
Stufen des Übersetzungsvorganges).
</p>

<p>
Beachten Sie, dass die Nutzung von <c>-fomit-frame-pointer</c> erhebliche
Auswirkungen auf das Debuggen von Anwendungen haben kann! (Durch Benutzung
dieses Flags werden die Frame Pointer für Funktionen, die diese nicht brauchen, nicht mehr
in einem Register gespeichert.)
</p>

<p>
In <c>CFLAGS</c> und <c>CXXFLAGS</c> können Sie mehrere Optimierungsflags
kombinieren, wie das folgende Beispiel zeigt:
</p>

<pre caption="Setzen der CFLAGS und CXXFLAGS Variablen">
CFLAGS="-march=athlon-xp -pipe -O2" <comment># AMD64 Benutzer sollten march=k8 benutzen</comment>
                                    <comment># EM64T Benutzer sollten -march=nocona verwenden</comment>
CXXFLAGS="${CFLAGS}"                <comment># Benutzen Sie die gleichen Einstellungen für beide Variablen</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Mit <c>MAKEOPTS</c> können Sie festlegen, wieviele Kompilerprozesse parallel
gestartet werden, wenn Sie ein Paket installieren. Eine gute Wahl ist die
Anzahl der CPUs in Ihrem System erhöht um Eins.
</p>

<pre caption="MAKEOPTS eines gewöhnlichen 1-CPU Systems">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Auf die Plätze, fertig, los!</title>
<body>

<p>
Aktualisieren Sie <path>/mnt/gentoo/etc/make.conf</path> nach Ihren
Bedürfnissen und speichern Sie die Datei (<c>nano</c> Benutzer drücken
<c>Strg-X</c>). Nun sind Sie bereit um mit der
<uri link="?part=1&amp;chap=6">Installation des Gentoo Basis-Systems</uri>
fort zu fahren.
</p>

</body>
</subsection>
</section>
</sections>
