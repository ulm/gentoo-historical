<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- English CVS Version: 1.82 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/handbook/hb-install-system.xml,v 1.36 2005/08/08 03:25:05 grahl Exp $ -->

<sections>

<version>2.9</version>
<date>2005-07-30</date>

<section>
<title>Chroot</title>
<subsection>
<title>Optional: Auswahl eines Mirrors</title>
<body>

<p>
Um Sourcecode schnell herunterladen zu können, empfehlen wir einen schnellen
Spiegel auszuwählen. Portage schaut in <path>make.conf</path> nach einer
GENTOO_MIRRORS Variable und benutzt die dort gelisteten Spiegel. Sie können auf
unserer <uri link="/main/en/mirrors.xml">Spiegelübersicht</uri> nach einem
nahegelegenen Spiegel suchen  (da diese meist auch die schnellsten sind), wir
bieten jedoch auch ein nettes Tool namens <c>mirrorselect</c> an, welches Ihnen
diesen Schritt abnimmt.
</p>

<pre caption="Nutztung von mirrorselect für die GENTOO_MIRRORS Variable">
# <i>mirrorselect -a -s4 -o | grep 'GENTOO_MIRRORS=' &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Wählen Sie keine IPv6 Spiegel aus. Unsere Stage Archive unterstützen zur Zeit
noch kein IPv6.
</warn>

<p>
Eine zweite wichtige Konfiguration ist die SYNC Variable in
<path>make.conf</path>. Diese Variable enthält den rsync Server, den Sie zum
aktualisieren Ihres Portage Trees (die Kollektion von Ebuilds, Skripte die alle
Informationen enthalten, die Portage zur Installation von Software benötigt)
verwenden wollen. Auch wenn Sie dies manuell festlegen können,
<c>mirrorselect</c> kann Ihnen auch diesen Schritt abnehmen:
</p>

<pre caption="Mit mirrorselect einen rsync Server auswählen">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Nachdem Sie <c>mirrorselect</c> ausgeführt haben, ist es ratsam die
Einstellungen in <path>/mnt/gentoo/etc/make.conf</path> sorgfältig zu
überprüfen.
</p>

</body>
</subsection>
<subsection>
<title>Kopieren der DNS Informationen</title>
<body>

<p>
Einen Schritt müssen Sie noch machen, bevor Sie Ihre neue Umgebung betreten
können. Das ist das Kopieren der DNS Informationen aus der
<path>/etc/resolv.conf</path> in die Chroot Umgebung. Sie müssen diesen Schritt
ausführen, um sicherzustellen, dass Ihr Netzwerk nach dem Betreten der Chroot
Umgebung noch funktioniert. <path>/etc/resolv.conf</path> enthält die Nameserver
für Ihr Netzwerk.
</p>

<pre caption="Kopieren der DNS Informationen">
<comment>(Die "-L" Option wird benötigt um sicherzustellen, dass Sie keinen symbolischen Link kopieren</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Mounten des proc Dateisystem</title>
<body>

<p>
Mounten Sie das <path>/proc</path> Dateisystem nach
<path>/mnt/gentoo/proc</path>, um für die Installation vom Kernel angebotene
Informationen innerhalb der chroot Umgebung nutzbar zu machen.
</p>

<pre caption="Mounten von /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Betreten der neuen Umgebung</title>
<body>

<p>
Nachdem nun alle Partitionen initialisiert und das Basis System installiert
ist, können Sie nun Ihre neue Installationsumgebung betreten, indem Sie
in die Umgebung chrooten. Das bedeutet, dass Sie von der aktuellen
Installationsumgebung (die Installations CD oder ein anderes Installationsmedium) in Ihr
zu installierendes System (nämlich das der initialisierten Partitionen) wechseln.
</p>

<p>
Das chrooting erfolgt in 3 Schritten. Als erstes werden wir das root von
<path>/</path> (auf dem Installationsmedium) nach /mnt/gentoo (auf Ihren
Partitionen) mittels chroot wechseln. Sie müssen nun eine neue Umgebung
anlegen, indem Sie <c>env-update</c> benutzen, was hauptsächlich neue
Umgebungsvariablen anlegt. Zu guter Letzt laden Sie diese Variablen durch
den Befehl <c>source</c> in den Speicher.
</p>

<pre caption = "Chroot in die neue Umgebung">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
  * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Glückwunsch! Sie sind nun in Ihrer neuen Gentoo Linux Umgebung. Natürlich sind
wir noch nicht fertig, darum gibt es auch noch einige Abschnitte in der Anleitung
denen Sie folgen müssen.
</p>

</body>
</subsection>
<subsection>
<title>Portage Tree updaten</title>
<body>

<p>
Sie sollten nun Ihren Portage Tree auf den aktuellsten Stand bringen. <c>emerge
--sync</c> macht dies für Sie.
</p>

<pre caption="Portage Tree updaten">
# <i>emerge --sync</i>
<comment>(Wenn Sie ein langsames Terminal verwenden, wie einige Framebuffer 
oder eine serielle Konsole, dann können Sie die --quiet Option hinzufügen um 
den Vorgang zu beschleunigen)</comment>
# <i>emerge --sync --quiet</i>
</pre>

<p>
Wenn Sie sich hinter einer Firewall befinden, die rsync Verkehr blockiert,
können Sie <c>emerge-webrsync</c> benutzen, welches einen Snapshot herunterladen
und installieren wird.
</p>

<p>
Falls Sie gewarnt werden, dass eine neue Portage Version verfügbar ist,
sollten Sie diese Meldung ignorieren. Portage wird zu einem
späteren Zeitpunkt während der Installation für Sie aktualisiert.
</p>

</body>
</subsection>
<subsection>
<title>Auswahl des richtigen Profils</title>
<body>

<p>
Zunächst ist eine kleine Defintion notwendig.
</p>

<p>
Ein Profil ist existenziell für ein Gentoo System. Es definiert nicht nur
Standardwerte für CHOST, CFLAGS und andere wichtige Variablen, es beschränkt das
System auch auf eine definierte Masse an Paketversionen. Dies alles wird von
Gentoo Entwicklern betreut.
</p>

<p>
Bisher hatten Gentoo Benutzer mit Profilen wenig zu tun. Jedoch können x86, 
hppa und alpha Benutzer zwischen zwei Profilen wählen. Eins für einen 2.4 
Kernel und eins für einen 2.6 Kernel. Diese Anforderung wurde eingeführt um 
die Integration des 2.6 Kernels zu verbessern.
</p>

<p>
Sie können das aktuell verwendete Profil mit dem folgenden Kommando anzeigen:
</p>

<pre caption="Ansicht des verwendeten Profil">
# <i>ls -l /etc/make.profile</i>
lrwxrwxrwx  1 48 Apr  8 18:51 /etc/make.profile ->
../usr/portage/profiles/default-linux/x86/2005.0/
</pre>

<p>
Wenn Sie eine der grad erwähnten drei Architekturen benutzen, werden Sie ein 
<path>2.4</path> Unterverzeichnis sehen. Dies identifiziert ein zusätzliches 
Profil unterhalb dessen auf das der <path>make.profile</path> Symlink verweist:
</p>

<pre caption="Herausfinden ob weitere Profile existieren">
# <i>ls -FGg /etc/make.profile/</i>
total 8
drwxr-xr-x  2 120 Jan 21 23:08 2.4/
-rw-r--r--  1 679 Mar 29 00:35 packages
-rw-r--r--  1 343 Dec  3  2004 parent
</pre>

<p>
Wie Sie in obigem Beispiel sehen können, enthält das aktuelle Profil ein 
<path>2.4</path> Unterverzeichnis. Dies bedeutet, dass Ihr aktuelles Profil 
auf einem 2.6 Kernel basiert und Sie Ihr Profil auf ein 2.4-basierendes System 
wechseln können. Dafür müssen Sie den <path>make.profile</path> Symlink auf 
das <path>2.4</path> Unterverzeichnis verlinken:
</p>

<pre caption="Auf ein 2.4 Profil wechseln">
<comment>(Stellen Sie sicher, dass Sie die richtige Architektur verwenden. Das folgende Beispiel ist für x86)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/x86/2005.0/2.4 /etc/make.profile</i>
<comment>(Auflisten der Dateien im 2.4 Profil)</comment>
# <i>ls -FGg /etc/make.profile/</i>
total 12
-rw-r--r--  1 939 Dec 10 14:06 packages
-rw-r--r--  1 347 Dec  3  2004 parent
-rw-r--r--  1 573 Dec  3  2004 virtuals
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Konfiguration der USE Variable</title>
<body>

<p>
<c>USE</c> heißt eine der mächtigsten Variablen, die Gentoo seinen Benutzern
anbietet. Viele Programme können mit oder ohne optionale Unterstützung für 
bestimmte Dinge übersetzt werden. Beispielsweise können einige Programme mit
gtk Unterstützung oder mit qt Unterstützung übersetzt werden oder mit keiner
der beiden. Einige Programme können mit oder ohne SSL Unterstützung übersetzt
werden. Einige Programme können sogar mit Framebuffer Support (svgalib) 
anstelle von X11 Support (X-server) übersetzt werden.
</p>

<p>
Die meisten Distributionen kompilieren ihre Pakete mit eingeschalteter
Unterstützung für alles, was möglich ist. Dies vergrößert die Programme,
verlängert die Startzeit und, nicht zu vergessen, erhöht die Abhängigkeiten.
Mit Gentoo können Sie selbst bestimmen, mit welchen Optionen ein Paket übersetzt
werden soll. Hier kommen die <c>USE</c> Variable ins Spiel.
</p>

<p>
Mit der <c>USE</c> Variable definieren Sie Schlagworte, die dann auf
Optionen beim Übersetzen abgebildet werden. Zum Beispiel wird <e>ssl</e>
zu SSL Unterstützung führen, wenn das Programm dies unterstützt.
<e>-X</e> entfernt die X-Server Unterstützung (beachten Sie das
Minuszeichen). <e>gnome gtk -kde -qt</e> führt zu übersetzten
Programmen mit Gnome (und gtk) Unterstützung aber ohne KDE (und QT)
Unterstützung, also zu einem ganz auf Gnome ausgerichteten System.
</p>

<p>
Die Standardeinstellungen für <c>USE</c> sind in der
<path>make.defaults</path> Datei in Ihrem Profil definiert.
Sie finden <path>make.defaults</path> Dateien in dem Verzeichnis, auf welches
<path>/etc/make.profile</path> zeigt und übergeordneten Verzeichnissen. Die
Gesamtheit aller aktivierten USE Flags ergibt sich aus allen <c>USE</c>
Angaben in allen <path>make.defaults</path> Dateien.
Was Sie in <path>/etc/make.conf</path> platzieren, wird zu den Standardeinstellungen
addiert. Wenn Sie der <c>USE</c> Einstellung etwas hinzufügen, werden die
Standardvorgaben damit erweitert. Wenn Sie von der <c>USE</c> Einstellung
etwas entfernen (mit einem Minuszeichen davor), so wird dies
aus der Standardeinstellung entfernt (falls es überhaupt in dieser
vorhanden war). <e>Niemals</e> sollten Sie irgendwas in
<path>/etc/make.profile</path> modifizieren; dies wird beim nächsten Portage
Update überschrieben!
</p>

<p>
Eine vollständige Beschreibung zu <c>USE</c> können Sie im zweiten Teil des
Gentoo Handbuch, <uri link="?part=2&amp;chap=2">USE Flags</uri>,
lesen. Eine vollständige Beschreibung der USE Flags finden Sie in Ihrem System
in <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Verfügbare USE Flags anschauen">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Sie können mit den Pfeiltasten scrollen, verlassen Sie less mit 'q')</comment>
</pre>

<p>
Als Beispiel nun die <c>USE</c> Einstellung für ein
KDE-basiertes System mit Überstützung für DVD, ALSA und
CD-Brenner.
</p>

<pre caption="/etc/make.conf Öffnen">
# <i>nano -w /etc/make.conf</i>
</pre>

<p>
Eine vollständige Beschreibung zu <c>USE</c> können Sie in unserem
<uri link="?part=2&amp;chap=2">USE Howto</uri> finden.
Als Beispiel nun die <c>USE</c> Einstellung für ein
KDE-basiertes System mit Überstützung für DVD, ALSA und
CD-Brenner.
</p>

<pre caption="USE Einstellung">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Optional: GLIBC Locales</title>
<body>

<p>
Sie werden vermutlich nur ein oder vielleicht zwei Locales in Ihrem System
benötigen. Bisher wurden nach dem Kompilieren der <c>glibc</c> alle verfügbaren
Locales erstellt. Von jetzt an können Sie das <c>userlocales</c> USE Flag
aktivieren und die Locales, die Sie benötigen, in
<path>/etc/locales.build</path> angeben. Tun Sie dies nur, wenn Sie wissen,
welche Locales Sie benötigen. Dies wird während des Bootstrap nicht
funktionieren, jedoch bei späteren Rekompilierungen.
</p>

<pre caption="Aktivieren des userlocales USE Flag für die glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Geben Sie nun die von Ihnen benötigten Locales an:
</p>

<pre caption="/etc/locales.build öffnen">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Die folgenden Locales sind ein Beispiel um Englische (Vereinigte Staaten) und
Deutsche (Deutschland) Locales in den entsprechenden Charakterformaten (wie
UTF-8) zu bekommen.
</p>

<pre caption="Spezifizieren der Locales">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

</body>
</subsection>
</section>
<section>
<title>Unterschiede zwischen Stage1, Stage2 and Stage3</title>
<body>

<p>
Nun lehnen Sie sich zurück und überdenken Ihre bisher getätigten Entscheidungen.
Wir baten Sie, sich zwischen einem <e>stage1</e>, <e>stage2</e> oder <e>stage3</e>
Archiv zu entscheiden und wiesen darauf hin, dass Ihre Wahl wichtig ist für die
folgenden Installationsschritte. An erster Stelle steht jetzt Ihre Wahl, diese
beeinflusst die nächsten Schritte.
</p>

<ul>
<li>
 Wenn Sie <e>stage1</e> auswählen, müssen Sie <e>beiden</e> Abschnitten
 in diesem Kapitel folgen  (angefangen bei <uri link="#doc_chap3">Fortschritt
 von Stage1 zu Stage2</uri>)
</li>
<li>
 Falls Sie <e>stage2</e> auswählen, ignorieren Sie den ersten Abschnitt und
 fahren mit dem zweiten fort (<uri link="#doc_chap4">Fortschritt von Stage2
 zu Stage3</uri>).
</li>
<!--  Für 2005.1 behalten
<li>
 Falls Sie <e>stage3</e> wählen, können Sie beide Schritte
 ignorieren und mit der <uri link="?part=1&amp;chap=7">Konfiguration des Kernels</uri>
 fortfahren.
</li>
-->
<li>
Falls Sie <e>stage3</e> auswählen, sollten Sie Ihr <uri 
link="#upgrade-baselayout">baselayout Paket aktualisieren</uri>.
</li>
</ul>

</body>
</section>
<section>
<title>Von Stage1 zu Stage2</title>
<subsection>
<title>Einführung ins bootstrapping</title>
<body>

<p>
So, Sie wollen also wirklich alles von Grund auf kompilieren? Fein! :-)
</p>

<p>
In diesem Schritt, werden wir ihr Gentoo System <e>bootstrappen</e>. Dieser
Schritt benötigt eine Menge Zeit, aber das Ergebnis ist ein System, das
von Grund auf für Ihren Computer und Ihren Anforderungen optimiert wurde.
</p>

<p>
<e>Bootstrappen</e> bedeutet das Bauen der GNU C Library, der GNU Compiler
Collection und verschiedener anderer wichtiger Systemprogramme.
</p>

<p>
Bevor Sie mit bootstrap anfangen, stellen wir Ihnen noch ein paar Optionen vor,
unter anderem wie Sie das System etwas schneller kompilieren können. Wenn Sie
das nicht interessiert und Sie endlich bootstrappen wollen, dann sollten Sie im
Abschnitt <uri link="#bootstrap">Bootstrappen des Systems</uri> weiterlesen.
</p>

</body>
</subsection>
<subsection>
<title>Optional: Zuerst die Quellen herunterladen</title>
<body>

<p>
Wenn Sie zuerst sämtlichen Quellcode herunterladen möchten, bevor Sie das
bootstrap Script starten (zum Beispiel weil Sie Ihre Internetverbindung
nicht offen lassen wollen) benutzen Sie die <e>-f</e> Option des bootstrap
Script. Damit werden alle benötigten Quellcodes heruntergeladen.
</p>

<pre caption = "Herunterladen der nötigen Quellen">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Bootstrappen des Systems</title>
<body>

<p>
Okay, schnappen Sie sich ihr Keyboard und hämmern Sie die nächsten Kommandos
ein um zu bootstrappen. Da dieser Schritt etwas Zeit kostet bis er fertig ist,
sollten Sie sich mit irgendwas anderem beschäftigen.
</p>

<pre caption = "Bootstrappen des Systems">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Nachdem das bootstrap Script erfolgreich durchgelaufen ist, können Sie mit dem
Abschnitt <uri link="#doc_chap4">Von Stage2 zu Stage3</uri> weitermachen.
</p>

</body>
</subsection>
</section>
<section>
<title>Fortschritt von Stage2 zu Stage3</title>
<subsection>
<title>Einführung</title>
<body>

<p>
Falls Sie diese Abschnitt lesen, dann haben Sie bereits das bootstrap Script
ausgeführt oder ein <e>Stage2</e> Archiv entpackt. Nun ist der Moment, in dem
Sie beginnen die wichtigsten Pakete für Ihr System zu kompilieren.
</p>

<p>
<e>Alle</e> Systempakete? Nein, eigentlich nicht. In diesem Schritt werden Sie
nur die Systempakete kompilieren und installieren, zu denen es keine
Alternativpakete gibt. Einige Systempakete haben verschiedene Alternativen
(als Beispiel seien hier die verschiedenen Logging Dienste genannt) und da
Gentoo für seine Auswahlmöglichkeiten bekannt ist, wollen wir Sie nicht zu
einer Entscheidung zwingen.
</p>

</body>
</subsection>
<subsection>
<title>Optional: Sehen was 'emerge system' machen wird</title>
<body>

<p>
Führen Sie bitte <c>emerge --pretend --emptytree system</c> aus, falls Sie wissen wollen,
welche Pakete installiert werden sollen. Dieser Befehl führt alle Pakete auf,
die installiert werden. Da diese Liste sehr gross ist, empfehlen wir Ihnen einen
Pager wie <c>less</c> oder <c>more</c> zu benutzen. Mit diesen Befehlen können
Sie die Liste hoch und runter blättern.
</p>

<pre caption = "Sehen was 'emerge system' machen wird">
# <i>emerge --pretend --emptytree system | less</i>
</pre>

<p>
Beachten Sie, dass wenn Sie die Einstellungen für CFLAGS/CXXFLAGS nicht
verändert haben, es ausreichend ist <c>emerge --pretend --newuse system</c>
aufzurufen. Dadurch werden Anwendungen, die von geänderten USE Flags betroffen
sind neu kompiliert. Wenn Sie die USE Flags ebenfalls nicht geändert haben:
Warum nutzen Sie ein Stage2 Archiv?
</p>

</body>
</subsection>
<subsection>
<title>Optional: Download der Quellen</title>
<body>

<p>
Sie können <c>emerge</c> benutzen um zuerst alle benötigten Quellcodes
herunterzuladen, bevor Sie fortfahren (zum Beispiel weil Sie nicht wollen,
dass die Internetverbindung während der Dauer von 'emerge system' aufrecht
erhalten wird). Dazu benutzen Sie die <e>--fetchonly</e> Option von
<c>emerge</c>.
</p>

<pre caption = "Herunterladen der Quellen">
# <i>emerge --fetchonly --emptytree system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Bauen des Systems</title>
<body>

<p>
Um das System zu bauen, führen Sie bitte <c>emerge --emptytree system</c> aus. Sie sollten
sich in der Zwischenzeit mit etwas anderem beschäftigen, da dieser Schritt viel
Zeit benötigen wird.
</p>

<pre caption = "Kompilieren der grundlegenden Systemprogramme">
# <i>emerge --emptytree system</i>
</pre>

<p>
Nochmal: Wenn Sie die Standardeinstellungen der CFLAGS und CXXFLAGS nicht
angepasst haben, ist ein <c>--newuse</c> völlig ausreichend.
</p>

<p>
Sie können Warnungen zu aktualisierten Konfigurationsdateien (und
<c>etc-update</c>) ignorieren. Nach der Installation und dem ersten Start Ihres
Systems können Sie in der Dokumentation näheres zum <uri
link="?part=3&amp;chap=2#doc_chap3">Schutz von Konfigurationsdateien</uri>
nachlesen.
</p>

</body>
</subsection>
</section>
<section id="upgrade-baselayout">
<title>Aktualisierung von baselayout</title>
<subsection>
<body>

<p>
Das <c>baselayout</c> Paket wurde seit erscheinen von Gentoo 2005.0
entscheidend aktualisiert. Einige Konfigurationsdateien wurden verschoben und 
einige andere verwenden einen neuen Syntax. Dieses Handbuch verwendet nun 
einige neue Konfigurationsdateien. Es wird daher stärkstens empfohlen, dass 
Sie <c>baselayout</c> aktualisieren, bevor Sie zum nächsten Abschnitt übergehen.
</p>

<pre caption="Aktualisieren von baselayout">
# <i>rm /etc/conf.d/net</i>
<comment>(Sicherstellen, dass wir die nsswitch.conf Datei behalten)</comment>
# <i>touch /etc/nsswitch.conf</i>
# <i>CONFIG_PROTECT="-*" emerge baselayout</i>
</pre>

<p>
Bitte fahren Sie mit der <uri link="?part=1&amp;chap=7">Konfiguration des 
Kernels</uri> fort.
</p>

</body>
</subsection>
</section>

</sections>
