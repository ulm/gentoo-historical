<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/handbook/hb-net-modules.xml,v 1.3 2005/08/08 03:39:54 grahl Exp $ -->

<!-- English CVS Version: 1.7 -->

<sections>

<version>1.3</version>
<date>2005-08-02</date>

<section>
<title>Netzwerk-Module</title>
<body>

<p>
Wir unterstützen nun auch modulare Netzwerk-Skripte, sodass wir Unterstützung
für neue Schnittstellen-Typen und Konfigurations-Module hinzugefügt werden 
kann, während die Kompatibilität mit bereits vorhandenen erhalten bleibt.
</p>

<p>
Module werden standardmäßig geladen, wenn das Paket, das sie benötigen,
installiert ist. Wenn Sie hier ein Modul angeben, dessen Paket nicht
installiert ist, erhalten Sie eine Fehler, der Ihnen mitteilt, welche Pakete
installiert werden müssen. Im besten Fall verwenden Sie nur die
Modul-Einstellungen, wenn Sie zwei oder mehr Pakete installiert haben, die den 
gleichen Dienst zur Verfügung stellen, und geben so einem Paket den Vorzug.
</p>

<pre caption="Modul-Präferenz">
<comment># Ziehe iproute2 dem Modul ifconfig vor</comment>
modules=( "iproute2" )

<comment># Sie können auch andere Module als Schnittstelle angeben
# Im folgenden Fall bevorzugen wir udhcpc vor dhcpcd</comment>
modules_eth0=( "udhcpc" )

<comment># Sie können auch angeben, welche Module nicht verwendet werden sollen
#- beispielsweise könnten Sie supplicant oder linux-wlan-ng verwenden um
#die Drahtlos-Konfiguration zu steuern, möchten aber die Netzwerk-Einstellungen
#trotzdem per verbundener ESSID konfigurieren.</comment>
modules=( "!iwconfig" )
</pre>

</body>
</section>
<section>
<title>Schnittstellen-Handler</title>
<body>

<p>
Wir liefern aktuell zwei Schnittstellen: ifconfig und iproute2. Sie benötigen
ein von diesen, um irgendeine Netzwerk-Konfiguration machen zu können.
</p>

<p>
ifconfig ist momentan der Standard bei Gentoo und ist Bestandteil des
Systemprofils. iproute2 ist mächtiger und flexibler, aber nicht standardmäßig
enthalten. 
</p>

<pre caption="Installation von iproute2">
# <i>emerge sys-apps/iproute2</i>

<comment># Um iproute2 vor ifconfig den Vorzug zu geben, falls beide installiert
sind</comment>
modules=( "iproute2" )
</pre>

<p>
Da ifonfig und iproute2 beide sehr ähnlich funktionieren, erlauben wir eine
Zusammenarbeit beider Basis-Konfigurationen. Zum Beispiel funktionieren die 
folgenden beiden Code-Abschnitte unabhängig vom verwendeten Modul.
</p>

<pre caption="Beispiele für ifconfig und iproute2">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># Wir können auch Broadcast angeben</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>

</body>
</section>
<section id="dhcp">
<title>DHCP</title>
<body>

<p>
DHCP ist eine Möglichkeit, Netzwerk-Informationen (IP-Adresse, DNS-Server,
Gateways, etc.) von einem DHCP-Server zu erhalten. Wenn es in Ihrem Netzwerk
einen DHCP-Server gibt, bedeutet dies, dass die Clients nur DHCP verwenden
müssen und der DHCP-Server für das richtige Setup sorgt. Natürlich müssen Sie
andere Dinge, wie Drahtlosnetzwerke, PPP, und so weiter, wenn nötig, selbst
konfigurieren, bevor Sie DHCP verwenden können.
</p>

<p>
DHCP kann durch dhclient, dhcpcd, pump oder udhcpc zur Verfügung gestellt
werden. Jedes DHCP-Modul hat seine Vor- und Nachteile - hier ein kurzer
Überblick.
</p>

<table>
<tr>
  <th>DHCP-Modul</th>
  <th>Paket</th>
  <th>Vorteile</th>
  <th>Nachteile</th>
</tr>
<tr>
  <ti>dhclient</ti>
  <ti>net-misc/dhcp</ti>
  <ti>
    Kommt von ISC, die gleichen Leute, aus deren Feder die BIND DNS-Software
    stammt. In hohem Maße konfigurierbar. 
  </ti>
  <ti>
    Die Konfiguration ist allzu komplex, die Software ist ziemlich überladen,
    kann keine NTP-Server über DHCP erhalten, sendet standardmäßig den Hostnamen
    nicht.  
  </ti>
</tr>
<tr>
  <ti>dhcpcd</ti>
  <ti>net-misc/dhcpcd</ti>
  <ti>
    War lange Zeit der Standard bei Gentoo, keine Abhängigkeiten von fremden
    Tools. 
   </ti>
  <ti>
   Wird nicht mehr gepflegt, kann zeitweise langsam sein, läuft bei unbegrenztem
   Lease nicht als Daemon.
  </ti>
</tr>
<tr>
  <ti>pump</ti>
  <ti>net-misc/pump</ti>
  <ti>
    Leichtgewicht, keine Abhängigkeiten von fremden Tools
  </ti>
  <ti>
    Wird nicht mehr gepflegt, unzuverlässig, insbesondere über Modems, kann
    keine NIS-Server über DHCP erhalten.
  </ti>
</tr>
<tr>
  <ti>udhcpc</ti>
  <ti>net-misc/udhcp</ti>
  <ti>
    Leichtgewicht, kleinster verfügbarer DHCP-Client, für Embedded Systems gebaut.
  </ti>
  <ti>
    Ungeprüft - keine Distro verwendet ihn standardmäßig, kann keine Timeouts
    über 3 Sekunden definieren
  </ti>
</tr>
</table>
     
<p>
Wenn Sie mehr als einen DHCP-Client installiert haben, müssen Sie angeben,
welcher verwendet werden soll - anderenfalls verwenden wir, wenn verfügbar,
dhcpcd als Standard.
</p>

<p>
Verwenden Sie module_eth0="...", um dem Modul bestimmte Optionen zu
übergeben. <e>(ändern Sie module zu dem DHCP-Modul, dass Sie verwenden -
z.B. dhcpcd_eth0)</e>.
</p>

<p>
Wir versuchen DHCP relativ unwissend zu machen - deswegen unterstützen wir die
folgenden Kommandos mit Hilfe der dhcp_eth0-Variable. Der Normalfall ist, keine
davon zu setzen.
</p>

<ul>
  <li>release - gibt die IP-Adresse für die Wiederverwendung frei</li>
  <li>nodns - /etc/resolv.conf nicht überschreiben</li>
  <li>nontp - /etc/ntp.conf nicht überschreiben</li>
  <li>nonis - /etc/yp.conf nicht überschreiben</li>
</ul>

<pre caption="Beispiel-DHCP-Konfiguration in /etc/conf.d/net">
<comment># Wird nur benötigt, wenn mehr als ein DHCP-Module installiert ist.</comment>
modules=( "dhcpcd" ) 

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># Timeout nach 10 Sekunden</comment>
dhcp_eth0="release nodns nontp nonis" <comment># Nur eine Adresse anfordern</comment>
</pre>

<note>
dhcpcd, udhcpc und pump senden im Normalfall den aktuellen Hostnamen den
DHCP-Server, so dass Sie ihn nicht mehr angeben müssen.
</note>

</body>
</section>
<section>
<title>ADSL-Modem</title>
<body>

<p>
Zunächst müssen wir die ADSL-Software installieren.
</p>

<pre caption="Das rp-pppoe-Paket installieren">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
baselayout-1.11.x unterstützt lediglich PPPOE. So Gott will unterstützt eine
zukünftige Version PPPOA.
</warn>

<p>
Nun müssen wir eth0 als ADSL-Schnittstelle konfigurieren und unserer Usernamen
angeben.
</p>

<pre caption="eth0 für ADSL konfigurieren">
config_eth0=( "adsl" )
user_eth0="username"
</pre>

<p>
Schließlich muss Ihr Username und Kennwort in <path>/etc/ppp/pap-secrets</path>
angegeben werden.
</p>

<pre caption="Beispiel einer /etc/ppp/pap-secrets">
<comment># Der * ist wichtig</comment>
"username"  *  "password"
</pre>

</body>
</section>
<section id="apipa">
<title>APIPA (Automatic Private IP Addressing)</title>
<body>

<p>
APIPA versucht, freie Adressen im Bereich 169.254.0.0-169.254.255.255 durch
Ansprechen einer zufälligen Adresse aus diesem Bereich über die Schnittstelle
mit Hilfe von arping zu finden. Wenn darauf keine Antwort erfolgt, wird diese
Adresse der Schnittstelle zugewiesen.
</p>

<p>
Das ist nur für LANs sinnvoll, in dem sich kein DHCP-Server befindet, Sie
sich nicht direkt mit dem Internet verbinden und alle anderen Computer ebenfalls
APIPA verwenden.
</p>

<p>
Für APIPA-Unterstützung muss net-misc/iputils oder net-analyzer/arping emerged
werden.
</p>

<pre caption="APIPA-Konfiguration in /etc/conf.d/net">
<comment># Versuchen Sie zuerst DHCP - schlägt das fehl, greifen Sie auf APIPA
zurück</comment> 
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># Nur APIPA verwenden</comment>
config_eth0=( "apipa" )
</pre>

</body>
</section>
<section>
<title>Bonding</title>
<body>

<p>
Zum bonding/trunking von Links muss net-misc/ifenslave emerged werden.
</p>

<p>
Bonding wird zur Erhöhung der Netzwerk-Bandbreite verwendet. Wenn Sie zwei
Netzwerkkarten im gleichen Netzwerk verwenden, können Sie beide Karten
so verbinden, dass Ihre Anwendungen nur eine Schnittstelle sehen, aber
tatsächlich beide Karten nutzen.
</p>

<pre caption="Bonding-Konfiguration in /etc/conf.d/net">
<comment>Um Schnittstellen zu verbinden</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># Weisen Sie einer verbundenen Schnittstelle keine IP-Adresse
zu</comment>
config_bond0=( "null" )

<comment># Von eth0, eth1 and eth2 abhängen, da sie möglicherweise weitere
Konfiguration benötigen</comment>
depend_bond0() {
  need net.eth0 net.eth1 net.eth2
}
</pre>

</body>
</section>
<section>
<title>Bridging (802.1d-Unterstützung)</title>
<body>

<p>
Für Bridging-Unterstützung muss net-misc/bridge-utils emerged werden.
</p>

<p>
Bridging wird verwendet, um Netzwerke zusammenzufügen. Zum Beispiel:
Sie haben einen Server, der sich über ein ADSL-Modem mit dem Internet
verbindet und eine drahtlose Netzwerkkarte, um andere Computer über das
ADSL-Modem mit dem Internet zu verbinden. Sie könnten nun mit Hilfe einer Bridge
beide Schnittstellen zusammenfügen.
</p>

<pre caption="Bridge-Konfiguration in /etc/conf.d/net">
<comment># Konfigurieren Sie die Bridge - weitere Details liefert "man
btctl"</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># Um Ports zur Bridge br0 hinzuzufügen</comment>
bridge_br0="eth0 eth1"

<comment># Die Ports müssen mit Null-Werten konfiguriert werden, damit DHCP nicht
gestartet wird.</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># Letztendlich weisen Sie der Bridge eine Adresse zu - Sie könnten dazu
auch DHCP verwenden</comment>
config_br0=( "192.168.0.1/24" )

<comment># Von eth0, eth1 and eth2 abhängen, da sie möglicherweise weitere
Konfiguration benötigen</comment>
depend_br0() {
  need net.eth0 net.eth1
}
</pre>

<impo>
Um weitere Bridge-Setups zu verwenden, sollten Sie die Dokumentation zu 
<uri link="?part=4&amp;chap=2#variable_name">Variablennamen</uri>
lesen.
</impo>

</body>
</section>
<section>
<title>MAC-Adresse</title>
<body>

<p>
Um die MAC-Adresse Ihrer Schnittstelle zu ändern, muss nichts emerged werden,
wenn Sie zu einer bestimmten Adresse wechseln. Wenn Sie jedoch zu einer
zufälligen Adresse oder zu einer zufälligen Adresse eines bestimmten Typs 
wechseln müssen, müssen Sie net-analyzer/macchanger emergen.
</p>

<pre caption="Beispiel zum Wechseln der MAC-Adresse">
<comment># Um die MAC-Adresse der Schnittstelle zu setzen</comment>
mac_eth0="00:11:22:33:44:55"

<comment># Um nur die letzten 3 Bytes willkürlich auszuwählen</comment>
mac_eth0="random-ending"

<comment># Um aus gleichen Typen physikalischer Verbindungen (z.B. fibre,
# copper, wireless) willkürlich auszuwählen, alle Hersteller</comment>
mac_eth0="random-samekind"

<comment># Um aus allen Typen physikalischer Verbindungen (z.B. fibre, copper,
# wireless) willkürlich auszuwählen, alle Hersteller</comment>
mac_eth0="random-anykind"

<comment># komplett willkürliche Auswahl - VORSICHT: manche auf diese Weise
generierte MAC-Adressen verhalten sich nicht wie erwartet.</comment>
mac_eth0="random-full"
</pre>

</body>
</section>
<section>
<title>Tunnelling</title>
<body>

<p>
Es muss nichts emerged werden, da der Schnittstellen-Handler alles erledigt.
</p>

<pre caption="Tunnelling-Konfiguration in /etc/conf.d/net">
<comment># Für GRE-Tunnel</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># Für IPIP-Tunnel</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># Um die Schnittstelle zu konfigurieren</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" ) 
</pre>

</body>
</section>
<section>
<title>VLAN (802.1q-Unterstützung)</title>
<body>

<p>

Für VLAN-Unterstützung muss net-misc/vconfig emerged werden.
</p>

<p>
Virtual LAN ist eine Gruppe von Netzwerk-Geräten, die sich verhalten, als wären
sie mit einem einzelnen Netzwerk-Segment verbunden, auch wenn dies nicht der
Fall ist. Mitglieder eines VLANs können nur Mitglieder des gleichen VLANs
sehen, auch wenn sie sich im gleichen physikalischen Netzwerk befinden. 
</p>

<pre caption="VLAN-Konfiguration in /etc/conf.d/net">
<comment># VLAN-Nummer für die Schnittstelle wie folgt angeben</comment>
<comment># Stellen Sie sicher, dass Ihre VLAN-IDs NICHT mit Nullen aufgefüllt sind</comment>
vlans_eth0="1 2"

<comment># Sie können auch das VLAN konfigurieren</comment>
<comment># Weitere Details liefert "man vconfig"</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># Die Schnittstellen wie gewohnt onfigurieren</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Um VLAN-Setups zu verwenden, sollten Sie die Dokumentation 
<uri link="?part=4&amp;chap=2#variable_name">Variablennamen</uri>
lesen.
</impo>

</body>
</section>

</sections>
