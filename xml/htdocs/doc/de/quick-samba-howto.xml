<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/quick-samba-howto.xml,v 1.12 2006/01/11 00:15:21 grahl Exp $ -->

<!-- English CVS Version: 1.20 -->

<guide link="/doc/de/quick-samba-howto.xml" lang="de">
<title>Gentoo Samba3/CUPS/CLAM AV Howto</title>
<author title="Autor">
  <mail link="daff at dword dot org">Andreas "daff" Ntaflos</mail>
</author>
<author title="Autor">
  <mail link="joshua@sungentoo.homeunix.com">Joshua Preston</mail>
</author>
<author title="Übersetzer">
  <mail link="gentoo at thomasgier dot de">Thomas Gier</mail>
</author>

<abstract>
Aufsetzen, installieren und konfigurieren eines Samba-Servers unter Gentoo, der
Dateien und Drucker ohne Treiber-Installation sowie automatisches Scannen nach
Viren bereitstellt.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.12</version>
<date>2005-03-26</date>

<chapter>
<title>Einleitung zu diesem Howto</title>
<section>
<title>Ziel</title>
<body>

<p>
Dieses Howto wurde geschrieben, um Ihnen dabei zu helfen, aus einem Netzwerk, in
dem viele unterschiedliche Clients viele unterschiedliche Sprachen sprechen, ein
Netzwerk zu machen, in dem alle Clients eine gemeinsame Sprache
sprechen. Oberstes Ziel ist es, unterschiedliche Architekturen und Technologien
zu einer produktiven und fröhlich zusammen arbeitenden Umgebung zu verbinden.
</p>

<p>
Das Befolgen der hier dargestellten Instruktionen sollte Sie einen großen 
Schritt weiter zu einer friedlichen Koexistenz von Windows und praktisch allen
Varianten von *nix bringen.
</p>

<p>
Dieses Howto war ursprünglich nicht als Howto gedacht, sondern als FAQ. Es war
geplant, um die Funktionalität und Leistungsfähigkeit von Gentoo Linux und 
Portage sowie die Flexibilität der USE-Flags zu untersuchen. Wie bei so vielen 
anderen Projekten auch, wurde bald deutlich, was im Gentoo Reich noch fehlte: 
es gab keine Samba Howtos, die auf Gentoo User abzielten. Solche User sind 
anspruchsvoller als die meisten; sie verlangen Performance, Flexibilität und 
Anpassungsfähigkeit. Dies beinhaltet aber nicht, das dieses Howto nicht auch für
andere Distributionen gedacht ist, sondern eher, dass es für eine besonders 
maßgeschneiderte Samba-Version vorgesehen ist.
</p>

<p>
In diesem Howto wird beschrieben, wie Dateien und Drucker von Windows-PCs und 
*nix-PCs gemeinsam genutzt werden können. Es soll außerdem den Gebrauch der VFS 
(Virtual File System)-Funktionalität von Samba demonstrieren, um automatischen
Schutz vor Viren mit einzubeziehen. Zu guter Letzt zeigt es, wie Freigaben 
gemountet und manipuliert werden.
</p>

<p>
Es werden einige Themen angesprochen, die eigentlich außerhalb des Rahmens 
dieses Howtos liegen. Sobald ein solches Thema behandelt wird, weisen wir darauf
hin. 
</p>

<p>
Dieses Howto basiert auf einer Redaktion und Zusammenstellung eines exzellenten
Howtos aus den <uri link="http://forums.gentoo.org">Gentoo Foren</uri> von 
Andreas "daff" Naftalos, sowie dem gesammelten Wissen von Joshua Preston. Hier
der Link zum entsprechenden Diskussionsfaden:
</p>

<ul>
  <li>
    <uri link="http://forums.gentoo.org/viewtopic.php?t=110931">Howto
    CUPS+Samba printing from Windows</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>Bevor Sie dieses Howto benutzen</title>
<body>

<p>
Es gibt eine Reihe weiterer Dokumente zur Einrichtung von CUPS und/oder Samba,
die Sie auch lesen sollten, da diese Dinge enthalten, die im vorliegenden Howto
ausgelassen wurden (absichtlich oder aus anderen Gründen). Eins diese Dokumente
ist der sehr nützliche und verständlich geschriebene <uri
link="/doc/de/printing-howto.xml">Leitfaden zur Druckereinrichtung</uri>, da
Konfiguration und spezielle Druckereinrichtung im vorliegenden Dokument nicht
besprochen werden.
</p>

</body>
</section>
<section>
<title>Kurzübersicht</title>
<body>

<p>
Nach der Vorstellung der verschiedenen USE-Flags werden die folgenden Themen
behandelt:
</p>

<ul>
  <li>Auf dem Samba Server:
    <ul>
      <li>Installation und Konfiguration von ClamAV</li>
      <li>Installation und Konfiguration von Samba</li>
      <li>Installation und Konfiguration von CUPS</li>
      <li>Drucker zu CUPS hinzufügen</li>
      <li>PS-Treiber für Windows-Clients hinzufügen</li>
    </ul>
  </li>
  <li>Auf den Unix Clients:
    <ul>
      <li>Installation und Konfiguration von CUPS</li>
      <li>Standarddrucker konfigurieren</li>
      <li>Windows- oder Samba-Freigabe mounten</li>
    </ul>
  </li>
  <li>Auf den Windows-Clients:
    <ul>
      <li>Drucker einrichten</li>
      <li>Auf Samba-Freigaben zugreifen</li>
    </ul>
  </li>
</ul>

</body>
</section>
<section>
<title>Anforderungen</title>
<body>

<p>
Folgende Pakete werden benötigt:
</p>

<ul>
  <li>net-fs/samba</li>
  <li>app-antivirus/clamav</li>
  <li>net-print/cups</li>
  <li>net-print/foomatic</li>
  <li>net-print/hpijs (falls Sie einen HP Drucker benutzen wollen)</li>
  <li>Einen beliebigen Kernel (möglichst 2.4.24+ oder 2.6.x)</li>
  <li>
    Einen Drucker (PS oder non-PS, vielleicht nicht zu neu oder ausgefallen)
  </li>
  <li>
    Ein funktionierendes Netzwerk (home/office/etc) mit mindestens zwei 
    Rechnern
  </li>
</ul>

<p>
Das Hauptpaket, das wir verwenden, heißt net-fs/samba, jedoch benötigen Sie 
einen Kernel mit aktivierter smbfs-Unterstützung, um eine Samba- oder 
Windows-Freigabe mounten zu können. CUPS wird ebenfalls installiert werden, falls das
nicht schon geschehen ist. Weiterhin wird app-antivirus/clamav benötigt, weitere
Pakete sollten einfach anzupassen sein, um mit Samba zu arbeiten.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Samba kennen lernen</title>
<section>
<title>Die USE-Flags</title>
<body>

<p>
Bevor Sie Pakete emergen, schauen Sie sich die verschiedenen USE-Flags an, die
für Samba zur Verfügung stehen.
</p>

<pre caption="Samba verwendet folgende USE-Variablen:">kerberos mysql xml acl
cups ldap pam readline python oav libclamav</pre>

<p>
Abhängig von der Netzwerk-Struktur und den spezifischen Anforderungen des 
Servers bestimmen die unten beschriebenen USE-Flags, welche Bestandteile beim 
emergen von Samba eingebunden oder ausgeschlossen werden.
</p>

<table>
<tr>
  <th><b>USE-Flag</b></th>
  <th>Beschreibung</th>
</tr>
<tr>
  <th><b>kerberos</b></th>
  <ti>
    Bindet die Unterstützung für Kerberos ein. Der Server benötigt dies, wenn
    er sich einer existierenden Domäne oder Active Directory anschließen soll.
    Beachten Sie hierzu auch den Hinweis weiter unten.
  </ti>
</tr>
<tr>
 <th><b>mysql</b></th>
  <ti>
    Dies erlaubt Samba, MySQL für die Passwort-Authentifizierung zu verwenden. 
    Dadurch werden ACLs, Usernamen, Passwörter, etc.in einer Datenbank 
    anstelle einer Datei gespeichert. Setzen Sie dieses USE-Flag, wenn Samba
    zur Passwort-Authentifizierung benötigt wird, zum Beispiel zur 
    Passwort-Validierung oder als Primary Domain Controller (PDC).
 </ti>
</tr>
<tr>
  <th><b>xml</b></th>
  <ti>
    Das xml USE-Flag für Samba stellt ein Passwort-Datenbank-Backend bereit,
    dass die Speicherung von Konto-Details in XML-Dateien erlaubt, aus den 
    gleichen Gründen wie unter MySQL beschrieben.
  </ti>
</tr>
<tr>
  <th><b>acl</b></th>
  <ti>
    Aktiviert Access Control Lists. Die ACL-Unterstützung in Samba verwendet
    eine gepatchtes ext2/ext3 oder SGI's XFS um korrekt zu funktionieren, da
    sie detaillierteren Zugriff auf Dateien und Verzeichnisse ausdehnt; 
    wesentlich weitergehend, als typische *nix GID/UID Schemas.
  </ti>
</tr>
<tr>
  <th><b>cups</b></th>
  <ti>
    Die aktiviert Unterstützung für das Common Unix Printing System. Es stellt
    ein Interface bereit, dass die Freigabe von lokalen CUPS-Druckern im
    Netzwerk erlaubt.
  </ti>
</tr>
<tr>
  <th><b>ldap</b></th>
  <ti>
    Aktiviert das Leightweight Directory Access Protocol (LDAP). Wenn Samba 
    Active Directory verwenden soll, muss die Option verwendet werden. Diese 
    Option würde auch verwendet, wenn Samba sich an eine/n 
    Domäne/Active Directory Server anmelden muss, bzw. die Anmeldung daran
    ermöglicht. Das kerberos USE-Flag wird benötigt, damit diese Option
    funktioniert.
  </ti>
</tr>
<tr>
  <th><b>pam</b></th>
  <ti>
    Unterstützung für Pluggable Authentication Modules (PAM) einbinden. Dies
    stellt die Möglichkeit zur Verfügung, User auf dem Samba-Server zu
    authentifizieren, was erforderlich ist, wenn User sich auf Ihrem Server
    anmelden müssen. Es wird empfohlen, das kerberos USE-Flag zusammen mit pam
    zu verwenden.
  </ti>
</tr>
<tr>
  <th><b>readline</b></th>
  <ti>
    Samba gegen libreadline linken. Dies wird sehr empfohlen und sollte besser
    nicht deaktiviert werden.
  </ti>
</tr>
<tr>
  <th><b>python</b></th>
  <ti>
    Python bindings API. Stellt eine API zur Verfügung, die es Python erlaubt
    sich an Samba anzuschließen.
  </ti>
</tr>
<tr>
  <th><b>oav</b></th>
  <ti>
    Bietet das Scannen von Samba-Freigaben beim Zugriff mit Hilfe des FRISK
    F-Prot Daemons, Kaspersky AntiVirus, OpenAntiVirus.org Scanner-Daemon,
    Sophos Sweep (SAVI), Symantec CarrierScan und Trend Micro(VSAPI).
  </ti>
</tr>
<tr>
  <th><b>libclamav</b></th>
	<ti>
	  Verwenden der ClamAV Bibliothek anstatt des clamd Daemons.
	</ti>
</tr>
</table>

<p>
Eine Reihe von Dingen, die über die USE-Flags und die verschiedenen 
Samba-Funktionen sicherlich zu erwähnen wären, sind:
</p>

<ul>
  <li>
    ACLs mit ext2/ext3 sind durch Erweiterte Attribute (EAs) implementiert. EA und
    ACL Kernel Optionen für ext2 und ext3 müssen aktiviert sein (abhängig vom 
    verwendeten Dateisystem - beide können aktiviert werden).
  </li>
  <li>
    Obwohl Active Directory, ACLs und PDC Funktionen außerhalb des Rahmens dieses
    Howtos liegen, finden Sie die folgenden Links möglicherweise hilfreich in Ihrem
    speziellen Fall:

    <ul>
      <li><uri>http://www.bluelightning.org/linux/samba_acl_howto/</uri></li>
      <li><uri>http://open-projects.linuxcare.com/research-papers/winbind-0812000.html</uri></li>
      <li><uri>http://www.wlug.org.nz/HowToSamba3AndActiveDirectory</uri></li>
    </ul>
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Installation der Server Software</title>
<section>
<title>Samba installieren</title>
<body>

<p>
Zunächst einmal: Stellen Sie sicher, dass alle Ihre Hostnamen korrekt aufgelöst 
werden. Entweder läuft in Ihrem Netzwerk bereits ein funktionierendes Domain Name
System oder es existieren die geeigneten Einträge in der Datei
<path>/etc/hosts</path>. <c>cupsaddsmb</c> versagt häufig, wenn die Hostnamen
nicht auf die richtigen Rechner verweisen.
</p>

<p>
Hoffentlich können Sie bereits eine Einschätzung darüber abgeben, was Sie
tatsächlich brauchen, um Samba in Ihrer speziellen Umgebung zu verwenden. Das
Setup, dass für dieses Howto verwendet wurde, ist:
</p>

<ul>
  <li>oav</li>
  <li>cups</li>
  <li>readline</li>
  <li>pam</li>
</ul>

<p>
Um die Performance, die Größe und die Dauer des Builds zu verbessern, werden die
USE-Flags ausdrücklich eingebunden oder ausgeschlossen. 
</p>

<pre caption="Samba-Emerge">
# <i>echo "net-fs/samba oav readline cups pam" &gt;&gt; /etc/portage/package.use</i>
# <i>emerge net-fs/samba</i>
</pre>

<note>
Für die folgenden Architekturen muss <e>~</e> zu den <e>KEYWORDS</e> hinzugefügt
werden: x86, ppc, sparc, hppa, ia64 und alpha.
</note>

<p>
Hierdurch wird Samba und CUPS (wenn noch nicht auf dem System vorhanden) emerged.
</p>

</body>
</section>
<section>
<title>ClamAV emergen</title>
<body>

<p>
Da das <e>oav</e> USE-Flag lediglich ein Interface zum Scannen nach Viren beim
Zugriff liefert, muss der eigentliche Viren-Scanner emerged werden. In
diesem Howto wird der Viren-Scanner Clam AV verwendet.
</p>

<pre caption="Clam AV emergen">
# <i>emerge app-antivirus/clamav</i>
</pre>

</body>
</section>
<section>
<title>Foomatic emergen</title>
<body>

<pre caption="Emerge foomatic">
# <i>emerge net-print/foomatic</i>
</pre>

</body>
</section>
<section>
<title>net-print/hpijs emergen</title>
<body>

<p>
Emergen Sie dies nur, wenn Sie einen HP Drucker verwenden. 
</p>

<pre caption="hpijs emergen">
# <i>emerge net-print/hpijs</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Server-Konfiguration</title>
<section>
<title>Samba Konfigurieren</title>
<body>

<p>
Die Haupt-Konfigurationsdatei von Samba ist die Datei 
<path>/etc/samba/smb.conf</path>. Sie ist in Abschnitte unterteilt, was durch
[Abschnittsname] angezeigt wird.
</p>

<pre caption="Beispiel einer /etc/samba/smb.conf">
[global]
<comment># Ersetzen Sie MYWORKGROUPNAME mit dem Namen Ihrer
# Workgroup/Domäne</comment> 
workgroup=<comment>MYWORKGROUPNAME</comment>

<comment># Natürlich hat das Folgende keinen echten Zweck, außer dass jeder
# erfährt, dass es nicht Windows ist. 
# Zeigt die verwendete Samba-Version an.</comment>
server string = Samba Server %v

<comment># Wir werden CUPS verwenden, also tragen wir das hier ein ;-)</comment>
printcap name = cups
printing = cups
load printers = yes

<comment># Wir möchten eine Log-Datei haben, die nicht größer als 50K werden
# darf</comment>
log file = /var/log/samba/log.%m
max log size= 50

<comment># Ein paar weitere Optionen für unsere Schnittstellen ...</comment>
socket options = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192

<comment># Es ist eine gute Idee, den Samba-Server an unser lokales
# Netzwerk-Gerät zu binden.
# Wenn zum Beispiel eth0 unser lokales Netzwerk-Gerät ist</comment>
interfaces = lo <i>eth0</i>
bind interfaces only = yes

<comment># Jetzt werden wir einstellen, wen wir zulassen. Wir sind schließlich
# sehr auf Sicherheit bedacht, weil diese Konfiguration keine Passworte
# verwendet</comment>
hosts allow = 127.0.0.1 <i>192.168.1.0/24</i>
hosts deny = 0.0.0.0/0
<comment># Weitere Optionen hierfür sind: USER, DOMAIN, ADS, und SERVER
# Der Standard ist USER.</comment>
security = share
<comment># Keine Passworte, also verwenden wir ein Gastkonto!</comment>
guest account = samba
guest ok = yes

<comment># Wir werden nun den Zugriff auf den Viren-Scanner einrichten.
# Hinweis: Dadurch, dass dies im Abschnitt [global] steht, wird das Scannen
# für ALLE Freigaben ermöglicht. Optional kann dies auch nur für eine einzelne
# Freigabe verwendet werden, so dass nur diese gescannt wird.</comment>
<comment># Für Samba 3.x. Dies aktiviert das Scannen durch ClamAV beim Zugriff.</comment>
vfs object = vscan-clamav
vscan-clamav: config-file = /etc/samba/vscan-clamav.conf

<comment># Nun stellen wir die Drucker-Treiber-Informationen ein!</comment>
[print$]
comment = Drucker-Treiber
path = /etc/samba/printer <comment># Enthält die Treiber-Struktur.</comment>
guest ok = yes
browseable = yes
read only = yes

<comment># Ändern Sie dies zu "User-Name,User-Root", wenn root nicht der einzige
# Drucker-Admin sein soll</comment>
write list = <i>root</i>

<comment># Jetzt stellen wir die Drucker-Freigabe ein. Man sollte browsen und
# drucken können, und sie sollte öffentlich sein. Dies ist eine Art öffentliche,
# temporäre Freigabe, wo jeder machen kann, was er will.</comment>
[public]
comment = Public Files
browseable = yes
public = yes
create mode = 0766
guest ok = yes
path = /home/samba/public
</pre>

<warn>
Wenn Sie das Samba-Gast-Konto verwenden wollen, um irgendetwas bezüglich
Drucken von Windows-Clients aus zu machen, sollte <c>guest only = yes</c>
im Abschnitt [global] nicht gesetzt werden. Das Gast-Konto scheint von Zeit zu
Zeit Probleme beim Starten von <c>cupsaddsmb</c> zu haben, wenn es versucht,
sich von einer Windows-Maschine aus zu verbinden. Lesen Sie auch weiter unten,
wenn wir uns mit <c>cupsaddsmb</c> und den möglichen Problemen
befassen. Verwenden Sie einen dedizierten User, wie <c>printeruser</c> oder
<c>printer</c> oder <c>printme</c> oder so ähnlich. Das schadet nicht und wird
Sie sicherlich vor einer Menge Problemen bewahren.
</warn>

<p>
Legen Sie jetzt die Verzeichnisse für die Mindest-Samba-Konfiguration an, um die
installierten Drucker im Netzwerk freizugeben.
</p>

<pre caption="Verzeichnisse anlegen">
# <i>mkdir /etc/samba/printer</i>
# <i>mkdir /var/spool/samba</i>
# <i>mkdir /home/samba/public</i>
</pre>

<p>
Mindestens ein Samba-User ist nötig, um die Drucker-Treiber zu installieren und
anderen Usern eine Verbindung zum Drucker zu erlauben. Die User müssen in der
Datei <path>/etc/passwd</path> des Systems existieren.
</p>

<pre caption="User anlegen">
# <i>smbpasswd -a root</i>

<comment>(Falls ein anderer User Drucker-Admin sein soll)</comment>
# <i>smbpasswd -a Username</i>
</pre>

<p>
Das Samba-Passwort muss nicht identisch mit dem System-Passwort in
<path>/etc/passwd</path> sein.
</p>

<p>
Sie müssen ebenfalls die Datei <path>/etc/nsswitch.conf</path> aktualisieren, so
dass Windows-Systeme einfach per NetBIOS gefunden werden können:
</p>

<pre caption="/etc/nsswitch.conf editieren">
# <i>nano -w /etc/nsswitch.conf</i>
<comment>(Die Zeile hosts editieren)</comment>
hosts: files dns <i>wins</i>
</pre>

</body>
</section>
<section>
<title>Konfiguration von Clam AV</title>
<body>

<p>
Die zu verwendende Konfigurationsdatei, wie in <path>smb.conf</path>
eingestellt, ist die Datei <path>/etc/samba/vscan-clamav.conf</path>. Während
die Optionen auf die Standardwerte gesetzt sind, müssen eventuell die Aktionen
für infizierte Dateien geändert werden.
</p>

<pre caption="/etc/samba/vscan-clamav.conf">
[samba-vscan]
<comment>; Runtime-Konfiguration für vscan-samba unter Verwendung von clamd
; alle Optionen stehen auf den Standardwerten.</comment>

<comment>; Dateien größer als X Bytes nicht scannen. Wenn dies auf 0 steht
; (Standard) ist die Funktion deaktiviert (um zum Beispiel alle Dateien
; zu scannen).</comment>
max file size = 0

<comment>; Datei-Zugriffe loggen (yes/no). Wenn auf yes gesetzt, wird jeder 
; Zugriff geloggt. Wenn auf no gesetzt (Standard), wird nur der Zugriff auf
; infizierte Dateien geloggt.</comment>
verbose file logging = no

<comment>; Wenn auf yes steht (Standard), wird eine Datei beim Öffnen
; gescannt.</comment>
scan on open = yes

<comment>; Wenn auf yes (Standard), wird eine Datei beim Schließen
; gescannt.</comment>
scan on close = yes

<comment>; Soll der Zugriff auf eine Datei verweigert werden, wenn die
; Kommunikation mit clamd ausfällt?
: (Standard: yes)</comment>
deny access on error = yes

<comment>; Soll der Zugriff auf eine Datei verweigert werden, falls der Daemon
; mit einem geringfügigen Fehler (corruption, etc.) ausfällt?
; (Standard: yes)</comment>
deny access on minor error = yes

<comment>; Soll eine Warn-Mitteilung via Windows Messenger Service gesendet
; werden, falls ein Virus gefunden wird?
; (Standard: yes)</comment>
send warning message = yes

<comment>; Was soll mit einer infizierten Datei geschehen?
; quarantine: Versuchen, die Datei in ein Quarantäne-Verzeichnis zu verschieben;
;             Datei löschen, falls das Verschieben fehlschlägt. 
; delete:     Infizierte Dateien löschen.
; nothing:    Keine Aktion.</comment>
infected file action = <comment>delete</comment>

<comment>; Wo sollen infizierte Dateien abgelegt werden - Sie sollten dies 
; ändern! Das Ziel muss auf dem gleichen physikalischen Gerät liegen, wie die
; Freigabe.</comment>
quarantine directory  = /tmp

<comment>; Präfix für Dateien in Quarantäne</comment>
quarantine prefix = vir-

<comment>; Da Windows versucht, eine Datei in einem (sehr) kurzen Zeitraum
; vielfach zu öffnen, verwendet samba-vscan eine Liste der zuletzt geöffneten
; Dateien, um mehrfaches Scannen von Dateien zu vermeiden. Diese Einstellung 
; bestimmt die maximale Anzahl von Einträgen in dieser Liste. 
;
; (Standard: 100)</comment>
max lru files entries = 100

<comment>; Ein Eintrag wird, nach Ablauf der maximalen Lebensdauer (in
; Sekunden) für einen Eintrag in der Liste der zuletzt geöffneten
; Dateien, gelöscht.</comment>
lru file entry lifetime = 5

<comment>; Socket-Name für clamd (Standard: /var/run/clamd)</comment>
clamd socket name = /var/run/clamd
</pre>

<p>
Es ist grundsätzlich eine gute Idee, den Virenscanner sofort zu starten. Fügen
Sie ihn dem <e>default</e>-Runlevel hinzu und starten Sie anschließend sofort
den <c>clamd</c>-Dienst. Dieser Dienst besteht aus zwei Prozessen: freshclam
hält die Datenbank mit den Virus-Definitionen auf dem neuesten Stand, während es
sich bei clamd um den eigentlichen Anti-Virus-Daemon handelt. Zunächst sollten
Sie die Pfade für die Log-Dateien festlegen, so dass Sie Ihren Bedürfnissen
entsprechen.
</p>

<pre caption="Prüfen der Speicherorte für Log-Dateien">
#<i>vim /etc/clamd.conf</i>
<comment>(Prüfen Sie die Zeile "LogFile "/var/log/clamd.log")</comment>
#<i>vim /etc/freshclam.conf</i>
<comment>(Prüfen Sie die Zeile "UpdateLogFile /var/log/freshclam.log")</comment>
#<i>vim /etc/conf.d/clamd</i>
<comment>(Setzen Sie "START_CLAMD=yes" und "START_FRESHCLAM=yes")</comment>
</pre>

<p>
Starten Sie jetzt den Viren-Scanner.
</p>

<pre caption="clamd zum Bootup hinzufügen und starten">
# <i>rc-update add clamd default</i>
# <i>/etc/init.d/clamd start</i>
</pre>

</body>
</section>
<section>
<title>Konfiguration von CUPS</title>
<body>

<p>
Dies ist etwas komplizierter. Die Haupt-Konfigurationsdatei ist
<path>/etc/cups/cupsd.conf</path>. Ihre Struktur ist der von Apaches
<path>httpd.conf</path> ähnlich, so dass Ihnen möglicherweise einiges bekannt
vorkommt. Im Beispiel werden nur die Abschnitte behandelt, die geändert werden
müssen.
</p>

<pre caption="/etc/cups/cupsd.conf">
ServerName <i>PrintServer</i>         <comment># Name des Print-Servers</comment> 

ServerAdmin <i>root@PrintServer</i>   <comment># derjenige, der Hate-Mail 
                               # bekommen soll, falls der/die Drucker 
                               # nicht funktionieren - z.B Sie :)</comment>

AccessLog /var/log/cups/access_log <comment># muss nicht unbedingt geändert werden</comment>

ErrorLog  /var/log/cups/error_log  <comment># muss ebenfalls nicht geändert werden</comment>

LogLevel  debug <comment># nur zum Installieren und Testen; sollte später zu
                # 'info' geändert werden</comment>

MaxClients 100 <comment># Dies musste ich vor einiger Zeit auf 1000000000 oder
               # ähnlich setzen, weil es scheinbar einen Bug in der Art, wie
               # CUPS das Web-Interface kontrolliert, gab. CUPS dachte, es wäre
               # ein Denial-of-Service-Angriff im Gange, als ich versuchte, 
               # einen Drucker über das Web-Interface zu konfigurieren. 
               # Seltsam.</comment>

BrowseAddress @IF(<i>eth0</i>) <comment># Tragen Sie hier Ihre interne
                        # Netzwerkkarte ein</comment>

&lt;Location /&gt;
Order Deny,Allow
Deny From All
Allow From <i>192.168.1.*</i>  <comment># Die Adresse Ihres internen Netzwerkes.
                        # Z.B. erlaubt 192.168.1.* Verbindungen von jedem Host 
                        # im 192.168.1.0 Netzwerk. Ändern Sie diese Einstellung
                        # nach Ihren Wünschen.</comment>

&lt;/Location&gt;

&lt;Location /admin&gt;
AuthType Basic
AuthClass System
Allow From <i>192.168.1.*</i>  <comment># Wie oben. erlaubt allen Hosts im
                        # 192.168.1.0 Netzwerk sich zu verbinden und nach der 
                        # Anmeldung Admin-Aufgaben auszuführen.</comment>

Order Deny,Allow
Deny From All
&lt;/Location&gt;
</pre>

<p>
Editieren Sie die Datei <path>/etc/cups/mime.convs</path> und entfernen Sie die
Kommentare. Die Änderungen an <path>mime.convs</path> und
<path>mime.types</path> sind notwendig, um Microsoft Office Dokumente mit CUPS
drucken zu können.
</p>

<pre caption="/etc/cups/mime.convs">
<comment>(Die folgende Zeile befindet sich fast am Ende der Datei. Entfernen
Sie das Kommentarzeichen.)</comment>
application/octet-stream      application/vnd.cups-raw    0
</pre>

<p>
Editieren Sie <path>/etc/cups/mime.types</path> um ein paar Kommentarzeichen zu
entfernen
</p>

<pre caption="/etc/cups/mime.types">
<comment>(Die folgende Zeile befindet sich fast am Ende der Datei. Entfernen
Sie das Kommentarzeichen.)</comment>
application/octet-stream
</pre>

<p>
CUPS muss beim Booten gestartet werden, weiterhin werden wir den Dienst auch
sofort manuell starten.
</p>

<pre caption="Den CUPS-Dienst dem default Runlevel hinzufügen" >
<comment>(Um CUPS beim Booten zu starten)</comment>
# <i>rc-update add cupsd default</i>
<comment>(Um CUPS zu starten, falls es noch nicht läuft)</comment>
# <i>/etc/init.d/cupsd start</i>
<comment>(Falls CUPS bereits läuft, muss es neu gestartet werden!)</comment>
# <i>/etc/init.d/cupsd restart</i>
</pre>

</body>
</section>
<section>
<title>Einen Drucker für und mit CUPS installieren</title>
<body>

<p>
Besuchen Sie zunächst <uri
link="http://linuxprinting.org">LinuxPrinting.org</uri>, um die richtige
PPD-Datei für Ihren Drucker und CUPS zu finden und herunterzuladen. Klicken Sie
dazu dort auf den Link "Printer Listings" auf der linken Seite. Wählen Sie den
entsprechenden  Hersteller Ihres Druckers aus dem Pull-down-Menü, zum Beispiel
HP und DeskJet 930C. Klicken Sie auf "Show". Nachdem Sie auf der folgenden
Seite die verschiedenen Anmerkungen und Informationen gelesen haben, klicken Sie
auf den Link "recommended driver".
</p>

<p>
Nun haben Sie eine PPD-Datei für Ihren Drucker, so dass dieser mit CUPS arbeiten
kann. Speichern Sie diese Datei im Verzeichnis
<path>/usr/share/cups/model</path>. Die PPD-Datei für den HP DeskJet 930C hieß
<path>HP-DeskJet_930c-hpijs.ppd</path>. Sie sollten nun den Drucker
installieren. Dies können Sie über das CUPS-Web-Interface oder über die
Kommandozeile  tun. Das Web-Interface finden Sie unter
<path>http://PrintServer:631</path> sobald CUPS läuft.
</p>

<pre caption="Drucker über die Kommandozeile installieren">
# <i>lpadmin -p HPDeskJet930C -E -v usb:/dev/ultp0 -m HP-DeskJet_930C-hpijs.ppd</i>
</pre>

<p>
Denken Sie daran, dies an Ihre Gegebenheiten anzupassen! Stellen Sie sicher,
dass Sie den Namen (<c>-p</c>-Argument) richtig schreiben (das ist der Name, den
Sie bei der Samba-Konfiguration angegeben haben!) und dass Sie die richtige
Geräte-Datei angeben: <c>usb:/dev/usb/foo</c>, <c>parallel:/dev/bar</c> oder
welche auch immer Sie für Ihren Drucker verwenden.
</p>

<p>
Sie sollten nun in der Lage sein, über das Web-Interface auf den Drucker
zuzugreifen und Testseite drucken zu können.
</p>

</body>
</section>
<section>
<title>Den Windows-Druckertreiber installieren</title>
<body>

<p>
Jetzt, wo der Drucker eigentlich funktionieren sollte, ist es Zeit, die
Drucker-Treiber für Windows-Clients zu installieren. Diese Funktionalität wurde
mit Samba 2.2 eingeführt. Suchen Sie im Netzwerk nach dem Print-Server, klicken
Sie mit der rechten Maustaste auf die gewünschte Druckerfreigabe und wählen Sie
"connect". Dies lädt den passenden Drucker-Treiber automagisch auf den sich
verbindenden Client, wodurch Sie das Theater vermeiden, den Treiber auf dem
Client von Hand installieren zu müssen. 
</p>

<p>
Es gibt hierfür zwei Drucker-Treiber. Zunächst den Adobe PS-Treiber, den Sie
von <uri link="http://www.adobe.com/support/downloads/main.html">Adobe</uri>
(Postscript Drucker-Treiber) beziehen können. Als zweites gibt es die CUPS 
PS-Treiber, die Sie von <uri link="http://www.cups.org/software.ph">der CUPS
Homepage</uri> unter dem Punkt "CUPS Driver for Windows" aus dem Pull-down-Menü
beziehen können. Es scheint keinen Unterschied in der Funktionalität der beiden
Treiber zu geben, jedoch muss der Adobe-Treiber auf einem Windows-System
entpackt werden, da es sich um ein Windows-Binary handelt. Hinzu kommt, dass die 
ganze Prozedur, den korrekten Treiber zu finden und zu kopieren etwas mehr
Theater bedeutet. Die CUPS-Treiber scheinen ein paar Optionen zu unterstützen,
die dem Adobe-Treiber fehlen.
</p>

<p>
Dieses Howto nutzt den CUPS-Treiber für Windows. Die kopierte Datei heißt
<path>cups-samba-5.0rc3.tar.gz</path>. Entpacken Sie die Dateien in ein
beliebiges Verzeichnis.
</p> 

<pre caption="Treiber entpacken und install ausführen">
# <i>tar -xzf cups-samba-5.0rc3.tar.gz</i>
# <i>cd cups-samba-5.0rc3</i>
<comment>(Verwenden Sie dieses Skript nur, wenn CUPS sich in /usr/share/cups
befindet)</comment>
# <i>./cups-samba.install</i>
</pre>

<p>
<path>cups-samba.ss</path> ist ein TAR-Archiv, dass drei Dateien enthält:
<path>cups5.hlp</path>, <path>cupsdrv5.dll</path> und
<path>cupsui5.dll</path>. Dies sind die eigentlichen Treiber-Dateien.
</p>

<warn>
Das Skript <c>cups-samba.install</c> funktioniert möglicherweise nicht auf allen
*nixen (zum Beispiel FreeBSD), da hier fast alles, was nicht Teil des
Basis-Systems ist, irgendwo unter <path>/usr/local</path> installiert ist. Dies
scheint in den meisten Installationen unter GNU/Linux nicht der Fall zu sein
Wie auch immer, sollte sich Ihre CUPS-Installation irgendwo anders als in
<path>/usr/share/cups</path> befinden, schauen Sie sich das Beispiel weiter
unten an.
</warn>

<p>
Angenommen, Ihre CUPS-Installation befindet sich in
<path>/usr/local/share/cups</path> und Sie möchten auch den Treiber dort
installieren. Machen Sie in diesem Fall folgendes:
</p>

<pre caption="Manuelle Installation des Treibers">
# <i>cd /Pfad/zum/entpackten/CUPS-Treiber</i>
# <i>tar -xf cups-samba.ss</i>
<comment>(Dies entpackt die Dateien IM AKTUELLEN VERZEICHNIS nach usr/share/cups/drivers)</comment>
# <i>cd usr/share/cups/drivers</i>
<comment>(kein führender / !)</comment>
# <i>cp cups* /usr/local/share/cups/drivers</i>
</pre>

<p>
Nun verwenden wir das Skript <c>cupsaddsmb</c>, dass von der CUPS-Distribution
bereitgestellt wird. Dessen man-Page ist übrigens interessanter Lesestoff.
</p>

<pre caption="cupsaddsmb ausführen">
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -v HPDeskJet930C</i>
<comment>(Anstelle von  HPDeskJet930C können Sie auch "-a" angeben, wodurch alle
bekannten Drucker ausgegeben werden.)</comment>
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -a</i>
</pre>


<warn>
Das Ausführen dieses Befehls verursacht häufig den meisten Ärger. Lesen Sie die
Ausführungen in <uri
link="http://forums.gentoo.org/viewtopic.php?t=110931">dieser Diskussion</uri>. 
</warn>

<p>
Hier einige häufige Fehler, die auftreten können:
</p>

<ul>
  <li>
    Der Hostname, den Sie als Parameter für <c>-h</c> und <c>-H</c>
    (<c>PrintServer</c>) angegeben haben wird oft nicht richtig aufgelöst und
    identifiziert den PrintServer für die Zusammenarbeit CUPS/Samba nicht. Wenn
    ein Fehler wie <b>Warning: No PPD file for printer "CUPS_PRINTER_NAME" -
    skipping!</b> auftritt, sollten Sie als erstes <c>PrintServer</c> durch
    <c>localhost</c> ersetzen und es erneut versuchen.
  </li>
  <li>
    Der Befehl schlägt mit <b>NT_STATUS_UNSUCCESSFUL</b> fehl. Diese
    Fehlermeldung ist ziemlich allgemein und kann durch viele Probleme
    hervorgerufen werden. Unglücklicherweise ist sie nicht sehr
    aufschlussreich. Eine Sache, die Sie versuchen können, ist, vorübergehend
    <c>security=user</c> in Ihrer <path>smb.conf</path> zu setzen. Nachdem/Wenn
    die Installation erfolgreich abgeschlossen ist, sollten Sie diese
    Einstellung wieder auf "share" oder was immer es vorher war setzen.
  </li>
</ul>

<p>
Dies sollte die richtige Treiber-Verzeichnis-Struktur unter
<path>/etc/samba/printer</path> installieren. Das wäre
<path>/etc/samba/printer/W32X86/2</path>. Es sollten die drei Treiber-Dateien
und eine PPD-Datei, die nach IhrDruckerName.ppd (der Name, den Sie Ihrem Drucker
bei der Installation gegeben haben (siehe oben)) umbenannt wurde, enthalten sein.
</p>

<p>
Wenn wir davon ausgehen, dass keine Fehler oder andere Komplikationen
aufgetreten sind, sind Ihre Treiber nun installiert.
</p>

</body>
</section>
<section>
<title>Einrichtung abschließen</title>
<body>

<p>
Richten Sie als letztes Ihre Verzeichnisse ein.
</p>

<pre caption="Letzte notwendige Änderungen">
# <i>mkdir /home/samba</i>
# <i>mkdir /home/samba/public</i>
# <i>chmod 755 /home/samba</i>
# <i>chmod 755 /home/samba/public</i>
</pre>

</body>
</section>
<section>
<title>Samba-Konfiguration testen</title>
<body>

<p>
Wir möchten nun unsere Konfigurationsdatei testen, um sicherzustellen, dass
alles richtig formatiert ist und alle Optionen zumindest die richtige Syntax
verwenden. Um dies zu tun, starten wir <c>testparm</c>.
</p>

<pre caption="Ausführen von testparm">
<comment>(Standardmäßig prüft testparm die Datei /etc/samba/smb.conf)</comment>
# <i>/usr/bin/testparm</i>
Load smb config files from /etc/samba/smb.conf
Processing section &quot;[printers]&quot;
Global parameter guest account found in service section!
Processing section &quot;[public]&quot;
Global parameter guest account found in service section!
Loaded services file OK.
Server role: ROLE_STANDALONE
Press enter to see a dump of your service definitions
 ...
 ...
</pre>

</body>
</section>
<section>
<title>Den Samba-Dienst starten</title>
<body>

<p>
Konfigurieren Sie nun Samba so, dass der Dienst beim Booten startet. Starten Sie
ihn anschließend. 
</p>

<pre caption="Samba-Dienst einrichten">
# <i>rc-update add samba default</i>
# <i>/etc/init.d/samba start</i>
</pre>

</body>
</section>
<section>
<title>Die Dienste überprüfen</title>
<body>

<p>
Es ist wahrscheinlich Weise bei dieser Gelegenheit auch die Logs zu
überprüfen. Zusätzlich möchten wir einen Blick auf unsere Samba-Freigaben mit
Hilfe von <c>smbclient</c> werfen.
</p>

<pre caption="Freigaben mit smbclient prüfen">
# <i>smbclient -L localhost</i>
Password:
<comment>(Sie sollten nun eine LANGE Liste von Diensten sehen.)</comment>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Konfiguration der Clients</title>
<section>
<title>Drucker-Konfiguration für *nix-basierte Clients</title>
<body>

<p>
Trotz vieler Varianten oder Distributionen ist CUPS das einzige, was Sie
brauchen. Machen Sie das Gleiche für jeden anderen UNIX/Linux/BSD-Client. 
</p>

<pre caption="Gentoo-System konfigurieren">
# <i>emerge cups</i>
# <i>nano -w /etc/cups/client.conf</i>
ServerName <i>PrintServer</i>      <comment># Ihr Print-Server-Name</comment>
</pre>

<p>
Das sollte es gewesen sein. Sonst ist nichts weiter nötig.
</p>

<p>
Wenn Sie lediglich einen Drucker verwenden, ist dieser auch Ihr
Standarddrucker. Wenn viele Drucker über Ihren Print-Server verwaltet werden,
muss Ihr Administrator einen Standarddrucker auf dem Print-Server
einstellen. Möchten Sie für sich selbst einen anderen Standarddrucker
einstellen, benutzen Sie den <c>lpoptions</c>-Befehl.
</p>

<pre caption="Standarddrucker einstellen">
<comment>(Verfügbare Drucker auflisten)</comment>
# <i>lpstat -a</i>
<comment>(Beispielausgabe, Ihre wird anders aussehen)</comment>
HPDeskJet930C accepting requests since Jan 01 00:00
laser accepting requests since Jan 01 00:00
<comment>(HPDeskJet930C als Ihren Standarddrucker einstellen)</comment>
# <i>lpoptions -d HPDeskJet930C</i>
</pre>

<pre caption="Drucken unter *nix">
<comment>(Zu verwendenden Drucker angeben)</comment>
# <i>lp -d HPDeskJet930C anything.txt</i>
<comment>(Standarddrucker verwenden)</comment>
# <i>lp foobar.whatever.ps</i>
</pre>

<p>
Browsen Sie auf dem Client zu <c>>http://printserver:631</c>, wenn Sie Ihre
Drucker und deren Druckjobs über ein nettes Web-Interface verwalten
möchten. Ersetzen Sie dabei <c>printserver</c> mit dem Namen des Rechners, der
als Print-Server dient, aber nicht mit dem Namen, den Sie dem CUPS-Print-Server
gegeben haben, falls Sie hier unterschiedliche Namen verwendet haben.
</p>

</body>
</section>
<section>
<title>Windows- oder Samba-Freigabe unter GNU/Linux mounten</title>
<body>

<p>
Nun ist es Zeit, Ihren Kernel so zu konfigurieren, dass er smbfs unterstützt. Da
ich annehme, dass wir alle zumindest einmal einen Kernel kompiliert haben,
müssen wir sicherstellen, dass wir die richtigen Optionen in unserem Kernel
ausgewählt haben. Der Einfachheit halber bauen wir ein Modul, weil es leichter
zu handhaben ist. Der Autor ist der Auffassung, das Kernel-Module eine gute
Sache sind und, wann immer möglich, verwendet werden sollten.
</p>

<pre caption="Relevante Kernel-Ooptionen" >
CONFIG_SMB_FS=m
CONFIG_SMB_UNIX=y
</pre>

<p>
Bauen Sie anschließend das Modul und installieren Sie es; fügen Sie es ein mit:
</p>

<pre caption="Kernel-Modul laden">
# <i>modprobe smbfs</i>
</pre>

<p>
Ist das Modul einmal geladen, können Windows- oder Samba-Freigaben gemounted
werden. Verwenden Sie <c>mount</c> um dies zu tun, wie unten aufgeführt:
</p>

<pre caption="Windows-/Samba-Freigabe mounten">
<comment>(Die Syntax, um eine Windows-/Samba-Freigabe zu mounten lautet:
mount -t smbfs [-o username=xxx,password=xxx] //Server/Freigabe /mnt/point
Falls keine Passworte verwendet werden, ist die Angabe eines Passwortes überflüssig)</comment>

# <i>mount -t smbfs //PrintServer/public /mnt/public</i>

<comment>(Wenn ein Passwort nötig ist:)</comment>
# <i>mount -t smbfs -o username=USERNAME,password=PASSWORD //PrintServer/public /mnt/public</i>
</pre>

<p>
Nachdem die Freigabe gemountet wurde, können Sie darauf wie auf eine lokale
Festplatte zugreifen.
</p>

</body>
</section>
<section>
<title>Drucker-Konfiguration für Windows NT/2000/XP-Clients</title>
<body>

<p>
Das ist nur ein bisschen Mit-der-Maus-klicken. Öffnen Sie
<path>\\PrintServer</path> und klicken Sie mit der rechten Maustaste auf den
Druckereintrag (HPDeskJet930C) und wählen Sie "Verbinden". Dadurch wird der
Treiber auf den Windows-Client heruntergeladen, so dass nun jedes Programm (wie
Word oder Acrobat) HPDeskJet930C als verfügbaren Drucker anbietet und über ihn
drucken kann. :-)  
</p>

</body>
</section>
</chapter>

<chapter>
<title>Abschließende Bemerkungen</title>
<section>
<title>Ein zärtliches Lebewohl</title>
<body>

<p>
Nun gut, das sollte es gewesen sein. Sie sollten nun eine verwendbare
Druck-Umgebung, die sowohl zu Windows als auch zu *nix freundlich ist, als auch 
eine völlig viren-frei arbeitende Freigabe haben! 
</p>

</body>
</section>
</chapter>

<chapter>
<title>Links und Quellen</title>
<section>
<title>Links</title>
<body>

<p>
Dies sind einige Links, die bei der Einrichtung und Konfiguration Ihrer
Installation und bei der Fehlersuche hilfreich sein können:
</p>

<ul>
  <li><uri link="http://www.cups.org/">CUPS-Homepage</uri></li>
  <li><uri link="http://www.samba.org/">Samba-Homepage</uri></li>
  <li><uri link="http://linuxprinting.org/">LinuxPrinting dot Org</uri></li>
  <li>
    <uri link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/">Kurt
    Pfeifle's Samba-Print-Howto</uri> (Dieses Howto behandelt schlichtweg
    <e>ALLES</e> und <e>JEDES</e>, was ich hier geschrieben habe und noch viel
    mehr über CUPS und Samba und allgemein über Drucken in Netzwerken. Wirklich
    interessanter Lesestoff mit vielen, vielen Details.)
  </li>
  <li><uri link="http://www.freebsddiary.org/cups.php">FreeBSD Diary's CUPS-Thema</uri></li>
</ul>

</body>
</section>
<section>
<title>Troubleshooting</title>
<body>

<p>
Lesen Sie <uri
link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/Samba-HOWTO-Collection-3.0-PrintingChapter-11th-draft.html#37">diese
Seite</uri> von Kurt Pfeifles "Printing Support in Samba 3.0"-Anleitung. Dort
gibt es ein Menge wertvoller Tipps. Schauen Sie sich dies auf jeden Fall zuerst
an, bevor Sie Fragen und Probleme posten. Möglicherweise ist die Lösung, die Sie
brauchen, genau da.
</p>

</body>
</section>
</chapter>
</guide>
