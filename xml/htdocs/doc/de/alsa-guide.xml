<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/alsa-guide.xml,v 1.24 2005/07/05 18:34:09 grahl Exp $ -->

<!-- English CVS Version: 1.45 -->

<guide link="/doc/de/alsa-guide.xml">

<title>Gentoo Linux ALSA Anleitung</title>

<author title="Autor">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Autor">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Autor">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
 <author title="Autor">
   <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
 </author>
<author title="Bearbeiter">
  <!--zhen@gentoo.org-->John P. Davis
</author>
<author title="Bearbeiter">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Bearbeiter">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Bearbeiter">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Bearbeiter">
   <mail link="erwin@gentoo.org">Erwin</mail>
 </author>
<author title="Übersetzer">
  <mail link="js@ameds.de">Jens Schittenhelm</mail>
</author>
<author title="Übersetzer">
  <mail link="dertobi123@gentoo.org">Tobias Scherbaum</mail>
</author>
<author title="Übersetzer">
  <mail link="pylon@gentoo.org">Lars Weiler</mail>
</author>
<author title="Übersetzer">
  <mail link="grahl@gentoo.org">Jan Hendrik Grahl</mail>
</author>  

<abstract>
Dieses Dokument zeigt, wie unter Gentoo Linux das Advanced Linux Sound 
Architecture (ALSA) installiert und eingerichtet werden kann. Dieses Dokument 
soll zusätzliche Informationen zur Gentoo Linux Desktop Konfiguration vermitteln.
</abstract>

<license/>

<version>1.5.7</version>
<date>2004-12-02</date>

<chapter>
<title>Advanced Linux Sound Architecture</title>
<section>
<title>Was ist ALSA?</title>
<body>

<p>
ALSA (Advanced Linux Sound Architecture) ist ein Projekt zur Entwicklung eines
profesionellen  Audio Subsystems unter Linux. Es hat das Open Sound System (OSS) als 
Standard-Sound-Subsystem im 2.6 Kernel abgelöst.
</p>

<p>
ALSA unterstützt alle Sorten von Audioschnitstellen, ist modular und thread-safe aufgebaut,
eignet sich für SMP Plattformen und stellt mit  <e>alsa-lib</e> eine exzellente Benutzerschnitstelle 
zur Vereinfachung der Prgrammierung von Applikationen bereit. darüberhinaus ist eine
Rückwärtskompatibiltät mit OSS gewährleistet.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installation</title>
<section>
<title>USE Flags</title>
<body>

<p>
Gentoo stellt die <c>alsa</c> USE Flag bereit, welche in <path>/etc/make.conf</path>
gesetzt werden sollte, um für alle vorhandenen Pakete die ALSA  Unterstützung
einzukompilieren. Sollten Sie die <c>oss</c> Flag zusätzlich gesetzt haben, wird
ALSA mit OSS Abwärtskompatibilität bereitgestellt.
</p>

</body>
</section>


<section>
<title>Kernel Module</title>
<body>

<p>
Zunächst sollten SIe sicherstellen, dass in Ihrem Kernel die Unterstützung für
<e>Sound Card Support</e> aktiviert ist. Benutzen Sie <c>genkernel</c>
ist dies bereits automatisch erfolgt. Ansonsten müssen Sie Ihren Kernel
neu konfigurieren.
</p>

<warn>
Benutzer der 2.6 Kernel-Reihe können folgenden Abschnitt überspringen und
mit der <uri link="#alsa-utils">Installation der ALSA Utilities</uri> fortfahren,
da im 2.6 Kernel alle notwendigen ALSA-Treiber bereits enthalten sind. Natürlich
darf die Unterstützung für die jeweilige Soundkarte während der Kernelkonfiguration 
nicht vergessen werden. 
</warn>

<p>
Benutzer der 2.4 Kernel Reihe müssen Sie die für Ihre Soundkarte notwendigen 
Alsa Treiber separat vom Kernel installieren. Finden Sie heraus, welche Soundkarte
in Ihrem System werkelt. Helfen Kann hierbei die Suche nach "audio" in der
Ausgabe des <path>lspci</path> Kommando. Sie können dieses Programm mittels
<c>emerge pciutils</c> installieren.
</p>
 
<pre caption="Ausfindigmachen der Soundkarte">
# <i>lspci | grep -i audio</i>
 Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
Schlagen Sie in der <uri link="http://www.alsa-project.org/alsa-doc">ALSA
Sound Matrix</uri> Ihre Karte nach. In unserem obigen Beispiel ist VIA
der Hersteller und wir erhalten eine Tabelle mit allen bekannten Chipsätzen,
welcher in unserem Beispiel "via82c686" ist. Mit Klick auf "Details" erfahren
wir, dass unserer gesuchter Treiber <path>via82xx</path> ist. Dies ist die
einzige Information die Sie benötigen, Sie können den Rest der Webseite sorglos
auslassen.
</p>

<p>
Basierend auf diesen Informationen können wir nun <c>alsa-driver</c> für
unsere Soundkarte installieren. Dafür editieren wir zunächst 
<path>/etc/make.conf</path> und fügen eine neue Option ALSA_CARDS 
hinzu. In dieser Variable deklarieren wir den zu benutzenden Soundkartentreiber:
</p>

<pre caption="Bearbeiten von /etc/make.conf für ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<p>
Nun installieren wir <c>alsa-driver</c>:
</p>

<pre caption="Installation der ALSA Treiber">
 # <i>emerge alsa-driver</i>
</pre>

<impo>
Jedes Mal, wenn Sie Ihren Kernel (neu)kompilieren, besteht die 
Möglichkeit, dass Ihre ALSA Treiber überschrieben werden. Es
empfiehlt sich daher dass JEDES MAL wenn der Kernel neu kompiliert 
wird, <c>alsa-driver</c> ebenfalls neu kompiliert werden sollte 
<e>nachdem</e> Sie den neuen Kernel gebootet haben. 
</impo>

</body>
</section>

<section id="alsa-utils">
<title>Installation der ALSA Utilities</title>
<body>

<p>
Wird die Abwärtskompatibilität zu OSS gewünscht, müssen Sie
<c>alsa-oss</c> installieren:
</p>

<pre caption="Installation der ALSA OSS Kompatibilitätsschicht">
# <i>emerge alsa-oss</i>
</pre>

<p>
Nun müssen Sie die obligatorischen ALSA Utilities auf Ihrem System 
installieren.
</p>

<pre caption="Installation der ALSA Utilities">
# <i>emerge alsa-utils</i>
</pre>

<p>
Nach der Installation der ALSA Utilities wird es Zeit, das System zu
konfigurieren.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Konfiguration von ALSA</title>
<section>
<title>Automatisches Laden der Kernelmodule</title>
<body>

<p>
Bei der Verwendung eines modularen Kernels, wie auch bei
<c>genkernel</c> üblich, muss <path>/etc/modules.d/alsa</path>
so angepaßt werden, dass die notwendigen Module beim Booten
geladen werden. Für die Soundkarte in unserem Beispiel:
</p>

<pre caption="Konfiguration von /etc/modules.d/alsa">
 alias snd-card-0 snd-via82xx
<comment># Folgende Zeilen sind nur bei  OSS Kompatibilität notwendig:</comment>
alias sound-slot-0 snd-card-0
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Führen Sie nun  <c>modules-update</c> aus, damit alle Änderungen,
die Sie an der <path>alsa</path> Datei vorgenommen haben, auch 
in <path>/etc/modules.conf</path> übernommen werden:
</p>

<pre caption="Ausführen von modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>Überprüfen der Devices</title>
<body>

<p>
Wenn SIe DevFS verwenden (standardmäßig bei Gentoo aktiviert),
sollten Sie sicherstellen, dass in /etc/devfsd.conf die ALSA Geräte korrekt
eingetragen und registriert sind:
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>ALSA beim Starten aktivieren</title>
<body>

<p>
Damit ALSA beim Booten aktiviert ist, muss das <c>alsasound</c>
Initscript in dem boot runlevel hinzugefügt werden:
</p>

<pre caption="Hinzufügen von ALSA zum boot runlevel">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>Stummschaltung aufheben</title>
<body>

<p>
Da alle Kanäle zunächst stumm geschaltet sind bekommen Sie noch
keinen Ton zu hören. Um diese Einstellungen zu ändern, brauchen 
wir <c>amixer</c>.
</p>

<pre caption="amixer aufrufen">
# <i>amixer</i>
</pre>

<p>
Wenn Sie beim Aufrufen des obigen Befehls eine Menge an Antworten erhalten haben,
können Sie <c>amixer</c> verwenden, um die Kanäle zu aktivieren. Bei einer
Fehlermeldung, sollten sie überürüfen, ob Ihr Soundkarten-Modul auch tatsächlich
geladen wurde.
</p>

<p>
Wenn Sie nun so weit gekommen sind, sollten Sie die Stummschaltung der <e>Master</e>
und <e>PCM</e> Kanäle aufheben.  Manche Hardware verlangt, dass auch die 
<e>Center</e>- und die <e>Surround</e>-Kanäle aktiviert werden.
</p>

<pre caption="Stummschaltung aufheben">
# <i>amixer set Master 100 unmute</i>
# <i>amixer set PCM 100 unmute</i>
<comment>Nur, falls das obige zu keinem Erfolg führt:</comment>
# <i>amixer set Center 100 unmute</i>
# <i>amixer set Surround 100 unmute</i>
# <i>amixer set Headphone 100 unmute</i>
</pre>

<p>
Um zu Überprüfen, ob der Ton funktioniert, sollten sie entweder eine Wave
Datei ( mittles <c>aplay</c> ) oder eine mp3 Datei (mittels <c>mpg123</c>
oder <c>mplayer</c>) testen.
</p>

<p>
Zum Feintuning Ihres Systems  ist das ncurses-basierte Paket 
<c>alsamixer</c> die richtige Wahl.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aktivieren der MIDI Unterstützung</title>
<section>
<title>Installation der notwendigen Pakete</title>
<body>

<p>
Einige Soundkarten werden mit einem onboard MIDI Synthesizer geliefert. 
Um diesen zu verwenden, müssen sie zuerst das <c>awesfx</c> Paket installieren.
</p>

<pre caption="Installieren von awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Nun sollten Sie eventuell vorhandene Sound Fonts in 
<path>/usr/share/sfbank/</path> plazieren. Zum Beispiel
besitzt  die SBLive  folgende Dateien: <path>8MBGMSFX.SF2</path>
oder <path>CT4GMSFX.SF2</path>.
</p>

<p>
Nach dem Kopieren der Sound Font, die Sie verwenden möchten, müssen Sie diese 
zur Verwendung mit <c>asfxload</c> auswählen.
</p>

<pre caption="Auswählen der Sound Font">
# <i>/usr/bin/asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Da dieser Befehl nach jedem Booten ausgeführt werden muß,
empfiehlt es sich ihn in <path>/etc/conf.d/local.start</path> 
einzufügen.
</p>

<p>
Sollten die entsprechenden Soundfonts auf der CD nicht zu
finden sein, können sie auch online unter 
<uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>
heruntergeladen werden. 
</p>

</body>
</section>
<section>
<title>Timidity++ Virtueller Synthesizer</title>
<body>

<p>
Wenn Ihre Soundkarte ohne Hardware Synthesizer geliefert wird (oder Sie ihn 
nicht verwenden möchten), dann können Sie <c>timidity++</c> benutzen, um 
einen virtuellen Synthesizer einzurichten. Beginnen Sie mit dem emerge des Paketes:
</p>

<pre caption="Installieren von Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Damit Timidity überhaupt einen Ton abspielen kann, werden Soundfonts
benötigt. Diese werden durch <c>timidity-eawpatches</c> bereitgestellt.
</p>

<pre caption="Installation von timidity-eawpatches">
# <i>emerge timidity-eawpatches</i>
</pre>

<p>
Vergessen Sie nicht Timidity zum standard runlevel hinzuzufügen:
</p>

<pre caption="Hinzufügen von Timidity zum standard runlevel">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>Testen der MIDI Unterstützung</title>
<body>

<p>
Sie können <c>aplaymidi</c> von den ALSA Utilities verwenden, um Ihre MIDI Konfiguration zu testen. 
</p>

<p>
Um zu sehen welche MIDI Ausgabeports auf Ihrem System zur Verfügung stehen, verwenden Sie die <c>-l</c> Option:
</p>

<pre caption="Ausgabe der Ports mit aplaymidi">
# <i>aplaymidi -l</i>
</pre>

<p>
Wenn alles zufriedenstellend aussieht, sollten Sie nun versuchen
eine MIDI Datei abzuspielen um sicherzugehen, dass alles 
funktioniert:
</p>

<pre caption="Eine MIDI Datei abspielen">
# <i>aplaymidi -p 65:0 Final Fantasy 7 -Aerith's Theme.mid</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Abschließende Bemerkungen</title>
<section>
<title>Tools und Firmware</title>
<body>

<p>
Einige Soundkarten können von den <c>alsa-tools</c> und
<c>alsa-firmware</c> Paketen profitieren. Bei Verwendung von
<c>alsa-tools</c> muss die entsprechende ALSA_TOOLS 
Variable in <path>/etc/make.conf</path> gesetzt werden.
Zum Beispiel:
</p>

<pre caption="Auswahl der ALSA Tools in /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Nun installieren wir die <c>alsa-tools</c> (oder <c>alsa-firmware</c>)
auf unserem System:
</p>

<pre caption="Installation der ALSA Tools">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Aktivieren der Joystick Unterstützung</title>
<body>

<p>
Sollte Ihre Soundkarte einen Joystick-Stecker enthalten, sind Sie sicher daran
interessiert, die Unterstützung für Ihren Joystick einzuschalten. Zunächst
sollten Sie überprüfen, ob Ihr Soundkartentreiber einen Parameter für den
Joystick enthält. Sie können dies mit dem Befehl <c>modinfo</c> gegen
<path>snd-&lt;Ihr Chipsatz&gt;</path> ausführen. Als Beispiel für den
<c>snd-via82xx</c> Chipsatz:
</p>

 <pre caption="Ausführen von modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA 82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port. (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for DXS channels
             (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 = no VRA)"
 </pre>

<p>
Sollte in der Ausgabe der <c>joystick</c> Parameter auftreten, dann können Sie mit
<c>joystick=1</c>in der Zeile <c>options</c> der Datei <path>/etc/modules.d/alsa</path>
die Unterstützung aktivieren. Wieder ein Beispiel für <c>snd-via82xx</c>:
</p>

<pre caption="Hinzufügen der Joystick Parameter">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>

<section>
<title>Weitere Quellen</title>
<body>

<p>
Für weitere Informationen rund um ALSA empfehle ich folgende Links:
</p>

<ul>
  <li><uri link="http://www.alsa-project.org">ALSA Project Homepage</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto's and FAQ's</uri></li>
  <li><uri link="http://linux-sound.org/">Sound and MIDI Software For Linux</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
