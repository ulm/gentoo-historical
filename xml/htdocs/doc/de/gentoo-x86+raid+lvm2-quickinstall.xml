<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/gentoo-x86+raid+lvm2-quickinstall.xml,v 1.2 2007/06/09 19:28:15 keytoaster Exp $ -->

<!-- English CVS Version: 1.17 -->


<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/de/gentoo-x86+raid+lvm2-quickinstall.xml" lang="de">
<title>Gentoo Linux x86 mit Software-Raid und LVM2: Kurzleitfaden zur Installation</title>

<author title="Autor">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Autor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Autor">Steven Wagner</author>
<author title="Übersetzer">
  <mail link="kaha@gmx.de">Kai Hackemesser</mail>
</author>


<abstract>
Der Kurzleitfaden zur Installation deckt den Gentoo-Installationsvorgang in
einer kurzgefassten Weise ab. Ihr Zweck ist es, Benutzern eine
Stage3-Installation mit Software-RAID und LVM2 in kürzester Zeit zu ermöglichen.
Der Benutzer sollte Vorkenntnisse in der Installation von Gentoo Linux haben,
wenn er dieser Anleitung folgen möchte.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>10</version>
<date>2007-05-10</date>

<chapter>
<title>Einleitung</title>
<section>
<body>

<p>
Diese Anleitung enthält alle Kommandos, die man gebrauchen sollte, um eine
Stage3-Installation einschließlich LVM2 auf einer Software-RAID-Basis
abzuschließen. Man benötigt eine Internetverbindung, um das Stage3 und die
Portage-Snapshots zu laden.
</p>

<p>
Es werden Zeitangaben für alle Kommandos gemacht, welche mehr als ein paar
Sekunden zur Durchführung benötigen. Zeitmessungen erfolgten auf einem AMD 2000
PC mit 1.66 Ghz und 512Mb RAM sowie zwei SATA-Festplatten, die an einen
Hardware-Controller in JBOD-Konfiguration angeschlossen sind (d.h. Gentoo sieht
zwei separate Festplatten). Wenn Sie einen "Hardware"-RAID-Controller auf Ihrem
Motherboard haben, ist es höchstwarscheinlich <b>kein</b> Hardware-Controller.
</p>

<pre caption="Spezifikation der Testmaschine">
<comment>(Die folgenden Spezifikationen und Zeitangaben sollen Ihnen helfen,
grob die Zeit abzuschätzen, die Sie für die komplette Installation benötigen
werden.)</comment>

# <i>grep bogo /proc/cpuinfo</i>
bogomips       : 3337.81

# <i>hdparm -tT /dev/sda /dev/sdb</i>
/dev/sda:
reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

/dev/sdb:
 Timing cached reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

# <i>grep MemTotal /proc/meminfo</i>
MemTotal:       509248 kB
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Kurzleitfaden zur Installation</title>
<section>
<title>Installationsmedien</title>
<body>

<p>
Laden Sie sich eine CD von einem unserer <uri
link="/main/en/mirrors.xml">Mirror</uri>. Sie können das ISO-Abbild der
Minimal-CD unter <path>releases/x86/&lt;release&gt;/installcd</path>, oder das
ISO-Abbild der LiveCD unter <path>releases/x86/&lt;release&gt;/livecd</path>
finden. Die <e>Minimal</e>-Installations-CD ist nur für Internet-basierte
Installationen sinnvoll. Sie können die <e>Live CD</e> für eine netzwerklose
Installation verwenden, wie in der <uri
link="/doc/de/handbook/2007.0/handbook-x86.xml">2007.0 x86
Installationsanleitung</uri> dokumentiert. Empfohlen wird die Minimal-CD.
</p>

<p>
<uri link="/doc/de/faq.xml#isoburning">Brennen</uri> Sie die CD und booten Sie
damit.
</p>

</body>
</section>
<section>
<title>Von der CD booten</title>
<body>

<p>
Drücken Sie beim Boot-Bildschirm <c>F2</c>, um herauszufinden, welche
Boot-Optionen bestehen. Sie können entweder <c>gentoo</c> oder
<c>gentoo-nofb</c> starten; letztere schaltet Framebuffer ab. Wenn Sie von der
Live CD booten, vergessen Sie nicht, die <c>nox</c> Option anzugeben, um das
Starten der grafischen Umgebung (X) zu verhindern. Verschiedene Optionen
erlauben es, bestimmte Merkmale ein- oder auszuschalten. Wenn alles gut geht,
wird Ihre Hardware erkannt und alle Module geladen. Falls der Kernel nicht
ordentlich bootet oder Ihr Computer während des Bootvorgangs stehen bleibt,
werden Sie wohl mit verschiedenen Konfigurationen experimentieren müssen. Der
sicherste Weg ist wahrscheinlich, die <c>nodetect</c> Option zu verwenden und
dann benötigte Module explizit nachzuladen.
</p>

<pre caption="Booten mit der Minimal-CD">
Gentoo Linux Installation LiveCD                     http://www.gentoo.org
Enter to Boot; F1 for kernels  F2 for options.
boot: <i>gentoo-nofb</i>
  <comment>(oder falls es Probleme gibt)</comment>
boot: <i>gentoo-nofb nodetect</i>
</pre>

</body>
</section>
<section>
<title>Optional: Module nachladen</title>
<body>

<p>
Wenn Sie die <c>nodetect</c> Option beim Booten verwendet haben, laden Sie nun
die benötigten Module. Sie benötigen das Netzwerk und Zugriff auf die
Festplatten. Das Kommando <c>lspci</c> kann Ihnen helfen, Ihre Hardware zu
identifizieren.
</p>

<pre caption="Nachladen benötigter Module">
livecd root # <i>lspci</i>
<comment>(Verwenden Sie die Ausgabe von lspci, um benötigte Module zu
identifizieren.)</comment>

<comment>(Das folgende ist ein Beispiel, passen Sie es entsprechend Ihrer
Hardware an.)</comment>
livecd root # <i>modprobe 3w-9xxx</i>
livecd root # <i>modprobe r8169</i>
</pre>

</body>
</section>
<section>
<title>Netzwerk-Konfiguration</title>
<body>

<p>
Wenn Ihr Netzwerk nicht bereits arbeitet, können Sie das Kommando
<c>net-setup</c> verwenden, um Ihr Netzwerk zu konfigurieren. Möglicherweise
müssen Sie vor der Konfiguration <c>modprobe</c> aufrufen, um das Modul zur
Unterstützung Ihrer Netzwerkkarte zu laden. Wenn Sie ADSL haben, verwenden Sie
<c>pppoe-setup</c> und <c>pppoe-start</c>. Wenn Sie einen ADSL-Router verwenden,
baut dieser die Verbindung für Sie auf und Sie brauchen diese Skripte nicht
ausführen. Für PPTP-Unterstützung editieren Sie zunächst
<path>/etc/ppp/chap-secrets</path> und <path>/etc/ppp/options.pptp</path>und
verwenden dann <c>pptp&lt;server&nbsp;ip&gt;</c>.
</p>

<p>
Für Wireless-Zugang verwenden Sie zunächst <c>iwconfig</c>, um die Parameter der
Wireless-Verbindung einzustellen, und dann entweder nochmal <c>net-setup</c>
oder manuell <c>ifconfig</c>, <c>dhcpcd</c> und/oder <c>route</c>.
</p>

<p>
Wenn Sie einen Proxy verwenden, vergessen Sie nicht, Ihr System mit <c>export
http_proxy</c>, <c>ftp_proxy</c> und <c>RSYNC_PROXY</c> zu initialisieren.
</p>

<pre caption="Automatische Konfiguration des Netzwerks">
livecd root # <i>net-setup eth0</i>
</pre>

<p>
Sie können alternativ das Netzwerk auch manuell starten. Das folgende Beispiel
weist Ihrem PC die IP-Adresse 192.168.1.10 zu und definiert 192.168.1.1 als
Ihren Router und Namensserver.
</p>

<pre caption="Manuelle Konfiguration des Netzwerks">
livecd root # <i>ifconfig eth0 192.168.1.10/24</i>
livecd root # <i>route add default gw 192.168.1.1</i>
livecd root # <i>echo nameserver 192.168.1.1 > /etc/resolv.conf</i>
</pre>

<p>
Die Installations-CD erlaubt es Ihnen, einen <c>sshd</c>-Dienst zu starten,
zusätzliche Benutzer anzulegen, <c>irssi</c> (ein Kommandzeilen-Chat-Client) zu
starten und mit <c>lynx</c> oder <c>links</c> im Web zu surfen.
</p>

</body>
</section>
<section>
<title>Optional: Verbindung zu Ihrem Rechner mittels ssh aufnehmen</title>
<body>

<p>
Das interessanteste ist natürlich <c>sshd</c>. Sie können ihn starten und sich
dann von einer anderen Maschine verbinden und die Kommandos aus dieser Anleitung
mit Cut'n'Paste dort ausführen.
</p>

<pre caption="sshd starten">
livecd root # <i>time /etc/init.d/sshd start</i>
 * Generating hostkey ...
<comment>(sshd generiert die Schlüssel und gibt noch mehr aus)</comment>
 * starting sshd ...                            [ok]

real   0m13.688s
user   0m9.420s
sys    0m0.090s
</pre>

<p>
Nun setzen Sie das Passwort auf der Live CD, so dass Sie sich von einem anderen
Rechner aus anmelden können. Bitte beachten Sie, dass es unter normalen
Umständen nicht ratsam ist, root den Zugang über ssh zu erlauben. Wenn Sie Ihrem
lokalen Netzwerk nicht vertrauen können, wählen Sie ein langes, kompliziertes
Passwort; Sie werden es nur einmalig verwenden, da es nach dem ersten Neustart
verschwinden wird.
</p>

<pre caption="Das root-Passwort setzen">
livecd root # <i>passwd</i>
New UNIX password: <comment>hier_ihr_passwort_eingeben</comment>
Retype new UNIX password: <comment>hier_ihr_passwort_erneut_eingeben</comment>
passwd: password updated successfully
</pre>

<p>
Jetzt können Sie ein Terminal auf einem anderen Rechner starten und sich mit dem
neuen Rechner verbinden, der weiteren Anleitung in einem anderen Fenster folgen
und die Kommandos mit Cut'n'Paste im Terminal ausführen.
</p>

<pre caption="Von einem anderen Rechner Verbindung zum neuen Rechner aufbauen">
<comment>(Verwenden Sie die IP-Adresse Ihres neuen Rechners)</comment>
$ <i>ssh root@192.168.1.10</i>
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
RSA key fingerprint is 96:e7:2d:12:ac:9c:b0:94:90:9f:40:89:b0:45:26:8f.
Are you sure you want to continue connecting (yes/no)? <i>yes</i>
Warning: Permanently added '192.168.1.10' (RSA) to the list of known hosts.
Password: <comment>Hier das Paßwort eingeben</comment>
</pre>

</body>
</section>
<section>
<title>Vorbereiten der Festplatten</title>
<body>

<p>
Laden Sie die Module für Software-RAID und LVM2.
</p>

<pre caption="Laden der RAID- und LVM2-Module">
livecd ~ # <i>modprobe raid0</i>
livecd ~ # <i>modprobe raid1</i>
<comment>(raid5, raid6 und raid10 sind auch verfügbar)</comment>

livecd ~ # <i>modprobe dm-mod</i>
</pre>

<p>
Verwenden Sie <c>fdisk</c> oder <c>cfdisk</c>, um Ihr Partitions-Layout zu
erstellen. Die Gerätenamen sind höchstwarscheinlich <path>/dev/sda</path> und
<path>/dev/sdb</path> für SATA- oder SCSI-Festplatten, bzw.
<path>/dev/hda</path> und <path>/dev/hdb</path> für IDE-Festplatten. Das
folgende Layout wird in dieser Anleitung verwendet:
</p>

<table>
  <tr>
    <ti/>
    <th><path>/dev/sda</path></th>
    <th><path>/dev/sdb</path></th>
    <th>Typ</th>
  </tr>
  <tr>
    <th><path>/dev/md1</path></th>
    <th><path>/boot</path></th>
    <th><path>/boot</path></th>
    <ti>Raid-1 (gespiegelt)</ti>
  </tr>
  <tr>
    <th/>
    <th>swap</th>
    <th>swap</th>
    <ti>Normale Partitionen</ti>
  </tr>
  <tr>
    <th><path>/dev/md3</path></th>
    <th><path>/</path></th>
    <th><path>/</path></th>
    <ti>Raid-1 (gespiegelt)</ti>
  </tr>
  <tr>
    <th><path>/dev/md4</path></th>
    <th colspan="2">LVM2 Volumes</th>
    <ti>Raid-0 (gestriped)</ti>
  </tr>
</table>

<impo>
Ihre Boot-Partition darf nicht gestriped sein. Sie sollte auch kein RAID-5 oder
RAID-0 sein.
</impo>

<note>
Einerseits sollten Sie, falls Sie mehr Stabilität wünschen, darüber nachdenken
RAID-1 (oder sogar RAID-5) für Ihre Swap-Partition(en) zu verwenden, damit ein
Festplattenausfall nicht Ihren Swap-Bereich korrumpiert und die Anwendungen
abstürzen lässt, die Sie gerade benutzen. Andererseits sollten Sie, falls Sie
mehr Leistung wünschen, einfach den Kernel getrennte Swap-Partitionen nutzen
lassen, da er Striping standardmäßig nutzt.
</note>

<pre caption="Partitionen erzeugen">
livecd ~ # <i>fdisk /dev/sda</i>
<comment>(Benutzen Sie Typ fd)</comment>

<comment>(Der Rest dieser Anleitung verwendet das folgende
Partitionsschema)</comment>
livecd ~ # <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 299.9 GB, 299989204992 bytes
255 heads, 63 sectors/track, 36471 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1          11       88326   fd  Linux raid autodetect
/dev/sda2              12          61      401625   82  Linux swap / Solaris
/dev/sda3              62         311     2008125   fd  Linux raid autodetect
/dev/sda4             312       36471   290455200   fd  Linux raid autodetect

<comment>(Partitionieren Sie die zweite Festplatte identisch zur
ersten)</comment>
livecd ~ # <i>fdisk /dev/sdb</i>
</pre>

<p>
Dann erstellen Sie die RAID-Geräteknoten und Geräte:
</p>

<pre caption="Erstellen der Geräteknoten und Geräte">
livecd ~ # <i>mknod /dev/md1 b 9 1</i>
livecd ~ # <i>mknod /dev/md3 b 9 3</i>
livecd ~ # <i>mknod /dev/md4 b 9 4</i>

livecd ~ # <i>mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/sda1 /dev/sdb1</i>
mdadm: array /dev/md1 started.
livecd ~ # <i>mdadm --create /dev/md3 --level=1 --raid-devices=2 /dev/sda3 /dev/sdb3</i>
mdadm: array /dev/md3 started.
livecd ~ # <i>mdadm --create /dev/md4 --level=0 --raid-devices=2 /dev/sda4 /dev/sdb4</i>
mdadm: array /dev/md4 started.

<comment>(Abwarten, bis alle Einheiten bereit sind)</comment>
livecd ~ # <i>cat /proc/mdstat</i>
Personalities : [raid0] [raid1]
md4 : active raid0 sdb4[1] sda4[0]
581006592 blocks 64k chunks

md3 : active raid1 sdb3[1] sda3[0]
1959808 blocks [2/2] [UU]

md1 : active raid1 sdb1[1] sda1[0]
88256 blocks [2/2] [UU]
</pre>

<p>
Dann erstellen Sie die LVM2-Volumes in <path>/dev/md4</path>. Das folgende
Schema wird als <b>Beispiel</b> benutzt:
</p>

<table>
<tr>
  <th>Verzeichnis</th>
  <th>Größe</th>
  <th>Dateisystem</th>
</tr>
<tr>
  <ti>/usr</ti>
  <ti>8 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/usr/portage</ti>
  <ti>2 GB</ti>
  <ti>ext2, kleine blockgröße, viele INodes</ti>
</tr>
<tr>
  <ti>/usr/portage/distfiles</ti>
  <ti>4 GB</ti>
  <ti>ext2, große Blockgröße, weniger INodes</ti>
</tr>
<tr>
  <ti>/home</ti>
  <ti>10 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/opt</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var/tmp</ti>
  <ti>6 GB</ti>
  <ti>ext2</ti>
</tr>
<tr>
  <ti>/tmp</ti>
  <ti>2 GB</ti>
  <ti>ext2</ti>
</tr>
</table>

<pre caption="Erstellen der LVM2-Volumes">
livecd ~ # <i>vgscan</i>
  Reading all physical volumes.  This may take a while...
  No volume groups found
livecd ~ # <i>vgchange -a y</i>
  No volume groups found

<comment>(Erstellen der physikalischen Volumes, in unserem Beispiel nur
eines)</comment>
livecd ~ # <i>pvcreate /dev/md4</i>
  Physical volume "/dev/md4" successfully created

<comment>(Erstellen der Volume-Gruppen, in unserem Beispiel auch nur
eine)</comment>
livecd ~ # <i>vgcreate vg /dev/md4</i>
  Volume group "vg" successfully created

<comment>(erstellen der logischen Volumes)</comment>
livecd ~ # <i>lvcreate -L8G -nusr vg</i>
  /dev/cdrom: open failed: Read-only file system
  Logical volume "usr" created <comment>(Weitere ähnlich lautende Meldungen
  werden nicht aufgeführt)</comment>
livecd ~ # <i>lvcreate -L2G -nportage vg</i>
livecd ~ # <i>lvcreate -L4G -ndistfiles vg</i>
livecd ~ # <i>lvcreate -L10G -nhome vg</i>
livecd ~ # <i>lvcreate -L4G -nopt vg</i>
livecd ~ # <i>lvcreate -L4G -nvar vg</i>
livecd ~ # <i>lvcreate -L6G -nvartmp vg</i>
livecd ~ # <i>lvcreate -L2G -ntmp vg</i>

<comment>(Anzeigen der Volume-Gruppen und logischen Volumes)</comment>
livecd ~ # <i>vgs</i>
  VG   #PV #LV #SN Attr  VSize   VFree
  vg     1   8   0 wz--n 554.09G 514.09G
livecd ~ # <i>lvs</i>
  LV        VG   Attr   LSize  Origin Snap%  Move Copy%
  distfiles vg   -wi-a-  4.00G
  home      vg   -wi-a- 10.00G
  opt       vg   -wi-a-  4.00G
  portage   vg   -wi-a-  2.00G
  tmp       vg   -wi-a-  2.00G
  usr       vg   -wi-a-  8.00G
  var       vg   -wi-a-  4.00G
  vartmp    vg   -wi-a-  6.00G
</pre>

<p>
Verwenden Sie <c>mke2fs</c>, <c>mke2fs -j</c>, <c>mkreiserfs</c>,
<c>mkfs.xfs</c> und <c>mkfs.jfs</c>, um die Dateisysteme zu erstellen.
Initialisieren Sie die Swap-Partition mit <c>mkswap</c> und <c>swapon</c>.
</p>

<pre caption="Erstellen der Dateisysteme und Swap aktivieren">
<comment>(Sie benötigen nur ext2 auf der /boot Partition)</comment>
livecd ~ # <i>mke2fs /dev/md1</i>

<comment>(Wir verwenden ext3 auf der root Partition)</comment>
livecd ~ # <i>mke2fs -j /dev/md3</i>

<comment>(Erstellen der Dateisysteme auf den logischen Volumes)</comment>
livecd ~ # <i>mke2fs -b 4096 -T largefile /dev/vg/distfiles</i>
livecd ~ # <i>mke2fs -j /dev/vg/home</i>
livecd ~ # <i>mke2fs -j /dev/vg/opt</i>
livecd ~ # <i>mke2fs -b 1024 -N 200000 /dev/vg/portage</i>
livecd ~ # <i>mke2fs /dev/vg/tmp</i>
livecd ~ # <i>mke2fs -j /dev/vg/usr</i>
livecd ~ # <i>mke2fs -j /dev/vg/var</i>
livecd ~ # <i>mke2fs /dev/vg/vartmp</i>

<comment>(Erstellen und aktivieren des Swap)</comment>
livecd ~ # <i>mkswap /dev/sda2 &amp;&amp; mkswap /dev/sdb2</i>
livecd ~ # <i>swapon -p 1 /dev/sda2 &amp;&amp; swapon -p 1 /dev/sdb2</i>
<comment>(Überprüfen Sie, daß alle Swap-Partitionen die gleiche Priorität
verwenden)</comment>
livecd ~ # <i>swapon -v -s</i>
Filename                   Type            Size    Used    Priority
/dev/sda2                  partition       401616  0       1
/dev/sdb2                  partition       401616  0       1
</pre>

<p>
Hängen Sie das frisch erzeugte Dateisystem bei <path>/mnt/gentoo</path> ein.
Erstellen Sie die Verzeichnisse der anderen Mount-Punkte und hängen Sie sie auch
ein.
</p>

<pre caption="Einhängen der Dateisysteme">
livecd ~ # <i>mount /dev/md3 /mnt/gentoo</i>
livecd ~ # <i>cd /mnt/gentoo</i>
livecd gentoo # <i>mkdir boot home usr opt var tmp</i>
livecd gentoo # <i>mount /dev/md1 /mnt/gentoo/boot</i>
livecd gentoo # <i>mount /dev/vg/usr /mnt/gentoo/usr</i>
livecd gentoo # <i>mount /dev/vg/home /mnt/gentoo/home</i>
livecd gentoo # <i>mount /dev/vg/opt /mnt/gentoo/opt</i>
livecd gentoo # <i>mount /dev/vg/tmp /mnt/gentoo/tmp</i>
livecd gentoo # <i>mount /dev/vg/var /mnt/gentoo/var</i>
livecd gentoo # <i>mkdir usr/portage var/tmp</i>
livecd gentoo # <i>mount /dev/vg/vartmp /mnt/gentoo/var/tmp</i>
livecd gentoo # <i>mount /dev/vg/portage /mnt/gentoo/usr/portage</i>
livecd gentoo # <i>mkdir usr/portage/distfiles</i>
livecd gentoo # <i>mount /dev/vg/distfiles /mnt/gentoo/usr/portage/distfiles</i>

<comment>(Setzen Sie die richtigen Berechtigungen auf den
tmp-Verzeichnissen)</comment>
livecd gentoo # <i>chmod 1777 /mnt/gentoo/tmp /mnt/gentoo/var/tmp</i>
</pre>

</body>
</section>
<section>
<title>Einrichten des Stage</title>
<body>

<p>
Zunächst stellen Sie mit <c>date MMDDhhmmYYYY</c> sicher, dass Datum und Uhrzeit
Ihres Rechners korrekt eingestellt sind. Verwenden Sie UTC-Zeit.
</p>

<pre caption="Setzen von Datum und UTC-Zeit">
<comment>(Uhrzeit prüfen)</comment>
livecd gentoo # <i>date</i>
Mon Mar  6 00:14:13 UTC 2006

<comment>(Setzen Sie das aktuelle Datum und die Zeit bei Bedarf)</comment>
livecd gentoo # <i>date 030600162006</i> <comment>(Das Format ist
MMDDhhmmYYYY)</comment>
Mon Mar  6 00:16:00 UTC 2006
</pre>

<p>
Als nächstes laden Sie ein Stage von einem unserer <uri
link="/main/en/mirrors.xml">Mirror</uri>. Gehen Sie nach
<path>/mnt/gentoo</path> und entpacken das Stage mit dem Kommando
<c>tar xjpf &lt;stage3 tarball&gt;</c>.
</p>

<pre caption="Laden eines Stage3 Archivs">
livecd gentoo # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Wählen Sie einen Mirror, wechseln Sie in das Verzeichnis
releases/x86/current/stages, markieren Sie das stage3 Ihrer Wahl, wahrscheinlich
das i686-stage3, und drücken Sie D zum laden)</comment>

<comment>(<b>Oder</b> laden Sie es direkt mit wget, ohne einen nahegelegenen
Mirror zu wählen)</comment>
livecd gentoo # <i>wget ftp://gentoo.osuosl.org/pub/gentoo/releases/x86/current/stages/stage3-i686*tar.bz2</i>
</pre>

<pre caption="Entpacken des stage3-Archivs">
livecd gentoo # <i>time tar xjpf stage3*</i>

real  1m14.157s
user  1m2.920s
sys   0m7.530s
</pre>

<p>
Installieren Sie den neuesten Portage-Snapshot. Gehen Sie wie beim stage3-Archiv
vor: wählen Sie einen nahegelegenen Mirror aus unserer <uri
link="/main/en/mirrors.xml">Liste</uri>, laden Sie den neuesten Snapshot und
entpacken Sie ihn.
</p>

<pre caption="Laden des neuesten Portage-Snapshots">
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Wählen Sie einen Mirror, gehen Sie zum Verzeichnis snapshots/,
markieren Sie <b>portage-latest.tar.bz2</b> und drücken Sie zum Laden
D.)</comment>

<comment>(<b>Oder</b> laden Sie es direkt mit wget ohne einen nahegelegenen
Mirror zu wählen)</comment>
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>wget http://gentoo.osuosl.org/snapshots/portage-latest.tar.bz2</i>
</pre>

<pre caption="Entpacken des Portage-Snapshots">
livecd usr # <i>time tar xjf portage-lat*</i>

real  0m40.523s
user  0m28.280s
sys   0m8.240s
</pre>

</body>
</section>
<section>
<title>Chroot ausführen</title>
<body>

<p>
Hängen Sie das Dateisystem <path>/proc</path> ein, kopieren Sie die Datei
<path>/etc/resolv.conf</path> und dann wechseln Sie mit chroot in Ihre
Gentoo-Umgebung.
</p>

<pre caption="Chroot">
livecd usr # <i>cd /</i>
livecd / # <i>mount -t proc proc /mnt/gentoo/proc</i>
livecd / # <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/</i>
livecd / # <i>chroot /mnt/gentoo /bin/bash</i>
livecd / # <i>env-update &amp;&amp; source /etc/profile</i>
>>> Regenerating /etc/ld.so.cache...
</pre>

</body>
</section>
<section>
<title>Setzen Sie Ihre Zeitzone</title>
<body>

<p>
Setzen Sie Ihre Zeitzone, indem Sie die richtige Auflistung in
<path>/usr/share/zoneinfo</path> verwenden.
</p>

<pre caption="Setzen der Zeitzone">
livecd / # <i>ls /usr/share/zoneinfo</i>
<comment>(Wir verwenden Berlin als Beispiel)</comment>
livecd / # <i>cp /usr/share/zoneinfo/Europe/Berlin /etc/localtime</i>

livecd / # <i>date</i>
Wed Mar  8 00:46:05 CET 2006
</pre>

</body>
</section>
<section>
<title>Setzen Sie Ihren Hostnamen und Domain-Namen</title>
<body>

<p>
Sie setzen Ihren Hostnamen in <path>/etc/conf.d/hostname</path> und
<path>/etc/hosts</path>. Im folgenden Beispiel benutzen wir <c>mybox</c> als
Hostnamen und <c>at.myplace</c> als Domainnamen. Sie können entweder die
Konfigurationsdateien mit <c>nano</c> editieren oder die folgenden Kommandos
benutzen:
</p>

<pre caption="Host- und Domainnamen setzen">
livecd / # <i>cd /etc</i>
livecd etc # <i>echo "127.0.0.1 mybox.at.myplace mybox localhost" > hosts</i>
livecd etc # <i>sed -i -e 's/HOSTNAME.*/HOSTNAME="mybox"/' conf.d/hostname</i>
<comment>(Definierten Hostnamen verwenden und überprüfen)</comment>
livecd etc # <i>hostname mybox</i>
livecd etc # <i>hostname -f</i>
mybox.at.myplace
</pre>

</body>
</section>
<section>
<title>Kernel-Konfiguration</title>
<body>

<p>
Installieren Sie einen Kernel-Quellcode (üblicherweise <c>gentoo-sources</c>),
konfigurieren und kompilieren Sie ihn und kopieren Sie dann die Datei <path>
arch/i386/boot/bzImage</path> nach <path>/boot</path>.
</p>

<pre caption="Installieren und Kompilieren des Kernel-Quellcodes und
Installieren des Kernels">
livecd etc # <i>time emerge gentoo-sources</i>

real  3m3.110s
user  1m2.320s
sys   0m34.990s
livecd etc # <i>cd /usr/src/linux</i>
livecd linux # <i>make menuconfig</i>

<comment>(Konfigurieren Sie Ihren Kernel wie üblich und stellen Sie sicher, dass
die von Ihnen benötigten RAID- und LVM-Module einkompiliert werden, d.h.
<b>nicht</b> als Module. Dasselbe gilt auch für Festplattentreiber und
Dateisysteme.)</comment>
Multi-device support (RAID and LVM)  --->
[*] Multiple devices driver support (RAID and LVM)
  &lt;*&gt;   RAID support
  &lt; &gt;     Linear (append) mode (NEW)
  &lt;*&gt;     RAID-0 (striping) mode
  &lt;*&gt;     RAID-1 (mirroring) mode
  &lt; &gt;     RAID-10 (mirrored striping) mode (EXPERIMENTAL) (NEW)
  &lt; &gt;     RAID-4/RAID-5 mode (NEW)
  &lt; &gt;     RAID-6 mode (NEW)
  &lt; &gt;     Multipath I/O support (NEW)
  &lt; &gt;     Faulty test module for MD (NEW)
  &lt;*&gt;   Device mapper support
  &lt; &gt;     Crypt target support (NEW)
  &lt; &gt;     Snapshot target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Mirror target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Zero target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Multipath target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Bad Block Relocation Device Target (EXPERIMENTAL) (NEW)

livecd linux # <i>time make -j2</i>

<comment>(Die vergangene Zeit ist sehr abhängig von den von Ihnen gewählten
Optionen)</comment>
real  5m5.869s
user  4m32.320s
sys   0m32.930s

livecd linux # <i>make modules_install</i>
livecd linux # <i>cp arch/i386/boot/bzImage /boot/kernel</i>
</pre>

</body>
</section>
<section>
<title>Konfiguration des Systems</title>
<body>

<p>
Editieren Sie Ihre Datei <path>/etc/fstab</path> und ersetzen Sie <c>BOOT</c>,
<c>ROOT</c> und <c>SWAP</c> mit den tatsächlichen Partitionsnamen und fügen Sie
Ihre logischen Volumes hinzu. Vergessen Sie nicht zu überprüfen, ob die
angegebenen Dateisysteme mit Ihrer Installation übereinstimmen.
</p>

<pre caption="fstab-Beispiel">
livecd linux # <i>cd /etc</i>
livecd etc # <i>nano -w fstab</i>
/dev/<i>md1</i>          /boot                   ext2  noauto,noatime  1 2
/dev/<i>md3</i>          /                       ext3  noatime         0 1
/dev/<i>sda2</i>         none                    swap  sw,pri=1        0 0
/dev/<i>sdb2</i>         none                    swap  sw,pri=1        0 0
/dev/vg/usr       /usr                    ext3  noatime         1 2
/dev/vg/portage   /usr/portage            ext2  noatime         1 2
/dev/vg/distfiles /usr/portage/distfiles  ext2  noatime         1 2
/dev/vg/home      /home                   ext3  noatime         1 2
/dev/vg/opt       /opt                    ext3  noatime         1 2
/dev/vg/tmp       /tmp                    ext2  noatime         1 2
/dev/vg/var       /var                    ext3  noatime         1 2
/dev/vg/vartmp    /var/tmp                ext2  noatime         1 2
</pre>

<p>
Konfigurieren Sie Ihr Netzwerk in <path>/etc/conf.d/net</path>. Fügen Sie das
init-Script <c>net.eth0</c> in den Runlevel default ein. Falls Sie mehrere NICs
haben, erstellen Sie Symlinks für diese und fügen Sie sie ebenfalls zum Runlevel
default hinzu. Entweder editieren Sie <path>/etc/conf.d/net</path> mit
<c>nano</c> oder Sie verwenden folgende Kommandos:
</p>

<pre caption="Netzwerk-Konfiguration">
livecd etc # <i>cd conf.d</i>
livecd conf.d # <i>echo 'config_eth0=( "192.168.1.10/24" )' >> net</i>
livecd conf.d # <i>echo 'routes_eth0=( "default via 192.168.1.1" )' >> net</i>
livecd conf.d # <i>rc-update add net.eth0 default</i>
<comment>(Wenn Sie den Netzwerkkartentreiber als Modul konfiguriert haben, fügen
Sie ihn zu /etc/modules.autoload.d/kernel-2.6 hinzu.)</comment>
livecd conf.d # <i>echo r8169 >> /etc/modules.autoload.d/kernel-2.6</i>
<comment>(Wenn Sie nach dem Neustart wieder mittels ssh eine Verbindung zum
neuen Rechner aufnehmen wollen)</comment>
livecd conf.d # <i>rc-update add sshd default</i>
</pre>

<note>
Falls Sie es benötigen, emergen Sie <c>pcmcia-cs</c> und fügen Sie es zum
Runlevel default.
</note>

<p>
Setzen Sie das root-Passwort mit <c>passwd</c>.
</p>

<pre caption="Setzen des root-Passworts">
livecd conf.d # <i>passwd</i>
New UNIX password: <comment>hier_ihr_passwort_eingeben</comment>
Retype new UNIX password: <comment>hier_ihr_passwort_erneut_eingeben</comment>
passwd: password updated successfully
</pre>

<p>
Editieren Sie <path>/etc/conf.d/clock</path>, um die Zeitzone zu bestimmen, die
Sie zuvor verwendet haben.
</p>

<pre caption="/etc/conf.d/clock editieren">
livecd conf.d # <i>nano -w /etc/conf.d/clock</i>
TIMEZONE="Europe/Berlin"
</pre>

<p>
Überprüfen Sie die Systemkonfiguration in <path>/etc/rc.conf</path>,
<path>/etc/conf.d/rc</path> und <path>/etc/conf.d/keymaps</path> und passen Sie
sie bei Bedarf an.
</p>

<pre caption="Optional: Einige Konfigurationsdateien anpassen">
livecd conf.d # <i>nano -w /etc/rc.conf</i>
livecd conf.d # <i>nano -w /etc/conf.d/rc</i>
livecd conf.d # <i>nano -w /etc/conf.d/keymaps</i>
</pre>

</body>
</section>
<section>
<title>Installieren von Systemwerkzeugen</title>
<body>

<p>
Installieren der RAID- und LVM2-Werkzeuge.
</p>

<pre caption="Installieren der RAID- &amp; LVM2-Werkzeuge">
livecd conf.d # <i>emerge mdadm lvm2</i>
</pre>

<p>
Installieren Sie einen Systemlogger wie <c>syslog-ng</c> und einen cron-Daemon
wie <c>vixie-cron</c>, und fügen Sie sie zum Runlevel default hinzu.
</p>

<note>
Cron-Daemons benötigen einen MTA. <c>mail-mta/ssmtp</c> wird als eine
Abhängigkeit angezogen. Wenn Sie einen fortschrittlicheren MTA wünschen, können
Sie ihn jetzt installieren. Wenn Sie es eilig haben, lassen Sie ssmtp
installieren und entfernen Sie ihn später, wenn Sie den MTA Ihrer Wahl
installieren.
</note>

<pre caption="Einen Syslogger und einen Cron-Daemon installieren">
livecd conf.d # <i>time emerge syslog-ng vixie-cron</i>

real  1m54.099s
user  1m2.630s
sys   0m34.620s
livecd conf.d # <i>rc-update add syslog-ng default</i>
livecd conf.d # <i>rc-update add vixie-cron default</i>
</pre>

<p>
Installieren Sie die notwendigen Systemwerkzeuge (<c>xfsprogs</c>,
<c>reiserfsprogs</c> oder <c>jfsutils</c>) und Netzwerk-Werkzeuge (<c>dhcpcd</c>
oder <c>ppp</c>), falls Sie sie benötigen.
</p>

<pre caption="Zusätzliche Werkzeuge nach Bedarf installieren">
livecd conf.d # <i>emerge xfsprogs</i>       <comment>(Wenn Sie das Dateisystem
XFS nutzen)</comment>
livecd conf.d # <i>emerge jfsutils</i>       <comment>(Wenn Sie das Dateisystem
JFS nutzen)</comment>
livecd conf.d # <i>emerge reiserfsprogs</i>  <comment>(Wenn Sie das Dateisystem
Reiser nutzen)</comment>
livecd conf.d # <i>emerge dhcpcd</i>         <comment>(Wenn Sie einen DHCP
client nutzen)</comment>
livecd conf.d # <i>emerge ppp</i>            <comment>(Wenn Sie eine Verbindung
über PPPoE ADSL benötigen)</comment>
</pre>

</body>
</section>
<section>
<title>Konfiguration des Bootloaders</title>
<body>

<p>
Emergen Sie <c>grub</c> und konfigurieren Sie es.
</p>

<pre caption="Grub emergen und seine Konfigurationsdatei editieren">
livecd conf.d # <i>time emerge grub</i>

real  1m4.634s
user  0m39.460s
sys   0m15.280s
livecd conf.d # <i>nano -w /boot/grub/grub.conf</i>
</pre>

<pre caption="grub.conf-Beispiel">
default 0
timeout 10

title=Gentoo
root (hd0,0)
kernel /boot/kernel root=/dev/md3
</pre>

<pre caption="Installation von grub auf beiden Festplatten">
livecd conf.d # <i>grub</i>
Probing devices to guess BIOS drives. This may take a long time.

grub> <i>root (hd0,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd0)</i>
 Checking if "/boot/grub/stage1" exists... yes
 Checking if "/boot/grub/stage2" exists... yes
 Checking if "/boot/grub/e2fs_stage1_5" exists... yes
 Running "embed /boot/grub/e2fs_stage1_5 (hd0)"...  16 sectors are embedded.
succeeded
 Running "install /boot/grub/stage1 (hd0) (hd0)1+16 p (hd0,0)/boot/grub/stage2 /boot/
grub/menu.lst"... succeeded
Done.

grub> <i>root (hd1,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd1)</i>

grub> <i>quit</i>
</pre>

</body>
</section>
<section>
<title>Neustart</title>
<body>

<p>
Verlassen Sie die Chroot-Umgebung, hängen Sie alle Dateisysteme aus und booten
Sie neu:
</p>

<pre caption="Neustart">
livecd conf.d # <i>exit</i>
livecd / # <i>umount /mnt/gentoo/usr/portage/distfiles /mnt/gentoo/usr/portage /mnt/gentoo/usr</i>
livecd / # <i>umount /mnt/gentoo/var/tmp /mnt/gentoo/tmp /mnt/gentoo/var /mnt/gentoo/opt</i>
livecd / # <i>umount /mnt/gentoo/proc /mnt/gentoo/home /mnt/gentoo/boot /mnt/gentoo</i>
livecd / # <i>reboot</i>
<comment>(Vergessen Sie nicht, die CD herauszunehmen)</comment>
</pre>

<p>
Bitte folgen Sie dem Abschnitt <uri
link="gentoo-x86-quickinstall.xml#after-reboot">Installation abschließen</uri>
des regulären x86-Kurzleitfadens zur Installation, um Ihre Installation
abzuschließen.
</p>

</body>
</section>
</chapter>
</guide>
