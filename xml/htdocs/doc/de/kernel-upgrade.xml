<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/de/kernel-upgrade.xml,v 1.1 2004/12/24 15:33:50 dertobi123 Exp $ -->

<!-- English CVS Version: 1.2 -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/dekernel-upgrade.xml">
<title>Gentoo-Linux Kernel-Upgrade-Guide</title>
<author title="Autor">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Übersetzung">
  <mail link="gentoo at thomasgier dot de">Thomas Gier</mail>
</author>

<abstract>
Dieses Dokument beschreibt das Verfahren eines Kernel-Upgrades von einem Release
auf ein anderes. 
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>0.1.0</version>
<date>1. November 2004</date>

<chapter>
<title>Einleitung</title>
<section>
<body>

<p>
Der Kernel ist eines der wenigen Pakete, die einige Handarbeit erfordern, um das
Upgrade zu vervollständigen. Portage wird die Kernel-Quellen für Sie downloaden
und installieren, anschließend ist es jedoch Ihr Ding, den Kernel zu kompilieren,
bevor irgendwelche Änderungen wirksam werden. 
</p>

<p>
Obgleich dieser Guide an User gerichtet ist, die von einem Kernel-Release zu einem
anderen upgraden, ist er sicher auch für User nützlich, die von einem
Kernel-Package zu einem anderen migrieren. 
</p>

<p>
In diesem Dokument wird <c>gentoo-dev-sources</c>  als Beispiel verwendet, jedoch
gelten die hier dargestellten Instruktionen auch für andere Pakete unseres Baums.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Warum den Kernel aktualisieren?</title>
<section>
<body>

<p>
Im Allgemeinen bringt eine Aktualisierung von einem Kernel-Release zum nächsten
keine maßgeblichen Unterschiede. Gründe für eine Aktualisierung des Kernels sind
entweder das Zunutze machen eines neuen Features oder eines neuen Treibers, das
Schließen einer Sicherheitslücke oder lediglich das Bedürfnis, ein aktuelles und
gesundes System zu behalten. 
</p>

<p>
Auch wenn Sie nicht auf jede neue Kernel-Revision aktualisieren möchten - es ist
es zu empfehlen, zumindest von Zeit zu Zeit eine Aktualisierung
durchzuführen. Es wird allerdings dringend empfohlen, sofort ein Upgrade auf einen neuen
Kernel zu machen, wenn durch das neue Release ein Sicherheitsproblem gelöst wird.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aktuellere Quellen mit Hilfe von Portage erhalten</title>
<section>
<body>

<p>
Kernel-Quellen werden, wie jedes andere Paket, mit Hilfe des
<c>emerge</c>-Dienstprogramms aktualisiert. Dass Sie Ihren Kernel aktualisieren
wollen wird wahrscheinlich dann der Fall sein, wenn die Aktualisierung in der
Liste der World-Updates auftaucht. 
</p>

<pre caption="Neue Kernel-Quellen erscheinen auf der Update-Liste">
# <i>emerge -Dup world</i>
Calculating dependencies ...done!
[ebuild     U ] sys-kernel/gentoo-dev-sources-2.6.9-r2 [2.6.8-r5]
</pre>

<p>
Sie können nun weitermachen und die Aktualisierung installieren, zum Beispiel:
</p>

<pre caption="Kernel-Quellen aktualisieren">
# <i>emerge -u gentoo-dev-sources</i>
</pre>

<p>
Die Kernel-Quellen werden dann in ein Unterverzeichnis von <path>/usr/src</path>
installiert. Obiges Beispiel installiert die neuen Kernel-Quellen in den Pfad
<path>/usr/src/linux-2.6.9-gentoo-r2</path>. 
</p>

</body>
</section>
</chapter>

<chapter>
<title>Den symbolischen Link /usr/src/linux aktualisieren</title>
<section>
<body>

<p>
Gentoo benötigt einen symbolischen Link unter <path>/usr/src/linux</path> zu
unterhalten. Dieser Link muss auf die Quellen des aktuell installierten Kernel
verweisen.  
</p>

<p>
In unserem Fall muss dieser Link geändert werden, so dass er auf die
Kernel-Quellen verweist, auf die wir aktualisieren möchten. Um unser Beispiel
weiter zu verfolgen: 
</p>

<pre caption="Den Softlink /usr/src/linux aktualisieren">
# <i>cd /usr/src</i>
# <i>ln -sf linux-2.6.9-gentoo-r2 linux</i>
</pre>

</body>
</section>
</chapter>

<chapter id="install">
<title>Konfiguration, Kompilierung und Installation des neuen Kernel</title>
<section>
<body>

<p>
Für jede dieser Optionen sollten Sie die Anleitungen aus dem <uri
link="http://www.gentoo.org/doc/de/handbook/index.xml">Gentoo-Handbuch</uri>
lesen, die sich auf die <e>Konfiguration des Kernels</e> und die
<e>Konfiguration des Bootloaders</e> beziehen. An dieser Stelle liefern wir ein
kurze Zusammenfassung.
</p>

</body>
</section>
<section>
<title>Option 1: Automatisches Kernel-Setup mit genkernel</title>
<body>

<p>
Wenn Sie Genkernel verwenden, müssen Sie lediglich die Schritte wiederholen, die
Sie während der ersten Kernel-Installation bereits gemacht haben.
</p>

<p>
Starten Sie genkernel auf die übliche Art und Weise: 
</p>

<pre caption="genkernel aufrufen">
# <i>genkernel all</i>
</pre>

<p>
Sie auch können weitere Parameter für andere genkernel-Funktionen angeben. Um
zum Beispiel weitere Kernel-Optionen mit Hilfe von <c>menuconfig</c> angeben zu
können und wenn Sie möchten, dass genkernel die Konfiguration Ihres
grub-Bootloaders automatisch aktualisiert, starten Sie genkernel wie folgt: 
</p>

<pre caption="genkernel mit einigen verbreiteten Optionen starten">
# <i>genkernel --menuconfig --bootloader=grub all</i>
</pre>

<p>
Für weiterführende Informationen lesen Sie bitte den <uri
link="http://www.gentoo.org/doc/en/genkernel.xml">Gentoo Linux Genkernel
Guide</uri> oder das <e>Gentoo-Handbuch</e>.
</p>

</body>
</section>
<section>
<title>Option 2: Manuelle Konfiguration</title>
<body>

<p>
Öffnen Sie zunächst im Verzeichnisbaum der Kernel-Quellen das
Dienstprogramm <c>menuconfig</c>.
</p>

<pre caption="menuconfig aufrufen">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Wählen Sie die notwendigen Optionen für Ihre Hardware und Ihre Arbeitsumgebung
aus. Weitere Anleitung hierzu finden Sie im <e>Gentoo Handbuch</e>.
</p>

<p>
Kompilieren Sie als nächstes Ihren Kernel und kopieren Sie ihn auf Ihre
Boot-Partition. Folgen Sie wieder den Anweisungen im Handbuch, aber vergessen Sie
nicht, zuerst die <path>/boot</path>-Partition einzuhängen! Bei einer
Erst-Installation wurde dies schon zu einem wesentlich früheren Zeitpunkt
getan.
</p>

<pre caption="Kompilierung und Installation eines neuen Kernels">
# <i>make &amp;&amp; make modules_install</i>
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Als Letztes sollten Sie Ihre Bootloader-Konfiguration auf den neuesten Stand
bringen, indem Sie einen Eintrag für den neuen Kernel hinzufügen (den alten
Eintrag noch nicht löschen!) und die <path>/boot</path>-Partition
aushängen. Folgen Sie wieder den entsprechenden Anweisungen im Handbuch. 
</p>


</body>
</section>
</chapter>

<chapter>
<title>Externe Module erneut installieren</title>
<section>
<body>

<p>
Wenn Sie Kernel-Module verwenden, die nicht im Baum der Kernel-Quellen enthalten
sind, sondern an anderer Stelle im Portage-Baum bereitgestellt werden
(z.B. Nvidia- oder ATI-Grafik-Treiber), müssen Sie diese nach jedem
Kernel-Upgrade erneut installieren. Dies wird einfach durch das erneute emergen
der betreffenden Pakete erreicht. Lesen Sie für weitere Informationen  das
Kapitel <e>Konfiguration des Kernel</e> im <uri 
link="http://www.gentoo.org/doc/en/handbook/index.xml">Gentoo-Handbuch</uri>.
Wenn Sie diese Pakete erneut emergen, werden diese mit den Quellen des neuen
Kernels im Verzeichnis <path>/usr/src/linux</path> gebaut, und werden aus diesem
Grund für genau den Kernel installiert, den wir soeben gebaut haben.   
</p>

</body>
</section>
</chapter>

<chapter>
<title>Den neuen Kernel booten</title>
<section>
<body>

<p>
Als Nächstes müssen Sie alle Applikationen schließen und Ihr System neu
booten. Wenn Sie die obigen Anweisungen richtig befolgt haben, werden Sie einen
Eintrag für den neuen Kernel in Ihrem Bootloader sehen. Wählen Sie diesen
Eintrag aus und botten Sie das System.   
</p>

<p>
Hoffentlich bootet Ihr System ohne Probleme, so dass Sie sich anmelden und wie
gewohnt arbeiten können. Wenn alles funktioniert, ist das Upgrade an dieser
Stelle abgeschlossen. 
</p>

<p>
Falls Sie einen Fehler gemacht haben und Ihr System mit dem neuen Kernel nicht
korrekt bootet, können Sie einfach wieder den letzten funktionierenden Kernel
booten. Sie können dann erneut bei <uri link="#install">Konfiguration,
Kompilierung und Installation des neuen Kernel</uri> beginnen, um die
entsprechenden Änderungen durchzuführen und Ihren Fehler zu korrigieren. In
manchen Fällen (z.B. Sie haben den Netzwerk-Treiber vergessen) müssen Sie noch
nicht einmal neu booten. 
</p>

</body>
</section>
</chapter>

<chapter>
<title>Mehrere Kernel betreiben</title>
<section>
<body>

<p>
Sie werden bemerkt haben, dass bei der Installation der Quellen eines neuen
Kernel die Quellen des alten Kernel nicht entfernt werden. Dies ist beabsichtigt
und erlaubt es, mehrere verschiedene Kernel nebeneinander zu betreiben. 
</p>

<p>
Um zwischen mehreren Kernel zu wechseln, müssen Sie einfach nur die
entsprechenden Kernel-Quellen im Verzeichnis <path>/usr/src</path> und das
binäre <path>bzImage</path> auf Ihrer <path>/boot</path>-Partition belassen und
durch Einträge in der Bootloader-Konfiguration darauf verweisen. Bei jedem
Bootvorgang wird Ihnen dann eine Auswahl der möglichen Kernel durch Ihren
Bootloader angeboten.  
</p>

</body>
</section>
</chapter>

<chapter>
<title>Ältere Kernel entfernen</title>
<section>
<body>

<p>
Nach dem letzten Abschnitt sind Sie möglicherweise mit Ihrem neuen Kernel
glücklich sein und sehen keine Notwendigkeit darin, ältere Kernel zu
behalten. Um einfach alle Quellen eines bestimmten Kernels außer des neuesten zu
entfernen, können Sie sich die <e>prune</e>-Option von emerge zu Nutze
machen. Wir führen das Beispiel mit den gentoo-dev-sources fort:   
</p>

<pre caption="Alte Versionen entfernen">
# <i>emerge -P gentoo-dev-sources</i>
</pre>

<p>
In den meisten Fällen verbleiben temporäre Dateien, die während des Kompilierens
verwendet wurden, im entsprechenden Unterverzeichnis von
<path>/usr/src</path>. Diese können ohne Weiteres mit Hilfe von <c>rm</c>
entfernt werden. 
</p>

<p>
Des Weiteren können die Module, die von diesen Kernel verwendet werden, ohne
Weiteres gelöscht werden. Dies geschieht durch das Löschen der zu den nicht mehr
verwendeten Kernel gehörenden Verzeichnis-Bäume unter
<path>/lib/modules</path>. Achten Sie darauf, keine Module, die zu einem noch
verwendeten Kernel gehören, zu löschen!
</p>

<p>
Zu guter Letzt können Sie Ihre <path>/boot</path>-Partition einhängen und die
<path>bzImage</path> und <path>System.map</path> der gelöschten Kernel
entfernen. Sie sollten ebenfalls die Konfiguration Ihres Bootloaders ändern und
dort die Einträge für die gelöschten Kernel entfernen.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Probleme nach einem Kernel-Upgrade?</title>
<section>
<body>

<p>
Bei der schnellen Entwicklung des Linux-Kernel ist es unvermeidlich, dass manche
Änderungen, die von einem Kernel-Release zum nächsten gemacht wurden, ein paar
Probleme verursachen. Sollten Sie Probleme mit der neuesten Version der <uri
link="http://www.gentoo.org/doc/en/gentoo-kernel.xml#doc_chap2"> 
von Gentoo unterstützten Kernel</uri> haben, berichten Sie uns bitte von diesen
Problemen. 
</p>

</body>
</section>
</chapter>

</guide>
