<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/migration-to-2.6.xml,v 1.1 2004/12/18 17:13:12 neysx Exp $ -->

<guide link="/doc/fr/migration-to-2.6.xml" lang="fr">

<title>Le guide Gentoo exhaustif pour la migration vers Linux 2.6</title>

<author title="Auteur">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Contributeur">
	<mail link="sergey_zlodey@mail.ru">Sergey Galkin</mail>
</author>
<author title="Contributeur">
	<mail link="svyatogor@gentoo.org">Sergey Kuleshov</mail>
</author>
<author title="Correcteur">
	<mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Correcteur">
        <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Traducteur">
        <mail link="ribosome@gentoo.org">Olivier Fisette</mail>
</author>

<abstract>
Ce document vous assistera dans le processus de migration de Linux 2.4 vers
Linux 2.6, de devfs vers udev et de OSS vers ALSA.
</abstract>

<version>0.1.4</version>
<date>2004-11-28</date>

<chapter>
<title>Introduction</title>

<section>
<title>À propos de ce document</title>
<body>

<p>
Le processus de migration décrit dans le présent document implique des
changements majeurs. Ce document est encore à ses premiers stades, mais, bien
que des détails aient probablement été oubliés, les principales étapes sont
toutes abordées. Si vous tentez une telle migration, veuillez <uri
link="http://bugs.gentoo.org">rapporter</uri> tout problème éventuel afin de
nous permettre d'améliorer ce guide.
</p>

<p>
Nous projetons d'utiliser le noyau Linux 2.6 par défaut lors de la sortie de
Gentoo 2005.0 (pour certaines architectures). Au même moment, nous
encouragerons nos utilisateurs à mettre à jour leurs systèmes avec Linux 2.6
puisque plusieurs d'entre eux utiliseront probablement encore Linux 2.4. Vos
commentaires à propos de ce guide sont les bienvenus puisqu'ils nous
permettront de le peaufiner avant que ne se produise cette migration en masse.
</p>

</body>
</section>
<section>
<title>Qu'y a-t-il de nouveau dans Linux 2.6&nbsp;?</title>
<body>

<p>
Voilà une question à laquelle il n'est pas facile de répondre. Linux 2.6 est le
résultat de plus de deux ans de développement et de stabilisation de nouvelles
fonctionnalités. Du point de vue de l'architecture, il diffère
significativement de la version 2.4. Quelques-uns des changements les plus
importants sont résumés ci-dessous.
</p>

<ul>
  <li>
    Des améliorations ont été apportées à l'ordonnanceur&nbsp;: cela procure
    une meilleure interactivité pour les ordinateurs de bureau et assure un
    meilleur comportement lorsque le système est surchargé.
</li>
  <li>
    Échelonnage&nbsp;: linux s'adapte mieux à une variété de systèmes
    électroniques allant des minuscules systèmes embarqués aux ordinateurs
    multiprocesseurs.
  </li>
  <li>
    Performances&nbsp;: la vitesse des applications courantes a été augmentée
    significativement.</li>
  <li>
    Support matériel&nbsp;: Linux supporte maintenant plus d'architectures et
    plus de périphériques que tout autre système d'exploitation.
</li>
</ul>

<p>
Vous serez peut-être intéressé par le document <uri
link="http://www.kniggit.net/wwol26.html">The Wonderful World Of Linux
2.6</uri>, écrit par Joseph Pranevich, qui est particulièrement détaillé. Si
vous préférez jeter un œil sur les détails techniques, consultez le <uri
link="http://www.linux.org.uk/~davej/docs/post-halloween-2.6.txt">Document
d'après l'Halloween</uri> (en anglais). Toutefois, ce dernier document date
quelque peu.
</p>

</body>
</section>
<section>
<title>Qu'est-ce que udev&nbsp;?</title>
<body>

<p>
Par le passé, Gentoo recommandait à ses utilisateurs <e>devfs</e> pour la
gestion du répertoire <path>/dev</path> qui contient un ensemble de fichiers
servant d'interfaces entre les applications du système et le matériel (lui-même
géré par le noyau).
</p>

<p>
Bien que <e>devfs</e> ait ses mérites, il souffre de problèmes internes et a
été déclaré obsolète dans Linux 2.6.
</p>

<p>
<e>udev</e> est le nouveau système de gestion des fichiers de périphériques. Il
apporte des solutions aux problèmes présents dans les gestionnaires précédents
et va plus loin en résolvant d'autres problèmes liés au système d'exploitation.
</p>

<p>
Ce qui précède ne vous dit peut-être pas grand chose, mais n'ayez
crainte&nbsp;: l'équipe des développeurs Gentoo a travaillé avec acharnement
afin de rendre la migration de devfs vers udev très simple.
</p>

</body>
</section>
<section>
<title>Qu'est-ce que ALSA&nbsp;?</title>
<body>

<p>
Avec Linux 2.4, vous utilisiez probablement des pilotes OSS («&nbsp;Open Sound
System&nbsp;») pour faire fonctionner votre carte de son. OSS a été remplacé
par un pilote audio plus moderne et meilleur, nommé ALSA.
</p>

<p>
ALSA («&nbsp;Advanced Linux Sound Architecture&nbsp;»), est un nouvel ensemble
de pilotes audio fonctionnant avec un API amélioré. Ce système est intégré au
noyau Linux 2.6. Il offre une compatibilité ascendante avec OSS, pourvu que
vous choisissiez les options appropriées lors de la configuration de votre
noyau&nbsp;!
</p>

<note>
Si vous n'avez aucun matériel audio, vous pouvez simplement ignorer toutes les
instructions relatives à ALSA dans ce document.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Préparation</title>
<section>
<title>Mettre votre système à jour</title>
<body>

<p>
Certains des changements apportés à Linux 2.6 requièrent des modifications à
des applications du système de base. Avant de poursuivre, vous devriez vous
assurer que votre système est relativement à jour. Pour en être parfaitement
sûr, vous devriez appliquer toutes les mises à jour «&nbsp;world&nbsp;» et
«&nbsp;system&nbsp;» disponibles.
</p>

<p>
Vous devriez vous assurer tout particulièrement de disposer des dernières
versions stables des paquets logiciels suivants&nbsp;:
</p>

<ul>
  <li><c>sys-apps/baselayout</c></li>
  <li><c>sys-apps/util-linux</c></li>
  <li>
    <c>sys-kernel/genkernel</c> (Seulement si vous voulez utiliser Genkernel
    plutôt que configurer le noyau manuellement.)
</li>
</ul>

<pre caption="Mettre à jour tous les paquets «&nbsp;world&nbsp;»">
# <i>emerge sync</i>
# <i>emerge -ua world</i>
</pre>

</body>
</section>
<section>
<title>modutils vs module-init-tools</title>
<body>

<p>
<c>sys-apps/modutils</c> est le paquet logiciel contenant (entre autres) les
outils <c>modprobe</c>, <c>rmmod</c> et <c>insmod</c> pour Linux 2.4.
</p>

<p>
Linux 2.6 utilise un format différent pour les modules et nécessite donc de
nouveaux outils pour gérer ces modules. Ces outils sont rassemblés dans le
paquet <c>sys-apps/module-init-tools</c>.
</p>

<p>
Vous devriez maintenant désinstaller modutils puis installer
module-init-tools&nbsp;:
</p>

<pre caption="Passer de modutils à module-init-tools">
# <i>emerge unmerge sys-apps/modutils</i>
# <i>emerge module-init-tools</i>
</pre>

<note>
Les outils de module-init-tools sont compatibles avec Linux 2.4. Vous n'avez
donc pas à vous inquiétez lorsque vous désinstallez modutils&nbsp;; vous serez
toujours capable d'amorcer Linux 2.4 et de gérer des modules fonctionnant avec
ce noyau.
</note>

<note>
Pour la raison invoquée ci-dessus, module-init-tools est peut-être déjà
installé et fonctionnel sur votre système Linux 2.4. Si c'est le cas, vous
n'avez pas à faire quoi que ce soit de particulier&nbsp;; votre système est
déjà prêt à gérer les modules de Linux 2.6.
</note>

</body>
</section>
<section>
<title>Installer udev</title>
<body>

<p>
Aucune configuration n'est requise. Utilisez simplement <c>emerge</c> pour
installer udev&nbsp;:
</p>

<pre caption="Installer udev">
# <i>emerge -a udev</i>
</pre>

</body>
</section>
<section>
<title>Vérification des fichiers de périphériques essentiels</title>
<body>

<p>
Lorsque le système démarre, il a besoin de quelques fichiers de périphériques.
Puisque udev n'est pas inclus dans le noyau, il n'est pas activé immédiatement.
Pour éviter ce problème, vous devez vous assurer que ces fichiers de
périphériques sont présents sur votre disque.
</p>

<p>
L'archive stage utilisée lors de l'installation devrait avoir créé les fichiers
requis. Malheureusement, quelques utilisateurs ont rapporté que cela ne
fonctionne pas à tous les coups. Nous allons maintenant vérifier si ces
fichiers existent sur votre système et, sinon, les créer.
</p>

<p>
Puisque votre gestionnaire de périphériques actuel est monté sur /dev, nous ne
pouvons accéder à ce répertoire directement. Nous allons donc lier-monter votre
partition racine à un autre emplacement et accéder à /dev à partir de cet
endroit.
</p>

<pre caption="Lier-monter la partition racine et obtenir une liste des fichiers de périphériques statiques">
# <i>mkdir -p /mnt/temp</i>
# <i>mount -o bind / /mnt/temp</i>
# <i>cd /mnt/temp/dev</i>
# <i>ls -l console null</i>
</pre>

<p>
Si la commande précédente rapporte que le fichier <c>console</c> ou le fichier
<c>null</c> n'existent pas, vous devrez créer manuellement les fichiers
nécessaires tel qu'indiqué ci-dessous&nbsp;:
</p>

<pre caption="Créer les fichiers console et null">
# <i>mknod -m 660 console c 5 1</i>
# <i>mknod -m 660 null c 1 3</i>
</pre>

<p>
Vous devriez maintenant démonter la partition racine liée-montée, et ce même si
vous n'avez pas créé les fichiers de périphériques&nbsp;:
</p>

<pre caption="Démonter la partition racine liée-montée">
# <i>umount /mnt/temp</i>
# <i>rmdir /mnt/temp</i>
</pre>

</body>
</section>
<section>
<title>Installer les utilitaires ALSA</title>
<body>

<p>
ALSA nécessite certains paquets logiciels afin que les applications puissent
accéder à l'API ALSA. Ces paquets vous permettront aussi de contrôler le mixeur
et le niveau du volume. Installez ces utilitaires comme suit&nbsp;:
</p>

<pre caption="Installer les bibliothèques et les utilitaires ALSA">
# <i>emerge -a alsa-lib alsa-utils alsa-tools alsa-headers alsa-oss</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Installer les sources d'un noyau Linux 2.6</title>

<section>
<title>Choisir et installer les sources</title>
<body>

<p>
Vous devez tout d'abord installer les sources d'un noyau 2.6 de votre choix.
Les deux noyaux 2.6 officiellement supportés par Gentoo sont
<e>gentoo-dev-sources</e> (pour les stations de travail) et
<e>hardened-dev-sources</e> (pour les serveurs). D'autres noyaux sont
disponibles&nbsp;; consultez le <uri
link="/doc/fr/gentoo-kernel.xml">Guide du noyau Gentoo Linux</uri> pour en
savoir plus.
</p>

<p>
Dans ce guide, nous utiliserons <c>gentoo-dev-sources</c> à titre d'exemple.
Installez les sources du noyau que vous avez choisies avec le programme
<c>emerge</c>&nbsp;:
</p>

<pre caption="Installer gentoo-dev-sources">
# <i>emerge -a gentoo-dev-sources</i>
These are the packages that I would merge, in order:
Calculating dependencies ...done!
[ebuild  N    ] sys-kernel/gentoo-dev-sources-2.6.9-r2

Do you want me to merge these packages? [Yes/No] <i>y</i>
</pre>

</body>
</section>
<section>
<title>Mettre à jour le lien symbolique /usr/src/linux</title>
<body>

<p>
Plusieurs composants de Gentoo nécessitent que le fichier /usr/src/linux soit
un lien symbolique pointant vers les sources du noyau que vous utilisez (ou
avec lesquelles vous souhaitez compiler des paquets logiciels).
</p>

<p>
Nous allons donc mettre à jour <path>/usr/src/linux</path> afin qu'il pointe
vers les sources que vous venez d'installer. Poursuivons l'exemple
précédent&nbsp;:
</p>

<pre caption="Mettre à jour le lien symbolique /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Problèmes connus avec la migration vers Linux 2.6</title>
<section>
<body>

<p>
Avant de plonger dans la configuration du noyau, révisons quelques-unes des
erreurs les plus fréquemment commises lors de la migration vers Linux 2.6.
Certaines des remarques qui suivent influenceront la façon dont vous
configurerez votre noyau.
</p>

<note>
La pertinence des présentes remarques ne vous semblera peut-être pas évidente à
ce moment-ci, mais vous souhaiterez peut-être vous référer à ces remarques
lorsque vous lirez les sections suivantes. Nous avons préféré rassembler toutes
ces notes en un seul endroit.
</note>

</body>
</section>
<section>
<title>N'utilisez pas «&nbsp;make oldconfig&nbsp;» avec un fichier .config de
la version 2.4</title>
<body>

<note>
Si vous ne comprenez pas tout à fait cet avertissement, ne vous inquiétez
pas&nbsp;; si vous suivez correctement les instructions de ce guide, vous ne
commettrez pas cette erreur.
</note>

<p>
Vous seriez confronté à une multitude de questions puisqu'il y a eu de nombreux
changements entre les deux versions. Plusieurs utilisateurs ont essayé
d'utiliser <c>make oldconfig</c> avec un fichier de configuration provenant
d'un noyau 2.4 seulement pour obtenir un noyau inutilisable (pas de sortie à
l'écran, pas d'entrée avec le clavier, etc.) Évitez ces problèmes et utilisez
la configuration <c>menuconfig</c> traditionnelle pour votre premier noyau 2.6.
</p>

</body>
</section>
<section>
<title>N'utilisez pas ide-scsi pour la gravure de CD/DVD</title>
<body>

<p>
Dans Linux 2.4, la seule façon d'obtenir de bons résultats avec l'écriture de
CD et de DVD était d'activer l'émulation <c>ide-scsi</c> (ce qui était pour le
moins inélégant). Heureusement, la couche de gestion des périphériques IDE dans
Linux 2.6 a été étendue et supporte beaucoup mieux les graveurs de CD/DVD.
</p>

<p>
Aucune option supplémentaire n'est nécessaire pour le support de la gravure de
CD. Assurez-vous seulement de <e>ne pas</e> utiliser <c>ide-scsi</c> comme vous
le faisiez avant.
</p>

</body>
</section>
<section>
<title>Le haut-parleur PC est maintenant une option configurable</title>
<body>

<p>
Aucun son ne sera émis par votre haut-parleur PC («&nbsp;PC speaker&nbsp;») (ce
qui inclut les «&nbsp;beep&nbsp;» de la console) si vous n'activez pas
explicitement la nouvelle option concernant le haut-parleur PC
(<c>CONFIG_INPUT_PCSPKR</c>)&nbsp;:
</p>

<pre caption="Repérer l'option relative au haut-parleur PC">
Device Drivers  ---&gt;
 Input device support  ---&gt;
  [*] Misc
   &lt;*&gt;   PC Speaker support
</pre>

<note>
Le haut-parleur PC est le petit haut-parleur analogue intégré qui émet quelques
sons lorsque votre ordinateur démarre&nbsp;; il n'a rien à voir avec le
matériel standard pour le son qui est utilisé pour écouter de la musique ou
pour d'autres applications.
</note>

</body>
</section>
<section>
<title>Le nouveau pilote pour les périphériques de blocs USB est parfois
problématique</title>
<body>

<p>
Très récemment, un nouveau pilote pour le stockage de masse USB a été ajouté au
noyau. Au moment d'écrire ces lignes, ce pilote (nommé «&nbsp;ub&nbsp;») est
encore dans ses premières étapes de développement et cause des problèmes à
certains utlisateurs. Si vous avez des difficultés à accéder à vos
périphériques USB (disque dur, disque flash, lecteur de cartes, caméra
numérique), vous pouvez revenir à l'ancien pilote de type SCSI&nbsp;:
</p>

<pre caption="Désactiver ub">
Device Drivers  ---&gt;
 Block devices  ---&gt;
  &lt; &gt; Low Performance USB Block driver
</pre>

<note>
L'ancien pilote de type SCSI (appelé «&nbsp;USB Mass Storage support&nbsp;»)
est activé par défaut. Vous le trouverez dans la section «&nbsp;Device Drivers
--&gt; USB support&nbsp;». Toutefois, ce pilote n'est habituellement pas
utilisé lorsque ub est activé.
</note>

</body>
</section>
<section>
<title>usbdevfs a un nouveau nom&nbsp;: usbfs</title>
<body>

<p>
Si vous avez édité le fichier <path>/etc/fstab</path> pour configurer la façon
dont le système de fichiers des périphériques USB est monté, vous devrez
peut-être modifier le type de système de fichier en remplaçant <e>usbdevfs</e>
par <e>usbfs</e>.
</p>

<note>
Les noyaux 2.4 récents supportent eux aussi «&nbsp;usbfs&nbsp;» et
«&nbsp;usbdevfs&nbsp;». Aussi, vous ne perdez aucune compatibilité en passant
au système plus récent.
</note>

</body>
</section>
<section>
<title>Ne modifiez pas la priorité de X</title>
<body>

<p>
Si vous utilisez Linux 2.4 sur une station de travail, vous aviez peut-être
«&nbsp;hacké&nbsp;» votre système pour exécuter X avec une priorité plus
élevée, ce qui semblait améliorer les performances sur ces ordinateurs.
</p>

<p>
Beaucoup de modifications ont été apportées à l'ordonnanceur dans le noyau 2.6,
ce qui change substantiellement son comportement. Si vous persistez à exécuter
X avec une priorité élevée, le système fera exactement ce qu'il est supposé
faire (soit exécuter le <e>serveur d'affichage</e> à une très haute priorié),
et vous en subirez les conséquences&nbsp;: le son sera saccadé et le lancement
des applications sera lent, puisque votre processeur passera beaucoup trop de
temps à s'occuper uniquement de X.
</p>

<p>
Avec Linux 2.6, vous n'avez plus besoin de changer la priorité des applications
de bureau pour obtenir une bonne interactivité. N'utilisez donc plus la
commande <c>renice</c> et ses astuces pour ce type d'applications.
</p>

</body>
</section>
<section>
<title>Le fichier de configuration de X11 devrait maintenant utiliser
/dev/input/mice</title>
<body>

<p>
Un des changements introduits par la configuration par défaut de udev (par
rapport à devfs) concerne l'organisation des fichiers de périphériques relatifs
aux souris (et autres dispositifs de pointage). Auparavant, ces fichiers
avaient pour noms, entre autres, <path>/dev/psaux</path> et
<path>/dev/mouse</path>. Désormais, vous aurez des fichiers tels que
<path>/dev/input/mouse0</path> et <path>/dev/input/mouse1</path>, ainsi que le
nœud matériel <path>/dev/input/mice</path> qui combine les mouvements de tous
les dispositifs de pointage.
</p>

<p>
Les vieilles configuration de X typiques référencent <path>/dev/mouse</path> ou
<path>/dev/psaux</path>, ce qui peut causer des erreurs telles que celle
ci-dessous lorsque vous essayez de démarrer X11&nbsp;:
</p>

<pre caption="Erreur fréquemment rencontrée lorsque X est exécuté pour la première fois sur un système udev">
(EE) xf86OpenSerial: Cannot open device /dev/mouse
	No such file or directory.
(EE) Mouse0: cannot open input device
(EE) PreInit failed for input device "Mouse0"
No core pointer
</pre>

<p>
Pour corriger ceci, ouvrez votre fichier de configuration X11 avec un éditeur
de texte et mettez à jour la section <e>InputDevice</e> relative à votre souris
pour qu'elle utilise <path>/dev/input/mice</path>. Voici un exemple&nbsp;:
</p>

<pre caption="Ouvrez votre fichier de configuration X11">
# <i>nano -w /etc/X11/xorg.conf</i>
</pre>

<note>
Si vous utilisez toujours XFree86, votre fichier de configuration sera
<path>/etc/X11/XF86Config</path>.
</note>

<pre caption="Exemple d'une section InputDevice pour la souris">
Section "InputDevice"
	Identifier  "Mouse0"
	Driver      "mouse"
	Option      "Protocol" "auto"
	Option      "Device" "/dev/input/mice"
EndSection
</pre>

</body>
</section>
</chapter>

<chapter id="conf">
<title>Configurer, compiler et installer le noyau</title>
<section>
<body>

<p>
Tout comme avec Linux 2.4, vous avez le choix entre deux façons de gérer la
mise en place de votre noyau.
</p>

<ol>
  <li>
    La méthode par défaut est la configuration manuelle du noyau. Cela peut
    sembler rebutant, mais c'est la méthode suggérée si vous connaissez bien
    votre matériel. Si vous souhaitez configurer votre noyau manuellement,
    poursuivez avec le <uri link="#manual">chapitre suivant</uri>.
  </li>
  <li>
    L'alternative est d'utiliser notre utilitaire <c>genkernel</c> pour
    configurer, compiler et installer le noyau à votre place et
    automatiquement. Si vous souhaitez utiliser <c>genkernel</c>, sautez le
    chapitre suivant et poursuivez votre lecture avec le chapitre <uri
    link="#genkernel">utilisation de genkernel</uri>.
  </li>
</ol>

</body>
</section>
</chapter>

<chapter id="manual">
<title>Par défaut&nbsp;: configuration manuelle</title>
<section>
<title>Configurer le noyau</title>
<body>

<p>
Nous allons maintenant poursuivre avec la configuration du noyau. Ouvrez
menuconfig comme d'habitude&nbsp;:
</p>

<pre caption="Lancer menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Vous êtes probablement familier avec l'utilisation de menuconfig pour la
configuration des noyaux de la série 2.4. Cet utilitaire n'a presque pas
changé, mais vous remarquerez que les options du noyau sont bien mieux
organisées qu'avant et qu'il existe de nombreuses nouvelles options.
</p>

<p>
Assurez-vous d'activer les options du noyau suivantes&nbsp;:
</p>

<pre caption="Options du noyau requises">
File systems ---&gt;
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [*] Virtual memory file system support (former shm fs)

<comment>(Les options suivantes sont requises pour udev):</comment>
General setup  ---&gt;
 [*] Support for hot-pluggable devices

Device Drivers  ---&gt;
 Block devices  ---&gt;
  &lt;*&gt; RAM disk support

<comment>(Les options suivantes sont requises pour ALSA):</comment>
Device Drivers  ---&gt;
 Sound  ---&gt;
  &lt;*&gt; Sound card support
  Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   &lt;M&gt; Sequencer support
   &lt;M&gt; OSS Mixer API
   [*] OSS Sequencer API
<comment>   (N'oubliez pas de choisir votre carte de son dans le sous-menu.)</comment>
</pre>

<warn>
Peut-être aviez-vous ajouté le support pour le système de fichiers
<path>/dev</path> (aujourd'hui considéré obsolète) dans vos précédentes
configurations de noyaux. N'utilisez plus le support de devfs&nbsp;; udev est
maintenant installé sur votre système et sera utilisé à la place de devfs.
</warn>

<p>
N'oubliez pas d'ajouter le support nécessaire pour votre matériel et pour les
types de systèmes de fichiers que vous utilisez. Assurez-vous d'activer le
support des contrôleurs IDE de votre carte-mère si vous souhaitez bénéficier
de l'accès rapide aux disques DMA. Référez-vous au chapitre <uri
link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurer le
noyau</uri> du <uri link="/doc/fr/handbook/index.xml">Manuel Gentoo</uri> pour
des instructions plus détaillées.
</p>

</body>
</section>
<section>
<title>Compilation du noyau</title>
<body>

<p>
Maintenant que votre noyau est configuré, nous pouvons débuter le processus de
compilation&nbsp;:
</p>

<pre caption="Compiler le noyau à partir de ses sources">
# <i>make &amp;&amp; make modules_install</i>
</pre>

<note>
Peut-être vous souvenez-vous que la commande <c>make dep</c> était employée
lors de la compilation des noyaux 2.4. Cette commande n'est maintenant plus
nécessaire.
</note>

<p>
Attendez que la compilation du noyau soit terminée. Vous remarquerez que les
messages de sortie sont beaucoup plus lisibles qu'avant.
</p>

</body>
</section>
<section>
<title>Installer le noyau</title>
<body>

<p>
L'étape suivante consiste à monter votre partition <path>/boot</path> et à
copier l'image du noyau à cet endroit. Vous devez ensuite mettre à jour votre
chargeur de démarrage manuellement.
</p>

<pre caption="Installer le noyau">
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Notez bien que les instructions ci-dessus ont valeur d'exemple. Vous devriez
suivre la procédure que vous employez habituellement lors de la mise à jour de
votre noyau, telle que décrite dans les instructions du chapitre <uri
link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurer le
noyau</uri> du <uri link="/doc/fr/handbook/index.xml">Manuel Gentoo</uri>.
</p>

<p>
Lorsque vous mettrez à jour la configuration de votre chargeur de démarrage,
ne supprimez pas les entrées relatives à votre ancien noyau 2.4. Ainsi, vous
serez toujours capable de passer d'un noyau à l'autre si un problème devait
survenir.
</p>

<p>
Poursuivez maintenant avec la section <uri link="#modules">Configuration des
modules</uri>.
</p>

</body>
</section>
</chapter>

<chapter id="genkernel">
<title>Alternative&nbsp;: utiliser genkernel</title>
<section>
<body>

<p>
Si vous préférez utiliser genkernel plutôt que configurer manuellement votre
noyau, vous serez heureux d'apprendre que le processus d'utilisation de
genkernel pour la gestion des noyaux 2.6 est très similaire à celui employé
pour les noyaux 2.4.
</p>

<p>
Vous devriez exécuter genkernel comme suit&nbsp;:
</p>

<pre caption="Exécuter genkernel avec quelques options communes">
# <i>genkernel --udev --menuconfig --bootloader=grub all</i>
</pre>

<p>
Dans l'exemple précédent, nous profitons de quelques-unes des fonctionnalités
de genkernel, soit l'utilisation de menuconfig qui vous permet de personnaliser
la configuration de votre noyau (si vous le désirez), et la mise à jour de la
configuration du chargeur de démarrage grub qui a lieu après la compilation.
</p>

<p>
Bien sûr, vous devriez utiliser les options qui conviennent à votre système
lorsque vous exécutez genkernel. Toutefois, n'oubliez surtout pas d'inclure
l'option <c>--udev</c>&nbsp;! Référez-vous au <uri
link="/doc/fr/genkernel.xml">Guide Genkernel pour Gentoo Linux</uri> et au
chapitre <uri
link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurer le
noyau</uri> du <uri link="/doc/fr/handbook/index.xml">Manuel Gentoo</uri> pour
plus de détails.
</p>

</body>
</section>
</chapter>

<chapter id="modules">
<title>Configuration des modules</title>

<section>
<title>Installer des modules externes</title>
<body>

<p>
Plusieurs utilisateurs ont besoin de modules du noyau qui sont maintenus à
l'extérieur de l'arbres des sources. Les exemples les plus évidents sont les
pilotes pour les accélérateurs graphiques ATI et Nvidia. Si vous souhaitez
utiliser de tels modules, vous devez maintenant les installer. Ces modules
seront compilés en utilisant l'arbre des sources de votre nouveau noyau 2.6 qui
se trouve dans <path>/usr/src/linux</path>. L'installation des modules est
identique à celle de tout autre paquet logiciel&nbsp;: utilisez la commande
<c>emerge nom_du_paquet</c> pour chaque module externe que vous aviez
l'habitude d'utiliser avec votre noyau 2.4.
</p>

<p>
Encore une fois, n'hésitez pas à consulter le chapitre <uri
link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurer le
noyau</uri> du <uri link="/doc/fr/handbook/index.xml">Manuel Gentoo</uri> pour
obtenir plus d'information.
</p>

</body>
</section>
<section>
<title>Chargement automatique des modules</title>
<body>

<p>
Vous avez peut-être décidé de compiler certains composants du noyau en tant que
modules (plutôt que de les inclure directement dans le noyau). Si c'est le cas
ou si vous avez installé des modules externes à partir des paquets disponibles
dans Portage (tel que décrit ci-dessus), vous voudrez sans doute charger
automatiquement ces modules lors du démarrage, comme vous le faisiez avec votre
noyau 2.4.
</p>

<p>
La procédure pour ce faire est similaire à celle que vous utilisiez avec les
noyaux 2.4. Ouvrez simplement le fichier
<path>/etc/modules.autoload.d/kernel-2.6</path> dans un éditeur de texte et
listez-y les noms des modules que vous souhaitez charger automatiquement.
</p>

<pre caption="Ouvrir la liste des modules à charger automatiquement avec nano">
# <i>nano -w /etc/modules.autoload.d/kernel-2.6</i>
</pre>

<pre caption="Exemple de liste de chargement automatique pour les modules nvidia et 3c59x">
# /etc/modules.autoload.d/kernel-2.6:  kernel modules to load when system boots.
#
# Note that this file is for 2.6 kernels.
#
# Add the names of modules that you'd like to load when the system
# starts into this file, one per line.  Comments begin with # and
# are ignored.  Read man modules.autoload for additional details.

3c59x
nvidia
</pre>

</body>
</section>
<section>
<title>Configuration des modules ALSA</title>
<body>

<p>
Vous avez sans doute remarqué qu'en suivant les instructions ci-dessus, vous
avez compilé ALSA comme un ensemble de modules. Cela permet de configurer le
comportement de ALSA plus aisément. Toutefois, cela nous oblige aussi à choisir
les modules qui doivent être chargés. Ouvrez <path>/etc/modules.d/alsa</path>
dans votre éditeur de texte&nbsp;:
</p>

<pre caption="Ouvrir /etc/modules.d/alsa avec nano">
# <i>nano -w /etc/modules.d/alsa</i>
</pre>

<p>
Recherchez la section étiquetée <e>IMPORTANT</e>. Dans la plupart des cas,
vous n'aurez qu'à décommenter et à modifier les alias pour snd-card-0 et
snd-slot-0.
</p>

<pre caption="Exemple d'un extrait de /etc/modules.d/alsa">
## IMPORTANT:
## You need to customise this section for your specific sound card(s)
## and then run `update-modules' command.
## Read alsa-driver's INSTALL file in /usr/share/doc for more info.
##
##  ALSA portion

# Mon portable utilise le pilote snd-maestro3.
alias snd-card-0 snd-maestro3

##  OSS/Free portion

# Habituellement, il suffit de décommenter la ligne suivante :
alias sound-slot-0 snd-card-0
</pre>

<p>
Pour en savoir plus sur le nom du pilote à utiliser, consultez le <uri
link="/doc/fr/alsa-guide.xml">Guide ALSA pour Gentoo Linux</uri>.  N'oubliez
pas d'ajouter le préfixe <e>snd-</e> à ce nom lorsque vous éditez le fichier de
configuration.
</p>

<p>
Finalement, assurez-vous que le script d'initialisation <c>alsasound</c> est
exécuté lors du démarrage&nbsp;:
</p>

<pre caption="Ajouter alsasound au niveau d'exécution «&nbsp;boot&nbsp;»">
# <i>rc-update add alsasound boot</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Démarrer Linux 2.6</title>
<section>
<body>

<p>
Il est maintenant temps de démarrer Linux 2.6. Fermez toutes les applications
et redémarrez&nbsp;:
</p>

<pre caption="Redémarrer">
# <i>modules-update</i>
# <i>umount /boot</i>
# <i>reboot</i>
</pre>

<p>
Si vous avez suivi correctement les instructions de ce guide, vous aurez le
choix entre lancer Linux 2.4 ou Linux 2.6 à partir de votre chargeur de
démarrage. Choisissez Linux 2.6.
</p>

<p>
Une fois le système amorcé, vérifiez que tout fonctionne. Si vous avez fait
une erreur dans la configuration du noyau, ne vous inquiétez pas&nbsp;: vous
pouvez revenir en arrière à l'étape <uri link="#conf">Configurer, compiler et
installer le noyau</uri>. Il suffit alors de changer la configuration, de
recompiler et d'installer l'image du noyau puis de redémarrer pour un nouvel
essai&nbsp;!
</p>

</body>
</section>
<section>
<title>Sortir les canaux ALSA du mode muet</title>
<body>

<p>
Par défaut, les canaux ALSA sont muets. Vous n'entendrez donc rien lorsque vous
jouerez un son pour la première fois. Vous devez sortir ces canaux du mode
muet. Exécutez le programme <c>alsamixer</c> à partir d'une console et utilisez
les flèches pour choisir un canal et ajuster son volume, et la touche M pour
activer et désactiver le mode muet. Consultez le <uri
link="/doc/fr/alsa-guide.xml">Guide ALSA pour Gentoo Linux</uri> pour plus de
détails, incluant des méthodes alternatives pour la gestion des canaux ALSA.
</p>

<note>
Le script d'initialisation alsasound que nous avons ajouté au niveau
d'exécution «&nbsp;boot&nbsp;» sauvegardera les niveaux du mixeur lors de
l'extinction de l'ordinateur et les restaurera lorsque vous démarrerez à
nouveau. Vous n'aurez pas à ajuster le volume chaque fois que vous
démarrerez&nbsp;!
</note>

</body>
</section>
</chapter>

<chapter>
<title>Fichiers d'en-têtes et NPTL</title>
<section>
<body>

<p>
À ce point-ci, vous disposez d'un système Linux 2.6 et vous avez réglé tous
les problèmes éventuels liés à la migration. Vous devriez maintenant mettre à
jour les fichiers d'en-têtes du noyau et réinstaller glibc afin que les
programmes utilisateurs puissent bénéficier des nouvelles fonctionnalités de
Linux 2.6.
</p>

<pre caption="Mettre à jour le système en passant à linux26-headers">
# <i>emerge unmerge linux-headers</i>
# <i>emerge linux26-headers</i>
</pre>

<p>
Après la mise à jour du paquet logiciel contenant les en-têtes, vous devez
habituellement réinstaller glibc. Il existe une nouvelle fonctionnalité que
vous souhaiterez peut-être utiliser&nbsp;: NPTL. NPTL est un nouveau modèle de
gestion des fils d'exécution de Linux 2.6 qui propose une création et une
destruction plus rapides des fils d'exécution. Cela ne fera pas de différence
appréciable sur la plupart des systèmes, mais vous souhaiterez peut-être tout
de même activer NPTL pendant ce processus de migration. Pour le faire, éditez
<path>/etc/make.conf</path> et ajoutez <e>nptl</e> à vos options de la variable
USE.
</p>

<warn>
À cause de la structure actuelle des ebuils de glibc, vous ne pourrez démarrer
de noyau 2.4 après avoir compilé glibc avec USE="nptl". Vous êtes
averti&nbsp;! Soyez prudent.
</warn>

<p>
Maintenant, réinstallez glibc. (Vous devriez réaliser cette étape même si vous
n'avez pas activé NPTL.)
</p>

<pre caption="Récompiler glibc en utilisant les nouveaux en-têtes du noyau">
# <i>emerge -a glibc</i>
</pre>

<p>
Si vous avez activé NPTL, les programmes binaires déjà présents sur votre
système n'utiliseront pas cette fonctionnalité avant qu'ils ne soient
recompilés. Tous les programmes compilés à partir de ce moment
<e>supporteront</e> NPTL. Vous souhaiterez peut-être recompiler tous vos
programmes maintenant&nbsp;:
</p>

<pre caption="Recompiler tous les paquets du système">
# <i>emerge -e world</i>
</pre>

<p>
Alternativement, vous pouvez simplement laisser votre système se convertir
«&nbsp;naturellement&nbsp;» au fur et à mesure que vous mettrez à jour vos
paquets lorsque de nouvelles versions seront disponibles.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Dernières remarques</title>
<section>
<title>Des problèmes&nbsp;?</title>
<body>

<p>
Considérant la somme de travail incroyable qui a été nécessaire au
développement de Linux 2.6, on peut s'attendre à de très nombreux changements
et, inévitablement, à quelques problèmes.
</p>

<p>
Si vous éprouvez une difficulté particulière avec votre noyau 2.6 et que vous
pouvez confirmer que le problème n'existe pas dans Linux 2.4, veuillez remplir
un rapport de bogue sur <uri link="http://bugs.gentoo.org">Bugzilla</uri>.
Nous étudierons la situation et, si nous découvrons qu'il s'agit d'un problème
dans le noyau officiel, nous vous demanderons peut-être de remplir un rapport
sur le Bugzilla centralisé pour le noyau Linux.
</p>

</body>
</section>
<section>
<title>Conclusion</title>
<body>

<p>
Avec un peu de chance, vous venez de terminer votre migration, n'avez rencontré
aucun problème et profitez maintenant des améliorations apportées à Linux 2.6
par rapport à Linux 2.4. Tel que mentionné au début de ce guide, nous aimerions
recevoir vos commentaires, et ce même si votre migration s'est déroulée sans
anicroche. Envoyez-nous vos commentaires par <mail
link="dsd@gentoo.org">courriel</mail> afin que ce guide soit fin prêt pour la
sortie de Gentoo 2005.0.
</p>

</body>
</section>
</chapter>
</guide>
