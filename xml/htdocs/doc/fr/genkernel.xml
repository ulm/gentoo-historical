<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/genkernel.xml,v 1.1 2004/08/06 22:13:55 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/xml-guide.xml" lang="fr">
<title>Guide Genkernel pour Gentoo Linux</title>

<author title="Auteur">
  <mail link="plasmaroo@gentoo.org">Tim Yamin</mail>
</author>
<author title="Traducteur">
  <mail link="vincent.rubiolo@free.fr">Vincent Rubiolo</mail>
</author>


<abstract>
Ce guide a pour but de constituer une documentation de référence
concernant toutes les fonctions de genkernel.
</abstract>

<license/>

<version>1.0.0.2</version>
<date>7 août 2004</date>

<chapter>
<title>Introduction</title>
<section>
<title>Introduction</title>
<body>

<p>
Genkernel est conçu de manière à permettre aux utilisateurs non familiarisés
avec la compilation d'un noyau d'utiliser des réglages semblables à ceux des
LiveCD Gentoo qui détectent automatiquement les périphériques.
</p>

<p>
Certains utilisateurs peuvent également être intéressés par l'utilisation de
genkernel pour les périphériques qui requièrent une phase d'initialisation 
ainsi qu'un noyau fonctionnel avant de pouvoir être démarrés. Genkernel compile 
en effet automatiquement vos modules noyau, permettant ainsi à ce type de 
matériel d'être utilisé.
</p>

</body>
</section>
<section>
<title>Genkernel m'est-t-il destiné&nbsp;?</title>
<body>

<p>
Genkernel est souvent un bon choix pour ceux qui ne sont pas familiarisés
avec la compilation de noyau ou ne connaissent que de façon incomplète
leur configuration matérielle.
</p>

<p>
Puisque genkernel est conçu de façon à utiliser une configuration
matérielle générique, il devrait être à même de supporter la totalité de vos
périphériques. Cependant, comme tous les modules et pilotes doivent être 
inclus par genkernel, compiler un noyau vous-même prend souvent moins de 
temps puisque vous savez ce que vous voulez.
</p>

<p>
Genkernel ne supporte cependant pas actuellement le démarrage depuis des
partitions LVM2/EVMS2. Il est recommandé aux utilisateurs d'utiliser un noyau
compilé manuellement pour le moment.
</p>

</body>
</section>
<section>
<title>Récupérer genkernel</title>
<body>

<p>
Vous pouvez récupérer genkernel avec la commande <c>emerge genkernel</c>.
N'oubliez pas d'utiliser l'option <c>-k</c> si vous utilisez des paquets
binaires. Comme les paquets GRP ont une version plus ancienne de genkernel, les
options diffèreront. Il vous est donc recommandé de consulter <uri
link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=10">
le Manuel Gentoo</uri> et la sortie de <path>genkernel --help</path>.
</p>

</body>
</section>
<section>
<title>Architectures supportées</title>
<body>

<p>
Avec genkernel 3.0.2, les architectures suivantes devraient être
supportées&nbsp;: alpha, amd64, parisc, parisc64, ppc, ppc64, sparc, sparc64 et
x86. Si vous pensez qu'il y a un bogue dans le code spécifique à une
plate-forme (et non dans genkernel lui-même), remplissez un rapport de bogue
sur le <uri link="http://bugs.gentoo.org">Bugzilla Gentoo</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Utilisation de genkernel</title>
<section>
<title>Introduction</title>
<body>

<p>
Genkernel est conçu pour fonctionner dans trois modes&nbsp;:
</p>

<ul>
  <li>mode "all"&nbsp;: ceci compile le noyau et l'initrd.</li>
  <li>mode "kernel"&nbsp;: ceci compile seulement le noyau.</li>
  <li>mode "initrd"&nbsp;: ceci compile uniquement l'initrd.</li>
</ul>

<p>
La plupart des utilisateurs auront uniquement besoin du mode "all" qui
compile le noyau et l'initrd pour eux. <b>Notez</b> que les modes "kernel"
et "initrd" sont pour le moment uniquement des alias vers le mode "all"&nbsp;; ils
ne produisent par conséquent rien de spécial.
</p>

<p>
Bien que genkernel ne soit principalement qu'une commande pour vous faciliter 
la vie lorsque vous compilez un noyau, genkernel est également fourni avec 
différentes options qui vous permettent de spécifier la manière dont votre 
noyau est compilé ou configuré.
</p>

</body>
</section>
<section>
<title>Options genkernel relatives au compilateur</title>
<body>

<p>
Genkernel supporte les options suivantes qui sont passées aux applications
correspondantes lorsque votre noyau est compilé&nbsp;:
</p>

<ul>
  <li>
    <b>--kernel-as=<c>unCertainAssembleur</c></b>&nbsp;: Ceci spécifie un 
    assembleur qui sera utilisé pour construire votre noyau.
  </li>
  <li>
    <b>--kernel-cc=<c>unCertainCompilateur</c></b>&nbsp;: Ceci spécifie un
    compilateur qui sera utilisé pour construire votre noyau.
  </li>
  <li>
    <b>--kernel-ld=<c>unCertainEditeurDeLiens</c></b>&nbsp;: Ceci spécifie
    un éditeur de liens utilisé dans la construction de votre noyau.
  </li>
  <li>
    <b>--kernel-make=<c>unCertainMake</c></b>&nbsp;: Ceci spécifie un 
    utilitaire GNU Make alternatif qui sera utilisé pour la construction de 
    votre noyau.
  </li>
</ul>

<ul>
  <li>
    <b>--utils-as=<c>unCertainAssembleur</c></b>&nbsp;: Ceci spécifie un 
    assembleur qui sera utilisé pour construire les outils annexes.
  </li>
  <li>
    <b>--utils-cc=<c>unCertainCompilateur</c></b>&nbsp;: Ceci spécifie un
    compilateur qui sera utilisé pour construire les outils annexes.
  </li>
  <li>
    <b>--utils-ld=<c>unCertainEditeurDeLiens</c></b>&nbsp;: Ceci spécifie
    un éditeur de liens utilisé dans la construction des outils annexes.
  </li>
  <li>
    <b>--utils-make=<c>unCertainMake</c></b>&nbsp;: Ceci spécifie un 
    utilitaire GNU Make alternatif qui sera utilisé pour la construction des 
    outils annexes.
  </li>
</ul>

<ul>
  <li>
    <b>--makeopts=<c>-jNbDeTâches</c></b>&nbsp;: Ceci spécifie quelles options
    seront passées à GNU Make lorsque le noyau et les outils seront construits.
  </li>
</ul>

</body>
</section>
<section>
<title>Options genkernel relatives au noyau</title>
<body>

<p>
Genkernel supporte les options suivantes dont certaines ont l'équivalent 
<c>--<b>no-</b>option</c>, qui influencent la compilation du noyau&nbsp;:
</p>

<ul>
  <li>
    <b>--callback="echo Hello"</b>&nbsp;: Cette routine effectue un appel à
    l'argument spécifié après que le noyau et les modules correspondants aient
    été construits. C'est utile lorsque vous souhaitez installez des modules
    externes dans l'initrd en passant la commande emerge en argument et 
    redéfinissez de ce fait un nouveau groupe de modules genkernel.
  </li>
  <li>
    <b>--<c>no-</c>clean</b>&nbsp;: Ceci lance <e>ou ne lance pas</e>
    <c>make clean</c> avant de compiler le noyau, ce qui efface toutes les
    dépendances et fichiers objets présents.
  </li>
  <li>
    <b>--<c>no-</c>mrproper</b>&nbsp;: Ceci lance <e>ou ne lance pas</e>
    <c>make mrproper</c> avant de compiler le noyau, ce qui efface toutes les
    dépendances, fichiers objets <b>et la configuration du noyau</b>.
  </li>
</ul>

<ul>
  <li>
    <b>--kerneldir=<path>/chemin/vers/les/sources</path></b>&nbsp;: Ceci 
    spécifie un autre chemin vers les sources du noyau au lieu de l'emplacement 
    par défaut <path>/usr/src/linux</path>.
  </li>
  <li>
    <b>--kernel-config=<path>/chemin/vers/fichiers/de/configuration</path>
    </b>&nbsp;: Ceci spécifie un autre fichier de configuration à utiliser au
    lieu du fichier<path>/chemin/vers/les/sources/.config</path> utilisé par 
    défaut.
  </li>
</ul>

<ul>
  <li>
    <b>--<c>no-</c>bootsplash</b>&nbsp;: Cei ajoute <e>ou n'ajoute pas</e> le
    support de l'écran de démarrage (bootsplash) à l'initrd que construit
    genkernel. Toutes les architectures n'offrent pas à l'heure actuelle le
    support de l'écran de démarrage&nbsp;; un noyau qui le supporte est
    également requis.
  </li>
  <li>
    <b>--<c>no-</c>menuconfig</b>&nbsp;: Ceci lance <e>ou ne lance pas</e>
    l'outil de configuration en mode texte avant de compiler votre noyau après
    que <c>make oldconfig</c> ait été lancé.
  </li>
</ul>

<ul>
  <li>
    <b>--no-initrdmodules</b>&nbsp;: Ceci ne copie aucun module dans l'initrd que 
	genkernel crée.
  </li>
  <li>
    <b>--<c>no-</c>install</b>&nbsp;: Ceci installe <e>ou n'installe pas</e> votre 
    noyau, modules et initrd une fois la compilation terminée.
  </li>
</ul>

</body>
</section>
<section>
<title>Autres options de Genkernel</title>
<body>

<p>
Genkernel supporte également certaines options qui ne font pas partie des deux
autres sections&nbsp;:
</p>

<ul>
  <li>
    <b>--arch-override=<c>uneCertaineArchitecture</c></b>&nbsp;: Cette option 
    peut être utilisée pour outrepasser le type d'achitecture sur laquelle 
    genkernel croit être executé, ceci si le mécanisme de détection automatique 
    échoue (remplissez un rapport de bogue si c'est le cas, svp&nbsp;!) ou si 
    vous souhaitez effectuer une compilation croisée (cross-compilation).
  </li>
</ul>

<ul>
  <li>
    <b>--busybox-config=<path>/chemin/vers/fichier/de/configuration/de/busybox</path></b>&nbsp;:
    Ceci remplace la configuration par défaut de busybox par le fichier
    spécifié.
  </li>
  <li>
    <b>--busybox-bin=<path>/chemin/vers/binaire-busybox.tar.bz2</path></b>&nbsp;: 
    Utiliser cette option signifie qu'une version binaire de busybox ne sera pas 
    compilée et que l'archive tar spécifiée sera utilisée à la place. Notez que 
    busybox <e>doit absolument</e> être compilée de manière statique&nbsp;!
  </li>
</ul>

<ul>
  <li>
    <b>--minkernpackage=<path>/chemin/vers/votreNoyau.tar.bz2</path></b>&nbsp;: 
    Cette option crée une archive tar de notre noyau nommée <path>kernel</path> 
    et un initrd nommé <path>initrd</path> dans le fichier spécifié. Aucun 
    module ou information de chemin d'accès ne sera inclus dans l'archive.
  </li>
</ul>

</body>
</section>
<section>
<title>Exécuter genkernel</title>
<body>

<p>
La seule chose dont vous ayez besoin pour exécuter genkernel est le script 
genkernel lui-même (accompagné de ses options) et les droits du super-utilisateur.
Ainsi&nbsp;:
</p>

<pre caption="Exécuter genkernel">
# genkernel --menuconfig --no-clean --no-install --bootsplash all
<comment>(Produirait un noyau, en vous demandant de le configurer selon vos 
désirs, n'effaçant pas les fichiers objets générés et activant le support de 
l'écran de démarrage (bootsplash) mais sans installer quoi que ce soit.)
</comment>
</pre>

<p>
Si vous souhaitez que genkernel installe également votre noyau, vous devez vous
assurer que votre partition de démarrage (<path>/boot</path>) est montée - les
versions récentes de genkernel tenteront de le faire pour vous si l'option
MOUNTBOOT est définie à «&nbsp;yes&nbsp;» dans
<path>/etc/genkernel.conf</path>.
</p>

<pre caption="Monter manuellement la partition /boot">
<comment>(Si vous possédez déjà une entrée /boot dans /etc/fstab</comment>
# mount /boot
<comment>(... sinon pour un disque IDE)</comment>
# mount /dev/hda1 /boot
<comment>(... ou pour un disque SCSI)</comment>
# mount /dev/sda1 /boot
</pre>

</body>
</section>
<section>
<title>Régler genkernel pour qu'il fonctionne avec votre chargeur de démarrage</title>
<body>

<p>
Pour régler genkernel pour qu'il fonctionne avec votre chargeur de démarrage 
(bootloader), 3 ou 4 changements sont à apporter à la configuration de ce dernier.
</p>

<ol>
  <li>
    Ajoutez <c>root=/dev/ram0</c> et <c>init=/linuxrc</c> aux paramètres passés à
    l'image noyau.
  </li>
  <li>
    Ajoutez <c>real_root=/dev/hda3</c>, par exemple, aux paramètres passés à l'image
    noyau si <path>/dev/hda3</path> contient votre partition racine.
  </li>
  <li>
    Si vous utilisez bootsplash (écran de démarrage), ajoutez une modeline valable 
    comme <c>vga=0x317</c> aux paramètres passés au noyau ainsi que <c>splash=verbose</c>
    ou <c>splash=silent</c> en fonction de la volubilité que vous souhaitez sur
    votre écran de démarrage.
  </li>
  <li>
    Ajoutez l'initrd selon la manière requise par votre chargeur de
    démarrage&nbsp;: référez-vous au <uri
    link="/doc/fr/handbook/handbook-x86.xml?part=1&amp;chap=10">guide
    Gentoo</uri> pour la manière de faire.
  </li>
</ol>

</body>
</section>
</chapter>

<chapter>
<title>Adapter genkernel à une autre architecture</title>
<section>
<title>Introduction</title>
<body>

<p>
Du moment que votre architecture comporte les bibliothèques et outils requis par
genkernel, ce qui inclut (mais ne se limite pas à) un noyau fonctionnel pour votre
architecture, une chaîne de compilation fonctionnelle, GNU Make et une distribution
de busybox qui fonctionne, vous êtes prêt à décoller&nbsp;!
</p>

<p>
Pour chaque architecture, genkernel utilise
<path>/usr/share/genkernel/NomDeLarchitecture</path> pour stocker les fichiers
de configuration relatifs à cette architecture.
</p>

</body>
</section>
<section>
<title>Comment le démarrage du système (bootstraping) fonctionne-t-il&nbsp;?</title>
<body>

<ol>
  <li>
    Le chargeur de démarrage (bootloader) charge l'image du noyau construite 
    d'après les fichiers de configuration dans les répertoires genkernel ainsi 
    que l'initrd préparé par genkernel.
  </li>
  <li>
    Le noyau démarre, alloue une petite quantité de mémoire RAM dans laquelle 
    busybox est initialisée et tente de charger les modules listés dans 
    modules_load qui correspondent à l'architecture.
  </li>
  <li>
    Une fois cela fait et pourvu que l'option <c>real_root</c> qui a trait au 
    périphérique de démarrage racine (tel que busybox le voit) soit trouvée, le 
    système démarre.
  </li>
</ol>

</body>
</section>
<section>
<title>Les fichiers de configuration</title>
<body>

<ul>
  <li>
    <path>busy-config</path>&nbsp;: ceci est la configuration utilisée pour 
    construire busybox pour votre architecture.
  </li>
  <li>
    <path>config.sh</path>&nbsp;: un script shell qui règle différentes options
    pour genkernel. Référez-vous à <path>config.sh</path> pour plus 
    d'informations.
  </li>
  <li>
    <path>modules_load</path>&nbsp;: un fichier contenant une liste de modules
    (séparés par des espaces) chargés pour le support du SCSI, du FireWire, de
    l'ATARAID et du PCMCIA. Si aucun n'est disponible pour votre système,
    laissez les champs vides. Voyez un des fichiers <path>modules_load</path>
    pour un exemple.
  </li>
</ul>

<ul>
  <li>
    <path>kernel-config</path>&nbsp;: un fichier de configuration par défaut 
    utilisé pour n'importe quelle version du noyau.
  </li>
  <li>
    <path>kernel-config-2.4</path>&nbsp;: un fichier de configuration par défaut 
    utilisé pour la série de versions 2.4 du noyau.
  </li>
  <li>
    <path>kernel-config-2.6</path>&nbsp;: un fichier de configuration par défaut 
    utilisé pour la série de versions 2.6 du noyau.
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
