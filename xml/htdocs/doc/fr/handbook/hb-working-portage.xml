<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/handbook/hb-working-portage.xml,v 1.13 2004/09/20 14:18:44 neysx Exp $ -->

<sections>
<section>
<title>Obtenir des informations sur les paquets</title>
<subsection>
<title>L'outil le plus important&nbsp;: emerge</title>
<body>

<p>
L'outil principal de Portage est <c>emerge</c>. Nous l'avons déjà utilisé
pendant l'installation et abordé dans le chapitre précédent, mais ce chapitre
décrit l'outil <c>emerge</c> de façon plus approfondie et explique comment
l'utiliser pour gérer les paquets de votre système.
</p>

<p>
La commande <c>emerge</c> est utilisée pour installer, supprimer, interroger et
maintenir vos paquets. En fait, c'est une interface vers l'outil <c>ebuild</c>.
Ce dernier sera abordé plus tard et est plutôt destiné à ceux qui veulent
devenir des pros de Gentoo. Voyons d'abord <c>emerge</c> et les fonctionnalités
qu'il ajoute à <c>ebuild</c> comme la résolution des dépendances, des
recherches dans l'arbre de Portage, etc.
</p>

<p>
Puisque <c>emerge</c> est l'outil le plus important de Gentoo, il a une page
man complète que vous pouvez lire en tapant <c>man emerge</c>. Vous pouvez
aussi obtenir de l'aide en tapant <c>emerge --help</c>.
</p>

<pre caption="Obtenir de l'aide sur emerge">
# <i>man emerge</i>
# <i>emerge --help</i>
</pre>

</body>
</subsection>
<subsection>
<title>L'arbre Portage</title>
<body>

<p>
Avant de poursuivre la description de l'outil <c>emerge</c>, jetons un œil à
l'arbre Portage. Allez dans le répertoire <path>/usr/portage</path> et
affichez-en le contenu. Nous utilisons <c>ls --classify</c> pour faire afficher
un "/" après les noms des répertoires.
</p>

<pre caption="Le contenu de l'arbre Portage">
# <i>cd /usr/portage; ls --classify</i>
app-admin/       dev-ml/            gnome-libs/     net-print/
app-arch/        dev-perl/          gnome-office/   net-wireless/
app-benchmarks/  dev-php/           header.txt      net-www/
app-cdr/         dev-python/        incoming/       net-zope/
app-crypt/       dev-ruby/          jython/         packages/
app-dicts/       dev-tcltk/         kde-apps/       profiles/
app-doc/         dev-tex/           kde-base/       releases/
app-editors/     dev-util/          kde-i18n/       scripts/
app-emacs/       distfiles/         kde-libs/       sec-policy/
app-emulation/   eclass/            licenses/       skel.ChangeLog
app-games/       experimental/      media-fonts/    skel.ebuild
app-gnustep/     files/             media-gfx/      skel.metadata.xml
app-i18n/        fresco-base/       media-libs/     snapshots/
app-misc/        games-action/      media-plugins/  sys-apps/
app-office/      games-arcade/      media-radio/    sys-build/
app-pda/         games-board/       media-sound/    sys-cluster/
app-portage/     games-emulation/   media-tv/       sys-devel/
app-sci/         games-engines/     media-video/    sys-fs/
app-shells/      games-fps/         metadata/       sys-kernel/
app-text/        games-kids/        net-analyzer/   sys-kmods/
app-vim/         games-misc/        net-apache/     sys-libs/
app-xemacs/      games-mud/         net-dialup/     unix2tcp/
berlin-base/     games-puzzle/      net-dns/        x11-base/
dev-ada/         games-roguelike/   net-firewall/   x11-libs/
dev-cpp/         games-rpg/         net-fs/         x11-misc/
dev-db/          games-server/      net-ftp/        x11-plugins/
dev-dotnet/      games-simulation/  net-im/         x11-terms/
dev-embedded/    games-sports/      net-irc/        x11-themes/
dev-games/       games-strategy/    net-libs/       x11-wm/
dev-haskell/     games-util/        net-mail/       xfce-base/
dev-java/        glep/              net-misc/       xfce-extra/
dev-lang/        gnome-apps/        net-nds/
dev-libs/        gnome-base/        net-news/
dev-lisp/        gnome-extra/       net-p2p/
</pre>

<p>
Comme vous pouvez le constater, l'arbre Portage contient un certain nombre de
sous-répertoires. La plupart d'entre eux sont les <e>catégories</e> dans
lesquelles se trouvent les paquets. Regardez par exemple le contenu de
<path>app-office</path>&nbsp;:
</p>

<pre caption="Le contenu d'une catégorie">
# <i>cd app-office; ls --classify</i>
abiword/     gnotime/   kmymoney2/  ooodi/              plan/     timestamp.x
dia/         gnucash/   koffice/    oooqs/              qhacc/
dia2code/    gnumeric/  lxbank/     openoffice/         sc/
facturalux/  ical/      lyx/        openoffice-bin/     scribus/
gaby/        kbudget/   mdbtools/   openoffice-ximian/  siag/
gnofin/      khacc/     mrproject/  phprojekt/          texmacs/
</pre>

<p>
Dans chaque catégorie, chaque paquet est dans un sous-répertoire distinct.
Regardez par exemple le contenu du paquet <c>openoffice</c>&nbsp;:
</p>

<pre caption="Le contenu d'un paquet">
# <i>cd openoffice; ls --classify</i>
ChangeLog  files/        openoffice-1.0.3-r1.ebuild  openoffice-1.1.0-r2.ebuild
Manifest   metadata.xml  openoffice-1.1.0-r1.ebuild  openoffice-1.1.0.ebuild
</pre>

<p>
Dans l'exemple ci-dessus, le sous-répertoire contient quatre <e>ebuilds</e>.
Un <e>ebuild</e> est un script qui contient toutes les informations nécessaire
à l'installation d'un paquet. Les noms des <e>ebuilds</e> dans l'exemple
ci-dessus ne diffèrent que par le numéro de version. Vous pouvez afficher le
contenu d'un ebuild, c'est un fichier texte normal. Nous n'entrerons pas dans
les détails du contenu d'un tel fichier, car cela n'est pas nécessaire pour
utiliser Gentoo.
</p>

<p>
Les autres fichiers sont <path>ChangeLog</path> qui contient la liste des
modifications apportées aux ebuilds, <path>Manifest</path> qui contient les
sommes de validation et les tailles des fichiers ainsi que
<path>metadata.xml</path> qui contient des informations relatives aux ebuilds
comme le groupe responsable (appelé <e>herd</e>) des ebuilds, etc.
</p>

<p>
Le sous-répertoire <path>files</path> contient quelques fichiers
supplémentaires de Portage tels que les noms, tailles et sommes de validation
de chaque paquet, des patchs, des exemples de configuration, etc.
</p>

<pre caption="Lister les fichiers supplémentaires">
# <i>cd files; ls --classify</i>
1.0.3/  digest-openoffice-1.0.3-r1  digest-openoffice-1.1.0-r1
1.1.0/  digest-openoffice-1.1.0     digest-openoffice-1.1.0-r2
# <i>cd 1.1.0; ls --classify</i>
fixed-gcc.patch      ooffice-wrapper-1.3
newstlportfix.patch  openoffice-1.1.0-linux-2.6-fix.patch
no-mozab.patch       openoffice-1.1.0-sparc64-fix.patch
nptl.patch
</pre>

<p>
La racine de l'arbre Portage (<path>/usr/portage</path>) contient d'autres
sous-répertoires que ceux des catégories de logiciels. Nous les aborderons plus
loin dans ce chapitre.
</p>

</body>
</subsection>
<subsection>
<title>À la recherche d'un logiciel</title>
<body>

<p>
Si vous êtes nouveau dans le monde de Linux ou de Gentoo, vous ignorez sans
doute de quel outil vous avez besoin pour une tâche particulière. L'outil
<c>emerge</c> vous permet d'effectuer des recherches parmi l'ensemble des
paquets disponibles, soit sur le <e>nom</e> des paquets, soit sur leur
<e>nom</e> et leur <e>description</e>.
</p>

<p>
Pour lancer une recherche sur les noms des paquets, faites <c>emerge
search</c>. Par exemple, pour chercher des paquets relatifs à
<c>mozilla</c>&nbsp;:
</p>

<pre caption="Afficher les paquets relatifs à mozilla">
# <i>emerge search mozilla</i>
Searching...   
[ Results for search key : mozilla ]
[ Applications found : 5 ]
<comment>(Affichage partiel)</comment>
*  net-www/mozilla
      Latest version available: 1.5-r1
      Latest version installed: 1.4-r3
      Size of downloaded files: 29,153 kB
      Homepage:    http://www.mozilla.org
      Description: The Mozilla Web Browser

*  net-www/mozilla-firebird
      Latest version available: 0.7
      Latest version installed: [ Not Installed ]
      Size of downloaded files: 37,850 kB
      Homepage:    http://www.mozilla.org/projects/firebird/
      Description: The Mozilla Firebird Web Browser
<comment>(...)</comment>
</pre>

<p>
Si vous voulez aussi chercher parmi les descriptions des paquets, ajoutez
l'option <c>--searchdesc</c>&nbsp;:
</p>

<pre caption="Chercher aussi parmi les descriptions">
# <i>emerge --searchdesc mozilla</i>
Searching...   
[ Results for search key : mozilla ]
[ Applications found : 10 ]
<comment>(affichage partiel)</comment>
*  dev-libs/nss-3.8
      Latest version available: 3.8
      Latest version installed: 3.8
      Size of downloaded files:  2,782 kB
      Homepage:    http://www.mozilla.org/projects/security/pki/nss/
      Description: Mozilla's Netscape Security Services Library that implements PKI support
</pre>

<p>
Comme vous le voyez, <c>emerge</c> affiche la catégorie et le nom de chaque
application avec le numéro de la version la plus récente et celui de la version
installée ainsi que la taille des <e>fichiers</e> à télécharger ou déjà téléchargés,
l'adresse de la page d'accueil du projet et une courte description.
</p>

<p>
Les <e>fichiers</e> à télécharger&nbsp;? Quand vous utilisez Portage pour
installer un paquet, il doit d'abord télécharger les sources ou les binaires
précompilés.  Portage cherche les sources dans le sous-répertoire
<path>/usr/portage/distfiles</path>.  Si les sources nécessaires ne s'y
trouvent pas, Portage les télécharge et les sauvegarde dans ce répertoire.
</p>

</body>
</subsection>
<subsection>
<title>Lister les modifications</title>
<body>

<p>
Nous avons vu ci-dessus qu'il existe une liste des modifications pour chaque
paquet. Vous pouvez aussi afficher cette liste avec <c>emerge</c>. Utilisez les
options <c>--pretend --changelog</c> (ou le raccourci <c>-pl</c>). Par exemple,
pour afficher la liste des modifications apportées à l'ebuild de
<c>gnumeric</c> depuis qu'il a été installé, faites&nbsp;:
</p>

<pre caption="Afficher les modifications apportées à l'ebuild de gnumeric">
# <i>emerge --pretend --changelog gnumeric</i>
<comment>(Affichage partiel)</comment>
  	 *gnumeric-1.2.2
  	 
  	   27 Nov 2003; foser &lt;foser@gentoo.org&gt; gnumeric-1.2.2.ebuild :
  	   New release, requested in #34492
  	   updated deps
  	 
  	   12 Nov 2003; Jason Wever &lt;weeve@gentoo.org&gt; gnumeric-1.2.0.ebuild:
  	   Marked stable on sparc, fixes bug #32405.
  	 
  	   14 Oct 2003; Jason Wever &lt;weeve@gentoo.org&gt; gnumeric-1.0.8.ebuild:
  	   Added ~sparc keyword.  Fixes bug #31150.
</pre>

</body>
</subsection>
</section>
<section>
<title>Mettre Portage à jour</title>
<subsection>
<title>Introduction</title>
<body>

<p>
Faire des recherches dans l'arbre de Portage est intéressant, mais si vous ne
le mettez pas à jour régulièrement, vous ne pourrez ni trouver ni installer les
paquets récents, votre système sera dépassé et vous n'aurez pas accès aux
correctifs des problèmes de sécurité.
</p>

<p>
Il y a plusieurs façons de mettre l'arbre de Portage à jour. La plus utilisée
est d'utiliser un de nos <uri link="/main/en/mirrors.xml">miroirs rsync</uri>.
Une autre manière est d'utiliser un instantané de Portage quand, par exemple,
un pare-feu bloque le trafic rsync ou qu'il n'y a pas de connexion réseau.
</p>

</body>
</subsection>
<subsection>
<title>Choisir un miroir pour rsync</title>
<body>

<p>
Il est conseillé de choisir un <uri link="/main/en/mirrors.xml">miroir</uri>
rapide géographiquement proche. Vous pouvez soit définir le miroir manuellement
en modifiant la variable <c>SYNC</c> dans le fichier
<path>/etc/make.conf</path>, soit utiliser l'outil <c>mirrorselect</c> pour une
détection automatique. La variable <c>SYNC</c> sera abordée plus loin,
commençons par <c>mirrorselect</c>. D'abord, installez-le avec <c>emerge</c>.
</p>

<pre caption="Installer mirrorselect">
# <i>emerge --usepkg mirrorselect</i>
</pre>

<p>
Ensuite, lancez <c>mirrorselect</c> pour sélectionner un miroir automatiquement
(un miroir sera aussi choisi pour télécharger les sources).
</p>

<pre caption="Exécuter mirrorselect">
# <i>mirrorselect -a -s3</i>
</pre>

</body>
</subsection>
<subsection>
<title>Mettre Portage à jour</title>
<body>

<p>
Pour mettre Portage à jour via rsync, lancez simplement la commande <c>emerge
sync</c>.
</p>

<pre caption="Mettre Portage à jour avec emerge sync">
# <i>emerge sync</i>
</pre>

<p>
Si cela échoue (à cause de problèmes réseau ou d'un pare-feu), vous pouvez
essayer <c>emerge-webrsync</c> qui téléchargera un instantané de l'arbre de
Portage avec <c>wget</c>. Cela signifie que vous pouvez aussi utiliser un proxy
si nécessaire. L'utilisation d'un serveur proxy a été abordé lors de
l'installation.
</p>

<pre caption="Mise à jour de Portage avec emerge-webrsync">
# <i>emerge-webrsync</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Garder les logiciels à jour</title>
<subsection>
<title>À compiler ou précompilés&nbsp;?</title>
<body>

<p>
Gentoo fournit des paquets sous forme d'ebuilds. Pour installer un paquet, vous
avez le choix entre <e>compiler</e> les sources ou installer des binaires
<e>précompilés</e>. Chaque approche a ses avantages et ses inconvénients et
elles ne sont pas mutuellement exclusives.
</p>

<p>
Vous l'avez probablement deviné, compiler les paquets prend un certain temps,
surtout sur des systèmes qui ont peu de ressources, ou bien quand vous
installez des logiciels imposants comme <uri
link="http://www.kde.org">KDE</uri> ou <uri
link="http://www.openoffice.org">OpenOffice.org</uri>. Par contre, en compilant
les paquets, vous pouvez spécifier vos propres options de compilation (les
variables <c>CFLAGS</c> et <c>CXXFLAGS</c>) et quels modules optionnels doivent
être compilés ou pas (la variable <c>USE</c>).
</p>

<p>
D'autre part, utiliser des paquets précompilés permet une installation rapide
puisqu'il ne faut plus les compiler, mais vous perdez alors les avantages et la
flexibilité apportés par les variables <c>USE</c>, <c>CFLAGS</c> et
<c>CXXFLAGS</c>.
</p>

<p>
Rappelez-vous que les paquets précompilés sont téléchargés dans le répertoire
<path>/usr/portage/packages/All</path> et les sources dans
<path>/usr/portage/distfiles</path>. Après l'installation, vous pouvez
supprimer les fichiers téléchargés. Cependant, vous voudrez peut-être les
conserver au cas où vous devriez les réinstaller, vous ne devrez alors pas les
télécharger à nouveau.
</p>

</body>
</subsection>
<subsection>
<title>Installer des paquets à partir des sources</title>
<body>

<p>
Il est temps d'entrer dans le vif du sujet. Pour installer un paquet, vous
utilisez la commande <c>emerge</c>. Si vous ne voulez pas utiliser de paquets
précompilés, utilisez simplement la commande <c>emerge
&lt;nom-du-paquet&gt;</c> ou <c>emerge
&lt;catégorie&gt;/&lt;nom-du-paquet&gt;</c>. Par exemple, pour installer
<c>gnumeric</c>, faites&nbsp;:
</p>

<pre caption="Compiler et installer gnumeric">
# <i>emerge gnumeric</i>
</pre>

<p>
Cette commande téléchargera les sources, les compilera et installera le paquet
sur votre système. Si le paquet dépend d'autres paquets qui ne sont pas encore
installés, ces derniers seront d'abord installés. Si vous voulez afficher tous
les paquets qui seront installés, utilisez l'option <c>--pretend</c> (ou le
raccourci <c>-p</c>)&nbsp;:
</p>

<pre caption="Lister les paquets à installer pour gnumeric">
# <i>emerge --pretend gnumeric</i>
</pre>

<p>
Vous pouvez aussi télécharger les sources nécessaires, mais sans les compiler
avec l'option <c>--fetchonly</c> (ou le raccourci <c>-f</c>)&nbsp;:
</p>

<pre caption="Télécharger les sources de gnumeric">
# <i>emerge --fetchonly gnumeric</i>
</pre>

<p>
Si vous voulez d'abord afficher la liste des fichiers qui seront téléchargés et
leur origine, combinez les options <c>--fetchonly</c> et
<c>--pretend</c>&nbsp;:
</p>

<pre caption="Lister les sources et leur origine pour gnumeric">
# <i>emerge --fetchonly --pretend gnumeric</i>
</pre>

<p>
Vous pouvez aussi spécifier un numéro de version pour un paquet. Par exemple,
si vous voulez installer une version de gnumeric plus ancienne que la version
la plus récente, tapez&nbsp;:
</p>

<pre caption="Installer une version spécifique de gnumeric">
# <i>emerge "&lt;gnumeric-1.2"</i>
</pre>

<p>
Vous pouvez aussi utiliser "&gt;" (pour spécifier une version ultérieure),
"=" (un numéro de version précis) ou les combinaisons "&lt;=" et "&gt;=".
</p>

</body>
</subsection>
<subsection>
<title>Installer des paquets précompilés</title>
<body>

<p>
Si vous voulez installer un paquet précompilé, vous devez utiliser l'option
<c>--usepkg</c> (ou le raccourci <c>-k</c>). L'outil <c>emerge</c> utilisera
alors les binaires du répertoire <path>/usr/portage/packages/All</path>
<e>si</e> le numéro de version du paquet précompilé correspond au numéro de
version du paquet à installer.
</p>

<pre caption="Installer la version précompilée de gnumeric si disponible">
# <i>emerge --usepkg gnumeric</i>
</pre>

<p>
Si vous voulez installer le paquet précompilé même si la version n'est pas la
plus récente, utilisez l'option <c>--usepkgonly</c> (ou le raccourci
<c>-K</c>).
</p>

<pre caption="Installer uniquement la version précompilée de gnumeric disponible">
# <i>emerge --usepkgonly gnumeric</i>
</pre>

<p>
Si la version précompilée n'est pas disponible sur votre machine, <c>emerge</c>
peut la télécharger d'un miroir défini dans la variable <c>PORTAGE_BINHOST</c>
du fichier <path>/etc/make.conf</path>.
</p>

<note>
Il n'existe aucun serveur ni miroir Gentoo desquels des paquets binaires
peuvent être téléchargés. Cette fonctionnalité est destinée aux communautés ou
entreprises qui en ont fait la demande.
</note>

<p>
Pour télécharger un paquet précompilé, utilisez l'option <c>--getbinpkg</c> (ou
le raccourci <c>-g</c>).
</p>

<pre caption="Télécharger et installer la version précompilée de gnumeric">
# <i>emerge --getbinpkg gnumeric</i>
</pre>

<p>
Cette commande téléchargera tous les fichiers nécessaires à l'installation du
paquet sur votre système, y compris les éventuelles dépendances. Si vous
désirez voir quels paquets vont être installés, utilisez l'option
<c>--pretend</c> (ou le raccourci <c>-p</c>).
</p>

<pre caption="Lister les paquets à installer pour gnumeric">
# <i>emerge --getbinpkg --pretend gnumeric</i>
</pre>

<p>
Vous pouvez aussi choisir de télécharger et installer un paquet et ses
dépendances <e>sans</e> utiliser les éventuels fichiers déjà téléchargés et
<e>sans</e> utiliser les paquets que vous auriez déjà compilés. Pour cela,
utilisez l'option <c>--getbinpkgonly</c> (ou le raccourci <c>-G</c>).
</p>

<pre caption="Installer un paquet sans utiliser les paquets déjà présents">
# <i>emerge --getbinpkgonly gnumeric</i>
</pre>

<p>
Vous pouvez aussi spécifier un numéro de version pour un paquet. Par exemple,
si vous voulez installer une version de gnumeric plus ancienne que la version
la plus récente, tapez&nbsp;:
</p>

<pre caption="Installer une version spécifique de gnumeric">
# <i>emerge "&lt;gnumeric-1.2"</i>
</pre>

<p>
Vous pouvez aussi utiliser "&gt;" (pour spécifier une version ultérieure),
"=" (un numéro de version précis) ou les combinaisons "&lt;=" et "&gt;=".
</p>

</body>
</subsection>
<subsection>
<title>Gérer les dépendances</title>
<body>

<p>
La gestion très avancée des dépendances par Portage vous évite de vous soucier
de ce type de problème. Cependant, vous voulez peut-être en savoir plus sur les
possibilités qui vous sont offertes.
</p>

<p>
Vous pouvez, par exemple, demander à Portage de considérer qu'aucun des paquets
nécessaires à un paquet donné ne sont installés avec l'option
<c>--emptytree</c> (ou le raccourci <c>-e</c>). Cette option combinée avec
<c>--pretend</c> permet d'afficher la liste complète de toutes les dépendances
d'un paquet. Sans l'option <c>--pretend</c>, <c>emerge</c> (re)compilerait tous
les paquets.
</p>

<pre caption="Lister toutes les dépendances de gnumeric">
# <i>emerge --emptytree --pretend gnumeric</i>
</pre>

<p>
Une autre option est <c>--nodeps</c> qui permet d'installer un paquet sans
installer ses dépendances. Évidemment, il est probable que le paquet ne
fonctionnera pas.
</p>

<pre caption="Installer gnumeric sans ses dépendances">
# <i>emerge --nodeps gnumeric</i>
</pre>

<p>
Contrairement à l'option <c>--nodeps</c>, <c>--onlydeps</c> indique à Portage
de n'installer que les dépendances et pas le paquet lui-même.
</p>

<pre caption="Installer uniquement les dépendances de gnumeric">
# <i>emerge --onlydeps gnumeric</i>
</pre>

<p>
Qunad vous désinstallez un logiciel, Portage ne supprime pas les dépendances
qui ne seraient plus utilisées par aucun paquet. Si vous voulez supprimer ces
dépendances, utilisez <c>emerge depclean</c>. Cette commande recherche et
supprime tous les paquets que vous n'avez pas installés explicitement,
c'est-à-dire qui ont été installés parce qu'un autre paquet en avait besoin, et
qui ne sont plus nécessaires sur votre système parce qu'aucun paquet n'en a
besoin.
</p>

<warn>
La commande <c>emerge depclean</c> peut laisser votre système instable.
Utilisez-la avec prudence et vérifiez toujours quels paquets vont être
supprimés avec l'option <c>-p</c>.
</warn>

<pre caption="Afficher et supprimer les paquets devenus inutiles">
# <i>emerge -p depclean</i>
<comment>(Après bien lu la liste, supprimez les paquets inutiles.)</comment>
# <i>emerge depclean</i>
</pre>

</body>
</subsection>
<subsection>
<title>Garder votre système à jour</title>
<body>

<p>
Deux mots-clefs désignent des ensembles de paquets
particuliers&nbsp;:<e>system</e> et <e>world</e>. Vous avez déjà rencontré le
premier pendant l'installation de Gentoo si vous n'êtes pas parti de l'étape
<e>stage3</e>. En résumé, le mot-clef <e>system</e> désigne l'ensemble des
paquets qui forment le <e>cœur</e> d'un système Gentoo.
</p>

<p>
Le mot-clef <e>world</e> désigne tous les logiciels que vous avez vous-même
installés sur votre machine en plus de ceux désignés par <e>system</e>.
Autrement dit, chaque fois que vous installez un paquet avec la commande
<c>emerge &lt;nom-du-paquet&gt;</c>, le paquet <c>&lt;nom-du-paquet&gt;</c> est
ajouté à la liste désignée par le mot-clef <e>world</e> (dans le fichier
<path>/var/cache/edb/world</path>). Les dépendances ne sont pas enregistrées
dans cette liste, mais nous y reviendrons un peu plus loin.
</p>

<p>
Pour mettre les paquets système à jour, utilisez l'option <c>--update</c> (ou
le raccourci <c>-u</c>).
</p>

<pre caption="Mettre les paquets système à jour">
# <i>emerge --update system</i>
</pre>

<p>
De la même façon, pour mettre l'ensemble de votre système à jour,
faites&nbsp;:
</p>

<pre caption="Mettre tout votre système à jour">
# <i>emerge --update world</i>
</pre>

<p>
Pour rappel, si vous voulez d'abord voir quels paquets vont être mis à jour,
combinez l'option <c>--pretend</c> avec <c>--update</c>.
</p>

<pre caption="Lister les paquets à mettre à jour">
# <i>emerge --pretend --update world</i>
<comment>(Affichage partiel)</comment>
[ebuild     U ] net-misc/wget-1.9-r1 [1.9] 
[ebuild     UD] media-video/dvdauthor-0.5.0 [0.5.3] 
[ebuild     U ] net-analyzer/ethereal-0.9.16 [0.9.14] 
</pre>

<p>
Le mot «&nbsp;ebuild&nbsp;» est suivi d'une ou de plusieurs lettres dont la signification
est décrite ci-dessous&nbsp;:
</p>

<ul>
  <li>
    <e>B</e> (blocks) Le paquet dont le nom suit bloque la mise à jour du
    paquet mentionné à la fin de la ligne.
  </li>
  <li>
    <e>N</e> (new) Le paquet n'existe pas encore sur votre système et va être
    installé pour la première fois.
  </li>
  <li>
    <e>R</e> (replace) Le paquet est déjà installé, mais sera recompilé.
  </li>
  <li>
    <e>F</e> (fetch) Vous devez télécharger vous-même les sources du paquet, en
    général pour des raisons de licence.
  </li>
  <li>
    <e>U</e> (update) Une nouvelle version du paquet va être installée.
  </li>
  <li>
    <e>UD</e> (downgrade) Le paquet existe déjà sur votre système, mais une
    version plus ancienne doit être installée à sa place.
  </li>
</ul>

<p>
Puisque le fichier <e>world</e> ne contient pas de dépendances, quand vous
lancez la commande <c>emerge --update world</c>, seuls les paquets repris dans
le fichier <e>world</e> et leurs dépendances directes sont testés et,
éventuellement, mis à jour. Si vous voulez vérifier <e>toutes</e> les
dépendances et leurs dépendances, ajoutez l'option <c>--deep</c>&nbsp;:
</p>

<pre caption="Mise à jour de tout le système sous-dépendances comprises">
# <i>emerge --update --deep world</i>
</pre>

<p>
Bien sûr, vous pouvez appliquer toutes les options décrites ci-dessus à un
paquet particulier de la même façon qu'avec <e>system</e> et <e>world</e>.
</p>

</body>
</subsection>
<subsection>
<title>Supprimer des paquets</title>
<body>

<p>
Si vous voulez désinstaller un paquet de votre système, utilisez l'option
<c>unmerge</c> (ou le raccourci <c>-C</c>).
</p>

<pre caption="Désinstaller un logiciel">
# <i>emerge unmerge gnumeric</i>
</pre>

<p>
Comme pour l'installation, vous pouvez tester l'action sans la réaliser avec
l'option <c>--pretend</c>.
</p>

<pre caption="Simuler la suppression d'un logiciel">
# <i>emerge --pretend unmerge gnumeric</i>
</pre>

<warn>
Portage ne vérifie pas si un paquet ou plusieurs paquets installés sur votre
système dépendent du paquet que vous supprimez. Il ne vérifie pas non plus si
le paquet appartient à l'ensemble des paquets désignés par le mot-clef
<e>system</e>, c-à-d. à l'ensemble des paquets nécessaires au bon
fonctionnement d'un système Gentoo.
</warn>

<p>
Pendant la suppression d'un paquet, une longue liste de noms de fichiers va
défiler à l'écran. Certains seront précédés d'un indicateur. Les valeurs
<c>!mtime</c>, <c>!empty</c> et <c>cfgpro</c> indiquent pourquoi ces fichiers
ne sont pas supprimés. Les fichiers dont le nom n'est pas précédé d'un
indicateur sont supprimés. Les indicateurs ont les significations suivantes
&nbsp;:
</p>

<ul>
  <li>
    <c>!mtime</c>&nbsp;: Le fichier a été modifié depuis l'installation, soit par
    vous, soit par un autre programme.
  </li>
  <li>
    <c>!empty</c>&nbsp;: Le sous-répertoire n'est pas vide.
  </li>
  <li>
    <c>cfgpro</c>&nbsp;: Le fichier se trouve dans un répertoire protégé et ne sera
    pas supprimé par précaution.
  </li>
</ul>

</body>
</subsection>
</section>
<section>
<title>Disponibilité des logiciels</title>
<subsection>
<title>ARCH ou pas&nbsp;?</title>
<body>

<p>
Les ebuilds contiennent le mot-clé <c>KEYWORDS</c> qui indique à Portage la
disponibilité et la qualité du paquet pour une ou plusieurs architectures. Le
tableau ci-dessous décrit les différentes possibilités. Le mot-clé <c>ARCH</c>
correspond aux différentes architectures comme <c>x86</c>, <c>ppc</c>,
<c>amd64</c>, etc. Il est précédé d'un caractére dont la signification est
décrite ci-dessous&nbsp;:
</p>

<table>
<tr>
  <th>Mot-clé</th>
  <th>Description</th>
</tr>
<tr>
  <ti>ARCH</ti>
  <ti>Le paquet fonctionne sur cette architecture</ti>
</tr>
<tr>
  <ti>~ARCH</ti>
  <ti>Le paquet fonctionne probablement, mais a besoin de plus de tests</ti>
</tr>
<tr>
  <ti>-ARCH</ti>
  <ti>Le paquet ne fonctionne pas sur cette architecture</ti>
</tr>
<tr>
  <ti>-*</ti>
  <ti>Le paquet et connu pour ne fonctionner sur aucune architecture</ti>
</tr>
</table>

<p>
Prenons un exemple&nbsp;:
</p>

<pre caption="Exemple du mot-clé KEYWORD">
KEYWORDS="x86 -sparc ~alpha ~ppc"
</pre>

<p>
L'exemple ci-dessus indique que l'ebuild concerné
</p>

<ul>
  <li>
    fonctionne bien pour l'architecture x86
  </li>
  <li>
    ne fonctionne pas du tout sur sparc
  </li>
  <li>
    devrait fonctionner sur des machines alpha, mais a besoin de plus de tests
  </li>
  <li>
    devrait fonctionner sur des machines ppc, mais a besoin de plus de tests
  </li>
  <li>
    peut peut-être fonctionner sur d'autres architectures, mais cela n'a pas
    été essayé.
  </li>
</ul>

<p>
Votre système utilise les ebuilds classés <e>ARCH</e> par défaut. Si vous
voulez être à la pointe, mais que vous acceptez le risque qu'un ebuild ne
fonctionne pas toujours, que vous êtes capables de vous débrouiller avec un
système déficient et que vous êtes prêt à envoyer un bug via <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>, vous pouvez alors faire
passer votre système en <e>~ARCH</e>. Pour cela, définissez la variable
<c>ACCEPT_KEYWORDS</c> dans le fichier <path>/etc/make.conf</path> et
attribuez-lui la valeur <e>~ARCH</e> (pour rappel, <e>~x86</e> pour un système
x86, etc.)
</p>

<p>
Remarquez qu'il est très difficile, voire impossible, de repasser en
<e>ARCH</e> après être passé <e>~ARCH</e>.
</p>

<p>
Si vous essayez de mettre votre système à jour après cela, vous remarquerez que
<e>beaucoup</e> de paquets vont être mis à jour.
</p>

</body>
</subsection>
<subsection>
<title>Les paquets masqués</title>
<body>

<p>
Parfois, quand vous essayez d'installer un paquet, vous recevez le message
suivant &nbsp;:
</p>

<pre caption="Message à propos de paquets masqués">
Calculating dependencies   
!!! <comment>all ebuilds that could satisfy </comment>&lt;nom-du-paquet&gt;<comment> have been masked.</comment>
</pre>

<p>
Un paquet peut être masqué pour plusieurs raisons&nbsp;:
</p>

<ol>
  <li>Le paquet est classé <e>~ARCH</e> et vous utilisez <e>ARCH</e>.</li>
  <li>Le paquet est explicitement masqué.</li>
  <li>Le paquet n'est pas disponible sur votre architecture.</li>
  <li>Le paquet est masqué dans votre profil.</li>
</ol>

<p>
Portage vous indiquera pourquoi un paquet ne peut être installé&nbsp;:
</p>

<ul>
  <li>
    <b>~arch keyword</b>&nbsp;: le paquet devrait fonctionner sur cette
    architecture, mais a besoin de plus de test et votre système est configuré
    pour n'accepter que des paquets pleinement testés.
  </li>
  <li>
    <b>-arch keyword</b>&nbsp;: le paquet ne fonctionne pas sur votre
    architecture.
  </li>
  <li>
    <b>-* keyword</b>&nbsp;: le paquet ne fonctionne sur aucune architecture.
  </li>
  <li>
    <b>package.mask</b>&nbsp;: le paquet est repris dans le fichier
    <path>package.mask</path> parce qu'il cause des problèmes, plante les
    machines, pose des problèmes de sécurité, ou même pire.
  </li>
  <li>
    <b>profile</b>&nbsp;: le paquet n'est pas disponible dans votre profil.
  </li>
</ul>

<p>
Si le paquet est masqué par <b>~arch keyword</b> et si vous voulez
<e>absolument</e> l'installer (en sachant qu'il y a peut-être une bonne raison
qu'il ne soit pas classé <e>ARCH</e>), vous pouvez accepter la version
<e>~ARCH</e> du paquet en l'ajoutant dans votre fichier
<path>/etc/portage/package.keywords</path>&nbsp;:
</p>

<pre caption="Accepter la version ~ARCH d'un paquet">
<comment>(Créez le répertoire /etc/portage s'il n'existe pas déjà)</comment>
# <i>mkdir -p /etc/portage</i>

# <i>echo "app-office/gnumeric ~x86" &gt;&gt; /etc/portage/package.keywords</i>
# <i>emerge gnumeric</i>
</pre>

<p>
Si vous voulez installer un paquet marqué <b>-arch keyword</b> ou <b>-*
keyword</b> bien qu'il ne soit pas considéré comme disponible, éditez le
fichier <path>/etc/portage/package.keywords</path> et ajoutez le nom du paquet
avec le mot-clé correspondant à votre architecture&nbsp;:
</p>

<pre caption="Accepter la version -arch ou -* d'un paquet">
<comment>(Créez le répertoire /etc/portage s'il n'existe pas déjà)</comment>
# <i>mkdir -p /etc/portage</i>

# <i>echo "app-office/gnumeric -x86" &gt;&gt; /etc/portage/package.keywords</i>
<comment>(ou)</comment>
# <i>echo "app-office/gnumeric -*" &gt;&gt; /etc/portage/package.keywords</i>
# <i>emerge gnumeric</i>
</pre>

<p>
Si vous vouler autoriser l'installation d'une version spécifique d'un paquet,
utilisez les opérateurs «&nbsp;&lt;, &lt;=, =, &gt;= or &gt;&nbsp;».
</p>

<pre caption="Accepter une version spécifique d'un paquet -arch ou -*">
# <i>echo "=app-office/gnumeric-2.0 ~x86" &gt;&gt; /etc/portage/package.keywords</i>
</pre>

<p>
Quand un paquet est masqué à cause de <b>package.mask</b>, il est repris dans
la liste de paquets masqués dans
<path>/usr/portage/profiles/package.mask</path>. En général, un commentaire
explique pourquoi le paquet est masqué. Si vous voulez quand même installer le
paquet malgré les avertissements du type «&nbsp;rend votre système
inutilisable&nbsp;», «&nbsp;rend d'autres paquets inutilisables&nbsp;» ou
«&nbsp;très insuffisamment testé&nbsp;», vous pouvez créer le fichier
<path>/etc/portage/package.unmask</path> et y ajouter le paquet en question en
respectant le format du fichier
<path>/usr/portage/profiles/package.mask</path>.
</p>

<pre caption="Démasquer une application masquée en dur">
<comment>(Créez le répertoire /etc/portage s'il n'existe pas déjà)</comment>
# <i>mkdir -p /etc/portage</i>

# <i>echo "=app-office/gnumeric-1.2.12" &gt;&gt; /etc/portage/package.unmask</i>
</pre>

<p>
<e>Ne modifiez pas</e> le fichier
<path>/usr/portage/profiles/package.mask</path>, car vos modifications
disparaîtront lors de la prochaine mise à jour de l'arbre Portage.
</p>

<p>
Vous pouvez vouloir masquer un (ensemble de) paquet(s), notamment si certaines
versions d'une application ne supportent pas une fonctionnalité dont vous avez
besoin ou si ces versions rendent votre système inutilisable.
</p>

<p>
Pour masquer un paquet en dur, créez le fichier
<path>/etc/portage/package.mask</path> et listez-y le nom du paquet (utilisez le
même format que précédemment).
</p>

<pre caption="Masquer un paquet en dur">
<comment>(Créer le répertoire /etc/portage s'il n'existe pas déjà)</comment>
# <i>mkdir /etc/portage</i>

# <i>echo "&gt;app-office/gnumeric-1.2.10" &gt;&gt; /etc/portage/package.mask</i>
</pre>

<p>
Quand Portage vous refuse l'installation d'un paquet à cause de votre
<b>profil</b>, cela signifie que le paquet n'est pas disponible dans votre
profil. Mais qu'est donc un profil&nbsp;?
</p>

<p>
Un profil contient une liste de noms de paquets et définit une configuration
par défaut pour Portage. Un profil indique à Portage quels paquets et quelles
versions de ceux-ci doivent être autorisés, exclus ou requis. Vous pouvez
changer de profil en modifiant un lien symbolique
(<path>/etc/make.profile</path>).
</p>

<p>
Il est impossible de faire accepter un paquet bloqué par votre profil. Si vous
voulez vraiment installer un tel paquet, vous devez modifier votre profil.
</p>

<p>
Vous trouverez plus d'informations dans la documentation sur les <uri
link="/proj/en/releng/docs/cascading-profiles.xml">profils en cascade</uri> (en
anglais).
</p>

</body>
</subsection>
<subsection>
<title>Les paquets bloqués</title>
<body>

<p>
Le problème suivant peut parfois survenir &nbsp;:
</p>

<pre caption="Paquets bloqués">
[blocks B     ] gnome-base/bonobo-activation (from pkg gnome-base/libbonobo-2.4.0) 
</pre>

<p>
Dans l'exemple ci-dessus, le paquet <c>bonobo-activation</c> empêche
l'installation de <c>libbonobo</c>. Pour résoudre ce problème, supprimez
d'abord le paquet <c>bonobo-activation</c> et recommencez l'opération.
</p>

<pre caption="Supprimer un paquet bloquant">
# <i>emerge unmerge bonobo-activation</i>
</pre>

</body>
</subsection>
</section>
</sections>
