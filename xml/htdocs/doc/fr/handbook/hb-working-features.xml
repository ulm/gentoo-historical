<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/handbook/hb-working-features.xml,v 1.1 2004/01/09 15:10:01 neysx Exp $ -->

<sections>
<section>
<title>DistCC</title>
<subsection>
<title>Qu'est-ce que DistCC ?</title>
<body>

<p>
<c>distcc</c> est un programme qui permet de distribuer des compilations sur
plusieurs machines, pas nécessairement identiques, d'un réseau. Le client
<c>distcc</c> envoie toutes les données nécessaires aux serveurs DistCC (qui
exécutent <c>distccd</c>) disponibles afin qu'ils puissent compiler des parties
du code source au profit du client. Le résultat est une compilation plus
rapide.
</p>

<p>
Vous pourrez trouver une description plus élaborée de <c>distcc</c> (et des
informations sur la manière de le faire fonctionner sous Gentoo) dans notre 
<uri link="/doc/fr/distcc.xml">Documentation Gentoo pour DistCC</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Installation de DistCC</title>
<body>

<p>
Distcc est fourni avec une interface graphique qui permet de suivre les tâches
de compilation que votre ordinateur envoie. Si vous utilisez Gnome, mettez
'gnome' dans votre configuration <c>USE</c>. Mais si vous n'utilisez pas Gnome
et souhaitez toutefois avoir une interface graphique, vous devriez mettre 'gtk'
dans votre configuration <c>USE</c>.
</p>

<p>
L'installation de distcc est, comme c'est le cas pour tous les logiciels
disponible dans Portage, extrêmement simple&nbsp;:
</p>

<note>
A partir de maintenant, dans la mesure où vous savez comment installer des
paquets binaires si vous le souhaitez, nous omettrons l'option <c>--usepkg</c>
dans toute la suite du manuel Gentoo.
</note>

<pre caption="Installer Distcc">
# <i>emerge distcc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Activer le support distcc pour Portage</title>
<body>

<p>
Puisque l'installation est simple, le reste devrait l'être aussi&nbsp;:) Nous
allons donc activer rapidement le support pour <c>distcc</c> dans Portage.
</p>

<p>
Commencez par ouvrir <path>/etc/make.conf</path> et éditez la variable
<c>FEATURES</c> de telle sorte qu'elle contienne le mot-clé <c>distcc</c>. Puis
éditez la variable <c>MAKEOPTS</c> pour y ajouter <c>-jX</c> où <c>X</c> est le
nombre de CPUs qui exécutent <c>distccd</c> (l'hôte actuel inclus) plus
un&nbsp;:
</p>

<pre caption="Configuration possible de MAKEOPTS dans /etc/make.conf">
<comment># Supposons que vous ayez deux hôtes distccd monoprocesseurs en plus de
cet hôte</comment>
MAKEOPTS="-j4"
</pre>

<p>
Ensuite, toujours dans <path>/etc/make.conf</path>, décommentez la ligne
<c>PORTAGE_TMPDIR</c> et ajoutez la ligne suivante à la fin du fichier&nbsp;:
</p>

<pre caption="Ajout d'une variable supplémentaire spécifique à distcc dans /etc/make.conf">
<comment># N'oubliez pas de décommenter la variable PORTAGE_TMPDIR</comment>
DISTCC_DIR=${PORTAGE_TMPDIR}/portage/.distcc
</pre>

<p>
Exécutez maintenant <c>distcc-config</c> et entrez la liste des serveurs DistCC
disponibles. Pour donner un exemple simple, nous supposerons que les serveurs
DistCC disponibles sont <c>192.168.1.102</c> (l'hôte actuel),
<c>192.168.1.103</c> et <c>192.168.1.104</c> (deux hôtes "distants")&nbsp;:
</p>

<pre caption="Configurer distcc pour qu'il utilise les trois serveurs distcc">
# <i>distcc-config --set-hosts "192.168.1.102 192.168.1.103 192.168.1.104"</i>
</pre>

<p>
Bien entendu, n'oubliez pas de lancer le démon <c>distccd</c>&nbsp;:
</p>

<pre caption="Lancer le démon distccd">
# <i>/etc/init.d/distccd start</i>
</pre>

<p>
Félicitations, votre système utilisera désormais la compilation distribuée&nbsp;!
Pour plus d'information sur Gentoo et DistCC, veuillez consulter notre
<uri link="/doc/fr/distcc.xml">Documentation Gentoo sur DistCC</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>ccache</title>
<subsection>
<title>Qu'est-ce que ccache ?</title>
<body>

<p>
<c>ccache</c> est un cache rapide pour compilateur. Lorsque vous compilez un
programme, il mettra les résultats intermédiaires en cache de telle sorte que,
s'il vous arrive de recompiler le même programme, le temps de compilation soit
largement réduit. Avec des applications communes, cela peut entraîner des
compilations 5 à 10 fois plus rapides.
</p>

<p>
Si vous êtes intéressé par le fonctionnement interne de <c>ccache</c>, veuillez
visiter le <uri link="http://ccache.samba.org">site de ccache</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Installation de ccache</title>
<body>

<p>
Installer <c>ccache</c> sous Gentoo est d'une facilité déconcertante. Il vous
suffit dune commande <c>emerge</c> et c'est fait :)
</p>

<pre caption="Installer ccache">
# <i>emerge ccache</i>
</pre>

</body>
</subsection>
<subsection>
<title>Activer le support de ccache dans Portage</title>
<body>

<p>
Tout d'abord, éditez <path>/etc/make.conf</path> et changez la variable
<c>FEATURES</c> pour qu'elle contienne le mot-clé <c>ccache</c>&nbsp;:
</p>

<pre caption="Editer FEATURES dans /etc/make.conf">
FEATURES="ccache"
</pre>

<p>
Ensuite, éditez (ou créez) la variable <c>CCACHE_SIZE</c> (aussi dans 
<path>/etc/make.conf</path>) pour qu'elle contienne la quantité d'espace disque
que vous comptez allouer pour <c>ccache</c>&nbsp;:
</p>

<pre caption="Editer CCACHE_SIZE dans /etc/make.conf">
CCACHE_SIZE="2G"
</pre>

<p>
A partir de ce moment, Portage utilisera <c>ccache</c> pour accélérer les
compilations lorsque cela est possible. Si vous n'êtes pas sûr que <c>ccache</c>
fonctionne, vous pouvez exécuter <c>ccache -s</c> pour afficher les statistiques
de <c>ccache</c>&nbsp;:
</p>

<pre caption="Afficher les statistiques de ccache">
# <i>ccache -s</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Paquets binaires</title>
<subsection>
<title>Créer des paquets binaires</title>
<body>

<p>
Nous avons déjà parlé de l'utilisation de paquets précompilés, mais comment
crée-t-on son propre paquet précompilé&nbsp;?
</p>

<p>
Si le paquet est déjà installé, vous pouvez utiliser la commande
<c>quickpkg</c> qui créera une archive des fichiers installés. Cela est très
intéressant à des fins de sauvegarde&nbsp;!
</p>

<pre caption="Utiliser quickpkg">
# <i>quickpkg gnumeric</i>
</pre>

<p>
Si le paquet n'est pas encore installé, vous pouvez l'installer avec
<c>emerge</c> en demandant la création d'un paquet binaire. <c>emerge</c>
utilise l'option <c>--buildpkg</c> (<c>-b</c> en raccourci) pour ce faire&nbsp;:
</p>

<pre caption="Installer gnumeric et créer un paquet binaire">
# <i>emerge --buildpkg gnumeric</i>
</pre>

<p>
Si vous souhaitez que Portage fasse cela par défaut, vous pouvez mettre le
mot-clé <c>builpkg</c> dans la variable <c>FEATURES</c> déclarée dans
<path>/etc/make.conf</path>.
</p>

<pre caption="Pour créer automatiquement des paquets binaires">
FEATURES="buildpkg"
</pre>

<p>
Si vous ne souhaitez pas installer le logiciel, mais seulement construire le
paquet, vous pouvez utiliser l'option <c>--buildpkgonly</c> (<c>-B</c> en
raccourci)&nbsp;:
</p>

<pre caption="Créer un paquet binaire pour gnumeric">
# <i>emerge --buildpkgonly gnumeric</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Fonctionnalités liées à la sécurité</title>
<subsection>
<title>Bac à sable</title>
<body>

<p>
Lorsqu'il construit et installe des paquets, Portage utilise un
<e>bac à sable</e> pour protéger votre système. Ce qui signifie que, tant
que le paquet n'est pas installé sur votre système, il ne peut toucher aucun
fichier en dehors du bac à sable. Cela garantit que Portage sait quels fichiers
sont créés ou modifiés par un paquet.
</p>

<p>
Une fois la compilation du paquet achevée, Portage va "pré-installer" ce dernier
dans le bac à sable en notant quels fichiers sont placés à quels endroits. Il
déplacera ensuite ces fichiers du bac à sable vers votre système.
</p>

</body>
</subsection>
<subsection>
<title>Privilèges utilisateur</title>
<body>

<p>
Portage permet aussi de construire des paquets en tant qu'un utilisateur
différent de root (plus précisément, en tant qu'utilisateur "portage" et
groupe "portage"). Cela améliore la sécurité durant la construction. Vous pouvez
choisir d'utiliser ces privilèges utilisateur avec ou sans le bac à sable.
Naturellement, la méthode la plus préférable est celle qui combine les
privilèges utilisateur avec le bac à sable.
</p>

</body>
</subsection>
<subsection>
<title>Activer le bac à sable et les privilèges utilisateur</title>
<body>

<p>
Portage utilise la fonctionnalité <c>sandbox</c> (bac à sable) par défaut. Si
vous souhaitez utiliser <c>userpriv</c> (les privilèges utilisateur), vous
devrez l'ajouter à la variable <c>FEATURES</c>. Notez bien que l'activation de
<c>userpriv</c> désactivera <c>sandbox</c>, sauf si vous activez aussi
<c>usersandbox</c>&nbsp;:
</p>

<pre caption="Activater userpriv et usersandbox">
FEATURES="userpriv usersandbox"
</pre>

<warn>
N'enlevez <e>pas</e> <c>sandbox</c> de la variable <c>FEATURES</c> !
</warn>

</body>
</subsection>
<subsection>
<title>Vérifications strictes</title>
<body>

<p>
Portage peut être configuré de manière à réagir fortement à des situations
dangereuses (comme des fichiers Manifest manquants ou incorrects). Pour activer
ces vérifications strictes, ajoutez le mot-clé <c>strict</c> à la variable
<c>FEATURES</c>&nbsp;: 
</p>

<pre caption="Activer les vérifications strictes">
FEATURES="strict"
</pre>

</body>
</subsection>
<subsection>
<title>Gestion intelligente des permissions du système de fichiers</title>
<body>

<p>
Portage peut être configuré de manière à gérer des permissions sur certains
fichiers qui pourraient créer un risque lié à la sécurité. Il fait cela en
supprimant les bits lisibles pour "groupe" et "autres" sur les fichiers setuid,
et en supprimant le bit lisible pour "autres" sur les fichiers setgid durant la
phase de pré-installation. Pour activer cette gestion intelligente des
permissions, ajoutez le mot-clé <c>sfperms</c> à la variable <c>FEATURES</c>&nbsp;:
</p>

<pre caption="Activer la gestion intelligente des permissions de fichiers">
FEATURES="sfperms"
</pre>

</body>
</subsection>
</section>
<section>
<title>Autres fonctionnalités</title>
<subsection>
<title>Aide de Portage</title>
<body>

<p>
Il existe plusieurs autres mots-clés que vous pouvez placer dans la variable
<c>FEATURES</c>. La plupart sont conçus pour les développeurs et présentent peu
d'intérêt pour l'utilisateur normal. Si vous souhaitez en savoir plus sur
ces fonctionnalités, n'oubliez pas de lire la page man de <path>make.conf</path>
que nous fournissons.
</p>

<pre caption="Pour plus d'informations sur Portage">
# <i>man make.conf</i>
</pre>

</body>
</subsection>
</section>
</sections>
