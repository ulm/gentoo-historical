<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/handbook/hb-install-system.xml,v 1.47 2006/01/23 10:44:44 neysx Exp $ -->

<sections>

<version>2.15</version>
<date>2006-01-19</date>

<section>
<title>Entrer dans le nouvel environnement (chroot)</title>
<subsection>
<title>Facultatif&nbsp;: sélection des miroirs</title>
<body>

<p>
Choisir un miroir rapide afin de télécharger les sources est recommandé.
Portage utilise la variable GENTOO_MIRRORS définie dans <path>make.conf</path>
pour connaître les différents serveurs à contacter.  Vous pouvez consulter la
liste de nos <uri link="/main/en/mirrors.xml">miroirs</uri> et en choisir
quelques-uns proches de chez vous, car ils sont en général les plus rapides
pour vous. Cependant, l'outil <c>mirrorselect</c> vous présente la même liste
et vous permet de choisir plus facilement.
</p>

<pre caption="Choisir des miroirs avec mirrorselect">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Ne sélectionnez pas de miroir IPv6, car les «&nbsp;stages&nbsp;» utilisés pour
l'installation ne supportent pas IPv6.
</warn>

<p>
Une autre variable importante de <path>make.conf</path> est RSYNC qui indique à
Portage le serveur à utiliser pour synchroniser votre arbre Portage (l'ensemble
des ebuilds, des scripts et autres fichiers dont Portage a besoin pour
installer des paquets). Au lieu de définir RSYNC manuellement, vous pouvez
aussi utiliser <c>mirrorselect</c>.
</p>

<pre caption="Choisir un miroir pour RSYNC">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Après avoir utilisé <c>mirrorselect</c>, il est conseillé de vérifier le
contenu de <path>/mnt/gentoo/etc/make.conf</path>.
</p>

</body>
</subsection>
<subsection>
<title>Copier l'information DNS</title>
<body>

<p>
Il reste une dernière chose à faire avant d'entrer dans le nouvel
environnement. Il s'agit de copier l'information DNS de
<path>/etc/resolv.conf</path>. Vous devez le faire afin d'assurer le bon
fonctionnement du réseau dans le nouvel environnement.
<path>/etc/resolv.conf</path> contient les serveurs de noms pour votre réseau.
</p>

<pre caption="Copier l'information DNS">
<comment>(L'option -L garantit qu'on ne copie pas un lien symbolique.)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Monter /proc et /dev</title>
<body>

<p>
Montez le système de fichiers <path>/proc</path> dans
<path>/mnt/gentoo/proc</path> permet à l'installation d'utiliser les
informations fournies par le noyau, même lorsqu'on se trouve dans
l'environnement chroot ainsi que <path>/dev</path>.
</p>

<pre caption="Monter /proc et /dev">
# <i>mount -t proc none /mnt/gentoo/proc</i>
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>

</body>
</subsection>
<subsection>
<title>Entrer dans le nouvel environnement</title>
<body>

<p>
Maintenant que toutes les partitions sont initialisées et que l'environnement
de base est installé, il est temps d'entrer dans notre nouvel environnement
d'installation. Cela signifie que l'on passe de l'environnement d'installation
actuel (CD d'installation ou autre environnement d'installation) à
l'environnement de votre système (soit les partitions initialisées).
</p>

<p>
L'entrée se fait en trois étapes. D'abord, on change la racine de
<path>/</path> (sur l'environnement d'installation) en <path>/mnt/gentoo</path>
(sur vos partitions) en utilisant <c>chroot</c>. Ensuite, on crée un nouvel
environnement en utilisant <c>env-update</c> dont l'effet est
essentiellement de créer les variables d'environnement. Finalement, ces
variables sont chargées en mémoire en utilisant <c>source</c>.
</p>

<pre caption="Entrer dans le nouvel environnement">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
# <i>export PS1="(chroot) $PS1"</i>
</pre>

<p>
Félicitations&nbsp;! Vous êtes maintenant dans votre propre environnement Gentoo
Linux. Bien sûr, ce dernier est loin d'être complet. C'est pourquoi il reste
encore quelques sections à ce guide d'installation :-)
</p>

</body>
</subsection>
</section>

<section>
<title>Configurer Portage</title>
<subsection>
<title>Mettre l'arbre de Portage à jour</title>
<body>

<p>
Vous devriez mettre votre arbre Portage à jour avec la commande <c>emerge
--sync</c>.
</p>

<pre caption="Mise à jour de l'arbre de Portage">
# <i>emerge --sync</i>
<comment>(Si vous utilisez un terminal lent comme certains framebuffers ou une
connexion série, vous pouvez ajouter l'option --quiet pour gagner du temps :)</comment>
# <i>emerge --sync --quiet</i>
</pre>

<p>
Si vous vous trouvez derrière un pare-feu qui bloque le trafic rsync, vous
pouvez utiliser <c>emerge-webrsync</c> qui télécharge un instantané de l'arbre
Portage depuis un mirroir et l'utilise pour mettre votre arbre à jour.
</p>

<p>
Si vous recevez un avertissement vous suggérant de mettre Portage à jour parce
qu'une nouvelle version est disponible, vous devez l'ignorer. Portage sera mis
à jour pour vous plus tard pendant l'installation.
</p>

</body>
</subsection>

<subsection>
<title>Choisir le bon profil</title>
<body>

<p>
Qu'est-ce qu'un profil&nbsp;?
</p>

<p>
Un profil est un composant important d'une installation de Gentoo. Il spécifie
non seulement les valeurs par défaut des options de compilation (les variables
CFLAGS et CXXFLAGS) et d'autres paramètres importants, mais aussi quels paquets
sont disponibles ou pas. Les profils sont mis à jour par les développeurs
Gentoo.
</p>

<p>
Les utilisateurs n'avaient pas à se préoccuper des profils jusqu'à présent.
Les utilisateurs de machines x86, hppa et alpha peuvent choisir entre deux
profils, un pour le noyau 2.4 et un pour le noyau 2.6. Ceci est nécessaire pour
assurer une transition en douceur vers le noyau 2.6.  D'autres profils sont
disponibles pour les architectures PPC et PPC64, nous y reviendrons plus tard.
</p>

<p>
Pour connaître le profil que vous utilisez, lancez la commande suivante&nbsp;:
</p>

<pre caption="Connaître son profil">
# <i>ls -FGg /etc/make.profile</i>
lrwxrwxrwx  1 48 Apr  8 18:51 /etc/make.profile -> ../usr/portage/profiles/default-linux/x86/2005.1/
</pre>

<p>
Si vous utilisez une des trois architectures mentionnées ci-dessus, le profil
par défaut utilise un noyau 2.6. Ce profil est recommandé, mais vous pouvez
choisir de conserver un noyau 2.4 si vous le désirez. 
</p>

<p>
Si vous avez une bonne raison de continuer à utiliser l'ancien profil 2.4, vous
devez d'abord vérifier qu'il est disponible pour votre architecture. Par
exemple, pour l'architecture x86, faites&nbsp;:
</p>

<pre caption="Savoir si un profil supplémentaire existe">
# <i>ls -d /usr/portage/profiles/default-linux/x86/no-nptl/2.4</i>
/usr/portage/profiles/default-linux/x86/no-nptl/2.4
</pre>

<p>
Comme vous pouvez le voir, un sous-répertoire <path>2.4</path> existe (pas
d'erreur à propos d'un répertoire manquant.). Il est recommandé de conserver le
profil par défaut, mais si vous voulez un système qui utilise le noyau 2.4,
vous devez modifier le lien symbolique <path>make.profile</path> comme
suit&nbsp;:
</p>

<pre caption="Changer vers le profil 2.4">
<comment>(Remplacez x86 par l'architecture que vous utilisez.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/x86/no-nptl/2.4 /etc/make.profile</i>
<comment>(Afficher le contenu du profil 2.4.)</comment>
# <i>ls -FGg /etc/make.profile/</i>
total 12
-rw-r--r--  1 939 Dec 10 14:06 packages
-rw-r--r--  1 347 Dec  3  2004 parent
-rw-r--r--  1 573 Dec  3  2004 virtuals
</pre>

<p>
Gentoo 2005.1 a apporté de nouveaux profils à l'architcture PPC.
</p>

<pre caption="Profils PPC">
<comment>(Profil PPC générique pour toutes les machines PPC.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc /etc/make.profile</i>
<comment>(Profil G3.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G3 /etc/make.profile</i>
<comment>(Profil G3 Pegasos.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G3/Pegasos/ /etc/make.profile</i>
<comment>(Profil G4 Altivec.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G4 /etc/make.profile</i>
<comment>(Profil G4 Pegasos.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G4/Pegasos/ /etc/make.profile</i>
</pre>

<p>
Gentoo 2005.1 a apporté de nouveaux profils à l'architcture PPC64.
</p>

<pre caption="PPC64 Profiles">
<comment>(Profil générique 64 bits pour toutes les machines PPC64.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/64bit-userland /etc/make.profile</i>
<comment>(Profil générique 32 bits pour toutes les machines PPC64.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/32bit-userland /etc/make.profile</i>
<comment>(Chaque type de « userland » a des sous-profils comme ci-dessus,
remplacez userland par la valeur adéquate dans les profils ci-dessous.)</comment>
<comment>(Profile 970 pour JS20.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/970 /etc/make.profile</i>
<comment>(Profil G5.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/970/pmac /etc/make.profile</i>
<comment>(profil POWER3.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power3 /etc/make.profile</i>
<comment>(Profil POWER4.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power4 /etc/make.profile</i>
<comment>(Profil POWER5.)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power5 /etc/make.profile</i>
<comment>(Le profil multilib n'est pas encore considéré suffisamment stable.)</comment>
</pre>

</body>
</subsection>

<subsection id="configure_USE">
<title>Configurer la variable USE</title>
<body>

<p>
<c>USE</c> est une des plus puissantes variables mises à la disposition des
utilisateurs de Gentoo. Plusieurs programmes peuvent être compilés avec ou sans
le support optionnel disponible pour certaines fonctionnalités. Par exemple,
certains programmes peuvent être compilés avec un support pour gtk ou pour Qt.
D'autres peuvent être compilés avec ou sans support pour SSL. Certains
programmes peuvent même être compilés avec un support pour le
«&nbsp;framebuffer&nbsp;» (svgalib) plutôt que pour X11 (serveur X).
</p>

<p>
La plupart des distributions compilent leurs paquets avec un support aussi
complet que possible, augmentant ainsi la taille des programmes et le temps de
chargement, sans mentionner le nombre énorme de dépendances qui en résulte.
Avec Gentoo, vous pouvez définir les options à utiliser lors de la compilation
d'un paquet. C'est ici que la variable <c>USE</c> entre en jeu.
</p>

<p>
La variable <c>USE</c> contient des mots-clés que vous choisissez et qui
correspondent à des options de compilation. Par exemple, <e>ssl</e> compilera
le support ssl dans les programmes qui le supportent. <e>-X</e> retirera le
support pour le serveur X (remarquez le signe moins devant le mot-clé).
<e>gnome gtk -kde -qt</e> compilera vos programmes avec le support pour GNOME
(et gtk), mais sans le support pour KDE (et qt). Le résultat est un système
complètement réglé pour GNOME.
</p>

<p>
Les options par défaut pour <c>USE</c> se trouvent dans les fichiers
<path>make.defaults</path> de votre profil. Vous trouverez ces fichiers
<path>make.defaults</path> dans le répertoire sur lequel le lien
<path>/etc/make.profile</path> pointe, ainsi que dans tous ses répertoires
parents. Les options par défaut de <c>USE</c> sont donc la somme de toutes les
options <c>USE</c> de ces fichiers. Vos modifications à
<path>/etc/make.conf</path> sont jugées en fonction de ces options par
défaut. Si vous ajoutez quelque chose aux options <c>USE</c>, c'est ajouté
à la liste par défaut. Si vous retirez quelque chose des options <c>USE</c>
(en le précédant du signe moins), c'est retiré de la liste par défaut (en
supposant que cela s'y trouvait). Ne modifiez <e>jamais</e> quoi que ce soit
dans le répertoire <path>/etc/make.profile</path> car ces fichiers sont écrasés
lors des mises à jour de Portage&nbsp;!
</p>

<p>
Une description complète de <c>USE</c> peut être consultée dans la seconde
partie du manuel Gentoo, <uri link="?part=2&amp;chap=2">La variable USE</uri>.
Une description complète des options disponibles se trouve dans le fichier
<path>/usr/portage/profiles/use.desc</path> qui devrait déjà être sur votre
système.
</p>

<pre caption="Afficher les options de la variable USE disponibles">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Utilisez les flèches de votre clavier pour faire défiler le texte et</comment>
<comment>tapez 'q' pour quitter.)</comment>
</pre>

<p>
L'exemple suivant montre les options de USE pour un
système basé sur KDE avec support pour ALSA, pour les DVD et pour la
gravure de CD&nbsp;:
</p>

<pre caption="Ouverture de /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Options de USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Facultatif: les «&nbsp;locales&nbsp;» de glibc</title>
<body>

<p>
Vous n'utiliserez probablement qu'une ou deux «&nbsp;locales&nbsp;» sur votre
système.  Après avoir compilé <c>glibc</c>, toutes les définitions de zone sont
créées. Vous pouvez éviter cela et ne créer que les définitions de zone qui
vous intéressent. Ajoutez l'option <c>userlocales</c> à votre variable USE et
définissez la liste des «&nbsp;locales&nbsp;» à créer dans le fichier
<path>/etc/locales.build</path>. N'utilisez cela que si vous connaissez la ou
les «&nbsp;locales&nbsp;» dont vous avez besoin.
</p>

<pre caption="Utiliser l'option userlocales uniquement pour glibc">
# <i>mkdir -p /etc/portage</i>
echo "sys-libs/glibc userlocales" &gt;&gt; /etc/portage/package.use
</pre>

<p>
Ensuite, définissez les «&nbsp;locales&nbsp;» qui vous intéressent&nbsp;:
</p>

<pre caption="Ouvrir le fichier /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
L'exemple ci-dessous sélectionne l'anglais américain et le français en France
dans les encodages ISO et UTF-8.
</p>

<pre caption="Exemple de /etc/locales.build">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
fr_FR/ISO-8859-1
fr_FR@euro/ISO-8859-15
fr_FR.UTF-8/UTF-8
</pre>

<p>
Ensuite, passez à la <uri link="?part=1&amp;chap=7">Configuration du
noyau</uri>.
</p>

</body>
</subsection>
</section>
</sections>
