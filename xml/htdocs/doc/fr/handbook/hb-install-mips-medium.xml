<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<sections>

<version>1.8</version>
<date>2005-04-10</date>

<section>
<title>Matériel requis</title>
<subsection>
<title>Introduction</title>
<body>

<p>
Avant de débuter, nous allons présenter le matériel requis pour installer
Gentoo avec succès sur votre système.
</p>

</body>
</subsection>
<subsection>
<title>Matériel requis</title>
<body>

<table>
<tr>
  <th>Mémoire</th>
  <ti>64 Mo</ti>
</tr>
<tr>
  <th>Espace disque</th>
  <ti>1.5 Go (mémoire virtuelle non comprise)</ti>
</tr>
<tr>
  <th>Mémoire virtuelle</th>
  <ti>Au moins 256 Mo</ti>
</tr>
</table>

<p>
Vous devriez consulter le document <uri
link="/doc/en/mips-requirements.xml">MIPS Hardware Requirements</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Les différentes approches</title>
<subsection>
<title>Introduction</title>
<body>

<p>
Gentoo Linux peut être installé en utilisant une des trois archives tar
(<e>stages</e>).
</p>

<ul>
  <li>
    L'archive stage1 ne contient qu'un compilateur (C seulement, pas C++),
    Portage (le gestionnaire de paquets de Gentoo) et quelques logiciels
    nécessaires à leur utilisation.
   </li>
   <li>
     L'archive stage2 contient un système compilé et un environnement minimal
     que vous pouvez utiliser pour compiler les autres composants de Gentoo.
   </li>
   <li>
     L'archive stage3 contient un système compilé et un environnement minimal
     auquel ne manquent que quelques logiciels pour lesquels nous avons choisi
     de ne pas vous imposer notre choix. C'est à vous de choisir les logiciels
     que vous voulez installer.
   </li>
</ul>

<p>
Chaque méthode a ses avantages et ses inconvénients. Nous allons analyser le
pour et le contre de chacune afin que vous disposiez de l'information
nécessaire pour prendre une décision éclairée.
</p>

</body>
</subsection>
<subsection>
<title>Installer avec l'archive stage1</title>
<body>

<p>
L'archive stage1 est utilisée quand vous voulez compiler votre nouveau système
<e>ex nihilo</e>.
</p>

<p>
Débuter à partir du <e>stage1</e> vous procure le contrôle total sur les
paramètres d'optimisation et les options de compilation qui sont
activées initialement. Pour cette raison, le <e>stage1</e> est intéressant pour
les utilisateurs enthousiastes qui savent ce qu'ils font. Il s'agit aussi d'une
méthode d'installation idéale pour ceux qui veulent en savoir plus sur le
fonctionnement interne de Gentoo Linux.
</p>

<table>
<tr>
  <th>Stage1</th>
  <th>Le pour et le contre</th>
</tr>
<tr>
  <th>+</th>
  <ti>
    Vous procure le contrôle total sur les paramètres d'optimisation et les
    options de compilation qui sont activées initialement.
  </ti>
</tr>
<tr>
  <th>+</th>
  <ti>
    Indiqué pour les utilisateurs enthousiastes qui savent ce qu'ils font.
  </ti>
</tr>
<tr>
  <th>+</th>
  <ti>
    Vous permet d'en savoir plus sur le fonctionnement interne de Gentoo
    Linux.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>Le processus d'installation est très long.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Si vous ne souhaitez pas régler les paramètres, c'est probablement une
    perte de temps.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Une connexion Internet est requise pendant l'installation.
  </ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>Installer avec l'archive stage 2</title>
<body>

<p>
Une archive <e>stage2</e> contient un système «&nbsp;semi-compilé&nbsp;».
</p>

<p>
L'installation à partir du <e>stage2</e> vous permet d'éviter le processus du
«&nbsp;bootstrap&nbsp;», ce qui est correct si les paramètres d'optimisation que
nous avons choisis pour le <e>stage2</e> particulier que vous utilisez vous
conviennent.
</p>

<table>
<tr>
  <th>Stage2</th>
  <th>Le pour et le contre</th>
</tr>
<tr>
  <th>+</th>
  <ti>Vous n'avez pas à réaliser le «&nbsp;bootstrap&nbsp;».</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Plus rapide que de démarrer à partir du <e>stage1</e>.</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Vous pouvez toujours régler vos paramètres.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Vous ne pouvez pas faire autant de réglages qu'avec le <e>stage1</e>.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Ce n'est pas la méthode la plus rapide pour installer Gentoo.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Vous devez accepter les options que nous avons choisies pour le
    «&nbsp;bootstrap&nbsp;».
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Une connexion Internet est requise pendant l'installation.
  </ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>Installer avec l'archive stage 3</title>
<body>

<p>
L'archive stage3 contient un système compilé et un environnement minimal auquel
ne manquent que quelques logiciels pour lesquels nous avons choisi de ne pas
vous imposer notre choix. C'est à vous de choisir les logiciels que vous voulez
installer.
</p>

<p>
Choisir le <e>stage3</e> vous procurera l'installation la plus rapide de Gentoo
Linux, mais impliquera aussi que votre système de base aura les optimisations
que nous avons choisies pour vous (qui, en toute honnêteté, sont de bons
paramètres choisis afin d'améliorer les performances tout en maintenant la
stabilité). De plus, partir d'une archive <e>stage3</e> est nécessaire si vous
désirez installer des paquets précompilés ou installer Gentoo sans connexion
réseau.
</p>

<table>
<tr>
  <th>Stage3</th>
  <th>Le pour et le contre</th>
</tr>
<tr>
  <th>+</th>
  <ti>
    C'est la méthode la plus rapide pour obtenir un système de base Gentoo.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Vous ne pouvez pas régler le système de base car il est déjà construit.
  </ti>
</tr>
</table>

<p>
Vous apprécierez sans doute de savoir que si vous modifiez vos paramètres
d'optimisation après avoir installé Gentoo, vous pourrez recompiler le système
en entier avec ces nouveaux paramètres.
</p>
</body>
</subsection>

<subsection>
<title>Quelques mots sur les processeurs</title>
<body>

<p>
Sur de nombreuses architectures, on peut trouver plusieurs générations de
processeurs et chaque génération est construite sur les bases de la génération
précédente. Les architectures MIPS ne font pas exception. Il existe plusieurs
générations de processeurs pour l'architecture MIPS. Pour pouvoir choisir
l'archive de stage utilisée lors du démarrage en réseau et pour bien configurer
la variable <c>CFLAGS</c>, vous devez savoir à quelle famille le processeur de
votre système appartient. Ces familles sont regroupées sous la dénomination ISA
(pour <b>I</b>nstruction <b>S</b>et <b>A</b>rchitecture).
</p>

<table>
  <tr>
    <th>ISA MIPS</th>
    <th>32/64-bit</th>
    <th>Processeurs concernés</th>
  </tr>
  <tr>
    <ti>MIPS 1</ti>
    <ti>32-bit</ti>
    <ti>
      <uri link="http://www.linux-mips.org/wiki/index.php/R2000">R2000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R2000">R3000</uri>
    </ti>
  </tr>
  <tr>
    <ti>MIPS 2</ti>
    <ti>32-bit</ti>
    <ti>
      <uri link="http://www.linux-mips.org/wiki/index.php/R6000">R6000</uri>
    </ti>
  </tr>
  <tr>
    <ti>MIPS 3</ti>
    <ti>64-bit</ti>
    <ti>
      <uri link="http://www.linux-mips.org/wiki/index.php/R4000">R4000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R4000">R4400</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R4000">R4600</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R4000">R4700</uri>
    </ti>
  </tr>
  <tr>
    <ti>MIPS 4</ti>
    <ti>64-bit</ti>
    <ti>
      <uri link="http://www.linux-mips.org/wiki/index.php/R5000">R5000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R5000">RM5000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/RM7000">RM7000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R8000">R8000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R10000">R10000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R10000">R12000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R10000">R14000</uri>,
      <uri link="http://www.linux-mips.org/wiki/index.php/R10000">R16000</uri>
    </ti>
  </tr>
  <tr>
    <ti>MIPS 5</ti>
    <ti>64-bit</ti>
    <ti>
      N'existe pas encore.
    </ti>
  </tr>
</table>

<p>
Un autre concept important à prendre en compte est la représentation des
nombres dans le système. Elle se réfère à la manière avec laquelle le processeur
lit les mots dans la mémoire principale. Un mot peut être lu comme étant
<e>big</e> endian (le bit de poids fort en premier) ou <e>little</e> endian (bit
de poids faible en premier). Les machines Intel x86 sont en général en little
endian, alors que les machines Apple et SPARC sont en big endian. Sur les MIPS,
on peut rencontrer les deux. Pour séparer les deux cas, nous ajoutons <c>el</c> au nom de l'architecture lorsqu'elle est en little endian.
</p>

<table>
  <tr>
    <th>Architecture</th>
    <th>32/64-bit</th>
    <th>Big/little endian</th>
    <th>Machines concernées</th>
  </tr>
  <tr>
    <ti><c>mips</c></ti>
    <ti>32-bit</ti>
    <ti>Big Endian</ti>
    <ti>Silicon Graphics</ti>
  </tr>
  <tr>
    <ti><c>mipsel</c></ti>
    <ti>32-bit</ti>
    <ti>Little Endian</ti>
    <ti>DECStations, Cobalt Servers, PlayStation 2</ti>
  </tr>
  <tr>
    <ti><c>mips64</c></ti>
    <ti>64-bit</ti>
    <ti>Big Endian</ti>
    <ti>Silicon Graphics</ti>
  </tr>
  <tr>
    <ti><c>mips64el</c></ti>
    <ti>64-bit</ti>
    <ti>Little Endian</ti>
    <ti>Cobalt Servers, PlayStation 2</ti>
  </tr>
</table>

<p>
Pour ceux qui veulent en savoir plus sur les ISA, vous pouvez vous référer aux
liens ci-dessous&nbsp;:
</p>

<ul>
  <li>
    <uri
    link="http://www.linux-mips.org/wiki/index.php/Instruction_Set_Architecture">Site
    Linux/MIPS : MIPS ISA</uri>
  </li>
  <li>
    <uri link="http://www.linux-mips.org/wiki/index.php/Endianess">Site
    Linux/MIPS : Little et Big Endian</uri>
  </li>
  <li>
    <uri link="http://www.linux-mips.org/wiki/index.php/Processors">Site
    Linux/MIPS : Processeurs</uri>
  </li>
  <li>
    <uri link="http://fr.wikipedia.org/wiki/Jeu_d'instructions">Wikipedia : Jeu
    d'instructions</uri>
  </li>
</ul>

</body>
</subsection>

</section>

<section>
<title>Aperçu du démarrage réseau</title>
<subsection>
<body>

<p>
Dans ce chapitre, nous allons traiter de l'ensemble des points nécessaires pour
réussir un démarrage réseau sur une machine Silicon Graphics ou un serveur
Cobalt. Ce n'est qu'un condensé et n'a pas pour vocation d'être complet. Pour
plus d'informations je vous recommande de lire le
<uri link="/doc/fr/diskless-howto.xml">Guide Gentoo sans disque dur</uri>.
</p>

<p>
Ce dont vous avez besoin&nbsp;: Selon la machine, il vous faudra réunir un
certain nombre de critères pour démarrer en réseau et installer Linux avec
succès.
</p>

<ul>
  <li>
    En Général&nbsp;:
    <ul>
      <li>Un serveur DHCP/BOOTP (ISC DHCPd est recommandé)&nbsp;;</li>
      <li>De la patience (beaucoup).</li>
    </ul>
  </li>
  <li>
    Sur les stations Silicon Graphics&nbsp;:
    <ul>
      <li>Un serveur TFTP (tftp-hpa est recommandé)&nbsp;;</li>
      <li>
        Si vous voulez/devez utiliser une console en série&nbsp;:
        <ul>
          <li>Un câble série MiniDIN8 --&gt; RS-232&nbsp;;</li>
          <li>Un câble Null-modem&nbsp;;</li>
          <li>
            Un terminal compatible VT100 ou ANSI capable de transfert à 9600
            baud.
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    Pour les serveurs Cobalt (PAS l'original Qube)&nbsp;:
    <ul>
      <li>Un serveur NFS&nbsp;;</li>
      <li>Un câble Null-modem&nbsp;;</li>
      <li>
        Un terminal compatible VT100 ou ANSI capable de transfert à 115200
        baud.
      </li>
    </ul>
  </li>
</ul>

<note>
Les machines SGI utilisent un connecteur MiniDIN 8 pour les ports en série.
Apparemment les câbles modem de chez Apple peuvent servir de câbles séries,
mais maintenant que les machines Apple sont équipées de modems internes et de
ports USB, ils commencent à être difficiles à trouver. Un certain nombre de
sites décrivent comment en construire un (google est votre ami). Le site suivant
décrit comment en faire un. C'est en allemand mais il dispose de diagrammes
suffisamment explicites&nbsp;: <uri
link="http://www.arbeitsplatzvernichtung-durch-outsourcing.de/marty44/sgihard.html">http://www.arbeitsplatzvernichtung-durch-outsourcing.de/marty44/sgihard.html</uri>.
</note>

<note>
Pour le terminal vous pouvez utiliser un vrai terminal VT100/ANSI ou un logiciel
d'émulation de terminal exécuté sur PC (comme HyperTerminal, Minicom, seyon,
Telex, xc, screen, comme vous voulez). Peu importe la plate-forme utilisée, du
moment qu'elle dispose d'un port série RS-232 utilisable et des logiciels
nécessaires.
</note>

<note>
Ce guide NE traite PAS des Qube originels. Ces serveurs ne disposent pas de port
série sur la configuration par défaut et il n'est donc pas possible d'installer
Gentoo dessus sans l'aide d'un tournevis et d'une machine hôte sur laquelle se
fera l'installation. Le site suivant dispose d'un guide pour installer Gentoo
sur ces machines&nbsp;: <uri
link="http://www.metzner.org/projects/qube/">http://www.metzner.org/projects/qube/</uri>.
</note>

</body>
</subsection>

<subsection>
<title>Mise en place des serveurs TFTP et DHCP : rappels rapides</title>
<body>

<p>
Bon, maintenant que vous disposez des pièces nécessaires on va pouvoir commencer
les choses sérieuses. Comme mentionné auparavant, ce n'est pas un guide complet,
seulement un ensemble de configurations minimales pour que tout puisse
fonctionner. Vous pouvez au choix utiliser ce chapitre pour réaliser une
configuration à partir de zéro, ou utiliser les suggestions pour modifier votre
configuration actuelle pour qu'elle supporte le démarrage réseau.
</p>

<p>
Notons que les serveurs utilisés ne sont pas obligatoirement sous Gentoo Linux,
vous pouvez bien sûr disposer d'un FreeBSD ou de toute autre plate-forme de
type UNIX. Cependant ce guide supposera que vous utilisez Gentoo Linux.<br/>
Vous pouvez également mettre le serveur TFTP/NFS sur une autre machine que celle
utilisée pour le serveur DHCP.
</p>

<p>
Première étape, la configuration du DHCP. Afin que le démon ISC DHCP réponde
aux requêtes de type BOOTP (obligatoire pour la BOOTROM des SGI et Cobalt), vous
devez tout d'abord permettre le BOOTP dynamique sur le sous-réseau utilisé. Puis
vous devez configurer une entrée sur chaque client qui pointe sur l'image de
démarrage.
</p>

<pre caption="Installer le service DHCP">
# <i>emerge dhcp</i>
</pre>

<p>
Une fois installé vous devez créer le fichier <path>/etc/dhcp/dhcpd.conf</path>.
Voici une configuration de base que vous pouvez modifier pour vos besoins.
</p>

<pre caption="Configuration de dhcpd.conf">
<comment># Indiquer à dhcpd de désactiver les DNS dynamiques.</comment>
<comment># dhcpd refusera de démarrer sans cela..</comment>
ddns-update-style none;

<comment># Créer un sous-réseau :</comment>
subnet <i>192.168.10.0</i> netmask <i>255.255.255.0</i> {
  <comment># Ensemble des adresses disponibles pour vos clients. N'oubliez pas le mot-clef
    'dynamic-bootp' !</comment>
  pool {
    range dynamic-bootp <i>192.168.10.1 192.168.10.254</i>;
  }

  <comment># Serveurs DNS et passerelle par défaut (à modifier selon votre convenance).</comment>
  option domain-name-servers <i>203.1.72.96</i>, <i>202.47.56.17</i>;
  option routers <i>192.168.10.1</i>;

  <comment># Indiquez au serveur DHCP qu'il a autorité sur le sous-réseau.</comment>
  authoritative;

  <comment># Permet l'utilisation de BOOTP sur ce sous-réseau.</comment>
  allow bootp;
}
</pre>

<p>
Avec cette configuration vous pouvez ajouter les clients que vous voulez dans la
configuration du sous-réseau. Nous indiquerons plus tard ce que vous devez
mettre.
</p>

<p>
Seconde étape, installer un serveur TFTP. Pour les besoins de notre guide je
vais restreindre la documentation au démon TFTP tftp-hpa. Je l'utilise sur des
machines SGI, des serveurs Cobalt et des clients de type PXE sans aucun
problème. L'installation et la configuration sont on ne peut plus simple&nbsp;:
</p>

<pre caption="Installer tftp-hpa">
# <i>emerge net-ftp/tftp-hpa</i>
</pre>

<p>
Personnellement j'aime placer le répertoire <path>/tftpboot</path> dans mon
<path>/home</path> où il y a un peu plus de place. C'est optionnel et peut être
configuré dans le fichier <path>/etc/conf.d/in.tftpd</path>. Pour les besoins de
ce guide je supposerai que vous avez gardé la configuration par défaut.
</p>

<p>
Maintenant que tout est bien configuré, passons à quelque chose de plus
intéressant&nbsp;: standardiser notre configuration pour qu'elle convienne à la
machine qui doit démarrer en réseau.
</p>

</body>
</subsection>
</section>
<section>
<title>Démarrer une station SGI sur le réseau</title>
<subsection>
<title>Téléchargement d'une image Netboot</title>
<body>

<p>
Selon le système que vous installez, plusieurs images sont disponibles au
téléchargement. Elles sont toutes nommées selon le type de système et le
processeur pour lesquels elles ont été compilées. Les types de machines sont les
suivants&nbsp;:
</p>

<table>
  <tr>
    <th>Nom de code</th>
    <th>Machine</th>
  </tr>
  <tr>
    <ti>IP22</ti>
    <ti>Indy, *Indigo 2, **Challenge S</ti>
  </tr>
  <tr>
    <ti>IP26</ti>
    <ti>*Indigo 2 Power</ti>
  </tr>
  <tr>
    <ti>IP27</ti>
    <ti>Origin 200, Origin 2000</ti>
  </tr>
  <tr>
    <ti>IP28</ti>
    <ti>*Indigo 2 Impact</ti>
  </tr>
  <tr>
    <ti>IP30</ti>
    <ti>Octane</ti>
  </tr>
  <tr>
    <ti>IP32</ti>
    <ti>O2</ti>
  </tr>
</table>

<note>
(*) Une erreur fréquente&nbsp;: se tromper entre les IRIS Indigo (IP12 avec un
processeur R3000 ou IP20 avec un processeur R4000, aucun des deux ne fonctionne
sous Linux), les Indigo 2 (IP22, qui fonctionne bien sous Linux), les Indigo 2
Power basés sur un processeur R8000 (qui ne fonctionne absolument pas sous
Linux) et les Indigo 2 Impact basés sur un processeur R10000 (IP28, qui est à un
stade très expérimental). Faites bien attention car ce sont des machines très
différentes.
</note>

<note>
(**) Sur les machines Challenge S, le port réseau UTP est supporté par une carte
SCSI WD33C95 qui n'est actuellement pas supportée sous Linux. À cause de cette
limitation, vous devrez utiliser un «&nbsp;transceiver&nbsp;» AUI--&gt;UTP
connecté sur le port AUI.
</note>

<p>
Enfin, dans le nom du fichier, r4k se réfère à la série des processeurs R4000,
r5k aux R5000, rm5k aux RM5000 et r10k aux R10000. Vous trouverez les images
disponibles sur <uri
link="http://dev.gentoo.org/~kumba/mips/netboot">~kumba/mips/netboot</uri>.
</p>

</body>
</subsection>

<subsection>
<title>Configuration DHCP pour un client SGI</title>
<body>

<p>
Une fois que vous avez téléchargé ce fichier, mettez-le simplement dans votre
répertoire <path>/tftpboot</path>. Puis, éditez le fichier
<path>/etc/dhcp/dhcpd.conf</path> et ajoutez-y une entrée pour votre client SGI.
</p>

<note>
Vous aurez probablement à créer le répertoire <path>/tftpboot</path> s'il
n'existe pas déjà.
</note>

<pre caption="Modification de dhcpd.conf pour un station SGI">
subnet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx {
  <comment># ... éléments classiques...</comment>

  <comment># Station SGI... changer 'sgi' par le nom de votre machine SGI.</comment>
  host <i>sgi</i> {

    <comment># Adresse MAC de votre machine SGI. Elle est normalement écrite derrière la</comment>
    <comment># machine ou en dessous.</comment>
    hardware ethernet <i>08:00:69:08:db:77</i>;

    <comment># Serveur TFTP où télécharger l'image de démarrage (par défaut, la même machine</comment>
    <comment># que le serveur DHCP).</comment>
    next-server <i>192.168.10.1</i>;

    <comment># Adresse IP à donner à la machine SGI.</comment>
    fixed-address <i>192.168.10.3</i>;

    <comment># Fichier que la PROM doit télécharger pour démarrer.</comment>
    filename "<i>/gentoo-r4k.img</i>";
  }
}
</pre>

</body>
</subsection>
<subsection>
<title>Options du noyau</title>
<body>

<p>
C'est presque fini mais il reste à faire quelques petites modifications pour que
tout soit parfait. Ouvrez une console avec les privilèges administrateurs et
entrez les commandes suivantes&nbsp;:
</p>

<pre caption="Quelques corrections pour les machines SGI pour que le TFTP fonctionne correctement">
<comment>(Désactiver « Path Maximum Transfer Unit », sinon la PROM SGI ne trouvera pas le
noyau)</comment>
# <i>echo 1 &gt; /proc/sys/net/ipv4/ip_no_pmtu_disc</i>

<comment>(Indiquer l'intervalle des ports utilisables par la PROM SGI.)</comment>
# <i>echo "2048 32767" &gt; /proc/sys/net/ipv4/ip_local_port_range</i>
</pre>

<p>
Cela devrait être suffisant pour permettre au serveur Linux de bien fonctionner
avec la PROM de votre machine SGI.
</p>

</body>
</subsection>
<subsection>
<title>Démarrer les démons</title>
<body>

<p>
Vous êtes désormais prêt à démarrer vos démons. Entrez les lignes
suivantes&nbsp;:
</p>

<pre caption="Démarrage des serveurs DHCP et TFTP">
# <i>/etc/init.d/dhcp start</i>
# <i>/etc/init.d/in.tftpd start</i>
</pre>

<p>
Si tout se passe bien, vous devriez pouvoir maintenant démarrer votre station
SGI et continuer à suivre le guide. Si le serveur DHCP ne démarre pas pour une
raison ou pour une autre, essayez de lancer <c>dhcpd</c> en ligne de commande
pour voir ce qu'il vous donne comme indications. Si tout va bien il devrait
simplement se dupliquer en tâche de fond. Sinon, il vous retournera
«&nbsp;exiting.&nbsp;» juste après vous avoir donné les raisons de ce problème.
</p>

<p>
une bonne méthode pour vérifier si le serveur tftp fonctionne effectivement est
de taper la commande suivante (si vous obtenez un résultat proche de celui
mentionné ci-dessous c'est que tout va bien)&nbsp;:
</p>

<pre caption="Vérifiez que TFTPd fonctionne correctement">
# <i>netstat -al | grep ^udp</i>
udp        0      0 *:bootpc                *:*
udp        0      0 *:631                   *:*
udp        0      0 *:xdmcp                 *:*
udp        0      0 *:tftp                  *:* <comment>&lt;-- (Cherchez cette ligne.)</comment>
</pre>

</body>
</subsection>
<subsection>
<title>Démarrer depuis le réseau sur une machine SGI</title>
<body>

<p>
Maintenant que tout est en place, le DHCP et le TFTP, vous pouvez démarrer votre
machine SGI. Quand vous voyez à l'écran «&nbsp;Running power-on
diagnostics&nbsp;», cliquez soit sur «&nbsp;Stop For Maintenance&nbsp;» ou tapez
Échap. Vous obtiendrez alors à l'écran un menu comme celui présenté plus bas.
Tapez la commande indiquée ci-dessous&nbsp;:
</p>

<pre caption="Menu de maintenance de la PROM SGI">
        Running power-on diagnostics

System Maintenance Menu

1) Start System
2) Install System Software
3) Run Diagnostics
4) Recover System
5) Enter Command Monitor

Option? <i>5</i>
Command Monitor. Type "exit" to return to the menu.
&gt;&gt; <i>bootp(): root=/dev/ram0</i>
</pre>

<p>
À partir de là, la machine devrait commencer à télécharger l'image, puis,
quelque chose comme 20 secondes plus tard, elle devrait commencer à démarrer
sous Linux. Si tout va bien, vous devriez alors obtenir le shell <c>ash</c> de
Busybox comme indiqué plus bas. Vous pouvez alors commencer à
<uri link="?part=1&amp;chap=3">Configurer le réseau</uri>.
</p>

<pre caption="Quand tout va bien...">
init started:  BusyBox v1.00-pre10 (2004.04.27-02:55+0000) multi-call binary

Gentoo Linux; http://www.gentoo.org/
 Copyright 2001-2004 Gentoo Technologies, Inc.; Distributed under the GPL

 Gentoo/MIPS Netboot for Silicon Graphics Machines
 Build Date: April 26th, 2004

 * To configure networking, do the following:

 * For Static IP:
 * /bin/net-setup &lt;IP Address&gt; &lt;Gateway Address&gt; [telnet]

 * For Dynamic IP:
 * /bin/net-setup dhcp [telnet]

 * If you would like a telnetd daemon loaded as well, pass "telnet"
 * As the final argument to /bin/net-setup.

Please press Enter to activate this console.
</pre>

</body>
</subsection>
<subsection>
<title>Problèmes et solutions</title>
<body>

<p>
Si votre machine se bloque et refuse de télécharger son image, cela peut venir
de deux choses&nbsp;: ou bien vous vous êtes trompé quelque part, ou alors il
faut la persuader gentiment de fonctionner correctement (non, pas à coups de
marteau&nbsp;!). Voici une liste de ce que vous pouvez vérifier&nbsp;:
</p>

<ul>
  <li>
    Le serveur dhcpd attribue une adresse IP à votre machine SGI. Vous devriez
    avoir des messages de requête BOOTP dans vos fichiers de journalisation
    système. <c>tcpdump</c> peut également vous être utile dans ce cas.
  </li>
  <li>
    Les droits d'accès au répertoire de tftp sont-ils corrects&nbsp;?
    <path>/tftpboot</path> doit être accessible en lecture pour tous.
  </li>
  <li>
    Jetez un œil dans les fichiers de journalisation système pour voir ce que
    vous dit le serveur tftp (peut-être des erreurs&nbsp;?).
  </li>
<!--
  Je pense qu'on peut écarter cette astuce...<br/>
  NdT&nbsp;: cela dit, elle peut avoir un certain impact sur la machine, à
  essayer en dernier recours :)
  <li>
    Priez devant votre peluche Tux (cela pourrait fonctionner, mais ce n'est pas
    une technique officiellement supportée pour la résolution de problèmes)
  </li>-->
</ul>

<p>
Si vous avez tout bien vérifié sur votre serveur et que vous continuez à avoir
des problèmes de délais de réponse dépassés, essayez de taper sur votre console
SGI&nbsp;:
</p>

<pre caption="Essayer de forcer le bon fonctionnement de la PROM SGI">
&gt;&gt; <i>resetenv</i>
&gt;&gt; <i>unsetenv netaddr</i>
&gt;&gt; <i>unsetenv dlserver</i>
&gt;&gt; <i>init</i>
&gt;&gt; <i>bootp(): root=/dev/ram0</i>
</pre>

</body>
</subsection>
</section>

<section>
<title>Démarrer depuis le réseau sur un serveur Cobalt</title>
<subsection>
<title>Vue d'ensemble sur la procédure de démarrage réseau</title>
<body>

<p>
Contrairement aux machines SGI, les serveurs Cobalt utilisent le protocole NFS
pour effectuer le transfert du noyau sur lequel démarrer. Vous démarrez la
machine en maintenant appuyées les boutons de flèches gauche et droite lors du
démarrage de la machine. Elle essayera alors d'obtenir une adresse IP en faisant
une requête BOOTP, montera le répertoire <path>/nfsroot</path> depuis le serveur
grâce à NFS, puis essayera de télécharger et démarrer sur le fichier
<path>vmlinux_raq-2800.gz</path> qui doit être un binaire ELF standard.
</p>

<p>
Malheureusement la BOOTROM des Cobalt ne nous indique rien concernant cette
procédure donc ce fichier DOIT être dans le répertoire <path>/nfsroot</path> et
doit faire 675Ko maximum. Dans ce guide nous utiliserons
<uri link="http://www.colonel-panic.org/cobalt-mips/">CoLo</uri> pour nous
permettre de démarrer sur des noyaux de taille supérieure à la limite normale.
CoLo supporte également les disques RAM embarqués donc on n'a pas besoin d'un
système de fichiers complet dans notre répertoire <path>/nfsroot</path>.
</p>

</body>
</subsection>

<subsection>
<title>Télécharger une image de démarrage en réseau</title>
<body>

<p>
Sur <uri
link="http://dev.gentoo.org/~kumba/mips/cobalt/netboot/">http://dev.gentoo.org/~kumba/mips/cobalt/netboot/</uri>,
vous trouverez les images nécessaires pour démarrer en réseau un serveur Cobalt.
Les fichiers dont vous avez besoin s'appellent
<path>cobalt-netboot-YYYYMMDD.img.gz</path> (choisir le plus récent et mettez-le
dans votre répertoire <path>/nfsroot</path>). Pour simplifier les choses,
renommez-le en <path>gentoo-cobalt.img.gz</path>. Nous supposerons désormais que
vous l'avez renommé.
</p>

<p>
Une fois que c'est fait, allez télécharger sur <uri
link="http://www.colonel-panic.org/cobalt-mips/">http://www.colonel-panic.org/cobalt-mips/</uri>
la dernière version du chargeur de démarrage CoLo. Désarchivez-le. Dans le
répertoire <path>colo-1.XX/binaries</path> ainsi créé, vous devriez trouver un
fichier nommé <path>colo-chain.elf</path>. Compressez-le à l'aide de
<c>gzip</c> et mettez le dans le répertoire <path>/nfsroot</path>. Puis,
renommez le fichier en <path>vmlinux_raq-2800.gz</path>. Parfois, vous devez
aussi créer un lien symbolique <path>boot</path> vers <path>/nfsroot</path>.
Vous pouvez faire tout ceci avec les commandes&nbsp;:
</p>

<note>
Les RaQ1 et Qube 2700 utilisent <path>vmlinux.gz</path> au lieu de
<path>vmlinux_raq-2800.gz</path>.
</note>

<pre caption="Mettre CoLo dans le répertoire nfsroot">
# <i>tar -xzvf colo-1.XX.tar.gz</i>
# <i>cd colo-1.XX/binaries</i>

<comment>(Pour Qube 2800, RaQ2, etc.)</comment>
# <i>gzip -9vc colo-chain.elf &gt; /nfsroot/vmlinux_raq-2800.gz</i>

<comment>(Pour RaQ1 et Qube 2700)</comment>
# <i>gzip -9vc colo-chain.elf &gt; /nfsroot/vmlinux.gz</i>
# <i>cd /nfsroot</i>
# <i>ln . boot</i>
</pre>

<note>
Si la dernière version de CoLo échoue, vous devriez essayer une version moins
récente. Les versions 1.16 et antérieures fonctionnent.
</note>

</body>
</subsection>

<subsection>
<title>Configuration du serveur NFS</title>
<body>

<p>
Dans la mesure où les Cobalt utilisent NFS pour télécharger l'image de
démarrage, vous devez exporter le répertoire <path>/nfsroot</path> sur votre
serveur. Si vous ne l'avez pas déjà fait, vous devrez installer le paquet
net-fs/nfs-utils.
</p>

<pre caption="Installation de nfs-utils">
# <i>emerge net-fs/nfs-utils</i>
</pre>

<p>
Maintenant que c'est fait, ajoutez la ligne suivante à votre fichier
<path>/etc/exports</path>. Vous pouvez changer les restrictions d'accès si vous
voulez.
</p>

<pre caption="Exporter le répertoire /nfsroot">
/nfsroot      *(ro,sync)
</pre>

<p>
Il vous faut maintenant démarrer votre serveur NFS&nbsp;:
</p>

<pre caption="Démarrer le serveur NFS">
# <i>/etc/init.d/nfs start</i>
</pre>

<p>
Si le serveur NFS fonctionnait déjà, vous pouvez lui demander de relire le
fichier <c>exports</c> avec la commande <c>exportfs</c>.
</p>

<pre caption="Exporter un nouveau répertoire">
# <i>exportfs -av</i>
</pre>

</body>
</subsection>

<subsection>
<title>Configuration du serveur DHCP pour une machine Cobalt</title>
<body>

<p>
La partie DHCP est assez simple et classique. Ajoutez les lignes suivantes à
votre fichier <path>/etc/dhcp/dhcpd.conf</path>&nbsp;:
</p>

<pre caption="Modification du fichier dhcpd.conf pour un serveur Cobalt">
subnet xxx.xxx.xxx.xxx netmask xxx.xxx.xxx.xxx {
  <comment># ... éléments classiques...</comment>

  <comment># Configuration pour un serveur Cobalt</comment>
  <comment># Indiquez le nom de la machine ici :</comment>
  host <i>qube</i> {
    <comment># Chemin vers le répertoire nfsroot.</comment>
    <comment># Il est utilisé principalement pour quand vous utilisez l'option de</comment>
    <comment># démarrage via TFTP avec CoLo.</comment>
    option root-path "/nfsroot";

    <comment># Adresse MAC de la carte ethernet du serveur Cobalt.</comment>
    hardware ethernet <i>00:10:e0:00:86:3d</i>;

    <comment># Serveur sur lequel télécharger l'image.</comment>
    next-server <i>192.168.10.1</i>;

    <comment># Adresse IP à attribuer au serveur Cobalt.</comment>
    fixed-address <i>192.168.10.2</i>;

    <comment># Fichier image à télécharger.</comment>
    <comment># Encore une fois configuration pour l'utilisation de CoLo.</comment>
    filename "<i>gentoo-cobalt.img.gz</i>";
  }
}
</pre>

</body>
</subsection>

<subsection>
<title>Démarrez vos démons...</title>
<body>

<p>
Vous devriez maintenant pouvoir démarrer vos démons. Exécutez les lignes
suivantes&nbsp;:
</p>

<pre caption="Démarrer les démons DHCP et NFS">
# <i>/etc/init.d/dhcp start</i>
# <i>/etc/init.d/nfs start</i>
</pre>

<p>
Si tout va bien, vous devriez pouvoir démarrer votre station de travail et
continuer à suivre le guide. Si le serveur DHCP ne démarre pas pour une
raison ou pour une autre, essayez de lancer <c>dhcpd</c> en ligne de commande
pour voir ce qu'il vous donne comme indications. Si tout va bien il devrait
simplement se dupliquer en tâche de fond. Sinon, il vous retournera
«&nbsp;exiting.&nbsp;» juste après vous avoir donné les raisons de ce problème.
</p>

</body>
</subsection>

<subsection>
<title>Démarrer en réseau la machine Cobalt</title>
<body>

<p>
Bon, maintenant que tout fonctionne bien, le DHCP comme le NFS vous pouvez
allumer votre machine Cobalt. Branchez votre câble null modem et configurez le
terminal série pour utiliser une configuration 115&nbsp;200 bauds, 8 bits, sans
parité, 1 bit d'arrêt et une émulation VT100. Une fois que c'est fait, maintenez
appuyées les boutons de flèches gauche et droite à la fois lors du démarrage de
la machine.
</p>

<p>
Si tout va bien, l'écran LCD à l'arrière de la machine devrait afficher
«&nbsp;Net Booting&nbsp;» et vous devriez voir l'activité réseau, suivie de près
par la mise en place de CoLo. En utilisant le panneau de contrôle à l'arrière de
la machine, descendez dans le menu jusqu'à obtenir «&nbsp;Boot Shell&nbsp;» et
appuyez sur Entrée. Sur la console en série vous devriez alors obtenir un invite
de commandes comme celui présenté ci-dessous&nbsp;:
</p>

<note>
L'option de démarrage via NFS devrait fontionner avec des versions récentes de
CoLo. Si ce n'est pas le cas, lisez ce qui suit.
</note>

<pre caption="Démarrage de CoLo jusqu'à l'invite de commande">
[ "CoLo" v1.13 ]
stage2: 87fb0000-88000000
pci: unit type &lt;Qube2&gt;
tulip: {00:10:e0:00:86:3d}
ide: resetting
boot: running boot menu
&gt;
</pre>

<p>
Tout d'abord, indiquez à la machine de récupérer une adresse via DHCP. Tapez
<c>dhcp</c> à l'invite de commande.
</p>

<pre caption="Récupérer une adresse IP avec DHCP">
&gt; <i>dhcp</i>
net: interface up
dhcp: DISCOVER
dhcp: OFFER 10.0.0.1 &lt;-- 192.168.10.254
dhcp: REQUEST
arp: sent request for 192.168.10.254
udp: no matching socket 192.168.5.1:67 --&gt; 10.0.0.1:68
arp: resolved 192.168.10.254
udp: no matching socket 192.168.5.1:67 --&gt; 10.0.0.1:68
dhcp: DISCOVER
dhcp: OFFER 10.0.0.1 &lt;-- 192.168.10.254
dhcp: REQUEST
udp: no matching socket 192.168.5.1:67 --&gt; 10.0.0.1:68
dhcp: ACK
net: interface down
net: interface up
  address     10.0.0.1
  netmask     255.255.255.0
  gateway     10.0.0.254
  name server 192.168.5.1
</pre>

<p>
NOTE&nbsp;: si vous avez un réseau Windows, vous aurez probablement des messages
supplémentaires de type <c>udp: no matching socket</c>. Ce sont des réponses
aux requêtes réseaux en broadcast sur les ports que CoLo ne reconnaît pas. Même
s'ils sont énervants, ces messages sont absolument inoffensifs.
</p>

<pre caption="Messages d'erreur « no matching socket »">
udp: no matching socket 10.0.0.254:138 --&gt; 10.0.0.255:138
udp: no matching socket 10.0.0.254:138 --&gt; 10.0.0.255:138
udp: no matching socket 10.0.0.253:1062 --&gt; 10.0.0.255:137
udp: no matching socket 10.0.0.253:1062 --&gt; 10.0.0.255:137
</pre>

<p>
Bon, la prochaine étape est de demander au serveur Cobalt de télécharger le
noyau&nbsp;:
</p>

<pre caption="Télécharger le noyau">
&gt; <i>nfs 10.0.0.254 /nfsroot gentoo.img.gz</i>
arp: sent request for 10.0.0.254
arp: resolved 10.0.0.254
udp: no matching socket 10.0.0.253:1062 --&gt; 10.0.0.255:137
nfs: mounted "/nfsroot"
nfs: lookup "gentoo.img.gz"
nfs: mode &lt;0100644&gt;
4651KB loaded (1240KB/sec)
0048ada0 4763040t
</pre>

<p>
Et voilà, une fois téléchargé, vous n'avez plus qu'à lui demander de démarrer.
</p>

<pre caption="Lancement du noyau">
&gt; <i>execute</i>
elf: 80080000 &lt;-- 00001000 6586368t + 192624t
elf: entry 80328040
net: interface down
CPU revision is: 000028a0
FPU revision is: 000028a0
Primary instruction cache 32kB, physically tagged, 2-way, linesize 32 bytes.
Primary data cache 32kB 2-way, linesize 32 bytes.
Linux version 2.4.26-mipscvs-20040415 (root@khazad-dum) (gcc version 3.3.3...
Determined physical RAM map:
 memory: 08000000 @ 00000000 (usable)
Initial ramdisk at: 0x80392000 (3366912 bytes)
On node 0 totalpages: 32768
zone(0): 32768 pages.
zone(1): 0 pages.
zone(2): 0 pages.
Kernel command line: console=ttyS0,115200 root=/dev/ram0
Calibrating delay loop... 249.85 BogoMIPS
Memory: 122512k/131072k available (2708k kernel code, 8560k reserved, 3424k dat)
</pre>

<p>
Si tout va bien, vous devriez alors obtenir le shell <c>ash</c> de
Busybox comme indiqué plus bas. Vous pouvez alors commencer à
<uri link="?part=1&amp;chap=3">Configurer le réseau</uri>.
</p>

<pre caption="Quand tout se passe bien...">
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 280k freed
init started:  BusyBox v1.00-pre10 (2004.04.27-02:55+0000) multi-call binary

Gentoo Linux; http://www.gentoo.org/
 Copyright 2001-2004 Gentoo Technologies, Inc.; Distributed under the GPL

 Gentoo/MIPS Netboot for Cobalt Microserver Machines
 Build Date: April 26th, 2004

 * To configure networking, do the following:

 * For Static IP:
 * /bin/net-setup &lt;IP Address&gt; &lt;Gateway Address&gt; [telnet]

 * For Dynamic IP:
 * /bin/net-setup dhcp [telnet]

 * If you would like a telnetd daemon loaded as well, pass "telnet"
 * As the final argument to /bin/net-setup.

Please press Enter to activate this console.
</pre>

</body>
</subsection>

<subsection>
<title>Problèmes et solutions</title>
<body>

<p>
Si votre machine se bloque et refuse de télécharger son image cela peut venir
de deux choses&nbsp;: ou bien vous vous êtes trompé quelque part, ou alors il
faut la persuader gentiment de fonctionner correctement (non, pas à coups de
marteau&nbsp;!). Voici une liste de ce que vous pouvez vérifier&nbsp;:
</p>

<ul>
  <li>
    Le serveur dhcpd attribue una adresse IP à votre machine Cobalt. Vous
    devriez avoir des messages de requête BOOTP dans vos fichiers de
    journalisation système. <c>tcpdump</c> peut également vous être utile dans
    ce cas.
  </li>
  <li>
    Les droits d'accès au répertoire /nfsroot sont-ils corrects&nbsp;?
    <path>/nfsroot</path> doit être accessible en lecture pour tous.
  </li>
  <li>
    Assurez-vous que le serveur NFS fonctionne et exporte bien le répertoire
    <path>/nfsroot</path>. Vous pouvez le vérifier avec la commande <c>exportfs
    -v</c> sur le serveur.
  </li>
</ul>
</body>
</subsection>
</section>
<!--
  
  Chapitre mis en commentaire en attendant plus d'informations

<section>
<title>LiveCD Gentoo/MIPS</title>
<subsection>
<title>Vue d'ensemble</title>
<body>

<p>
Sur les machines Silicon Graphics il est possible de démarrer depuis un CD-ROM
pour isntaller un système d'exploitation. C'est d'ailleurs comme ça qu'on peut
installer IRIX par exemple. Récemment des images de CD-ROM d'installation pour
Gentoo ont été rendues disponibles.
</p>

<p>
Pour le moment le LiveCD Gentoo/MIPS ne fonctionne que sur les stations SGI
Indy, Indigo 2 et O2 équipées de processeurs R4000 ou R5000 mais le support
d'autres plate-formes devrait être possible dans le futur.
</p>

<p>
Vous pouvez trouver les images de LiveCD en libre téléchargement sur votre
miroir Gentoo favori dans le répertoire <path>experimental/mips/livecd</path>.
</p>

<warn>
Ces CD-ROM sont au stade expérimental actuellement. Ils peuvent fonctionner ou
non. Vous pouvez faire des rapports de bogue pour nous signaler une utilisation
réussie ou échouée sur le
<uri link="http://bugs.gentoo.org">Bugzilla</uri>, sur
<uri link="http://forums.gentoo.org/viewtopic.php?t=242518">les forums</uri> ou
sur le channel IRC <c>#gentoo-mips</c>. Nous aimerions beaucoup avoir des
retours d'expérience.
</warn>

</body>
</subsection>

<subsection>
<title>Graver un LiveCD</title>
<body>

<p>
Il est important de noter que la PROM des SGI ne comprend pas le format
ISO9660 et ne connaît rien du standard de démarrage El Torito. Ces images de
CD-ROM ont été construites comme des label disque SGI avec une image de
démarrage dans l'en-tête du volume SGI, exactement comme si il s'agissait d'un
disque dur. Du coup il faut y faire attention lorsque vous graver l'image de
CD-ROM.
</p>

<p>
Ci-dessous vous trouverez un exemple de commande qui suppose une vitesse de
gravure de 24x sur un graveur IDE. Si vous avez un graveur SCSI vous pouvez
changer le paramètre <c>dev</c> pour qu'il convienne à votre configuration. De
même vous pouvez changer le paramètre <c>speed</c>. Si vous rencontrez des
problèmes, supprimez simplement ce paramètre.
</p>

<pre caption="Graver l'image avec cdrecord">
# <i>bzip2 -d mips-livecd-prototype-rc2-20041027.img.bz2</i>
# <i>cdrecord -vv -pad speed=24 dev=ATAPI:0,0,0 -tao mips-livecd-prototype-rc2-20041027.img</i>
</pre>

<note>
Il doit être possible de graver ces images CD-ROM sous Windows si vous utilisez
un logiciel de gravure qui grave l'image telle qu'elle est. Cependant personne
n'a à ce jour réussi à créer un disque qui fonctionne en passant par Windows.
</note>

<note>
Si vous ne savez pas quoi mettre pour le paramètre <c>dev</c> lancez la commande
<c>cdrecord -scanbus</c> en tant que root. Elle vous indiquera où trouver le
graveur.
</note>

</body>
</subsection>
</section>
-->
</sections>
