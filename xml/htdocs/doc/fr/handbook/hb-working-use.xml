<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/handbook/hb-working-use.xml,v 1.1 2004/01/09 15:10:01 neysx Exp $ -->

<sections>
<section>
<title>Que sont les paramètres USE ?</title>
<subsection>
<title>Les notions sous-jacentes aux paramètres USE</title>
<body>

<p>
Losque vous installez Gentoo (ou n'importe quelle autre distribution, voire
système d'exploitation, en fait), vous faites des choix qui dépendent de
l'environnement dans lequel vous travaillez. La configuration d'un serveur est
différente de celle d'une station de travail. Une machine destinée aux jeux
diffère d'une station de travail pour du rendu 3D.
</p>

<p>
Cela s'applique non seulement au choix des paquets que vous comptez installer,
mais aussi aux fonctionnalités que chaque paquet devra supporter. Si vous
n'avez pas besoin d'OpenGL, pourquoi prendre la peine d'installer OpenGL et de
construire la plupart de vos paquets avec du support OpenGL&#x00a0;? Si vous ne
souhaitez pas utiliser KDE, pourquoi compiler des paquets avec le support KDE
alors qu'ils fonctionneraient parfaitement sans&#x00a0;?
</p>

<p>
Pour aider les utilisateurs à déterminer ce qu'ils veulent installer ou activer,
nous souhaitions que l'utilisateur spécifie son environnement de manière simple.
Il est ainsi obligé de décider ce qu'il veut vraiment, et cela facilite la tâche
de Portage, notre gestionnaire de paquets, pour prendre les décisions utiles.
</p>

</body>
</subsection>
<subsection>
<title>Définition des paramètres USE</title>
<body>

<p>
C'est ici qu'interviennent les paramètres USE. Un tel paramètre est un mot-clé
qui définit le support et les dépendances pour un concept donné. Si vous 
définissez un paramètre USE donné, Portage saura que vous voulez avoir le support
correspondant au mot-clé choisi. Bien entendu, cela affecte aussi les
dépendances des paquets.
</p>

<p>
Considérons un exemple spécifique : le mot-clé <c>kde</c>. Si vous n'avez pas ce
mot-clé dans votre variable <c>USE</c>, tous les paquets qui offrent un support 
<e>optionnel</e> pour KDE seront compilés <e>sans</e> ce support. Tous les
paquets qui possèdent des dépendances KDE <e>optionnelles</e> seront installés
<e>sans</e> installer les bibliothèques KDE (en tant que dépendances). Si vous
avez le mot-clé <c>kde</c>, alors ces paquets seront compilés <e>avec</e> le
support KDE et les bibliothèques KDE seront installées en tant que dépendances.
</p>

<p>
Définir correctement ces mots-clés vous donnera finalement un système adapté
spécifiquement à vos besoins.
</p>

</body>
</subsection>
<subsection>
<title>Quels sont les paramètres USE disponibles ?</title>
<body>

<p>
On distingue deux types de paramètres USE : les paramètres <e>globaux</e> et
<e>locaux</e>.
</p>

<ul>
  <li>
    Un paramètre USE <e>global</e> est utilisé par plusieurs paquets dans
    l'ensemble du système. C'est ce que la plupart des gens considèrent comme
    les paramètres USE.
  </li>
  <li>
    Un paramètre USE <e>local</e> n'est utilisé que par un seul paquet pour des
    décisions spécifiques à ce paquet.
  </li>
</ul>

<p>
Une liste des paramètres USE peut être trouvée <uri
link="/dyn/use-index.xml">en ligne</uri> ou localement dans 
<path>/usr/portage/profiles/use.desc</path>. Un court extrait (très incomplet)&#x00a0;:
</p>

<!-- L'extrait du fichier sera en anglais, sniff
<pre caption="Court extrait des paramètres USE disponibles">
gtk     - Ajoute le support pour x11-libs/gtk+ (le Toolkit GIMP)
gtk2    - Utilise gtk+-2.0.0 au lieu de gtk+-1.2 si le programme supporte les deux
gtkhtml - Ajoute le support pour gnome-extra/gtkhtml
guile   - Ajoute le support pour dev-util/guile (interpréteur pour Scheme)
icc     - Utilise le compilateur C++ Intel, si le paquet le permet
icc-pgo - Active la génération ou l'utilisation de données PGO si icc est utilisé
imap    - Ajoute le support pour IMAP
</pre>
-->
<pre caption="Court extrait des paramètres USE disponibles">
gtk     - Adds support for x11-libs/gtk+ (The GIMP Toolkit)
gtk2    - Use gtk+-2.0.0 over gtk+-1.2 in cases where a program supports both.
gtkhtml - Adds support for gnome-extra/gtkhtml
guile   - Adds support for dev-util/guile (interpreter for Scheme)
icc     - Use the Intel C++ Compiler if the package supports it
icc-pgo - Enable PGO data generation or use when use icc.
imap    - Adds support for IMAP
</pre>

</body>
</subsection>
</section>
<section>
<title>Utiliser les paramètres USE</title>
<subsection>
<title>Déclarer des paramètres USE permanents</title>
<body>

<p>
Nous allons maintenant vous expliquer comment déclarer des paramètres USE, en 
espérant que vous soyez convaincu de leur importance.
</p>

<p>
Comme mentionné plus haut, tous les paramètres USE sont déclarés dans la
variable <c>USE</c>. Pour permettre aux utilisateurs de trouver et choisir
facilement les paramètres USE, nous fournissons à l'origine une configuration
<e>par défaut</e> de USE. Cette configuration est un ensemble de paramètres
USE dont nous pensons qu'ils sont communément employés par les utilisateurs
Gentoo. Cette configuration par défaut est déclarée dans le fichier 
<path>/etc/make.profile/make.defaults</path>. Jetons-y un coup d'oeil :
</p>

<pre caption="Variable USE de /etc/make.profile/make.defaults">
USE="x86 oss apm arts avi berkdb crypt cups encode foomaticdb gdbm gif gpm gtk 
     imlib jpeg kde gnome libg++ libwww mad mikmod motif mpeg ncurses nls 
     oggvorbis opengl pam pdflib png python qt quicktime readline sdl slang 
     spell ssl svga tcpd truetype X xml2 xmms xv zlib"
</pre>

<p>
Comme vous pouvez le voir, cette variable contient déjà un bon nombre de
mots-clés. Ne modifiez <b>pas</b> le fichier 
<path>/etc/make.profile/make.defaults</path> pour adapter la variable <c>USE</c> 
à vos besoins&#x00a0;: les changements effectués dans ce fichier seront effacés lorsque 
vous mettrez Portage à jour&#x00a0;!
</p>

<p>
Pour modifier cette configuration par défaut, vous devrez ajouter ou enlever des
mots-clés dans la variable <c>USE</c>. Cela est fait de manière globale en
définissant la variable <c>USE</c> dans <path>/etc/make.conf</path>. Dans cette 
variable, vous ajouterez les paramètres USE que vous désirez et
enlèverez ceux que vous ne voulez pas. Cette dernière action est réalisée en
préfixant le mot-clé d'un signe moins ("-").
</p>

<p>
Par exemple, pour enlever le support pour KDE et QT, et ajouter le support pour
ldap, le <c>USE</c> suivant peut être défini dans <path>/etc/make.conf</path> :
</p>

<pre caption="Exemple de configuration USE dans /etc/make.conf">
USE="-kde -qt ldap"
</pre>

</body>
</subsection>
<subsection>
<title>Déclarer des paramètres USE temporaires</title>
<body>

<p>
Il peut arriver que vous ne souhaitiez définir un paramètre USE donné qu'en une
seule occasion. Plutôt qu'éditer <path>/etc/make.conf</path> deux fois (pour
faire puis défaire les changements), vous pouvez vous contenter de déclarer la
variable USE comme une variable d'environnement.
</p>

<p>
Par exemple, nous allons retirer temporairement le support java de notre
configuration USE pendant l'installation de mozilla.
</p>

<note>
La commande <c>emerge</c> sera décrite plus en détail dans 
<uri link="?part=2&amp;chap=2">Portage et les logiciels</uri>.
</note>

<pre caption="Utilisation de USE comme une variable d'environnement">
# <i>USE="-java" emerge mozilla</i>
</pre>

</body>
</subsection>
<subsection>
<title>Héritage des paramètres USE</title>
<body>

<p>
Certains paquets ne se contentent pas de lire les paramètres USE, mais en
définissent eux-mêmes. Lorsque vous installez un tel paquet, le paramètre USE
qu'il fournit est ajouté à votre configuration USE. Pour voir la liste des
paquets qui fournissent un nouveau paramètre USE, consultez 
<path>/etc/make.profile/use.defaults</path> :
</p>

<pre caption="Extrait de /etc/make.profile/use.defaults">
gnome           gnome-base/gnome
gtk             x11-libs/gtk+
qt              x11-libs/qt
kde             kde-base/kdebase
motif           x11-libs/openmotif
</pre>

</body>
</subsection>
<subsection>
<title>Ordre de priorité</title>
<body>

<p>
Les différentes configurations de USE se conforment évidemment à un certain ordre
de priorité. Vous ne souhaitez sans doute pas déclarer <c>USE="-java"</c> pour
vous rendre compte après coup que <c>java</c> était déclaré malgré tout. Les
priorités dans les déclarations USE sont ordonnées comme suit (le premier a la
plus faible priorité) : 
</p>

<ol>
  <li>
    Déclaration par défaut dans <path>/etc/make.profile/make.defaults</path>
  </li>
  <li>
    Déclaration héritée si un paquet de 
    <path>/etc/make.profile/use.defaults</path> est installé
  </li>
  <li>
    Déclaration par l'utilisateur dans <path>/etc/make.conf</path>
  </li>
  <li>
    Déclaration par l'utilisateur comme une variable d'environnement
  </li>
</ol>

<p>
Pour voir la configuration finale de <c>USE</c> telle qu'elle est vue par
Portage, exécutez <c>emerge info</c>. Cela listera toutes les variables
significatives (dont la variable <c>USE</c>) avec leur contenu tel qu'il est vu
par Portage.
</p>

<pre caption="Exécuter emerge info">
# <i>emerge info</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Paramètres USE spécifiques à un paquet</title>
<subsection>
<title>Voir les paramètres USE utilisables</title>
<body>

<p>
Dans le prochain chapitre sur <uri link="?part=2&amp;chap=2">Portage et
logiciels</uri>, nous expliquerons comment gérer les logiciels installés et
comment utiliser <c>emerge</c>. Toutefois, nous allons vous donner un avant-goût
de <c>emerge</c> en vous montrant comment voir les paramètres USE qu'un paquet
peut utiliser.
</p>

<p>
Prenons l'exemple de <c>mozilla</c> : à quels paramètres USE est-il sensible ?
Pour le savoir, nous utilisons <c>emerge</c> avec les options <c>--pretend</c>
(ne rien faire réellement) et <c>--verbose</c> (afficher plus d'informations) : 
</p>

<pre caption="Afficher les paramètres USE utilisables">
# <i>emerge --pretend --verbose mozilla</i>
These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild  N    ] net-www/mozilla-1.5-r1 +java +crypt -ipv6 -gtk2 +ssl +ldap 
+gnome -debug +mozcalendar -mozaccess -mozxmlterm -moznoirc -moznomail
-moznocompose -moznoxft 
</pre>

<p>
<c>emerge</c> n'est pas le seul outil utilisable à cette fin. En effet, nous
disposons d'un outil dédié pour obtenir des informations sur les paquets. Il
s'appelle <c>etcat</c> et appartient au paquet <c>gentoolkit</c>. Commencez par
installer <c>gentoolkit</c> : 
</p>

<pre caption="Installer gentoolkit">
# <i>emerge --usepkg gentoolkit</i>
</pre>

<p>
Exécutez maintenant <c>etcat</c> avec l'argument <c>uses</c> pour afficher les
paramètres USE d'un paquet donné. Par exemple, pour le paquet <c>gnumeric</c> :
</p>

<pre caption="Utiliser etcat pour afficher les paramètres USE">
# <i>etcat uses gnumeric</i>
[ Colour Code : <i>set</i> <comment>unset</comment> ]
[ Legend      : (U) Col 1 - Current USE flags        ]
[             : (I) Col 2 - Installed With USE flags ]

 U I [ Found these USE variables in : app-office/gnumeric-1.2.0 ]
 - - <comment>libgda</comment>  : Adds GNU Data Access (CORBA wrapper) support for gnumeric
 - - <comment>gnomedb</comment> : unknown
 + + <i>python</i>  : Adds support/bindings for the Python language
 + + <i>bonobo</i>  : Adds support for gnome-base/bonobo (Gnome CORBA interfaces)
</pre>

</body>
</subsection>
</section>
</sections>
