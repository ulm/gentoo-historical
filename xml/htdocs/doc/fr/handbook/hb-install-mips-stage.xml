<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/handbook/hb-install-mips-stage.xml,v 1.1 2006/03/07 17:46:50 neysx Exp $ -->

<sections>

<version>1.0</version>
<date>2006-02-27</date>

<section>
<title>Installer une archive «&nbsp;stage&nbsp;»</title>
<subsection>
<title>Régler la date et l'heure</title>
<body>

<p>
Avant de poursuivre, vous devez régler l'heure et la date de votre système. Si
l'horloge de votre machine n'est pas à l'heure et surtout à la bonne date, des
effets indésirables se produiront.
</p>

<p>
Pour afficher la date et l'heure, tapez <c>date</c>&nbsp;:
</p>

<pre caption="Afficher la date et l'heure">
# <i>date</i>
Fri Mar 29 16:21:18 CEST 2005
</pre>

<p>
Pour changer la date et l'heure de votre système, utilisez <c>date
MMJJhhmmAAAA</c> (<b>M</b>ois, <b>J</b>our, <b>h</b>eure, <b>m</b>inute,
<b>A</b>nnée). Par exemple, pour le 29 mars 2005 à 16:21, utilisez&nbsp;:
</p>

<pre caption="Régler la date et l'heure">
# <i>date 032916212005</i>
</pre>

</body>
</subsection>
<subsection>
<title>Choisir son «&nbsp;stage&nbsp;»</title>
<body>

<p>
La prochaine étape consiste à installer l'archive <e>stage</e> de votre
choix sur votre système.
<!--Vous avez le choix entre télécharger l'archive depuis Internet ou bien, si
vous avez démarrer depuis un CD d'installation universel Gentoo, la copier
depuis le CD. Si vous avez un CD Universel, télécharger l'archive est un gachis
de bande-passante car les fichiers «&nbsp;stage&nbsp;» sont identiques. Dans la
plupart des cas, la commande <c>uname -m</c> pourra vous aider à déterminer
quelle archive choisir.-->
</p>

<!--
<ul>
<li><uri link="#doc_chap2">Par défaut&nbsp;: utiliser une archive d'Internet.</uri></li>
<li>
  <uri link="#doc_chap3">Alternative&nbsp;: utiliser une archive du CD d'installation</uri>
</li>
</ul>-->

</body>
</subsection>
</section>
<section>
<title>Télécharger l'archive depuis Internet</title>
<subsection>
<title>Télécharger l'archive «&nbsp;stage&nbsp;»</title>
<body>

<p>
Allez au point de montage Gentoo sur lequel vous avez monté vos systèmes de
fichiers (probablement <path>/gentoo</path>)&nbsp;:
</p>

<pre caption="Aller au point de montage Gentoo">
# <i>cd /gentoo</i>
</pre>

<p>
Le tableau ci-dessous précise exactement quelle archive il vous faut pour votre
système. Les archives peuvent être téléchargées depuis un <uri
link="/main/en/mirrors.xml">miroir officiel Gentoo</uri> dans le répertoire
<path>releases/mips/current</path>.
</p>

<table>
<tr>
  <th>Endianness</th>
  <th>Processeur</th>
  <th>Emplacement</th>
</tr>
<tr>
  <ti>
    Big Endian<br />
    <e>(Utilisateurs SGI)</e>
  </ti>
  <ti>
    R4000<br />
    R4400<br />
    R4600
  </ti>
  <ti><c>mips3/stage#-mips3-RELEASE.tar.bz2</c></ti>
</tr>
<tr>
  <ti>
    Big Endian<br />
    <e>(Utilisateurs SGI)</e>
  </ti>
  <ti>
    R5000<br />
    RM5200<br />
    RM7000<br />
    R10000<br />
    R12000<br />
    R14000
  </ti>
  <ti><c>mips4/stage#-mips4-RELEASE.tar.bz2</c></ti>
</tr>
<tr>
  <ti>
    Little Endian<br />
    <e>(Utilisateurs Cobalt)</e>
  </ti>
  <ti>
    RM5230<br />
    RM5231
  </ti>
  <ti><c>cobalt/stage#-mipsel4-RELEASE.tar.bz2</c></ti>
</tr>
</table>

<p>
Si vous devez passer par un serveur mandataire, vous devez définir les
variables d'environnement <c>http_proxy</c> et <c>ftp_proxy</c>&nbsp;:
</p>

<pre caption="Définir un serveur mandataire pour wget">
# <i>export http_proxy="http://proxy.server.com:port"</i>
# <i>export ftp_proxy="http://proxy.server.com:port"</i>
</pre>

<p>
L'image d'amorçage réseau Gentoo/MIPS fournit <c>wget</c> pour télécharger des
fichiers. À cause des contraintes de place, il est impossible de founir un
navigateur plus puissant avec les images d'amorce réseau SGI. Les utilisateurs
du LiveCD peuvent utiliser <c>elinks</c>.
</p>

<pre caption="Télécharger l'archive avec wget">
# <i>wget -c http://distfiles.gentoo.org/releases/mips/mips4/stage3-mips4-2006.0.tar.bz2</i>
</pre>

<p>
Vous pouvez utiliser la commande <c>md5sum</c> pour vérifier l'intégrité de
l'archive que vous venez de télécharger. Pour cela, comparez le résultat
affiché par <c>md5sum</c> avec la somme de contrôle disponible sur le miroir.
Par exemple, pour vérifier l'intégrité du fichier stage pour mips4&nbsp;:
</p>

<pre caption="Exemple de calcul de somme de contrôle d'une archive">
# <i>md5sum -c stage3-mips4-2006.0.tar.bz2.md5</i>
stage3-mips4-2006.0.tar.bz2: OK
</pre>

</body>
</subsection>
<subsection>
<title>Décompresser l'archive «&nbsp;stage&nbsp;»</title>
<body>

<p>
Ensuite, décompressez l'archive sur votre système. Nous utiliserons l'outil GNU
<c>tar</c>, car c'est la méthode la plus aisée.
</p>

<pre caption="Décompressez l'archive">
# <i>tar xjpf stage?-*.tar.bz2</i>
</pre>

<p>
Faites bien attention à utiliser les mêmes options (<c>xjpf</c>). Le <c>x</c>
signifie <e>extraire</e>, le <c>j</c> <e>décompresser avec bzip2</e>, le
<c>p</c> <e>préserver les permissions</e> et le <c>f</c> veut dire que nous
désarchivons un fichier d'archive, pas l'entrée standard.
</p>

<p>
Maintenant que le «&nbsp;stage&nbsp;» a été décompressé, continuons avec le
chapitre <uri link="#installing_portage">Installer Portage</uri>.
</p>

</body>
</subsection>
</section>
<!--
<section>
<title>Alternative&nbsp;: utiliser une archive du CD d'installation</title>
<subsection>
<title>Décompresser l'achive «&nbsp;stage&nbsp;»</title>
<body>

<p>
Les archives «&nbsp;stage&nbsp;» incluses sur le CD se trouvent dans le
répertoire <path>/mnt/cdrom/stages</path>. Pour afficher la liste des archives
disponibles, utilisez <c>ls</c>&nbsp;:
</p>

<pre caption="Lister tous les «&nbsp;stage&nbsp;» disponibles">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Si le système répond par une erreur, vous avez peut-être besoin de monter
le CD-ROM.
</p>

<pre caption="Monter le CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Rendez-vous maintenant au point de montage Gentoo (habituellement
<path>/mnt/gentoo</path>)&nbsp;:
</p>

<pre caption=""Changer de répertoire vers /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>Nous allons maintenant extraire l'archive étape de votre choix. Nous le ferons
avec l'outil <c>tar</c>. Faites bien attention à utiliser les mêmes options
(<c>xjvpf</c>). Le <c>x</c> signifie <e>extraire</e>, le <c>v</c>
<e>verbeux</e> et affiche la liste de tous les fichiers extraits (celui-ci est
facultatif), le <c>j</c> <e>décompresser avec bzip2</e>, le <c>p</c>
<e>préserver les permissions</e> et le <c>f</c> veut dire que nous désarchivons
un fichier d'archive, pas l'entrée standard. Dans l'exemple suivant, nous
décompressons l'archive étape
<path>stage3-&lt;sous-architecture&gt;-2006.0.tar.bz2</path>. N'oubliez pas
de substituer le nom de l'étape par celle que vous aurez choisie.
</p>

<pre caption="Décompresser l'étape">
# <i>tar -xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2006.0.tar.bz2</i>
</pre>

<p>
Maintenant que l'archive est installée, poursuivez avec <uri
link="#installing_portage">Installer Portage</uri>.
</p>

</body>
</subsection>
</section>-->
<section id="installing_portage">
<title>Installer Portage</title>
<subsection>
<title>Décompresser un instantané de Portage</title>
<body>

<p>
Vous devez maintenant installer un instantané de l'arbre Portage. Celui-ci
contient l'ensemble des fichiers qui permettent à Gentoo d'installer des
paquets, les différents profils, etc.
</p>

</body>
</subsection>
<subsection id="installing_from_Internet">
<title>Télécharger et installer un instantané de Portage</title>
<body>

<p>
Aller au point de montage de votre système de fichier, probablement
<path>/gentoo</path>&nbsp;:
</p>

<pre caption="Aller au point de montage Gentoo">
# <i>cd /gentoo</i>
</pre>

<p>
Téléchargez l'instantané depuis un <uri link="/main/en/mirrors.xml">miroir
Gentoo</uri>. Vous le trouverez dans le répertoire <path>snapshots/</path>.
Procédez de la même manière que pour télécharger l'archive «&nbsp;stage&nbsp;».
</p>

<pre caption="Extraire l'instantané de Portage">
# <i>tar -xjf portage-*.tar.bz2 -C /gentoo/usr</i>
</pre>

</body>
</subsection>
</section>

<section id="compile_options">
<title>Configurer les options de compilation</title>
<subsection>
<title>Introduction</title>
<body>

<p>
Pour optimiser Gentoo, vous pouvez définir quelques variables qui influencent
le comportement de Portage. Toutes ces variables peuvent être définies comme
des variables d'environnement (en utilisant <c>export</c>), mais elles ne sont
dans ce cas pas permanentes. Pour conserver votre configuration, vous pouvez
utiliser <path>/etc/make.conf</path>, un fichier de configuration de Portage.
C'est ce fichier que nous allons éditer maintenant.
</p>

<note>
Une liste commentée de toutes les variables de Portage se trouve dans le
fichier <path>/etc/make.conf(.example)</path>. Pour installer Gentoo avec
succès, seules celles mentionnées ci-dessous sont indispensables.
</note>

<p>
Lancez votre éditeur préféré (dans ce guide, nous utiliserons <c>nano</c>, mais
<c>vi</c> est aussi fourni) pour modifier les variables d'optimisation décrites
ci-dessous.
</p>

<pre caption="Ouvrir /etc/make.conf">
# <i>nano -w /gentoo/etc/make.conf</i>
</pre>

<p>
Comme vous l'avez sans doute remarqué, le fichier
<path>make.conf.example</path> est structuré de manière générique&nbsp;: les
lignes de commentaires commencent par un "#", les autres définissent des
variables en utilisant la syntaxe <c>VARIABLE="contenu"</c>. Le fichier
<path>make.conf</path> utilise la même syntaxe. Certaines variables sont
décrites ci-dessous.
</p>

</body>
</subsection>
<!--<subsection>
<title>CHOST</title>
<body>

<warn>
Bien que cela peut sembler tentant aux utilisateurs n'ayant pas fait une
installation «&nbsp;stage1&nbsp;», ils <e>ne doivent pas</e> changer le
paramètre <c>CHOST</c> dans <path>make.conf</path>. Le faire pourrait
rendre le système inutilisable. Une fois encore&nbsp;: ne changez cette
variable que si vous faites une installation «&nbsp;<e>stage1</e>&nbsp;».
</warn>

<p>
La variable  <c>CHOST</c> définit l'architecture pour laquelle <c>gcc</c> devra
compiler les programmes ainsi que la <c>libc</c> (<c>glibc</c> ou
<c>µClibc</c>) utilisée pour l'édition de lien.
</p>

<table>
<tr>
  <th>Endianness</th>
  <th>Environnement/ABI</th>
  <th>Paramèteres CHOST</th>
</tr>
<tr>
  <ti>Big Endian <e>(SGI)</e></ti>
  <ti><c>glibc</c> <c>o32</c></ti>
  <ti>mips-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>Big Endian <e>(SGI)</e></ti>
  <ti><c>µClibc</c> <c>o32</c></ti>
  <ti>mips-unknown-linux-uclibc (1)</ti>
</tr>
<tr>
  <ti>Big Endian <e>(SGI)</e></ti>
  <ti><c>glibc</c> <c>n32</c> &amp; <c>n64</c></ti>
  <ti>mips64-unknown-linux-gnu (2)</ti>
</tr>
<tr>
  <ti>Little Endian <e>(Cobalt)</e></ti>
  <ti><c>glibc</c> <c>o32</c></ti>
  <ti>mipsel-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>Little Endian <e>(Cobalt)</e></ti>
  <ti><c>µClibc</c> <c>o32</c></ti>
  <ti>mipsel-unknown-linux-uclibc (1)</ti>
</tr>
<tr>
  <ti>Little Endian <e>(Cobalt)</e></ti>
  <ti><c>glibc</c> <c>n32</c> &amp; <c>n64</c></ti>
  <ti>mips64el-unknown-linux-gnu (2)</ti>
</tr>
</table>

<warn>
(1) Les étapes µClibc sont le domaine de l'équipe
<uri link="/proj/en/base/embedded/">Gentoo Embedded</uri>, et ne sont donc pas
officiellement supportée par l'équipe Gentoo/MIPS. Ce paramètre <c>CHOST</c>
n'est cité ici que par soucis de précision.
</warn>

<warn>
(2) Nous ne fournissons pas d'étape <c>n64</c> pour le moment et seulement des
étapes <c>n32</c> pour l'architecture MIPS4 Big Endian. Ces étapes en sont à
un stade très expérimental et sont connues pour ne pas être fiables sur
plusieurs points. Les utilisateurs sont donc <e>fortement</e> conseillé de les
éviter comme la peste. La seule raison pour laquelle on voudrait le <c>CHOST</c>
<c>mips64(el)</c> est de pouvoir utiliser un environnement 64-bits (<c>n32</c>
ou <c>n64</c>). Ce paramètre <c>CHOST</c> n'est cité ici que par soucis de
précision.
</warn>

</body>
</subsection>-->
<subsection>
<title>CFLAGS et CXXFLAGS</title>
<body>

<p>
Les variables <c>CFLAGS</c> et <c>CXXFLAGS</c> définissent les options
d'optimisation pour le compilateur <c>gcc</c>, respectivement en C et C++.
Bien que nous les définissions de manière générale ici, vous n'obtiendrez des
performances maximales qu'en définissant les optimisations individuellement
pour chaque programme. La raison est que chaque programme est différent.
</p>

<p>
Dans <path>make.conf</path>, vous devriez définir les options d'optimisation
qui, selon vous, donneront plus de rapidité à votre système <e>de manière
générale</e>. Ne mettez pas d'options expérimentales dans cette
variable&nbsp;: trop d'optimisations peut engendrer des comportements anormaux
dans certains programmes (plantage ou, pire, fonctionnement défectueux).
</p>

<p>
Nous n'allons pas expliquer toutes les options d'optimisations possibles.  Pour
les connaître toutes, consultez <uri link="http://gcc.gnu.org/onlinedocs/">les
manuels en ligne GNU</uri> ou la page d'info de <c>gcc</c> (<c>info gcc</c> --
ne marche que sur un système Linux fonctionnel). Le fichier
<path>make.conf</path> lui-même contient de nombreux exemples et
renseignements&nbsp;; n'oubliez pas non plus de le lire.
</p>

<p>
Un premier paramètre est l'option <c>-march=</c> qui spécifie le nom de
l'architecture cible. Les options possibles sont décrites dans le fichier
<path>make.conf</path> (en commentaires). Il y a des exemples pour les couches
ISA (<c>mips1</c> ... <c>mips4</c>) et les modèles de processeurs
(<c>r4400</c>, <c>r4600</c> etc). Pour une architecture purement ISA, on peut
simplement spécifier <c>-mips3</c> plutôt que <c>-march=mips3</c>.
</p>

<pre caption="Les paramètres -march et -mips# de GCC">
<comment>(Pour un système R4600...)</comment>
-march=r4600

<comment>(N'importe quel processeur de classe MIPS4...)</comment>
-march=mips4

<comment>(Ou bien on peut seulement spécifier la couche ISA...)</comment>
-mips4
</pre>

<p>
Un deuxième paramètre est l'option <c>-O</c> (la lettre O majuscule) qui
spécifie la classe d'optimisation de <c>gcc</c>. Les classes possibles sont
<c>s</c> (pour optimiser en taille), <c>0</c> (zéro, pour ne pas optimiser),
<c>1</c>, <c>2</c>, <c>3</c> pour plus d'optimisation de la vitesse
d'exécution (chacune de ces classes a les mêmes options que celle qui la
précède plus quelques autres). Par exemple, pour une optimisation de classe
2&nbsp;:
</p>

<pre caption="Le paramètre O de GCC">
-O2
</pre>

<p>
Un paramètre très important pour les MIPS, <c>-mabi=</c>.  Les MIPS ont trois
ABI différents&nbsp;: <c>32</c> (pur 32-bits, idem <c>o32</c>), <c>64</c> (pur
64-bits, idem <c>n64</c>) et <c>n32</c> (un mélange de structures de données
32-bits et d'instructions 64-bits). Ce paramètre définit lequel de ces trois
vous voulez utilisez. Veuillez prendre note que vous aurez des bibliothèques
correspondantes à l'ABI choisi. En d'autres termes, cela veut dire que vous ne
pouvez pas utiliser <c>-mabi=64</c> dans un environnement 32-bits (ou bien même
dans un environnement <c>n32</c>).
</p>

<p>
Une autre option d'optimisation populaire est <c>-pipe</c> (utilise des tubes
plutôt que des fichiers temporaires pour la communication entre les différentes
étapes de la compilation).
</p>

<p>
Veuillez remarquer que l'option <c>-fomit-frame-pointer</c> (qui permet de ne
pas garder le pointeur de cadre dans un registre pour les fonctions qui n'en
ont pas besoin) peut rendre le dépistage d'erreurs très difficile.
</p>

<p>
Lorsque vous définissez les variables <c>CFLAGS</c> et <c>CXXFLAGS</c>, vous
devez combiner plusieurs options d'optimisation, comme dans l'exemple
suivant&nbsp;:
</p>

<pre caption="Définir les variables CFLAGS et CXXFLAGS">
CFLAGS="-mabi=32 -mips4 -pipe -O2"
CXXFLAGS="${CFLAGS}"   <comment># Utilise les mêmes paramètres pour les deux variables</comment>
</pre>

</body>
</subsection>
<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Avec <c>MAKEOPTS</c>, vous pouvez définir le nombre de compilations à lancer en
parallèle.  Une valeur souvent utilisée est le nombre de processeurs dans votre
système plus un, mais une autre valeur peut parfois mieux fonctionner.
</p>

<pre caption="MAKEOPTS pour un système classique à 1 processeur">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>À vos marques, prêts, partez&nbsp;!</title>
<body>

<p>
Mettez à jour votre <path>/mnt/gentoo/etc/make.conf</path> comme vous le
souhaitez, et sauvez (<c>Ctrl-X</c> avec nano). Vous êtes maintenant prêt à
continuer avec <uri link="?part=1&amp;chap=6">Installer le système de base
Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>
