<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/guide-to-mutt.xml,v 1.13 2006/05/27 22:39:49 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/guide-to-mutt.xml" lang="fr">
<title>Guide de démarrage rapide avec Mutt</title>

<author title="Auteur">
  <mail link="mikpolniak@adelphia.net">Mike Polniak</mail>
</author>
<author title="Correcteur">
  <mail link="antifa@gentoo.org">Ken Nowack</mail>
</author>
<author title="Contributeur">
  <mail link="hitch17@gmail.com">John Hitchings</mail>
</author>
<author title="Traducteur">
  <mail link="enderu666@free.fr">Ahmed Aït Mouss</mail>
</author>
<author title="Traducteur">
  <mail link="ribosome@gentoo.org">Olivier Fisette</mail>
</author>

<abstract>
Ce guide vous montre comment utiliser les puissants outils à interface ligne de
commande pour le courrier électronique&nbsp;: fetchmail, procmail, mutt et
nbsmtp.
</abstract>

<!-- Le contenu de ce document est sous licence CC-BY-SA. -->
<!-- Voir http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.5</version>
<date>2006-05-15</date>

<chapter>
<title>Introduction au courrier électronique</title>
<section>
<body>

<p>
Si vous n'êtes pas un fan des clients de messagerie électronique à interfaces
graphiques fantaisistes, ou si vous voulez seulement essayer d'autres clients
de messagerie avant de choisir celui qui vous convient le mieux, voici une
méthode facile pour commencer à utiliser ces puissants outils en ligne de
commande&nbsp;:
</p>

<p>
<b>fetchmail->procmail->mutt->smtp</b>
</p>

<p>
Ces programmes ne sont pas seulement puissants et très personnalisables, mais
aussi petits et rapides. Lorsque vous serez à l'aise avec ce système de
courrier électronique, vous serez étonné par tout ce qu'il vous permet de
faire.
</p>

<p>
Ce document n'étant qu'un guide de démarrage, nous n'aborderons pas de «&nbsp;Mail
Transfert Agent&nbsp;» (MTA ou agent de transfert de courrier) tel que sendmail,
postfix ou exim. En d'autres termes, pas de configuration complexe de MTA. De
cette façon, l'utilisation du port 25 pour le service de courrier n'est pas
nécessaire.
</p>

<p>
Nous pouvons nous en passer car fetchmail peut transférer le courrier qu'il
rapatrie directement au «&nbsp;Mail Delivery Agent&nbsp;» (MDA ou agent de
diffusion de courrier) au lieu de le diriger vers le port 25. Et nous n'avons
pas besoin d'un MTA complexe pour transmettre le courrier sortant au serveur
SMTP de notre fournisseur d'accès.
</p>

<p>
Voici les programmes dont nous aurons besoin pour notre système de courrier
électronique.
</p>

<pre caption="Installation des programmes requis">
# <i>emerge fetchmail procmail mutt nbsmtp</i>
</pre>

<p>
Ensuite, quatre étapes simples suffisent pour configurer les fichiers et nous
sommes prêts à utiliser un système de courrier électronique flambant neuf.
</p>


<impo>
À la fin de chaque étape, vous pourrez effectuer un test pour vous assurer que
la configuration est correcte. En d'autres termes, vous aurez un système de
courrier électronique totalement fonctionnel une fois ces étapes franchies.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Fetchmail</title>
<section>
<body>


<p>
Fetchmail rapatrie le courrier à partir de serveurs distants et le transmet au
système de diffusion de vos machines locales. Pour l'utiliser, vous aurez
besoin de créer un fichier <path>.fetchmailrc</path> dans votre répertoire
personnel comme dans cet exemple&nbsp;:
</p>

<pre caption="Exemple de fichier .fetchmailrc">
<i>poll mail.fai.net  protocol pop3 user "mon_nom" password "mon_mot_de_passe"</i>
## fai&nbsp;: votre fournisseur d'accès Internet.
</pre>

<p>
Une fois le fichier .fetchmailrc créé, il faudra changer ses droits d'accès
avec la commande chmod. Le fichier ne doit pouvoir être lu que par son
propriétaire. Modifiez les droits d'accès comme suit&nbsp;:
</p>

<pre caption="Définir les droits d'accès du fichier .fetchmailrc">
$ <i>chmod 600 .fetchmailrc</i>
</pre>

<p>
Pour voir fetchmail en action, utilisez l'option -v (mode bavard). Pour
rapatrier tous les messages, utilisez l'option -a. L'option -m demande à
fetchmail de transmettre le courrier rapatrié à procmail.
</p>

<warn>
Lors de vos essais, c'est une bonne idée d'utiliser l'option -k qui demande à
fetchmail de laisser le courrier sur le serveur après l'avoir téléchargé. En
cas de problème, votre courrier ne sera pas perdu.
</warn>


<p>
Lancez-le pour voir ce que ça donne.
</p>

<pre caption="Fetchmail test 1">
$ <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i>
</pre>

<p>
Lorsque vous aurez un système fonctionnel, vous pourrez le configurer en tant
que commande cron ou le mettre dans un moniteur système comme gkrellm. Vous
pouvez aussi lancer fetchmail en mode démon et lui spécifier de rapatrier le
courrier toutes les x secondes.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Procmail</title>
<section>
<body>

<p>
Procmail a pour but de filtrer le courrier que lui envoie fetchmail. Il agit
aussi en tant que MDA en délivrant le courrier dans vos boîtes aux lettres
(BAL) où mutt (le client de messagerie électronique) ira le lire.
</p>

<p>
Pour utiliser procmail, il vous faudra créer un fichier .procmailrc dans votre
répertoire personnel. Commençons un fichier .procmailrc très simple qui va
filtrer le courrier issu de trois listes de diffusion de gentoo dans les BAL
suivantes : gentoo-dev, gentoo-user et gentoo-announce.
</p>

<note>
Les règles de filtrage de procmail sont appelées «&nbsp;recipes&nbsp;»
(recettes en anglais). J'ai inclus quelques recettes anti-spam.
</note>

<pre caption="Exemple de .procmailrc">
MAILDIR=$HOME/MuttMail                ## Faites en sorte que ça existe.
LOGFILE=$HOME/.procmaillog
LOGABSTRACT=no
#VERBOSE=on (Est utilisé uniquement pour le débogage.)
VERBOSE=off
FORMAIL=/usr/bin/formail
NL="
"
## Les lignes de «&nbsp;recipe&nbsp;» commencent par «&nbsp;:0&nbsp;».
## Ne mettez pas de commentaires dans les lignes de «&nbsp;recipe&nbsp;».
## Désactivez un «&nbsp;recipe&nbsp;» grace au NON logique (!).
## Les conditions commencent par *, utilisez des expressions rationnelles.
## Les conditions sont associées avec un ET logique.
## Tout ce qui suit * est passé directement à egrep.
## Une ligne d'action suit les conditions, ici c'est un nom de BAL.

# Utilise formail pour les courriers dupliqués.
:0 Whc: .msgid.lock
| $FORMAIL -D 16384 .msgid.cache

:0 a
$MAILDIR/duplicates

# Les personnes dont on accepte toujours les courriers.
:0
* ^From:.*(craig\@hotmail|renee\@local.com)
$MAILDIR/friends

# Spam à la poubelle.
:0
* ^Subject:.*(credit|cash|money|debt|sex|sale|loan)
$MAILDIR/spam

# Plus de messages HTML.
:0
* ^Content-Type:.*html
$MAILDIR/junk

# Met les messages des listes de diffusion dans leurs boîtes.
:0
* ^List-Id:.*gentoo-user
gentoo-user

:0
* ^List-Id:.*gentoo-dev
gentoo-dev

:0
* ^List-Id:.*gentoo-announce
gentoo-announce

# Autres courriers de gentoo ?
:0
* ^From:.*gentoo.org
gentoo

:0
* ^From:.*@freshmeat\.net
freshmeat

#######################################
# Dernière règle : tout ce qui arrive #
# ici va dans la boîte par défaut.    #
#######################################
:0
* .*
default

# Fin de fichier
</pre>

<note>
Étant donné que procmail va créer les fichiers de BAL lorsqu'il en aura besoin
(en utilisant les noms donnés dans les lignes d'action), il suffit d'affecter
$HOME/MuttMail à la variable MAILDIR. Pour plus d'informations&nbsp;:
<uri>http://www.procmail.org/</uri>
</note>

<p>
Vous pouvez maintenant tester votre .procmailrc avec la commande fetchmail que
nous avons vu à la première étape. N'oubliez pas l'option -k pour laisser les
courriers sur le serveur, au cas où vous auriez besoin de refaire des tests.
</p>


<pre caption="Procmail test 2">
$ <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i>
</pre>

<p>
Maintenant que fetchmail et procmail ont été exécutés, allez dans
$HOME/MuttMail et lisez vos messages avec <c>less</c> ou votre gestionnaire de
fichiers.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Le client de messagerie électronique Mutt</title>
<section>
<body>

<p>
Mutt sert à lire et à composer du courrier électronique. C'est un logiciel
puissant et personnalisable tout en restant petit et rapide.
</p>

<p>
Mutt lit et écrit selon quatre formats de BAL&nbsp;: mbox, MH, MMDF et maildir.
Le type de BAL est détecté automatiquement. Dans notre cas, nous utilisons le
format mbox selon lequel tous les messages d'une boîte sont stockés dans un
même fichier.
</p>

<p>
Mutt peut aussi utiliser des dossiers situés sur un serveur IMAP distant. Pour
plus d'informations sur cette fonctionnalité, consultez «&nbsp;IMAP
support&nbsp;» dans la section 4.11 du manuel d'utilisation de Mutt ainsi que
son site web <uri>http://www.mutt.org/</uri>.
</p>

<p>
Lorsque vous avez installé mutt à la première étape, un fichier de
configuration système a été installé dans /etc/mutt/Muttrc. Vous aurez
également besoin de créer un fichier .muttrc dans votre répertoire personnel.
</p>

<pre caption="Exemple de fichier .muttrc">
<comment>(Lisez bien l'excellent manuel d'utilisation de mutt (/usr/share/doc/mutt*).)</comment>
<comment>(Tout ce que vous changez ici remplace les options système de /etc/mutt/Muttrc.)</comment>

# <i>cp /etc/mutt/Muttrc ~/.muttrc</i>
# <i>nano -w .muttrc</i>
set pager_context=1
set pager_index_lines=6                 # Affiche un mini-index dans le pager.
set menu_scroll
set pgp_verify_sig=no                   # Ne pas afficher pgp dans le pager.
set status_on_top                       # Met la ligne d'état en haut.
set sort=threads                        # Trier par sujet dans l'index.

set status_format=" %r %b %f %n      Del %d      Msgs %m %l %> (%P)"
set pager_format="%-10.10i %[!%a %b %d %R]"
set date_format="!%H:%M %a %d %b     "
set index_format="%4C %Z %[%b%d] %-15.15F %s"
set folder_format="%2C %t %8s %d %N %f"

#set sendmail="/usr/bin/nbsmtp -d isp.net -h smtp.fai.net -f votrenom@isp.net"

#set from="default-mailaddress"         # Mettez ici votre adresse d'origine.
#set realname="myname"

set record="$HOME/MuttMail/sent"        # Les mails envoyés sont sauvegardés ici.
set delete=yes                          # Supprime sans confirmation.
set include=yes                         # Cite le message original dans la réponse.
set fast_reply=yes                      # Répond sans confirmation.
set beep=no                             # Désactive les bips.
set markers=no                          # Pas de + sur les lignes coupées.
set confirmappend=no                    # Enregistre dans =keep sans confirmation.
set to_chars=" +TCF"                    # Pas de L pour mail_list.

set folder = $HOME/MuttMail
mailboxes =gentoo-user
mailboxes =gentoo-dev
mailboxes =gentoo-announce
mailboxes =gentoo
mailboxes =freshmeat
mailboxes =duplicates
mailboxes =default
mailboxes =friends
mailboxes =junk
mailboxes =spam
mailboxes =keep

save-hook .* =keep                      # La BAL par défaut est =keep.
subscribe gentoo-user gentoo-dev        # Mettez ici les listes auxquelles vous êtes inscrit.

bind pager h display-toggle-weed        # Affiche l'entête avec la touche h.

# Émule l'ancien menu url.
macro index \cb |urlview\n 'appelle urlview pour extraire les URLs des messages'
macro pager \cb |urlview\n 'appelle urlview pour extraire les URLs des messages'

# Lance fetchmail avec la touche G.
macro index G "!fetchmail -a -m 'procmail -d %T'\r"
macro pager G "!fetchmail -a -m 'procmail -d %T'\r"

# Édite .muttrc et le "source", évite un redémarrage.
macro generic ,sm ":source $HOME/.muttrc\r"
macro generic \cj "!rxvt -bg wheat -e joe $HOME/.muttrc\r"

# Liste par défaut de champs à afficher dans les entêtes.
# Tout ignorer puis accepter seulement ce que vous voudrez voir.
ignore *
unignore  Date To From: Subject X-Mailer Organization User-Agent
hdr_order Date From To Subject X-Mailer User-Agent Organization

## Votre mutt doit avoir quelques couleurs.
## Celles-ci sont pour quatre niveaux de texte cité.
## Elles remplacent les couleurs par défaut dans /etc/mutt/Muttrc.

#color quoted green  default
color quoted1 magenta blue
#color quoted2 yellow default
#color quoted3 red default
#color signature cyan cyan


# Ce thème de couleurs est copié à partir de /etc/mutt/Muttrc.color.
# Commentez-le si vous voulez les couleurs par défaut.
# Je vois la vie en rose :-)
color hdrdefault brightcyan blue
color   header          brightwhite    blue "^from:"
color   header          brightwhite    blue   "^subject:"

color   quoted          brightgreen    blue
color   signature       brightwhite    blue

color   indicator       blue           green

color   error           red            black
mono    error           bold
color   status          black cyan
mono    status          bold
color   tree            yellow         blue

color   tilde           brightmagenta  blue
color   body            brightwhite    blue "[-a-z_0-9.]+@[-a-z_0-9.]+"
mono    body            bold                "[-a-z_0-9.]+@[-a-z_0-9.]+"
color   body            brightyellow   black    "^Good signature"
mono    body            bold                    "^Good signature"
color   body            brightwhite    red      "^Bad signature from.*"
mono    body            bold                    "^Bad signature from.*"
color   normal          white          blue
color   message         green          black
color   attachment      brightgreen    blue

# Fin de fichier... mais ça pourrait continuer encore et encore... :)
</pre>

<p>
Pour information, ceci n'est qu'un exemple de fichier .muttrc. Vous pouvez
configurer de nombreuses autres options, l'intégration de GPG par exemple. Vous
trouverez de l'aide et des exemples sur
<uri>http://www.dotfiles.com/index.php3?app_id=27</uri>.
</p>

<p>
Vous êtes maintenant prêt à tester votre fichier <path>.muttrc</path>.
</p>

<pre caption="Test de .muttrc">
$ <i>mutt -y</i>
</pre>

<p>
Ceci devrait lancer Mutt avec un menu qui affiche les BAL que vous avez créées
lors du test 2 avec la commande fetchmail.
</p>

<p>
Tapez ? pour obtenir de l'aide sur la navigation dans les BAL.
</p>

</body>
</section>
</chapter>

<chapter>
<title>SMTP</title>
<section>
<body>

<p>
L'étape finale est la configuration de nbsmtp (No-Brainer SMTP). Il est utilisé
pour envoyer le courrier sortant à votre serveur SMTP. Cette étape est aussi la
plus facile puisqu'il suffit d'ajouter une ligne dans votre fichier .muttrc.
</p>

<p>
-d domaine : nom de domaine auquel nbsmtp dira appartenir. Ce sera presque
toujours le domaine dans votre adresse de courrier électronique.
</p>

<p>
-f expéditeur@addr.net : adresse à partir de laquelle nbsmtp dira qu'il envoie
le courrier. Elle peut être différente de celle de la ligne «&nbsp;From:&nbsp;»
dans votre MUA.
</p>

<p>
-h smtp.net : serveur SMTP que vous utilisez pour envoyer vos courriels.
</p>

<pre caption="Ajout du support SMTP">
$ <i>nano -w .muttrc</i>
set sendmail="/usr/bin/nbsmtp -d fai.net -h smtp.fai.net -f votre_nom@fai.net"
</pre>

<p>
Vous êtes maintenant prêt à envoyer un message. Dans le pager ou l'index de
mutt, tapez <c>m</c> pour composer un message de test à envoyer à votre adresse
de courrier électronique. Mutt va utiliser la valeur des variables EDITOR ou
VISUAL pour lancer votre éditeur préféré, sauf si vous avez modifié la ligne
«&nbsp;editor=&nbsp;» dans votre fichier .muttrc. Quand vous aurez fini de
composer votre message, tapez <c>y</c> pour l'envoyer. S'il n'y a pas d'erreur,
vous verrez «&nbsp;sending mail&nbsp;» s'afficher, suivi de «&nbsp;Mail
sent.&nbsp;».
</p>

<p>
Rappelez-vous que nous avions configuré l'endroit où mutt sauvegarde les
messages envoyés avec set record="$HOME/MuttMail/sent".
</p>

<p>
Pour terminer le test, lancez fetchmail encore une fois pour rapatrier vos
messages et vérifiez que vous avez bien reçu le message de test. Lorsque vous
l'aurez trouvé, tapez <c>h</c> pour afficher son entête et voyez le chemin
complet qu'a suivi votre courrier.
</p>

<note>
Vous voudrez probablement ajouter le programme urlview à votre système. Il
extrait les URLs du texte des messages et les envoie à votre navigateur.
</note>

<pre caption="Installer urlview">
# <i>emerge urlview</i>
</pre>

<p>
Ensuite, créez <path>~/.urlview</path> en copiant le fichier qui se trouve dans
<path>/usr/share/doc/urlview*/</path> et en éditant la ligne concernant votre
navigateur.
</p>

<p>
Vous disposez maintenant d'un système de courrier électronique performant et
très personnalisable. Pour bénéficier au maximum de sa flexibilité, lisez les
manuels et la documentation des différents outils et cherchez les fichiers de
configuration <path>procmailrc</path> et <path>muttrc</path> des autres
utilisateurs sur le web.
</p>

</body>
</section>
</chapter>

<chapter>
<title>SMTP avec authentification</title>
<section>
<title>Utiliser nbSMTP</title>
<body>

<p>
Si vous devez utiliser un nom d'utilisateur et un mot de passe avec votre
serveur SMTP, vous pouvez éditer la commande <c>set sendmail</c> dans votre
<path>.muttrc</path> pour y inclure <c>-U &lt;username&gt;</c>. Cela
donne&nbsp;:
</p>

<pre caption="Paramétrer le nom d'utilisateur et le mot de passe pour SMTP">
set sendmail="/usr/bin/nbsmtp -U <i>nom_utilisateur</i> -P <i>mot_de_passe</i> -d fai.net -h smtp.fai.net -f votre_nom@fai.net"
</pre>

<p>
Si vous ne souhaitez pas que cette information se retrouve dans votre
<path>.muttrc</path>, vous pouvez alternativement créer le fichier
<path>.nbsmtprc</path> et y écrire les informations nécessaires&nbsp;:
</p>

<pre caption="Exemple de ~/.nbsmtprc">
auth_user = <i>nom_utilisateur</i>
auth_pass = <i>mot_de_passe</i>
</pre>

</body>
</section>
<section>
<title>msmtp&nbsp;: un SMTP alternatif</title>
<body>

<p>
<c>msmtp</c> est une alternative simple à <c>nbsmtp</c> et offre des
fonctionnalités équivalentes.
</p>

<pre caption="Installer msmtp">
# <i>emerge msmtp</i>
</pre>

<p>
Relogguez-vous en utilisateur normal et configurez msmtp en spécifiant
l'information relative à votre serveur SMTP dans le fichier
<path>~/.msmtprc</path>. N'oubliez pas d'utiliser des permissions d'accès
sûres pour ce fichier&nbsp;!
</p>

<pre caption="Configurer msmtp">
$ <i>nano -w .msmtprc</i>
account default
host <i>smtp.votre_fournisseur.net</i>
from <i>votre_nom_d'usager@fournisseur1.net</i>
<comment># Consultez la page man pour plus de détails sur les options d'authentification.</comment>
auth login
user <i>votre_nom_d'usager</i>
password <i>votre_mot_de_passe</i>
<comment># Si votre serveur SMTP supporte le cryptage TLS, décommentez la ligne suivante.
#tls</comment>
</pre>

<p>
Ensuite, attribuez des permissions d'accès sûres à fichier&nbsp;:
</p>

<pre caption="Régler les permissions d'accès du fichier de configuration">
$ <i>chmod 600 .msmtprc</i>
</pre>

<p>
Finalement, éditez ou ajoutez la ligne suivante dans le fichier
<path>.muttrc</path>&nbsp;:
</p>

<pre caption="Utiliser msmtp avec Mutt">
$ <i>nano -w .muttrc</i>
set sendmail="/usr/bin/msmtp"
</pre>

<p>
Lancez <c>mutt</c> et écrivez-vous un message pour vous assurez que cela
fonctionne. Lisez la page man de msmtp pour connaître l'ensemble des options
disponibles et pour voir un autre exemple de configuration.
</p>

</body>
</section>
</chapter>
</guide>
