<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/alsa-guide.xml,v 1.19 2004/08/14 00:22:07 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/alsa-guide.xml" lang="fr">
<title>Guide ALSA pour Gentoo Linux</title>
<author title="Auteur">
 <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Auteur">
 <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Auteur">
 <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Auteur">
<mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Correcteur"><!--zhen@gentoo.org" -->
 John P. Davis
</author>
<author title="Correcteur">
 <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Correcteur">
 <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Correcteur">
 <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Correcteur">
 <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Traducteur">
 <mail link="takezo@skynet.be">Olivier Roomans</mail>
</author>
<author title="Traducteur">
 <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Ce guide vous explique comment mettre en place ALSA (Advanced Linux Sound
Architecture) sur Linux Gentoo.  En complément du guide de configuration du
bureau («&nbsp;Gentoo Linux Desktop Configuration Guide&nbsp;»), ce guide est
supposé vous donner plus d'informations à ce sujet.
</abstract>

<license/>

<version>1.5.2</version>
<date>13 août 2004</date>

<chapter>
<title>L'architecture avancée pour le son sous Linux («&nbsp;Advanced Linux Sound Architecture&nbsp;»)</title>
<section>
<title>Qu'est-ce que ALSA ?</title>
<body>

<p>
ALSA est l'architecture avancée pour le son sous Linux, un projet dédié au
développement d'un sous-système audio pour Linux de haute qualité. Il a
remplacé OSS (<e>Open Sound System</e>) en tant que sous-système audio par
défaut dans le noyau 2.6.
</p>

<p>
ALSA fournit un support efficace pour tous les types d'interfaces audio, est
complètement modulaire, est SMP (multi-processeur) et thread-safe (bonne
gestion des fils d'exécutions) et fournit une bibliothèque utilisateur de
haute qualité appelée <e>alsa-lib</e> pour simplifier la programmation
d'applications. ALSA fournit également une couche de compatibilité
descendante avec OSS.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installation d'ALSA</title>
<section>
<title>Les variables USE utilisées par ALSA</title>
<body>

<p>
Gentoo fournit une variable USE nommée <c>alsa</c> que vous devrez mettre
dans votre <path>/etc/make.conf</path> pour permettre à nos paquets de se
compiler avec le support pour ALSA. Si vous mettez également <c>oss</c> dans
votre variable USE, ALSA se compilera avec la compatibilité OSS.
</p>

</body>
</section>

<section>
<title>Les modules du noyau</title>
<body>

<p>
Premièrement, avant de continuer, assurez-vous que votre noyau a bien le
support pour les cartes sons d'activé (<e>Sound Card Support</e>). Si vous
utilisez <c>genkernel</c> pour construire votre noyau, c'est activé
automatiquement. Sinon, reconfigurez votre noyau.
</p>

<p>
Si vous utilisez un noyau 2.6, vous pouvez sauter le reste de cette section
et continuer avec l'<uri link="#alsa-utils">installation des outils
ALSA</uri>, car le noyau 2.6 intègre déjà les pilotes ALSA. Bien sûr,
n'oubliez pas d'activer le support pour votre carte son lorsque vous
configurerez votre noyau.
</p>

<p>
Les utilisateurs des noyaux 2.4 devront installer les pilotes ALSA
nécessaires pour leur carte son. D'abord, trouvez quelle carte son vous avez.
Une méthode simple est de chercher «&nbsp;audio&nbsp;» dans
<path>/proc/pci</path>&nbsp;:
</p>

<pre caption="Trouver le type de carte son">
# <i>grep -i audio /proc/pci</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64)
</pre>

<p>
Allez maintenant voir la <uri
link="http://www.alsa-project.org/alsa-doc">table des cartes son supportées
par ALSA</uri> et cherchez-y la vôtre. Dans l'exemple précédent, vous auriez
choisi le constructeur <e>VIA</e> et vous auriez alors obtenu une liste des
chipsets connus de ce constructeur. Le chipset dans l'exemple précédent est
«&nbsp;via82c686&nbsp;»&nbsp;; le lien «&nbsp;Details&nbsp;» nous informe
alors que le pilote s'appelle <path>via82xx</path>.
</p>

<p>
Avec cette information, nous pouvons installer <c>alsa-driver</c> pour votre
carte son. Éditez donc le fichier <path>/etc/make.conf</path> et
<e>ajoutez</e> lui une nouvelle option ALSA_CARDS. Dans cette variable, vous
pouvez déclarez les pilotes audio que vous voulez utiliser&nbsp;:
</p>

<pre caption="Édition de /etc/make.conf pour ajouter ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<p>
Maintenant, installez <c>alsa-driver</c>&nbsp;:
</p>

<pre caption="Installation des pilotes ALSA">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Si, un jour, vous recompilez votre noyau, il y a de fortes chances pour que
vos modules ALSA se fassent écraser. Il est donc conseillé de relancer
<c>emerge alsa-driver</c> à chaque fois que vous recompilez votre noyau,
<e>après</e> avoir redémarré avec le nouveau noyau.
</impo>

</body>
</section>

<section id="alsa-utils">
<title>Installation des outils ALSA</title>
<body>

<p>
Si vous désirez la compatibilité OSS, vous devez installer
<c>alsa-oss</c>&nbsp;:
</p>

<pre caption="Installation de la couche de compatibilité OSS">
# <i>emerge alsa-oss</i>
</pre>

<p>
Maintenant, installez les outils ALSA dans votre système (c'est
obligatoire)&nbsp;:
</p>

<pre caption="Installation des outils ALSA">
# <i>emerge alsa-utils</i>
</pre>

<p>
Maintenant que les outils sont installés, il est temps de configurer ALSA...
</p>

</body>
</section>
</chapter>

<chapter>
<title>Configuration d'ALSA</title>
<section>
<title>Chargement automatique des modules du noyau</title>
<body>

<p>
Si vous utilisez un noyau modulaire (comme c'est le cas avec <c>genkernel</c>),
vous devez éditer le fichier <path>/etc/modules.d/alsa</path> pour activer les
modules nécessaires lors du démarrage. Pour la carte son de l'exemple&nbsp;:
</p>

<pre caption="Dans /etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># Les lignes suivantes ne sont nécessaires que si vous souhaitez</comment>
<comment># la compatibilité avec OSS</comment>
alias sound-slot-0 snd-card-0
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Maintenant, lancez <c>modules-update</c> pour intégrer les modifications que
vous venez d'appliquer au fichier <path>alsa</path> dans le fichier
<path>/etc/modules.conf</path>&nbsp;:
</p>

<pre caption="Exécution de modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>

<section>
<title>Vérification des fichiers de périphériques</title>
<body>

<p>
Si vous utilisez DevFS (qui est le défaut d'une installation Gentoo),
assurez-vous que le fichier <path>/etc/devfsd.conf</path> possède bien les
bonnes permissions pour les périphériques ALSA&nbsp;:
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>

<section>
<title>Activer ALSA lors du démarrage</title>
<body>

<p>
Pour activer ALSA au démarrage du système, ajoutez le script d'initialisation
<c>alsasound</c> au niveau d'exécution «&nbsp;boot&nbsp;»&nbsp;:
</p>

<pre caption="Ajout de alsasound aux scripts de démarrage">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>

<section>
<title>Activer les canaux de la carte son</title>
<body>

<p>
Par défaut, tous les canaux sont muets. Lancez <c>amixer</c> pour corriger
cela&nbsp;:
</p>

<pre caption="Lancement de amixer">
# <i>amixer</i>
</pre>

<p>
Si <c>amixer</c> affiche beaucoup de texte, vous êtes alors prêt pour activer
les volumes. Si vous obtenez une erreur, vérifiez si le module de votre son est
correctement chargé.
</p>

<p>
Activez maintenant les canaux <e>Master</e> et <e>PCM</e>. Si cela n'est pas
suffisant, activez aussi les canaux <e>Center</e> et <e>Surround</e>.
</p>

<pre caption="Activer les canaux de la carte son">
# <i>amixer set Master 100 unmute</i>
# <i>amixer set PCM 100 unmute</i>
<comment>(Seulement si les commandes précédentes ne suffisent pas :)</comment>
# <i>amixer set Center 100 unmute</i>
# <i>amixer set Surround 100 unmute</i>
</pre>

<p>
Pour vérifier que le son marche bien, essayez de lire un fichier .wav (avec
<c>aplay</c>), un fichier .mp3 (avec <c>mpg123</c> ou même <c>mplayer</c>) ou
n'importe quel autre fichier qui produit du son.
</p>

<p>
Pour régler vos volumes plus agréablement, vous pouvez utiliser l'application
<c>alsamixer</c>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Activation du support MIDI</title>
<section>
<title>Installation des paquets nécessaires</title>
<body>

<p>
Certaines cartes son possèdent un synthétiseur MIDI intégré. Pour l'utiliser,
vous devez d'abord installer le paquet <c>awesfx</c>&nbsp;:
</p>

<pre caption="Installation du paquet awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Si vous avez déjà des polices sonores, placez-les dans
<path>/usr/share/sfbank/</path>. Par exemple, la SBLive est livrée avec un
fichier de polices appelé <path>8MBGMSFX.SF2</path> ou
<path>CT4GMSFX.SF2</path>.
</p>

<p>
Après avoir copié le fichier, sélectionnez-le avec <c>asfxload</c>&nbsp;:
</p>

<pre caption="Chargement de la police sonore">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Cette commande doit être lancée à chaque démarrage. Il est recommandé de
l'ajouter au fichier <path>/etc/conf.d/local.start</path>.
</p>

<p>
Si vous ne trouvez pas de polices sonores sur votre CD, vous pouvez en
télécharger depuis <uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>.
</p>

</body>
</section>

<section>
<title>Le synthétiseur virtuel Timidity++</title>
<body>

<p>
Si votre carte son n'a pas de synthétiseur matériel (ou vous ne voulez pas
l'utiliser), vous pouvez utiliser le synthétiseur virtuel de <c>timidity++</c>.
Commençons par installer le paquet&nbsp;:
</p>

<pre caption="Installation de Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Timidity a besoin de polices sonores pour produire du son. Si vous n'en avez
pas, vous pouvez installer le paquet <c>timidity-eawpatches</c>&nbsp;:
</p>

<pre caption="Installation de timidity-eawpatches">
# <i>emerge timidity-eawpatches</i>
</pre>

<p>
N'oubliez pas d'ajouter <c>timidity</c> au niveau d'exécution par défaut&nbsp;:
</p>

<pre caption="Ajout de timidity au niveau d'exécution par défaut">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>

<section>
<title>Test du support MIDI</title>
<body>

<p>
Vous pouvez utiliser <c>pmidi</c> pour tester votre configuration MIDI&nbsp;:
</p>

<pre caption="Installation de pmidi">
# <i>emerge pmidi</i>
</pre>

<p>
Pour voir quels ports en sortie MIDI sont disponibles sur votre système,
utilisez l'option <c>-l</c>&nbsp;:
</p>

<pre caption="Liste des ports en sortie MIDI">
# <i>pmidi -l</i>
</pre>

<p>
Si tout va bien, essayez de jouer un fichier MIDI pour vous assurer que tout
fonctionne. Vous pouvez définir le port MIDI à utiliser avec l'option
<c>-p</c>&nbsp;:
</p>

<pre caption="Jouer un fichier MIDI">
# <i>pmidi -p 65:0 "Final Fantasy 7 - Aerith's Theme.mid"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Remarques finales</title>
<section>
<title>Outils et firmware</title>
<body>

<p>
Certaines cartes sons peuvent utiliser les outils fournis par les paquets
<c>alsa-tools</c> et <c>alsa-firmware</c>. Si vous avez besoin de
<c>alsa-tools</c>, déclarez la variable ALSA_TOOLS dans le fichier
<path>/etc/make.conf</path> en indiquant les outils que vous voulez. Par
exemple&nbsp;:
</p>

<pre caption="Sélection des outils ALSA dans /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Vous pouvez ensuite installer les paquets <c>alsa-tools</c> (et/ou
<c>alsa-firmware</c>)&nbsp;:
</p>

<pre caption="Installation des outils ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>

<section>
<title>Connecter une manette de jeu</title>
<body>

<p>
Si votre carte son est équipée d'une connexion pour une manette de jeu, vous
voudrez peut-être l'activer. Vérifiez d'abord si le pilote de votre carte a un
paramètre pour joystick. Vous pouvez utiliser <c>modinfo</c> sur votre module
du noyau pour cela. Par exemple, pour le module <c>snd-via82xx</c>&nbsp;:
</p>

<pre caption="Exécution de modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio
             part of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Si le pilote de votre carte a un paramètre <c>joystick</c>, ajoutez
<c>joystick=1</c> sur la ligne <c>options</c> du fichier
<path>/etc/modules.d/alsa</path>. Par exemple&nbsp;:
</p>

<pre caption="Ajout du paramètre joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>

<section>
<title>Ressources</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">Page du projet ALSA</uri></li>
  <li><uri link="http://www.djcj.org/">FAQ et HOWTO ALSA</uri></li>
  <li>
    <uri link="http://linux-sound.org/">Programmes Linux pour le son et le
    MIDI</uri>
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
