<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/alsa-guide.xml,v 1.27 2005/04/25 14:19:43 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/alsa-guide.xml" lang="fr">
<title>Guide ALSA pour Gentoo Linux</title>
<author title="Auteur">
 <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Auteur">
 <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Auteur">
 <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Auteur">
<mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Correcteur"><!--zhen@gentoo.org" -->
 John P. Davis
</author>
<author title="Correcteur">
 <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Correcteur">
 <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Correcteur">
 <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Correcteur">
 <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Traducteur">
 <mail link="takezo@skynet.be">Olivier Roomans</mail>
</author>
<author title="Traducteur">
 <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Ce guide vous explique comment mettre en place ALSA (Advanced Linux Sound
Architecture) sur Linux Gentoo.  En complément du guide de configuration du
bureau («&nbsp;Gentoo Linux Desktop Configuration Guide&nbsp;»), ce guide est
supposé vous donner plus d'informations à ce sujet.
</abstract>

<license/>

<version>1.5.12</version>
<date>2005-04-24</date>

<chapter>
<title>L'architecture avancée pour le son sous Linux («&nbsp;Advanced Linux
Sound Architecture&nbsp;»)</title>
<section>
<title>Qu'est-ce qu'ALSA ?</title>
<body>

<p>
ALSA est l'architecture avancée pour le son sous Linux, un projet dédié au
développement d'un sous-système audio pour Linux de haute qualité. Il a
remplacé OSS (<e>Open Sound System</e>) en tant que sous-système audio par
défaut dans le noyau 2.6.
</p>

<p>
ALSA fournit un support efficace pour tous les types d'interfaces audio, est
complètement modulaire, est SMP (multi-processeur) et thread-safe (bonne
gestion des fils d'exécutions) et fournit une bibliothèque utilisateur de
haute qualité appelée <e>alsa-lib</e> pour simplifier la programmation
d'applications. ALSA fournit également une couche de compatibilité
descendante avec OSS.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installation d'ALSA</title>
<section>
<title>Les variables USE utilisées par ALSA</title>
<body>

<p>
Gentoo fournit une variable USE nommée <c>alsa</c> que vous devrez mettre
dans votre <path>/etc/make.conf</path> pour permettre à nos paquets de se
compiler avec le support pour ALSA. Si vous mettez également <c>oss</c> dans
votre variable USE, ALSA se compilera avec la compatibilité OSS.
</p>

</body>
</section>

<section>
<title>Les modules du noyau</title>
<body>

<p>
Avant de continuer, assurez-vous que le support pour les cartes sons est activé
dans votre noyau (<e>Sound Card Support</e>). Si vous utilisez <c>genkernel</c>
pour construire votre noyau, c'est activé automatiquement. Sinon, reconfigurez
votre noyau. Assurez-vous de désactiver <e>Open Sound System</e> dans votre
configuration du noyau. Si vous ne le faites pas, votre système peut essayer
d'utiliser ces pilotes plutôt que les pilotes ALSA. Si vous voyez un message tel
que «&nbsp;sound card not detected&nbsp;», c'est que c'est le cas.
</p>

<warn>
Si vous utilisez un noyau 2.6, vous pouvez utiliser les pilotes fournis par le
noyau, mais nous vous recommandons néanmoins d'utiliser media-sound/alsa-driver
car ces pilotes sont généralement plus à jour que ceux du noyau. Si vous
souhaitez toujours utiliser les pilotes fournis avec le noyau, vous pouvez
sauter le reste de cette section et continuer avec l'<uri
link="#alsa-utils">installation des outils ALSA</uri>.
</warn>

<p>
Pour commencer, vous devez trouver quelle carte son vous avez. Si vous ne le
savez pas déjà, une méthode simple est de chercher «&nbsp;audio&nbsp;» dans
l'affichage de la commande <c>lspci</c>. Vous pouvez l'installer avec <c>emerge
pciutils</c>.
</p>

<pre caption="Trouver le type de carte son">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64)
</pre>

<p>
Allez maintenant voir la <uri link="http://www.alsa-project.org/alsa-doc">table
des cartes sons supportées par ALSA</uri> et cherchez-y la vôtre. Dans l'exemple
précédent, vous auriez choisi le constructeur <e>VIA</e> et vous auriez alors
obtenu une liste des chipsets connus de ce constructeur. Le chipset dans
l'exemple précédent est «&nbsp;via82c686&nbsp;»&nbsp;; le lien
«&nbsp;Details&nbsp;» nous informe alors que le pilote s'appelle
<path>via82xx</path>. C'est la seule information utile sur cette page, vous
pouvez ignorer le reste.
</p>

<p>
Avec cette information, nous pouvons installer <c>alsa-driver</c> pour votre
carte son. Éditez donc le fichier <path>/etc/make.conf</path> et
<e>ajoutez</e> lui une nouvelle option ALSA_CARDS. Dans cette variable, vous
pouvez déclarez les pilotes audio que vous voulez utiliser&nbsp;:
</p>

<pre caption="Édition de /etc/make.conf pour ajouter ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<warn>
Si vous avez plusieurs cartes sons dans votre système, séparez leur nom par une
virgule dans la variable ALSA_CARDS. Par exemple&nbsp;:
ALSA_CARDS="via82xx,emu10k1".
</warn>

<p>
Si vous voulez la compatibilité OSS (hautement recommandée), vous devrez ajouter
le paramètre USE «&nbsp;oss&nbsp;» dans <path>/etc/make.conf</path>. Vous êtes
maintenant prêt à installer <c>alsa-driver</c>&nbsp;:
</p>

<pre caption="Installation des pilotes ALSA">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Si, un jour, vous recompilez votre noyau, il y a de fortes chances pour que
vos modules ALSA soient supprimés. Il est donc conseillé de relancer
<c>emerge alsa-driver</c> à chaque fois que vous recompilez votre noyau. Notez
que cela compilera les pilotes correspondant au noyau placé dans /usr/src/linux
et non pas le noyau courant.
</impo>

</body>
</section>

<section id="alsa-utils">
<title>Installation des outils ALSA</title>
<body>

<p>
Si la compatibilité OSS fournie par le noyau n'est pas suffisante, vous pouvez
installer <c>alsa-oss</c>. Cela installera l'exécutable <c>aoss</c> qui peut
être utilisé de la manière suivante&nbsp;:
</p>

<pre caption="Compatibilité OSS accrue">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
Maintenant, installez les outils ALSA dans votre système (c'est
obligatoire)&nbsp;:
</p>

<pre caption="Installation des outils ALSA">
# <i>emerge alsa-utils</i>
</pre>

<p>
Maintenant que les outils sont installés, il est temps de configurer ALSA...
</p>

</body>
</section>
</chapter>

<chapter>
<title>Configuration d'ALSA</title>
<section>
<title>Chargement automatique des modules du noyau</title>
<body>

<p>
Si vous utilisez un noyau modulaire (comme c'est le cas avec <c>genkernel</c>),
vous devez éditer le fichier <path>/etc/modules.d/alsa</path> pour activer les
modules nécessaires lors du démarrage. Pour la carte son de l'exemple&nbsp;:
</p>

<pre caption="Dans /etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># Les lignes suivantes ne sont nécessaires que si vous souhaitez</comment>
<comment># la compatibilité avec OSS</comment>
alias sound-slot-0 snd-via82xx
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Maintenant, lancez <c>modules-update</c> pour intégrer les modifications que
vous venez d'appliquer au fichier <path>alsa</path> dans le fichier
<path>/etc/modules.conf</path>&nbsp;:
</p>

<pre caption="Exécution de modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>

<section>
<title>Vérification des fichiers de périphériques</title>
<body>

<p>
Normalement, tout est fait automatiquement dans les installations récentes. En
cas de problème, vérifiez que les périphériques et les permissions ALSA sont
correctement configurées par votre gestionnaire de /dev. Si vous utilisez DevFS,
vérifiez le fichier <path>/etc/devfsd.conf</path>&nbsp;:
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>

<section>
<title>Activer ALSA lors du démarrage</title>
<body>

<p>
Pour activer ALSA au démarrage du système, ajoutez le script d'initialisation
<c>alsasound</c> au niveau d'exécution «&nbsp;boot&nbsp;»&nbsp;:
</p>

<pre caption="Ajout de alsasound aux scripts de démarrage">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>

<section>
<title>Activer les canaux de la carte son</title>
<body>

<p>
Par défaut, tous les canaux sont muets. Lancez <c>amixer</c> pour corriger
cela&nbsp;:
</p>

<pre caption="Lancement de amixer">
# <i>amixer</i>
</pre>

<p>
Si <c>amixer</c> affiche beaucoup de texte, vous êtes alors prêt pour activer
les volumes. Si vous obtenez une erreur, vérifiez si le module de votre son est
correctement chargé.
</p>

<p>
Activez maintenant les canaux <e>Master</e> et <e>PCM</e>. Si cela n'est pas
suffisant, activez aussi les canaux <e>Center</e> et <e>Surround</e>.  Ne
mettez pas en sourdine les canaux pour lesquels vous ne pouvez pas changer le
volume, car cela pourrait aussi empêcher ALSA de produire un quelconque son.
</p>

<pre caption="Activer les canaux de la carte son">
<comment>(Si vous préférez utiliser un outil ncurses :)</comment>
# <i>alsamixer</i>

<comment>(sinon :)</comment>

# <i>amixer set Master 100% unmute</i>
# <i>amixer set PCM 100% unmute</i>
<comment>(Seulement si les commandes précédentes ne suffisent pas :)</comment>
# <i>amixer set Center 100% unmute</i>
# <i>amixer set Surround 100% unmute</i>
# <i>amixer set Headphone 100% unmute</i>
</pre>

<p>
Pour vérifier que le son marche bien, essayez de lire un fichier .wav (avec
<c>aplay</c>), un fichier .mp3 (avec <c>mpg123</c> ou même <c>mplayer</c>) ou
n'importe quel autre fichier qui produit du son.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Activation du support MIDI</title>
<section>
<title>Installation des paquets nécessaires</title>
<body>

<p>
Certaines cartes sons possèdent un synthétiseur MIDI intégré. Pour l'utiliser,
vous devez d'abord installer le paquet <c>awesfx</c>&nbsp;:
</p>

<pre caption="Installation du paquet awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Si vous avez déjà des polices sonores, placez-les dans
<path>/usr/share/sfbank/</path>. Par exemple, la SBLive est livrée avec un
fichier de polices appelé <path>8MBGMSFX.SF2</path> ou
<path>CT4GMSFX.SF2</path>.
</p>

<p>
Après avoir copié le fichier, sélectionnez-le avec <c>asfxload</c>&nbsp;:
</p>

<pre caption="Chargement de la police sonore">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Cette commande doit être lancée à chaque démarrage. Il est recommandé de
l'ajouter au fichier <path>/etc/conf.d/local.start</path>.
</p>

<p>
Si vous ne trouvez pas de polices sonores sur votre CD, vous pouvez en
télécharger depuis <uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>.
</p>

</body>
</section>

<section>
<title>Le synthétiseur virtuel Timidity++</title>
<body>

<p>
Si votre carte son n'a pas de synthétiseur matériel (ou vous ne voulez pas
l'utiliser), vous pouvez utiliser le synthétiseur virtuel de <c>timidity++</c>.
Commençons par installer le paquet&nbsp;:
</p>

<pre caption="Installation de Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Timidity a besoin de polices sonores pour produire du son. Si vous n'en avez
pas, vous pouvez installer les paquets <c>timidity-eawpatches</c> ou
<c>timidity-shompatches</c> qui vous en installerons quelques-unes. Vous pouvez
avoir plusieurs configurations de polices sonores installées et vous pouvez
placer les vôtres dans <path>/usr/share/timidity</path>. Pour basculer d'une
configuration vers une autre, vous pouvez utiliser l'utilitaire
<e>timidity-update</e> fourni avec le paquet timidity++.
</p>

<pre caption="Installation de polices sonores">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(ou)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
N'oubliez pas d'ajouter <c>timidity</c> au niveau d'exécution par défaut&nbsp;:
</p>

<pre caption="Ajout de timidity au niveau d'exécution par défaut">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>

<section>
<title>Test du support MIDI</title>
<body>

<p>
Vous pouvez utiliser <c>aplaymidi</c>, qui fait parti des <e>outils ALSA</e>,
pour tester votre configuration MIDI.
</p>

<p>
Pour voir quels ports en sortie MIDI sont disponibles sur votre système,
utilisez l'option <c>-l</c>&nbsp;:
</p>

<pre caption="Liste des ports en sortie MIDI">
# <i>aplaymidi -l</i>
</pre>

<p>
Si tout va bien, essayez de jouer un fichier MIDI pour vous assurer que tout
fonctionne. Vous pouvez définir le port MIDI à utiliser avec l'option
<c>-p</c>&nbsp;:
</p>

<pre caption="Jouer un fichier MIDI">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith's Theme.mid"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Remarques finales</title>
<section>
<title>Outils et firmware</title>
<body>

<p>
Certaines cartes sons peuvent utiliser les outils fournis par les paquets
<c>alsa-tools</c> et <c>alsa-firmware</c>. Si vous avez besoin de
<c>alsa-tools</c>, déclarez la variable ALSA_TOOLS dans le fichier
<path>/etc/make.conf</path> en indiquant les outils que vous voulez. Par
exemple&nbsp;:
</p>

<pre caption="Sélection des outils ALSA dans /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Vous pouvez ensuite installer les paquets <c>alsa-tools</c> (et/ou
<c>alsa-firmware</c>)&nbsp;:
</p>

<pre caption="Installation des outils ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>

<section>
<title>Connecter une manette de jeu</title>
<body>

<p>
Si votre carte son est équipée d'une connexion pour une manette de jeu, vous
voudrez peut-être l'activer. Vérifiez d'abord si le pilote de votre carte a un
paramètre pour joystick. Vous pouvez utiliser <c>modinfo</c> sur votre module
du noyau pour cela. Par exemple, pour le module <c>snd-via82xx</c>&nbsp;:
</p>

<pre caption="Exécution de modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio
             part of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Si le pilote de votre carte a un paramètre <c>joystick</c>, ajoutez
<c>joystick=1</c> sur la ligne <c>options</c> du fichier
<path>/etc/modules.d/alsa</path>. Par exemple&nbsp;:
</p>

<pre caption="Ajout du paramètre joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>

<section>
<title>Ressources</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">Page du projet ALSA</uri></li>
  <li><uri link="http://www.djcj.org/">FAQ et HOWTO ALSA</uri></li>
  <li>
    <uri link="http://linux-sound.org/">Programmes Linux pour le son et le
    MIDI</uri>
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
