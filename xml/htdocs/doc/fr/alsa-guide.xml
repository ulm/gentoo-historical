<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link = "/doc/fr/alsa-guide.xml">
<title>Gentoo Linux ALSA Guide</title>
<author title="Author"><mail link="zu@pandora.be">
	Vincent Verleye</mail>
</author>

<author title="Editor"><mail link="zhen@gentoo.org">
	John P. Davis</mail>
</author>
<author title="Traducteur"><mail link="takezo@skynet.be">
	Olivier Roomans</mail>
</author>

<abstract>
Ce guide va vous expliquer comment  mettre en place le "Advanced Linux Sound Architecture" [ALSA] sur Linux Gentoo.
En complement du Guide de configuration du bureau ("Gentoo Linux Desktop Configuration Guide"), ce guide est suppose vous donner plus
d'informations a ce sujet
</abstract>

<version>1.1</version>
<date>13 janvier 2003</date>

<chapter>
<title>Introduction</title>
<section>
	<title>Qu'est-ce que  ALSA?</title>
<body>
<p>
L'architecture son avancee linux (ALSA) est un projet pour ameliorer le sous-systeme de son en en reecrivant
une grande partie.
Il est prevu que ALSA soit integre dans le noyau 2.6.x (ou 3.x.x -- selon lequel arrivera le premier) des qu'il sera pret.

</p>

<p>
ALSA fournit des fonctionnalites audio et MIDI a Linux.
</p>

<p>
En citant <uri>http://www.alsa-project.org</uri>, ALSA a les caracteristiques suivantes :
<ul><li> Support efficace de tous les types d'interface audio, des cartes sons de l'utilisateur normal aux interfaces audio multicanaux professionnelles</li>
            <li> Drivers son completement modularises.</li>
            <li> SMP et thread-safe design.</li>
             <li> Libraire d'espace utilisateur (user space) (alsa-lib) pour simplifier la programmation d'applications et fournir des fonctionnalites de plus haut niveau</li>
	     <li>Support des anciennes API OSS, fournissant une compatibilite binaire pour la majorite des programmes OSS</li>
	      </ul>
Cependant, ALSA a beaucoup d'autre fonctionnalites, telles que le support pour la restitution  et l'enregistrement Full Duplex,
le support de cartes sons multiples, le mixage hardware de flux, des capacites de mixage etendues (pour supporter les fonctionnalites avancees
des nouvelles cartes sons), ...
</p>
</body>
</section>
<section>
	<title>Pourquoi utiliser  ALSA?</title>
<body>
<p>
Si votre carte son est supportee par le systeme de gestion de son du noyau Linux ou par le driver de son commercial OSS/4
qui peut etre trouve dans tous les noyaux linux  2.4.x, vous pouvez  tout aussi bien compiler <e>ces modules</e> pour utiliser avec votre carte son.
Si vous le souhaitez, lisez juste le <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/index.html">Linux Sound HOWTO</uri>.

</p>
<p>
Cependant, ces drivers OSS/4 ont quelques limitations (dont celle d'etre commerciaux).
ALSA est un essai pour aller au-dela de ces limitations et de le faire a la mode open source.
ALSA est un systeme de drivers son completement GPL et LGPL, qui fournit un systeme de qualite professionnelle pour enregistrer, jouer
et faire du sequencage MIDI.
</p>
</body>
</section>
<section>
	<title>Quelles sont les cartes supportees par ALSA ?</title>
<body>
<p>
ALSA essaye de supporter autant de (nouvelles) cartes que possible en fournissant des drivers open source.
Cependant, quelques vendeurs peuvent fournir des packages uniquement  binaires.

</p>
<p>Pour savoir si votre carte est supportee, vous pouvez trouver une matrice des cartes sons supportees et non-supportees ici :
<uri>http://www.alsa-project.org/alsa-doc/</uri>.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Installation</title>
<section>
	<title>Les modules du noyau</title>
<body>
<p>
Tant que nous utilisons toujours les sources du noyau 2.4.x, nous devons compiler les modules du noyau et les modules ALSA separemment.
</p>
<p>
Premierement, nous allons nous assurer que notre configuration du noyau est prete pour  etre utilisee avec ALSA.
Tout ce dont vous avez besoin dans la configuration de votre noyau est le support pour carte son (Sound Card Support) mis en tant que module(M).
Ceci va compiler <c>soundore.o</c>.
</p>
<p>
<note>
Il est possible que cela fonctionne egalement quand vous compilez le support pour carte son dans le noyau (y) a la place de le faire en module(M).
Cependant, la documentation officielle de ALSA suggere de le compiler en module, puisque ALSA va essayer de le charger.
</note>
</p>
<p>Si vous avez deja une configuration de noyau en fonctionnement, assurez-vous que vous avez enleve tous les drivers de son 
(excepte celui pour le support de carte son).
Si vous voulez le faire sans devoir rebooter, vous pouvez faire ainsi :
</p>
<pre>
# <c>cd /usr/src/linux</c>
# <c>cp .config ~/</c>
# <c>make mrproper</c>
# <c>cp ~/.config .</c>
# <c>make menuconfig</c>
</pre>
<p>
Maintenant selectionnez  <e>Sound Card Support</e> en tant que  Module (M) et deselectionnez tous les autres drivers son.
Quittez et repondez Y pour sauver la configuration de votre noyau.
Apres cela, compilez les modules :
</p>
<pre>
# <c>make dep clean</c>
# <c>make modules modules_install</c>
</pre>
<p>
Avant d'installer vos nouveaux modules, cette derniere ligne va supprimer tous les modules precedents
meme ceux d'une installation precedente d'ALSA.
</p>
<p>
<impo>
Cela signifie que, chaque fois que vous recompilerez votre noyau plus tard, vous DEVREZ recompiler <c>alsa-driver</c>.
</impo>
</p>
<p>
<note>Cependant, vous ne devrez pas reinstaller <c>nvidia-kernel</c>, les drivers nvidia sont dans un repertoire separe
dans <path>/lib/modules/*/video</path> et ne seront pas effacees par un <c>make modules modules_install</c>.
</note>
</p>
</body>
</section>

<section>
	<title>modules ALSA </title>
<body>

<p>
Maintenant, il est temps d'installer les drivers ALSA pour  votre(vos) carte(s) son. Si votre carte son est en PCI, vous pouvez
trouver le nom et le type de votre carte son en regardant la sortie de /proc/pci
<pre>#<c>cat /proc/pci  | grep audio</c></pre>
</p>

<p>
<warn>
Si vous avez une configuration precedente du son et qu'il n'y a pas encore de module son ALSA charge, dechargez-les <e>maintenant</e>.
Veriviez avec <c>lsmod</c> et utilisez <c>rmmod</c> pour decharger tous les modules son de votre systeme.
</warn>
</p>

<p>
Nous pouvons simplement faire un <c>emerge alsa-driver</c> maintenant, cela va compiler et installer <e>tous</e> les drivers son ALSA.
</p>
<p>
Cependant, pour economiser du temps, vous pouvez regarder le <e> Nom de Module (Module Name) </e> de votre(vos) carte(s) son sur la
<uri link="http://www.alsa-project.org/alsa-doc">matrice de carte son alsa</uri> dans la section  <e>Install</e> .
Pour moi, c'est <c>EMU10K1</c>, etant donne que j'ai une SBlive!.
Nous allons mettre la variable d'environnement ALSA_CARDS a cette valeur avant d'emerger, ainsi emerge ne compilera que le(s) driver(s) 
dont nous avons besoin.
</p>
<p>
<pre>
# <c>env ALSA_CARDS='emu10k1' emerge alsa-driver</c>
</pre>
</p>
<p>
<note>
Quand vous voulez installer les drivers ALSA pour plus d'une carte son, vous pouvez  configurer ALSA_CARDS avec une liste separee par des espaces
comme ceci : <c>env ALSA_CARDS='emu10k1 intel8x0 ens1370' emerge alsa-driver</c>
</note>

<note>Si vous desirez avoir la compatibilite avec OSS, assurez-vous de faire un emerge de <i>alsa-oss</i>, 
c'est le wrapper de compatibilite ALSA/OSS
</note>

</p>
<p>
Apres cela, les modules ALSA devraient etre installes sur votre systeme.
</p>
</body>
</section>
<section>
	<title>Configuration de ALSA</title>
<body>
<p>
Configurons maintenant ALSA pour qu'il fonctionne correctement.
Nous allons devoir editer quelques fichiers, pour mettre notre systeme au courant des modules ALSA
fraichement installes.
</p>
<p>
Le premier fichier a editer est <path>/etc/modules.d/alsa</path>.
</p>
<warn>
Il n'y a pas besoin d'editer <path>/etc/modules.conf</path>. A la place, editez toujours les fichiers dans <path>/etc/modules.d</path>.
</warn>
<p>
Verifiez la partie ALSA <e> au sommet du fichier </e>.
En ajoutant cette ligne, vous pouvez specifier le nombre maximum de cartes son que vous avez (en general, juste une).
</p>
<p>
<pre caption="au sommet de /etc/modules.d/alsa">
# Alsa 0.9.X kernel modules' configuration file.
# $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/alsa-guide.xml,v 1.1 2003/01/16 04:06:43 zhware Exp $

# ALSA portion
alias char-major-116 snd
<c>options snd snd_major=116 snd_cards_limit=1</c>
# OSS/Free portion
alias char-major-14 soundcore

##
## IMPORTANT:
</pre>
</p>
<p>
Maintenant nous allons specifier le(s) driver(s) ALSA qui doivent etre utilises.
Dans le meme fichier, editer de la maniere suivante :
<pre caption="Un peu plus bas dans /etc/modules.d/alsa">
## and then run `update-modules' command.
## Read alsa-driver's INSTALL file in /usr/share/doc for more info.
##
##  ALSA portion
<c>alias snd-card-0 snd-emu10k1</c>
<c>## If you have more than one, add:
## alias snd-card-1 snd-intel8x0
## alias snd-card-2 snd-ens1370</c>
##  OSS/Free portion
## alias sound-slot-0 snd-card-0
## alias sound-slot-1 snd-card-1
##
</pre>
</p>
<p>
<note>
Si vous avez plus d'une carte son, ajustez la valeur de <c>snd_cards_limit</c> et ajoutez plus d'alias snd-card au fichier.
Je n'ai pas essaye ca, mais vous pouvez trouver des exemples de configuration avec deux ou plusieurs cartes son au :
<uri link="http://www.alsa-project.org/alsa-doc/alsa-howto/c1660.htm">Chapitre 6</uri>
du <uri link="http://www.alsa-project.org/alsa-doc/alsa-howto/alsa-howto.html">ALSA Howto</uri>.
</note>
</p>
<p>
La derniere chose a faire dans ce fichier, tout a la fin, verifiez si ces lignes sont presentes et de-commentees :
<pre caption="Tout a la fin de /etc/modules.d/alsa">
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>
</p>
<p>
Maintenant, reverifiez le fichier <path>/etc/modules.d/alsa</path> et quand vous etes sur que tout est ok, executez <c>update-modules</c>.

<pre>
# <c>update-modules</c>
</pre>
</p>
<note>
En lancant  <c>update-modules</c> , on va inserer les donnees de <path>/etc/modules.d/alsa</path> dans <path>/etc/modules.conf</path>
</note>
<p>
Vous devriez aussi verifier que /etc/defsd.conf a les peripheriques alsa et les permissions enregistrees correctement
</p>
<pre>
# nano -w /etc/devfsd.conf
</pre>
<pre>
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>
<note>
Notez que devfsd.conf mets les permissions de /dev/sound a root.audio. C'est pourquoi, les utilisateurs non-root qui doivent utiliser l'audio doivent faire
partie du groupe audio.
</note>
</body>
</section>
</chapter>
<chapter>
<title>Lancer ALSA</title>
<section>
	<title>Ajouter alsasound  a un runlevel</title>
<body>
<p>
La premiere chose a faire maintenant est de faire en sorte que ALSA se lance au demarrage. Ansi :
<pre>
# <c>rc-update add alsasound boot</c>
</pre>
</p>
<p>
<warn>Notez que le script alsasound doit etre ajouter au runlevel "boot" , et non pas au runlevel "default"
</warn>
</p>
</body>
</section>
<section>
	<title>Lancement et activation du son</title>
<body>
<p>
Etant donne que nous sommes des utilisateurs de Linux, nous ne voulons pas rebooter. Donc nous allons lancer
le script alsasound a la main.
</p>
<pre>
# <c>/etc/init.d/alsasound start</c>
</pre>
<p>
Maintenant, ALSA tourne. Si tout est ok, vous devriez pouvoir voir les modules ALSA chargez en lancant <c>lsmod</c>.
Cependant, le son ne marchera pas encore, parce que tous les canaux sont "muets". Nous avons besoin de <c>alsa-utils</c> pour ca.
</p>
<pre>
# <c>emerge alsa-utils</c>
# <c>amixer</c>
</pre>
<p>
<warn>
Vous ne devriez pas, mais <e>si</e> vous avez une erreur disant "amixer: Mixer attach default error: No such file or directory", vous devrez faire un
insmod de
<c>snd-mixer-oss</c> et <c>snd-pcm-oss</c> . Apres cela, lancez amixer a nouveau.
</warn>
</p>
<pre caption="uniquement si vous avez une erreur en lancant amixer">
# <c>insmod snd-mixer-oss</c>
# <c>insmod snd-pcm-oss</c>
# <c>amixer</c>
</pre>
<p>
Si vous etes arrivez ici, augmentez a present les cannaux Master et PCM.
</p>
<p>
<pre>
# <c>amixer set Master 100 unmute</c>
# <c>amixer set PCM 100 unmute</c>
# <c>aplay /usr/kde/3/share/sounds/pop.wav</c> <codenote>(pop.wav fait partie de KDE)</codenote>
</pre>
</p>
Nous verifions si le son marche en utilisant la commande aplay (alsa play). Si vous entendez un pop, alors le son marche !.
Puis, ajustez les reglages de volume votre convenance; le programme base sur ncurses <c>alsamixer</c> est un bon moyen de le faire.
<p>
Vous desirez peut-etre emerger <c>alsa-xmms</c> qui fournit le support ALSA pour XMMS.
</p>
Quand vous rebootez votre systeme, le script d'initialisation <e>alsasound</e> va sauver et restaurer proprement vos reglages de volume.
</body>
</section>
</chapter>
<chapter>
<title>Notes finales</title>
<section>
	<title>Apres des mises a jour de noyau ...</title>
<body>
<p>A chaque fois que vous recompilez votre noyau ou que vous passez a un autre noyau, vous devez rebuilder les modules ALSA.</p>

<p>Cependant, si vous avez installe <c>alsa-driver</c>, <c>alsa-libs</c> et <c>alsa-utils</c>, seul le premier doit
etre reinstalle a nouveau, puisque il va mettre les modules alsa dans

<path>/lib/modules/*/kernel/sound/pci/</path>.</p>
<pre caption="necessaire apres chaque compilation de noyau">
emerge alsa-driver
</pre>
</body>
</section>
<section>
	<title>/etc/modules.autoload</title>
<body>
<p>Vous ne devez pas editer ce fichier pour utiliser ALSA. Apres notre <c>rc-update add alsasound boot</c>, notre system
va charger les bons modules au demarrage.
</p>
<p>Il n'est pas necessaire d'ajouter <c>snd-pcm-oss</c> ou <c>snd-mixer-oss</c> dans ce fichier.
Allez voir 
<uri link="http://www.djcj.org/LAU/guide/alsbook/faq1.html">cette FAQ</uri> pour plus d'informations.</p>
</body>
</section>
<section>
	<title>Quelques liens supplementaires..</title>
<body>
<p>
Vous pouvez allez voir ici pour plus d'informations :
</p>
<p>
<ul>
<li><uri link="http://www.gentoo.org/doc/fr/desktop.html">The Gentoo Linux Desktop Configuration Guide</uri></li>
<li><uri link="http://www.alsa-project.org">ALSA Project Homepage</uri></li>
<li><uri link="http://www.alsa-project.org/documentation.php3">ALSA Users Documentation</uri></li>
<li><uri link="http://www.djcj.org">ALSA Howto's and FAQ's</uri></li>
<li><uri link="http://tldp.org/HOWTO/Sound-HOWTO/index.html">Linux Sound HOWTO</uri></li>
<li><uri link="http://linux-sound.org/">Sound and MIDI Software For Linux</uri></li>
</ul>
</p>
</body>
</section>
</chapter>
</guide>
