<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/alsa-guide.xml,v 1.31 2006/04/04 09:50:21 neysx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/alsa-guide.xml" lang="fr">
<title>Guide ALSA pour Gentoo Linux</title>

<author title="Auteur">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Traducteur">
 <mail link="ribosome@gentoo.org">Olivier Fisette</mail>
</author>

<abstract>
Ce document vous guidera pour configurer ALSA avec Gentoo Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.11</version>
<date>2006-03-25</date>

<chapter>
<title>Introduction</title>
<section>
<title>Qu'est-ce que ALSA&nbsp;?</title>
<body>

<p>
ALSA (<e>Advanced Linux Sound Architecture</e> ou architecture avancée pour le
son sous Linux) fournit les fonctionnalités audio et MIDI (<e>Musical
Instrument Digital Interface</e> ou interface numérique pour les instruments de
musique) dans le système d'exploitation Linux. ALSA est le système sonore par
défaut dans les noyaux de la série 2.6. Il a remplacé OSS (<e>Open Sound
System</e>) qui était utilisé dans les noyaux 2.4.
</p>

<p>
Les fonctionnalités principales de ALSA comprennent le support pour une variété
d'interfaces audio allant des cartes de son entrée de gamme jusqu'à
l'équipement professionnel, des pilotes entièrement modulaires, l'intégration
fiable des fils d'exécution et le SMP, une compatibilité rétroactive avec OSS
et une bibliothèque pour l'espace utilisateur (<c>alsa-lib</c>) qui rend le
développement d'applications on ne peut plus facile.
</p>

</body>
</section>
<section>
<title>ALSA dans les systèmes Gentoo</title>
<body>

<p>
Une des principales forces de Gentoo est que l'utilisateur a le plein contrôle
sur l'installation et la configuration de son système. L'utilisation de ALSA
dans Gentoo suit ce principe. Il existe deux méthodes différentes pour mettre
en place le support ALSA sur votre système. Celles-ci sont présentées en
détails à la section suivante.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installer ALSA</title>
<section>
<title>Options</title>
<body>

<warn>
Les méthodes décrites ci-dessous sont mutuellement exclusives. Vous ne pouvez à
la fois compiler ALSA dans votre noyau et utiliser
<c>media-sound/alsa-driver</c>. Si vous le faites, votre système générera des
erreurs.
</warn>

<p>
Les deux méthodes sont&nbsp;:
</p>

<ol>
  <li>
    Utiliser l'implémentation de ALSA fournie par votre noyau. Il s'agit de la
    méthode recommandée.
  </li>
  <li>
    Utiliser le paquet logiciel <c>media-sound/alsa-driver</c> de Gentoo.
  </li>
</ol>

<p>
Voici un aperçu des deux méthodes qui vous aidera à faire votre choix.
</p>

<p>
Les avantages et les inconvénients reliés à l'utilisation de l'implémentation
de ALSA présente dans le noyau sont les suivants&nbsp;:
</p>

<table>
<tr>
  <th>ALSA dans le noyau</th>
  <th>Avantages et inconvénients</th>
</tr>
<tr>
  <th>+</th>
  <ti>Très stable puisque les pilotes sont intégrés avec le noyau.</ti>
</tr>
<tr>
  <th>+</th>
  <ti>
    Solution définitive qui ne requiert pas de réinstallations
    périodiques.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>Parfois légèrement moins à jour que <c>alsa-driver</c>.</ti>
</tr>
</table>

<p>
Voici ceux reliés à l'utilisation de <c>alsa-driver</c>&nbsp;:
</p>

<table>
<tr>
  <th>alsa-driver</th>
  <th>Avantages et inconvénients</th>
</tr>
<tr>
  <th>+</th>
  <ti>Ce sont les pilotes les plus récents du projet ALSA.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Vous devez réinstaller <c>alsa-driver</c> chaque fois que vous recompilez
    votre noyau.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
    Nécessite que certaines options du noyau soient désactivées pour
    fonctionner correctement.
  </ti>
</tr>
</table>

</body>
</section>
<section>
<title>Finalement...</title>
<body>

<p>
La principale différence entre <c>alsa-driver</c> et l'implémentation de ALSA
présente dans le noyau est que <c>alsa-driver</c> contient des pilotes plus
récents. Puisque cela fait généralement très peu de différence, vous êtes
encouragé à utiliser l'implémentation du noyau, car elle est plus simple à
gérer. Avant de rapporter un bogue relatif au son sur le <uri
link="https://bugs.gentoo.org">Bugzilla Gentoo</uri>, veuillez tenter de le
reproduire en utilisant <c>alsa-driver</c> (et rapportez le bogue quel que soit
le résultat).
</p>

</body>
</section>
<section id="lspci">
<title>Avant de poursuivre</title>
<body>

<p>
Peu importe la méthode d'installation choisie, il vous faut savoir quels
pilotes sont utilisés par votre carte de son. Dans la plupart des cas, les
cartes de son (intégrées à la carte-mère ou non) sont de type PCI&nbsp;;
<c>lspci</c> vous aidera à trouver l'information nécessaire. Si <c>lspci</c>
n'est pas déjà installé sur votre système, il vous faudra d'abord l'installer
avec la commande&nbsp;: <c>emerge sys-apps/pciutils</c>. Si vous avez une
carte USB, le programme <c>lsusb</c> du paquet <c>sys-apps/usbutils</c> vous
sera <e>peut-être</e> utile. Pour les cartes ISA, essayez les utilitaires
<c>sys-apps/isapnptools</c>. Les pages Web suivantes vous aideront
<e>peut-être</e> si vous possédez une carte ISA.
</p>

<ul>
  <li>
    <uri link="http://www.roestock.demon.co.uk/isapnptools/">La page de
    ISAPNPTOOLS</uri>
  </li>
  <li>
    <uri link="http://www2.linuxjournal.com/article/3269">Un article de
    LinuxJournal sur PnP
  </uri>
  </li>
  <li>
    <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">Le HowTo de
    TLDP sur le son
  </uri>
  </li>
</ul>

<note>
Afin de simplifier les explications, nous supposerons tout au long de ce guide
que votre carte de son est de type PCI.
</note>

<p>
Voici comment obtenir des informations relatives à la carte de son&nbsp;:
</p>

<pre caption="Informations sur la carte de son">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
Nous savons maintenant que la carte de son de l'ordinateur est une Sound
Blaster Live! et que le manufacturier de la carte est Creative Labs.
Reportez-vous à la page <uri link="http://www.alsa-project.org/alsa-doc/"> ALSA
Soundcard Matrix</uri>  et choisissez Creative Labs dans le menu déroulant.
Vous serez renvoyé sur la page du matériel de Creative Labs où vous verrez que
la carte SB Live! utilise le module <c>emu10k1</c>. C'est toute l'information
dont nous avons besoin pour l'instant. Toutefois, si vous êtes curieux, vous
pouvez suivre le lien qui vous amènera sur la page spécifique à <c>emu10k1</c>
pour y lire de l'information détaillée.
</p>

</body>
</section>
<section id="kernel">
<title>Utiliser l'implémentation de ALSA disponible dans le noyau</title>
<body>

<p>
Si, comme moi, vous n'aimez pas compliquer inutilement les choses, la marche à
suivre suivante vous conviendra.
</p>

<note>
Depuis la sortie de la version 2005.0, Gentoo Linux utilise par défaut le
noyau 2.6. À moins de spécifier un profil 2.4, le paquet <c>gentoo-sources</c>
installera un noyau 2.6 sur la <e>plupart</e> des architectures. Veuillez
vérifier que votre noyau fait partie de la série 2.6. Les instructions
suivantes ne fonctionneront <e>pas</e> avec un noyau 2.4.
</note>

<p>
Configurons le noyau pour activer ALSA.
</p>

<impo>
Les utilisateurs de <c>genkernel</c> devraient exécuter <c>genkernel
--menuconfig all</c> puis suivre les instructions de l'exemple de code <uri
link="#doc_chap2_pre3">Options du noyau pour ALSA</uri>.
</impo>

<pre caption="Ouvrir le menu de configuration des sources">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
L'exemple ci-dessus suppose que le lien symbolique <path>/usr/src/linux</path>
pointe vers les sources du noyau que vous voulez utiliser. Assurez-vous que
c'est bien le cas sur votre système avant de continuer.
</note>

<p>
Nous allons maintenant passer en revue quelques-unes des options que vous
devrez activer pour obtenir le support ALSA pour votre carte de son.
</p>

<p>
Notez que par souci de simplicité, tous les exemples qui suivent utilisent des
modules pour le support ALSA. Nous vous recommandons de procéder de la même
façon, puisque cela permet d'utiliser <c>alsaconf</c>, ce qui facilite
grandement la configuration de votre carte.
</p>

<pre caption="Options du noyau pour ALSA">
Device Drivers  ---&gt;
   Sound  ---&gt;

<comment>(Cette option doit être activée.)</comment>
&lt;M&gt; Sound card support

<comment>(Assurez-vous que OSS est désativé.)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(Reculez d'un écran puis entrez dans la section ALSA.)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Sélectionnez cette option si vous voulez du support MIDI.)</comment>
   &lt;M&gt; Sequencer support
   <comment>(Périphériques /dev/mixer* et /dev/dsp* dans l'ancien style. Recommandé.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API

<comment>(Vous devez maintenant choisir pour quel matériel vous souhaitez activer le
support. Habituellement, vous disposez d'une seule carte. Toutefois, si vous
en avez plus d'une, activez le support pour chacune de vos cartes.)</comment>

<comment>(Surtout pour le développement et les tests ; n'est pas nécessaire pour une
utilisation de tous les jours, sauf si vous savez ce que vous faites.)</comment>
Generic devices  ---&gt;

<comment>(Pour les cartes de son ISA.)</comment>
ISA devices   ---&gt;
<comment>(Si vous aviez une carte Gravis, il vous faudrait sélectionner cette option.)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Reculez d'un écran et allez à la section du matériel PCI. La plupart des
cartes de son sont ajourd'hui PCI.)</comment>
PCI devices   ---&gt;
   <comment>(Sélectionnez le pilote emu10k1 pour votre carte.)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(Ou le pilote pour une carte Intel.)</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(Ou encore celui pour une carte VIA.)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(Reculez d'un écran et choisissez le pilote approprié si vous avez une carte
USB.)</comment>
USB Devices   ---&gt;
</pre>

<p>
Maintenant que vous avez choisi les options dont vous avez besoin, vous pouvez
(re)compiler le noyau. Le support ALSA devrait être activé lorsque vous
redémarrerez avec votre nouveau noyau. N'oubliez pas de mettre à jour votre
configuration de GRUB pour utiliser le noyau fraîchement compilé. Poursuivez
votre lecture avec la section <uri link="#alsa-utilities">Utilitaires ALSA</uri>
et vérifiez que tout fonctionne correctement.
</p>

</body>
</section>
<section id="alsa-driver">
<title>Utiliser le paquet «&nbsp;ALSA Driver&nbsp;»</title>
<body>

<p>
Ainsi vous avez décidé d'utiliser <c>alsa-driver</c>. Allons-y&nbsp;! Nous
devons d'abord nous occuper de quelques détails afin que seuls les pilotes
nécessaires pour votre carte de son soient compilés. Bien que cela ne soit pas
absolument nécessaire, cela réduit substantiellement le temps requis pour
l'installation en ne compilant pas les pilotes qui seraient de toute façon
inutiles.
</p>

<p>
Si vous ne savez pas quels pilotes sont nécessaires à votre carte de son,
jetez un œil à la section de ce guide portant sur <uri
link="#lspci">lspci</uri>. Une fois identifié le nom du pilote (<c>emu10k1</c>
dans notre exemple), éditez <path>/etc/make.conf</path> et ajoutez-y la
variable <c>ALSA_CARDS</c>.
</p>

<pre caption="Ajouter ALSA_CARDS à make.conf">
<comment>(Pour une seule carte de son :)</comment>
ALSA_CARDS="emu10k1"
<comment>(Pour spécifier plus d'une carte, séparez les noms avec des espaces :)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Si vous avez déjà compilé votre noyau et que vous voulez utiliser
<c>alsa-driver</c>, vous devez procéder à un test pour vous assurer que votre
système est correctement configuré. Si ce n'est pas le cas, vous ferez
probablement face à des erreurs lorsque vous tenterez d'installer
<c>alsa-driver</c>. L'exemple de code ci-bas illustre comment réaliser ces
vérifications.
</p>

<note>
Les utilisateurs de <c>genkernel</c> peuvent passer directement à la section
<uri link="#doc_chap2_pre6">Installer alsa-driver</uri> puisque leur
configuration est identique à celle montrée ci-dessous.
</note>

<ol>
  <li>
    <c>CONFIG_SOUND</c> doit être activé (fonctionnalités de base pour le son).
  </li>
  <li>
    <c>CONFIG_SOUND_PRIME</c> doit être désactivé (support intégré de OSS).
  </li>
  <li>
    <c>CONFIG_SND</c> doit être désactivé (support intégré de ALSA).
  </li>
  <li>
    <path>/usr/src/linux</path> doit pointer vers le noyau que vous voulez
    utiliser avec ALSA.
  </li>
</ol>

<pre caption="Vérification de .config">
<comment>(Nous assumons que le lien symbolique linux pointe vers le bon noyau.)</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(1. Ok)</comment>
CONFIG_SOUND=y
<comment>(2. Ok)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(Et 3. Ok)</comment>
CONFIG_SND is not set
</pre>

<p>
Il ne reste qu'à taper les mots magiques... et non, ce n'est pas abracadabra.
</p>

<pre caption="Installer alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Notez que vous devrez exécuter <c>emerge alsa-driver</c> à chaque fois que
vous (re)compilerez le noyau, puisque les anciens pilotes sont supprimés.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Configurer et tester ALSA</title>
<section id="alsa-utilities">
<title>Utilitaires ALSA</title>
<body>

<p>
<c>alsa-utils</c> fait partie intégrale de ALSA et propose une variété de
programmes fort utiles, incluant les scripts d'initialisation de ALSA. C'est
pourquoi nous vous recommandons de l'installer&nbsp;:
</p>

<pre caption="Installer alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Si vous avez activé ALSA dans le <uri link="#kernel">noyau</uri> <e>et</e> que
vous n'avez pas compilé ALSA en temps que module, passez tout de suite à la
section <uri link="#initscript">script d'initialisation de ALSA</uri>.
Autrement, vous devez configurer ALSA, ce qui est rendu très facile par
l'existence de l'outil <c>alsaconf</c>. (Ce dernier fait partie de
<c>alsa-utils</c>.)
</note>

</body>
</section>
<section id="alsa-config">
<title>Configuration</title>
<body>

<note>
Veuillez fermer tout programme qui <e>pourrait</e> utiliser la carte de son
avant d'exécuter <c>alsaconf</c>.
</note>

<p>
La façon la plus simple de configurer ALSA est d'exécuter <c>alsaconf</c>.
Tapez simplement <c>alsaconf</c> dans un shell en tant qu'utilisateur root.
</p>

<pre caption="Lancer alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Vous serez accueilli par une interface agréable basée sur un système de menus
qui tentera de détecter automatiquement votre carte de son en interrogeant
votre matériel. On vous offrira alors une liste où vous devrez choisir votre
carte. Une fois cela fait, on vous demandera si vous désirez que le programme
modifie automatiquement <path>/etc/modules.d/alsa</path> pour y incorporer les
changements nécessaires. Ensuite, le programme ajustera vos paramètres de
volume à des niveaux optimum, exécutera <c>modules-update</c> et démarrera le
service <path>/etc/init.d/alsasound</path>. Une fois que <c>alsaconf</c> a
terminé son travail, vous pouvez continuer avec la mise en place du script
d'initialisation de ALSA.
</p>

</body>
</section>
<section id="initscript">
<title>Le script d'initialisation de ALSA</title>
<body>

<p>
Nous avons presque terminé. Peu importe la méthode que vous avez choisie pour
installer ALSA, vous aurez besoin de charger vos modules, d'initialiser ALSA
et de restaurer vos paramètres de volume lors du démarrage. Le script
d'initialisation de ALSA (nommé <c>alsasound</c>) s'occupe de tout cela.
Ajoutez-le au niveau d'exécution du démarrage.
</p>

<pre caption="Ajouter ALSA au niveau d'exécution du démarrage">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Il ne vous reste qu'a vérifier le fichier <path>/etc/conf.d/alsasound</path>
pour vous assurer que la variable SAVE_ON_STOP est réglée à «&nbsp;yes&nbsp;».
Ainsi, vos paramètres de volume seront sauvegardés lorsque vous redémarrerez
ou éteindrez l'ordinateur.
</p>

</body>
</section>
<section>
<title>Le groupe audio</title>
<body>

<p>
Avant de tester votre système, il faut s'occuper d'un dernier détail
<e>important</e>. Règle générale pour les systèmes UNIX&nbsp;: N'utilisez pas
le compte root à moins que cela ne soit absolument nécessaire. Cela s'applique
au cas présent. Comment&nbsp;? La plupart du temps, vous êtes connecté en tant
qu'utilisateur et voulez écouter de la musique ou utiliser votre carte de son.
Pour cela, vous devez faire partie du groupe <c>audio</c>. C'est pourquoi nous
allons maintenant ajouter les utilisateurs au groupe audio afin qu'ils n'aient
pas de problème pour accéder aux périphériques sonores. Nous utiliserons
l'utilitaire <c>gpasswd</c>. Vous devez être connecté avec le compte root.
</p>

<pre caption="Ajouter des utilisateurs au groupe audio">
<comment>(Remplacez &lt;nom_d'utilisateur&gt; par le nom approprié.)</comment>
# <i>gpasswd -a &lt;nom_d'utilisateur&gt; audio </i>
Adding user &lt;nom_d'utilisateur&gt; to group audio
</pre>

</body>
</section>
<section>
<title>Vérifier le volume</title>
<body>

<p>
Nous en avons fini avec les prérequis et la configuration. Lançons ALSA&nbsp;!
Si vous avez utilisé <c>alsaconf</c>, vous pouvez sauter cette étape puisque
<c>alsaconf</c> s'en est occupé pour vous.
</p>

<pre caption="Démarrer le service">
<comment>(Si ALSA a été compilé en modules :)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Loading: snd-card-0 ...        [ ok ]
 * Loading: snd-pcm-oss ...       [ ok ]
 * Loading: snd-seq ...           [ ok ]
 * Loading: snd-emu10k1-synth ... [ ok ]
 * Loading: snd-seq-midi ...      [ ok ]
 * Restoring Mixer Levels ...     [ ok ]
<comment>(Si ALSA a été compilé dans le noyau :)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Restoring Mixer Levels ...     [ ok ]
</pre>

<p>
Maintenant que nous nous sommes occupé du nécessaire, vérifions les niveaux du
volume&nbsp;; dans certains cas, les canaux sont muets. Pour ce faire, nous
utiliserons <c>alsamixer</c>.
</p>

<pre caption="Ouvrir alsamixer">
<comment>(Ouvre le programme en mode console. Seuls les paramètres requis sont affichés.)</comment>
# <i>alsamixer</i>
</pre>

<impo>
Si vous éprouvez des difficultés avec <c>alsamixer</c> et que des erreurs se
produisent telles que&nbsp;: «&nbsp;alsamixer: function snd_ctl_open failed
for default: No such file or directory&nbsp;», vous avez sans doute un
problème avec la gestion du matériel par <c>udev</c>. Exécutez <c>killall
udevd; udevstart</c> pour recharger les entrées du répertoire
<path>/dev</path>, puis lancez <c>alsamixer</c>. Cela devrait résoudre vos
problèmes.
</impo>

<p>
Voici ce à quoi ALSA Mixer ressemblera <e>peut-être</e> la première fois que
vous l'éxécuterez. Portez attention aux canaux «&nbsp;Master&nbsp;» et
«&nbsp;PCM&nbsp;» sous lesquels on voit la mention MM, ce qui signifie qu'ils
sont muets. Si vous essayez de jouer un son avec <c>alsamixer</c> dans ces
circonstances, vous n'entendrez rien.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="Alsa Mixer muet"
caption="La fenêtre principale de Alsa Mixer, les canaux encore muets"/>

<p>
Maintenant, sortons les canaux du mode muet, et ajustons le volume.
</p>

<warn>
Vous devez activer <e>à la fois</e> les canaux «&nbsp;Master&nbsp;» et
«&nbsp;PCM&nbsp;» (et régler leur volume à un niveau audible) pour pouvoir
entendre du son.
</warn>

<ul>
  <li>
    Pour vous déplacer entre les canaux, utilisez les flèches vers la droite
    et vers la gauche (&lt;- et -&gt;).
  </li>
  <li>
    Pour activer/désactiver le mode muet, allez sur le canal désiré (par
    exemple «&nbsp;Master&nbsp;») puis tapez <c>m</c>.
  </li>
  <li>
    Pour augmenter ou diminuer le niveau du volume, utilisez les flèches vers
    le haut ou vers le bas, respectivement.
  </li>
</ul>

<note>
Faites attention lorsque vous ajustez les valeurs des basses et des aigus. 50
est habituellement un niveau approprié pour les deux. De très hautes valeurs
pour les basses peuvent causer de la <e>distortion</e> sur les haut-parleurs
qui ne le supportent pas.
</note>

<p>
Lorsque vous aurez terminé, votre mixeur ALSA devrait ressembler à celui-ci.
Notez les 00 qui ont remplacé les MM, et aussi les niveaux de volume qui ont
été ajustés à des valeurs optimales.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="Alsa Mixer, non muet"
caption="Alsa Mixer fin prêt !"/>

</body>
</section>
<section>
<title>Vérification du son</title>
<body>

<p>
Enfin&nbsp;! Un peu de musique&nbsp;! Si tout ce qui précède s'est bien
déroulé, vous devriez être capable d'écouter de la musique. Utiliser une
application en mode ligne de commande telle que <c>media-sound/madplay</c> est
une manière facile de faire ce test. Bien sûr, vous pourriez utiliser un
logiciel un peu plus connu tel que <c>mpg123</c> ou <c>xmms</c>. Si vous êtes
un fanatique du format ogg, vous pouvez utiliser <c>ogg123</c>, fourni par le
paquet <c>media-sound/vorbis-tools</c>. Utilisez n'importe quel lecteur avec
lequel vous êtes confortable. Comme toujours, il suffit d'utiliser
<c>emerge</c> pour l'installer.
</p>

<pre caption="Installer un lecteur audio">
<comment>(Installer l'application que vous désirez :)</comment>
# <i>emerge madplay mpg123 xmms</i>
<comment>(Pour jouer des fichiers .ogg :)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
Puis faites jouer votre chanson favorite.
</p>

<pre caption="Faire jouer de la musique">
# <i>madplay -v /mnt/shyam/Music/Paul\ Oakenfold\ -\ Dread\ Rock.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Dread Rock
         Artist: Paul Oakenfold
          Album: Matrix Reloaded
           Year: 2003
          Genre: Soundtrack
                 Soundtrack
 00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 Paul\ Oakenfold\ -\ Dread\ Rock.ogg</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Paul Oakenfold - Dread Rock.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Soundtrack
Transcoded: mp3;160
Title: Dread Rock
Artist: Paul Oakenfold
Date: 2003
Album: Matrix Reloaded
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>

</body>
</section>
<section>
<title>ALSA et USE</title>
<body>

<p>
Vous pouvez maintenant ajouter <c>alsa</c> aux options de votre variable USE
dans <path>/etc/make.conf</path> afin de vous assurer que le support ALSA est
présent dans vos applications. Sur certaines architectures, telles que x86 et
amd64, cette option est activée par défaut.
</p>

</body>
</section>
<section>
<title>Des problèmes&nbsp;?</title>
<body>

<p>
Si vous êtes incapable d'entendre du son, la première chose à vérifier est le
réglage de <uri link="#doc_chap3_pre6">alsamixer</uri>. 80&nbsp;% des
problèmes impliquent un canal muet ou dont le volume est trop bas. Consultez
aussi l'applet de configuration du son de votre gestionnaire de fenêtres pour
vous assurer que le volume est réglé à un niveau audible.
</p>

<p>
<path>/proc</path> est votre ami. Dans le cas présent,
<path>/proc/asound</path> se révélera votre meilleur ami. Jetons un coup d'œil
à l'information que vous pouvez y consulter.
</p>

<pre caption="S'amuser avec /proc/asound">
<comment>(D'abord et avant tout, si /proc/asound/cards contient votre carte, ALSA
a correctement reconnu celle-ci.)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Si vous utilisez l'implémentation de ALSA du noyau et vous demandez,
comme moi, jusqu'à quel point votre version date par rapport à alsa-driver,
voici comment afficher la version actuelle de ALSA :)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(Détails de l'émulation OSS par ALSA :)</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
Un autre problème très souvent rencontré par les utilisateurs est la fameuse
erreur «&nbsp;Unknown symbol in module&nbsp;». En voici un exemple&nbsp;:
</p>

<pre caption="Erreur « Unknown Symbol in module »">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
Et lorsque vous regardez dans le <c>dmesg</c> comme suggéré&nbsp;:
</p>

<pre caption="Sortie de dmesg">
<comment>(Seules les lignes intéressantes ont été conservées.)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) -> IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
Le problème ci-dessus apparaît lorsque vous passez des pilotes du paquet
<c>alsa-driver</c> à ceux intégrés au noyau. Lorsque vous désinstallez le paquet
<c>alsa-driver</c>, les fichiers des modules sont protégés et ne sont pas
effacés, ce qui crée un mélange des deux versions des pilotes et ne fonctionne
pas.
</p>

<p>
La solution est très simple. Vous n'avez qu'à supprimer manuellement les
fichiers qui causent problème, après avoir désinstallé le paquet
<c>alsa-driver</c>. Assurez-vous de retirer la bonne version des pilotes et de
ne pas effacer les pilotes actuels&nbsp;!
</p>

<pre caption="Effacer les modules du paquet alsa-driver">
<comment>(Remplacez VERSION par la version de votre noyau.)</comment>
# <i>rm -rf /lib/modules/VERSION/alsa-driver</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Autres possibilités de ALSA</title>
<section>
<title>Activer le support MIDI</title>
<body>

<p>
Si votre carte comprend un synthétiseur MIDI intégré et que vous voulez
écouter des fichiers .mid, vous devrez installer <c>awesfx</c>, un ensemble
d'utilitaires pour contrôler le pilote AWE32. Si vous n'avez pas de
synthétiseur matériel, vous pouvez utiliser un synthétiseur virtuel. Consultez
la section <uri link="#vsynth">Synthétiseurs virtuels</uri> pour plus
d'information.
</p>

<pre caption="Installer awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Vous devrez ensuite copier les fichiers SoundFont (SF2) à partir du CD des
pilotes de votre carte de son ou d'une installation de Windows dans le
répertoire <path>/usr/share/sounds/sf2/</path>. Par exemple, la police de son
pour la carte Creative SBLive! se nomme 8MBGMSFX.SF2.
</note>

<p>
Après avoir copié les fichiers SoundFont, vous pouvez jouer un fichier MIDI en
suivant la procédure ci-dessous. Vous pouvez aussi ajouter la commande
<c>asfxload</c> au fichier <path>/etc/conf.d/local.start</path> afin que la
police de son soit chargée dès que le système démarre.
</p>

<note>
Les répertoires <path>/mnt</path> mentionnés ci-dessous <e>ne seront pas les
mêmes</e> sur votre machine. Ils ne sont donnés qu'à titre d'exemple.
Assurez-vous de les changer pour refléter votre propre système.
</note>

<pre caption="Activer SoundFont">
<comment>(D'abord, copiez le fichier SoundFont :)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(Ou bien depuis le CD-ROM :)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(Puis chargez le fichier Soundfont approprié :)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Vous pouvez maintenant faire jouer un fichier MIDI avec un programme tel que
<c>aplaymidi</c>. Exécutez <c>aplaymidi -l</c> pour obtenir une liste des
ports disponibles, puis choisissez-en un pour y faire jouer le fichier.
</p>

<pre caption="Faire jouer un fichier MIDI">
<comment>(Vérifiez les ports disponibles :)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Choisissez un port et faites jouer un fichier :)</comment>
# <i> aplaymidi --port=65:0 /mnt/shyam/music/midi/mi2.mid</i>
</pre>

</body>
</section>
<section id="vsynth">
<title>Synthétiseurs virtuels</title>
<body>

<p>
Si votre carte n'a pas de synthétiseur matériel, vous pouvez utiliser à la
place un synthétiseur virtuel tel que <c>timidity++</c>. L'installation est on
ne peut plus facile.
</p>

<pre caption="Installer timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Pour que timidity puisse jouer, il a besoin d'un fichier de police de son. Si
vous n'en avez pas, installez <c>timidity-eawpatches</c> ou
<c>timidity-shompatches</c> qui vous en fourniront. Vous pouvez avoir
plusieurs polices de son installées en même temps, et vous pouvez ajouter vos
propres polices dans <path>/usr/share/timidity/</path>. Pour passer de l'une à
l'autre, utilisez l'outil <c>timidity-update</c> fourni par le paquet
logiciel timidity++.
</p>

<pre caption="Installer des polices de son">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(ou)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
N'oubliez pas d'ajouter <c>timidity</c> au niveau d'exécution par défaut.
</p>

<pre caption="Ajouter timidity au niveau d'exécution par défaut">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Vous pouvez maintenant essayer de <uri link="#doc_chap4_pre3">faire jouer un
fichier MIDI</uri>.
</p>

</body>
</section>
<section>
<title>Outils et microcode</title>
<body>

<p>
Des outils sont disponibles dans les paquets <c>alsa-tools</c> et
<c>alsa-firmware</c> pour certaines cartes de son spécifiques. Si vous avez
besoin de <c>alsa-tools</c>, assurez-vous de définir la variable ALSA_TOOLS
dans <path>/etc/make.conf</path> en y listant les outils nécessaires&nbsp;:
</p>

<pre caption="Choisir les outils ALSA dans /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Si la variable ALSA_TOOLS n'est pas réglée, tous les outils disponibles seront
compilés. Maintenant, installez <c>alsa-tools</c> (et/ou
<c>alsa-firmware</c>)&nbsp;:
</p>

<pre caption="Installer les outils ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Merci à vous...</title>
<body>

<p>
Tous ceux qui ont contribué à la version précédente du Guide ALSA pour
Gentoo&nbsp;: Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy
Huddleston, John P. Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft et Erwin.
</p>

</body>
</section>
<section>
<title>Références</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">The ALSA Project</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
