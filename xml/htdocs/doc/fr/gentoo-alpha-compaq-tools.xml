<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/Attic/gentoo-alpha-compaq-tools.xml,v 1.7 2004/10/07 15:52:26 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/gentoo-alpha-compaq-tools.xml" lang="fr">
<title>Guide des outils Compaq sur Gentoo Alpha</title>

<author title="Développeur Gentoo Alpha">
  <mail link="taviso@gentoo.org">Tavis Ormandy</mail>
</author>
<author title="Correcteur">
  <mail link="peesh@gentoo.org">Jorge Paulo</mail>
</author>
<author title="Traducteur">
  <mail link="frederic.baujard@dev.gaeia.org">Frédéric Baujard</mail>
</author>

<abstract>
Ce guide est une introduction aux outils libres de Compaq pour les utilisateurs
de Gentoo Alpha.
</abstract>

<license/>

<version>1.0.2</version>
<date>5 juin 2004</date>
<chapter>
<title>Introduction</title>
<section>
<title>Les licences disponibles</title>
<body>
<p>
Avant de lire plus avant ce quide, vous devriez vérifier si vous êtes en droit
d'utiliser les outils Compaq. Si les bibliothèques runtime
<c>dev-libs/libots</c> et <c>dev-libs/libcpml</c> ne vous suffisent pas, vous
devez faire partie du monde académique ou être un passionné.
</p>

<pre caption="Licences HP éducation et passionnés">
Le logiciel peut-être utilisé uniquement pour votre «&nbsp;passion&nbsp;»
individuelle et personnelle ou pour votre éducation personnelle. Il ne peut pas
être utilisé pour le commerce, travail ou institution, que ce soit à but non
lucratif ou pas. N'importe quel travail fourni ou produit comme un résultat de
l'utilisation de ce logiciel ne peut servir pour le bénéfice d'une autre partie
pour des honoraires, compensation ou n'importe quel autre rétribution ou
rémunération.
</pre>

<note>
Si vous n'entrez pas dans ces catégories et que vous voulez toujours utiliser
ce logiciel, vous pouvez acheter une <uri
link="http://h18000.www1.hp.com/products/software/alpha-tools/purchase.html">licence
commerciale</uri> chez HP qui vous fournira une clé pour que vous puissiez
installer les compilateurs Compaq.
</note>

<p>
Si vous avez droit à une licence gratuite, vous avez besoin de vous enregistrer
chez HP en utilisant leur formulaire à
<uri>http://h18000.www1.hp.com/products/software/alpha-tools/ee-license.html</uri>.
Une fois que votre requête a été acceptée, HP vous enverra une clé  qui peut
être utilisée pour décrypter et installer les compilateurs Compaq.
</p>
</body>
</section>
<section>
<title>Survol des outils Compaq</title>
<body>
<p>
Si vous êtes familier avec les optimisations sur PC, vous avez probablement
entendu parler de <uri
link="http://www.intel.com/software/products/compilers/clin/">icc</uri>, le
compilateur optimisé d'Intel pour leurs processeurs Pentium. L'équivalent pour
les utilisateurs de systèmes Alpha est l'ensemble <uri
link="http://h18000.www1.hp.com/products/software/alpha-tools/">d'outils
professionnels pour développeur Linux</uri>, un ensemble de bibliothèques à
hautes performances, compilateurs et utilitaires spécifiquement adaptés pour
les plates-formes Alpha. Ils sont mis gratuitement à la disposition des
passionnés Alpha et à ceux qui utilisent ces systèmes à des fins éducatives.
Les bibliothèques et compilateurs permettent à Portage de compiler en
améliorant sensiblement les performances de votre système Gentoo Alpha.
</p>

<p>
Les outils suivants sont disponibles pour les utilisateurs Gentoo&nbsp;:
</p>

<table>
<tr>
<th>Utilitaire</th>
<th>Description</th>
<th>Nom dans Portage</th>
</tr>
<tr>
<ti>libots</ti>
<ti>Support pour codes compilés, nécessaire pour l'utilisation des outils.</ti>
<ti>dev-libs/libots</ti>
</tr>
<tr>
<ti><uri link="http://www.support.compaq.com/alpha-tools/software.html#cpml">libcpml</uri></ti>
<ti>
  Bibliothèque mathématique portable de Compaq à hautes performances pour les
  utilisateurs Alpha qui peut être utilisée pour améliorer les performances
  mathématiques dans une application.
</ti>
<ti>dev-libs/libcpml</ti>
</tr>
<tr>
<ti><uri link="http://www.support.compaq.com/alpha-tools/software.html#c">ccc</uri></ti>
<ti>
  Compilateur C Compaq hautement optimisé et amélioré pour les plates-formes
  Alpha, il contient une grande optimisation du générateur de code
  spécifiquement prévue pour exploiter l'architecture Alpha 64 bits. Il est
  particulièrement bien fait et contient un support étendu pour la
  programmation système, la programmation parallèle et les calculs
  scientifiques.
</ti>
<ti>dev-lang/ccc</ti>
</tr>
<tr>
<ti><uri link="http://www.support.compaq.com/alpha-tools/software.html#cxx">cxx</uri></ti>
<ti>
  Compilateur C++ Compaq amélioré spécifiquement pour les plates-formes Alpha,
  il offre la même optimisation du générateur de code pour les programmes
  Compaq C à C++.
</ti>
<ti>dev-lang/cxx</ti>
</tr>
<tr>
<ti><uri link="http://www.support.compaq.com/alpha-tools/software.html#ladebug">ladebug</uri></ti>
<ti>
  Le fameux débogueur pour Tru64 porté sur Alpha Linux. Il contient un support
  étendu pour les applications compilées avec le compilateur C de Compaq.
</ti>
<ti>dev-util/ladebug</ti>
</tr>
<tr>
<ti><uri link="http://www.support.compaq.com/alpha-tools/software.html#cxml">libcxml</uri></ti>
<ti>
  La bibliothèque mathématique étendue de Compaq à hautes performances pour les
  programmes en fortran, C et C++.
</ti>
<ti>dev-libs/libcxml</ti>
</tr>
</table>
<note>
Au moment de l'écriture de ce document, certains outils Compaq sont toujours
marqués ~alpha. Cela signifie que bien qu'ils aient été testés et semblent
fonctionner, ils n'ont pas été entièrement testés et nous ne pouvons pas être
totalement certains qu'ils soient stables. Si vous voulez installer certaines
de ces applications, vous devrez rajouter le préfixe ACCEPT_KEYWORDS="~alpha" à
la commande <path>emerge</path>.
</note>

<note>
Si vous avez des problèmes avec ccc, cxx, ou n'importe quel autre outil
Compaq, veuillez remplir un rapport de bogue via notre interface <uri
link="http://bugs.gentoo.org/">bugzilla</uri> et assignez-le à <uri
link="mailto:taviso@gentoo.org">taviso@gentoo.org</uri>.
</note>

</body>
</section>
</chapter>
<chapter>
<title>Installation des outils de développement</title>
<section>
<title>Bibliothèques «&nbsp;runtime&nbsp;»</title>
<body>
<p>
La première étape avant l'installation des outils de développement est de
récupérer les bibliothèques «&nbsp;runtime&nbsp;». À cause des restrictions de
licences, Gentoo ne peut pas distribuer les RPM et vous devez donc les
télécharger depuis le site Web de Compaq.
</p>

<p>
<uri>ftp://ftp.compaq.com/pub/products/linuxdevtools/latest/downloads.html</uri>
</p>

<p>
Téléchargez les rpm libots et libcpml, et placez-les dans votre répertoire distfiles.
</p>

<note>
Si vous avez un processeur ev6 ou mieux, vous devriez télécharger le rpm
libcpml optimisé pour ev6, cela vous permettra d'exploiter les options de votre
nouveau processeur. Vous devrez aussi ajouter "ev6" dans la variable USE de
/etc/make.conf pour que <c>ebuild</c> sache qu'il va utiliser un rpm optimisé.
Si vous ne savez pas quel est le type de processeur de votre machine,
utilisez la commande suivante pour l'identifier&nbsp;:
</note>

<pre caption="Obtenir les bibliothèques « runtime »">
# uname -p   # Vérifier la version du processeur.
EV56
# mv libots-2.2.7-2.alpha.rpm cpml_ev?-5.2.0-1.alpha.rpm /usr/portage/distfiles
</pre>

<p>
Maintenant que les rpm sont dans votre répertoire distfiles, Portage va être
capable de les trouver et de les installer sur votre système. Utilisez les
commandes suivantes pour installer les bibliothèques&nbsp;:
</p>

<pre caption="Installer les bibliothèques requises">
# emerge -pv dev-libs/libots dev-libs/libcpml # Vérifier que tout est correct.
# emerge dev-libs/libots dev-libs/libcpml
</pre>

<p>
Maintenant, les bibliothèques sont installées sur votre système et vous êtes
prêt à installer le compilateur et les utilitaires.
</p>
</body>
</section>
<section>
<title>Installation du compilateur</title>
<body>
<p>
Si vous ne vous êtes pas encore enregistré pour une licence de passionné ou
éducative avec HP, il est temps de le faire.  Il semble que cela prenne environ
24 heures pour une licence à partir du moment où vous avez rempli le formulaire
sur le web.
</p>

<p>
<uri>http://h18000.www1.hp.com/products/software/alpha-tools/ee-license.html</uri>
</p>

<warn>
On va vous demander vos coordonnées et votre adresse de courrier électronique.
Cette adresse doit être valide, car on vous enverra la clé de licence qui doit
être utilisée pour débloquer le compilateur.
</warn>

<note>
On vous demandera aussi d'expliquer pourquoi vous voulez une licence gratuite,
par exemple «&nbsp;Home Alpha enthusiast&nbsp;» ou «&nbsp;For academic use at
XYZ college&nbsp;».
</note>

<p>
Quand votre licence est accordée, vous recevrez un courrier de notification
contenant la clé de la license. Utilisez-la dans la commande ci-dessous pour
installer les compilateurs ccc et cxx.
</p>

<pre caption="Installation du compilateur C de Compaq">
# emerge -pv dev-lang/ccc  # Vérifiez que tout est OK.
# CCC_LICENSE_KEY=0123456789 emerge dev-lang/ccc
# ebuild /var/db/pkg/dev-lang/ccc-6.5.9.001.ebuild config
</pre>

<note>
N'oubliez pas de remplacer 0123456789 par la clé de licence qui vous a été
envoyée par courrier électronique.
</note>

<note>
Vérifiez le numéro de la version du compilateur C que vous êtes en train
d'installer avant d'utiliser la commande ebuild. emerge vous dira quand c'est
fini. La commande ebuild configure le compilateur pour votre système et permet
de localiser les fichiers système et les bibliothèques.
</note>

<p>
Si tout se passe bien, le compilateur C Compaq est maintenant installé et vous
pouvez l'utiliser pour commencer la compilation d'applications depuis Portage
ou vos propres applications. Si vous voulez aussi utiliser le compilateur C++,
utilisez la commande ci-dessous pour l'installer. N'oubliez pas de lancer "cxx"
à la fin pour accepter la licence d'utilisation.
</p>

<pre caption="Installer le compilateur C++ de Compaq">
# emerge -pv dev-lang/cxx   # Afficher les paquets à installer.
# CXX_LICENSE_KEY=0123456789 emerge dev-lang/cxx
# ebuild /var/db/pkg/dev-lang/cxx-6.5.9.31-r1.ebuild config
# cxx   # Lisez et acceptez la license de l'utilisateur.
</pre>

<p>
Si vous voulez utilisez ladebug (débogueur), vous pouvez l'installer
maintenant.
</p>

<pre caption="Installer ladebug, le débogueur Compaq">
# emerge -pv dev-util/ladebug
# emerge dev-util/ladebug
</pre>

<note>
ladebug peut être utilisé avec les exécutables de gcc aussi bien que les
exécutables de ccc/cxx, si vous êtes dans un environnement Tru64, vous êtes
peut-être familier avec ladebug et vous le trouverez sûrement plus confortable
que gdb pour tout debogage.
</note>

</body>
</section>
</chapter>
<chapter>
<title>Utilisation des outils Compaq avec Portage</title>
<section>
<title>Compilation de programmes C/C++ avec Portage</title>
<body>
<p>
La compilation de programmes par Portage avec ccc est simple. Dans l'exemple
suivant, nous allons vous montrer l'installation de gzip, une application
connue pour ses performances avec ccc.
</p>

<pre caption="Portage compile avec ccc">
# emerge -pv gzip   # Vérifiez si tout est en ordre.
# CC=ccc CFLAGS="-host -fast" emerge gzip
</pre>

<p>
ccc a beaucoup d'options d'optimisation. Il y a une explication des CFLAGS
utilisés ici ainsi que d'autres options communes plus loin.
</p>

<p>
La même méthode peut être utilisée pour compiler des programmes C++. L'exemple
suivant utilise groff qui a de meilleures performances quand il est compilé avec
cxx.
</p>
<pre caption="Portage compile avec cxx">
# emerge -pv groff   # affiche les paquets à installer
# CXX=cxx CXXFLAGS="-host -fast" emerge groff
</pre>
</body>
</section>
<section>
<title>Optimisez vos applications compilées avec ccc/cxx</title>
<body>
<p>
Optimiser des applications pour Alpha avec ccc/cxx est aussi simple qu'avec
gcc. Les options similaires sont groupées pour faire des lignes de commandes
courtes et simples. Le tableau ci-dessous montre certaines options communes que
vous pourrez essayer dans vos programmes.
</p>

<table>
<tr>
<th>Option</th>
<th>Description</th>
<th>Sécurité</th>
</tr>
<tr>
<ti>-host</ti>
<ti>
  Optimise l'application pour le système sur lequel la compilation a lieu en
  tirant profit d'un maximum d'instructions disponibles et de l'ordonnancement
  pour cette machine. Les applications compilées avec cette option ne
  marcheront probablement pas sur d'autres types de machines alpha.
</ti>
<ti>Sans risque.</ti>
</tr>
<tr>
<ti>-fast</ti>
<ti>
  Active certaines optimisations avancées qui vont améliorer les performances
  de vos applications.
</ti>
<ti>Sûre.</ti>
</tr>
<tr>
<ti>-O4</ti>
<ti>
  Insère des instructions NOP dans votre code pour augmenter l'ordonnancement.
  Canalisation logicielle en utilisant une analyse des dépendances et
  «&nbsp;vectorialisation&nbsp;» de certaines données sur 8 et 16 bits (char et
  short). Cette option peut parfois ne pas augmenter la performance du code et
  pourrait alors être comparée à -O3 et -fast.
</ti>
<ti>Normalement sans danger, mais peut ne pas augmenter les performances.</ti>
</tr>
<tr>
<ti>-std1</ti>
<ti>
  Indique au compilateur d'utiliser le plus strictement possible
  l'interprétation des standards. Cela permet d'augmenter les optimisations de
  manière plus agressive, ce que l'on ne pourrait faire avec une interprétation
  plus souple. Toutes les applications ne compileront pas avec cette option et,
  parfois, ne fonctionneront pas comme prévu.
</ti>
<ti>Peut ne pas compiler, mais améliore les performances.</ti>
</tr>
<tr>
<ti>-tune host</ti>
<ti>
  Indique au compilateur d'optimiser le code généré pour l'architecture
  spécifiée. Cette option n'empêchera pas les binaires de fonctionner sur
  d'autres machines et améliorera les performances.
</ti>
<ti>Sans risque.</ti>
</tr>
</table>


<note>
CCC supporte l'interprétation de la plupart des options du compilateur gcc,
donc si votre application <path>Makefile</path> spécifie certaines options de
gcc, ce n'est pas grave, CCC les comprendra probablement.
</note>

<note>
Si vous avez l'option "doc" dans USE dans votre <path>make.conf</path>, le
compilateur aura installé une documentation détaillée dans
<path>/usr/share/doc</path>. Vous pouvez la consulter pour de plus amples
informations. Il y a aussi d'excellentes pages du manuel en ligne (man pages).
</note>

</body>
</section>
</chapter>
<chapter>
<title>Notes sur les compilateurs Compaq</title>
<section>
<title>Applications qui profitent de CCC/CXX</title>
<body>
<p>
Les compilateurs compaq excellent réellement dans l'optimisation d'applications
grâce à l'utilisation intensive de nombres à virgule flottante. Dans la plupart
des cas, ils peuvent aussi donner des meilleurs résultats avec les entiers que
gcc. Pendant mes expériences, j'ai trouvé plusieurs applications qui
fonctionnent de manière identique avec ccc et gcc, mais je n'ai pas trouvé
d'applications fonctionnant mieux que celles optimisées avec ccc/cxx.
</p>
<p>
Rappellez-vous cependant que GCC a été testé par plus de personnes et qu'il
fournit plusieurs extensions en standard que les programmeurs utiliseront
peut-être. CCC peut ne pas supporter ces extensions ou ne pas les supporter
aussi bien que gcc. Vous devrez tenir compte de cela dans votre choix
d'optimisations avec ccc.
</p>
</body>
</section>
<section>
<title>Test comparatif avec CCC</title>
<body>
<p>
Si vous voulez tester différentes options de compilation de CCC et les comparer
à GCC, vous avez besoin d'un test comparatif. Pour cela, je recommande la suite
de tests comparatifs <uri link="http://www.freebench.org/">Freebench</uri>. Il
compilera 6 tests différents prévus pour tester les performances des entiers et
des nombres à virgule flottante, et générera des graphiques HTML pour les
comparaisons. Voici quelques exemples que j'ai préparés&nbsp;:
</p>

<table>
<tr>
<th>Test</th>
<th>Résumé</th>
</tr>
<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-ccc-vanilla.html">CCC Vanilla</uri></ti>
<ti>Résultats de CCC sans option de compilation.</ti>
</tr>
<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-gcc-vanilla.html">GCC Vanilla</uri></ti>
<ti>Résultats de GCC sans option de compilation.</ti>
</tr>
<tr>
<ti></ti><ti></ti>
</tr>
<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-ccc-normal.html">CCC Normal</uri></ti>
<ti>Résultats de CCC avec quelques options courantes.</ti>
</tr>
<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-gcc-normal.html">GCC Normal</uri></ti>
<ti>Résultats de GCC avec quelques options courantes.</ti>
</tr>
<tr>
<ti></ti><ti></ti>
</tr>

<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-ccc-best.html">CCC Best</uri></ti>
<ti>CCC avec plus d'options.</ti>
</tr>
<tr>
<ti><uri link="http://dev.gentoo.org/~taviso/results-gcc-best.html">GCC Best</uri></ti>
<ti>GCC avec plus d'options.</ti>
</tr>
</table>

<note>
Une plus grande valeur indique un meilleur score.
</note>


<note>
Une comparaison en une page est disponible <uri
link="http://dev.gentoo.org/~taviso/results.html">ici</uri>.
</note>

</body>
</section>
<section>
<title>Améliorer les performances</title>
<body>
<p>
Si vous utilisez un Alpha depuis plus de quelques minutes, vous connaissez les
erreurs «&nbsp;Unaligned access&nbsp;», les erreurs de programmation qui
affectent les utilisateurs Alpha et pénalisent les performances des
applications puisque le noyau doit les corriger.
</p>
<p>
Les erreurs «&nbsp;Unaligned access&nbsp;» ne sont pas graves, les programmes
tourneront malgré elles. Cependant, le noyau ne peut les corriger
instantanément et, à chaque fois qu'il doit en corriger une, votre application
est ralentie. Habituellement, cela n'est pas un problème, mais sur certains
programmes, vous pourrez remarquer le ralentissement.
</p>

<pre caption="Messages « Unaligned Trap »">
Apr 9 01:05:55 amnesiac bash(20147): unaligned trap at 0000039db4526d98: 000003
9db4662e26 28 1
Apr 9 01:05:55 amnesiac bash(20147): unaligned trap at 0000039db4526d9c: 000003
9db4662e2a 28 3
Apr 9 01:06:03 amnesiac snort(23800): unaligned trap at 000000012003fe60: 00000
00120161a92 2c 2
Apr 9 01:06:03 amnesiac snort(23800): unaligned trap at 000000012003fe78: 00000
00120161a96 2c 2
Apr 9 01:06:03 amnesiac snort(23800): unaligned trap at 000000012003feb0: 00000
00120161a9e 2c 4
Apr 9 01:06:03 amnesiac snort(23800): unaligned trap at 000000012003feb4: 00000
00120161aa2 2c 5
</pre>


<note>
Vous pouvez voir ces messages sur votre machine avec la commande dmesg.
</note>

<p>
Il y a 2 moyens de corriger ces erreurs pour minimiser les baisses de
performance. Si vous êtes un programmeur, vous pouvez réparer les erreurs.
C'est habituellement simple, mais sur certaines applications, elles sont plus
difficiles à résoudre ou plus subtiles.  Si vous pensez que vous pouvez le
faire, HP a une documentation volumineuse destinée aux les programmeurs pour
l'identification et la correction de ces bogues sur le lien ci-dessous.
</p>
<p>
<uri>http://h21007.www2.hp.com/dspp/tech/tech_TechSingleTipDetailPage_IDX/1,2366,161,00.html</uri>
</p>

<p>
Le deuxième moyen est d'utiliser le compilateur Compaq et l'option -misalign,
cela va rajouter une vérification du code pour être sûr que tout le code est
correct. Cela va ralentir votre programme, vous devrez donc expérimenter et
vérifier si l'option vaut la peine d'être utilisée.
</p>
<p>
Si possible, lancez l'application via <path>time</path>. Quand le programme se
termine, <path>time</path> affiche le temps utilisé par le noyau pour les
appels système, y compris les corrections des erreurs «&nbsp;misaligned
access&nbsp;». Si le nombre est grand (vous pouvez le comparer aux autres
plates-formes) et que vous recevez un grand nombre de messages UAC, vous
devriez recompiler avec le vérificateur de code.
</p>

<pre caption="Mesures de performances d'une erreur « Unaligned Access »">
# time votre_application
real 0m2.011s
user 0m0.004s
sys 0m2.007s
# CC=ccc CFLAGS="-host -fast -misalign" emerge votre_application
# time votre_application
0m0.811s
0m0.804s
0m0.007s
</pre>

<note>
Bien sûr, vous ne devez pas compiler toute votre application avec -misalign.
Vous pouvez utiliser la documentation HP mentionnée ci-dessus pour identifier
le fichier source qui contient les erreurs et utiliser l'option -misalign sur
ces fichiers spécifiquement.
</note>

<note>
Si les messages UAC vous ennuient ou que vous voulez améliorer le code du noyau
pour un maximum de performance, vous pouvez modifier
<path>/usr/src/linux/arch/alpha/kernel/traps.c</path> et enlever la déclaration
et le «&nbsp;switch&nbsp;» de la fonction printk().
</note>

<note>
Vous pouvez utiliser la commande suivante pour vérifier combien d'erreurs ont
été corrigées par le noyau depuis votre dernier démarrage.
</note>

<pre caption="Afficher les statistiques des UAC">
$ grep unaligned /proc/cpuinfo
kernel unaligned acc : 3 (pc=fffffc000035c7e0,va=120000f1a)
user unaligned acc : 6623 (pc=28d361e4c1c,va=28d36320f62)
</pre>

</body>
</section>
</chapter>
</guide>
