<?xml version="1.0" encoding="UTF-8"?>

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/xorg-config.xml,v 1.17 2007/08/01 14:13:05 cam Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/xorg-config.xml" lang="fr">

<title>Guide de configuration de X</title>

<author title="Auteur">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Traducteur">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Traducteur">
  <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Le serveur X-Window Xorg permet d'offrir un environnement graphique aux
utilisateurs. Ce guide décrit ce qu'est Xorg, comment l'installer et le
configurer.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.17</version>
<date>2007-06-20</date>

<chapter>
<title>Qu'est-ce que le serveur X-Window&nbsp;?</title>
<section>
<title>Environnement graphique ou ligne de commande</title>
<body>

<p>
Certains utilisateurs sont mal à l'aise à l'idée de devoir entrer des
commandes. Pourquoi ne pourraient-ils pas tout faire à la souris dans un
environnement graphique&nbsp;? C'est possible&nbsp;! Linux offre une panoplie
d'interfaces graphiques qui peuvent être installées sur votre distribution.
</p>

<p>
Ce qui surprend le plus les nouveaux utilisateurs est que l'interface graphique
n'est rien d'autre qu'un programme qui tourne sur leur système. Elle ne fait
<e>pas</e> partie du noyau Linux ni du système de base. Elle est simplement un
outil puissant qui permet d'utiliser les capacités graphiques de votre machine.
</p>

<p>
Dans le souci du respect des standards, un nouveau standard a été créé pour
définir comment dessiner et déplacer des fenêtres sur l'écran, comment
permettre à l'utilisateur d'agir avec le clavier et la souris ainsi que
d'autres aspects importants d'un système graphique. Ce standard a été nommé
<e>X Window System</e>, souvent abrégé en <e>X11</e> ou simplement <e>X</e>. Il
est utilisé sur la plupart des systèmes Unix, Linux et apparentés.
</p>

<p>
L'application qui implémente le standard X11 sur un système Linux s'appelle
<e>Xorg-X11</e>. Elle est un dérivé du projet XFree86. Ce dernier ayant opté
pour une licence incompatible avec la GPL, l'utilisation de Xorg est désormais
recommandée. L'arbre Portage officiel ne contient plus d'ebuild pour XFree86.
</p>

</body>
</section>
<section>
<title>Le projet X.org</title>
<body>

<p>
Le projet <uri link="http://www.x.org">X.org</uri> offre une implémentation
libre et ouverte du standard X11.
</p>

<p>
Xorg fournit une interface entre votre matériel et les logiciels graphiques que
vous voulez utiliser. De plus, Xorg est prévu pour fonctionner en réseau et
permet de faire tourner une application sur un système et d'afficher sur
l'écran d'un autre.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Installer Xorg</title>
<section>
<title>Utiliser emerge</title>
<body>

<p>
Assez bavardé, installons Xorg&nbsp;! Lancez simplement la commande <c>emerge
xorg-x11</c>. L'installation prend un certain temps, profitez-en pour manger un
morceau.
</p>

<p>
Avant d'installer Xorg, vous devez configurer deux variables importantes dans le
fichier <path>/etc/make.conf</path>.
</p>

<p>
La première est <c>VIDEO_CARDS</c>. Elle est utilisée pour définir les pilotes
graphiques que vous comptez utiliser et se base en principe sur la marque ou le
modèle de votre carte. Les valeurs les plus courantes sont <c>nvidia</c> pour
les cartes nVidia ou <c>fglrx</c> pour les cartes ATI Radeon. Ces valeurs
correspondent aux pilotes propriétaires de ces marques. Si vous voulez utiliser
leur pendant libre, mettez <c>nv</c> plutôt que <c>nvidia</c>, mais sachez que
vous n'aurez alors aucune accélération 3D. Le pilote libre <c>radeon</c> pour 
les cartes ATI supporte totalement l'accélération 3D sur les vieilles cartes
Radeon, mais ne fonctionne pas du tout sur les nouvelles. <c>VIDEO_CARDS</c> 
peut contenir plusieurs noms de pilotes, séparés par des espaces.
</p>

<p>
La seconde variable à configurer est <c>INPUT_DEVICES</c> et est utilisée pour
déterminer quels pilotes doivent être installés pour faire fonctionner vos
périphériques d'entrée. Dans la plupart des cas, vous devrez choisir <c>keyboard
mouse</c>.
</p>

<p>
Maintenant que vous avez choisi quels pilotes vous allez utiliser, remplissez le
fichier <path>/etc/make.conf</path>.
</p>

<pre caption="Exemple de make.conf">
<comment>(Pour avoir le clavier et la souris.)</comment>
INPUT_DEVICES="keyboard mouse"
<comment>(Pour les cartes nVidia...)</comment>
VIDEO_CARDS="nvidia"
<comment>(... OU ALORS pour les cartes ATI.)</comment>
VIDEO_CARDS="fglrx"
</pre>

<p>
Vous trouverez de plus amples informations sur la façon de configurer les cartes
graphiques ATI ou nVidia dans le <uri link="/doc/fr/nvidia-guide.xml">Guide
Gentoo Linux nVidia</uri> et dans la <uri link="/doc/en/ati-faq.xml">FAQ Gentoo
Linux ATI</uri>.
</p>

<note>
Si les valeurs suggérées ne fonctionnent pas chez vous, lancez <c>emerge -pv
xorg-server</c>, vérifiez toutes les options disponibles et choisissez celles
qui s'appliquent à votre système. L'exemple concerne <c>xorg-server-1.2</c> sur
architecture amd64.
</note>

<pre caption="Obtenir la liste des pilotes et des options disponibles">
# <i>emerge -pv xorg-server</i>

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] x11-base/xorg-server-1.2.0-r3  USE="dri nptl xorg (-3dfx) -debug
 -dmx -ipv6 -kdrive -minimal -sdl -xprint" INPUT_DEVICES="keyboard mouse -acecad
 -aiptek -calcomp -citron -digitaledge -dmc -dynapro -elo2300 -elographics -evdev
 -fpit -hyperpen -jamstudio -joystick -magellan -microtouch -mutouch -palmax
 -penmount -spaceorb -summa -synaptics -tek4957 -ur98 -vmmouse -void -wacom"
 VIDEO_CARDS="nvidia -apm -ark -chips -cirrus -cyrix -dummy -epson -fbdev -fglrx
 -glint -i128 (-i740) -i810 (-impact) (-imstt) -mach64 -mga -neomagic (-newport)
 (-nsc) -nv -r128 -radeon -rendition -s3 -s3virge -savage -siliconmotion -sis
 -sisusb (-sunbw2) (-suncg14) (-suncg3) (-suncg6) (-sunffb) (-sunleo) (-suntcx)
 -tdfx -tga -trident -tseng -v4l -vesa -vga -via -vmware -voodoo" 0 kB
</pre>

<p>
Après avoir activé toutes les variables nécessaires, vous pouvez installer le
paquet Xorg.
</p>

<pre caption="Installer Xorg">
# <i>emerge xorg-x11</i>
</pre>

<p>
Après l'installation, vous devez réinitialiser votre environnement avant de
poursuivre. Lancez les commandes <c>env-update</c> et <c>source
/etc/profile</c>.
</p>

<pre caption="Réinitialiser les variables d'environnement">
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Configurer Xorg</title>
<section>
<title>Le fichier xorg.conf</title>
<body>

<p>
Le fichier de configuration de Xorg est <path>xorg.conf</path>. Il se trouve
dans le répertoire <path>/etc/X11</path>. Un exemple fourni à l'installation
est <path>/etc/X11/xorg.conf.example</path>. Vous pouvez utiliser celui-ci pour
créer votre propre fichier de configuration. Il contient de nombreux
commentaires, mais la page man est encore plus complète&nbsp;:
</p>

<pre caption="Lire la page man de xorg.conf">
# <i>man 5 xorg.conf</i>
</pre>

<p>
Bonne lecture aux plus courageux&nbsp;! Poursuivons et créons ce fichier
automatiquement.
</p>

</body>
</section>
<section>
<title>Par défaut : génération automatique de xorg.conf</title>
<body>

<p>
Xorg est capable de définir la plupart des paramètres automatiquement. Vous ne
devriez modifier que quelques lignes, notamment pour définir la résolution que
vous voulez utiliser. Vous trouverez plus d'informations sur les paramètres que
vous pouvez ajuster dans les ressources mentionnées à la fin de ce document.
Commençons par générer un fichier de configuration utilisable.
</p>

<pre caption="Générer un fichier xorg.conf">
# <i>Xorg -configure</i>
</pre>

<p>
Veuillez vérifier les dernières lignes affichées par Xorg. Si Xorg n'a pas pu
créer le fichier <path>xorg.conf</path>, vous devrez le créer manuellement. En
supposant que le fichier a bien été créé, Xorg devrait vous afficher qu'il a
créé un fichier de configuration <path>/root/xorg.conf.new</path>.
Essayons-le&nbsp;:
</p>

<pre caption="Tester le fichier xorg.conf.new">
# <i>X -config /root/xorg.conf.new</i>
</pre>

<p>
Si tout se passe bien, vous devriez voir un motif noir et blanc.  Déplacez
votre souris et voyez si la résolution vous semble correcte. Si vous avez des
erreurs au sujet de «&nbsp;/dev/mouse&nbsp;», essayez de modifier votre
périphérique de souris en mettant <c>/dev/input/mice</c>  dans la section
"InputDevice" du fichier <path>xorg.conf</path>. Il vous sera peut-être
difficile d'en être sûr, mais vous devriez au moins pouvoir détecter une
résolution trop faible.  Utilisez la combinaison de touches Ctrl-Alt-Backspace
pour stopper le serveur X.
</p>

</body>
</section>
<section>
<title>Alternative : génération semi-automatique de xorg.conf</title>
<body>

<p>
Xorg contient un outil de configuration appelé <c>xorgconfig</c>. Celui-ci vous
pose une série de questions (carte graphique, type de clavier, etc.) et
construit un fichier de configuration <path>xorg.conf</path> en fonction de vos
réponses.
</p>

<pre caption="Génération semi-automatique de xorg.conf">
# <i>xorgconfig</i>
</pre>

<p>
xorg fournit un autre outil de configuration appelé <c>xorgcfg</c> qui essaie
de lancer <c>Xorg -configure</c> et lance ensuite le serveur X pour permettre
des ajustements supplémentaires.
</p>

<pre caption="Utiliser xorgcfg">
# <i>xorgcfg</i>
<comment>(Si X plante ou si la configuration échoue, essayez plutôt)</comment>
# <i>xorgcfg -textmode</i>
</pre>

</body>
</section>
<section>
<title>Copier xorg.conf</title>
<body>

<p>
Recopions le fichier <path>xorg.conf.new</path> vers
<path>/etc/X11/xorg.conf</path> pour éviter de devoir lancer <c>Xorg
-config</c>&nbsp;; taper <c>X</c> ou <c>startx</c> est bien plus facile.
</p>

<pre caption="Copier xorg.conf">
# <i>cp /root/xorg.conf.new /etc/X11/xorg.conf</i>
</pre>

</body>
</section>
<section id="using_startx">
<title>Utiliser startx</title>
<body>

<p>
Ensuite, essayez de démarrer le serveur X avec la commande <c>startx</c>.
Celle-ci exécute un script qui lance une <e>session X</e>, c'est-à-dire qu'elle
démarre le serveur X et des applications graphiques. Les applications sont
démarrées selon la logique suivante&nbsp;:
</p>

<ul>
  <li>
    Si un fichier <path>.xinitrc</path> existe dans le répertoire <e>home</e>,
    les commandes qu'il contient seront exécutées.
  </li>
  <li>
    Sinon, la variable XSESSION indique le nom de la session à exécuter. Cette
    session correspond à un fichier dans le répertoire
    <path>/etc/X11/Sessions/</path>.  Vous pouvez définir la variable XSESSION
    dans le fichier <path>/etc/rc.conf</path> pour en faire le défaut pour tous
    les utilisateurs.
  </li>
  <li>
    En cas d'échec, le défaut est de démarrer un simple gestionnaire de
    fenêtres, généralement <c>twm</c>.
  </li>
</ul>

<pre caption="Démarrer X">
# <i>startx</i>
</pre>

<p>
Si un affreux gestionnaire de fenêtres s'affiche, c'est <c>twm</c>. Pour
quitter, tapez <c>exit</c> ou Ctrl-D dans chaque terminal X. Vous pouvez aussi
tuer la session avec la combinaison de touches Ctrl-Alt-Backpace. Cette
combinaison vous permet de quitter X brusquement et n'est pas recommandée, sauf
cas de force majeure.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Adapter xorg.conf</title>
<section>
<title>Définir la résolution</title>
<body>

<p>
Si vous voulez modifier la résolution utilisée, vous devez modifier deux
sections du fichier de configuration. La section <e>Screen</e> contient la
liste des résolutions utilisables. Elle peut ne contenir aucune résolution
auquel cas le serveur X détermine la résolution en fonction des informations de
la section <e>Monitor</e>.
</p>

<p>
Le serveur Xorg utilise les valeurs des paramètres <c>HorizSync</c> et
<c>VertRefresh</c> de la section <e>Monitor</e> pour déterminer les résolutions
utilisables. Ne modifiez ces paramètres que si les modifications dans la
section <e>Screen</e> ne fonctionnent pas. Vous devrez alors utiliser les
spécifications de votre moniteur. Vous les trouverez dans le manuel fourni avec
l'écran ou grâce à un outil tel que <c>sys-apps/ddcxinfo-knoppix</c>.
</p>

<warn>
Veuillez utiliser les valeurs indiquées dans le manuel de votre moniteur. Si
vous utilisez des valeurs incorrectes, vous pourriez endommager votre écran.
</warn>

<p>
Dans l'exemple suivant, nous définissons une ligne <c>Modes</c> et la
profondeur de couleur pour utiliser une résolution de 1024x768 en 24 bits par
défaut. Ne recopiez pas ces valeurs bêtement, vous voudrez sans doute en
utiliser d'autres.
</p>

<pre caption="Modifier la section Screen dans /etc/X11/xorg.conf">
Section "Screen"
  Identifier  "Default Screen"
  Device    "S3 Inc. ProSavage KN133 [Twister K]"
  Monitor   "Generic Monitor"
  <i>DefaultDepth  24</i>
  <comment># Toutes les lignes ne sont pas recopiées ici par souci de lisibilité</comment>
  SubSection "Display"
    Depth   24
    <i>Modes   "1024x768"</i>
  EndSubSection
EndSection
</pre>

<p>
Démarrez votre serveur (<c>startx</c>) pour vérifier qu'il utilise la
résolution souhaitée.
</p>

</body>
</section>
<section>
<title>Configurer le clavier</title>
<body>

<p>
Pour utiliser un clavier international, trouvez la section <e>InputDevice</e>
et ajoutez l'option <c>XkbLayout</c> pour indiquer la disposition de votre
clavier. Dans l'exemple suivant, nous définissons un clavier belge. Indiquez
simplement le code de votre pays. Veuillez noter qu'il faut indiquer
<c>ca_enhanced</c> pour un clavier canadien français.
</p>

<pre caption="Définir la disposition du clavier">
Section "InputDevice"
  Identifier  "Generic Keyboard"
  Driver    "keyboard"
  Option    "CoreKeyboard"
  Option    "XkbRules"  "xorg"
  Option    "XkbModel"  "pc105"
  <i>Option    "XkbLayout" "be"</i>
EndSection
</pre>

</body>
</section>
<section>
<title>Configurer la souris</title>
<body>

<p>
Si votre souris ne fonctionne pas, vous devez d'abord vérifier si elle est
détectée par le noyau. Les souris apparaissent sous
<path>/dev/input/mouse0</path> (ou <path>/dev/input/mice</path> si vous
utilisez plusieurs souris.) Parfois, <path>/dev/psaux</path> est utilisé. Pour
vérifier que le périphérique correspond bien à votre souris, essayez
ceci&nbsp;:
</p>

<pre caption="Vérifier le fichier de périphérique de la souris">
# <i>cat /dev/input/mouse0</i>
<comment>(Déplacez votre souris.)</comment>
<comment>(Faites Ctrl-C pour arrêter.)</comment>
</pre>

<p>
Si votre souris n'est pas détectée, vérifiez que les modules nécessaires sont
bien chargés.
</p>

<p>
Si votre souris est détectée, indiquez le nom du fichier de périphérique dans
la section <e>InputDevice</e>. Dans l'exemple suivant, nous définissons aussi
les options <c>Protocol</c> qui spécifie le protocole à utiliser (en général
PS/2 ou IMPS/2) et <c>ZAxisMapping</c> qui permet d'utiliser la molette.
</p>

<pre caption="Définir les paramètres de la souris">
Section "InputDevice"
  Identifier  "TouchPad Mouse"
  Driver    "mouse"
  Option    "CorePointer"
  <i>Option    "Device"    "/dev/input/mouse0"</i>
  <i>Option    "Protocol"    "IMPS/2"</i>
  <i>Option    "ZAxisMapping"    "4 5"</i>
EndSection
</pre>

<p>
Démarrez votre serveur (<c>startx</c>) et appréciez&nbsp;! Bravo, vous disposez
maintenant d'un serveur X sur votre machine. L'étape suivante est de remplacer
l'horrible gestionnaire de fenêtres actuel par un gestionnaire plus évolué,
voire un environnement graphique complet tel que KDE ou GNOME, mais cela
dépasse l'objectif de ce guide.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Ressources</title>
<section>
<title>Créer et adapter xorg.conf</title>
<body>

<p>
La page man (<c>man 5 xorg.conf</c>) contient une référence complète sur la
syntaxe du fichier de configuration. Vous devriez afficher cette page dans un
autre terminal quand vous modifiez xorg.conf.
</p>

<p>
Le répertoire <path>/usr/X11R6/lib/X11/doc</path> contient divers fichiers
<path>README</path> dont un par type de carte graphique.
</p>

<p>
De nombreux sites peuvent vous aider à modifier votre <path>xorg.conf</path>.
Utilisez <uri link="http://www.google.com">Google</uri> pour les découvrir.
Étant donné que les fichiers <path>xorg.conf</path> et <path>XF86Config</path>
(le fichier de configuration de XFree86) sont très similaires et que plus
d'information sur ce dernier est disponible, les liens ci-dessous devraient
vous intéresser&nbsp;:
</p>

<ul>
  <li>
    <uri link="http://tldp.org/HOWTO/XFree-Local-multi-user-HOWTO/">le guide de
    configuration de XFree pour une installation locale avec plusieurs
    utilisateurs</uri>&nbsp;;
  </li>
  <li>
    <uri
    link="http://www-106.ibm.com/developerworks/edu/os-dw-linuxxwin-i.html">une
    introduction à XFree 4.x</uri> par Chris Houser.
  </li>
</ul>

</body>
</section>
<section>
<title>Autres ressources</title>
<body>

<p>
Si vous voulez mettre à jour votre système depuis l'ancien Xorg monolithique
vers le nouveau Xorg 7 modulaire, veuillez consulter le <uri
link="/proj/fr/desktop/x/x11/modular-x-howto.xml">Guide de migration vers X.Org
modulaire</uri>.
</p>

<p>
La section <uri link="/doc/fr/?catid=desktop">La station de travail Gentoo</uri>
vous apportera plus d'informations sur la façon de configurer différents paquets
pour fonctionner dans votre environnement X.
</p>

</body>
</section>
</chapter>
</guide>
