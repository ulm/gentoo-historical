<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/kernel-upgrade.xml,v 1.3 2004/12/08 11:48:12 cam Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/fr/kernel-upgrade.xml" lang="fr">
<title>Guide de mise à jour du noyau Gentoo Linux</title>
<author title="Auteur">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Traducteur">
	<mail link="ribosome@gentoo.org">Olivier Fisette</mail>
</author>

<abstract>
Ce document vous explique comment mettre à jour votre noyau pour passer
d'une version à une autre.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>0.1.1</version>
<date>2004-12-06</date>

<chapter>
<title>Introduction</title>
<section>
<body>

<p>
Les noyaux sont une des rares catégories de paquets logiciels disponibles dans
Portage qui nécessitent une invervention manuelle lors des mises à jour.
Portage télécharge et installe pour vous les sources du noyau de votre choix,
mais vous devez ensuite procéder vous-même à la compilation du noyau afin que
ce dernier puisse être utilisé par votre système.
</p>

<p>
Bien que ce guide soit destiné avant tout aux utilisateurs qui veulent mettre
leur noyau à jour, il peut également être utile à ceux qui veulent passer d'un
type de noyau à un autre.
</p>

<p>
<c>gentoo-dev-sources</c> est utilisé à titre d'exemple dans le présent
document. Toutefois, les instructions décrites ce-dessous s'appliquent à tous
les paquets logiciels de noyaux disponibles dans l'arbre Portage.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Pourquoi mettre à jour le noyau&nbsp;?</title>
<section>
<body>

<p>
De façon générale, mettre un noyau à jour en passant d'une version mineure à
une autre plus récente n'amène pas de changement majeur. Les mises à jour du
noyau sont habituellement réalisées afin de profiter d'une nouvelle
fonctionnalité ou d'un nouveau pilote de périphérique, afin de se protéger
contre une faille de sécurité, ou simplement afin de maintenir un système sain
et à jour.
</p>

<p>
Même si vous décidez de ne pas mettre votre noyau à jour chaque fois qu'une
nouvelle version est disponible, nous vous recommandons de procéder à des mises
à jour de temps à autre. Il est fortement recommandé de mettre votre noyau à
jour dès qu'un problème de sécurité est corrigé dans une version plus récente.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Obtenir les nouvelles sources avec Portage</title>
<section>
<body>

<p>
La mise à jour des sources d'un noyau se fait de la même façon que la mise à
jour de n'importe quel paquet logiciel&nbsp;: avec le programme <c>emerge</c>.
Vous déciderez probablement de mettre votre noyau à jour lorsque ses sources
apparaîtront dans la liste des mises à jour «&nbsp;world&nbsp;». Par
exemple,&nbsp;:
</p>

<pre caption="De nouvelles sources sont disponibles et affichées dans la liste des mises à jour">
# <i>emerge -Dup world</i>
Calculating dependencies ...done!
[ebuild     U ] sys-kernel/gentoo-dev-sources-2.6.9-r2 [2.6.8-r5]
</pre>

<p>
Vous pouvez alors aller de l'avant et installer la mise à jour&nbsp;:
</p>

<pre caption="Mettre à jour les sources du noyau">
# <i>emerge -u gentoo-dev-sources</i>
</pre>

<p>
Les sources du noyau seront installées dans un sous-répertoire de
<path>/usr/src</path>. Dans l'exemple ci-dessus, les sources seraient
installées dans <path>/usr/src/linux-2.6.9-gentoo-r2</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Mettre à jour le lien symbolique /usr/src/linux</title>
<section>
<body>

<p>
Il est nécessaire d'avoir un lien symbolique nommé <path>/usr/src/linux</path>
pointant vers les sources du noyau que vous utilisez.
</p>

<p>
Dans le présent cas, il faut mettre à jour le lien symbolique pour qu'il
pointe vers les sources du noyau vers lequel se fera la mise à jour.
</p>

<pre caption="Mise à jour du lien /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>

</body>
</section>
</chapter>

<chapter id="install">
<title>Configurer, compiler et installer le nouveau noyau</title>
<section>
<body>

<p>
Pour toutes ces étapes, vous pouvez vous référer aux instructions du <uri
link="/doc/fr/handbook/">Manuel Gentoo</uri> relatives à la <e>configuration du
noyau</e> et à la <e>configuration du chargeur de démarrage</e>. Ces
instructions sont résumées ci-dessous.
</p>

</body>
</section>
<section>
<title>Option&nbsp;1&nbsp;: Configuration automatique du noyau avec Genkernel</title>
<body>

<p>
Si vous utilisez Genkernel, vous n'avez qu'à répéter les étapes que vous avez
effectuées la première fois que vous avez installé votre noyau.
</p>

<p>
Exécutez Genkernel de façon standard&nbsp;:
</p>

<pre caption="Exécuter Genkernel">
# <i>genkernel all</i>
</pre>

<p>
Vous pouvez aussi utiliser des paramètres supplémentaires pour activer
certaines fonctionnalités de Genkernel. Par exemple, si vous souhaitez
préciser quelques options du noyau avec <c>menuconfig</c> et si vous voulez
que Genkernel mette à jour la configuration de votre chargeur de démarrage
GRUB automatiquement, exécutez Genkernel avec la commande suivante&nbsp;:
</p>

<pre caption="Exécuter Genkernel avec quelques options populaires">
# <i>genkernel --menuconfig --bootloader=grub all</i>
</pre>

<p>
Pour plus d'information, consultez le <uri link="/doc/fr/genkernel.xml">Guide
Genkernel pour Gentoo Linux</uri> ou référez-vous au Manuel Gentoo.
</p>

</body>
</section>
<section>
<title>Option&nbsp;2&nbsp;: Configuration manuelle</title>
<body>

<p>
Tout d'abord, ouvrez l'utilitaire <c>menuconfig</c> à partir de l'arbre des
sources du noyau&nbsp;:
</p>

<pre caption="Exécuter menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Choisissez les options requises pour votre matériel et votre environnement. Si
nécessaire, le <e>Manuel Gentoo</e> vous guidera dans cette procédure.
</p>

<p>
Ensuite, compilez votre noyau et copiez-le dans votre partition de démarrage.
Encore une fois, référez-vous aux instructions du Manuel Gentoo, et n'oubliez
pas de monter votre partition <path>/boot</path> avant de faire la
copie&nbsp;! (Dans les instructions du Manuel, <path>/boot</path> a déjà été
monté lors d'une étape précédente.)
</p>

<pre caption="Compiler et installer le nouveau noyau">
# <i>make &amp;&amp; make modules_install</i>
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Finalement, vous devriez mettre à jour la configuration de votre chargeur de
démarrage par l'ajout d'une entrée pour votre nouveau noyau. (Ne supprimez pas
tout de suite l'entrée référant à votre ancien noyau&nbsp;!) Démontez la
partition <path>/boot</path>. Vous pouvez, cette fois encore, vous référez aux
instructions du Manuel Gentoo.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Réinstaller les modules externes</title>
<section>
<body>

<p>
Si vous utilisez un ou plusieurs modules du noyau qui ne sont pas inclus dans
l'arbre des sources du noyau mais qui sont plutôt fournis par d'autres paquets
logiciels disponibles dans Portage (par exemple, les pilotes graphiques de ATI
ou Nvidia), vous devez réinstaller ces paquets à chaque fois que vous mettez à
jour le noyau. Rien de plus simple, puisque vous n'avez qu'à exécuter à nouveau
la commande emerge que vous aviez utilisée pour installer le paquet en
question. Le chapitre <e>Configurer le noyau</e> du <uri
link="/doc/fr/handbook/">Manuel Gentoo</uri> explique cette procédure. La
réinstallation de ces paquets garantit que les modules ont été compilés pour
l'arbre des sources présent dans <path>/usr/src/linux</path>&nbsp;;
c'est-à-dire qu'ils seront installés précisément pour le noyau que vous venez
de compiler.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Redémarrer avec le nouveau noyau</title>
<section>
<body>

<p>
Maintenant, fermez toutes vos applications et redémarrez votre système. Si
vous avez suivi les instructions ci-dessus correctement, vous devriez obtenir
une entrée pour votre nouveau noyau dans votre chargeur de démarrage.
Choisissez ce nouveau noyau pour amorcer le système.
</p>

<p>
Votre système devrait alors démarrer sans problème&nbsp;; vous pouvez ouvrir
une session et continuer votre travail comme à l'habitude. Si tout
fonctionne, la procédure de mise à jour est alors terminée.
</p>

<p>
Si vous avez commis une erreur et que votre système n'arrive pas à démarrer
avec votre nouveau noyau, redémarrez le système et amorcez votre ancien noyau.
Vous pouvez alors reprendre la procédure à l'étape de <uri
link="#install">configuration, compilation et installation</uri>. Faites les
changements appropriés pour corriger vos erreurs. Dans certains cas (par
exemple le simple oubli d'un pilote réseau), il n'est même pas nécessaire de
redémarrer pour procéder aux changements.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Utiliser plusieurs noyaux concurremment</title>
<section>
<body>

<p>
Vous avez peut-être remarqué que lors de l'installation des sources de votre
nouveau noyau, les sources du noyau existant n'ont pas été supprimées. Cela
est volontaire et vous permet d'alterner facilement entre plusieurs noyaux.
</p>

<p>
Alterner entre plusieurs noyaux ne nécessite rien d'autre que de conserver les
sources dans <path>/usr/src/</path> et de laisser les fichiers binaires
<path>bzImage</path> dans votre partition <path>/boot</path> (ces fichiers
doivent être référencés par des entrées appropriées dans la configuration de
votre chargeur de démarrage). Chaque fois que vous démarrerez, vous pourrez
choisir le noyau à amorcer.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Supprimer les vieux noyaux</title>
<section>
<body>

<p>
Il est fort possible que vous soyez tout à fait satisfait de votre nouveau
noyau et que vous n'ayez pas besoin de conserver les anciennes versions sur
votre système. Pour supprimer facilement toutes les sources sauf la plus
récente pour un noyau donné, utilisez l'option <e>prune</e> de la commande
emerge. Poursuivons l'exemple précédent utilisant gentoo-dev-sources&nbsp;:
</p>

<pre caption="Supprimer les anciennes versions">
# <i>emerge -P gentoo-dev-sources</i>
</pre>

<p>
Dans la plupart des cas, des fichiers temporaires créés pendant la compilation
resteront dans le répertoire source dans <path>/usr/src</path>. Vous pouvez
sereinement supprimer ces fichiers avec <c>rm</c>.
</p>

<p>
Vous pouvez également supprimer les modules utilisés par les anciens noyaux sans
problème. Pour ce faire, il vous suffit de supprimer les sous-répertoires
appropriés dans <path>/lib/modules/</path> (ceux qui correspondent aux
versions des noyaux dont vous avez supprimé les sources). Faites attention à
ne pas supprimer des modules appartenant à des noyaux que vous utilisez
encore&nbsp;!
</p>

<p>
Finalement, vous pouvez monter votre partition <path>/boot</path> et
supprimer les fichiers <path>bzImage</path> et <path>System.map</path> des
noyaux que vous avez supprimés. Vous devriez aussi configurer votre chargeur
de démarrage pour retirer les entrées qui font référence aux noyaux supprimés.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Problèmes rencontrés suite à la mise à jour du noyau</title>
<section>
<body>

<p>
La rapidité du développement du noyau Linux rend inévitable l'apparition de
problèmes dus aux changements apportés au noyau de version en version. Si vous
éprouvez de tels problèmes avec les versions les plus récentes des <uri
link="/doc/fr/gentoo-kernel.xml#doc_chap2">noyaux supportés par Gentoo</uri>,
veuillez nous les rapporter.
</p>

</body>
</section>
</chapter>

</guide>
