<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/gentoo-upgrading.xml,v 1.22 2006/03/06 22:13:31 cam Exp $ -->

<guide link="/doc/fr/gentoo-upgrading.xml" lang="fr">
<title>Guide des mises à jour de Gentoo</title>

<author title="Auteur">
  <mail link="greg_g@gentoo.org">Gregorio Guidi</mail>
</author>
<author title="Traducteur">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Traducteur">
  <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Ce document décrit la marche à suivre lors de la sortie d'une nouvelle version
de Gentoo.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.2</version>
<date>2006-02-12</date>

<chapter>
<title>Gentoo et les mises à jour</title>
<section>
<title>Philosophie</title>
<body>

<p>
Dans le monde de Gentoo, le concept de mise à jour est différent de la plupart
des distributions.  Vous avez sans doute déjà remarqué que vous ne devez pas
attendre la prochaine version, la télécharger, graver un CD et ensuite réaliser
la mise à jour comme c'est souvent le cas avec d'autres distributions.
</p>

<p>
Vous savez que ce processus est frustrant pour des utilisateurs avancés qui
veulent les dernières versions des logiciels installées. C'est pour cette même
raison que des outils tels que apt ou apt-rpm ont vu le jour. Les utilisateurs
des autres distributions veulent aussi mettre à jour quand ils le souhaitent.
Cependant, Gentoo est la meilleure distribution pour ceux qui veulent rester à
jour en permanence, car elle a été conçue pour être actualisée au jour le jour.
</p>

<p>
En principe, vous ne devriez installer qu'une seule fois et ne plus vous
soucier des nouvelles versions par la suite. Suivez les indications du chapitre
<uri link="/doc/fr/handbook/handbook-x86.xml?part=2&amp;chap=1">Introduction à
Portage</uri> du Manuel Gentoo pour maintenir votre système à jour.  Cependant,
il peut arriver que des modifications soient apportées au cœur du système, ce
qui requiert une intervention manuelle de l'utilisateur.
</p>

</body>
</section>
<section>
<title>Les versions et les profils</title>
<body>

<p>
Une question fréquente est&nbsp;: «&nbsp;pourquoi sortez-vous des nouvelles
versions régulièrement si ce n'est pour que les utilisateurs mettent leur
installation à jour&nbsp;?&nbsp;». Il y a plusieurs raisons&nbsp;:
</p>

<ul>
  <li>
    Une nouvelle version, c'est de nouveaux CD d'installation avec des
    corrections de bogues et plus de fonctionnalités.
  </li>
  <li>
    Une nouvelle version fournit des paquets précompilés à jour et permet aux
    utilisateurs qui optent pour une installation rapide (stage3 + paquets
    précompilés) d'obtenir un système relativement à jour.
  </li>
  <li>
    Une nouvelle version peut, de temps en temps, ajouter des fonctionnalités
    incompatibles avec les versions précédentes.
  </li>
</ul>

<p>
Quand une nouvelle version contient des fonctionnalités incompatibles avec les
versions précédentes ou quand elle fournit un jeu de paquets ou de réglages qui
modifient profondément le comportement du système, nous disons que la version
installe un nouveau <e>profil</e>.
</p>

<p>
Un <e>profil</e> est un ensemble de fichiers de configuration stockés dans un
sous-répertoire de <path>/usr/portage/profiles/</path>. Ces fichiers
contiennent par exemple la liste des ebuilds qui constituent les paquets de
base du système, les options USE par défaut, les paquets qui correspondent aux
paquets virtuels et le nom de l'architecture sur laquelle le système tourne.
</p>

<p>
Le profil en cours d'utilisation est défini par le lien symbolique
<path>/etc/make.profile</path> qui pointe vers un sous-répertoire de
<path>/usr/portage/profiles</path> où sont stockés tous les profils. Par
exemple, le profil x86 2005.1 par défaut se trouve dans
<path>/usr/portage/profiles/default-linux/x86/2005.1</path>. Les fichiers des
répertoires parents font également partie du profil. Ce
système permet de partager des fichiers entre plusieurs sous-profils, c'est
pourquoi nous les appelons les <e>profils en cascade</e>.
</p>

<p>
Les profils rendus obsolètes sont conservés dans
<path>/usr/portage/profiles</path> avec les profils actuels, mais sont marqués
comme étant surannés par la présence d'un fichier <path>deprecated</path> dans
le répertoire du profil.
Le contenu de ce fichier est le nom du profil qui remplace le profil obsolète.
Portage utilise cette information pour vous avertir quand vous devez mettre à
jour votre profil.
</p>

<p>
Plusieurs raisons peuvent justifier la création d'un nouveau profil&nbsp;:
l'utilisation de nouvelles versions des paquets de base tels que
<c>baselayout</c>, <c>gcc</c> ou <c>glibc</c> qui seraient incompatibles avec
les versions antérieures, une modification des options USE par défaut, un
changement des correspondances entre les paquets virtuels et les paquets
utilisés ou encore une modification d'un paramètre système global.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Rester à jour</title>
<section>
<title>Nouvelles versions sans changement de profil</title>
<body>

<p>
Quand une nouvelle version de Gentoo est annoncée et qu'elle ne contient pas de
nouveau profil, vous pouvez l'ignorer en toute sûreté.
</p>

<p>
Si vous mettez votre système à jour régulièrement comme <uri
link="/doc/fr/handbook/handbook-x86.xml?part=2&amp;chap=1">expliqué dans le
Manuel Gentoo</uri>, votre système est identique à ce que vous obtiendriez en
faisant une nouvelle installation.
</p>

</body>
</section>
<section>
<title>Nouvelles versions avec changement de profil</title>
<body>

<p>
Si une nouvelle version (comme la <b>2005.1</b> par exemple) ajoute un nouveau
profil, vous avez le choix de migrer vers ce nouveau profil.
</p>

<p>
Évidemment, vous n'y êtes pas obligé et vous pouvez continuer à utiliser
l'ancien et à mettre vos paquets à jour comme <uri
link="/doc/fr/handbook/handbook-x86.xml?part=2&amp;chap=1">expliqué dans le
Manuel Gentoo</uri>.
</p>

<p>
Cependant, Gentoo vous recommande de mettre à jour votre profil s'il devient
obsolète. Lorsque cela arrive, cela signifie que les développeurs Gentoo ne
comptent plus s'en occuper. En utilisant la table ci-dessous, vous pourrez
rapidement vérifier quels profils sont actuellement supportés.
</p>

<p>
Pour migrer vers un nouveau profil, vous devez réaliser la mise à jour
manuellement. La manière à utiliser pour la mise à jour peut varier
considérablement d'une version à une autre. Cela dépend de l'importance des
modifications qui ont été apportées au nouveau profil.
</p>

<p>
Dans le plus simple des cas, vous devez juste modifier le lien symbolique
<path>/etc/make.profile</path>. Dans le pire des cas, vous devrez recompiler
tout votre système. Les instructions sont généralement fournies avec la
nouvelle version de Gentoo. Vous trouverez également des
<uri link="#instructions">instructions</uri> à la fin de ce guide.
</p>

</body>
</section>
<section>
<title>Profils supportés</title>
<body>

<p>
Les profils suivants sont officiellement supportés par les développeurs
Gentoo&nbsp;:
</p>

<table>
<tr>
  <th>Architecture</th>
  <th>Profils les plus récents</th>
  <th>Anciens profils supportés</th>
</tr>

<tr>
<th>alpha</th>
  <ti>2005.0, 2005.0/2.4</ti>
  <ti></ti>
</tr>
<tr>
  <th>arm</th>
  <ti>2004.3</ti>
  <ti></ti>
</tr>
<tr>
  <th>amd64</th>
  <ti>2005.1, 2005.1/no-multilib</ti>
  <ti>2005.0, 2005.0/no-multilib, 2004.3</ti>
</tr>
<tr>
  <th>hppa</th>
  <ti>2005.0, 2005.0/2.4</ti>
  <ti>2004.3, 2004.2</ti>
</tr>
<tr>
  <th>ia64</th>
  <ti>2005.0</ti>
  <ti>2004.3</ti>
</tr>
<tr>
  <th>ppc</th>
  <ti>2005.1</ti>
  <ti>2005.0, 2004.3, 2004.0</ti>
</tr>
<tr>
  <th>mips</th>
  <ti>2005.0</ti>
  <ti>2004.2</ti>
</tr>
<tr>
  <th>s390</th>
  <ti>2004.3</ti>
  <ti></ti>
</tr>
<tr>
  <th>sparc</th>
  <ti>2005.1</ti>
  <ti>2005.0</ti>
</tr>
<tr>
  <th>x86</th>
  <ti>2005.1, 2005.1/2.4</ti>
  <ti>2005.0, 2005.0/2.4</ti>
</tr>
</table>

</body>
</section>
</chapter>

<chapter id="instructions">
<title>Mise à jour de votre profil</title>
<section>
<title>Mise à jour vers 2005.1</title>
<body>

<p>
Pour faire passer votre profil en version 2005.1, faites pointer le lien
<path>/etc/make.profile</path> vers le nouveau répertoire. Assurez-vous que
Portage ait bien été mis à jour avant de procéder à cette manipulation.
</p>

<pre caption="Passer le profil en 2005.1">
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/</i>&lt;selected profile&gt;<i> /etc/make.profile</i>
</pre>

<p>
<b>Toutes architectures</b>&nbsp;: Il n'y a pas de changement fondamental dans
ce nouveau profil. Aucune action particulière n'est à entreprendre.
</p>

<p>
<b>ppc</b>&nbsp;: Avec la version 2005.1, les profils ppc et ppc64 ont fusionné
et un certain nombre de sous-profils spécifiques aux diverses sous-architectures
ont été créés. Assurez-vous de choisir le bon profil pour votre système lorsque
vous procéderez à la migration vers le profil 2005.1.
</p>

</body>
</section>
<section>
<title>Mise à jour vers 2005.0</title>
<body>

<p>
Avec l'arrivée de 2005.0, plusieurs architectures ont décidé de définir de
nouveaux profils. Lisez attentivement les descriptions de ces profils avant de
vous lancer dans une éventuelle migration vers l'un d'entre eux. La plupart des
architectures utilisent maintenant la branche 2.6 du noyau par défaut alors
qu'avant c'était la 2.4 qui était choisie.
</p>

<p>
Quelques architectures requièrent quelques actions supplémentaires avant de
pouvoir passer d'un profil à un autre. Lorsque c'est le cas, un lien dans la
table ci-dessous vous amènera vers un guide étape par étape pour vous assister.
</p>

<table>
<tr>
  <th>Profil</th>
  <th>Description</th>
  <th>Guide de mise à jour spécifique</th>
</tr>
<tr>
  <ti>default-linux/alpha/2005.0</ti>
  <ti>Profil Alpha 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/alpha/2005.0/2.4</ti>
  <ti>Profil Alpha 2005.0 en noyau 2.4</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/amd64/2005.0</ti>
  <ti>Profil AMD64 2005.0 par défaut en noyau 2.6</ti>
  <ti/>
</tr>
<tr>
  <ti>default-linux/amd64/2005.0/no-multilib</ti>
  <ti>Profil AMD64 2005.0 pour une installation avec multilib désactivé</ti>
  <ti/>
</tr>
<tr>
  <ti>default-linux/arm/2005.0</ti>
  <ti>Profil ARM 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/hppa/2005.0</ti>
  <ti>Profil HPPA 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/hppa/2005.0/2.4</ti>
  <ti>Profil HPPA 2005.0 en noyau 2.4</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/2005.0</ti>
  <ti>Profil MIPS 2005.0 par défaut</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/cobalt/2005.0</ti>
  <ti>Profil MIPS 2005.0 pour Cobalt</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/n32/2005.0</ti>
  <ti>Profil 2005.0 64-bit pour les MIPS qui supportent n32</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/ip28/2005.0</ti>
  <ti>Profil 2005.0 64-bit pour les Indigo2 Impact</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/2005.0</ti>
  <ti>Profil MIPS 2005.0 64-bit</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/ppc/2005.0</ti>
  <ti>Profil PPC 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/ppc64/2005.0</ti>
  <ti>Profil PPC64 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/s390/2005.0</ti>
  <ti>Profil S390 2005.0 par défaut</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/sparc/sparc32/2005.0</ti>
  <ti>Profil Sparc 32-bit 2005.0 par défaut</ti>
  <ti></ti>
</tr>
<!-- http://dev.gentoo.org/~dsd/kernel-2.6.htm
     No subprofiles for sparc
<tr>
  <ti>default-linux/sparc/sparc32/2005.0/2.6</ti>
  <ti>Sparc 32-bit 2005.0 profile for 2.6 kernels</ti>
  <ti></ti>
</tr>
-->
<tr>
  <ti>default-linux/sparc/sparc64/2005.0</ti>
  <ti>Profil Sparc 64-bit 2005.0 par défaut</ti>
  <ti></ti>
</tr>
<!-- http://dev.gentoo.org/~dsd/kernel-2.6.htm
     No subprofiles for sparc
<tr>
  <ti>default-linux/sparc/sparc64/2005.0/2.6</ti>
  <ti>Sparc 64-bit 2005.0 profile for 2.6 kernels</ti>
  <ti></ti>
</tr>
-->
<tr>
  <ti>default-linux/x86/2005.0</ti>
  <ti>Profil x86 2005.0 par défaut en noyau 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/x86/2005.0/2.4</ti>
  <ti>Profil x86 2005.0 en noyau 2.4</ti>
  <ti></ti>
</tr>
</table>

<p>
Pour basculer vers le profil sélectionné, faites pointer le lien symbolique
<path>/etc/make.profile</path> vers le nouveau répertoire. Portage doit être mis
à jour <e>avant</e> de changer de profil&nbsp;!
</p>

<pre caption="Basculer vers le profil 2005.0">
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/</i>&lt;selected profile&gt;<i> /etc/make.profile</i>
</pre>

<p>
Si vous êtes actuellement sous Linux 2.4 et souhaitez passer sur un profil en
2.6, nous vous invitons à lire le <uri link="migration-to-2.6.xml">guide Gentoo
exhaustif pour la migration vers Linux 2.6</uri>.
</p>

</body>
</section>
<section>
<title>Mise à jour vers 2004.3</title>
<body>

<p>
Les profils de la version 2004.3 ne sont pas très différents des versions
précédentes.  Cependant, certains vieux profils ont été rendus obsolètes pour
faciliter l'adoption des <e>profils en cascade</e>, c'est-à-dire les profils qui
respectent les nouvelles conventions dans le répertoire
<path>/usr/portage/profiles</path> (par exemple,
<path>/usr/portage/profiles/default-linux/x86/2004.3</path>.) Portage utilise
ces conventions depuis la version 2.0.51.
</p>

<p>
Pour passer au profil 2004.3, modifiez le lien symbolique
<path>/etc/make.profile</path> pour le faire pointer vers le nouveau
profil&nbsp;:
</p>

<warn>
N'oubliez pas de mettre Portage à jour <e>avant</e> de changer de profil.
</warn>

<pre caption="Mettre le lien symbolique /etc/make.profile à jour">
<comment>Remplacer &lt;arch&gt; par votre architecture</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-linux/&lt;arch&gt;/2004.3 /etc/make.profile</i>
</pre>

<p>
<b>Toutes architectures</b> - Il n'y a pas de changement fondamental depuis les
profils précédents.  Cependant, veuillez remarquer que les paquets
<c>sys-apps/slocate</c> et <c>net-misc/dhcpcd</c> ne font plus partie des
paquets système. Ceci signifie que si vous lancez <c>emerge --depclean</c>,
Portage les supprimera. Si vous utilisez ces paquets, vous devez les ajouter
dans <path>/var/lib/portage/world</path> ou les installer manuellement avec la
commande <c>emerge</c>.
</p>

<p>
<b>ppc</b> - <c>sys-fs/udev</c> est utilisé par défaut au lieu de
<c>sys-fs/devfs</c> lors d'une nouvelle installation. Les installations
existantes ne sont pas affectées.
</p>

</body>
</section>
<section>
<title>Mettre Portage à jour pour qu'il supporte les profils en cascade</title>
<body>

<p>
Bien que cette section ne semble pas liée à la mise à jour de Gentoo, elle est
très importante. Les profils cités ci-dessus nécessitent une version de Portage
qui supporte les profils en cascade. Certains anciens profils bloquent la mise
à jour de Portage. Parfois, le profil utilisé n'est plus dans Portage. Dans ces
cas-là, toute tentative de mise à jour de Portage échouera.
</p>

<p> 
Pour résoudre ce problème, vous devez utiliser un lien symbolique temporaire
qui pointe vers le profil <e>obsolète</e>, mettre Portage à jour et ensuite
effectuer la mise à jour décrite dans ce guide.
</p>

<pre caption="Mettre Portage à jour via un profil obsolète">
# <i>rm /etc/make.profile</i>
# <i>cd /etc</i> 
<comment>(Remplacez &lt;arch&gt; par votre architecture ci-dessous)</comment>
# <i>ln -sf ../usr/portage/profiles/obsolete/&lt;arch&gt; make.profile</i>
# <i>emerge -n '>=sys-apps/portage-2.0.51'</i>
</pre>

</body>
</section>
<section>
<title>Mise à jour vers 2004.2</title>
<body>

<p>
Pour passer au profil 2004.2, modifiez le lien symbolique
<path>/etc/make.profile</path> pour le faire pointer vers le nouveau
profil&nbsp;:
</p>

<warn>
N'oubliez pas de mettre Portage à jour <e>avant</e> de changer de profil.
</warn>

<pre caption="Mettre le lien symbolique /etc/make.profile à jour">
<comment>Remplacer &lt;arch&gt; par votre architecture</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-linux/&lt;arch&gt;/2004.2 /etc/make.profile</i>
</pre>

<p>
<b>x86</b> - Ce profil change l'implémentation X11 par défaut de
<c>x11-base/xfree</c> à <c>x11-base/xorg-x11</c>. Ce changement ne modifie que
la valeur par <e>défaut</e> et n'affecte que les personnes qui n'ont pas encore
installé de serveur X. Si vous en avez déjà installé un, alors cela ne vous
affectera pas du tout. Vous êtes libre de passer d'un serveur X à l'autre comme
avant.
</p>

<p>
<b>amd64</b> - Il n'y a pas de changement fondamental depuis les
profils précédents. Aucune action spécifique n'a besoin d'être faite.
</p>

</body>
</section>
<section>
<title>Mise à jour vers 2004.0</title>
<body>

<p>
Pour passer au profil 2004.0, il suffit de modifier le lien symbolique
<path>/etc/make.profile</path> pour le faire pointer vers le nouveau
profil&nbsp;:
</p>

<pre caption="Mettre le lien /etc/make.profile à jour">
<comment>Remplacer &lt;arch&gt; par votre architecture</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-&lt;arch&gt;-2004.0 /etc/make.profile</i>
</pre>

<p>
<b>Toutes architectures</b> - Il n'y a pas de changement fondamental depuis les
profils précédents. Aucune action spécifique n'a besoin d'être faite.
</p>

</body>
</section>
<section>
<title>Mise à jour d'un profil antérieur à 1.4 vers 1.4</title>
<body>

<p>
Cette mise à jour est complexe. Les instructions sont décrites dans le <uri
link="/doc/fr/new-upgrade-to-gentoo-1.4.xml">Guide de mise à jour Gentoo Linux
1.4</uri>.
</p>

</body>
</section>
</chapter>
</guide>
