<?xml version='1.0' encoding="UTF-8"?>

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/portage-user-fr.html">
<title>Guide de l'utilisateur de Portage</title>
<author title="Chief Architect"><mail link="drobbins@gentoo.org">Daniel Robbins</mail></author>
<author title="Editor"><mail link="thomasfl@gentoo.org">Thomas Flavel</mail></author>
<author title="Traduction"><mail link="nohar@altern.org">Arnaud Cornet</mail></author>
<abstract>Ce guide explique comment maintenir à jour ses paquets, et comment maintenir son système.</abstract>

<version>1.2.1</version>
<date>17 Oct 2001</date>

<chapter>
<title>La base</title>

<section>
<title>Télécharger l'arbre de Portage</title>
<body>

<p>Apres avoir installé Gentoo Linux et après avoir exploré un peu, vous
allez peut-être rencontrer des bugs ou défaillances de certains paquets,
peut-être allez vous vouloir installer les derniers logiciels Gentoo
Linux, ou encore vous voudrez peut etre mettre a jour vos paquets
courants. Pour ce faire, vous allez avoir besoin de télécharger l'arbre de
Portage. Nous fournissons un serveur rsync anonyme pour que vous puissiez
récuperer le dernier arbre Portage. Voici comment l'utiliser.
</p>

<p>
Tout d'abord, créer un répertoire appellé <path>/usr/portage</path>.
Ensuite, assurez vous d'avoir rsync de correctement installé. Si vous ne
l'avez pas, téléchargez le depuis un miroir ibiblio et installez le avec
la commande <c>emerge rsync-x.y.z.tbz2</c>. Ensuite, utilisez la commande
suivante pour sychroniser votre arbre Portage.
</p>
<pre>
# <i>emerge rsync</i>
</pre>

<p>La commande suivante est a lancer périodiquement pour effacer les
anciens ebuilds:</p>
<warn>
Remarquez que <c>emerge --clean rsync</c> va effacer toutes modifications
personnelles que vous avez pu faire au repertoire
<path>/usr/portage</path>, alors utilisez cette commande avec
précautions.</warn>
<pre>
# <i>emerge --clean rsync </i>
</pre>

<p>
Si vous effectuez des changements réguliers à l'arbre
<path>/usr/portage</path>, vous allez certainement vouloir contacter <mail
link="drobbins@gentoo.org">Daniel</mail> pour un accès CVS pour pouvoir
publier vos modifications au CVS officiel de Portage.
</p>

</body>
</section>

<section>
<title>Mettre à jour Portage</title>
<body>
<p>Avant d'utiliser l'arbre Portage, il est important de le mettre à jour.
Pour cela faites la chose suivante :
</p>

<pre>
# <i>cd /usr/portage/sys-apps/portage</i>
# <i>emerge portage-x.y.z.ebuild</i>
</pre>

<p>Maintenant vous allez utiliser la version la plus récente de portage, et
vous allez commencer à utiliser notre système d'ebuild pour mettre à jour
les logiciels installés.
</p>
</body>
</section>
</chapter>
<chapter>
<title>Introdution à <c>emerge</c></title>
<section>
<title><c>emerge --pretend</c></title>
<body><p> 
Pour installer un paquet , entrez dans son répertoire dans
<path>/usr/portage</path>,
exemple :</p>

<pre>
# <i>cd /usr/portage/net-irc/xchat</i> 
</pre>

<p>
Ensuite lancez <c>emerge --pretend</c> pour voir quelles dépendances seront
installées s'il y a lieu de le faire.</p>

<pre>
# <i>emerge --pretend xchat-1.4.3.ebuild</i>

These are the packages that I would merge, in order.

Calculating dependencies......... done!
[ebuild   U] sys-libs/zlib-1.1.3-r2 to /
[ebuild   U] dev-libs/glib-1.2.10 to /
[ebuild N  ] media-libs/jpeg-6b-r2 to /
[ebuild N  ] x11-base/xfree-4.0.3-r3 to /
[ebuild N  ] x11-libs/gtk+-1.2.10-r1 to /
[ebuild N  ] media-libs/giflib-4.1.0-r3 to /
[ebuild N  ] media-libs/tiff-3.5.6_beta to /
[ebuild N  ] media-libs/imlib-1.9.10 to /
[ebuild N  ] net-irc/xchat-1.4.3 to /
</pre>

<p>Dans ce cas particulier, nous tentons de merger <path>xchat</path> sur
une machine où X n'est pas installé. Alors, <c>emerge --pretend</c>
remarque que plusieurs dépendances doivent être installées préalablement.
Plus spécifiquement, <path>sys-libs/zlib</path> et
<path>dev-libs/glib</path> doivent être mises à jour, et un bon paquet
d'ebuilds (parmi lesquels <path>x11-base/xfree</path>, évidemment) doivent
être installés.</p>
</body>
</section>
<section>
<title>USE et <c>emerge</c></title>
<body>
<p>Ci-dessus, en exécutant <c>emerge --pretend</c> sur un système qui n'a pas
l'option <c>gnome</c> définie dans la variable <c>USE</c> dans
<path>/etc/make.conf</path>. Cela signifie que le support optionnel que
GNOME, s'il existe ne sera pas mis en place. Par contre <path>xchat</path>
<e>a</e> un support GNOME optionnel, alors regardons la sortie de
<c>emerge --pretend xchat</c> après ajout de <c>gnome</c> à la variable
d'environnement <c>USE</c> dans <path>/etc/make.conf</path>:
</p>

<pre>
# <i>emerge --pretend xchat-1.4.3.ebuild</i>

These are the packages that I would merge, in order.

Calculating dependencies............................ done!
[ebuild N  ] media-libs/jpeg-6b-r2 to /
[ebuild N  ] gnome-base/libghttp-1.0.9 to /
[ebuild N  ] media-libs/audiofile-0.2.1 to /
[ebuild N  ] media-sound/esound-0.2.22-r2 to /
[ebuild N  ] gnome-base/gnome-env-1.0 to /
[ebuild N  ] gnome-base/libxml-1.8.11 to /
[ebuild N  ] gnome-base/ORBit-0.5.8 to /
[ebuild N  ] gnome-base/oaf-0.6.5 to /
[ebuild   U] dev-libs/glib-1.2.10 to /
[ebuild N  ] net-libs/libwww-5.3.2-r1 to /
[ebuild N  ] media-libs/giflib-4.1.0-r3 to /
[ebuild N  ] dev-util/guile-1.4-r3 to /
[ebuild   U] sys-libs/zlib-1.1.3-r2 to /
[ebuild N  ] x11-base/xfree-4.0.3-r3 to /
[ebuild N  ] x11-libs/gtk+-1.2.10-r1 to /
[ebuild N  ] media-libs/tiff-3.5.6_beta to /
[ebuild N  ] media-libs/imlib-1.9.10 to /
[ebuild N  ] gnome-base/gnome-libs-1.2.13 to /
[ebuild N  ] gnome-base/glibwww-0.2-r1 to /
[ebuild N  ] gnome-base/gdk-pixbuf-0.11.0 to /
[ebuild N  ] gnome-base/gconf-1.0.0 to /
[ebuild N  ] gnome-base/gnome-vfs-1.0.1 to /
[ebuild N  ] gnome-base/control-center-1.4.0.1 to /
[ebuild N  ] gnome-base/scrollkeeper-0.2 to /
[ebuild N  ] dev-util/xml-i18n-tools-0.8.1 to /
[ebuild N  ] gnome-base/libglade-0.16-r1 to /
[ebuild N  ] gnome-base/gnome-core-1.4.0.4 to /
[ebuild N  ] net-irc/xchat-1.4.3 to /
</pre>

<p>
Comme vous pouvez le constater, avec l'ajout de <c>gnome</c> à <c>USE</c>,
emerge reconnaît que xchat devrait inclure le support optionnel GNOME. Et bien
sûr, pour que ce support optionnel GNOME compile et fonctionne correctement,
GNOME doit d'abord être installé. <c>emerge</c> déduit tout cela et ajoute
divers paquets requis par Gnome à sa liste d'ebuilds à merger. Il peut arriver
que votre variable <c>USE</c> ne soit pas définie correctement, dans ce cas
<c>emerge</c> va inclure ou exclure le support d'extensions non désirées. C'est
pourquoi je vous recommande de toujours effectuer un <c>emerge --pretend</c>
avant d'exécuter le vrai <c>emerge</c>, en particulier pour les nouveaux
ebuilds. Avec cette méthode, vous savez à quoi vous attendre. :) Une fois que
tout a l'air OK, vous pouvez continuez avec le vrai <c>emerge</c> en supprimant
l'option <c>--pretend</c> :
</p>

<pre>
# <i>emerge xchat-1.4.3.ebuild</i>
</pre>

<p>
Après l'installation des dépendances, (si elles existent, certains paquets
n'en ont pas), les sources de xchat seront téléchargées (dans
<path>/usr/portage/distfiles</path>), vérifiés, extraites, compilées et
installées dans un répertoire temporaire. Ensuite, les binaires obtenus
seront mergés au système de fichier local et une base de donnée contenant
les informations relatives aux fichiers installés et sommes de contrôles
(md5) pour tous les fichiers sera créée dans
<path>/var/db/pkg/net-irc/xchat-1.4.3/CONTENTS</path>.
</p>
</body>
</section>
</chapter>
<chapter>
<title>Mettre à jour les paquets</title>
<section>
<body>

<p>
La façon classique pour mettre à jour les paquets sous Gentoo Linux est de
merger le nouveau paquet, et ensuite de "unmerger" l'ancien paquet.
C'est un moyen sûr, (et fun!) de le faire. D'abbord, merger le nouveau
paquet commme décrit ci-dessus. Ensuite, désinstaller l'ancien paquet, en
tapant une commande du genre de celle là:
</p>

<pre>
# <i>emerge unmerge =net-irc/xchat-1.0.0-r1</i>
</pre>

<p>
Portage utilise ce qui s'appelle un unmerge "sûr"; Il va seulement supprimer les
liens vers les fichiers originaux. Si un fichier a été écrasé ou modifié peu importe la manière, il sera laissé tel quel sur le système de fichier (Portage
suppose que vous avez installé un version plus récente du fichier en
question). Alors, si vous unmergez une vieille version de xchat après avoir
mergé un version récente, l'exécutable xchat ne sera pas effacé, puisqu'il
est marqué comme plus récent, et qu'il a une somme de contrôle différente.
Les unmerges sûrs sont vraiment pratiques parce qu'ils assurent qu'une
versions du paquet soit disponible à toute heure. Si vous aviez unmergé
d'abord, alors xchat ne serait pas disponible pendant quelques minutes,
pendant le téléchargement, la compilation et l'installation de la nouvelle
version.
</p>

<impo> Maintenant Portage a la capacité appellée "config file protection". Le but
de ceci est d'empêcher que l'installation d'un nouveau paquet ne modifie les
fichiers de configuration. Par défaut, la protection est sélectionnée pour
<path>/etc</path> et les répertoires de configuration de KDE ; d'autres
pourront être ajoutés dans le futur. Tapez <c>emerge --help config</c> pour
plus de détails.
</impo>

</body>
</section>
</chapter>
</guide>
