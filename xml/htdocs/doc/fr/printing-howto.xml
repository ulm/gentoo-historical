<?xml version='1.0' encoding="UTF-8"?> 
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/printing-howto.xml,v 1.18 2004/05/03 09:54:48 neysx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/printing-howto.xml" lang="fr">

<title>Imprimer avec Gentoo</title> 

<author title="Auteur">
  <!--zhen@gentoo.org-->John P. Davis
</author>
<author title="Correcteur">
  <mail link="wleggette@gate.net">Wesley Leggette</mail>
</author>
<author title="Correcteur">
  <mail link="carl@gentoo.org">Carl Anderson</mail>
</author>
<author title="Correcteur">
  <mail link="lanius@gentoo.org">Heinrich Wendel</mail>
</author>
<author title="Relecteur">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Correcteur">
  <mail link="phil@thenexusproject.org">Phil Bordelon</mail>
</author> 
<author title="Traducteur">
  <mail link="xluthi@netcourrier.com">Xavier Lüthi</mail>
</author>
<author title="Traducteur">
  <mail link="mat@frheaven.com">Matthieu Montaudouin</mail>
</author>

<abstract>
Un guide complet pour imprimer avec Gentoo Linux.
Ce document couvre l'impression locale et en réseau.
</abstract> 

<license/>

<version>1.11</version> 
<date>1er mai 2004</date> 

<chapter> 
<title>Installer CUPS et foomatic</title> 
<section>
<body> 

<p>
Configurer l'impression sous Gentoo Linux est relativement aisé grâce à
certains très bons programmes comme CUPS (the Common Unix Printing System) et
foomatic. Ces deux programmes sont actuellement dans l'arbre de Portage et sont
très simples à configurer par l'utilisateur final.
</p> 

<p>
Notez bien que CUPS ne dépend pas du gestionnaire de bureau&nbsp;; cela
signifie que vous pouvez suivre ces instructions pour imprimer aussi bien sous
GNOME que sous KDE. Il existe d'autres possibilités pour y arriver, telles que
l'utilitaire KDE de configuration de l'impression, mais je trouve CUPS plus
simple et plus adaptable.
</p>

<p>
Avant d'installer CUPS, c'est une bonne idée de mettre à jour la variable USE
dans le fichier <path>/etc/make.conf</path>.
</p>

<pre caption="Modification de /etc/make.conf">
<comment>Ajoutez <i>cups</i>, foomaticdb, ppds et <i>usb</i> (si vous utilisez une imprimante USB)</comment>
<comment>à votre variable USE actuelle.</comment>
USE="cups foomaticdb ppds usb autre_var1 autre_var2"
</pre>

<p>
Pour plus d'informations sur la variable USE, référez-vous au <uri 
link="http://www.gentoo.org/doc/fr/use-howto.xml">guide Gentoo pour les 
paramètres USE</uri>.
</p>

<pre caption="Installation des paquets nécessaires">
# <i>emerge cups</i>
# <i>emerge foomatic </i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Mise en place des modules du noyau</title> 
<section>
<title>Généralités</title>
<body>
<p>
Maintenant que les paquets nécessaires ont été installés, il est temps
d'installer l'imprimante.
</p>

<p>
Selon le type de connexion utilisée par votre imprimante, il sera nécessaire
d'activer le port parallèle ou USB dans le noyau.
</p>

<note>
Cela est seulement nécessaire pour l'impression locale&nbsp;; si vous voulez 
imprimer via Samba, passez cette section.
</note>

<note>
Si vous n'êtes pas sûr de la marche à suivre pour compiler le noyau, consultez
le <uri link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">HOWTO du noyau
Linux</uri> (actuellement indisponible). Apprenez comment compiler et installer
de nouveaux modules sans devoir recompiler votre noyau et redémarrer votre
ordinateur. Cela vous économisera bien du temps.
</note>
</body>
</section>


<section>
<title>Modules USB</title>
<body>
<p>
Pour activer le support des imprimantes USB, activez les options <c>Support for
USB</c> et <c>USB Printer support</c> dans le menu <c>USB support</c>. Les
activer toutes les deux comme modules installera usbcore.o et printer.o dans
votre répertoire de modules.  Je vous suggère l'utilisation de modules pour ne
pas devoir redémarrer votre ordinateur.
Si vous utilisez un noyau 2.6, ces options se trouvent dans le menu
<c>Device Drivers</c>.
</p>

<p>
Une fois que le noyau est compilé et l'ordinateur redémarré (si nécessaire), il
est temps de charger les modules nécessaires&nbsp;:
</p>

<pre caption="Chargement des modules USB">
# <i>modprobe usbcore</i> 

<comment>(Avec un noyau 2.4)</comment>
# <i>modprobe printer</i> 

<comment>(Avec un noyau 2.6)</comment>
# <i>modprobe usblp</i> 
</pre> 

<p>
Une fois les modules correctement chargés, connectez l'imprimante et vérifiez
<path>/var/log/messages</path> pour voir si elle a été détectée.
</p> 

<note>
Si vous utilisez autre chose que sysklogd, le nom du fichier de journalisation 
(«&nbsp;log&nbsp;») du noyau sera différent.
</note>

<pre caption="Vérification des messages du noyau">
# <i>tail -f /var/log/messages</i>
</pre> 

<p>
Vous devriez lire quelque chose comme ceci&nbsp;:
</p>

<pre caption="Fichier /var/log/messages">
hub.c: USB new device connect on bus2/2, assigned device number 2 
printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104
</pre>
</body>
</section> 

<section>
<title>Modules pour le port parallèle</title>
<body>
<p>
Pour activer le support du port parallèle, activez les options <c>Parallel port
support</c> et <c>PC-style hardware</c> dans le menu <c>Parallel port
support</c>. Selon votre imprimante, vous devrez aussi activer <c>Multi-IO
cards (parallel and serial)</c>, <c>Support for foreign hardware</c> et <c>IEEE
1284 transfer mode</c>.  Allez ensuite dans <c>Character devices</c> et activez
<c>Parallel Printer Support</c>.
Si vous utilisez un noyau 2.6, ces options se trouvent dans le menu
<c>Device Drivers</c>.
</p>

<p>
Après avoir compilé le noyau, assurez-vous que l'imprimante est connectée et
redémarrez votre ordinateur.  Il est temps de charger les modules
nécessaires&nbsp;:
</p>

<pre caption="Chargement des modules du port parallèle">
# <i>modprobe parport</i> 
# <i>modprobe parport_pc</i>
</pre> 

<p>
Après que les modules se soient chargés correctement, vérifiez dans
<path>/var/log/messages</path> que l'imprimante a été détectée.
</p> 

<note>
Si vous utilisez un autre système que sysklogd, le nom du fichier de 
journalisation du noyau sera différent.
</note>

<pre caption="Vérification des messages du noyau">
# <i>tail /var/log/messages</i>
</pre> 

<p>
Vous devriez voir quelque chose comme cela&nbsp;:
</p>

<pre caption="Fichier /var/log/messages">
lp0: using parport0 (polling).</pre>
</body>
</section>

<section>
<title>Tests de bas niveau</title>
<body>

<p>
Avant de configurer l'imprimante avec CUPS, nous pouvons la tester avec
quelques commandes simples de bas niveau.
</p> 

<pre caption="Test de l'imprimante en utilisant cat">
# <i>touch test.txt</i>
# <i>echo "Hello World" > test.txt</i>
# <i>cat test.txt > /dev/usb/lp0 </i>

<comment>Une alternative pour les imprimantes sur port parallèle :</comment>
# <i>cat test.txt > /dev/lp0 </i>
</pre>

<note>
Quelques imprimantes (par exemple plusieurs HP Laserjets) nécessitent un ^L
(Control-L) à la fin du fichier pour activer l'impression.  Sans le ^L, le cat
se fera correctement, mais l'imprimante absorbera les données puis s'arrêtera
et ne fera plus rien.
</note>
</body>
</section>
</chapter>			

<chapter>
<title>Pilotes pour imprimantes spéciales</title> 
<section>
<body> 
<p>
Avant d'utiliser foomatic pour générer un fichier PPD, il peut être nécessaire
de localiser les pilotes "officiels" pour votre imprimante.  Par exemple, Epson
propose <uri
link="http://www.epkowa.co.jp/english/linux_e/linux.html">plusieurs pilotes
d'imprimantes</uri> pour les systèmes d'exploitation Open Source.  Toutefois,
comme dans le cas d'Epson, la plupart de ces pilotes ne sont pas Open Source.
</p>

<p>
Les pilotes d'imprimantes suivants sont disponibles en tant qu'ebuilds dans
Portage&nbsp;: gimp-print, omni, hpijs, pnm2ppa.
</p>

<p>
Pour la plupart des imprimantes, excepté les HP à jet d'encre, vous pourrez
utiliser les pilotes d'imprimante Linux standard. Consultez <uri
link="http://www.linuxprinting.org/printer_list.cgi">la base de données des
imprimantes supportées de linuxprinting.org</uri> pour trouver des informations
sur votre imprimante. Lisez bien la documentation fournie avec le pilote que 
vous téléchargez en ce qui concerne l'installation et les informations de 
licence.
</p> 

<impo>
Si vous utilisez une imprimante HP à jet d'encre, il est nécessaire d'installer
le pilote d'impression <c>hpijs</c>.  Ce pilote interprète correctement le
Postscript pour que l'imprimante HP fonctionne. Le pilote <c>hpijs</c> est 
seulement fait pour les imprimantes à jet d'encre HP, mais il est disponible 
dans l'arbre de Portage. La documentation de HP pour le pilote <c>hpijs</c>
sera placée dans <path>/usr/share/doc/hpijs-&lt;version&gt;</path>.  L'auteur
vous recommande <e>fortement</e> de la lire.
</impo>

<pre caption="Installer hpijs">
# <i>emerge hpijs</i>
</pre> 

<note>
Si vous utilisez une HP Laserjet, elle est peut-être supportée via le système
d'impression de GNOME.  Si vous utilisez une imprimante autre qu'une HP à jet
d'encre, il n'est pas nécessaire d'installer ce pilote spécifique.
</note>
</body>
</section>
</chapter>

<chapter> 
<title>Configuration du fichier PPD</title> 
<section>
<body> 
<p>
Il est temps de configurer l'imprimante et CUPS. Afin que votre
imprimante interprète correctement le Postscript, CUPS a besoin d'un fichier
PPD (Printer Postscript Definition). La manière la plus simple de générer un
fichier PPD est d'utiliser foomatic.
</p> 

<note>
Une autre façon de procéder est de télécharger un fichier PPD de
<uri link="http://www.linuxprinting.org">LinuxPrinting.org</uri> et
de le copier dans le répertoire <path>/usr/share/cups/model</path>.
Si vous utilisez cette méthode, vous pouvez passer directement
à la section <uri link="#doc_chap5">Configuration de CUPS</uri>.
</note>

<p>
Trois informations sont requises pour réaliser la commande ci-dessous&nbsp;: le
modèle de l'imprimante, le périphérique sur lequel est connectée l'imprimante
et le pilote d'imprimante (ce sera hpijs si vous avez eu besoin d'installer ce
pilote spécial).  Le pilote et l'ID de l'imprimante peuvent être trouvés (via
<c>grep</c>) dans la base de données de foomatic et le périphérique est
l'interface physique à laquelle est connectée l'imprimante (par exemple
<path>file:/dev/lp0</path>, <path>file:/dev/usb/lp0</path> ou, pour les
imprimantes samba, <path>smb://utilisateur:mot_de_passe@server/share</path>).
</p>

<p>
Avant d'utiliser <c>foomatic-configure</c>, n'oubliez pas de démarrer 
<c>cupsd</c>.
</p>

<pre caption="Démarrage de cupsd">
# <i>/etc/init.d/cupsd start</i>
</pre>

<pre caption="Utilisation générale de foomatic">
<comment>(Remplacez les champs $printer_model et $printer_ID par leurs valeurs respectives)</comment>
<comment>(Utilisez le résultat des deux commandes grep pour</comment>
<comment>(passer les valeurs appropriées à la commande foomatic-configure</comment>
# <i>grep $printer_model /usr/share/foomatic/db/source/printer/* </i>
# <i>grep $print_device /usr/share/foomatic/db/source/driver/* </i>
# <i>foomatic-configure -s cups -p $printer_model_number -c file:$print_device_path -n queue name -d driver </i>
</pre>

<p>
Si vous ne trouvez pas votre imprimante avec la commande <c>grep</c>,
vous pouvez la rechercher sur <uri
link="http://www.linuxprinting.org">LinuxPrinting.org</uri>
et trouver ainsi quel(s) pilote(s) supporte(nt) votre imprimante.
Ensuite, choisissez le pilote que vous voulez utiliser et installez-le&nbsp;:
</p>

<pre caption="Installer un pilote PPD">
<comment>(Si vous avez plusieurs imprimantes, utilisez des noms de queues différents,</comment>
<comment>sinon, un nom simple comme &quot;default&quot; suffit)</comment>
# <i>foomatic-configure -s cups -p &lt;modèle d'imprimante&gt; -c file:&lt;périphérique&gt; -n &lt;queue&gt; -d &lt;pilote&gt;</i>
</pre>

<p>
Voici un exemple plus spécifique&nbsp;:
le code suivant suppose que vous avez une Epson Stylus Color 980.
Bien sûr, vous devrez l'adapter à votre modèle d'imprimante.
</p>

<pre caption="Utilisation de foomatic pour une Stylus Color 980">
# <i>grep "Stylus Color 980" /usr/share/foomatic/db/source/printer/* </i>
<comment> Maintenant, cherchez la ligne contenant&nbsp;:</comment>
/usr/share/foomatic/db/source/printer/Epson-Stylus_Color_980.xml:   &lt;model>Stylus Color 980&lt;/model>
<comment> Epson-Stylus_Color_980 est l'ID de votre imprimante. </comment>

# <i>grep Epson-Stylus_Color_980 /usr/share/foomatic/db/source/driver/* </i>
/usr/share/foomatic/db/source/driver/gimp-print-ijs.xml:  &lt;printer>&lt;id>printer/Epson-Stylus_Color_980&lt;/id>&lt;/printer>
<comment> Ici, votre pilote d'imprimante est gimp-print-ijs.</comment>

# <i>foomatic-configure -s cups -p Epson-Stylus_Color_980 -c file:/dev/lp0 -n Epson -d gimp-print-ijs </i>
</pre>

<impo>
Si vous rencontrez des problèmes, vous pouvez consulter la <uri 
link="http://www.linuxprinting.org/foomatic/USAGE">documentation de 
foomatic</uri> ou vous rendre sur  <uri
link="http://www.linuxprinting.org">linuxprinting.org</uri> pour plus
d'informations.
</impo>

</body> 
</section>
</chapter> 

<chapter> 
<title>Configuration de CUPS</title>
<section>
<body> 

<p>
Maintenant que l'imprimante est configurée, il faut configurer CUPS pour qu'il
gère la file d'attente de l'imprimante.  CUPS peut être accédé via un
navigateur web sur le port 631 du serveur d'impression.
</p>

<p>
Le démon CUPS possède un fichier de configuration par défaut qui peut, mais ne
doit pas nécessairement, être modifié. Vous pouvez y jeter un coup d'œil&nbsp;; il
se nomme <path>/etc/cups/cupsd.conf</path>.
</p>

<p>
Si vous voulez utiliser uniquement la partie client de CUPS pour vous connecter
à votre serveur d'impression CUPS, modifiez le fichier
<path>/etc/cupsd/client.conf</path> et attribuez le nom de votre serveur au
paramètre <c>ServerName</c>.
</p>

<pre caption="Ajouter CUPS au niveau d'exécution par défaut et démarrer CUPS">
# <i>rc-update add cupsd default</i>
# <i>/etc/init.d/cupsd start</i>
</pre>

<p>
Le démon CUPS doit maintenant tourner&nbsp;; vous pouvez donc ouvrir votre 
navigateur favori, le diriger <uri link="http://127.0.0.1:631">ici</uri>, puis 
cliquer sur <c>Manage Printer</c>.  Vous pourrez y trouver votre imprimante 
nouvellement installée, la configurer ou imprimer une page de test.
</p> 

<note>
Si votre imprimante ne fonctionne pas, jetez un oeil au journal
<path>error_log</path> de CUPS situé dans le répertoire spécifié dans la 
configuration.
</note>

</body> 
</section>
</chapter>

<chapter>
<title>Configurer des programmes pour imprimer avec CUPS</title>
<section>
<title>Géneralités</title>
<body>
<p>
La plupart des programmes récents ont une interface CUPS native, vous ne
devrez donc rien changer. Essayez juste d'imprimer avec votre programme.
</p>
</body>
</section>
<section>
<title>The GIMP</title>
<body>

<p>
Avant tout, il faut installer les extensions de The Gimp pour pouvoir 
imprimer&nbsp;:
</p>

<pre caption="Installation de gimp-print">
# <i>emerge gimp-print</i>
</pre>

<p>
À présent, lancez The Gimp, puis ouvrez une image existante ou juste une image
vide&nbsp;; cela n'a pas d'importance car tout ce qui nous intéresse, c'est le menu
<b>File</b>. Cliquez avec le bouton droit sur l'image et allez sur
<b>File/Print</b>. Lorsque la boîte de dialogue d'impression apparaît, cliquez
sur <e>new printer</e>. Si votre imprimante n'est pas dans la liste, tapez le
nom de votre imprimante, puis sélectionnez son type. Voilà, tout est prêt pour
imprimer à partir de The Gimp. Vous pouvez affiner les paramètres et vous
amuser un peu.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Utiliser Linux comme serveur d'impression compatible Windows</title>
<section>
<body>

<p>
Linux est un bon serveur d'impression, en fait c'est un bon serveur pour tout.
La première chose à faire est d'éditer le fichier
<path>/etc/samba/smb.conf</path> pour ajuster vos paramètres.  Le fichier
<path>smb.conf</path> contient tous les paramètres qui feront que votre machine
Linux ressemblera à un serveur Windows NT pour toute autre machine Windows.
J'ai inclus ci-dessous un exemple très utile de ce fichier. Éditez-le si
nécessaire pour l'adapter à votre environnement réseau.
</p>

<pre caption="Exemple de fichier smb.conf">
[global]

workgroup = YOUR_WORKGROUP
server string = Gentoo Linux Server
encrypt passwords = True
security = user
smb passwd file = /etc/samba/private/smbpasswd
log file = /var/log/samba/log.%m
socket options = IPTOS_LOWDELAY TCP_NODELAY
domain master = Yes
local master = Yes
preferred master = Yes
os level = 65
dns proxy = No
name resolve order = lmhosts host bcast
bind interfaces only = True
interfaces = eth0
hosts deny = ALL
hosts allow = 192.168.1.4 127.0.0.1 # liste d'hôtes autorisés ici 
debug level = 1
create mask = 0644
directory mask = 0755
level2 oplocks = True
read raw = no
write cache size = 262144

[printers]
comment = All Printer
path = /var/spool/samba
browseable = no 
</pre>

<p>
Si vous utilisez CUPS, ouvrez le fichier <path>/etc/cups/mime.types</path> et
décommentez la ligne suivante&nbsp;:
</p>

<pre caption="Décommenter une ligne de /etc/cups/mime.types">
application/octet-stream
</pre>

<p>
Faites de même pour le fichier <path>/etc/cups/mime.convs</path>&nbsp;:
</p>

<pre caption="Décommenter une ligne de /etc/cups/mime.convs">
application/octet-stream application/vnd.cups-raw   0 -
</pre>

<p>
Maintenant que SAMBA est configuré, redémarrez samba, allez sur votre machine
Windows et installez-y une imprimante réseau. Simple comme bonjour, non&nbsp;?
</p>

</body>
</section>
</chapter>
</guide>
