<?xml version='1.0' encoding="UTF-8"?> 
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/printing-howto.xml,v 1.5 2003/11/13 17:28:13 neysx Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/fr/printing-howto.xml"> 
<title>Imprimer avec Gentoo</title> 
<author title="Auteur">
  <!--zhen@gentoo.org-->John P. Davis
</author>
<author title="Correcteur">
  <mail link="sunflare@gentoo.org">Phil Bordelon</mail>
</author> 
<author title="Correcteur">
  <mail link="wleggette@gate.net">Wesley Leggette</mail>
</author>
<author title="Correcteur">
  <mail link="carl@gentoo.org">Carl Anderson</mail>
</author>
<author title="Correcteur">
  <mail link="lanius@gentoo.org">Heinrich Wendel</mail>
</author>
<author title="Relecteur">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Traducteur">
  <mail link="xluthi@netcourrier.com">Xavier Lüthi</mail>
</author>
<author title="Traducteur">
  <mail link="mat@frheaven.com">Matthieu Montaudouin</mail>
</author>
<license/>

<abstract>
Un guide complet pour imprimer avec Gentoo Linux.
Ce document couvre l'impression locale et en réseau.
</abstract> 

<version>1.3</version> 
<date>13 novembre 2003</date> 

<chapter> 
<title>Installer CUPS et foomatic</title> 
<body> 

<p>
Configurer l'impression sous Gentoo Linux est relativement aisé grâce à
certains très bons programmes comme CUPS (the Common Unix Printing System) et
foomatic. Ces deux programmes sont actuellement dans l'arbre de Portage et sont
très simples à configurer par l'utilisateur final.
</p> 

<p>
Notez bien que CUPS ne dépend pas du gestionnaire de bureau, cela signifie que 
vous pouvez suivre ces instructions pour imprimer aussi bien sous GNOME que 
sous KDE. Il existe d'autres possibilités pour y arriver, telles que 
l'utilitaire KDE de configuration de l'impression, mais je trouve CUPS plus 
simple et plus évolutif.
</p>

<p>
Avant d'installer CUPS, c'est une bonne idée de mettre à jour la variable USE
dans le fichier <path>/etc/make.conf</path>.
</p>

<pre caption="Modification de /etc/make.conf">
<comment>Ajoutez <i>cups</i>, foomaticdb, ppds et <i>usb</i> (si vous utilisez une imprimante USB)</comment>
<comment>à votre variable USE actuelle.</comment>
USE="cups foomaticdb ppds usb autre_var1 autre_var2"
</pre>

<p>
Pour plus d'informations sur la variable USE, référez-vous au <uri 
link="http://www.gentoo.org/doc/fr/use-howto.xml">guide Gentoo pour les 
paramètres USE</uri>.
</p>

<pre caption="Installation des paquets nécessaires">
# <c>emerge cups</c>  
# <c>emerge foomatic </c>
</pre> 
</body>
</chapter>

<chapter>
<title>Mise en place des modules du noyau</title> 
<section>
<title>Généralités</title>
<body>
<p>
Maintenant que les paquets nécessaires ont été installés, il est temps
d'installer l'imprimante.
</p>

<p>
Selon le type de connexion utilisée par votre imprimante, il sera nécessaire
d'activer le port parallèle ou USB dans le noyau.
</p>

<note>
Cela est seulement nécessaire pour l'impression locale, si vous voulez imprimer
via Samba, passez cette section.
</note>

<note>
Si vous n'êtes pas sûr de la marche à suivre pour compiler le noyau, consultez
le <uri link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">HOWTO du noyau 
Linux</uri>. Apprenez comment compiler et installer de nouveaux modules sans 
devoir recompiler votre noyau et redémarrer votre ordinateur. Cela vous 
économisera bien du temps.
</note>
</body>
</section>


<section>
<title>Modules USB</title>
<body>
<p>
Pour activer le support des imprimantes USB, activez les options <c>Support for
USB</c> et <c>USB Printer support</c> dans le menu <c>USB support</c>. Les
activer toutes les deux comme modules installera usbcore.o et printer.o dans
votre répertoire de modules.  Je vous suggère l'utilisation de modules pour ne
pas devoir redémarrer votre ordinateur.
</p>

<p>
Une fois que le noyau est compilé et l'ordinateur redémarré (si nécessaire), il
est temps de charger les modules nécessaires&nbsp;:
</p>

<pre caption="Chargement des modules USB">
# <c>modprobe usbcore</c> 
# <c>modprobe printer</c> 
</pre> 

<p>
Une fois les modules correctement chargés, connectez l'imprimante et vérifiez
<path>/var/log/messages</path> pour voir si elle a été détectée.
</p> 

<note>
Si vous utilisez autre chose que sysklogd, le nom du fichier de log du noyau 
sera différent.
</note>

<pre caption="Vérification des messages du noyau">
# <c>tail -f /var/log/messages</c>
</pre> 

<p>
Vous devriez lire quelque chose comme ceci&nbsp;:
</p>

<pre caption="Fichier /var/log/messages">
hub.c: USB new device connect on bus2/2, assigned device number 2 
printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104
</pre>
</body>
</section> 

<section>
<title>Modules pour le port parallèle</title>
<body>
<p>
Pour activer le support du port parallèle, activez les options <c>Parallel port
support</c> et <c>PC-style hardware</c> dans le menu <c>Parallel port
support</c>. Selon votre imprimante, vous devrez aussi activer <c>Multi-IO
cards (parallel and serial)</c>, <c>Support for foreign hardware</c> et <c>IEEE
1284 transfer mode</c>.  Allez ensuite dans <c>Character devices</c> et activez
<c>Parallel Printer Support</c>.
</p>

<p>
Après avoir compilé le noyau, assurez-vous que l'imprimante est connectée et
redémarrez votre ordinateur.  Il est maintenant temps de charger les modules
nécessaires&nbsp;:
</p>

<pre caption="Chargement des modules du port parallèle">
# <c>modprobe parport</c> 
# <c>modprobe parport_pc</c>
</pre> 

<p>
Après que les modules se soient chargés correctement, branchez l'imprimante et 
vérifiez dans <path>/var/log/messages</path> pour voir si elle a été détectée.
</p> 

<note>
Si vous utilisez quelque chose d'autre que sysklogd, le nom du fichier de log 
du noyau sera différent.
</note>

<pre caption="Vérification des messages du noyau">
# <c>tail /var/log/messages</c>
</pre> 

<p>
Vous devriez voir quelque chose comme cela&nbsp;:
</p>

<pre caption="Fichier /var/log/messages">
lp0: using parport0 (polling).</pre>
</body>
</section>

<section>
<title>Tests de bas niveau</title>
<body>

<p>
Avant de configurer l'imprimante avec CUPS, nous pouvons la tester avec
quelques commandes simples de bas niveau.
</p> 

<pre caption="Test de l'imprimante en utilisant cat">
# <c>touch test.txt</c>
# <c>echo "Hello World" > test.txt</c>
# <c>cat test.txt > /dev/usb/lp0 </c>

<comment>Une alternative pour les imprimantes sur port parallèle :</comment>
# <c>cat test.txt > /dev/lp0 </c>
</pre>

<note>
Quelques imprimantes (par exemple plusieurs HP Laserjets) nécessitent un ^L
(Control-L) à la fin du fichier pour activer l'impression.  Sans le ^L, le cat
se fera correctement, mais l'imprimante absorbera les données puis s'arrêtera
et ne fera plus rien.
</note>
</body>
</section>
</chapter>			

<chapter>
<title>Pilotes pour imprimantes spéciales</title> 

<body> 
<p>
Avant d'utiliser foomatic pour générer un fichier PPD, il peut être nécessaire
de localiser les pilotes "officiels" pour votre imprimante.  Par exemple, Epson
propose <uri
link="http://www.epkowa.co.jp/english/linux_e/linux.html">plusieurs pilotes
d'imprimantes</uri> pour les systèmes d'exploitation Open Source.  Toutefois,
comme dans le cas d'Epson, la plupart de ces pilotes ne sont pas Open Source.
</p>

<p>
Les pilotes d'imprimantes suivants sont disponibles en tant qu'ebuilds dans
Portage&nbsp;: gimp-print, omni, hpijs, pnm2ppa.
</p>

<p>
Pour la plupart des imprimantes, excepté les HP à jet d'encre, vous pourrez
utiliser les pilotes d'imprimante Linux standard. Consultez <uri
link="http://www.linuxprinting.org/printer_list.cgi">la base de données des
imprimantes supportées de linuxprinting.org</uri> pour trouver des informations
sur votre imprimante. Lisez bien la documentation fournie avec le pilote que 
vous téléchargez en ce qui concerne l'installation et les informations de 
licence.
</p> 

<impo>
Si vous utilisez une imprimante HP à jet d'encre, il est nécessaire d'installer
le pilote d'impression <c>hpijs</c>.  Ce pilote interprète correctement le
Postscript pour que l'imprimante HP fonctionne. Le pilote <c>hpijs</c> est 
seulement fait pour les imprimantes à jet d'encre HP, mais il est disponible 
dans l'arbre de Portage. La documentation de HP pour le pilote <c>hpijs</c>
sera placée dans <path>/usr/share/doc/hpijs-&lt;version&gt;</path>.  L'auteur
vous recommande <i>fortement</i> de la lire.
</impo>

<pre caption="Installer hpijs">
# <c>emerge hpijs</c>
</pre> 

<note>
Si vous utilisez une HP Laserjet, elle est peut-être supportée via le système
d'impression de GNOME.  Si vous utilisez une imprimante autre qu'une HP à jet
d'encre, il n'est pas nécessaire d'installer ce pilote spécifique.
</note>
</body>
</chapter>

<chapter> 
<title>Configuration du fichier PPD</title> 

<body> 
<p>
Il est temps de configurer l'imprimante et CUPS. Afin que votre
imprimante interprète correctement le Postscript, CUPS a besoin d'un fichier
PPD (Printer Postscript Definition). La manière la plus simple de générer un
fichier PPD est d'utiliser foomatic.
</p> 

<note>
Une autre façon de procéder est de télécharger un fichier PPD de
<uri link="http://www.linuxprinting.org">LinuxPrinting.org</uri> et
de le copier dans le répertoire <path>/usr/share/cups/models</path>.
Si vous utilisez cette méthode, vous pouvez passer directement
à la section <uri link="#doc_chap5">Configuration de CUPS</uri>.
</note>

<p>
Trois informations sont requises pour réaliser la commande ci-dessous; le
modèle de l'imprimante, le périphérique sur lequel est connectée l'imprimante,
et le pilote d'imprimante (ce sera hpijs si vous avez eu besoin d'installer ce
pilote spécial).  Le pilote et l'ID de l'imprimante peuvent être trouvés (via
<c>grep</c>) dans la base de données de foomatic et le périphérique est
l'interface physique à laquelle est connectée l'imprimante (par exemple
<path>/dev/lp0</path>, <path>/dev/usb/lp0</path> ou, pour les imprimantes
samba, <path>smb://utilisateur:mot_de_passe@server/share</path>).
</p>

<p>
Avant d'utiliser <c>foomatic-configure</c>, n'oubliez pas de démarrer 
<i>cupsd</i>.
</p>

<pre caption="Démarrage de cupsd">
# <c>/etc/init.d/cupsd start</c>
</pre>

<pre caption="Utilisation générale de foomatic">
# <c>grep $printer_model /usr/share/foomatic/db/source/printer/* </c>
# <c>grep $print_device /usr/share/foomatic/db/source/driver/* </c>
# <c>foomatic-configure -s cups -p $printer_model_number -c $print_device_path -n queue name -d driver </c>
</pre>

<p>
Si vous ne trouvez pas votre imprimante avec la commande <c>grep</c>,
vous pouvez la rechercher sur <uri
link="http://www.linuxprinting.org">LinuxPrinting.org</uri>
et trouver ainsi quel(s) pilote(s) supporte(nt) votre imprimante.
Ensuite, choisissez le pilote que vous voulez utiliser et installez-le&nbsp;:
</p>

<pre caption="Installer un pilote PPDr">
# <i>foomatic-configure -s cups -p &lt;modèle d'imprimante&gt; -c &lt;périphérique&gt; -n &lt;queue&gt; -d &lt;pilote&gt;</i>
</pre>

<p>
Voici un exemple plus spécifique&nbsp;:
le code suivant suppose que vous ayez une Epson Stylus Color 980.
Bien sûr, vous devrez l'adapter à votre modèle d'imprimante.
</p>

<pre caption="Utilisation de foomatic pour une Stylus Color 980">
# <c>grep "Stylus Color 980" /usr/share/foomatic/db/source/printer/* </c>
<comment> Maintenant, cherchez la ligne contenant&nbsp;:</comment>
/usr/share/foomatic/db/source/printer/Epson-Stylus_Color_980.xml:   &lt;model>Stylus Color 980&lt;/model>
<comment> Epson-Stylus_Color_980 est l'ID de votre imprimante. </comment>

# <c>grep Epson-Stylus_Color_980 /usr/share/foomatic/db/source/driver/* </c>
/usr/share/foomatic/db/source/driver/gimp-print-ijs.xml:  &lt;printer>&lt;id>printer/Epson-Stylus_Color_980&lt;/id>&lt;/printer>
<comment> Ici, votre pilote d'imprimante est gimp-print-ijs.</comment>

# <c>foomatic-configure -s cups -p Epson-Stylus_Color_980 -c file:/dev/lp0 -n Epson -d gimp-print-ijs </c>
</pre>

<impo>
Si vous rencontrez des problèmes, vous pouvez consulter la <uri 
link="http://www.linuxprinting.org/foomatic/USAGE">documentation de 
foomatic</uri> ou vous rendre sur  <uri
link="http://www.linuxprinting.org">linuxprinting.org</uri> pour plus
d'informations.
</impo>

</body> 
</chapter> 

<chapter> 
<title>Configuration de CUPS</title>
<body> 

<p>
Maintenant que l'imprimante est configurée, il faut configurer CUPS pour qu'il
gère la file d'attente de l'imprimante.  CUPS peut être accédé via un
navigateur web sur le port 631 du serveur d'impression.
</p>

<impo>
Le démon CUPS possède un fichier de configuration par défaut qui peut, mais ne
doit pas nécessairement, être modifié. Vous pouvez y jeter un coup d'oeil, il
se nomme <path>/etc/cups/cupsd.conf</path>.
</impo>

<pre caption="Ajouter CUPS au runlevel par défaut et démarrer CUPS">
# <c>rc-update add cupsd default</c>
# <c>/etc/init.d/cupsd start</c>
</pre>

<p>
Le démon CUPS doit maintenant tourner, vous pouvez donc ouvrir votre navigateur
favori et le diriger <uri link="http://127.0.0.1:631">ici</uri>, cliquez ensuite
sur <c>Manage Printer</c>.  Vous pourrez y trouver votre
imprimante nouvellement installée, la configurer ou imprimer une page de test.
</p> 

<note>
Si votre imprimante ne fonctionne pas, jetez un oeil au journal
<i>error_log</i> de CUPS situé dans le répertoire spécifié dans la 
configuration.
</note>

</body> 
</chapter>

<chapter>
<title>Configurer des programmes pour imprimer avec CUPS</title>
<section>
<title>Géneralités</title>
<body>
<p>
La plupart des programmes récents ont une interface CUPS native, vous ne
devrez donc rien changer. Essayez juste d'imprimer avec votre programme.
</p>
</body>
</section>
<section>
<title>The GIMP</title>
<body>

<p>
Avant tout, il faut installer les extensions de The Gimp pour pouvoir 
imprimer&nbsp;:
</p>

<pre caption="Installation de gimp-print">
# <c>emerge gimp-print</c>
</pre>

<p>
À présent, lancez The Gimp, puis ouvrez une image existante ou juste une image
vide; cela n'a pas d'importance car tout ce qui nous intéresse, c'est le menu
<i>File</i>. Cliquez avec le bouton droit sur l'image et allez sur
<i>File/Print</i>. Lorsque la boîte de dialogue d'impression apparaît, cliquez
sur <e>new printer</e>. Si votre imprimante n'est pas dans la liste, tapez le
nom de votre imprimante, puis sélectionnez son type. Voilà, tout est prêt pour
imprimer à partir de The Gimp. Vous pouvez affiner les paramètres et vous
amuser un peu.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Utiliser Linux comme serveur d'impression compatible Windows</title>
<body>

<p>
Linux est un bon serveur d'impression, en fait c'est un bon serveur pour tout.
La première chose à faire est d'éditer le fichier
<path>/etc/samba/smb.conf</path> pour ajuster vos paramètres.  Le fichier
<i>smb.conf</i> contient tous les paramètres qui feront que votre machine
Linux ressemblera à un serveur Windows NT pour toute autre machine Windows.
J'ai inclus ci-dessous un exemple très utile de ce fichier. Éditez-le si
nécessaire pour l'adapter à votre environnement réseau.
</p>

<pre caption="Exemple de fichier smb.conf">
<c>[global]</c>

<c>workgroup = YOUR_WORKGROUP</c>
<c>server string = Gentoo Linux Server</c>
<c>encrypt passwords = True</c>
<c>security = user</c>
<c>smb passwd file = /etc/samba/private/smbpasswd</c>
<c>log file = /var/log/samba/log.%m</c>
<c>socket options = IPTOS_LOWDELAY TCP_NODELAY</c>
<c>domain master = Yes</c>
<c>local master = Yes</c>
<c>preferred master = Yes</c>
<c>os level = 65</c>
<c>dns proxy = No</c>
<c>name resolve order = lmhosts host bcast</c>
<c>bind interfaces only = True</c>
<c>interfaces = eth0</c>
<c>hosts deny = ALL</c>
<c>hosts allow = 192.168.1.4 127.0.0.1 # liste d'hôtes autorisés ici </c>
<c>debug level = 1</c>
<c>create mask = 0644</c>
<c>directory mask = 0755</c>
<c>level2 oplocks = True</c>
<c>read raw = no</c>
<c>write cache size = 262144</c>

<c>[printers]</c>
<c>comment = All Printer</c>
<c>path = /var/spool/samba</c>
<c>browseable = no </c>

</pre>

<p>
Maintenant que SAMBA est configuré, redémarrez samba, allez sur votre machine
Windows et installez y une imprimante réseau. Simple comme bonjour, non ?
</p>

</body>
</chapter>
</guide>
