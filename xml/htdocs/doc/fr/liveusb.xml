<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/liveusb.xml,v 1.1 2006/01/17 17:56:34 neysx Exp $ -->

<guide link="/doc/fr/liveusb.xml" lang="fr">
<title>Guide de création d'un LiveUSB Gentoo Linux</title>

<author title="Auteur">
  <mail link="brix@gentoo.org">Henrik Brix Andersen</mail>
</author>
<author title="Traducteur">
  <mail link="koppatroopa@yahoo.fr">Bertrand Coppa</mail>
</author>

<abstract>
Ce guide vous explique comment créer un LiveUSB Gentoo Linux ou, pour le
formuler autrement, comment remplacer un CD d'installation Gentoo Linux à
l'aide d'une clé USB.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.0</version>
<date>2006-01-04</date>

<chapter>
<title>Introduction</title>
<section>
<title>Le LiveUSB</title>
<body>

<p>
Ce guide vous explique comment créer un <e>LiveUSB Gentoo Linux</e> ou, pour le
formuler autrement, comment remplacer un CD d'installation Gentoo Linux à
l'aide d'une clé USB.  Ceci est particulièrement utile lorsqu'on veut installer
Gentoo Linux sur un ordinateur portable n'ayant pas lecteur CD.
</p>

<p>
Bien que les instructions de ce document aient pour objectif de simuler un CD
d'installation Gentoo Linux sur une clé USB, elles devraient aussi fonctionner
pour n'importe quel type de périphérique de données du moment que vous utilisez
les bons noms de périphérique.
</p>

</body>
</section>
<section>
<title>Prérequis</title>
<body>

<p>
Afin d'utiliser un LiveUSB Gentoo Linux, vous avez besoin de&nbsp;:
</p>

<ul>
  <li>Une clé USB amorçable d'au moins 64 Mo</li>
  <li>
    Un ordinateur x86 qui supporte le démarrage à partir d'un périphérique USB
  </li>
</ul>

<p>
Pour créer un LiveUSB, vous aurez aussi besoin de&nbsp;:
</p>

<ul>
  <li>
    Un ordinateur avec Gentoo Linux (ou n'importe quelle autre distribution Linux)
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Préparation de la clé USB</title>
<section>
<title>Partitionnement</title>
<body>

<warn>
Les commandes suivantes effaceront toutes les données de la clé USB.  Pensez à
faire une sauvegarde avant de commencer.
</warn>

<impo>
Ce guide suppose que le nom de périphérique <path>/dev/sda</path> correspond à
la clé USB. Si vous avez d'autre périphériques SCSI ou assimilés, faites
attention à utiliser le bon nom de périphérique.
</impo>

<p>
Créez une partition de type FAT32 sur votre clé USB et rendez-la amorçable à
l'aide de <c>fdisk</c>. Un exemple de partitionnement possible est affiché
ci-dessous&nbsp;:
</p>

<pre caption="Exemple de partitionnement">
# <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 1048 MB, 1048313856 bytes
33 heads, 61 sectors/track, 1017 cylinders
Units = cylinders of 2013 * 512 = 1030656 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1        1017     1023580    b  W95 FAT32
</pre>

</body>
</section>
<section>
<title>Création du système de fichiers</title>
<body>

<p>
Créez un système de fichiers FAT32 sur la clé USB à l'aide de
<c>mkdosfs</c>&nbsp;:
</p>

<pre caption="Utiliser mkdosfs">
<comment>(Assurez-vous que sys-fs/dosfstools est installé)</comment>
# <i>emerge -av sys-fs/dosfstools</i>
# <i>mkdosfs -F 32 /dev/sda1</i>
mkdosfs 2.11 (12 Mar 2005)
</pre>

</body>
</section>
<section>
<title>Installation d'un Master Boot Record</title>
<body>

<p>
Installez le Master Boot Record (MBR) précompilé de <c>syslinux</c> sur la clé
USB&nbsp;: (NdT, MBR&nbsp;: zone au début du «&nbsp;disque&nbsp;» qui contient
les informations nécessaires à l'amorçage.)
</p>

<pre caption="Installer un Master Boot Record">
<comment>(Assurez-vous que sys-boot/syslinux-3.00 (ou plus récent) est installé)</comment>
# <i>emerge -av '>=sys-boot/syslinux-3*'</i>
# <i>dd if=/usr/lib/syslinux/mbr.bin of=/dev/sda</i>
0+1 records in
0+1 records out
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Copie des fichiers</title>
<section>
<title>Montage du CD d'installation Gentoo Linux</title>
<body>

<p>
Téléchargez le fichier <path>install-x86-minimal-2005.1-r1.iso</path> depuis un
<uri link="/main/en/where.xml">miroir</uri> Gentoo Linux et montez l'image ISO
dans le répertoire <path>/mnt/cdrom/</path> de la manière suivante&nbsp;:
</p>

<pre caption="Monter l'image ISO du CD d'installation Gentoo Linux">
<comment>(Créez le point de montage /mnt/cdrom si nécessaire)</comment>
# <i>mkdir -p /mnt/cdrom</i>
# <i>mount -o loop,ro -t iso9660 install-x86-minimal-2005.1-r1.iso /mnt/cdrom/</i>
</pre>

</body>
</section>
<section>
<title>Montage du LiveUSB</title>
<body>

<p>
Montez la clé USB fraîchement formatée sur le répertoire <path>/mnt/usb/</path>
de la manière suivante&nbsp;:
</p>

<pre caption="Monter la clé USB">
<comment>(Créez le point de montage /mnt/usb si nécessaire)</comment>
# <i>mkdir -p /mnt/usb</i>
# <i>mount -t vfat /dev/sda1 /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Copie des fichiers</title>
<body>

<p>
Copiez les fichiers du CD d'installation Gentoo Linux sur le LiveUSB.  Les
fichiers ont besoin d'être quelque peu réorganisés, car nous utiliserons le
chargeur de démarrage <c>syslinux</c> à la place d'<c>isolinux</c>&nbsp;:
</p>

<pre caption="Copier les fichiers">
# <i>cp -r /mnt/cdrom/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux/* /mnt/usb/</i>
# <i>mv /mnt/usb/isolinux.cfg /mnt/usb/syslinux.cfg</i>
# <i>rm -rf /mnt/usb/isolinux*</i>

<comment>(Le noyau memtest86 doit être renommé afin de pouvoir être chargé via syslinux)</comment>
# <i>mv /mnt/usb/memtest86 /mnt/usb/memtest</i>
</pre>

<p>
Vous pouvez maintenant démonter l'image ISO&nbsp;:
</p>

<pre caption="Démonter l'image ISO">
# <i>umount /mnt/cdrom/</i>
</pre>

</body>
</section>
<section>
<title>Configuration du chargeur de démarrage</title>
<body>

<p>
Modifiez le fichier de configuration de syslinux à l'aide de <c>sed</c> comme
montré ci-dessous. Le paramètre <c>scandelay=10</c> introduira un délai de 10
secondes avant la tentative de montage du système de fichiers. Cela est
nécessaire pour que la clé USB soit totalement détectée.
</p>

<pre caption="Affiner les paramètres de démarrage">
# <i>sed -i \
    -e "s:cdroot:cdroot scandelay=10:" \
    -e "s:kernel memtest86:kernel memtest:" \
    /mnt/usb/syslinux.cfg</i>
</pre>

<note>
Vous pouvez ajouter l'option <c>docache</c> au paramètres de démarrage.  Cela
vous permettra d'exécuter la commande <c>umount /mnt/cdrom/</c> une fois le
chargement du système terminé afin de pouvoir retirer la clé USB pendant
l'installation.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Installation du chargeur de démarrage</title>
<section>
<title>Démontage de la clé</title>
<body>

<p>
Assurez-vous d'avoir démonté la clé USB avant d'installer le chargeur de
démarrage&nbsp;:
</p>

<pre caption="Démonter la clé USB">
# <i>umount /mnt/usb/</i>
</pre>

</body>
</section>
<section>
<title>Installation de syslinux</title>
<body>

<p>
Enfin, installez le chargeur de démarrage <c>syslinux</c> sur la clé USB&nbsp;:
</p>

<pre caption="Lancer syslinux">
# <i>syslinux /dev/sda1</i>
</pre>

<impo>
Vous devrez à nouveau exécuter <c>syslinux /dev/sda1</c> à chaque fois que vous
modifierez le fichier <path>syslinux.cfg</path> afin que les changements de la
configuration soient pris en compte.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Utilisation du LiveUSB</title>
<section>
<title>Démarrage</title>
<body>

<p>
Inserez la clé USB et démarrez l'ordinateur en vous assurant que le BIOS est
réglé pour démarrer sur un périphérique USB. Si tout se passe bien, une invite
de commande syslinux standard devrait s'afficher.
</p>

<p>
À partir de là, vous devriez pouvoir suivre la documentation d'installation
usuelle, disponible dans le <uri link="/doc/fr/handbook/">Manuel Gentoo</uri>.
</p>

</body>
</section>
</chapter>
</guide>
