<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/gentoo-freebsd.xml,v 1.2 2005/09/21 20:11:34 neysx Exp $ -->

<guide link="/doc/fr/gentoo-freebsd.xml" lang="fr">
<title>Petit guide de Gentoo/FreeBSD</title>

<author title="Auteur">
  <mail link="ignacio.arquelatour@gmail.com">Ignacio Arque-Latour</mail>
</author>
<author title="Auteur">
  <mail link="citizen428@gentoo.org">Michael Kohl</mail>
</author>
<author title="Auteur">
  Otavio R. Piske
</author>
<author title="Auteur">
  <mail link="ka0ttic@gentoo.org">Aaron Walker</mail>
</author>
<author title="Traducteur">
  <mail link="cam@gentoo.org">Camille Huot</mail>
</author>

<abstract>
Ce guide donne des informations générales à propos de FreeBSD et des
instructions concernant l'installation de Gentoo/FreeBSD. Des références sont
également incluses pour les personnes qui voudraient soutenir son développement.
</abstract>

<!-- Le contenu de ce document est sous licence CC-BY-SA. -->
<!-- Voir http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://createivecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.4</version>
<date>2005-09-21</date>

<chapter>
<title>Introduction à FreeBSD</title>
<section>
<title>Qu'est-ce que FreeBSD ?</title>
<body>

<p>
<uri link="http://www.freebsd.org/">FreeBSD</uri> est un système d'exploitation
libre (voir la <uri
link="http://www.freebsd.org/copyright/freebsd-license.html">licence</uri>) basé
sur UNIX. Lorsque le développement du système <uri
link="http://www.386bsd.org/">386BSD</uri> s'est arrêté, en 1993, deux projets
en sont nés&nbsp;: <uri link="http://www.netbsd.org/">NetBSD</uri>, très connu
pour sa faculté de pouvoir fonctionner sur un nombre impressionnant
d'architectures, et FreeBSD, dont le développement s'est concentré sur
l'architecture x86. FreeBSD est réputé pour sa stabilité, ses performances et sa
sécurité, ce qui en fait un système utilisé dans de petites comme de très
grandes entreprises de par le monde. La version de production actuelle de
FreeBSD est la 5.4, qui est la fondation du projet Gentoo/FreeBSD.
</p>

</body>
</section>
<section>
<title>Qu'est-ce que Gentoo/FreeBSD ?</title>
<body>

<p>
Gentoo/FreeBSD est le résultat d'une volonté de fournir un système
d'exploitation FreeBSD complètement fonctionnel qui bénéficierait des outils
Gentoo. Le but à long terme du projet Gentoo/BSD est de permettre à
l'utilisateur de choisir entre n'importe quelle combinaison de noyaux *BSD ou
Linux, de libc *BSD ou GNU et d'outils systèmes *BSD ou GNU.
</p>

</body>
</section>
<section>
<title>FreeBSD et Linux</title>
<body>

<p>
Les utilisateurs qui migrent de Linux à FreeBSD considèrent en général que les
deux systèmes d'exploitation sont «&nbsp;pratiquement les mêmes&nbsp;». En
réalité, FreeBSD possède un bon nombre de similitudes avec les distributions
Linux en général. Néanmoins, certaines différences essentielles sont à
souligner&nbsp;:
</p>

<ul>
  <li>
    À la différence de Linux, qui n'est en réalité qu'un noyau, FreeBSD est un
    système d'exploitation complet, constitué d'une bibliothèque C, d'outils
    systèmes et bien plus. Cette approche du développement rend le système dans
    son ensemble bien plus cohérent.
  </li>
  <li>
    Au contraire du noyau Linux, le développement de FreeBSD n'est pas dirigé
    par une seule personne, mais plutôt par un petit groupe appelé la <uri
    link="http://www.freebsd.org/doc/fr/articles/contributors/staff-core.html">Core
    Team</uri>.
  </li>
</ul>

<p>
Au delà de ça, FreeBSD possède également des différences techniques qui le
rendent vraiment à part de Linux. Il est très important d'en connaître
certaines, même si vous ne comptez pas rejoindre l'équipe de développement
Gentoo/FreeBSD&nbsp;:
</p>

<ul>
  <li>
    Pour utiliser des fonctions de liaison dynamique lors de l'exécution comme
    <c>dlopen()</c>, les programmes n'ont pas besoin d'être liés à libdl comme
    sous GNU/Linux. Il sont lié à libc à la place.
  </li>
  <li>
    FreeBSD n'a pas d'outil officiel pour la compilation du noyau. Vous devrez
    donc résoudre les problèmes de dépendances entre les fonctionnalités
    vous-même.
  </li>
  <li>
    FreeBSD utilise le système de fichiers UFS/UFS-2 et ne supporte par les
    systèmes de fichiers tels que ReiserFS ou XFS. Cependant, il existe des
    projets qui permettent de les supporter en lecture seule. L'accès aux
    partitions ext2/ext3 est d'ores et déjà possible, mais vous ne pourrez pas y
    installer votre système.
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Installer Gentoo/FreeBSD</title>
<section>
<title>Instructions d'installation</title>
<body>

<p>
Après cette courte introduction, il est enfin l'heure d'installer
Gentoo/FreeBSD. Malheureusement, nous n'avons pas actuellement de media
d'installation, vous devez donc choisir entre deux méthodes alternatives
d'installation. La première serait d'utiliser une installation existante de
FreeBSD pour partitionner votre disque et l'utiliser comme base afin d'y
installer Gentoo/FreeBSD. La seconde serait d'utiliser l'excellent <uri
link="http://www.freesbie.org/">LiveCD FreeSBIE</uri> comme un media
d'installation pour Gentoo/FreeBSD.
</p>

<p>
Avant de pouvoir commencer l'installation, vous devez configurer un disque dur
qui sera utilisé par Gentoo/FreeBSD. Vous pouvez utiliser <c>sysinstall</c>
(disponible dans l'installation de base de FreeBSD ainsi que dans un système
FreeSBIE) ou utiliser les commandes <c>fdisk</c>, <c>disklabel</c> et
<c>newfs</c> à la main. Si vous n'avez jamais mis en place de système FreeBSD
auparavant, nous vous conseillons d'utiliser <c>sysinstall</c>. Si vous éprouvez
des difficultés lors du partitionnement ou du formattage de votre disque dur,
jetez un œil à l'excellent <uri
link="http://www.freebsd.org/doc/fr/books/handbook/">Manuel FreeBSD</uri> ou
connectez-vous au canal IRC <c>#gentoo-bsd</c> du serveur Freenode.
</p>

<p>
Une fois que votre disque est prêt, vous devez créer les points de montage de
votre installation Gentoo/FreeBSD et monter les partitions concernées.
</p>

<pre caption="Créer un point de montage et monter une partition">
# <i>mkdir /mnt/gfbsd</i>
<comment>(Remplacez les X avec les bonnes valeurs correspondant à votre disque.)</comment>
# <i>mount /dev/adXsXa /mnt/gfbsd</i>
</pre>

<p>
Maintenant que la partition est montée, on peut récupérer et décompresser
l'archive stage3.
</p>

<pre caption="Obtenir et extraire l'archive stage3">
<comment>(N'importe quel miroir Gentoo qui contient le répertoire experimental/ fera l'affaire.)</comment>
# <i>wget http://gentoo.osuosl.org/experimental/x86/freebsd/stage3-x86-fbsd-20050811.tar.bz2</i>
# <i>cp stage3-x86-fbsd-20050811.tar.bz2 /mnt/gfbsd/</i>
# <i>cd /mnt/gfbsd/</i>
# <i>tar -jxvpf stage3-x86-fbsd-20050811.tar.bz2</i>
<comment>(Vous pouvez éventuellement effacer l'archive avec la commande suivante.)</comment>
# <i>rm stage3-x86-fbsd-20050811.tar.bz2</i>
<comment>(Créez le répertoire de l'utilisateur root.)</comment>
# <i>mkdir /mnt/gfbsd/root</i>
</pre>

<p>
Avant de nous chrooter à l'intérieur du stage que nous venons d'extraire, il
faut que vous récupériez la surcouche Gentoo/FreeBSD. Si vous n'êtes pas un
développeur Gentoo, vous pourrez l'obtenir depuis le miroir mis en place par
<mail link="carpaski@gentoo.org">Nick Jones</mail>. En théorie, vous pouvez
placer cette surcouche dans n'importe quel répertoire, mais pour simplifier les
choses nous allons considérer que vous l'avez téléchargée dans le répertoire
<path>/usr/local/portage/gentoo-freebsd</path>.
</p>

<pre caption="Récupérer la surcouche Gentoo/FreeBSD">
# <i>cvs -d:pserver:anonymous@zarquon.twobit.net:/var/cvsroot -q -z9 co -R gentoo-projects/bsd/fbsd/</i>
</pre>

<p>
Afin que votre nouveau système puisse fonctionner, vous devez monter
<path>/dev</path> à partir de celui du système actuel vers le point de montage
du Gentoo/FreeBSD avant de lancer le chroot.
</p>

<pre caption="Monter /dev et chrooter">
# <i>mount -t devfs none /mnt/gfbsd/dev/</i>
# <i>chroot /mnt/gfbsd/ /bin/bash</i>
</pre>

<p>
Une fois la surcouche Gentoo/FreeBSD à sa place, il est maintenant temps de lier
<path>/etc/make.profile</path> au bon profil et préparer
<path>/etc/make.conf</path> à fonctionner avec Gentoo/FreeBSD.
</p>

<pre caption="Mettre en place le profil et make.conf">
# <i>ln -sf /usr/local/portage/gentoo-freebsd/profiles/default-bsd/fbsd/5.4/x86/ /etc/make.profile</i>
<comment>(L'éditeur standard de FreeBSD est ee, que nous utilisons pour modifier /etc/make.conf.)</comment>
# <i>ee /etc/make.conf</i>
<comment>(Ajoutez au moins les lignes suivantes :)</comment>
CHOST="i686-gentoo-freebsd5.4"
ACCEPT_KEYWORDS="~x86-fbsd ~x86"
FEATURES="-sandbox collision-protect"
PORTDIR_OVERLAY="/usr/local/portage/gentoo-freebsd"
</pre>

<p>
Maintenant, il faut télécharger une copie de l'arbre principal de Portage. Cela
peut prendre un bon moment selon votre connexion.
</p>

<pre caption="Télécharger l'arbre de Portage">
# <i>emerge --sync</i>
</pre>

<p>
Après avoir synchronisé votre arbre de Portage, il ne reste plus que quelques
étapes avant que votre système Gentoo/FreeBSD soit prêt à l'utilisation.
</p>

<pre caption="Configuration finale">
<comment>(Empêcher crt1.o d'être supprimé par l'installation de gcc.)</comment>
# <i>chflags schg /usr/lib/crt1.o</i>
<comment>(Mettez à jour les binutils installés par l'archive stage3.)</comment>
# <i>emerge -u binutils</i>
<comment>(Choisissez le bon gcc.)</comment>
# <i>gcc-config 1</i>
# <i>source /etc/profile</i>
<comment>(Lancez le script suivant pour résoudre un bogue présent dans le stage3.)</comment>
# <i>/usr/local/portage/gentoo-freebsd/scripts/domove.sh</i>
<comment>(Réinstallez python, portage et py-freebsd.)</comment>
# <i>emerge --nodeps python portage py-freebsd</i>
</pre>

<note>
Gcc-config affichera un message à propos de GCC-SPECS que vous pouvez ignorer en
toute sécurité.
</note>

<p>
Félicitations. En finissant cette étape, vous venez d'obtenir un système
Gentoo/FreeBSD fonctionnel&nbsp;! Si vous le voulez, vous pouvez maintenant
reconstruire les paquets systèmes.
</p>

<pre caption="Reconstruire les paquets systèmes de FreeBSD">
# <i>emerge -e system</i>
</pre>

<impo>
Veuillez vous assurer parfaitement que votre nouveau système Gentoo/FreeBSD fait
partie de la configuration de votre chargeur de démarrage, car sinon vous ne
pourrez pas le démarrer&nbsp;! Si vous n'avez pas d'autre chargeur de démarrage
installé, vous devrez utiliser <c>boot0</c> car c'est le seul actuellement
supporté par FreeBSD.
</impo>

<pre caption="Installer et paramétrer boot0">
# <i>emerge boot0</i>
<comment>(Quittez l'environnement chroot.)</comment>
# <i>exit</i>
<comment>(À lancer à l'extérieur du chroot.)</comment>
# <i>fdisk -b -B /mnt/gfbsd/boot/boot0 /dev/adX</i>
# <i>chroot /mnt/gfbsd /bin/bash</i>
# <i>disklabel -B adXsY</i>
</pre>

<p>
Si vous avez besoin de plus d'informations pour mettre en place <c>boot0</c>,
veuillez consulter le <uri
link="http://www.freebsd.org/doc/fr/books/handbook/boot.html">chapitre 12</uri>
du Manuel FreeBSD.
</p>

<p>
Lorsque vous aviez fait <c>emerge system</c>, les sources du noyau de FreeBSD
ont été installées dans <path>/usr/src/sys</path>. Configurer et compiler un
noyau personnalisé est une chose très différente de compiler Linux. Si vous
n'êtes pas familier avec cette procédure, nous vous encourageons à jeter un œil
au <uri
link="http://www.freebsd.org/doc/fr/books/handbook/kernelconfig.html">chapitre
8</uri> du Manuel FreeBSD.
</p>

<p>
Veuillez noter qu'actuellement seule la manière «&nbsp;traditionnelle&nbsp;» de
compiler le noyau est supportée dans Gentoo/FreeBSD. Notez aussi qu'un <c>make
install</c> vous demandera certainement un fichier
<path>/boot/device.hints</path>. Vous trouverez une version par défaut de ce
fichier dans le sous-répertoire <path>conf</path> de la configuration
<c>GENERIC</c> sous le nom de <path>GENERIC.hints</path>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Développer Gentoo/FreeBSD</title>
<section>
<title>Comment nous aider</title>
<body>

<p>
Selon vos capacités et votre temps libre, vous pourrez nous aider sur de
nombreux points.
</p>

<ul>
  <li>
    Nous cherchons des experts de GCC et des binutils pour pouvoir porter les
    correctifs FreeBSD sur les versions originales de ces outils fournis par
    notre arbre Portage.
  </li>
  <li>
    Contribuer aux ebuilds&nbsp;: c'est-à-dire travailler de manière rapprochée
    avec les autres développeurs pour que nos modifications et nos correctifs
    soient acceptés dans l'arbre officiel.
  </li>
  <li>
    Sécurité&nbsp;: Si vous faites dans la sécurité, nous avons besoin de
    vous&nbsp;! Bien que les annonces de sécurité du projet FreeBSD soient
    suivies et résolues, nous pouvons toujours utiliser des ressources dans
    ce domaine.
  </li>
  <li>
    Contacts&nbsp;: Nous cherchons des personnes qui seraient en relation avec
    les développeurs FreeBSD pour maintenir des contacts entre le projet
    original et nous, pour échanger nos correctifs et pour discuter à propos de
    problèmes divers et de leurs solutions.
  </li>
  <li>
    Tester&nbsp;: Plus il y a de personnes qui utilisent Gentoo/FreeBSD, plus on
    pourra découvrir des bogues et les résoudre. Si vous êtes doué pour décrire
    les bogues ou les problèmes, nous voulons absolument vous entendre.
  </li>
  <li>
    Les autres domaines où nous cherchons de l'aide sont notamment&nbsp;: les
    ebuils systèmes, le baselayout, la création de CD-ROM d'installation, la
    documentation et la programmation du noyau.
  </li>
</ul>

</body>
</section>
<section>
<title>Construire le système et gérer les problèmes</title>
<body>

<p>
Bien que Linux et FreeBSD soient des systèmes d'exploitation à la UNIX, vous
devez connaître certaines différences majeures si vous comptez contribuer à
notre effort de développement.
</p>

<ul>
  <li>
    FreeBSD n'utilise pas les autotools GNU (autoconf, automake et autoheader).
    Il utilise plutôt sa propre implémentation de <c>make</c>, en plaçant les
    options de configuration dans des fichiers séparés, les fameux fichiers .mk,
    qui sont inclus par chaque Makefile. Bien qu'un travail énorme soit à
    l'origine de ces fichiers .mk, il n'est pas rare qu'une installation échoue
    à cause de l'oubli d'un <c>${INSTALL}&nbsp;-d</c> quelque part. La méthode à
    suivre pour gérer ce genre de problème est alors de lire le Makefile pour
    trouver le nom du fichier .mk associé, puis d'ouvrir ce fichier et d'essayer
    de comprendre ce qui a bien pu échouer (ce qui n'est pas très dur une fois
    que vous avez déterminé où est-ce qu'il s'est arrêté dans le processus
    d'installation).
  </li>
  <li>
    De plus, puisque FreeBSD est un système d'exploitation complet, vous ne
    trouverez pas l'archive du noyau de FreeBSD à télécharger sur un site web.
    Lorsque vous ferez un ebuild pour un programme qui a besoin des sources
    systèmes, vous aurez très probablement des problèmes pour accéder à des
    fichiers ou des répertoires qui n'existent pas. Cela arrive souvent lorsque
    le Makefile utilise le chemin <path>${.CURDIR}/../sys</path> ou quand il a
    une dépendance vers un autre paquet système. Il n'y a pas de règle par
    défaut pour gérer ce genre de problèmes, mais une de ces procédures suffit
    en général à le résoudre&nbsp;:
    <ul>
      <li>
        Si l'ebuild essaie d'accéder aux sources du noyau, corrigez-le pour
        qu'il pointe vers <path>/usr/src/sys</path>.
      </li>
      <li>
        S'il essaie d'accéder à d'autres sources fournies par le système, il est
        plus simple de les ajouter à <c>$SRC_URI</c> et de les décompresser dans
        <c>$WORKDIR</c>.
      </li>
    </ul>
  </li>
  <li>
    Afin de garder un système homogène, nous disposons de plusieurs archives
    groupées par fonctionnalités. Cela signifie que les bibliothèques systèmes
    se trouvent dans l'archive freebsd-lib, qui contient les sources que vous
    auriez trouvé dans /usr/src/lib. D'un autre côté, freebsd-usrsbin contient
    les outils que l'on trouve dans <path>/usr/sbin/*</path>, c'est-à-dire les
    sources situées dans <path>/usr/src/usr.sbin</path>.
  </li>
</ul>

</body>
</section>
<section>
<title>Problèmes connus</title>
<body>

<p>
À l'heure actuelle, de nombreux problèmes sont connus. Voici les
principaux&nbsp;:
</p>

<ul>
  <li>
    Certains scripts d'initialisation dépendent du service clock que nous ne
    fournissons pas à l'heure actuelle. Vous pouvez simplement le retirer des
    dépendances du script et le reporter sur notre <uri
    link="http://bugs.gentoo.org/">bugzilla</uri>. N'oubliez pas de choisir le
    produit «&nbsp;Gentoo BSD&nbsp;» pour soumettre le bogue.
  </li>
  <li>
    Certains ebuilds ont codé en dur l'option de liaison <c>-ldl</c> qui lie
    l'application avec libdl pour avoir <c>dlopen()</c>. Cela doit être
    corrigé. Vous trouverez plus de détails dans le <uri
    link="/proj/en/gentoo-alt/bsd/maintnotes.xml#doc_chap3">Gentoo/*BSD
    Technotes Guide</uri>.
  </li>
  <li>
    La glib et GNOME en général ont besoin d'un grand nombre de corrections
    avoir de pouvoir fonctionner.
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Contacts</title>
<section>
<body>

<p>
La liste des développeurs Gentoo/FreeBSD se trouve sur la <uri
link="/proj/en/gentoo-alt/bsd/fbsd/">page du projet</uri>. Vous pouvez
également les contacter sur le canal IRC <c>#gentoo-bsd</c> sur le réseau
Freenode ainsi que par mail sur la liste de diffusion <uri
link="/main/en/lists.xml">gentoo-bsd</uri>.
</p>

</body>
</section>
</chapter>
</guide>
