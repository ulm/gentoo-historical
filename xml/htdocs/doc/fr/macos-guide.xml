<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/fr/macos-guide.xml,v 1.4 2005/06/04 09:44:33 cam Exp $ -->

<guide link="/doc/fr/macos-guide.xml" lang="fr">

<title>Guide d'installation et d'utilisation de Gentoo pour Mac OS X</title>

<author title="Auteur, Éditeur">
  <mail link="alexander@gentoo.org">Alexander Plank</mail>
</author>
<author title="Auteur, Éditeur">
  <mail link="gongloo@gentoo.org">Hasan Khalil</mail>
</author>
<author title="Auteur">
  <mail link="pat2man@comcast.net">Patrick Tescher</mail>
</author>
<author title="Correcteur">
  <mail link="robin.perkins@internode.on.net">Robin Perkins</mail>
</author>
<author title="Auteur, Traducteur">
  <mail link="clement@varaldi.org">Clément Varaldi</mail>
</author>

<abstract>
Ce guide explique aux utilisateurs comment installer et utiliser Portage sous
Mac OS X.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>1.5</version>
<date>2005-06-01</date>

<chapter>
<title>Installation</title>
<section>
<title>Prérequis</title>
<body>

<p>
Afin de pouvoir installer Gentoo pour Mac OS X, les logiciels suivants doivent
être installés&nbsp;:
</p>

<ul>
  <li>Mac OS 10.2 ou ultérieur</li>
  <li>XCode Tools 1.2 ou ultérieur</li>
</ul>


<note>
La suite XCode Tools peut être télechargée gratuitement depuis le site Web des
membres de l'<uri link="https://connect.apple.com">Apple Developer
Connection</uri> (inscription gratuite nécessaire).
</note>

<impo>
Nous recommandons <e>fortement</e> d'installer XCode avec le SDK de X11.
</impo>

</body>
</section>
<section>
<title>L'installeur</title>
<body>

<p>
Vous devez tout d'abord télécharger l'<uri
link="http://www.metadistribution.org/macos">image disque de l'installeur de
Gentoo pour Mac OS X</uri>. Une fois que l'image dmg a été montée (en
double-cliquant dessus), son contenu sera affiché à l'écran dans une fenêtre du
«&nbsp;finder&nbsp;». Vous devriez alors voir l'icône de l'installeur. Vous
n'avez plus qu'à le lancer et à suivre les instructions qui vous sont données
à l'écran.
</p>

</body>
</section>
<section>
<title>Terminal.app</title>
<body>

<p>
Après que l'installeur ait fini et quitté, vous aurez besoin de lancer
Terminal.app (ou tout autre émulateur de terminal). Si Terminal.app est déjà en
cours d'exécution, vous devez ouvrir une nouvelle fenêtre pour que les
logiciels installés par l'installeur soient reconnus par cette session du
terminal.
</p>

<warn>
Utiliser un autre shell que bash n'est pas encore supporté et ne fonctionnera
peut-être pas. Vous devriez modifier le shell par défaut de Terminal.app en
cliquant sur Terminal-&gt;Preferences (dans la barre de menu), puis en
choisissant l'option «&nbsp;Exécuter la commande&nbsp;». Entrez alors
<c>/bin/bash</c> dans la boîte de saisie disponible.
</warn>

</body>
</section>
<section>
<title>Mettre Portage à jour</title>
<body>

<p>
Il est important de garder la base d'information des paquets de Portage (aussi
appellée «&nbsp;l'arbre de Portage&nbsp;») à jour. Elle se situe dans
<path>/usr/portage</path>. L'arbre de Portage contient des informations à
propos de tous les paquets que Portage sait installer ainsi que les directions
que Portage va suivre pour installer les paquets pour vous. Il est important
que vous mettiez à jour ces informations pour avoir la dernière version de l'arbre
disponible avant de continuer afin d'être sûr d'avoir toutes les dernières
informations disponibles pour les derniers paquets.
</p>

<p>
Une fois dans la console, vous devez obtenir les privilèges root
(administrateur) pour pouvoir continuer. Si vous êtes un administrateur de la
machine, l'usage de sudo est la méthode la plus simple.
</p>

<pre caption="Obtenir les droits root">
$ <i>sudo su</i>
Password:
</pre>

<p>
Pour être sûr que vous avez les derniers paquets et les dernières mises à jour,
vous devez synchroniser votre arbre de Portage avec le dernier en date à partir
des serveurs Gentoo.
</p>

<pre caption="Mettre à jour l'arbre de Portage">
# <i>emerge --sync</i>
</pre>

</body>
</section>
<section>
<title>Configuration</title>
<body>

<p>
Nous devons maintenant renseigner Portage sur votre version de OSX. Portage
utilise les fichiers dans <path>/etc/make.profile</path> pour déterminer quels
paquets sont déjà installés par Mac OS X, lesquels sont masqués pour votre
version de Mac OS X et les options de configuration par défaut.  Vous pouvez
utiliser l'un des profils proposés par défaut en créant un lien symbolique
depuis <path>/etc/make.profile</path> vers un profil pré-défini. Dans la
plupart des cas, il suffit de lancer le script «&nbsp;bootstrap&nbsp;»&nbsp;:
</p>

<pre caption="Lancer le script bootstrap ">
# <i>sh /usr/portage/scripts/bootstrap-macos.sh</i>
</pre>

<p>
Si vous deviez créer le lien symbolique vers votre profil manuellement,
utilisez une des commandes qui suivent en fonction de votre système&nbsp;:
</p>

<pre caption="Créer un lien pour votre profil pour Jaguar/Panther">
# <i>ln -s /usr/portage/profiles/default-darwin/macos/10.3 /etc/make.profile</i>
</pre>

<pre caption="Créer un lien pour votre profil pour Tiger">
# <i>ln -s /usr/portage/profiles/default-darwin/macos/10.4 /etc/make.profile</i>
</pre>

<note>
Les utilisateurs avertis peuvent également s'aventurer à modifier les options
de configuration dans <path>/etc/make.conf</path>. Ce n'est pas recommandé à
l'utilisateur moyen.
</note>

</body>
</section>
<section>
<title>Installer les paquets du système</title>
<body>

<p>
Ensuite, vous devez installer le système avec la commande emerge. Cela va
installer les autres paquets dont Portage a besoin pour fonctionner
correctement.
</p>

<pre caption="Installer le système">
# <i>emerge system</i>
</pre>

<p>
Bravo&nbsp;! Votre installation de Mac OS X est désormais finie et prête à
l'emploi.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installer des logiciels en utilisant Portage</title>

<section>
<title>Installer des logiciels</title>
<body>

<p>
Pour installer un paquet depuis Portage, une simple exécution de emerge suffit.
Portage s'occupera de l'ensemble des dépendances de votre paquet. Installer un
paquet est facile, une fois que vous connaissez son nom.
</p>

<pre caption="Installer Lynx">
# <i>emerge lynx</i>
</pre>

</body>
</section>
<section>
<title>Paquets masqués</title>
<body>

<p>
Vous devriez pouvoir installer toute combinaison de paquets qui a déjà été
testée et marquée avec le mot-clef ppc-macos. Actuellement, seul un faible
nombre de paquets ne sont pas masqués. Si un ebuild n'a pas encore eu le
mot-clef ppc-macos ajouté, vous aurez un message similaire à celui-ci.
</p>

<pre caption="Exemple d'un paquet masqué">
# <i>emerge -p cowsay</i>

 These are the packages that I would merge, in order:

 Calculating dependencies
 !! all ebuilds that could satisfy "cowsay" have been masked.
 !! possible candidates are:
 - games-misc/cowsay-3.03 (masked by: missing keyword)
</pre>

</body>
</section>
<section>
<title>Tester des paquets</title>
<body>

<p>
Vous pourriez vouloir tester un paquet vous-même pour voir s'il fonctionne
malgré son état masqué. Même si l'on ne suggère pas aux utilisateurs moyens de
le faire, les personnes que souhaitent aider les développeurs en testant des
paquets sont libres de démasquer et tester des paquets sur leur système. Cela
se fait en ajoutant le mot-clef «&nbsp;ppc-macos&nbsp;» au fichier d'information
d'un paquet, ou «&nbsp;ebuild&nbsp;». Pour ajouter le mot-clef ppc-macos à un
ebuild, il vous faudra utiliser la commande «&nbsp;ekeyword&nbsp;» qui fait
partie du paquet gentoolkit-dev.
</p>

<pre caption="Installer gentoolkit-dev">
# <i>emerge gentoolkit-dev</i>
</pre>

<pre caption="Ajouter un mot-clef à un paquet">
# <i>cd /usr/portage/games-misc/cowsay</i>
# <i>ekeyword ppc-macos cowsay-3.03.ebuild</i>
# <i>ebuild cowsay-3.03.ebuild digest</i>
</pre>

<p>
Si le paquet compile correctement et s'exécute bien, merci de soumettre un
bogue sur <uri link="http://bugs.gentoo.org">Bugzilla Gentoo</uri> (inscription
gratuite nécessaire) en nous signalant que le paquet fonctionne (vous pouvez
assigner le bogue au groupe de développeurs Gentoo pour Mac OS X
(osx@gentoo.org). Si le paquet ne fonctionne pas, soumettez un bogue pour nous
indiquer la ou les erreurs que vous avez constatées (en général, il y en a un
certain nombre, copiez et collez les lignes à partir du premier message
ressemblant à une erreur, jusqu'à la fin).
</p>

<p>
Pour la plupart des paquets qui nécessitent l'utilisation de X11, vous devrez
installer le paquet de développement de X11. Si vous n'optez pas pour son
installation lors de l'installation de XCode, vous pouvez l'installer aisément
après coup à partir du fichier <path>X11SDK.pkg</path> qui se trouve dans le
répertoire <path>Packages</path> du CD de XCode 1.2 (il suffit de
double-cliquer dessus pour l'installer). Evitez d'installer Portage à partir
des ebuilds. Il est en plein <uri link="#portage-dep">développement</uri>
pour tout ce qui concerne les paquets dépendant de Portage (par exemple
gentoolkit).
</p>

<warn>
Le mot-clé «&nbsp;macos&nbsp;» a été abandonné et ne doit plus être utilisé.
</warn>

</body>
</section>
<section>
<title>Paquets déjà installés</title>
<body>

<p>
Si vous trouvez un paquet qui a déjà été installé par Mac OS X, vous devriez
soumettre un bogue sur le <uri link="http://bugs.gentoo.org">Bugzilla
Gentoo</uri> (inscription gratuite requise). Sur votre propre système, vous
pouvez ajouter un paquet à <path>/etc/portage/package.provided</path> pour que
Portage sache que ce paquet est déjà installé.
</p>

<pre caption="Ajouter un paquet à package.provided">
# <i>mkdir -p /etc/portage/profile/</i>
# <i>echo nom-cat/paquet-x.y.z &gt;&gt; /etc/portage/package.provided</i>
</pre>

<note>
Pour voir la liste des paquets que les développeurs ont notés comme
pré-installés par Apple sur votre version de Mac OS X, vous pouvez lire le
fichier <path>/etc/make.profile/package.provided</path>.
</note>

<warn>
Modifier le fichier <path>/etc/make.profile/package.provided</path> n'est pas
recommandé, car il sera écrasé à chaque fois que vous mettrez l'arbre de
Portage à jour (en utilisant <c>emerge --sync</c>).
</warn>

</body>
</section>
</chapter>

<chapter>
<title>Utiliser le CVS</title>
<section>
<title>Problèmes avec la sensibilité à la casse</title>
<body>

<p>
Les scripts de CVS ont des problèmes avec les systèmes de fichiers tels que
HFS(+) qui ne sont pas sensibles à la casse des caractères. Il vous faudra donc
créer une image de système de fichiers sensible à la casse (nous recommandons
une taille minimum de 750&nbsp;Mo) dans lequel vous importerez l'arbre de
Portage du CVS. L'une des commandes suivantes peut être utilisée pour créer
une telle image de système de fichiers&nbsp;:
</p>

<pre caption="Créer une image UFS sensible à la casse">
<comment>(Remplacez « gentoo-cvs.dmg » par le nom que vous voulez,</comment>
<comment>et « Gentoo-CVS » par le nom de volume que vous souhaitez.)</comment>
$ <i>hdiutil create -size 750m gentoo-cvs.dmg -volname Gentoo-CVS -fs UFS</i>
</pre>

<pre caption="Créer une image HFS+ sensible à la casse">
<comment>(Remplacez « gentoo-cvs.dmg » par le nom que vous voulez,</comment>
<comment>et « Gentoo-CVS » par le nom de volume que vous souhaitez.)</comment>
$ <i>hdiutil create -size 750m gentoo-cvs.dmg -volname Gentoo-CVS -fs HFSX</i>
</pre>

<warn>
Pour les développeurs&nbsp;: repoman ne fonctionnera pas s'il y a des espaces
dans le chemin de la racine de l'arbre de Portage. Vous devez éviter d'utiliser
un nom de volume contenant des espaces pour votre image du CVS.
</warn>

</body>
</section>
</chapter>

<chapter>
<title>Désinstallation</title>

<section>
<title>Script de désinstallation</title>
<body>

<p>
Pour désinstaller Gentoo pour Mac OS X, vous pouvez utiliser le <uri
link="http://dev.gentoo.org/~alexander/files/uninstall.pl">script de
désinstallation</uri> qui vous permet de choisir si vous voulez ou non
désinstaller également les paquets qui ont été installés avec Gentoo pour Mac
OS X.
</p>

<pre caption="Désinstaller Gentoo pour Mac OS X">
# <i>sudo perl uninstall.pl</i>
</pre>

<note>
Pour désinstaller, vous devez utiliser le script avec les privilèges root.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Paquets disponibles</title>

<section>
<title>Vue d'ensemble</title>
<body>

<p>
Il y a plusieurs façons de voir la liste des paquets qui sont marqués avec le
mot-clef «&nbsp;ppc-macos&nbsp;» et qui sont donc signalés comme stables pour
Mac OS X. Comme il y a encore beaucoup de travail à faire pour marquer des
paquets comme stables pour Gentoo pour Mac OS X, nous encourageons les
utilisateurs à vérifier régulièrement l'état de la liste des paquets.
</p>

</body>
</section>
<section>
<title>Récents ebuilds de Gentoo pour Mac OS X</title>
<body>

<p>
Le site des <uri
link="http://packages.gentoo.org/archs/ppc-macos/stable/">ebuilds récents de
Gentoo pour Mac OS X</uri> fait partie du site officiel des <uri
link="http://packages.gentoo.org">ebuilds récents Gentoo</uri>. Il ne propose
pas seulement une liste d'informations sur les ebuilds actuels, mais permet
également de faire des recherches et propose quelques fonctionnalités
intéressantes comme des fils RSS (un fil dédié à un mot-clef, par exemple). Il
y a notamment un <uri
link="http://packages.gentoo.org/archs/ppc-macos/stable/gentoo_simple.rss">fil
RSS pour les derniers ebuilds marqués «&nbsp;ppc-macos&nbsp;»</uri> disponible
sur la <uri link="http://packages.gentoo.org/feeds">liste des fils pour les
ebuilds récents</uri>.
</p>

</body>
</section>
<section>
<title>Gentoo-Portage.com</title>
<body>

<p>
<uri link="http://www.gentoo-portage.com">Gentoo-Portage.com</uri> est une
source non-officielle d'informations concernant l'arbre de Portage, un peu à la
manière de <uri link="http://packages.gentoo.org">Fresh Gentoo Ebuilds</uri>,
mais qui propose plus de fonctionnalités relatives aux informations sur les
ebuilds, comme, par exemple, l'obtention des dépendances inverses des paquets.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Fontionnalités avancées et problèmes rencontrés</title>

<section>
<title>Protection contre la collision</title>
<body>

<p>
Gentoo pour Mac OS X propose une protection automatique contre les collisions
qui empêche Portage d'écraser un fichier déjà présent qu'il n'avait pas
installé lui-même. On peut enlever la protection grâce à
<c>FEATURES="-collision-protect"</c>.
</p>

<pre caption="Permettre à Portage d'écraser les fichiers de Mac OS X">
# <i>FEATURES="-collision-protect" emerge autoconf</i>
</pre>

<warn>
Enlever la protection contre les collisions est <e>très</e> dangereux et
pourrait mener à un système complètement brisé.
</warn>

</body>
</section>
<section>
<title>emerge: command not found</title>
<body>

<p>
L'installeur de Gentoo pour Mac OS X met à jour le fichier
<path>/etc/profile</path> en ajoutant <path>/usr/lib/portage/bin</path> à votre
variable d'environnement <c>PATH</c>. Pour lancer un simple <c>emerge ...</c>,
vous aurez probablement besoin de taper
«&nbsp;source <path>/etc/profile</path>&nbsp;» ou de fermer puis rouvrir votre
session afin de pas à avoir à taper le chemin d'accès complet
(<path>/usr/lib/portage/bin/&lt;nom_outil&gt;</path>) pour lancer un outil de
Portage.
</p>

</body>
</section>
<section>
<title>Erreurs avec &lt;library&gt;.a</title>
<body>

<p>
Quand on installe des fichiers de type <path>&lt;library&gt;.a</path>, ranlib
est lancé pour être sûr que la bibliothèque référence les bons répertoires.
Quand <c>make install</c> est exécuté par un ebuild, tout est installé dans
<path>/var/tmp/portage/&lt;package&gt;/image</path> au lieu du système de
fichiers réel («&nbsp;livefs&nbsp;»). Cela signifie que les bibliothèques
installées par le biais des ebuilds référencent des répertoires incorrects. Ce
problème existe seulement avec le noyau darwin avec ses fichiers
<path>&lt;library&gt;.a</path>. Il existe toutefois une échappatoire à ce
problème.
</p>

<p>
Comme le veut la politique de Gentoo pour Mac OS X, les bibliothèques
installées par les ebuilds doivent être vérifiées pour s'assurer de leur bon
fonctionnement avant de marquer l'ebuild avec le mot-clef
«&nbsp;ppc-macos&nbsp;». La plupart du temps, la raison pour laquelle une
bibliothèque ne fonctionne pas réside dans des références incorrectes à des
répertoires. Pour les aventuriers, une méthode permet de contourner cela. La
commande <c>ranlib</c> résout entre autres les problèmes de répertoires dans les
bibliothèques.
</p>

<pre caption="Utiliser ranlib pour corriger des bibliothèques brisées">
<comment>(Remplacez « /usr/lib/libjpeg.a » par la librairie cassée)</comment>
# <i>ranlib /usr/lib/libjpeg.a</i>
</pre>

</body>
</section>
<section id="portage-dep">
<title>La dépendance avec Portage</title>
<body>

<p>
Certains paquets dépendent de l'installation de Portage. Il y a actuellement un
problème avec Portage qui ne se reconnaît pas comme étant installé. Même si
l'équipe de Gentoo pour Mac OS X travaille actuellement à corriger ce problème,
il existe là encore une méthode de contournement. Il est possible d'installer
n'importe quel paquet sans installer ses dépendances. Cela peut être utile si
l'on ne veut pas se préoccuper de la dépendance envers Portage, mais cela ne
devrait pas être utilisé dans d'autres cas.
</p>

<pre caption="Laisser de côté les dépendances lors d'une installation">
# <i>emerge --nodeps gentoolkit</i>
</pre>

</body>
</section>
</chapter>
</guide>
