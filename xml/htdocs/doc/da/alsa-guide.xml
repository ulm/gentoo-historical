<?xml version="1.0" encoding="utf-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/da/alsa-guide.xml,v 1.17 2006/09/16 21:02:01 neysx Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link = "/doc/da/alsa-guide.xml" lang="da">
<title>Gentoo Linux ALSA Guide</title>
<author title="Forfatter">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Forfatter">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Forfatter">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Forfatter">
   <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Redaktør"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Redaktør">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Redaktør">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Redaktør">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Redaktør">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Oversætter">
  <mail link="aaby@gentoo.org">Arne Mejlholm</mail>
</author>
<author title="Korrektur">
  <mail link="broeman@gentoo.org">Jesper Brodersen</mail>
</author>
<author title="Korrektur">
  <mail link="thomas@sofagang.dk">Thomas Skyt</mail>
</author>

<abstract>
Denne vejledning viser hvordan du sætter Advanced Linux Sound
Architecture (ALSA) op på Gentoo Linux. I forbindelse med Gentoo Linux
Desktop Konfigurationsvejledningen er den ment til at give dig mere
information omkring dette emne.
</abstract>

<license/>

<version>1.5.12</version>
<date>2005-04-24</date>

<chapter>
<title>Den avancerede Linux lyd-arkitektur</title>
<section>
<title>Hvad er ALSA?</title>
<body>

<p>
ALSA betyder <e>Advanced Linux Sound Architecture</e>, et projekt dedikeret
til at udvikle et høj kvalitets Linux lyd-undersystem. Det har
udskiftet Open Sound System (OSS), som standard lyd-systemet i
2.6-kernen.
</p>

<p>
ALSA leverer understøtter alle typer af audio-grænseflader,
det er fuldt modulariseret, er SMP- og thread-sikkert og leverer et
højkvalitets brugerrumsbibliotek kaldet <e>alsa-lib</e> for at gøre
applikationsprogrammering enklere. Det leverer også bagudrettet kompatibilitet
til OSS.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installation af ALSA</title>
<section>
<title>USE-flag</title>
<body>

<p>
Gentoo leverer et <c>alsa</c> USE-flag, som du bør indsætte i
<path>/etc/make.conf</path> for at lade dine pakker blive
kompileret med ALSA-understøttelse. Hvis du også har <c>oss</c> i din
USE-variabel, vil ALSA blive kompileret med OSS bagudrettet
kompatibilitet.
</p>

</body>
</section>
<section>
<title>Kerne-moduler</title>
<body>

<p>
Før du fortsætter, skal du være sikker på at din kerne har
<e>Sound Card Support</e> aktiveret. Hvis du har brugt
<c>genkernel</c> for at kompilere din kerne, så er det automatisk valgt.
Hvis du har valgt den manuelle fremgangsmåde, skal du konfigurere din
kerne påny. Ydermere skal du være sikker på at slå
<e>Open Sound System</e> fra i din kerne. Hvis du
ikke gør dette, vil dit system måske prøve at bruge det systems drivere
fremfor alsa driverne. Hvis du får en besked om 'sound card not
detected' og du er sikker på at du har den korrekte driver, så er det
førnævnte nok grunden til det.
</p>

<warn>
Hvis du bruger en 2.6 kerne, så kan du bruge de drivere der bliver
leveret med kernen, men vi anbefaler stadig at du bruger
media-sound/alsa-driver da de er mere aktuelle end dem der er i
kernen. Hvis du stadig vil bruge kernens, kan du springe resten
af denne sektion over og fortsætte med
<uri link="#alsa-utils">Installation af ALSA Utils</uri>.
</warn>

<p>
Det første skridt mod at installere dine lyddrivere er at finde ud af
hvilket lydkort du har. Hvis du ikke allerede ved det, så er det nemt
at søge efter "audio" i outputtet af <c>lspci</c> kommandoen. Du kan
installere dette værktøj med <c>emerge pciutils</c>.
</p>

<pre caption="Søg efter lydkort-type">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
Gå nu til <uri link="http://www.alsa-project.org/alsa-doc">ALSA
lydkortslisten</uri> og søg efter dit lydkort. I det ovenstående
eksempel, bør du gå til "VIA" manufacturer. Du vil modtage en tabel
med de kendte chipsæt fra denne producent. Chipsættet i ovenstående
eksempel er "via82c686"; "Details" linket vil så fortælle dig at
driveren er kaldet <path>via82xx</path>. Dette er al den information
du har brug for, så du behøver ikke læse resten af dokumentet.
</p>

<p>
Baseret på denne information, kan du installere <c>alsa-driver</c>
til dit lydkort. Rediger først <path>/etc/make.conf</path> og
<e>tilføj</e> en ny valgmuliged kaldet ALSA_CARDS til den. Inde i
denne variabel, definerer du den lydkortsdriver, som du ønsker at
bruge:
</p>

<pre caption="Redigering af /etc/make.conf til ALSA_CARDS">
ALSA_CARDS="via82xx"
</pre>

<warn>
Hvis du har flere lydkort i dit system, så separer dem med et komma i
ALSA_CARDS variablen. Eks: ALSA_CARDS="via82xx,emu10k1"
</warn>

<p>
Hvis du vil have OSS kompabilitet (det kan anbefales), så skal du
tilføje "oss" til dine USE flag i
<path>/etc/make.conf</path>. Derefter er du klar til at installere
<c>alsa-driver</c>:
</p>

<pre caption="Installation af ALSA-drivere">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Hver gang du kompilerer dine kernekilder, er risikoen stor for at
ALSA-driverne bliver overskrevet. Det er derfor stærkt tilrådeligt at
køre <c>emerge alsa-driver</c> efter du har gjort det.
Bemærk at dette vil kompilere driverne til den kerne der er i
/usr/src/linux og ikke nødvendigvis den kørende kerne.
</impo>

</body>
</section>
<section id="alsa-utils">
<title>Installation af ALSA-værktøjer</title>
<body>

<p>
Hvis den OSS kompabilitet der er i kernen ikke er tilstrækkelig for
dine behov, så bør du nok installere <c>alsa-oss</c>. Dette vil
give dig "aoss" kommandoen som kan bruges som vist nedenfor:
</p>

<pre caption="More OSS kompabilitet lag">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
Installer nu ALSA-værtøjerne på dit system (dette er et krav):
</p>

<pre caption="Installation af ALSA-værktøjer">
# <i>emerge alsa-utils</i>
</pre>

<p>
Nu da værktøjerne er installeret, er det tid til at indstille ALSA.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Opsætning af ALSA</title>
<section>
<title>Automatisk hentning af kerne-moduler</title>
<body>

<p>
Hvis du bruger en modulær kerne (som når du bruger <c>genkernel</c>)
skal du redigere <path>/etc/modules.d/alsa</path>, så den aktiverer de
nødvendige moduler ved opstart. For lydkortet i vores eksempel:
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># Det følgende er kun nødvendigt, hvis du vil have OSS kompatibilitet</comment>
alias sound-slot-0 snd-via82xx
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Kør nu <c>modules-update</c> for at gemme ændringer du har lavet til
<path>alsa</path> filen i <path>/etc/modules.conf</path>:
</p>

<pre caption="At køre modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>Kontrol af enhedsfiler</title>
<body>

<p>
Dette burde være gjort automatisk for dig med en nyere installation, men
hvis du løber ind i problemer, så tjek at dine ALSA enheder og
rettigheder er korrekt opsat af din /dev manager. Hvis du bruger
DevFS, så tjek <path>/etc/devfsd.conf</path>
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>At aktivere ALSA ved opstart</title>
<body>

<p>
Tilføj <c>alsasound</c> opstartsscriptet til "boot" runlevel
for at aktivere ALSA-understøttelse ved opstart:
</p>

<pre caption="Tilføj ALSA til boot runlevel">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>Lydstyrke på kanalerne</title>
<body>

<p>
Som standard er alle kanaler stumme (muted). For at ordne dette, kør <c>amixer</c>:
</p>

<pre caption = "At køre amixer">
# <i>amixer</i>
</pre>

<p>
Unmute nu <e>Master</e> og <e>PCM</e> kanalerne. Hvis dette ikke er
nok, unmute også <e>Center</e> og <e>Surround</e> kanalerne. Du skal
ikke unmute de kanaler du ikke kan ændre lydstyrken på; dette kan
nemlig resultere i at ALSA overhovedet ikke producerer nogen lyd.
</p>

<pre caption = "Unmute af lydkanaler">
<comment>(Hvis du foretrækker et ncurses interface:)</comment>
# <i>alsamixer</i>
<comment>(eller)</comment>
# <i>amixer set Master 100% unmute</i>
# <i>amixer set PCM 100% unmute</i>
<comment>(Kun hvis det ovenstående ikke er nok:)</comment>
# <i>amixer set Center 100% unmute</i>
# <i>amixer set Surround 100% unmute</i>
# <i>amixer set Headphone 100% unmute</i>
</pre>

<p>
For at tjekke om lyden virker, afspil en lydfil (ved brug af
<c>aplay</c>), en mp3 (ved brug af <c>mpg123</c> eller endda
<c>mplayer</c>) eller en anden slags lydfil, som du ønsker.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Aktivering af MIDI-understøttelse</title>
<section>
<title>Installation af nødvendige pakker</title>
<body>

<p>
Nogle lydkort kommer med MIDI-synthesizers indbygget. For at bruge
dem, skal du først installere <c>awesfx</c> pakken:
</p>

<pre caption="At installere awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
Hvis du har en samling af lydfonte et sted, placer dem i
<path>/usr/share/sfbank/</path>. F.eks. har SBLive en lydfont fil
kaldet <path>8MBGMSFX.SF2</path> eller <path>CT4GMSFX.SF2</path>.
</p>

<p>
Efter at have kopieret den lydfont over, kan du vælge den ved hjælp af
af <c>/usr/bin/asfxload</c>.
</p>

<pre caption="Start af lydfonten">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Denne kommando skal køres ved hver opstart, så det er tilrådeligt også at
tilføje den til <path>/etc/conf.d/local.start</path>.
</p>

<p>
Hvis du ikke kan finde nogen soundfont på din driver-CD, så kan du
hente nogle online på
<uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>
</p>

</body>
</section>
<section>
<title>Timidity++ virtuelle synthesizer</title>
<body>

<p>
Hvis dit lydkort ikke kommer med en hardware synthesizer (eller du ikke
vil bruge den), så kan du bruge <c>timidity++</c> for at give dig en
virtuel synthesizer. Start med at emerge denne pakke:
</p>

<pre caption="At installere Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
For at få timidity til at afspille lyde, har den brug for en
soundfont. Installer <c>timidity-eawpatches</c> eller
<c>timidity-shompatches</c>, som vil give dig nogle
soundfonts, hvis du ikke har nogle.
Du kan have flere soundfont opsætninger installeret og du
kan placere dine egne i <path>/usr/share/timidity/</path>. For at
skifte imellem de forskellige timidity opsætninger, bør du bruge
<e>timidity-update</e> værktøjet der kommer med timidity++ pakken.
</p>

<pre caption="Installation af soundfonts">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>
<comment>(eller)</comment>
# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Glem ikke at tilføje <c>timidity</c> til "default" runlevel.
</p>

<pre caption="Tilføjelse af timidity til default runlevel">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>Test af MIDI-understøttelse</title>
<body>

<p>
Du kan bruge <c>aplaymidi</c> fra ALSA Utils til at teste din MIDI
opsætning:
</p>

<p>
For at se hvilke MIDI-outputporte er tilgængelige på dit system, brug
<c>-l</c>-valgmuligheden:
</p>

<pre caption="Se MIDI-outputporte">
# <i>aplaymidi -l</i>
</pre>

<p>
Hvis det ser fint ud, så prøv at afspille en MIDI fil for at være
sikker på at alting virker. Med <c>-p</c>-valgmuligheden kan du
definere hvilken MIDI-port du ønsker at bruge.
</p>

<pre caption="Afspilning af MIDI">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith's Theme.mid"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Endelige noter</title>
<section>
<title>Værktøjer og Firmware</title>
<body>

<p>
Nogle enkelte lydkort kan drage nytte af nogle værktøjer leveret
med <c>alsa-tools</c> og <c>alsa-firmware</c>-pakkerne. Hvis du har
brug for <c>alsa-tools</c>, vær husk at definere
ALSA_TOOLS-variabelen i <path>/etc/make.conf</path> med de værktøjer
som du har du brug for. F.eks:
</p>

<pre caption="Valg af ALSA-værktøjer i /etc/make.conf">
ALSA_UTILS="as10k1 ac3dec"
</pre>

<p>
Installer derefter <c>alsa-tools</c> (og evt. <c>alsa-firmware</c>) pakken:
</p>

<pre caption="Installation af ALSA-værktøjer">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Aktiverin af joystick-understøttelse</title>
<body>

<p>
Hvis dit lydkort har et joystick-stik, vil du måske være interesseret i
at aktivere joystick-understøttelse i dit lydkort. Hvis dette er
tilfældet, så start med at kontrollere om dit lydkorts driver har en
joystick-parameter. Du kan undersøge det ved at køre <c>modinfo</c>
mod din kerne-modul. F.eks. <c>snd-via82xx</c>:
</p>

<pre caption="At køre modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Hvis det har parameteren <c>joystick</c> så skal du tilføje <c>joystick=1</c>
til din <c>options</c> linie i <path>/etc/modules.d/alsa</path>. F.eks.:
</p>

<pre caption="Tilføjelse af parameteren joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>Ressourcer</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">ALSA-projektet</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto og FAQ'er</uri></li>
  <li><uri link="http://linux-sound.org/">Lyd og MIDI software til Linux</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
