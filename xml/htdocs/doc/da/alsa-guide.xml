<?xml version='1.0' encoding="iso-8859-1"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/da/alsa-guide.xml,v 1.2 2003/12/31 12:11:44 aaby Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link = "/doc/da/alsa-guide.xml">
<title>Gentoo Linux ALSA Guide</title>
<author title="Forfatter">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Forfatter">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Forfatter">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Redaktør"><!-- zhen@gentoo.org -->
	John P. Davis
</author>
<author title="Redaktør">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Redaktør">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Redaktør">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Oversætter">
  <mail link="aaby@gentoo.org">Arne Mejlholm</mail>
</author>
<author title="Korrektur">
  <mail link="broeman@gentoo.org">Jesper Brodersen</mail>
</author>

<license/>

<abstract>
Denne vejledning viser hvordan du sætter Advanced Linux Sound
Architecture (ALSA) op på Gentoo Linux. I forbindelse med Gentoo Linux
Desktop Konfigurationsvejledningen er den ment til at give dig mere
information omkring dette emne.  </abstract>

<version>1.3.5</version>
<date>31. December 2003</date>

<chapter>
<title>Introduktion</title>
<section>
<title>Hvad er ALSA?</title>
<body>

<p>
Advanced Linux Sound Architecture (ALSA) er et projekt til at forbedre
Linux lyd undersystemet ved at genskrive store dele af det. Det
forventes at ALSA kommer med i Linux kerne 2.6.x (eller 3.x.x -- hvad
der nu for én der kommer først) når det bliver klart.
</p>

<p>
ALSA giver lyd og MIDI funktionalitet til Linux.
</p>
 
<p>
Citeret fra <uri>http://www.alsa-project.org</uri>, har ALSA de
 følgende egenskaber:
</p>

<ul>
  <li>
  Effektiv understøttelse for alle typer af lyd grænseflader, ligefra
    forbruger lydkort til professionelle flerkanals lyd grænseflader
  </li>
  <li>Fuldt modulære lyd drivere</li>
  <li>SMP og tråd-sikkert design</li>
  <li>
  Plads til brugerbibliotek (alsa-lib) hvor man kan simplificere
    programmering af applikationer og derved give højere grad af funktionalitet
  </li>
  <li>
  Understøttelse for ældre OSS API, ved at give binær kompabilitet
    til de fleste OSS programmer
  </li> 
</ul>

<p>
Der er mange andre aspekter ved ALSA, såsom understøttelse for Full
Duplex afspilning og optagning, understøttelse for adskillige lydkort,
hardware mixning af stream, udvidbare mixer muligheder (for at
understøtte avancerede egenskaber på nye lydkort), ...
</p>

</body>
</section>
<section>
<title>Hvorfor bruge ALSA?</title>
<body>

<p>
Hvis dit lydkort understøttes af Linux-kernens lydsystem eller det
kommercielle OSS/4Front lyd-driver-system, hvilke kan findes i alle
2.4.x Linux kerner, så kan du lige så godt bygge <e>disse moduler</e>
for at udnytte dit lydkort. Hvis dette er hvad du ønsker, så skal du
bare læse <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/index.html">Linux Sound
HOWTO</uri>.
</p> 

<p>
Disse OSS/4Front drivere har imidlertid nogle begrænsninger -- at være
kommercielle er én.  ALSA er et forsøg på at gå ud over disse
begrænsninger og at gøre dette på en open-source måde. ALSA er et fuld
GPL og LGPLet lyd-driver-system, der giver et professionelt kvalitets
system til at optage, afspille og MIDI sequencing.
</p> 

</body>
</section>
<section>
<title>Hvilke kort understøtter ALSA?</title>
<body>

<p>
ALSA forsøger at understøtte så mange (nye) kort som muligt, ved at
stille open-source drivere til rådighed. Nogle leverandører leverer
dog kun pakker med binære filer.
</p>

<p>
For at finde ud af om dit kort er understøttet, kan du finde et
lydkorts matrice over hvilke kort der er understøttet og ikke
understøttet her: <uri>http://www.alsa-project.org/alsa-doc/</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Installation</title>
<section>
<title>Gentoo USE-flag</title>
<body>

<p>
For at kompilere programmer med ALSA-understøttelse skal du være
sikker på at tilføje <e>alsa</e> til dine USE-variabel. Mange værtøjer
understøtter imidlertid ikke ALSA endnu og kræver OSS. ALSA stiller
emulation af OSS til rådighed, hvis du definerer <e>oss</e> i din
USE-variabel før du starter.
</p>

</body>
</section>
<section>
<title>Kerne-moduler</title>
<body>

<p>
Da vi stadig bruger 2.4.x kerne-kildekode er vi nødt til at kompilere
kerne-moduler og ALSA-moduler separat. Folk der bruger en 2.5.x kerne
kan gøre dette inde fra deres kernes konfiguration, da ALSA-modulerne
er inkluderet i kerne kildekoden og skal bygges der.
</p>

<p>
Først skal vi være sikker på at vores kernes konfiguration er klar til
brug med ALSA. Alt hvad du har brug for i din kerne konfiguration er
at have Sound Card Support sat til at blive bygget som et modul
(M). Dette bygger <path>soundcore.o</path>.
</p>

<note>
Dette vil muligvis også virke, hvis du bygger Sound Card Support ind i
kernen (Y) i stedet for at bygge det som et modul (M). Men den
officielle ALSA-dokumentation anbefaler at bygge de som et modul, da
ALSA vil forsøge at hente den.
</note>

<p>
Hvis du allerede har en virkende kerne konfiguration, skal du være
sikker på at fjerne alle lyd drivere (bortset fra Sound Card
Support). Hvis du ønsker at gøre dette uden at genstarte, kan du gøre dette:
</p>

<pre caption="Kerne konfiguration">
# <i>cd /usr/src/linux</i>
# <i>cp .config ~/</i>
# <i>make mrproper</i>
# <i>cp ~/.config .</i>
# <i>make menuconfig</i>
</pre>

<p>
Vælg nu <e>Sound Card Support</e> som Modul (M) og fravælg alle andre
lyd-drivere. Exit og sig Y til at gemme din
kernekonfiguration. Derefter skal du bygge modulerne:
</p>

<pre caption="Kerne kompilation">
# <i>make dep clean</i>
# <i>make modules modules_install</i>
</pre>

<p>
Før du installerer dine nye moduler, vil den sidste linie slette alle
dine gamle moduler, også dem fra en tidligere installation af ALSA.
</p>

<impo>
Dette betyder, at hver gang du skal kompilere din kerne igen, senere
hen, så skal du genkompilere <c>alsa-driver</c>.  
</impo>

</body>
</section>
<section>
<title>ALSA moduler</title>
<body>

<p>
Nu er det tid til at installere ALSA-driverne til dit/dine
lydkort. Hvis du har et PCI lydkort, så kan du finde navnet og typen
ved at kigge på outputtet af <path>/proc/pci</path>.
</p>

<pre caption="At lede efter information om lydkort">
# <i>grep audio /proc/pci</i>
</pre>

<warn>
Hvis du havde en tidligere opsætning af lyd og der stadig er ikke-ALSA
lyd-moduler hentet, så skal du lukke dem <e>nu</e>. Tjek med
<c>lsmod</c> og brug <c>rmmod</c> for at lukke alle lyd-relaterede
moduler på dit system.
</warn>

<p>
Vi kunne nu lave en simpel <c>emerge alsa-driver</c>, men dette vil
installere <e>alle</e> ALSA lyd-drivere.
</p>

<p>
For at spare os noget tid skal du finde <e>Module Name</e> for
dit/dine lydkort på <uri
link="http://www.alsa-project.org/alsa-doc">ALSA Soundcard
Matrix</uri> ved at følge <e>Details</e> linket i <e>Driver and
Docs</e> kolonnen, i den række hvor din lydkorts chipsæt er placeret. Mit er
<c>snd-emu10k1</c>, da jeg har et SBlive! lydkort med <e>EMU10K1</e>
chipsættet. Vi sætter ALSA_CARDS miljøvariablens værdi til modulnavnet
før vi emerger (dog uden snd foran), så emerge kun vil kompilere de
drivere, vi har brug for.
</p>

<pre caption="At kompilere det korrekte modul">
# <i>env ALSA_CARDS='emu10k1' emerge alsa-driver</i> 
</pre>

<note>
Du kan også tilføje denne værdi i <path>/etc/make.conf</path>, sådan
at når du skal til at emerge alsa-driver igen senere, kan du bare køre
<c>emerge alsa-driver</c>.  F.eks., sådan her: <c>echo
'ALSA_CARDS="emu10k1"' >> /etc/make.conf</c> </note>

<note>
Når du vil installere ALSA-drivere til mere end et lydkort, kan du
sætte ALSA_CARDS til en liste af drivere, adskilt af mellemrum; sådan
her: <c>env ALSA_CARDS='emu10k1 intel8x0 ens1370' emerge
alsa-driver</c> </note>

<note>
Hvis du vil have OSS kompabilitet, skal du være sikker på at emerge
<i>alsa-oss</i>, det er ALSA/OSS kompabilitets wrapperen.
</note>

<note>
Hvis du har planer om at rekompilere dine kerne en masse gange, så er
det måske et godt råd at emerge <c>alsa-driver</c> med
<c>--buildpkg</c>. Dette vil lave en binær pakke. Senere,
efter at have kompileret din kerne igen, så kan du bare <c>emerge
--usepkg alsa-driver</c>, hvilket vil installere den binære pakke i
stedet for at kompilere det fuldstændigt igen.
</note>

<p>
Herefter burde ALSA-modulerne være installeret på dit system.
</p>

</body>
</section>
<section>
<title>Opsætning af ALSA</title>
<body>

<p>
Lad os nu begynde med opsætningen, for at få ALSA til at virke
ordentligt. Vi har brug for at redigere nogle filer, for at lade vores
system kende til de nyligt installerede ALSA-moduler.
</p>

<p>
Først skal du installere <c>alsa-utils</c> på dit system:
</p>

<pre caption = "At emerge alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<p>
Herefter skal vi redigere <path>/etc/modules.d/alsa</path>.
</p>

<warn>
Der er ikke brug for at redigere
<path>/etc/modules.conf</path>. Rediger i stedet for filer i
<path>/etc/modules.d</path>.  
</warn>

<p>
Tjek ALSA delen <e>i bunden af filen</e>. Ved at tilpasse denne linie
kan du specificere det maksimale antal af lydkort du har (generelt
bare et).
</p>

<pre caption="I bunden af /etc/modules.d/alsa">
<comment>Sæt dette til det korrekte antal af kort.</comment>
options snd cards_limit=1
</pre>

<p>
Lad os nu specificere de(n) lyddriver(e) ALSA skal bruge. I den samme
fil skal du redigere sådan:
</p>

<pre caption="I /etc/modules.d/alsa">
## and then run `modules-update' command.
## Read alsa-driver's INSTALL file in /usr/share/doc for more info.
##
##  ALSA portion
alias snd-card-0 snd-emu10k1
<comment>## Tilføj, hvis du har mere end et:</comment>
## alias snd-card-1 snd-intel8x0
## alias snd-card-2 snd-ens1370
##  OSS/Free portion
## alias sound-slot-0 snd-card-0
## alias sound-slot-1 snd-card-1
##
</pre>

<note>
Hvis du har mere end et lydkort, justér da <c>cards_limit</c>-værdien
og tilføj flere snd-card alias'ser til filen. Jeg har ikke erfaringer
med dette, men du kan finde eksempler på opsætninger med to eller
flere lydkort i <uri
link="http://www.alsa-project.org/alsa-doc/alsa-howto/c1660.htm">Kapitel
6</uri> af <uri
link="http://www.alsa-project.org/alsa-doc/alsa-howto/alsa-howto.html">ALSA
Howto</uri>.  
</note>

<p>
Den sidste ting som du skal gøre i denne fil, næsten nede i bunden, er at
tjekke at disse linier er tilstede og ikke udkommenterede:
</p>

<pre caption="I bunden af /etc/modules.d/alsa">
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Dobbelttjek nu filen <path>/etc/modules.d/alsa</path> og, når du er
sikker på at alt er som det skal være, kør <c>modules-update</c>.
</p>

<pre caption="At køre modules-update">
# <i>modules-update</i>
</pre>

<note>
At køre <c>modules-update</c> her, vil indsætte data fra
<path>/etc/modules.d/alsa</path> ind i <path>/etc/modules.conf</path>
</note>

<p>
Du skal også sikre dig at <path>/etc/devfsd.conf</path> har ALSA-enhederne
og rettigheder korrekt registreret.
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

<note>
Bemærk at devfsd.conf sætter <path>/dev/sound</path> rettighederne til
at være root.audio. Derfor skal ikke-root brugere være en del af audio
gruppen for at kunne bruge lyd.
</note>

</body>
</section>
</chapter>

<chapter>
<title>At starte ALSA</title>
<section>
<title>Tilføj alsasound til en runlevel</title>
<body>

<p>
Den første ting der skal gøres nu, er at få ALSA til at starte ved
opstart. Sådan her:
</p>

<pre caption="Tilføj ALSA til boot runlevel'en">
# <i>rc-update add alsasound boot</i>
</pre>

<warn>
Bemærk at alsasound-scriptet bør tilføjes til "boot"-runlevel'en, ikke
"default"-runlevel'en.
</warn>

</body>
</section>
<section>
<title>At køre og unmute</title>
<body>

<p>
Da vi er Linux-brugere, ønsker vi ikke at genstarte, så vi starter
alsasound-scriptet manuelt.
</p>

<pre caption="At starte ALSA">
# <i>/etc/init.d/alsasound start</i>
</pre>

<p>
ALSA kører nu. Hvis alt er ok, så burde du kunne se ALSA-modulerne
startet, når du kører <c>lsmod</c>. Lyden vil dog stadig ikke virke, fordi
kanalerne stadig er muted. Vi har brug for <c>amixer</c> til at ordne dette.
</p>

<pre caption = "At køre amixer">
# <i>amixer</i>
</pre>

<warn>
Du bør ikke få dette, men <e>hvis</e> du får en fejl med "amixer: Mixer 
attach default error: No such file or directory", så skal du manuelt
modprobe <c>snd-mixer-oss</c> og <c>snd-pcm-oss</c> én gang. Kør
herefter amixer igen.
</warn>

<pre caption="Kun hvis du får en fejl når du kører amixer">
# <i>modprobe snd-mixer-oss</i>
# <i>modprobe snd-pcm-oss</i>
# <i>amixer</i>
</pre>

<p>
Hvis du er kommet så langt, så skal du unmute Master og PCM
kanalerne. Noget hardware kræver endda at du unmuter center kanalen
eller endda sourround kanalen.
</p>

<pre caption = "At unmute kanaler">
# <i>amixer set Master 100 unmute</i>
# <i>amixer set PCM 100 unmute</i>
<comment>Kun hvis det ovenstående ikke lykkedes af sig selv:</comment>
# <i>amixer set Center 100 unmute</i>
# <i>amixer set Surround 100 unmute</i>
<comment>Test lyden:</comment>
# <i>aplay $KDEDIR/share/sounds/pop.wav</i> <codenote>(pop.wav er en del af KDE)</codenote>
</pre>

<p>
Vi tjekker, for at se om lyd virker, ved at bruge aplay (alsa play)
kommandoen. Hvis du hører et pop, så virker lyd rent faktisk. Justér
derefter lydniveauet som du har lyst til; den ncurses-baserede
<c>alsamixer</c> er en god måde at få dem "lige tilpads".
</p>

<p>
Du vil måske emerge <c>alsa-xmms</c> da dette vil give ALSA-understøttelse
til XMMS.
</p>

<p>
Når du genstarter dit system, vil <c>alsasound</c> init-scriptet gemme
 og gendanne din opsætning af lydniveau korrekt.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Endelige noter</title>
<section>
<title>Efter kerne-opgraderinger...</title>
<body>

<p>
Hver gang du bygger din kerne igen, eller opgraderer til en ny kerne,
så skal du bygge ALSA modulerne igen.
</p>

<p>
Selvom du har måske har installeret <c>alsa-driver</c>, <c>alsa-lib</c> og 
<c>alsa-utils</c>, er det kun den første der skal installeres igen, da
den putter alsa modulerne i <path>/lib/modules/*/kernel/sound/pci/</path>.
</p>

<pre caption="Nødvendigt efter hver kerne kompilering">
# <i>emerge alsa-driver</i>
</pre>

</body>
</section>
<section>
<title>/etc/modules.autoload</title>
<body>

<p>
Det er ikke nødvendigt at redigere denne fil til brug med ALSA. Efter
vores <c>rc-update add alsasound boot</c> vil vores system hente de
korrekte moduler ved opstart.
</p>

<p>
Det er ikke nødvendigt at tilføje <c>snd-pcm-oss</c> eller
 <c>snd-mixer-oss</c> i denne fil. Tjek <uri
link="http://www.djcj.org/LAU/guide/alsbook/faq1.html">denne FAQ</uri>
for mere information.
</p>

</body>
</section>
<section>
<title>Kendte problemer</title>
<body>

<note>
Denne vejledning halter bag efter udviklingen af ALSA. Der er mulighed for
at disse problemer er ordnet når du læser dette.
</note>

<ul>
  <li>
    Hvis du har <b>meget larm</b> når du bruger <b>oss</b>-emulering,
    tilføj da <e>options snd-pcm-oss dsp_map=1</e> til <path>/etc/modules.d/alsa</path>
  </li>
</ul>

</body>
</section>
<section>
<title>At aktivere joystick-understøttelse</title>
<body>

<p>
Hvis dit lydkort har et joystick-stik, vil du måske være interesseret i
at aktivere joystick-understøttelse i dit lydkort. Hvis dette er
tilfældet, start med at verificere at dit lydkorts driver har en
joystick-parameter. Du kan verificere dette ved at køre <c>modinfo</c>
mod din <path>snd-&lt;dit chipsæt&gt;</path>. F.eks. <c>snd-via82xx</c>:
</p>

<pre caption="At køre modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA 82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port. (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for DXS channels 
             (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 = no VRA)"
</pre>

<p>
Hvis det har parameteren <c>joystick</c> så skal du tilføje
<c>joystick=1</c> til din <c>options</c> linie i
 <path>/etc/modules.d/alsa</path>. F.eks. <c>snd-via82xx</c>:
</p>

<pre caption="At tilføje parameteren joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>Flere links...</title>
<body>

<p>
Du kan tjekke disse links for at få mere information:
</p>

<ul>
  <li>
    <uri link="http://www.gentoo.org/doc/en/desktop.xml">Gentoo Linux 
    Desktop Opsætningsvejledningen</uri>
  </li>
  <li>
    <uri link="http://www.alsa-project.org">ALSA-projektets hjemmeside </uri>
  </li>
  <li>
    <uri link="http://www.alsa-project.org/documentation.php3">ALSA 
     brugerdokumentation</uri>
  </li>
  <li>
    <uri link="http://www.djcj.org">ALSA Howto og FAQ'er</uri>
  </li>
  <li>
    <uri link="http://tldp.org/HOWTO/Sound-HOWTO/index.html">Linux Sound 
    HOWTO</uri>
  </li>
  <li>
    <uri link="http://linux-sound.org/">Lyd og MIDI software til Linux</uri>
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
