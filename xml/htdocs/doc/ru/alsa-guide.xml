<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/alsa-guide.xml,v 1.7 2006/04/01 20:03:27 achumakov Exp $ -->

<guide link="/doc/ru/alsa-guide.xml" lang="ru" disclaimer="draft">
<title>Руководство Gentoo Linux ALSA</title>

<author title="автор">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="переводчик">
  <mail link="azazello1984@mail.ru">Азамат Хакимов</mail>
</author>

<abstract>
С помощью этого документа пользователь сможет настроить ALSA в ОС Gentoo Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<version>2.11</version>
<date>2006-03-25</date>

<chapter>
<title>Введение</title>
<section>
<title>Что такое ALSA?</title>
<body>

<p>
ALSA, или <e>Advanced Linux Sound Architecture</e> &mdash; <e>Продвинутая
Звуковая Архитектура Linux</e>, обеспечивает аудио- и MIDI- (<e>Musical
Instrument Digital Interface</e> &mdash; <e>Цифровой Интерфейс Музыкальных
Инструментов</e>) функциональность в операционной системе Linux. ALSA является
основной звуковой подсистемой в ядрах 2.6, заменившей собой OSS (<e>Open Sound
System</e> - <e>Открытая Звуковая Система</e>), которая использовалась в ядрах
2.4.
</p>

<p>
Главные преимущества ALSA заключены в эффективной поддержке всех типов
аудиоинтерфейсов, начиная от обычного пользователя и заканчивая
профессиональным звуковым оборудованием, в безопасности с потоками и
мультипроцессорными системами, в обратной совместимости с OSS и
библиотеке <c>alsa-lib</c> пользовательского уровня для простой разработки
приложений.
</p>

</body>
</section>
<section>
<title>ALSA в Gentoo</title>
<body>

<p>
Одним из преимуществ Gentoo является, то пользователю предоставляется
максимальный контроль над установкой/настройкой системы. ALSA в Gentoo следует
этому принципу. Есть два способа осуществить поддержку ALSA в вашей
системе. Мы подробно рассмотрим их в следующей главе.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Устновка ALSA</title>
<section>
<title>Параметры</title>
<body>

<warn>
Способы, описываемые ниже, несовместимы между собой. У вас не может быть
скомпилированная в ядре ALSA и одновременно установленный
<c>media-sound/alsa-driver</c>. Это приведет к <e>краху</e>.
</warn>

<p>
Есть две возможности для установки ALSA:
</p>

<ol>
  <li>
  Использование ALSA, предоставляемой вашим ядром. Это предпочтительный и
  рекомендуемый метод.
  </li>
  <li>
  Использование пакета <c>media-sound/alsa-driver</c>, предоставляемого Gentoo.
  </li>
</ol>

<p>
Рассмотрим подробнее оба варианта перед тем, как окончательно выбрать один.
</p>

<p>
Вот преимущества и недостатки использования ALSA, предоставляемой ядром:
</p>

<table>
<tr>
  <th>ALSA в ядре</th>
  <th>за и против</th>
</tr>
<tr>
  <th>+</th>
  <ti>Хорошая стабильность интегрированных в ядро драйверов</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Одно решение, никаких повторных команд emerge</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Может быть немного устаревшей по сравнению с <c>alsa-driver</c></ti>
</tr>
</table>

<p>
А если вы выберете alsa-driver, то:
</p>

<table>
<tr>
  <th>Драйверы ALSA</th>
  <th>за и против</th>
</tr>
<tr>
  <th>+</th>
  <ti>Последние драйверы от Проекта ALSA</ti>
</tr>
<tr>
  <th>-</th>
  <ti>Каждая пересборка ядра требует повторной установки <c>alsa-driver</c></ti>
</tr>
<tr>
  <th>-</th>
  <ti>Определенные параметры конфигурации ядра дожны быть отключены</ti>
</tr>
</table>

</body>
</section>
<section>
<title>Итак...</title>
<body>

<p>
Главное отличие между использованием <c>alsa-driver</c> и ALSA, идущей вместе с
ядром, в том, что версия <c>alsa-driver</c> в основном немного новей, чем версия
в ядре. Так как нет огромной разницы между ними, вы можете попробовать ALSA,
идущую вместе с ядром, как простое в использовании решение. Перед тем, как
сообщить в <uri link="https://bugs.gentoo.org">Gentoo Bugzilla</uri> о любой
проблеме, связанной со звуком, пожалуйста, попробуйте воспроизвести ее с
использованием <c>alsa-driver</c> и отправьте отчет об ошибке вне
зависимости от результата.
<!-- последнии строки непонятны - "and file the bug report no matter what the
result." -->
</p>

</body>
</section>
<section id="lspci">
<title>Перед тем, как вы начнете</title>
<body>

<p>
Вне зависимости от выбранного вами способа установки, вам необходимо
узнать какие драйвера использует ваша карта. В большинстве случаев, звуковые
карты (встроенные и подключаемые) основаны на PCI и <c>lspci</c> поможет вам
раскопать необходимую информацию. Сделайте <c>emerge sys-apps/pciutils</c>
чтобы получить <c>lspci</c>, если вы еще не установили этот пакет. Если у вас
звуковая карта с USB, <c>lsusb</c> из <c>sys-apps/usbutils</c> <e>может</e>
вам помочь. Карт ISA попробуйте <c>sys-apps/isapnptools</c>. Также следующие
страницы  <e>могут</e> помочь владельцам звуковых карт, основанных на ISA.
</p>

<ul>
  <li>
  <uri link="http://www.roestock.demon.co.uk/isapnptools/">Страница
  ISAPNPTOOLS</uri>
  </li>
  <li>
  <uri link="http://www2.linuxjournal.com/article/3269">Статья о PnP в
  LinuxJournal</uri>
  </li>
  <li>
  <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">TLDP Sound
  HOWTO</uri>
  </li>
</ul>

<note>
Чтобы было проще объяснять, в оставшейся части руководства мы предположим, что
у пользователя звуковая карта, основанная на PCI.
</note>

<p>
Теперь мы попробуем найти информацию о звуковой карте.
</p>

<pre caption="Подробности звуковой карты">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
Теперь мы знаем, что звуковая карта, установленная в компьютере, &mdash; Sound
Blaster Live!, и производителем является Creative Labs. Зайдем на страницу <uri
link="http://www.alsa-project.org/alsa-doc/">ALSA Soundcard Matrix</uri> и
выберем select Creative Labs из выпадающего списка. В ответ вы получите
страницу, содержащую таблицу продуктов Creative Labs, из которой вы можете
узнать, что SB Live! использует модуль <c>emu10k1</c>. Эта информация нам и
нужна. Если вам нужна более подробная информация, то вы можете перейти по
ссылке "Details" на страницу о <c>emu10k1</c>.
</p>

</body>
</section>
<section id="kernel">
<title>Использование ALSA, доступного из вашего ядра</title>
<body>

<p>
Если вы один из тех, кто идет по пути наименьшего сопротивления, как и я, то
этот способ для вас.
</p>

<note>
Начиная с выпуска 2005.0, Gentoo Linux использует 2.6 в качестве основного
ядра. Если не используете намеренно профиль с ядром 2.4, пакет
<c>gentoo-sources</c> для <e>большинства</e> архитектур должен быть ядром из
ветки 2.6. Пожалуйста, проверьте, что у вас ядро из ветки 2.6. Этот способ
<e>не</e> применим для ядра 2.4.
</note>

<p>
А теперь давайте сконфигурируем ядро для включения ALSA.
</p>

<impo>
Пользователи <c>genkernel</c> должны запустить <c>genkernel --menuconfig 
all</c> и следовать инструкциям из раздела <uri 
link="#doc_chap2_pre3">Параметры ядра для ALSA</uri>.
</impo>

<pre caption="Heading over to the source">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
В примере выше предполагается, что символическая ссылка
<path>/usr/src/linux</path> указывает на исходные коды используемого вами
ядра. Пожалуйста, удостоверьтесь в этом перед тем, как продолжить.
</note>

<p>
Теперь мы включим некоторые параметры в конфигурации ядра 2.6, чтобы
обеспечить поддержку ALSA для нашей звуковой карты.
</p>

<p>
Пожалуйста, отметьте, что для простоты все примеры показывают, что ALSA будет
собираться в качестве модулей. Это благоразумно, потому что в дальнейшем это
позволит использовать <c>alsaconf</c>, с помощью которого будет удобно
настраивать звуковую карту.
<!-- Непонятно - It is advisable to follow the same as it then allows the use
of <c>alsaconf</c> which is a boon when you want to configure your card. -->
Пожалуйста, <e>не</e> пропустите раздел <uri
link="#alsa-config">Конфигурация/uri>. Если вы все же выбираете встроенные
параметры, удостоверьтесь, что вносите правильные изменения в конфигурацию.
</uri>
</p>

<pre caption="Параметры ядра для ALSA">
Device Drivers  ---&gt;
   Sound  ---&gt;

<comment>(Поддержка должна быть включена)</comment>
&lt;M&gt; Sound card support

<comment>(Убедитесь, что OSS отключена)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(Вернитесь на шаг назад и войдите в раздел ALSA)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Выберите, если вам нужен MIDI sequencing и routing)</comment>
   &lt;M&gt; Sequencer support
   <comment>(Поддержка старых /dev/mixer* и /dev/dsp*. Рекомендуется.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API

<comment>(Теперь вы можете выбирать поддерживаемые устройства. Обычно в
системе есть только одна звуковая карта. Если у вас их несколько, включите
поддержу для них всех.)</comment>

<comment>(Для тестирования и разработки, обычным пользователям не нужен,
но если вы знаете, что делаете...)</comment>
Generic devices  ---&gt;

<comment>(Для звуковых карт ISA)</comment>
ISA devices   ---&gt;
<comment>(Если у вас Gravis, выберите этот параметр)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Перейдите на один уровень назад и войдите в раздел PCI-устройств.
Большинство современных звуковых карт основаны на PCI)</comment>
PCI devices   ---&gt;
   <comment>(Теперь выберем драйвер emu10k1 для нашей карты)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(Или для карты Intel)</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(А может у вас карта на чипсете VIA?)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(Вернитесь на один уровень назад и выберите, если у вас звуковая карта USB)</comment>
USB Devices   ---&gt;
</pre>

<p>
Теперь параметры вашего ядра установлены, и вы можете (пере)собрать ядро.
Поддержка ALSA для вашей карты будет доступной после того, как вы
перезагрузитесь с новым ядром. Не забудьте обновить конфигурацию вашего
начального загрузчика, чтобы использовать недавно собранное ядро. Теперь, если
все работает, как должно, вы можете продолжить с <uri
link="#alsa-utilities">утилит ALSA</uri>.
</p>

</body>
</section>
<section id="alsa-driver">
<title>Использование драйверов ALSA из пакета</title>
<body>

<p>
Итак, вы выбрали использование <c>alsa-driver</c>. Тогда начнем.
Есть несколько причин того, чтобы были скомпилирован только тот драйвер,
который необходим вашей карте. Хотя в этом нет особой необходимости, будут
убраны ненужные драйверы, которые в другом случае собирались бы.
</p>

<p>
Если вы не знаете, какие драйверы для звуковой карты вам могут понадобиться,
пожалуйста, ознакомьтесь с разделом <uri link="#lspci">lspci</uri> этого
руководства. Как только вы узнаете имя драйвера (<c>emu10k1</c> в нашем
примере), отредактируйте <path>/etc/make.conf</path>, добавив переменную
<c>ALSA_CARDS</c>.
</p>

<pre caption="Добавление ALSA_CARDS в make.conf">
<comment>(Для одной звуковой карты)</comment>
ALSA_CARDS="emu10k1"
<comment>(Для нескольких карт разделите названия пробелами)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Если вы уже скомпилировали свое ядро и хотите использовать <c>alsa-driver</c>,
пожалуйста удостоверьтесь в следующем перед тем, как продолжить, иначе
<c>alsa-driver</c>, скорее всего не установиться. Следующий список поможет вам
провести проверку.
</p>

<note>
Пользователи <c>genkernel</c> могут продолжить с <uri
link="#doc_chap2_pre6">установки alsa-driver</uri>, так как конфигурация их
обновленного ядра по умолчанию соответствует нижеперечисленному.
</note>

<ol>
  <li>
  <c>CONFIG_SOUND</c> is set. (Общая поддержка звука включена)
  </li>
  <li>
  <c>CONFIG_SOUND_PRIME</c> is not set. (Встроенная поддержка OSS отключена)
  </li>
  <li>
  <c>CONFIG_SND</c> is not set. (Встроенная поддержка ALSA отключена)
  </li>
  <li>
  Символическая ссылка <path>/usr/src/linux</path> отражает то ядро, для
которого вы хотите осуществить поддержку ALSA.
  </li>
</ol>

<pre caption=".config checks">
<comment>(Проверяем, что символическая ссылка указывает на нужное
ядро.)</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(Первый пункт выполнен)</comment>
CONFIG_SOUND=y
<comment>(Второй пункт выполнен)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(Третий пункт выполнен)</comment>
CONFIG_SND is not set
</pre>

<p>
Теперь вы готовы набрать магические слова... нет, не абракадабру.
</p>

<pre caption="Установка alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Пожалуйста, запомните, что вам придется запускать <c>emerge alsa-driver</c>
каждый раз после очередной (пере)сборки ядра, так как предыдущие драйверы
удаляются.
</impo>

</body>
</section>
</chapter>

<chapter>
<title>Настройка/тестирование ALSA</title>
<section id="alsa-utilities">
<title>Утилиты ALSA</title>
<body>

<p>
<c>alsa-utils</c>, содержащие множество очень полезных программ, в том числе и
сценарий инициализации ALSA, составляют неотъемлемую часть ALSA. Поэтому мы
настоятельно советуем вам установить <c>alsa-utils</c>
</p>

<pre caption="Установка alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Если вы включили поддержку ALSA в вашем <uri link="#kernel">ядре</uri> <e>и</e>
собрали ее <e>не в качестве</e> модулей, пожалуйста, перейдите в раздел <uri
link="#initscript">Сценарий инициализации ALSA</uri>. Все что вам осталось
&mdash; настроить ALSA. Это может быть сделано очень просто при помощи
<c>alsaconf</c> &mdash; утилиты, входящей в состав <c>alsa-utils</c>.
</note>

</body>
</section>
<section id="alsa-config">
<title>Настройка</title>
<body>

<note>
Пожалуйста, завершите все программы, которые <e>могут</e> обратиться к
звуковой карте во время работы <c>alsaconf</c>.
</note>

<p>
Самый простой способ настроить вашу звуковую карту &mdash; запустить
<c>alsaconf</c>. Просто наберите <c>alsaconf</c> в терминале с правами root.
</p>

<pre caption="Запуск alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Вы увидите опрятный интерфейс программы, которая автоматически опробует ваши
устройства и попробует найти вашу звуковую карту. Вас попросят выбрать звуковую
карту из списка. Как только это будет сделано, вас спросят разрешения
автоматически сделать необходимые изменения в <path>/etc/modules.d/alsa</path>.
Также будут изменены настройки громкости на оптимальный уровень, выполнится
<c>modules-update</c> и запустится сервис <path>/etc/init.d/alsasound</path>.
После того, как <c>alsaconf</c> закончит работу, вы сможете продолжить с
настройки сценария инициализации ALSA.
</p>

</body>
</section>
<section id="initscript">
<title>Сценарий инициализации ALSA</title>
<body>

<p>
Мы почти закончили настройку. Вне зависимости от выбранного вам способа
установки ALSA, вам понадобится что-то, что будет загружать модули или
инициализировать ALSA и восстанавливать настройки громкости при загрузке
системы. Сценарий инициализации ALSA, называемый <c>alsasound</c>, сделает это
все для вас. Добавьте его в загрузочный уровень запуска. <!-- даешь boot
runlevel в глоссарий! -->
</p>

<pre caption="Добавление ALSA в загрузочный уровень запуска">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Далее, проверьте файл <path>/etc/conf.d/alsasound</path> и убедитесь, что
переменная SAVE_ON_STOP установлена в значение yes. Это сохранит ваши
настройки звука при выключении системы.
</p>

</body>
</section>
<section>
<title>Группа audio</title>
<body>

<p>
Перед тем как начать тестировать, необходимо сделать одну последнюю
<e>важную</e> вещь. Главное правило в операционных системах *nix гласит:
&laquo;Не работай с правами root, если в этом нет необходимости&raquo;. Сейчас
это правило будет выполнено ;). Каким образом? Ну, большую часть времени вы
будете работать под учетной записью пользователя и захотите слушать музыку или
иметь доступ к звуковой карте. Чтобы это было так, вы должны быть в группе
audio. Сейчас мы добавим пользователей в эту группу, чтобы у них не было проблем
со звуком. Мы воспользуемся <c>gpasswd</c>, так что вы должны иметь права root,
чтобы сделать это.
</p>

<pre caption="Добавление пользователей в группу audio">
<comment>(Замените &lt;имя_пользователя&gt; на необходимое имя)</comment>
# <i>gpasswd -a &lt;имя_пользователя&gt; audio </i>
Adding user &lt;имя_пользователя&gt; to group audio
</pre>

</body>
</section>
<section>
<title>Проверка громкости!</title>
<body>

<p>
Мы выполнили все необходимые настройки и подготовку, а теперь заставим ALSA
работать. Если запускали утилиту <c>alsaconf</c>, вы можете пропустить этот
шаг, так как <c>alsaconf</c> уже все сделал за вас.
</p>

<pre caption="Запуск сервиса">
<comment>(для ALSA в качестве модулей)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Loading: snd-card-0 ...        [ ok ]
 * Loading: snd-pcm-oss ...       [ ok ]
 * Loading: snd-seq ...           [ ok ]
 * Loading: snd-emu10k1-synth ... [ ok ]
 * Loading: snd-seq-midi ...      [ ok ]
 * Restoring Mixer Levels ...     [ ok ]
<comment>(для ALSA, встроенной в ядро)</comment>
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 * Restoring Mixer Levels ...     [ ok ]
</pre>

<p>
Теперь эти необходимые вещи выполнены, и нам надо проверить громкость, потому 
что по умолчанию звук выключен. Для этого случая мы воспользуемся 
<c>alsamixer</c>.
</p>

<pre caption="Запуск alsamixer">
<comment>(Откройте в терминале. Будут отображены только необходимые настройки)</comment>
# <i>alsamixer</i>
</pre>

<impo>
Если у вас проблемы с запуском <c>alsamixer</c> и вы получаете ошибки, подобные
этой: &laquo;alsamixer: function snd_ctl_open failed for default: No such file
or directory&raquo;, то, скорее всего, проблема в инициализации устройств
демоном udev. Запустите <c>killall udevd; udevstart</c> для перезагрузки
устройств в <path>/dev</path> и попробуйте снова <c>alsamixer</c>. Это должно
решить проблему.
</impo>

<p>
Вот так <e>может</e> выглядеть микшер ALSA при первом запуске. Обратите
внимание, что уровни каналов Master и PCM занижены и что под ними буквы MM.
Это означает, что они заглушены. Если вы попробуете что-нибудь проиграть с
таким состоянием <c>alsamixer</c>, то не услышите ничего из ваших динамиков.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="AlsaMixer выключен"
caption="Главное окно микшера ALSA, каналы заглушены"/>

<p>
Для начала, включим каналы и установим необходимые уровни громкости.
</p>

<warn>
Оба канала Master <e>и</e> PCM должны быть включены и установлены в слышимый
уровень громкости, если вы хотите услышать что-то из ваших динамиков.
</warn>

<ul>
  <li>
  Для перемещения между каналами используйте клавиши влево и вправо. (&lt;-
  и -&gt;).
  </li>
  <li>
  Чтобы заглушить/включить канал, выберите его, например Master, и нажмите
  клавишу <e>m</e>.
  </li>
  <li>
  Чтобы увеличить или уменьшить уровень громкости, используйте клавиши вверх и
  вниз.
  </li>
</ul>

<note>
Будьте осторожны при установке значений для Bass и Treble. Обычно для обоих
оптимально значение 50. Слишком высокие значения Bass могут вызвать
<e>дребезжание</e> динамиков, неспособных воспроизводить глубокие басы.
</note>

<p>
После того, как вы все сделаете, ваш микшер ALSA должен выглядеть, как это
показано ниже. Заметьте, что вместо MM &mdash; 00 и уровни громкости в
оптимальном значении.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="AlsaMixer включен"
caption="Микшер ALSA готов зажигать"/>

</body>
</section>

<section>
<title>Проверка звука!</title>
<body>

<p>
Наконец-то. Музыка. Если все прошло замечательно, то теперь вы сможете слушать
хорошую музыку. Быстрый способ убедиться в этом &mdash; воспользоваться
консольной командой наподобие <c>media-sound/madplay</c>. Вы также можете
использовать что-нибудь более известное, например <c>mpg123</c> или <c>xmms</c>.
Если вы поклонник формата OGG, используйте программу <c>ogg123</c> из
<c>media-sound/vorbis-tools</c>. Используйте любой удобный для вас плеер. Как
всегда, <c>emerge</c> &mdash; то, что вам надо.
</p>

<pre caption="Получение программ">
<comment>(Установка необходимых приложений)</comment>
# <i>emerge madplay mpg123 xmms</i>
<comment>(Для проигрывания ogg-файлов)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
А теперь проиграем ваш любимый саундтрек...
</p>

<pre caption="Проигрывание музыки">
# <i>madplay -v /mnt/shyam/Music/Paul\ Oakenfold\ -\ Dread\ Rock.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Dread Rock
         Artist: Paul Oakenfold
          Album: Matrix Reloaded
           Year: 2003
          Genre: Soundtrack
                 Soundtrack
 00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 Paul\ Oakenfold\ -\ Dread\ Rock.ogg</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Paul Oakenfold - Dread Rock.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Soundtrack
Transcoded: mp3;160
Title: Dread Rock
Artist: Paul Oakenfold
Date: 2003
Album: Matrix Reloaded
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>

</body>
</section>
<section>
<title>ALSA и USE</title>
<body>

<p>
Теперь вы можете добавить USE-флаг <c>alsa</c> в файл
<path>/etc/make.conf</path>, чтобы гарантировать, что приложения,
поддерживающие ALSA, будут компилироваться вместе с нею. На некоторых
платформах, как x86 и amd64, флаг включен по умолчанию.
</p>

</body>
</section>
<section>
<title>Проблемы?</title>
<body>

<p>
Если по каким-либо причинам вы не слышите звука, сначала проверьте настройки
<uri link="#doc_chap3_pre6">alsamixer</uri>. 80% всех проблем заключаются в
заглушенных каналах или низкой громкости. Также проверьте звуковой апплет
вашего оконного менеджера и удостоверьтесь, что громкости каналов установлены на
слышимом уровне.
</p>

<p>
<path>/proc</path> &mdash; ваш друг, товарищ и брат. <!-- Я не смог
удержаться :) На самом деле - "/proc - ваш друг."--> И, в таком случае,
<path>/proc/asound</path> &mdash; ваш лучший друг. Мы просто бегло просмотрим,
как много информации доступно здесь для нас.
</p>

<pre caption="Развлечение с /proc/asound">
<comment>(Перво-наперво, если /proc/asound/cards отображает вашу карту, то ALSA
распознала вашу звуковую карту.)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Если вы, как и я, не включали поддержку ALSA в ядре и использовали
alsa-driver, то это отобразит текущую версию ALSA)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(Подробности эмуляции OSS в ALSA )</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
Другой очень распространенной проблемой среди пользователей является странная
ошибка &laquo;Unknown symbol in module&raquo; (&laquo;Неизвестный символ в
модуле&raquo;). Пример ее появления показан ниже.
</p>

<pre caption="Ошибка неизвестного символа в модуле">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)                             
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)                             
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
А если просмотреть вывод <c>dmesg</c>, то, скорее всего, можно увидеть
следующее:
</p>

<pre caption="Вывод dmesg">
<comment>(Показаны только соответствующие части вывода)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) ->
IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
Эта проблема возникает из-за попытки переключиться с <c>alsa-driver</c> на
встроенную в ядре ALSA. Когда вы удаляете <c>alsa-driver</c>, то файлы
модулей сохраняются системой защиты конфигурации. Поэтому, когда вы переходите
на встроенные в ядро драйверы, попытка <c>modprobe</c> выдаст вам смесь модулей
из <c>alsa-driver</c> и встроеных в ядро, порождая рассмотренные ошибки.
</p>

<p>
Решение очень простое. Просто удалите вызывающий проблемы каталог после
удаления <c>alsa-driver</c>. Проверьте, что удаляете модули правильной версии
ядра!
</p>

<pre caption="Удаление модулей alsa-driver">
<comment>(Замените KERNELVER вашей версией ядра)</comment>
# <i>rm -rf /lib/modules/KERNELVER/alsa-driver</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Другие возможности ALSA</title>
<section>
<title>Настройка поддержки MIDI</title>
<body>

<p>
Если ваша карта имеет встроенный MIDI синтезатор и вы хотите слушать *.mid
файлы, установите <c>awesfx</c>, содержащий основной набор утилит для
управления драйвером AWE32. Сначала нам надо установить его. Если у вас нет
синтезатора, вы можете использовать виртуальный. Пожалуйста, обратитесь к
разделу <uri link="#vsynth">Виртуальные синтезаторы</uri> для более детальной
информации.
</p>

<pre caption="Установка awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Вам понадобиться скопировать файлы сэмплов SoundFont (SF2) с
компакт-диска вашей звуковой карты или из установленных Windows в каталог
<path>/usr/share/sounds/sf2/</path>. Для примера, файл сэмплов для
карты Creative SBLive! может называться 8MBGMSFX.SF2.
</note>

<p>
После копирования файлов сэмплов мы сможем проигрывать midi-файлы.
Также вы можете добавить команду <c>asfxload</c> в
<path>/etc/conf.d/local.start</path>, благодаря чему сэмплы будут
загружены при каждой загрузке системы.
</p>

<note>
Пути, начинающиеся с <path>/mnt</path>, использованные ниже, <e>не
применимы</e> для вашего компьютера. Они являются примерами. Пожалуйста,
будьте осторожны при изменении путей на подходящие для вашей системы.
</note>

<pre caption="Загрузка сэмплов">
<comment>(сначала копируем файл сэмплов)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(или берем его из компакт-диска SoundBlaster)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(загружаем определенный набор сэмплов)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Теперь вы можете проигрывать midi-файлы, используя программу наподобие
<c>aplaymidi</c>. Запустите <c>aplaymidi -l</c> чтобы получить список доступных
портов, а затем задействуйте один из них для проигрывания файла.
</p>

<pre caption="Проигрывание MIDI">
<comment>(Проверка открытых портов)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Используем порт и проигрываем mid-файл)</comment>
# <i> aplaymidi --port=65:0 /mnt/shyam/music/midi/mi2.mid</i>
</pre>

</body>
</section>
<section id="vsynth">
<title>Виртуальные синтезаторы</title>
<body>

<p>
Если у вашей карты отсутствует встроенный синтезатор, вы можете использовать
виртуальный, например <c>timidity++</c>. Установка проста.
</p>

<pre caption="Установка timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Чтобы timidity проигрывал звуки, ему нужен набор сэмплов SoundFont. Если у вас 
его нет, установите <c>timidity-eawpatches</c> или <c>timidity-shompatches</c>, 
которые предоставят некоторые сэмплы. У вас может быть несколько 
наборов установленных сэмплов, и вы можете поместить их в 
<path>/usr/share/timidity/</path>. Для переключения между разными
конфигурациями timidity, вы должны будете использовать утилиту
<c>timidity-update</c> из пакета timidity++.
</p>

<pre caption="Установка сэмплов">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(или)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
Не забудьте добавить <c>timidity</c> в основной уровень запуска.
</p>

<pre caption="Добавление timidity в основной уровень запуска">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Теперь вы можете попробовать <uri link="#doc_chap4_pre3">проиграть MIDI</uri>.
</p>

</body>
</section>
<section>
<title>Утилиты и Firmware</title>
<body>

<p>
Для некоторых звуковых карт могут быть полезны утилиты из пакетов
<c>alsa-tools</c> и <c>alsa-firmware</c>. Если вам нужен пакет
<c>alsa-tools</c>, проверьте, что определили в переменной ALSA_TOOLS в файле
<path>/etc/make.conf</path> нужные вам утилиты. Для примера:
</p>

<pre caption="Выбор утилит ALSA в /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Если переменная ALSA_TOOLS не определена, то будут собраны все доступные
утилиты. Теперь установите пакет <c>alsa-tools</c> (и/или <c>alsa-firmware</c>):
</p>

<pre caption="Установка утилит ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Огромное спасибо вам всем...</title>
<body>

<p>
Всем, кто принимал участие в написании ранних версий руководства Gentoo ALSA:
Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy Huddleston, John P.
Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft и Erwin. А также Dr][aM за
перевод ранней версии руководства на русский язык.
</p>

</body>
</section>
<section>
<title>Ссылки</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">Проект ALSA</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>

<!-- *$Localization:
target-language: Russian
target-version: 2.11-r1
target-date: 2005-04-01
source-cvs-revision: 1.65
translated-by: Azamat H. Hackimov <azazello1984@mail.ru>
edited-by:

notes:
slightly checked. achumakov
-->
