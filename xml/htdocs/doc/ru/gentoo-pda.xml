<?xml version="1.0" encoding="UTF-8"?>
<!-- REV: 1.14 -->
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/Attic/gentoo-pda.xml,v 1.1 2004/06/24 20:03:28 sergey Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/en/gentoo-pda.xml">
<title>Gentoo Linux PDA/PIM Guide</title>

<author title="Author"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Contributor">
  Steven Hay
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Translator">
  <mail link="dmitrio@gmx.net">Dmitri Orleanski</mail>
</author>

<abstract>
Это руководство описывает конфигурацию многих PDA для использования в Gentoo Linux.
</abstract>

<license/>

<version>2.2</version>
<date>February 24, 2003</date>

<chapter>
<title>Независимая установка PDA </title>
<section>
<title>Конфигурация соединения</title>
<body>

<p>
Первым делом нам надо убедится, что PDA может общаться с нашим компьютером.
</p>

</body>
</section>

<section>
<title>USB Соединение</title>
<body>

<p>
Вначале давайте убедимся что ядро поддерживает USB, и если нет, то установим необходимые драйвера. Это описание предполагает что вы знакомы с основами конфигурирования ядра.
</p>

<p>
Если у вас нет исходных кодов ядра на вашем жёстком диске, то сейчас стоит
установить их. Я не буду описывать разницу в ядрах, которые предлагаются в Gentoo, если такая информация нужна, то следует почитать <uri link="http://www.gentoo.org/doc/en/gentoo-x86-install.xml">Installation Guide</uri>.
</p>

<pre caption="Необходымие USB установки в конфигурации ядра">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Нужные нам настройки:
</p>

<ul>
 <li>USB support (CONFIG_USB)</li>
 <li>The preliminary USB Device Filesystem (CONFIG_USB_DEVICEFS)</li>
 <li>
  The appropriate controller - UHCI, or OHCI (CONFIG_USB_UHCI, или
  CONFIG_USB_OHCI)
 </li>
 <li>USB Serial Converter support (CONFIG_USB_SERIAL)</li>
 <li>
  USB Handspring Visor Driver (CONFIG_USB_SERIAL_VISOR) (serial converter's
  sub-option) [Only necessary if you are using a Handspring]
 </li>
</ul>

<note>
По возможности скомпилируйте эти опции как модули и добавьте их в
<path>/etc/modules.autoload</path>
что бы они автоматически подгружались в ядро при загрузке компьютера.
</note>

</body>
</section>

<section>
<title>Последовательное Соединение</title>
<body>

<p>
Я предположу что подставка под PDA подключена к серийному порту (/dev/ttyS0 или /dev/tts/0 при использовании &quot;devfs&quot;)
</p>

<pre caption="Добавление последовательного устройства">
# <i>groupadd serial</i>
# <i>chown root:serial /dev/tts/0</i>
# <i>chmod g+rw /dev/tts/0</i>
# <i>ls -l /dev/tts/0</i>
# crw-rw----    1 root     serial     4,  64 Dec 31  1969 /dev/tts/0
# <i>ln -s /dev/tts/0 /dev/pilot</i>
# <i>nano -w /etc/group</i> <comment>(добавьте нужных пользователей в группу "serial")</comment>
</pre>

<p>
Мы добавили в систему группу &quot;serial&quot; и вы должны добавить пользователей, которым необходимо использовать последовательный порт (Palm pilot пользователей), в группу serial. Так же мы назначили для этой группы &quot;rw&quot; разрешения (разрешения на чтение и запись)
<path>/dev/tts/0</path>, и для дальнейших ссылок мы сделали
<path>/dev/pilot</path> символьную ссылку на <path>/dev/tts/0</path>.
Благодаря недавним изменениям в поддержке devfs системой Gentoo, эти изменения
сохранятся после перезагрузки.
</p>

<note>
Пользователи pre-rc6-r13 могут или обновить  <path>sys-apps/baselayout</path>
и <path>sys-fs/devfsd</path> (и объединить  &quot;._cfg*&quot; файлы в 
<path>/etc</path>), или просто добавить подходящие разрешения и символьную ссылку в
<path>/etc/devfsd.conf</path>.
</note>

</body>
</section>

<section>
<title>Перезапускаем devfsd</title>
<body>

<p>
Теперь вам надо перезапустить <e>devfsd</e> демон. Если в вашем конфигурационном файле содержатся ошибки, то вам потребуется вручную запустить демона потому как он прекратит работать.
</p>

<pre caption="Перезапускаем devfsd">
# <i>killall -HUP devfsd</i>
</pre>

</body>
</section>

<section>
<title>Sharp Zaurus (SL5000/SL5500) USB соединение</title>
<body>

<p>
У Зауруса есть удобная возможность соединится с вашим компьютером в качестве сетевого устройства, при этом без необходимости иметь сетевую карту. Все что вам надо это USB подставка под Заурус и <c>usbd</c> модуль в ядре.
</p>

<note>
Большая часть информации почерпнута на 
<uri>http://www.zauruszone.com/howtos/lc_generic.shtml</uri>.
Я благодарю разработчиков Sharp за их сотрудничество с Open Source сообществом.
</note>

<p>
Первым делом мы должны пропатчить ядро и затем включить <c>usbd</c> драйвер во
время конфигурации оного (т.е. ядра).
</p>

<pre caption="Получаем и устранавливаем usbd патч к ядру">
# <i>cd /usr/src</i>
# <i>wget http://www.zauruszone.com/howtos/downloads/usbdnet-2.4.18-patch.gz</i>
<comment>Патч для ядра 2.4.18</comment>
# <i>wget http://www.zauruszone.com/howtos/downloads/usbdnet-2.4.19-patch.gz</i>
<comment>Патч для ядра 2.4.19</comment>
# <i>wget http://www.zauruszone.com/howtos/downloads/usbdnet-2.4.20-patch.gz</i>
<comment>Патч для ядра 2.4.20</comment>

<comment>А теперь наложим патч на ядро, где 2.4.x это патч совпадающий с версией вашего ядра</comment>
# <i>zcat usbdnet-2.4.x.patch.gz | patch -p0</i>
</pre>

<p>
Как только мы закончили с наложением патча, можно сконфигурировать ядро и добавить следующие возможности:
</p>

<pre caption="Конфигурация ядра">
<comment>Мы должны находится в /usr/src/linux</comment>
# <i>make menuconfig</i>
В "Code maturity level options", выбрать "Prompt for development and/or incomplete code/drivers"
В "USB support", выбрать "USB Network adaptors", выбрать в качестве модуля "USBD Network (Encapsulated) Host-to-Host Link (EXPERIMENTAL)"
Затем ввести <i>04dd in USBD Network idVendor</i> и <i>8004 in USBD Network idProduct</i>.
</pre>

<p>
Не имеет значения как сконфигурировать <c>usbd</c> как модуль или включить монолитно в ядро. Если вы выбрали модуль, проверьте чтобы он грузился после перезагрузки. Дополнительно, проверьте что вся необходимая USB информация в вашем ядре соответствует тому что было описано выше.
</p>

<p>
После того как ядро было сконфигурировано и перезагружено, наступило время проверить патч в работе.
</p>
 
<p>
Установите включёный Zaurus'а, в поставку и нажмите кнопочку синхронизации. Если вы проверите <path>/var/log/messages</path>, вы должны увидеть похожую информацию:
</p>

<pre caption="/var/log/messages output">
# <i>tail -f /var/log/messages</i>
<comment>вывод</comment>
hub.c: USB new device connect on bus1/1, assigned device number 38
usb.c: USB device 38 (vend/prod 0x4dd/0x8004) is not claimed by any active driver.
v0.4b sl@lineo.com, tbr@lineo.com
usbdnet.c: v0.4b sl@lineo.com, tbr@lineo.com
usbdnet.c: USB Host to Device Network - for Linux USB Devices using MDLM/CDC
usb.c: registered new driver usbdnet
</pre>

<p>
Если все прошло гладко, тогда загрузим сетевое устройство:
</p>

<pre caption="Загрузка USB сетевого устройства">
# <i>ifconfig -a</i>
</pre>

<p>
Один из адаптеров, по имени <c>usb0</c> должен появится в листе.
</p>

<p>
Теперь настало время установить сеть на Zaurus'е. USB сеть похожа на PPP в том,
	что каждое сетевое устройство получает свой IP адрес. IP адрес на Zaurus'е
	установлен через конфигуратор настройки сети. Если это не "192.168.129.201"
	тогда используйте выданный IP адрес когда пытаетесь сделать ping до Zaurus'а.
</p>

<p>
Если после установки Zaurus'а на подставку вы получили другое имя сетевого
интерфейся, а не usb0, тогда замените все usb0 на нужный адрес. Вы сможете сконфигурировать сеть используя следующие команды.
</p>

<pre caption="Конфигурация Zaurus'а">
<comment>Введите эти строки в командной строке вашего компьютера</comment>
# <i>ifconfig usb0 192.168.129.1 netmask 255.255.255.255 up </i>
# <i>route add -host 192.168.129.201 usb0 </i>
</pre>

<p>
Теперь попытайтесь пинговать до Zaurus'а <c>ping 192.168.129.201</c>, если вы получили ответ, значит соединение успешно установлено.
</p>

<note>
Предыдущие шаги предназначались для того что бы ваш компьютер мог общаться с Zaurus'ом для синхронизации. Если вы хотите выйти в интернет с Zaurus'а через USB подставку, пожалуйста проконсультируйтесь на сайте разработчиков <uri link="http://www.zauruszone.com/howtos/lc_generic.shtml">Sharp Zaurus Developer</uri>.
</note>

</body>
</section>

<section>
<title>Дополнительные Настройки</title>
<body>

<p>
Перед сборкой любой программы которую вы будете использовать с вашим PDA,
следует проверить наличие <e>pda</e> в USE переменной в
<path>/etc/make.conf</path>. Тогда ваши программы будут собраны с поддержкой
PDA, если она конечно доступна.
</p>

<pre caption="Редактирование /etc/make.conf">
# <i>vim /etc/make.conf</i>
<comment>Надо найти вот такую строчку</comment>
USE=&quot;use1 use2 etc <i>pda</i>&quot;
</pre>

<p>
Теперь. если вы используете Palm/Handspring, надо добавить необходимые
символьные ссылки.
</p>

<pre caption="Создаем симлинки">
# <i>ln -s /dev/usb/tts/1 /dev/palm</i>
# <i>ln -s /dev/usb/tts/1 /dev/pilot</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Handspring/Palm синхронизация</title>
<section>
<title>Общая информация</title>
<body>

<p>
Вам понадобится программа для синхронизации информации с PDA. До сих пор мы
настриавали апаратную часть. Теперь пришло время перейти к программной, которая,
будем надеятся, окажется проще. Есть две основные категории ПО для
синхронизации - низкоуровневоя, выполняющее простое копирование данных между
палмом и компьютером, и позволяющее просматривать и  редактировать данные на
палме.
</p>

</body>
</section>

<section>
<title>Coldsync</title>
<body>

<p>
Coldsync определяется как <e>низкоуровневая</e> программа, потому как ни делает ничего специального как те программы которые мы опишем ниже. Coldsync можно найти на <uri>http://www.coldsync.org/</uri>. Программа была создана как замена pilot-link. Для установки программы выполните следующие действия:
</p>

<pre caption="Установка ColdSync">
# <i>emerge coldsync</i>
</pre>

<p>
Теперь, после того как мы убедились что все модули загружены, нажмите кнопку
синхронизации на подставке и через несколько секунд выполните coldsync с подходящими ключами в режиме обычного пользователя:
</p>

<pre caption="Использование ColdSync">
# <i>mkdir ~/palmbackup/</i>
<comment>нажмите кнопку синхронизации на подставке</comment>
# <i>coldsync -p /dev/usb/tts/1 -mb ~/palmbackup/</i>
</pre>

</body>
</section>

<section>
<title>Pilot-link</title>
<body>

<p>
Pilot-Link можно найти по адресу <uri>http://www.gnu-designs.com/pilot-link</uri>. Эта утилита выходит за рамки этого руководства, потому как я не использую эту программу. Хотя я читал как она работает, попробуйте:
</p>

<pre caption="Использование Pilot-Link">
# <i>mkdir ~/palmbackup/</i>
<comment>нажмите кнопку синхронизации</comment>
# <i>pilot-xfer -p /dev/usb/tts/1 -b ~/palmbackup/</i>
</pre>

</body>
</section>

<section>
<title>Высокоуровневые приложения для синхронизации</title>
<body>

<p>
Существует несколько эквивалентов Palm Desktop. Я опишу использование JPilot, который использует pilot-link библиотеки. Вы так же можете попробовать другие приложения на ваш собственный вкус.
</p>

<ul>
 <li><uri link="http://www.moshpit.org/pilotmgr/">Pilotmanager</uri></li>
 <li><uri link="http://www.jpilot.org/">J-Pilot</uri></li>
 <li><uri link="http://www.slac.com/pilone/kpilot_home/">KPilot (KDE)</uri></li>
 <li><uri link="http://www.gnome.org/projects/gnome-pilot/">Gnome-Pilot (GNOME)</uri></li>
</ul>

</body>
</section>

<section>
<title>J-Pilot</title>
<body>

<p>
Пользоваться J-Pilot очень просто. Установите и запустите его. Для установки, напечатайте:
</p>

<pre caption="Устанавливаем JPilot">
# <i>emerge jpilot</i>
</pre>

<p>
Теперь под обычным пользователем синхронизируем наш palm и затем запускаем программу:
</p>

<pre caption="Синхронизируем наш PDA">
# <i>jpilot-sync</i>
# <i>jpilot</i>
</pre>

<note>
Если синхронизация не работает, посмотрите внимательно на сообщение об ошибке;
возможно вам надо создать символьную ссылку, выставить правильные разрешения в
devfsd или передать правильный ключ. Кроме того, прочитайте man.
</note>

</body>
</section>

<section>
<title>Автоматизируем процесс</title>
<body>

<p>
Сейчас вы должны взглянуть на конфигурационный файл devfsd. Если вы ещё не
догадались, то здесь мы настроим автоматическую синхронизацию по нажатию sync
кнопки. Когда устройство определится вы можете указать devfsd автоматически
выполнить какую то команду. Ниже показаны примерные установки для пользователя YOU:
</p>

<pre caption="Редактируем /etc/devfsd.conf">
#configure USB  added by YOU!
REGISTER        ^usb            PERMISSIONS     0.0     0777
REGISTER        ^usb/tts        PERMISSIONS     0.0     0777
<comment>Эта команда для использования с jpilot для синхронизации</comment>
REGISTER        ^usb/tts/1      EXECUTE       /bin/su YOU -c &quot;/usr/bin/jpilot-sync&quot;
<comment>Эта командра для использования с coldsync для синхронизации</comment>
REGISTER       ^usb/tts/1       EXECUTE       /bin/su YOU -c /usr/local/bin/sync-coldsync &amp;
</pre>

<p>
Если вы используете coldsync для синхронизации, то можно создать маленький скрипт
 <path>/usr/local/bin/sync-coldsync</path> со следующим содержанием: 
</p>

<pre caption="/usr/local/bin/sync-coldsync">
#!/bin/sh

/usr/bin/coldsync -p /dev/usb/tts/ -mb $HOME/palmbackup
</pre>

<note>
Эта установка не доступна если вы синхронизируетесь через последовательный порт, потому как он всегда включён. USB определяет оборудование по другому чем последовательный порт.
</note>

<note>
Этот демон запускается с правами root. Заметьте что он использует su для изменения имени под которым ему надо синхронизироваться с Palm-pilot и для этого он не требует ввода пароля
</note>

</body>
</section>
</chapter>

<chapter>
<title>Окончательные заметки</title>
<section>
<title>Использованные материалы</title>
<body>

<p>
Дополнительная информация на английском языке:
</p>

<ul>
 <li>
  <uri
  link="http://www.linuxpda.com/visor/howto/current/t1.html">Handspring-Visor в Линуксе, mini-HOWTO</uri>
 </li>
 <li>
  <uri link="http://www.linux-usb.org/USB-guide/book1.html">Руководство по USB в Линуксе</uri>
 </li>
 <li>
  <uri link="http://www.zauruszone.com/howtos/lc_generic.shtml">Sharp Zaurus</uri> Сайт разработчиков
 </li>
</ul>

</body>
</section>
</chapter>
</guide>
