<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/gentoo-upgrading.xml,v 1.4 2012/04/18 18:30:37 swift Exp $ -->

<guide lang="ru">
<title>Руководство по обновлению Gentoo</title>

<author title="автор">
  <mail link="greg_g@gentoo.org">Gregorio Guidi</mail>
</author>
<author title="переводчик">
  <mail link="vnp@bayarea.net">vnp</mail>
</author>
<author title="переводчик">
  <mail link="mike.spacer">Михаил Ярмиш</mail>
</author>
<author title="переводчик">
  <mail link="achumakov@gentoo.org">Алексей Чумаков</mail>
</author>

<abstract>
В документе описывается, как новые выпуски Gentoo влияют на ранее
установленные системы.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.15</version>
<date>2005-12-19</date>

<chapter>
<title>Gentoo и обновления</title>
<section>
<title>Философия</title>
<body>

<p>
Здесь, на земле Gentoo, обновление понимается совсем не так, как во всем
остальном мире Linux. Вы, вероятно, уже знаете, что в наших дистрибутивах
мы никогда не следовали &laquo;классическому&raquo; способу обновления 
программ: дождаться нового релиза, скачать его, прожечь, засунуть диск в 
дисковод и, наконец, следовать установочным инструкциям.
</p>

<p>
Вы знаете (вы же не зря выбрали Gentoo), как такой процесс раздражает опытного
пользователя, стремящегося всегда быть на переднем крае. Учитывая популярность 
и распространенность инструментов типа apt или apt-rpm, облегчающих быстрые и 
частые обновления, мы полагаем, что и опытные пользователи других дистрибутивов 
испытывают те же чувства. Однако ни один дистрибутив не приспособлен для 
удовлетворения нужд требовательных пользователей лучше Gentoo, поскольку Gentoo 
с самого начала строился на идее быстрых последовательных обновлений.
</p>

<p>
В идеале, вы устанавливаете систему однажды, и более никогда не беспокоитесь о 
выпусках: просто следуйте инструкциям из <uri
link="/doc/ru/handbook/handbook-x86.xml?part=2&amp;chap=1">введения в
Portage</uri> в <uri link="/doc/ru/handbook/">настольной книге Gentoo</uri>,
где описывается, как поддерживать актуальность системы. Хотя обычно такого 
подхода достаточно, иногда в ядро системы вносятся изменения, требующее 
установки вручную.
</p>

</body>
</section>
<section>
<title>Выпуски и профили</title>
<body>

<p>
О процессе выпуска версий Gentoo постоянно задают вопрос: &laquo;Зачем нужно 
часто делать новые выпуски, если они не предназначены для обновления 
программ у пользователей?". Тому есть ряд причин:
</p>

<ul>
  <li>
    Новый выпуск &mdash; это новые исправленные и дополненные установочные 
    диски.
  </li>
  <li>
    Новый выпуск несет обновленный набор пакетов GRP, так что пользователи, 
    избираюшие &laquo;быстрый способ&raquo; установки (stage3 + заранее 
    скомпилированные пакеты), получают не устаревшую систему.
  </li>
  <li>
    Наконец, в новых выпусках время от времени реализуются функции,
    несовместимые с предыдущими выпусками. 
  </li>
</ul>

<p>
Если в выпуск входят возможности, несовместимые с предыдущими, или содержится
набор фундаментальных пакетов и установок, сильно меняющих поведение системы, 
мы говорим, что он задает новый <e>профиль</e>.
</p>

<p>
<e>Профиль</e> &mdash; это набор конфигурационных файлов, хранимый в 
подкаталоге <path>/usr/portage/profiles</path>, описывающий сценарии ebuild 
<e>системных</e> пакетов, флаги использования (USE) по умолчанию, отображение 
виртуальных пакетов по умолчанию, а также архитектуру, на которой запускается 
система.
</p>

<p>
Используемый профиль определяется символьной ссылкой 
<path>/etc/make.profile</path>, которая указывает на подкаталог в 
<path>/usr/portage/profiles</path>, содержащий файлы профиля. К примеру, 
профиль x86 2005.1 по умолчанию находится в 
<path>/usr/portage/profiles/default-linux/x86/2005.1</path>.
Файлы в родительских каталогах также входят в состав профиля (и, таким образом,
совместно используются различными подпрофилями). Поэтому мы называем такие 
профили <e>каскадными профилями</e>. 
</p>

<p>
Профили, устаревающие с появлением новых, хранятся в 
<path>/usr/portage/profiles</path> наравне с актуальными, но помечены как 
как нежелательные для использования. Для этого в каталог профиля помещается 
файл <path>deprecated</path>. Файл содержит имя профиля, на который 
рекомендуется обновиться. Portage использует эту информацию для 
автоматического предупреждения о необходимости перехода на новый профиль.
</p>

<p>
Существуют различные причины для создания нового профиля: выпуск новых 
несовместимых версий базовых пакетов (таких, как <c>baselayout</c>, <c>gcc</c>, 
или <c>glibc</c>), изменения в USE-флагах по умолчанию или отображении 
виртуальных пакетов, или, возможно, серьезные системные изменения.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Гонка за новыми выпусками</title>
<section>
<title>Выпуски без изменений в профиле</title>
<body>

<p>
Если объявлен новый выпуск Gentoo, в котором не появился новый профиль, то 
твердо можно притвориться, что вы его не заметили :).
</p>

<p>
Ваша система будет в точности соответствовать вновь установленной с нового
выпуска, если вы обновите установленные пакеты
<uri link="/doc/ru/handbook/handbook-x86.xml?part=2&amp;chap=1">согласно
описанию из Настольной книги Gentoo</uri>.
</p>

</body>
</section>
<section>
<title>Выпуски с изменениями в профиле</title>
<body>

<p>
Если в выпуске появился новый профиль (как, например, в 2005.1 для x86), у вас 
есть возможность на него перейти.
</p>

<p>
Естественно, вы не обязаны это делать, и можете продолжать пользоваться старым 
профилем, просто обновляя свои пакеты, <uri 
link="/doc/ru/handbook/handbook-x86.xml?part=2&amp;chap=1">как описано 
в Настольной книге Gentoo</uri>.
</p>

<p>
Однако, Gentoo крайне рекомендует обновлять профиль, если он объявляется 
нежелательным для использования. Когда такое происходит, это означает, что 
разработчики больше не планируют его поддерживать. В приведенной ниже таблице
можно быстро уточнить, какие профили поддерживаются в данный момент.
</p>

<p>
Переход на новый профиль придется осуществлять вручную. Необходимые действия
могут сильно отличаться от выпуска к выпуску, в зависимости от глубины
изменений, привносимых в новом профиле.
</p>

<p>
В простейшем случае, вам просто потребуется изменить символьную ссылку
<path>/etc/make.profile</path>, а в худшем &mdash; придется перекомпилировать 
всю систему, тем временем изображая танец вуду. Процесс перехода обычно 
описывается в замечаниях к выпуску. Кроме того, есть <uri  
link="#instructions">инструкции</uri> в конце данного руководства.
</p>

</body>
</section>
<section>
<title>Поддерживаемые профили</title>
<body>

<p>
Следующие профили официально поддерживаются разработчиками Gentoo:
</p>

<table>
<tr>
  <th>Архитектура</th>
  <th>Свежайшие профили</th>
  <th>Прочие поддерживаемые профили</th>
</tr>
<tr>
  <th>alpha</th>
  <ti>2005.0, 2005.0/2.4</ti>
  <ti></ti>
</tr>
<tr>
  <th>arm</th>
  <ti>2004.3</ti>
  <ti></ti>
</tr>
<tr>
  <th>amd64</th>
  <ti>2005.1, 2005.1/no-multilib</ti>
  <ti>2005.0, 2005.0/no-multilib, 2004.3</ti>
</tr>
<tr>
  <th>hppa</th>
  <ti>2005.0, 2005.0/2.4</ti>
  <ti>2004.3, 2004.2</ti>
</tr>
<tr>
  <th>ia64</th>
  <ti>2005.0</ti>
  <ti>2004.3</ti>
</tr>
<tr>
  <th>ppc</th>
  <ti>2005.1</ti>
  <ti>2005.0, 2004.3, 2004.0</ti>
</tr>
<tr>
  <th>mips</th>
  <ti>2005.0</ti>
  <ti>2004.2</ti>
</tr>
<tr>
  <th>s390</th>
  <ti>2004.3</ti>
  <ti></ti>
</tr>
<tr>
  <th>sparc</th>
  <ti>2005.1</ti>
  <ti>2005.0</ti>
</tr>
<tr>
  <th>x86</th>
  <ti>2005.1, 2005.1/2.4</ti>
  <ti>2005.0, 2005.0/2.4</ti>
</tr>
</table>

</body>
</section>
</chapter>

<chapter id="instructions">
<title>Инструкции по обновлению профиля</title>
<section>
<title>Переход на 2005.1</title>
<body>

<p>
Для переключения на профиль 2005.1 укажите символьной ссылкой
<path>/etc/make.profile</path> на новое место. Перед изменением профиля 
убедитесь, что Portage обновлена.
</p>

<pre caption="Переход на профиль 2005.1">
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/</i>&lt;selected profile&gt;<i> /etc/make.profile</i>
</pre>

<p>
<b>Все архитектуры</b> &mdash; в этом профиле нет фундаментальных изменений. 
Конкретных действий не требуется.
</p>

<p>
<b>ppc</b> &mdash; в выпуске 2005.1 профили ppc и ppc64 объединены, и созданы
различные подпрофили для конкретных архитектур. При переходе на профиль 2005.1 
убедитесь, что вы выбираете для своей системы верный подпрофиль.
</p>

</body>
</section>
<section>
<title>Переход на 2005.0</title>
<body>

<p>
С появлением 2005.0 в некоторые архитектуры было решено добавить дополнительные
профили. Если вы решили перейти на какой-либо из таких профилей &mdash;
не забудьте прежде прочитать его описание. Кроме того, теперь во многих
архитектурах по умолчанию используется дерево ядра 2.6 вместо ранее 
применявшегося 2.4.
</p>

<p>
В некоторых архитектурах теперь требуется больше шагов для смены профиля. В
этих случаях из таблицы можно перейти на соответствующие пошаговые руководства.
</p>

<table>
<tr>
  <th>Профиль</th>
  <th>Описание</th>
  <th>Специфическое руководство по обновлению</th>
</tr>
<tr>
  <ti>default-linux/alpha/2005.0</ti>
  <ti>Профиль Alpha 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/alpha/2005.0/2.4</ti>
  <ti>Профиль Alpha 2005.0 для ядер 2.4</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/amd64/2005.0</ti>
  <ti>Профиль AMD64 2005.0 по умолчанию для ядер 2.6</ti>
  <ti>
    <uri
    link="/proj/en/base/amd64/howtos/index.xml?part=1&amp;chap=1#doc_chap1">
    Обновление на 2005.0 (англ.)</uri>
  </ti>
</tr>
<tr>
  <ti>default-linux/amd64/2005.0/no-multilib</ti>
  <ti>Профиль AMD64 2005.0 для системы без многорежимных библиотек</ti>
  <ti>
    <uri link="/proj/en/base/amd64/howtos/index.xml?part=1&amp;chap=1#doc_chap5">
    Обновление на 2005.0 (англ.)</uri>
  </ti>
</tr>
<tr>
  <ti>default-linux/arm/2005.0</ti>
  <ti>Профиль ARM 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/hppa/2005.0</ti>
  <ti>Профиль HPPA 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/hppa/2005.0/2.4</ti>
  <ti>Профиль HPPA 2005.0 для ядер 2.4</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/2005.0</ti>
  <ti>Профиль MIPS 2005.0 по умолчанию</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/cobalt/2005.0</ti>
  <ti>Профиль MIPS 2005.0 для Cobalt</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/n32/2005.0</ti>
  <ti>Профиль 2005.0 для MIPS-платформ с поддержкой n32</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/ip28/2005.0</ti>
  <ti>64-битный профиль 2005.0 для Indigo2 Impact</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/mips/mips64/2005.0</ti>
  <ti>64-битный профиль MIPS 2005.0</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/ppc/2005.0</ti>
  <ti>Профиль PPC 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/ppc64/2005.0</ti>
  <ti>Профиль PPC64 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/s390/2005.0</ti>
  <ti>Профиль S390 2005.0 по умолчанию </ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/sparc/sparc32/2005.0</ti>
  <ti>32-битный профиль Sparc 2005.0 по умолчанию</ti>
  <ti></ti>
</tr>
<!-- http://dev.gentoo.org/~dsd/kernel-2.6.htm 
     No subprofiles for sparc
<tr>
  <ti>default-linux/sparc/sparc32/2005.0/2.6</ti>
  <ti>Sparc 32-bit 2005.0 profile for 2.6 kernels</ti>
  <ti></ti>
</tr>
-->
<tr>
  <ti>default-linux/sparc/sparc64/2005.0</ti>
  <ti>64-битный профиль Sparc 2005.0 по умолчанию</ti>
  <ti></ti>
</tr>
<!-- http://dev.gentoo.org/~dsd/kernel-2.6.htm
     No subprofiles for sparc
<tr>
  <ti>default-linux/sparc/sparc64/2005.0/2.6</ti>
  <ti>Sparc 64-bit 2005.0 profile for 2.6 kernels</ti>
  <ti></ti>
</tr>
-->
<tr>
  <ti>default-linux/x86/2005.0</ti>
  <ti>Профиль x86 2005.0 по умолчанию для ядер 2.6</ti>
  <ti></ti>
</tr>
<tr>
  <ti>default-linux/x86/2005.0/2.4</ti>
  <ti>Профиль x86 2005.0 для ядер 2.4</ti>
  <ti></ti>
</tr>
</table>

<p>
Для перехода на выбранный профиль необходимо сменить путь, на который указывает 
символьная ссылка <path>/etc/make.profile</path>, указав на новое место. Но 
перед этим не забудьте обновить Portage.
</p>

<pre caption="Переход на профиль 2005.0">
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/</i>&lt;selected profile&gt;<i> /etc/make.profile</i>
</pre>

<p>
Если у вас система с ядром 2.4, но вы хотите перейти на ядро 2.6 &mdash; не 
забудьте прочитать <uri link="/doc/en/migration-to-2.6.xml">Руководство по 
переходу на Gentoo Linux 2.6 (англ.)</uri>.
</p>

</body>
</section>
<section>
<title>Переход на 2004.3</title>
<body>

<p>
С появлением профилей 2004.3 особых изменений системы не произошло (подробности
&mdash; ниже). Однако разработчики Gentoo все же решили выпустить его,
прекратив поддержку некоторых старых, для ускорения принятия <e>каскадных
профилей</e>, то есть профилей, следующих новой структуре каталога  
<path>/usr/portage/profiles</path>, например, 
<path>/usr/portage/profiles/default-linux/x86/2004.3</path> (поддерживается
Portage начиная с версии 2.0.51).
</p>

<p>
Для перехода на профиль 2004.3, укажите на новое место символьной
ссылкой <path>/etc/make.profile</path>:
</p>

<warn>
Не забудьте обновить Portage <e>перед</e> сменой профиля!!!
</warn>

<pre caption="Обновление символьной ссылки /etc/make.profile">
<comment>замените &lt;arch&gt; на свою архитектуру</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-linux/&lt;arch&gt;/2004.3 /etc/make.profile</i>
</pre>

<p>
<b>Все архитектуры</b> &mdash; Как сказанно выше, в этом профиле не введены 
серьезные изменения. Однако, следует отметить, что <c>sys-apps/slocate</c> и 
<c>net-misc/dhcpcd</c> перестали считаться системными пакетами. Это значит, что 
при запуске <c>emerge --depclean</c> Portage попытается удалить их из системы. 
Если же вам они нужны, после смены профиля добавьте их в 
<path>/var/lib/portage/world</path>, или установите вручную.
</p>

<p>
<b>ppc</b> &mdash; теперь на новые системы по умолчанию устанавливается 
<c>sys-fs/udev</c> вместо <c>sys-fs/devfs</c>. При этом в ранее установленных 
ничего не меняется.
</p>

</body>
</section>
<section>
<title>Обновление Portage для поддержки каскадных профилей</title>
<body>

<p>
Хотя этот раздел не слишком вписывается в такое руководство по обновлению, он 
достаточно важен. Для каждого профиля, упомянутого выше, требуется версия 
Portage, поддерживающая каскадные профили. Однако, некоторые устаревшие 
профили не позволяют обновить Portage, и при использовании профиля, который 
больше не доступен, любая попытка обновления Portage приведет к неудаче.
</p>

<p>
Чтобы обойти эту проблему, можно установить временную символьную ссылку на 
<e>устаревший</e> профиль, позволяющую обновить Portage, после чего можно 
продолжать процедуру перехода, изложенную в этом руководстве. Пожалуйста, 
вместо <c>&lt;arch&gt;</c> указывайте название своей архитектуры:
</p>

<pre caption="Обновление Portage при устаревшем профиле">
# <i>rm /etc/make.profile</i>
# <i>cd /etc</i>
# <i>ln -sf ../usr/portage/profiles/obsolete/&lt;arch&gt; make.profile</i>
# <i>emerge -n '>=sys-apps/portage-2.0.51'</i>
</pre>

</body>
</section>
<section>
<title>Переход на 2004.2</title>
<body>

<p>
Для переключения на профиль 2004.2, смените путь, на который указывает 
символьная ссылка <path>/etc/make.profile</path>, на новый:
</p>

<warn>
Не забудьте обновить Portage <e>перед</e> сменой профиля!!!
</warn>

<pre caption="Обновление символьной ссылки /etc/make.profile">
<comment>замените &lt;arch&gt; на свою архитектуру</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-linux/&lt;arch&gt;/2004.2 /etc/make.profile</i>
</pre>

<p>
<b>x86</b> &mdash; В этом профиле реализация X11 по умолчанию изменяется с
<c>x11-base/xfree</c> на <c>x11-base/xorg-x11</c>. Это влияет только на 
значение по умолчанию, и касается только тех, кто еще не установил X сервер.
Если в системе он уже установлен, это вас вообще не затронет; как и раньше, по 
желанию, вы можете сменять один на другой.
</p>

<p>
<b>amd64</b> &mdash; фундаментальные изменения отсутствуют, и конкретных 
действий не требуется.
</p>

</body>
</section>
<section>
<title>Переход на 2004.0</title>
<body>

<p>
Для переключения на профиль 2004.0, смените путь, на который указывает 
символьная ссылка <path>/etc/make.profile</path>, на новый:
</p>

<pre caption="Обновление символьной ссылки /etc/make.profile">
<comment>замените &lt;arch&gt; на свою архитектуру</comment>
# <i>rm /etc/make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-&lt;arch&gt;-2004.0 /etc/make.profile</i>
</pre>

<p>
<b>Все архитектуры</b> &mdash;  &mdash; фундаментальные изменения отсутствуют, 
и конкретных действий не требуется.
</p>

</body>
</section>
<section>
<title>Переход на 1.4 c более старых профилей</title>
<body>

<p>
Инструкции для подобного обновления достаточно сложны, и находятся
<uri link="/doc/ru/new-upgrade-to-gentoo-1.4.xml">здесь</uri>.
</p>

</body>
</section>
</chapter>

</guide>

<!-- *$Localization:
target-language: Russian
target-version: 2.15-r1
target-date: 2006-01-28
source-cvs-revision: 1.27
translated-by: vnp, Alexey Chumakov, Mikhail Yarmish [mike.spacer@gmail.com]
edited-by: Alexey Chumakov [achumakov@gentoo.org]
-->
