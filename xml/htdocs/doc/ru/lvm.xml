<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet href="/xsl/guide.xsl" type="text/xsl"?>
<guide link = "/doc/en/lvm.xml">
<!-- Revision 1.7 -->
<title>Установка LVM на Gentoo</title>
<author title="Author"><mail link="avi@CFFtechnologies.com">Avi Schwartz</mail></author>
<author title="Contributor"><mail link="rajiv@gentoo.org">Rajiv Manglani</mail></author>
<author title="Переводчик"><mail link="dzaletov@rambler.ru">Денис Залетов</mail></author>
<author title="Редактор перевода"><mail link="julia_magenta@hotmail.com">Юлия Залетова</mail></author>

<abstract>В данном руководстве я описываю, как поставил Gentoo на свою машину с использованием Логического Менеджера Томов (LVM). Хотя все примеры происходят из моей конкретной инсталляции, это может послужить начальной точкой отсчета для вашей собственной установки.</abstract>

<version>1.0.1</version>
<date>10 Apr 2003</date>

<license/>

<chapter>
	<title>Введение</title>
	<body>
		<p>Данное руководство описывает мой опыт установки Gentoo, с использованием Логического Менеджера Томов (LVM). Это подразумевает, что вы, вероятно, должны изменить имя диска, имена и размеры разделов, таким образом, что бы они соответствовали вашим собственным нуждам.</p>

		<impo>Этот документ не является учебным пособием по LVM. Он служит подспорьем основному документу по установке Gentoo и ссылается на шаги в инсталляционном руководстве. Убедитесь в том, что вы прочитали руководство по установке Gentoo <b>перед</b> тем, как начать вашу установку.</impo>

		<note>Полное руководство по LVM (HOWTO), находится по адресу <uri>http://tldp.org/HOWTO/LVM-HOWTO</uri>/</note>
	</body>

	<section>
		<title>Разделы</title>
		<body>
			<p>У меня стоят два диска SCSI, каждый размером по 36 GB и третий диск IDE, размером в 100 GB. В данном примере я не использую диск IDE из-за того, что запланировал перенести данные с него на LVM, перед тем как переформатировать и добавить в группу томов.</p>

			<p>Имена разделов на моей системе:</p>

			<ul>
				<li>/dev/sda1  --  /boot</li>
				<li>/dev/sda2  --  /</li>
				<li>/dev/sda3  --  Будет использован с LVM</li>
				<li>/dev/sdb1  --  Будет использован с LVM</li>
			</ul>

			<p>Итак, пора начинать...</p>
		</body>
	</section>
</chapter>

<chapter>
		<title>Установка</title>
<body>
<ol>
 <p><li>Выполните шаги с первого по пятый, руководства по установке.</li></p>

 <p><li>Шаги с третьего по девятый этого документа, заменяют шестой шаг (установка разделов) руководства по установке.</li></p>

 <p><li>Создайте небольшой физический раздел для /boot. В данном примере, /boot не будет управляться при помощи LVM. Этот раздел должен содержать ваше загрузочное ядро и Grub. Я создал раздел в 100Mb, этого вполне достаточно для нескольких поколений ядер.</li></p>

 <p><li>Создайте корневой раздел - / (root). Если вам интересно попробовать поместить ваш корневой раздел под управление LVM, обратите внимание на секцию ресурсов в конце данного документа, там размещена ссылка на документ (mini-howto), в котором объясняется, как это сделать. Размер корневого раздела не должен быть большим, если вы планируете разместить разделы /opt, /usr, /home, /var и /tmp в группе томов LVM.

		<note>
		Я так же рекомендую НЕ помещать следующие директории на раздел LVM:
		<ul>
			<li>/etc</li>
			<li>/lib</li>
			<li>/mnt</li>
    			<li>/proc</li>
			<li>/sbin</li>
			<li>/dev</li>
			<li>/root</li>
		</ul>

    		<p>В таком случае, вы сможете войти в свою систему (неполноценно, но все же имея некоторую функциональность из под пользователя root), если произойдет что-то ужасное.</p>
    	</note>
 </li></p>

 <p><li>При условии, что раздел /boot и корневой раздел, не заняли все место на физическом диске, создайте третий раздел на этом диске и присвойте ему тип 8e (Linux LVM). Если у вас есть несколько физических дисков, которые вы хотите задействовать под LVM, создайте на каждом из них по разделу и присвойте им тот же тип (8e).
    	<note>Вы так же можете подготовить целый диск, вместо раздела.</note>
 </li></p>

 <p><li>Подготовьте разделы.

<pre>
pvcreate /dev/sda3
pvcreate /dev/sdb1
</pre>
 </li></p>

 <p><li>Установите группу томов.
    	<impo>Программа vgcreate не распознает ссылки, которые указывают на физические разделы, поэтому используйте

<pre>
ls -l /dev/hd* и/или /dev/sd*
</pre>

    		для того что бы найти фактические устройства.</impo>

    	<p>В моем случае, устройства /dev/sda1 и /dev/sda2, принадлежат разделу /boot и корневому разделу, соответственно меня интересуют только устройства /dev/sda3 и /dev/sdb1. /dev/sda3 указывает на /dev/scsi/host1/bus0/target0/lun0/part3, а /dev/sdb1 указывает на /dev/scsi/host1/bus0/target1/lun0/part1. Следовательно, я запускаю vgcreate следующим образом:</p>

<pre>
vgcreate vg /dev/scsi/host1/bus0/target0/lun0/part3 \
            /dev/scsi/host1/bus0/target1/lun0/part1
</pre>
 </li></p>

 <p><li>Создайте логические тома. Логические тома эквивалентны разделам, которые вы создаете, используя fdisk в среде без LVM. В моем примере, я создаю следующие разделы:

    	<table>
    	<tr>
		<th>Директория</th>
		<th>Размер</th>
    	</tr>
    	<tr>
		<ti>/usr</ti><ti>10 GB</ti>
    	</tr>
    	<tr>
		<ti>/home</ti><ti>5 GB</ti>
    	</tr>
    	<tr>
		<ti>/opt</ti><ti>5 GB</ti>
    	</tr>
    	<tr>
        	<ti>/var</ti><ti>10 GB</ti>
    	</tr>
    	<tr>
		<ti>/tmp</ti><ti>2 GB</ti>
    	</tr>
    	</table>

    	<p>С тех пор, как я перешел на использование LVM, я не слишком волнуюсь о размере разделов, т.к. всегда могу распределить пространство по своему усмотрению.</p>

    	<note>Terje Kvernes верно заметил, что увеличить размер раздела легче, чем уменьшить его. Таким образом, вы можете захотеть начать с небольших разделов, увеличивая их при необходимости.</note>

    	<note>Я так же создал раздел swap на LVM. Возможно вам не стоит использовать LVM для swap раздела, но я почувствовал, что должен попробовать это :-)</note>

<pre>
lvcreate -L10G -nusr vg
lvcreate -L5G -nhome vg
...
lvcreate -L2G -ntmp vg
</pre>
 </li></p>

 <p><li>Форматирование логических томов аналогично форматированию обычных разделов:
    
    	<p>Сначала позаботимся о логическом томе для swap:</p>
<pre>
    mkswap /dev/vg/swap
</pre>

    	<p>Я использую ext3 на всех логических томах:</p>

<pre>
    mke2fs -j /dev/vg/usr
    ...
</pre>

    	<note>Остальная часть руководства по инсталляции остается неизменной, поэтому я не буду повторять этот документ здесь целиком, за исключением указания на различия.</note>
 </li></p>

 <p><li>Следуя шагу 7 (Монтирование разделов) руководства по инсталляции, замените /dev/hdxx на /dev/vg/partition_name (за исключением конечно, разделов boot и /, т.к. мы не включали их в LVM).</li></p>

 <p><li>Шаг 14 (Последние шаги: ядро и система журналирования) - Убедитесь в том, что ваше ядро поддерживает LVM. Вы можете найти эту опцию в пункте меню:

    	<p>Multi-device support (RAID and LVM)</p>

    	<p>так же, не забудьте выполнить emerge пакета lvm-user.</p>
 </li></p>

 <p><li>Шаг 16 (Последние шаги: /etc/fstab) - Добавьте ваши LVM разделы в /etc/fstab, как требуется. Опять же, привожу несколько строк с моей машины:

<pre>
/dev/sda1   /boot   ext3    noauto,noatime 1 1
/dev/sda2   /       ext3    noatime        0 0
/dev/vg/opt /opt    ext3    noatime        0 0
/dev/vg/usr /usr    ext3    noatime        0 0
...
</pre>

    	<p>Если вы сконфигурировали LVM как модуль в процессе настройки ядра, то добавьте в ваш /etc/modules.autoload следующую строку</p>

<pre>
lvm-mod
</pre>
 </li></p>

 <p><li>Шаг 17 (Установка завершена!) - Не забудьте размонтировать все ваши разделы LVM и, в качестве хорошей меры, запустите следующую команду, перед тем как перезагрузиться:

<pre>
vgchange -an
</pre>
 </li></p>

 <p><li>Перезагрузите вашу машину, но будьте готовы к тому, что процесс загрузки вероятно выдаст вам множество сообщений об ошибках, из-за того, что скрипт localmount не сможет распознать факт использования LVM. После входа в систему, выполните следующую команду:

<pre>
/sbin/vgscan
</pre>

	Она должна сгенерировать файл /etc/lvmtab, который будет использоваться скриптом checkfs для проверки необходимости запуска LVM. Перезагрузите ваш компьютер, и теперь все разделы должны быть смонтированы и видны.</li></p>
</ol>
</body>
</chapter>

<chapter>
	<title>Ресурсы</title>
	<body>
		<p>Документ по LVM (Howto):
		<uri>http://tldp.org/HOWTO/LVM-HOWTO</uri></p>
		<p>Статьи Daniel Robbins' про LVM на сервере IBM's DeveloperWorks:
		<uri>http://www-106.ibm.com/developerworks/linux/library/l-lvm/?dwzone=linux</uri>
		<uri>http://www-106.ibm.com/developerworks/linux/library/l-lvm2.html?dwzone=linux</uri></p>
		<p>Как разместить файловую систему корневого раздела в LVM:
		<uri>http://www.the-infinite.org/archive/docs/lvm/howto-boot-off-root-lv.txt</uri></p>
</body>
</chapter>

<chapter>
	<title>Благодарности</title>
	<body>
		Я хотел бы поблагодарить <mail link="bangert@gentoo.org">Thilo Bangert</mail> и <mail link="terjekv@math.uio.no">Terje Kvernes</mail> за их поддержку и комментарии относительно данного документа.
	</body>
</chapter>
</guide>
