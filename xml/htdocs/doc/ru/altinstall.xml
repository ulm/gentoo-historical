<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/altinstall.xml,v 1.10 2006/04/01 20:03:27 achumakov Exp $ -->

<guide link="/doc/ru/altinstall.xml" lang="ru" disclaimer="draft">

<title>Описание альтернативных способов установки Gentoo Linux</title>

<author title="участник">
  <mail link="gerrynjr@gentoo.org">Gerald Normandin Jr.</mail>
</author>
<author title="участник">
  <mail link="lordviram@rebelpacket.net">Travis Tilley</mail>
</author>
<author title="участник">
  <mail link="volontir@yahoo.com">Oleg Raisky</mail>
</author>
<author title="участник">
  <mail link="luminousit@hotmail.com">Alex Garbutt</mail>
</author>
<author title="участник">
  <mail link="alex@openvs.com">Alexandre Georges</mail>
</author>
<author title="участник">
  <mail link="vargen@b0d.org">Magnus Backanda</mail>
</author>
<author title="участник">
  <mail link="davoid@gentoo.org">Faust A. Tanasescu</mail>
</author>
<author title="участник">
  <mail link="aliz@gentoo.org">Daniel Ahlberg</mail>
</author>
<author title="редактор">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="рецензент">
  Ken Nowack <!-- antifa@gentoo.org seems out -->
</author>
<author title="редактор">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="редактор">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="редактор">
  <mail link="smithj@gentoo.org">Jonathan Smith</mail>
</author>
<author title="переводчик">
  <mail link="kansas@pochta.ru">Александр Д. Баракин</mail>
</author>

<abstract>
Это описание &mdash; сборник альтернативных способов установки Gentoo
в особых случаях, например, при невозможности загрузиться с компакт-диска, 
или при отсутствии привода cd-rom. 
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>0.65</version>
<date>2005-08-07</date>

<chapter>
<title>Об этом документе</title>
<section>
<body>

<p>
Если у вас не работает стандартный метод установки boot-from-CD (или он вас не 
устраивает), вам сюда. Этот документ описывает альтернативные приемы установки 
Gentoo Linux для тех, кто в них нуждается. Или, если хотите, это место сбора 
всех "оригинальных" способов установки. Если у вас один такой завалялся, или вы 
откопали новую прикольную методу, не стесняйтесь, написать запрос в <uri 
link="http://bugs.gentoo.org">Bugzilla</uri>. 
</p>

</body>
</section>
</chapter>

<chapter>
<title>Загрузка с установочного диска при помощи Smart BootManager</title>
<section>
<body>

<p>
Скачайте Smart BootManager с 
<uri>http://btmgr.sourceforge.net/download.html</uri>. 
Доступны как исходники, так и бинарники для Linux, не говоря уже про виндовский 
.exe и множество языковых пакетов. Все-таки, в настоящее время, бинарный формат 
предпочтительнее, поскольку исходники могут не откомпилироваться современными
версиями NASM.
</p> 

<p>
Скомпилируйте пакет или возьмите уже готовый. Ниже я расскажу о некоторых 
полезных опциях, доступных при создании загрузочной дискеты.
</p>

<pre caption="Опции Smart BootManager">
sbminst [-t theme] [-d drv] [-b backup_file] [-u backup_file]

   -t тема      выбор используемой темы, где тема должна быть:
                   us = English тема       de = German тема 
                   hu = Hungarian тема     zh = Chinese тема 
                   ru = Russian тема       cz = Czech тема
                   es = Spanish тема       fr = French тема 
                   pt = Portuguese тема 

                 
   -d диск      выбор диска, куда вы собираетесь инсталлировать Smart BootManager;
                 для Linux:
                   /dev/fd0 первый floppy-диск, 
                   /dev/hda первый IDE-диск.
                   /dev/sda первый SCSI-диск.
                 для DOS:
                    0   первый floppy-диск
                    128 первый жесткий диск;

   -c           отключить загрузку с CD-ROM;

   -b backup_file сохранить (для будущей деинсталляции) данные, которые будут
                  перезаписаны;

   -u backup_file деинсталлировать Smart BootManager, нельзя использовать
                  с другими ключами;

   -y             никаких вопросов и предупреждений.
</pre>

<pre caption="Использование sbminst для создания загрузочной дискеты">
# <i>sbminst -t us  -d /dev/fd0</i>
</pre>

<note>
Замените fd0 на имя вашего floppy-дисковода (если у вас он называется 
по-другому).
</note>

<p>
Теперь просто вставьте дискету в дисковод компьютера, на котором вы хотите 
запустить установочный диск, и загрузитесь с нее. 
</p>

<p>
Вас поприветствует Smart BootManager. Выберите CD-ROM и нажмите ENTER для 
загрузки установочного диска. Если все прошло удачно, следуйте стандартной 
процедуре установки. 
</p>

<p>
Больше информации по Smart BootManager вы найдете на 
<uri>http://btmgr.sourceforge.net/</uri>
</p> 

</body>
</section>
</chapter>

<chapter>
<title>Установка при помощи Knoppix</title>
<section>
<body>

<note>
Knoppix доступен только для пользователей x86.
</note>

<!-- this works with knoppix 3.6+ and gentoo 2004.3, 2005.0-->

<p>
Загрузившись с <uri link="http://www.knoppix.org/">Knoppix</uri> LiveCD, вы 
получаете полностью работоспособную систему для компиляции Gentoo. Во время 
сборки Tux Racer скрасит ваше ожидание, а для работы вы можете пользоваться 
OpenOffice.
</p>

<warn>
Помните, что если вы что-либо сохраните в домашний каталог Knoppix, ожидая 
установки своей системы Gentoo, вы потеряете это после перезагрузки в Gentoo. 
Убедитесь, что сохраняете важные файлы на жесткий диск или на другой компьютер!
</warn>

<p>
Загрузитесь с Knoppix CD. Если у вас Knoppix 3.6-3.8.2, потребуется указать 
<c>knoppix26</c> в качестве параметра ядра, чтобы загрузить ядро 2.6. 
Если вы пропустите этот шаг, то при <c>chroot</c> вы получите сообщение об 
ошибке, что ваше ядро слишком старое. Однако, если у вас Knoppix 3.9+, этот шаг 
не потребуется, так как ядро 2.6 выбрано по умолчанию.
</p>

<p>
По умолчанию вы попадаете на рабочий стол KDE. Откройте консоль и введите 
<c>su -</c>, чтобы была возможность изменить пароль. Это позволяет задать 
пароль для root в Knoppix. Теперь, при желании, можете настроить <c>sshd</c> 
для удаленного входа в систему.
</p>

<pre caption="Создание точки монтирования /mnt/gentoo">
# <i>mkdir /mnt/gentoo</i>
</pre>

<p>
Далее вы можете придерживаться стандартного руководства по установке, начиная с 
<uri link="/doc/ru/handbook/handbook-x86.xml?part=1&amp;chap=4">части 4</uri>. 
Кроме монтирования /proc. Тут вам надо поступить по-другому:
</p> 

<pre caption = "Монтирование с привязкой псевдо-ФС proc">
# <i>mount -o bind /proc /mnt/gentoo/proc</i>
</pre>

<p>
Также знайте, что некоторые возможности (FEATURES) портежей не будут работать в 
knoppix. Будьте особенно осторожны с <c>userpriv</c> и <c>usersandbox</c>.
Если вы обнаружили, что начали получать ошибки, будет разумным отключить все 
или некоторые необязательные возможности.
</p>

<!--
Commenting out due to #78716. If it needs to be restated again, note
that some will require to bind-mount it, others don't, and that you have
a 50-50 chance of winning the gold strike.

<p>
Вам также потребуется выполнение монтирования с привязкой (bind-mounting) 
дерева устройств для разрешения проблем с правами на различные файлы устройств. 
</p>

< ! - -
  Если это не сработает, в #71901 упоминается выполнение следующей команды:
    mount -o remount,rw,nosuid /dev/hd* /mnt/hd*
  перед всем. Для меня странно, но если это не работает, почему бы и не 
  попытаться?
- - >

<pre caption="Монтирование с привязкой дерева устройств">
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>
-->

</body>
</section>
</chapter>

<chapter>
<title>Установка со Stage 1 без доступа в сеть</title>
<section>
<body>


<p>
Создайте установочный компакт-диск из iso-образа.
</p>

<p>
Возьмите последний snapshot портежей из 
<uri>http://distro.ibiblio.org/pub/linux/distributions/gentoo/snapshots/</uri> 
(или с любимого <uri 
link="/main/ru/mirrors.xml">зеркала</uri>). Запишите этот 
tarball на существующий раздел в компьютере, где будет проходить установка, или 
прожгите его на CD.
</p> 

<p>
Следуйте инструкции из Gentoo Install Doc вплоть до <c>chroot /mnt/gentoo</c> 
в главе 6. Если у вас в наличии только один привод CD-ROM, не забудьте 
при загрузке ввести опцию <c>docache</c> чтобы иметь возможность размонтировать 
установочный компакт-диск и смонтировать CD со snapshot-ом портежей.
</p> 

<p>
Открыв новую консоль (Alt-F2), а в ней руководство по установке, мы можем 
следовать ему вплоть до запуска скрипта bootstrap.sh.
</p> 

<warn>
В старых выпусках установочного компакт-диска требуется изменить пароль 
командой <c>passwd</c> прежде чем логиниться с другой консоли.
</warn> 

<p>
Возвращаемся к первой консоли (Alt-F1, without chroot) и монтируем второй CD в 
<path>/mnt/gentoo/mnt/cdrom2</path>. Копируем portage tarball с cdrom2 и 
распаковываем в <path>/mnt/gentoo/usr</path>.
</p> 

<pre caption="Монтирование snapshot cd">
# <i>umount /mnt/cdrom</i>
# <i>mkdir /mnt/gentoo/mnt/cdrom2</i>
# <i>mount /dev/cdroms/cdrom0 /mnt/gentoo/mnt/cdrom2</i>
# <i>cp /mnt/gentoo/mnt/cdrom2/portage-$date.tar.bz2 /mnt/gentoo/usr</i>
# <i>cd /mnt/gentoo/usr</i>
# <i>tar -xvjpf portage-$date.tar.bz2</i>
</pre>

<p>
Снова переключаемся на вторую консоль. Если сейчас попытаться запустить 
bootstrap.sh, ничего не выйдет, так как он не сможет закачать ни одного файла. 
Мы получим эти файлы из другого места и разместим их в 
<path>/usr/portage/distfiles</path> (в консоли F2).
</p>

<p>
Нам необходим список пакетов Stage1: glibc, baselayout, texinfo, gettext, zlib, 
binutils, gcc, ncurses плюс их зависимости.
</p> 

<note>
Не забываете, что вам нужны версии пакетов, синхронизированные с вашим деревом 
портежей.
</note>

<pre caption="Получение списка для скачивания">
<comment>(Не забывайте 2 перед &gt;)</comment>
# <i>emerge -fp glibc baselayout texinfo gettext zlib binutils gcc ncurses 2&gt; stage1.list</i>
# <i>mount -t vfat /dev/fd0 /mnt/floppy</i>
# <i>cp /mnt/gentoo/stage1.list /mnt/floppy</i>
# <i>umount /mnt/floppy</i>
</pre>

<p>
Вставьте дискету в компьютер с хорошим каналом. Если заглянуть в файл
<path>stage1.list</path>, можно увидеть, что в нем перечисляются несколько
ссылок на каждую загрузку. К сожалению, это не совсем то, что нам надо.
Сначала список надо почистить от лишнего:
</p>

<pre caption="Stripping URLs">
<comment>(Этот скрипт привязан к формату вывода emerge, который может измениться
 без предварительного предупреждения - используйте с осторожностью!)</comment>
# <i>cut -f 1 -d ' ' stage1.list > stage1.download</i>
</pre>

<p>
Теперь используйте <c>wget</c> для загрузки списка исходников:
</p>

<pre caption="Загружаем пакеты с помощью wget">
# <i>wget -N -i stage1.download</i>
</pre>

<p>
Получив все файлы, переносим их в наш компьютер в 
<path>/mnt/gentoo/usr/portage/distfiles</path>. Вот теперь можно запускать 
<c>bootstrap.sh</c>. Повторяем ту же операцию с wget для stage2 и 3.
</p> 

</body>
</section>
</chapter>

<chapter>
<title>Бездисковая установка с загрузкой через PXE</title>
<section>
<title>Что необходимо</title>
<body>

<p>
Нужна сетевая карта на бездисковом клиенте, которая способна загружаться по 
протоколу PXE (многие карточки 3com). BIOS тоже должен поддерживать такой 
способ загрузки.
</p> 

</body>
</section>
<section>
<title>Настройки на стороне сервера</title>
<body>

<p>
Создание папок: Во-первых, следует создать папки, в которых будет размещена 
ваша бездисковая система. Начнем с <path>/diskless</path>, в ней будет 
находиться по отдельной папке для каждого бездискового клиента. Дальше мы 
рассмотрим работу с клиентом 'eta'.
</p> 

<pre caption="создание папок">
# <i>mkdir /diskless</i>
# <i>mkdir /diskless/eta</i>
# <i>mkdir /diskless/eta/boot</i>
</pre>

<p>
Настройка DHCP и TFTP: Клиент получает загрузочную информацию, используя DHCP, 
затем загружает необходимые файлы с помощью TFTP. Собираем DHCP командой emerge 
и настраиваем его для наших нужд. Добавляем следующее в 
<path>/etc/dhcp/dhcpd.conf</path>:
</p> 

<note>
Мы получим статический IP для клиента и путь к загрузочному образу PXE, здесь 
pxegrub. Вам необходимо подставить соответствующий MAC-адрес сетевой карты 
вашего клиента и определиться с директорией, где будут храниться клиентские 
файлы.
</note>

<p>
Для DHCPd, запустите <c>emerge dhcp</c> (или любой другой сервер DHCP на свое 
усмотрение). Убедитесь, что в <path>/etc/conf.d/dhcp</path> выбран верный 
интерфейс.
</p>

<pre caption="dhcp.conf">
option option-150 code 150 = text ;
ddns-update-style none ;
host eta {
hardware ethernet 00:00:00:00:00:00;
fixed-address <i>ip.add.re.ss</i>;
option option-150 "/eta/boot/grub.lst";
filename "/eta/boot/pxegrub";
}
</pre>

<p>
Для установки TFTP, соберите <c>app-admin/tftp-hpa</c>. Впишите следующее в 
<path>/etc/conf.d/in.tftpd</path>:
</p>

<pre caption="in.tftpd">
INTFTPD_PATH="/diskless"
INTFTPD_USER="nobody"
INTFTPD_OPTS="-u ${INTFTPD_USER} -l -vvvvvv -p -c -s ${INTFTPD_PATH}"
</pre>

<p>
Настройка GRUB: Я использую GRUB для PXE-загрузки. Чтобы можно было 
использовать PXE, вы должны самостоятельно скомпилировать GRUB ... ведь это 
просто. Во-первых, скачайте самую свежую версию исходников GRUB (<c>emerge -f 
grub</c> поместит tarball в <path>/usr/portage/distfiles</path>). Скопируйте 
tarball в <path>/diskless</path> и скомпилируйте GRUB, чтобы получить доступный 
для pxe бинарник. Готовый бинарник копируем в boot-папку бездискового клиента. 
И редактируем файл grub.lst: 
</p>

<pre caption="установка grub">
# <i>tar zxvf grub-0.92.tar.gz</i>
# <i>cd grub-0.92</i>
# <i>./configure --help</i>
<comment>(Среди опций вы увидите список поддерживаемых драйверов сетевых интерфейсов.)</comment>
<comment>(Выберите драйвер, совместимый с вашей картой. Здесь он фигурирует как $nic)</comment>
# <i>./configure --enable-diskless --enable-$nic</i>
# <i>make</i>
# <i>cd stage2</i>
# <i>cp pxegrub /diskless/eta/boot/pxegrub</i>
# <i>nano -w /diskless/eta/boot/grub.lst</i>
</pre>

<pre caption="grub.lst">
default 0
timeout 30

title=Diskless Gentoo
root (nd)
kernel /eta/bzImage ip=dhcp root=/dev/nfs nfsroot=<i>ip.add.re.ss</i>:/diskless/eta

<comment>(В опции nfsroot указывается IP адрес сервера и путь к директории,)</comment>
<comment>(в которой на сервере лежат файлы нашего бездискового клиента.)</comment>
</pre>

<p>
Настройка NFS: NFS легко сконфигурировать. Все что нам надо - это добавить одну 
строку в конфигурационный файл <path>/etc/exports</path>:
</p>

<pre caption="/etc/exports">
# <i>nano -w /etc/exports</i>
# /etc/exports: NFS file systems being exported.  See exports(5).
/diskless/eta eta(rw,sync,no_root_squash)
</pre>

<p>
Обновление hosts: Еще одно важное дело - изменение файла 
<path>/etc/hosts</path>.
</p>

<pre caption="/etc/hosts">
127.0.0.1 localhost

192.168.1.10 eta.example.com eta
192.168.1.20 sigma.example.com sigma
</pre>

</body>
</section>
<section>
<title>Создание системы на сервере</title>
<body>

<p>
Вы можете захотеть перезагрузить сервер с установочного диска Gentoo, хотя 
точно так же можете немедленно продолжить, если знать, как выполнять инструкции 
по установке Gentoo на установленной системе. Следуйте стандартной процедуре 
установки, как описано в Gentoo Install Howto, НО с учетом следующих отличий:
Для монтирования файловой системы сделайте следующее (здесь hdaX - раздел, в 
котором создана папка /diskless). Вам не надо монтировать другие разделы, так 
как все файлы располагаются в <path>/diskless/eta</path>.
</p>

<pre caption="монтирование файловой системы">
#<i> mount /dev/hdaX /mnt/gentoo</i>
</pre>

<p>
Stage tarballs и chroot: Этот пример использует tarball stage3. Смонтируйте 
<path>/proc</path> в вашу бездисковую директорию и выполните chroot в 
нее(директорию) для продолжения установки. Дальше - по инструкции вплоть до 
конфигурации ядра.
</p> 

<warn>
Будьте очень внимательны при разархивировании stage tarball. Не распакуйте
его в существующую систему.
</warn>

<pre caption="извлечение stage tarball">
# <i>cd /mnt/gentoo/diskless/eta/</i>
# <i>tar -xvjpf  /mnt/cdrom/gentoo/stage3-*.tar.bz2</i>
# <i>mount -t proc /proc /mnt/gentoo/diskless/eta/proc</i>
# <i>cp /etc/resolv.conf /mnt/gentoo/diskless/eta/etc/resolv.conf</i>
# <i>chroot /mnt/gentoo/diskless/eta/ /bin/bash</i>
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

<p>
Конфигурация ядра: При выполнении <c>make menuconfig</c> во время конфигурации 
ядра, не забудьте сделать доступными следующие опции (помимо рекомендуемых в 
руководстве по установке):
</p> 

<pre caption="опции menuconfig">
- Your network card device support
<comment>(в ядре, *не* как модуль!)</comment>

- Under "Networking options" :

[*] TCP/IP networking
[*] IP: kernel level autoconfiguration
[*] IP: DHCP support
[*] IP: BOOTP support


- Under "File systems --> Network File Systems" :

&lt;*&gt; NFS file system support
[*] Provide NFSv3 client support
[*] Root file system on NFS
</pre>

<p>
Сохраните ядро в <path>/</path> своей изолированной среды (не в 
<path>/boot</path>), в соответствии с настройкой pxegrub, определенной ранее.
Затем настройте <path>/etc/fstab</path> своего бездискового клиента.
</p>

<pre caption="/etc/fstab">
# <i>nano -w /etc/fstab</i>
/dev/cdroms/cdrom0 /mnt/cdrom iso9660 noauto,ro 0 0
proc /proc proc defaults 0 0
tmpfs /dev/shm tmpfs nodev,nosuid,noexec 0 0
</pre>

<p>
Вам также потребуется предотвратить запуск на клиенте проверки файловой 
системы:
</p>

<pre caption="Исключение запуска проверки файловой системы на клиенте">
# <i>touch /fastboot</i>
# <i>echo "touch /fastboot" &gt;&gt; /etc/conf.d/local.start</i>
</pre>

<p>
Установите <c>nfs-utils</c>, так как ваш клиент будет сильно зависеть от них:
</p>

<pre caption="Установка nfs-utils">
# <i>emerge nfs-utils</i>
</pre>

<p>
Загрузчик. Не устанавливайте других загрузчиков, так как один у нас уже есть - 
pxegrub. Просто завершаете установку и перезагружаете сервер. Запустите службы, 
необходимые для загрузки новоиспеченного клиента: DHCP, TFTPD и  NFS.
</p>

<pre caption="Запуск служб">
# <i>/etc/init.d/dhcp start</i>
# <i>/etc/init.d/in.tftpd start</i>
# <i>/etc/init.d/nfs start</i>
</pre>

</body>
</section>
<section>
<title>Загрузка нового клиента</title>
<body>

<p>
Чтобы клиент загрузился, надо настроить bios и сетевую карту для использования 
PXE как первого способа загрузки - до CD-ROM или floppy. Помощником вам будет 
документация к оборудованию или website производителя. Сетевая карта должна 
получить IP адрес от DHCP и загрузить PXE-образ GRUB при помощи TFTP. Дальше вы 
увидите симпатичное черно-белое меню GRUB, в котором можно выбрать ядро для 
загрузки, а нажав Enter, и загрузить его. Если все в порядке, ядро примонтирует 
корневую файловую систему, используя NFS, и выведет на терминал приглашение для входа в систему. Вот и все.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Установка Gentoo из существующей Linux-системы</title> 
<section>
<title>Что необходимо</title> 
<body>

<p>
Для установки Gentoo из существующей системы Linux вам должна быть 
доступна команда chroot, а также копия установочного tarball-а Gentoo, 
либо его ISO-образ. Не помешает доступ в сеть, если вы не хотите 
ограничиваться тем, что есть в вашем tarball-е. (к слову, tarball - это 
просто файл, заканчивающийся на .tbz иди .tar.gz). Автор (ориг.текста) 
использовал RedHat Linux 7.3 как "базовую" ОС, хотя это не так уж важно. 
Итак, приступим!
</p>

</body>
</section>
<section>
<title>Обзор</title>
<body>

<p>
Сперва надо отвести раздел для Gentoo, изменив размер существующего раздела 
Linux, смонтировать его, разархивировать tarball, chroot внутрь нашей 
псевдо-системы, и начинаем строительство. После настройки загрузчика немного 
поработаем напильником, просто для того, чтобы система была способна 
загрузиться самостоятельно, перезагружаемся и пользуемся Gentoo.
</p>

</body>
</section>
<section>
<title>Как отвести место для Gentoo?</title>
<body>

<p>
Корневой раздел - это файловая система, примонтированная к <path>/</path>. 
Запущенная команда mount показывает, о чем я веду речь. Еще мы можем выполнить 
df (disk free), чтобы посмотреть, сколько свободного места у нас есть. Прошу 
заметить - совсем не обязательно кромсать ваш root раздел! Вы можете отрезать в 
любом другом месте, доступном вашей программе редактирования разделов жесткого 
диска, но мы поговорим об этом чуть позже.
</p>

<pre caption="Информация о файловых системах">
# <i>mount</i>
/dev/hdb2 on / type ext3 (rw) 
none on /proc type proc (rw) 
none on /dev/pts type devpts (rw,gid=5,mode=620) 
none on /dev/shm type tmpfs (rw,nodev,nosuid,noexec)
# <i>df -h </i>
Filesystem           Size Used Avail Use% Mounted on 
/dev/hdb2            4.0G 1.9G  2.4G  82% /
none                 38M    0   38M   0% /dev/shm 
</pre>

<p>
Как видите, раздел, смонтированный как <path>/</path>, носит имя 
<path>/dev/hdb2</path> и на нем еще свободно 2.4 гигабайта. В моем случае, 
думаю, 400 МБ свободного пространства хватит с головой, следовательно, под 
Gentoo отводим 2 ГБ. Совсем неплохо, учитывая, что большинству пользователей 
хватит и одного гигабайта. Приступим!
</p>

</body>
</section>
<section>
<title>Сборка parted для переразбивки разделов</title> 
<body>

<p>
Parted - утилита, поддерживаемая GNU foundation, старым, респектабельным, 
безразмерным проектом, софтом которого мы в данный момент и собираемся 
воспользоваться. Всего одним инструментом, который вполне нам подходит. 
Называется он parted, partition editor, загрузить его можно из 
<uri>http://www.gnu.org/software/parted/</uri>
</p>

<note>
Конечно, существуют и другие инструменты для работы с разделами, но автор не 
уверен/не интересуется, сможет ли PartitionMagic(tm) или любая другая программа 
сделать то, что нам нужно. Проверить - это забота читателя.
</note>

<p>
Взгляните на ту страницу руководства parted, где речь идет о типе файловой 
системы, размер которой вы собираетесь изменять, и узнайте, сможет ли parted 
это сделать. Если нет, что ж, вам не повезло. Придется убить какой-нибудь 
раздел и создать по-новому, чтобы было место для Gentoo. Вперед, качаем 
программу, устанавливаем. Возникает проблема. Мы хотим изменить размер 
корневого раздела, следовательно нам нужно загрузить с дискеты минимальную 
linux-систему и использовать предварительно скомпилированный parted для 
редактирования <path>/</path>. Если в вашем случае можно отмонтировать 
выбранный раздел, оставаясь в Linux, вам везет и нет необходимости делать 
то, что описано ниже. Просто соберите parted и запустите его на разделе, 
который хотите урезать. А вот то, что я сделал в своей системе.
</p>

<impo>
Убедитесь, что действия, которые вы собираетесь проделать с разделом, 
поддерживаются parted!
</impo>

<p>
Скачайте загрузочный/корневой диск mininux (бесплатный мини-дистрибутив Linux c 
ядром 2.4 на дискете) с <uri>http://mininux.free.fr/uk/</uri>, создайте 
дискету, как описано в прилагающейся документации, вставьте еще одну чистую 
дискету в дисковод и перейдите к следующему шагу.
</p>

<note>
Опять замечу, что Linux - синоним понятия "Этот путь не единственный". Наша 
цель - запустить parted на отмонтированном разделе жесткого диска и это можно 
сделать не только описанным способом. Вы можете использовать любой другой набор 
boot/root дискет, не только mininux. Вы можете вообще не выполнять данный шаг, 
главное, что нужно - отмонтировать файловую систему, которую вы собираетесь 
использовать под Gentoo, и перекроить ее, используя parted.
</note>

<pre caption="Создание вспомогательной дискеты">
# <i>mkfs.minix /dev/fd0</i>
480 inodes
1440 blocks
Firstdatazone=19 (19)
Zonesize=1024
Maxsize=268966912
</pre>

<p>
Продолжим со сборкой parted. Если он еще не закачан и не распакован, сделайте 
это. А затем перейдите в каталог, куда вы его распаковали. И здесь выполните 
следующий набор команд для сборки утилиты и записи ее на дискету.
</p>

<pre caption="Подготовка вспомогательной дискеты">
# <i> mkdir /floppy; mount -t minix /dev/fd0 /floppy &amp;&amp; 
export CFLAGS="-O3 -pipe -fomit-frame-pointer -static" &amp;&amp; ./configure 
&amp;&amp; make &amp;&amp; cp parted/parted /floppy &amp;&amp; umount /floppy </i>
</pre>

<p>
Поздравляю, вы готовы перезагрузиться и изменять выбранный раздел. 
Только делайте это после хотя бы беглого просмотра документации к parted 
на GNU website. Наберитесь терпения - изменение размера может занять больше 
получаса на больших дисках. Загрузитесь с дискеты mininux, а после этого 
замените загрузочную дискету на вспомогательную, которую мы только что 
создали. Введите mount /dev/fd0 /floppy и parted будет доступен в папке 
/floppy. Нам туда. Запускаете parted и перекраиваете нужный раздел жесткого 
диска. Когда этот бесконечный процесс наконец завершится, все будет готово 
для того, чтобы получить истинное наслаждение, устанавливая Gentoo. 
Диск, с которым мы работаем - это тот, на котором находится раздел, 
размер которого мы меняем. К примеру, если мы хотим изменить /dev/hda3, 
то диск, соответственно, будет называться /dev/hda.
</p>

<pre caption="Команды, которые следует выполнить, загрузившись с mininux">
# <i>mount /dev/fd0 /floppy </i>
# <i>cd /floppy; ./parted [диск, с которым мы работаем]</i>
(parted) <i> print </i>
Disk geometry for /dev/hdb: 0.000-9787.148 megabytes
Disk label type: msdos
Minor    Start       End     Type      Filesystem  Flags
1          0.031   2953.125  primary   ntfs        
3       2953.125   3133.265  primary   linux-swap  
2       3133.266   5633.085  primary   ext3        
4       5633.086   9787.148  extended              
5       5633.117   6633.210  logical               
6       6633.242   9787.148  logical   ext3        
(parted) <i> help resize </i>
  resize MINOR START END        resize filesystem on partition MINOR

        MINOR is the partition number used by Linux.  On msdos disk labels, the
        primary partitions number from 1-4, and logical partitions are 5
        onwards.
        START and END are in megabytes
(parted) <i> resize 2 3133.266 4000.000 </i>
</pre>

<impo>
Наберитесь терпения! Компьютер работает! Посмотрите на индикатор обращения к 
жесткому диску (находится на корпусе), чтобы убедиться, что это так. Процесс 
может занять от 2 до 30 минут.
</impo>

<p>
Когда процесс завершится, перезагрузитесь в вашу старую linux-систему. После 
этого откройте документ <uri 
link="/doc/ru/handbook/handbook-x86.xml?part=1&amp;chap=4">Настольная книга
Gentoo: подготовка дисков</uri> и следуйте инструкциям. 
Дойдя до chroot, используйте следующую команду чтобы очистить переменные 
окружения:
</p>

<pre caption = "Обновление среды при chroot">
# <i>env -i HOME=$HOME TERM=$TERM chroot /mnt/gentoo /bin/bash</i>
# <i>/usr/sbin/env-update</i>
# <i>source /etc/profile</i>
</pre>

<p>
Удачи!
</p>

</body>
</section>
</chapter>

</guide>

<!-- *$Localization:
target-language: Russian
target-version: 0.65-r1
target-date: 2005-11-28
source-cvs-revision: 1.60
translated-by: Alexandr Barakin [kansas@pochta.ru], Alexey Chumakov (0.40-0.65)
edited-by: none

notes:
-->
