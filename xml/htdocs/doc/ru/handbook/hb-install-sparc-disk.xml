<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-sparc-disk.xml,v 1.1 2005/11/13 15:08:11 achumakov Exp $ -->

<sections>

<version>2.5</version>
<date>2005-10-02</date>

<section>
<title>Введение в блоки устройств</title>
<subsection>
<title>Блоки устройств</title>
<body>

<p>
Здесь мы рассмотрим различные стороны дисковой архитектуры Gentoo Linux и 
операционной системы Linux как таковой, включая файловые системы, разделы 
дисков и блоки устройств. Затем когда вы ознакомитесь с плюсами и минусами 
дисков и файловых систем, мы расскажем о процессе настройки разделов и файловых 
систем для установки ОС Gentoo Linux.
</p>

<p>
Для начала мы расскажем о <e>блоках устройств</e>. Наиболее типичным блоковым 
устройством является скорее всего то которое представлено первым жестким диском 
SCSI в операционной системе Linux, которое называется<path>/dev/sda</path>. 
</p>

<p>
Блоковые устройства предоставляют абстрактный интерфейс к диску. 
Пользовательские программы могут использовать их для передачи данных 
абстрагируясь от типа диска (IDE, SCSI или что-то еще). Прорграмма просто 
адресует дисковое пространство как набор непрерывных, случайнодоступных 
512-байтных блоков.
</p>

<p>
Блоковые устройства показаны как строки в файле<path>/dev/</path>. Обычно 
первое SCSI устройство называется<path>/dev/sda</path>, второе -- 
<path>/dev/sdb</path>, и т.д. IDE устройства называются аналогично, с 
приставкой hd- вместо sd-. Если используются IDE устройства, первое будет 
называться <path>/dev/hda</path>, второе -- <path>/dev/hdb</path>, и т.д.
</p>

</body>
</subsection>
<subsection>
<title>Разделы</title>
<body>

<p>
Несмотря на то что теоретически возможно использование всего диска для хранения 
системы Linux, на практике этого почти никогда не происходит. Вместо этого 
диски делятся на более мелкие, более управляемые блоковые устройства. Эти 
устройства называются <e>разделы</e> или <e>куски</e>.
</p>

<p>
Первый раздел на первом SCSI диске называется <path>/dev/sda1</path>, второй -- 
<path>/dev/sda2</path> и т.д. Аналогично первые два раздела на диске типа IDE 
будут называться <path>/dev/hda1</path> и <path>/dev/hda2</path>.
</p>

<p>
Третий раздел в системах Sun имеет специальное назначение как кусок "целого 
диска". Этот раздел должен оставаться нетронутым и не должен содержать файловой 
системы.
</p>

<p>
Пользователи, которые привыкли к схеме разбивки системы DOS, должны знать что 
дисковые метки Sun не имеют "первичного" и "расширенного" разделов. Вместо 
этого, доступно до восьми разделов на диск, включая зарезервированный третий.
</p>

</body>
</subsection>
</section>
<section>
<title>Разработка Схемы Разделов</title>
<subsection>
<title>Схема Разделов По Умолчанию</title>
<body>

<p>
Если вы не заинтересованы в разработке схемы разделов, то таблица прведённая 
ниже предлагает подходящую для большинства систем начальную разбивку. Для 
систем с дисками типа IDE просто замените имя <c>hda</c> на <c>sda</c>.
</p>

<p>
Замеьтим что отдельный раздел <path>/boot</path> обычно <e>не</e> рекомендуется 
на системах SPARC, т.к. это делает более сложной настройку загрузчика.
</p>

<table>
<tr>
  <th>Раздел</th>
  <th>Файловая система</th>
  <th>Размер</th>
  <th>Точка монтирования</th>
  <th>Описание</th>
</tr>
<tr>
  <ti>/dev/sda1</ti>
  <ti>ext3</ti>
  <ti>&lt;2 GByte</ti>
  <ti>/</ti>
  <ti>
    Корневой раздел. Для систем sun4c, sun4d и sun4m с некоторыми версиями ПЗУ
    требуется, чтобы этот раздел был менее 1ГБ, и был первым разделом на диске. 
  </ti>
</tr>
<tr>
  <ti>/dev/sda2</ti>
  <ti>swap</ti>
  <ti>512 MBytes</ti>
  <ti>none</ti>
  <ti>
    Раздел подкачки. Для самогенерации системы и отдельных больших компиляций 
    требуется как минимум 512MB RAM (включая подкачку). 
  </ti>
</tr>
<tr>
  <ti>/dev/sda3</ti>
  <ti>none</ti>
  <ti>Whole disk</ti>
  <ti>none</ti>
  <ti>Раздел целого диска. Требования системы SPARC.</ti>
</tr>
<tr>
  <ti>/dev/sda4</ti>
  <ti>ext3</ti>
  <ti>at least 2 GBytes</ti>
  <ti>/usr</ti>
  <ti>
    Раздел /usr. Сюда устанавливаются приложения. По умолчанию этот раздел 
   также используется для данных Портэджа (примерный размер 500 MB, не включая 
   исходный код).
  </ti>
</tr>
<tr>
  <ti>/dev/sda5</ti>
  <ti>ext3</ti>
  <ti>at least 1GByte</ti>
  <ti>/var</ti>
  <ti>
    Раздел /var. Используется для программно-генерируемых данных. По умолчанию 
    Портэдж использует этот раздел во время компиляции для хранения временных 
    файлов. Некоторые большие  приложения, такие как Mozilla и OpenOffice.org 
    требуют более 1 GB для хранения временных файлов при построении. 
  </ti>
</tr>
<tr>
  <ti>/dev/sda6</ti>
  <ti>ext3</ti>
  <ti>remaining space</ti>
  <ti>/home</ti>
  <ti>Раздел /home. Используется для хранения пользовательских каталогов.</ti>
</tr>
</table>

</body>
</subsection>
</section>
<section id="fdisk">
<title>Использование программы fdisk для разбивки жесткого диска</title>
<subsection>
<body>

<p>
Ниже описывается как создать разбивку на примере описанном выше:
</p>

<table>
<tr>
  <th>Раздел</th>
  <th>Описание????????</th>
</tr>
<tr>
    <ti>/dev/sda1</ti>
    <ti>/</ti>
</tr>
<tr>
    <ti>/dev/sda2</ti>
    <ti>swap</ti>
</tr>
<tr>
    <ti>/dev/sda3</ti>
    <ti>whole disk slice</ti>
</tr>
<tr>
    <ti>/dev/sda4</ti>
    <ti>/usr</ti>
</tr>
<tr>
    <ti>/dev/sda5</ti>
    <ti>/var</ti>
</tr>
<tr>
    <ti>/dev/sda6</ti>
    <ti>/home</ti>
</tr>
</table>

<p>
При необходимости измените схему разделов. Помните, что весь корневой раздел 
должен быть в пределах первых 2 GB для дисков на более старых машинах. Также 
сузествует ограничение в 15 разделов для дисков SCSI и SATA.
</p>

</body>
</subsection>
<subsection>
<title>Запуск программы fdisk</title>
<body>

<p>
Запустите программу <c>fdisk</c>, указав в качестве аргумента имя диска:
</p>

<pre caption="Запуск fdisk">
# <i>fdisk /dev/sda</i>
</pre>

<p>
Вы увидите приветствие программы fdisk:
</p>

<pre caption="Подсказка fdisk">
Command (m for help):
</pre>

<p>
Чтобы просмотреть имеющиеся в наличии разделы, нажмите <c>p</c>:
</p>

<pre caption="Список имеющихся разделов">
Command (m for help): <i>p</i>

Disk /dev/sda (Sun disk label): 64 heads, 32 sectors, 8635 cylinders
Units = cylinders of 2048 * 512 bytes

   Device Flag    Start       End    Blocks   Id  System
/dev/sda1             0       488    499712   83  Linux native
/dev/sda2           488       976    499712   82  Linux swap
/dev/sda3             0      8635   8842240    5  Whole disk
/dev/sda4           976      1953   1000448   83  Linux native
/dev/sda5          1953      2144    195584   83  Linux native
/dev/sda6          2144      8635   6646784   83  Linux native
</pre>

<p>
Заметим, что диск отмечен как <c>Sun disk label</c>. Если этого нет, диск 
использует схему раздела DOS, а не Sun. В этом случае используйте команду 
<c>s</c> чтобы определить разметку диска Sun:
</p>

<pre caption="Создание дисковой метки Sun">
Command (m for help): s
Building a new sun disklabel. Changes will remain in memory only,
until you decide to write them. After that, of course, the previous
content won't be recoverable.

Drive type
   ?   auto configure
   0   custom (with hardware detected defaults)
   a   Quantum ProDrive 80S
   b   Quantum ProDrive 105S
   c   CDC Wren IV 94171-344
   d   IBM DPES-31080
   e   IBM DORS-32160
   f   IBM DNES-318350
   g   SEAGATE ST34371
   h   SUN0104
   i   SUN0207
   j   SUN0327
   k   SUN0340
   l   SUN0424
   m   SUN0535
   n   SUN0669
   o   SUN1.0G
   p   SUN1.05
   q   SUN1.3G
   r   SUN2.1G
   s   IOMEGA Jaz
Select type (? for auto, 0 for custom): <i>0</i>
Heads (1-1024, default 64): 
Using default value 64
Sectors/track (1-1024, default 32): 
Using default value 32
Cylinders (1-65535, default 8635): 
Using default value 8635
Alternate cylinders (0-65535, default 2): 
Using default value 2
Physical cylinders (0-65535, default 8637): 
Using default value 8637
Rotation speed (rpm) (1-100000, default 5400): <i>10000</i>
Interleave factor (1-32, default 1): 
Using default value 1
Extra sectors per cylinder (0-32, default 0): 
Using default value 0
</pre>

<p>
Правильные значения можно найти в документации к диску. 'Автонастройка' обычно 
не срабатывает.
</p>

</body>
</subsection>
<subsection>
<title>Удаление существующих разделов</title>
<body>

<p>
Настало время удалить существующие разделы диска. Чтобы выполнить эту операцию 
нажмите <c>d</c> и Enter. Вас попросят ввести номер раздела для удаления. Чтобы 
удалить уже существующий раздел <path>/dev/sda1</path>, нужно набрать:
</p>

<pre caption="Удаление раздела">
Command (m for help): <i>d</i>
Partition number (1-4): <i>1</i>
</pre>

<p>
<e>Вы не должны удалять раздел номер 3 (целый диск).</e> Таково требование Sun. 
Если такой раздел не существует, продолжайте по инструкции "Создание метки 
диска Sun" описанной выше.
</p>

<p>
После удаления всех разделов кроме 3. вы увидите разхбивку аналогичную 
следующей:
</p>

<pre caption="Просмотр пустой схемы разделов">
Command (m for help): <i>p</i>

Disk /dev/sda (Sun disk label): 64 heads, 32 sectors, 8635 cylinders
Units = cylinders of 2048 * 512 bytes

   Device Flag    Start       End    Blocks   Id  System
/dev/sda3             0      8635   8842240    5  Whole disk
</pre>


</body>
</subsection>

<subsection>
<title>Создание корневого раздела</title>
<body>

<p>
Сейчас мы готовы к созданию корневого раздела. Чтобы выполнить это нажмите 
<c>n</c> Enter, а затем наберите <c>1</c> для создания нового раздела. Для 
ответа на вопрос о первом цилиндре, нажмите клавишу enter. Для ответа на вопрос 
о последнем цилиндре наберите <c>+512M</c> для создания раздела размером 
<c>512МБ</c>. Убелитесь что весь корневой раздел поместился в пределах первых 
2ГБ диска. Приведем порядок выполнения этой команды:
</p>

<pre caption="Создание корневого раздела">
Command (m for help): <i>n</i>
Partition number (1-8): <i>1</i>
First cylinder (0-8635): <i>(нажмите Enter)</i>
Last cylinder or +size or +sizeM or +sizeK (0-8635, default 8635): <i>+512M</i>
</pre>

<p>
Сейчас, если набрать <c>p</c>, то увидим следующий вывод:
</p>

<pre caption="Список проэкта разделов">
Command (m for help): <i>p</i>

Disk /dev/sda (Sun disk label): 64 heads, 32 sectors, 8635 cylinders
Units = cylinders of 2048 * 512 bytes

   Device Flag    Start       End    Blocks   Id  System
/dev/sda1             0       488    499712   83  Linux native
/dev/sda3             0      8635   8842240    5  Whole disk
</pre>

</body>
</subsection>
<subsection>
<title>Создание раздела подкачки</title>
<body>

<p>
Далее давайте создадим раздел подкачки. Чтобы выполнить это наберите <c>n</c>, 
а затем <c>2</c> для создания нового раздела, в нашем случае 
<path>/dev/sda2</path>. На вопрос о первом цилиндре нажмите Enter. На вопрос о 
последнем цилиндре, наберите<c>+512M</c>, чтобы создать раздел размером 512M. 
После этого наберите <c>t</c>, чтобы выбрать тип раздела и наберите <c>82</c> 
чтобы выбрать тип "Linux Swap". По окончании наберите <c>p</c> и увидите 
таблицу разбивки которая будет выглядеть примерно так:
</p>

<pre caption="Список доступных разделов">
Command (m for help): <i>p</i>

Disk /dev/sda (Sun disk label): 64 heads, 32 sectors, 8635 cylinders
Units = cylinders of 2048 * 512 bytes

   Device Flag    Start       End    Blocks   Id  System
/dev/sda1             0       488    499712   83  Linux native
/dev/sda2           488       976    499712   82  Linux swap
/dev/sda3             0      8635   8842240    5  Whole disk
</pre>

</body>
</subsection>
<subsection>
<title>Создание разделов /usr, /var ? /home</title>
<body>

<p>
Наконец, давайте создадим разделы /usr, /var и /home. Как и раньше, наберите 
<c>n</c>, а затем <c>4</c> для создания третьего раздела, в нашем случае 
<path>/dev/sda4</path>. На вопрос о первом цилиндре, нажмите Enter. На вопрос о 
последнем цилиндре, наберите <c>+2048M</c> для создания раздела размером 2GB. 
Повторите эту процедуру для <path>sda5</path> и <path>sda6</path>, используя 
соответствующие размеры. По окончании, вы должны увидеть что-то похожее на:
</p>

<pre caption="Завершенный список таблицы разделов">
Command (m for help): <i>p</i>

Disk /dev/sda (Sun disk label): 64 heads, 32 sectors, 8635 cylinders
Units = cylinders of 2048 * 512 bytes

   Device Flag    Start       End    Blocks   Id  System
/dev/sda1             0       488    499712   83  Linux native
/dev/sda2           488       976    499712   82  Linux swap
/dev/sda3             0      8635   8842240    5  Whole disk
/dev/sda4           976      1953   1000448   83  Linux native
/dev/sda5          1953      2144    195584   83  Linux native
/dev/sda6          2144      8635   6646784   83  Linux native
</pre>

</body>
</subsection>
<subsection>
<title>Сохранение и выход</title>
<body>

<p>
Чтобы сохранить созданную таблицу разделов и завершить сеанс работы с 
программой <c>fdisk</c>, нажмите <c>w</c>:
</p>

<pre caption="Сохранение и выход из программы fdisk">
Command (m for help): <i>w</i>
</pre>

<p>
Сейчас когда разделы созданы продолжайте по ссылке <uri
link="#filesystems">Создание файловых систем</uri>.
</p>

</body>
</subsection>
</section>
<section id="filesystems">
<title>Создание файловых систем</title>
<subsection>
<title>Введение</title>
<body>

<p>
Снйчас когда все разделы уже созданы, настало время расположить на них файловые 
системы. Если вам безразлично какую файловыю систему выбрать и вас устроит 
выбор файловых систем по умолчанию принятый в этом руководстве, продолжайте по 
ссылке: <uri link="#filesystems-apply">Применение файловых систем к 
разделам</uri>. В противном случае продолжайте читать чтобы узнать больше о 
файловых системах...
</p>

</body>
</subsection>
<subsection>
<title>Файловые системы</title>
<body>

<p>
Существует несколько файловых систем. Про некоторые известно что они стабильно 
работают на компьютерах с архитектурой SPARC. Хорошо работают например файловые 
системы Ext2 и Ext3, Остальные могут работать некорректно.
</p>

<p>
Файловая система <b>ext2</b> является проверенной и надёжной файловой системой 
операционной системы Linux. Она не поддерживает журналирования, а это значит, 
что периодические проверки этой системы во время загрузки могут отнимать много 
времени. В настоящее время существуют журнальные файловые системы, которые 
могут достаточно быстро быть проверены на целостность и поэтому более 
предпочтительны по отношению к их не-журнальным оппонентам. Резюмируя, 
журнальные файловые системы сокращают время ожидания когда происходит загрузка 
системы и состояние файловой системы нестабильно.
</p>

<p>
Файловая система <b>ext3</b> является журнальной версией файловой системы ext2. 
Она предоставляет журнальные метаданные для быстрейшего восстановления системы 
и другие расширенные журнальные режимы такие как запись данных и запись 
упорядоченных данных. Файловая система Ext3 дополнительно имеет возможность 
индексирования хэшированного B-дерева, которая позволяет получить высокую 
производительность почти во всех ситуациях. Включить такое индексирование 
можно, добавив <c>-O dir_index</c> в команду <c>mke2fs</c>. Эта файловая 
система является отличной надежной альтернативой для ext2.
</p>

<p>
Файловая система <b>ReiserFS</b> частично работает на системах sparc64 и 
поэтому не рекомендуется для использования. Файловая система <b>XFS</b> не 
должна использоваться так как известно что она создает множество проблем и 
может разрушить данные.. Еще одна журнальная файловая система, <b>JFS</b>, не 
поддерживается. Независимо от выбора файловой системы загрузчик требует чтобы 
файловая система корневого раздела была ext2 или ext3.
</p>

</body>
</subsection>
<subsection id="filesystems-apply">
<title>Применение файловых систем к разделам</title>
<body>

<p>
Чтобы создать файловую систему на разделе или томе, существуют средства 
специфические для данной файловой системы:
</p>

<table>
<tr>
  <th>Файловая система</th>
  <th>Команда по созданию</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti><c>mke2fs</c></ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti><c>mke2fs -j</c></ti>
</tr>
<tr>
  <ti>ext3 с индексированием хэшированного b-дерева (только ядро 2.6)</ti>
  <ti><c>mke2fs -j -O dir_index</c></ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti><c>mkreiserfs</c></ti>
</tr>
</table>

<p>
Например, для создания корневого раздела (в нашем примере 
<path>/dev/sda1</path>) с файловой системой ext2, разделов <path>/usr</path>, 
<path>/var</path>, и <path>/home</path> (в нашем примере соответственно 
(<path>/dev/sda4</path>, <path>5</path> и <path>6</path>), с файловой системой 
ext3, нужно воспользоваться следующими командами:
</p>

<pre caption="Применение файловых систем к разделам">
# <i>mke2fs /dev/sda1</i>
# <i>mke2fs -j /dev/sda4</i>
# <i>mke2fs -j /dev/sda5</i>
# <i>mke2fs -j /dev/sda6</i>
</pre>

</body>
</subsection>
<subsection>
<title>Создание и активизация раздела подкачки</title>
<body>

<p>
Для создания раздела подкачки используется команда <c>mkswap</c>:
</p>

<pre caption="Создание раздела подкачки">
# <i>mkswap /dev/sda2</i>
</pre>

<p>
Для активизации раздела подкачки используется команда <c>swapon</c>:
</p>

<pre caption="Активизация раздела подкачки">
# <i>swapon /dev/sda2</i>
</pre>

<p>
Создайте и активизируйте раздел подкачки используя команды описанные выше.
</p>

</body>
</subsection>
</section>
<section>
<title>Монтирование</title>
<body>

<p>
Сейчас когда разделы проинициализированы и содержат файловые системы, настало 
время смонтировать их используя команду <c>mount</c>. Не забудьте сначала 
создать необходимые каталоги монтированиядля каждого созданного раздела. 
Например:
</p>

<pre caption="Монтирование разделов">
# <i>mount /dev/sda1 /mnt/gentoo</i>
# <i>mkdir /mnt/gentoo/usr</i>
# <i>mount /dev/sda4 /mnt/gentoo/usr</i>
# <i>mkdir /mnt/gentoo/var</i>
# <i>mount /dev/sda5 /mnt/gentoo/var</i>
# <i>mkdir /mnt/gentoo/home</i>
# <i>mount /dev/sda6 /mnt/gentoo/home</i>
</pre>

<note>
Если вы хотите чтобы каталог <path>/tmp</path> находился на отдельном разделе, 
измените права доступа после монтирования: <c>chmod 1777 /mnt/gentoo/tmp</c>. 
То же самое нужно проделать и с <path>/var/tmp</path>, если они будут 
нахлдиться на отдельном разделе.
</note>

<p>
Мы также должны смонтировать файловую систему proc (виртуальный интерфейс к 
ядру) на <path>/proc</path>. Но сначала мы должны положить наши установочные 
файлы на соответствующие им разделы.
</p>

<p>
Продолжайте по ссылке <uri link="?part=1&amp;chap=5">Установка установорчных 
файлов ОС Gentoo</uri>.
</p>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 2.5-r1
target-date: 2005-11-13
source-cvs-revision: 1.24
translated-by: Igor korot <ikorot@earthlink.net>
edited-by: (partially edited by achumakov)

notes:
-->
