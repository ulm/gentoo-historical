<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-config.xml,v 1.22 2014/06/12 01:52:57 blueboar Exp $ -->

<sections>

<abstract>
Вам потребуется отредактировать несколько важных конфигурационных файлов. 
Из этой главы вы получите представление об этих файлах и поймете, как с ними обращаться. 
</abstract>

<version>16</version>
<date>2014-05-27</date>

<section>
<title>Параметры файловых систем</title>
<subsection>
<title>Что такое fstab?</title>
<body>

<p>
В Linux все разделы, используемые системой, должны быть перечислены в
<path>/etc/fstab</path>.
В этом файле указываются точки подключения разделов (mountpoints,
местоположение разделов в файловой системе), порядок подключения,
а также дополнительные параметры (автоматический или ручной режим подключения,
достаточность прав пользователя для подключения и т.п.)
</p>

</body>
</subsection>
<subsection>
<title>Создание /etc/fstab</title>
<body>

<p>
В <path>/etc/fstab</path> используется специальный формат. Каждая строка
состоит из шести полей, разделяемых пробелами, знаками табуляции или их
сочетанием. Каждое поле имеет свое назначение:
</p>

<ul>
<li>
Первое поле обозначает <b>раздел (partition)</b> (путь к файлу устройства).
</li>
<li>
Второе поле указывает <b>точку подключения (mountpoint)</b>, в которую
монтируется раздел.
</li>
<li>
Третье поле задает тип <b>файловой системы (filesystem)</b>, используемой в 
разделе.
</li>
<li>
В четвертом поле указываются <b>параметры подключения (mountoptions)</b>, 
используемые <c>mount</c> при подключении раздела. Поскольку для каждой 
файловой системы существуют свои параметры, рекомендуется прочитать страницу 
справки по mount (<c>man mount</c>), где приведен их полный перечень. При 
указании нескольких параметров подключения их следует разделять запятыми.
</li>
<li>
Пятое поле используется <c>dump</c> для определения, требуется ли резервное 
копирование раздела средствами dump. Обычно это поле можно просто установить в 
<c>0</c> (ноль).
</li>
<li>
Шестое поле используется <c>fsck</c> для определения порядка <b>проверки 
(check)</b> файловых систем после некорректного завершения работы системы. Для 
корневой файловой системы рекомендуется значение <c>1</c>, а для остальных 
&mdash; <c>2</c> (или <c>0</c>, когда проверка файловой системы не требуется).
</li>
</ul>

<impo>
Вариант файла <path>/etc/fstab</path> по умолчанию, входящий в Gentoo, <e>не 
является работоспособным</e>. Вам <b>потребуется создать</b> свой собственный 
<path>/etc/fstab</path>.
</impo>

<pre caption="Открытие /etc/fstab">
# <i>nano -w /etc/fstab</i>
</pre>

<p>
В оставшейся части текста мы будем использовать стандартные блочные файлы
устройств <path>/dev/sd*</path> в качестве разделов. Вы также можете захотеть
использовать символические ссылки, находящиеся в <path>/dev/disk/by-id</path>
или <path>/dev/disk/by-uuid</path>. Эти имена скорее всего не изменятся, в то
время как стандартное имя файлов блочных устройств зависит от множества
факторов (например, как и в каком порядке диски подсоединены к системе).
Однако, если вы не собираетесь менять порядок дисков, вы можете продолжить
с наименованием блочных устройств по умолчанию.
</p>

</body>
<body test="func:keyval('/boot')">

<p>
Рассмотрим, как указываются параметры загрузочного раздела <path>/boot</path>. 
Это лишь пример, и если вам не нужно или вы не можете создать раздел 
<path>/boot</path>, не копируйте пример дословно.
</p>

<p>
В нашем примере разбивки для <keyval id="arch"/> по умолчанию,
<path>/boot</path> &mdash; это обычно раздел <path><keyval id="/boot"/></path>
с файловой системой <c>ext2</c>. При загрузке требуется его проверка. Напишем
следующее:
</p>

<pre caption="Пример строки /boot в /etc/fstab">
<keyval id="/boot"/>   /boot     ext2    defaults        0 2
</pre>

<p>
Некоторые пользователи предпочитают не подключать раздел <path>/boot</path>
автоматически, чтобы повысить безопасность системы. Для этого нужно заменить
<c>defaults</c> на <c>noauto</c>. В таком случае вам придется подключать раздел 
вручную каждый раз, когда он потребуется.
</p>

</body>
<body>

<p>
Укажите правила, соответствующие вашей схеме разбивки, и добавьте правила для
своих дисководов CD-ROM (если есть другие разделы или устройства, их тоже можно указать).
</p>

<p>
Теперь на основе приведенного <e>примера</e> создайте собственный файл 
<path>/etc/fstab</path>:
</p>

<pre caption="Пример полного /etc/fstab" test="func:keyval('arch')='HPPA' or func:keyval('arch')='x86' or func:keyval('arch')='AMD64'">
<keyval id="/boot"/>   /boot        ext2    defaults,noatime     0 2
/dev/sda3   none         swap    sw                   0 0
/dev/sda4   /            ext4    noatime              0 1

/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0
</pre>

<pre caption="Пример полного /etc/fstab" test="func:keyval('arch')='Alpha' or func:keyval('arch')='MIPS'">
<keyval id="/boot"/>   /boot        ext2    defaults,noatime     0 2
/dev/sda2   none         swap    sw                   0 0
/dev/sda3   /            ext4    noatime              0 1

/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0
</pre>

<pre caption="Пример полного /etc/fstab" test="func:keyval('arch')='SPARC'">
/dev/sda1   /               ext4        noatime              0 1
/dev/sda2   none            swap        sw                   0 0
/dev/sda4   /usr            ext4        noatime              0 2
/dev/sda5   /var            ext4        noatime              0 2
/dev/sda6   /home           ext4        noatime              0 2

<comment># Вам нужно добавить правила для openprom</comment>
openprom    /proc/openprom  openpromfs  defaults             0 0

/dev/cdrom  /mnt/cdrom      auto        noauto,user          0 0
</pre>

<pre caption="Пример полного  /etc/fstab" test="func:keyval('arch')='PPC' or func:keyval('arch')='PPC64'">
/dev/sda4   /            ext4    noatime              0 1
/dev/sda3   none         swap    sw                   0 0

/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0
</pre>

<p>
Параметр <c>auto</c> позволяет <c>mount</c> определять тип файловой системы 
автоматически (рекомендуется для съемных носителей, которые могут оказаться 
размечены в одной из множества существующих файловых систем), а <c>user</c> 
позволяет монтировать компакт-диски обычным пользователям.
</p>

<p>
Чтобы повысить быстродействие, большинству пользователей стоит добавить 
параметр <c>noatime</c> в параметры подключения, что приведет к ускорению за 
счет отключения регистрации отметки времени доступа к файлам (обычно в ней все 
равно нет необходимости). Это также рекомендуется сделать владельцам
твердотельных жестких дисков (SSD), которые также должны включить опцию
монтирования <c>discard</c> (пока ее поддерживают только ext4 и btrfs),
что включает команду TRIM.
</p>

<p>
Перепроверьте свой файл <path>/etc/fstab</path>, сохраните его, и 
выйдите из редактора, чтобы продолжить настройку.
</p>

</body>
</subsection>
</section>
<section>
<title>Параметры сети</title>
<subsection>
<title>Hostname, Domainname и т. д.</title>
<body>

<p>
Еще один вопрос, который нужно решить пользователю &mdash; как назвать свой 
компьютер. Он кажется довольно простым, но <e>многие</e> затрудняются дать 
подходящее имя для своей Linux-системы. Чтобы вам стало легче, запомните, что
какое бы имя вы не выбрали, потом его всегда можно изменить. Например, вы могли 
бы просто назвать свою систему <c>tux</c>, а домен &mdash; <c>homenetwork</c>.
</p>

<pre caption="Установка имени узла">
# <i>nano -w /etc/conf.d/hostname</i>

<comment>(присвойте переменной hostname имя своего узла)</comment>
hostname="<i>tux</i>"
</pre>

<p>
Во-вторых, <e>если</e> вам нужно имя домена, установите его в
<path>/etc/conf.d/net</path>. Вам нужен домен только если так скажет ваш провайдер 
или сетевой администратор, либо если у вас есть DNS-сервер, но нет DHCP-сервера. Вам 
не нужно волноваться по поводу DNS или имен доменов, если ваша сеть настроена с
использованием DHCP.
</p>

<note>
По умолчанию файл <path>/etc/conf.d/net</path> не существует, поэтому
вам может понадобиться создать его.
</note>

<pre caption="Установка имени домена">
# <i>nano -w /etc/conf.d/net</i>

<comment>(присвойте переменной DNSDOMAIN имя своего домена)</comment>
dns_domain_lo="<i>homenetwork</i>"
</pre>

<note>
Если вы выберете не устанавливать имя домена, вы можете отредактировать файл
<path>/etc/issue</path> чтобы избавиться от сообщений "This is hostname.(none)"
при входе в систему. Просто удалите строку <c>.\O</c> из данного файла.
</note>

<p>
Если у вас есть домен NIS (а если вы не знаете, что это такое, то у вас его 
точно нет), его также необходимо указать: 
</p>

<pre caption="Установка имени NIS-домена">
# <i>nano -w /etc/conf.d/net</i>

<comment>(укажите название своего домена NIS переменной nis_domain)</comment>
nis_domain_lo="<i>my-nisdomain</i>"
</pre>

<note>
Для более детальной информации по вопросам конфигурации DNS и NIS, пожалуйста,
прочитайте примеры в файле <path>/usr/share/doc/netifrc-*/net.example.bz2</path>.
Их можно прочитать, используя <c>bzless</c>. Кроме того,
вы можете захотеть установить <c>openresolv</c> для помощи в настройке
DNS/NIS.
</note>

</body>
</subsection>
<subsection>
<title>Настройка сети</title>
<body>

<p>
Прежде, чем возмутиться: &laquo;Эй, мы же все это уже делали!&raquo; &mdash; 
вспомните, что подключение к сети, настроенное вначале, было предназначено лишь 
для установки Gentoo. Теперь же вы настраиваете сеть для постоянного 
использования.
</p>

<note>
Более подробные сведения о сетях, включая дополнительные темы, такие как 
объединение, образование мостов, настройка виртуальных сетей (VLAN) 802.1Q или
беспроводных сетей, представлены в разделе <uri link="?part=4">настройка сети в
Gentoo</uri>.
</note>

<p>
Все настройки сети собраны в файле <path>/etc/conf.d/net</path>. В
нем используется простой формат, хотя, если вы не знакомы с ручной 
настройкой сети, он не слишком очевиден. Но не бойтесь, мы все объясним. В 
файле <path>/usr/share/doc/netifrc-*/net.example.bz2</path> приведен подробно 
прокомментированный пример, охватывающий много различных конфигураций.
</p>

<p>
Сначала давайте установим <c>netifrc</c>:
</p>

<pre caption="Установка netifrc">
# <i>emerge --noreplace netifrc</i>
</pre>

<p>
По умолчанию используется DHCP. Чтобы DHCP заработал, требуется установить
DHCP-клиент, как описано далее в разделе <uri
link="?part=1&amp;chap=9#networking-tools">Установка нужных системных
средств</uri>. Не забудьте установить DHCP-клиент.
</p>

<p>
Если настройка сетевого подключения нужна вам для указания специфических 
параметров DHCP, или из-за того, что вы вообще не используете DHCP, откройте
<path>/etc/conf.d/net</path> в своем любимом редакторе (в этом примере 
использован <c>nano</c>):
</p>

<pre caption="Открытие /etc/conf.d/net для изменения">
# <i>nano -w /etc/conf.d/net</i>
</pre>

<p>
Чтобы указать свой собственный адрес IP, маску сети и шлюз, потребуется 
настроить как <c>config_eth0</c>, так и <c>routes_eth0</c>:
</p>

<note>
Подразумевается, что ваш сетевой интерфейс называется eth0. Это, однако, очень
зависит от системы. Рекомендуется предположить, что интерфейс называется так же,
как назывался интерфейс после загрузки с установочного диска <e>если</e>
установочный диск достаточно свежий. Более детальную информацию можно
найти в разделе 
<uri link="?part=4&amp;chap=2#doc_chap4">именование сетевых интерфейсов</uri>.
</note>

<pre caption="Ручная настройка параметров IP для eth0">
config_eth0="192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255"
routes_eth0="default via 192.168.0.1"
</pre>

<p>
Чтобы использовать DHCP определите <c>config_eth0</c>:
</p>

<pre caption="Автоматическое получение адреса IP для eth0">
config_eth0="dhcp"
</pre>

<p>
Пожалуйста, прочитайте файл <path>/usr/share/doc/netifrc-*/net.example.bz2</path> для
получения списка всех возможных опций. Также прочитайте man-страницу вашего
клиента DHCP, если вам нужно установить специфические опции DHCP.
</p>

<p>
Если у вас несколько сетевых интерфейсов, повторите эти шаги для 
<c>config_eth1</c>, <c>config_eth2</c> и т.д.
</p>

<p>
Теперь сохраните параметры и выйдите из редактора, чтобы продолжить настройку.
</p>

</body>
</subsection>
<subsection>
<title>Автоматический запуск сетевого подключения при загрузке</title>
<body>

<p>
Для запуска сетевых интерфейсов при загрузке необходимо добавить их в уровень 
запуска по умолчанию.
</p>

<pre caption="Добавление net.eth0 в уровень запуска default">
# <i>cd /etc/init.d</i>
# <i>ln -s net.lo net.eth0</i>
# <i>rc-update add net.eth0 default</i>
</pre>

<p>
Если у вас несколько сетевых интерфейсов, потребуется создать для них 
файлы <path>net.*</path>, как вы только что сделали для
<path>net.eth0</path>.
</p>

<p>
Если позже вы выясните, что предположение о имени сетевого интерфейса (которое,
как мы подразумеваем, eth0), было ошибочным, тогда
</p>

<ol>
<li>
обновите файл <path>/etc/conf.d/net</path> и внесите туда правильное имя
интерфейса (например, enp3s0 вместо eth0),
</li>
<li>
создайте новую символическую ссылку (вроде <path>/etc/init.d/net.enp3s0</path>),
</li>
<li>
удалите старую символическую ссылку (<c>rm /etc/init.d/net.eth0</c>),
</li>
<li>
добавьте новую на уровень запуска default, и 
</li>
<li>
удалите старую, используя <c>rc-update del net.eth0 default</c>.
</li>
</ol>

</body>
</subsection>
<subsection>
<title>Указание сетевых узлов</title>
<body>

<p>
Теперь расскажем системе Linux о вашей сети. Эти сведения указываются в 
<path>/etc/hosts</path>, и помогают разрешению имен в IP-адреса для узлов, не 
обрабатываемых сервером имен. Требуется определить вашу систему. Также можно
определить другие системы в сети, если вы не собираетесь устанавливать
собственную систему DNS.
</p>

<pre caption="Открытие /etc/hosts">
# <i>nano -w /etc/hosts</i>
</pre>

<pre caption="Указание сведений об узлах сети">
<comment>(определение текущей системы)</comment>
127.0.0.1     tux.homenetwork tux localhost

<comment>(определите другие машины в своей сети,
для этого у них должен быть статический IP-адрес.)</comment>

192.168.0.5   jenny.homenetwork jenny
192.168.0.6   benny.homenetwork benny
</pre>

<p>
Чтобы продолжить настройку, сохраните файл и выйдите из редактора.
</p>

<p test="func:keyval('arch')='AMD64' or func:keyval('arch')='x86' or substring(func:keyval('arch'),1,3)='PPC'">
Если у вас нет PCMCIA, можете перейти к разделу <uri 
link="#sysinfo">параметры системы</uri>. Пользователям PCMCIA рекомендуется
прочитать следующий раздел, посвященный PCMCIA.
</p>

</body>
</subsection>
<subsection test="func:keyval('arch')='AMD64' or func:keyval('arch')='x86' or substring(func:keyval('arch'),1,3)='PPC'">
<title>Дополнительно: запуск PCMCIA</title>
<body>

<p>
Пользователям PCMCIA нужно сначала установить пакет <c>pcmciautils</c>.
</p>

<pre caption="Установка pcmciautils">
# <i>emerge pcmciautils</i>
</pre>

</body>
</subsection>
</section>
<section id="sysinfo">
<title>Параметры системы</title>
<subsection>
<title>Пароль root</title>
<body>

<p>
Прежде всего, нужно установить пароль root (администратора), набрав:
</p>

<pre caption="Установка пароля root">
# <i>passwd</i>
</pre>

</body>
</subsection>
<subsection>
<title>Параметры системы</title>
<body>

<p>
Gentoo использует файл <path>/etc/rc.conf</path> для конфигурации сервисов,
а также для запуска и завершения работы вашей системы. Откройте
<path>/etc/rc.conf</path>, и с удовольствием прочитайте все комментарии, 
находящиеся в этом файле.
</p>

<pre caption="Настраиваем сервисы">
# <i>nano -w /etc/rc.conf</i>
</pre>

<p>
Завершив изменение этих двух файлов, сохраните их и выйдите из редактора.
</p>

<p>
Для управления раскладками клавиатуры в Gentoo используется 
<path>/etc/conf.d/keymaps</path>. Для настройки своей клавиатуры измените его. 
</p>

<pre caption="Открытие /etc/conf.d/keymaps">
# <i>nano -w /etc/conf.d/keymaps</i>
</pre>

<p>
Будьте особенно тщательны c переменной <c>keymap</c>: выбрав неверную раскладку, 
вы можете получить непредсказуемый результат при попытке ввода с клавиатуры.
</p>

<note test="substring(func:keyval('arch'),1,3)='PPC'">
На большинстве систем <b>PPC</b> используются раскладки x86.
</note>

<p>
По завершении изменения <path>/etc/conf.d/keymaps</path> сохраните файл и 
выйдите из редактора.
</p>
 
<p>
Для настройки параметров часов в Gentoo используется 
<path>/etc/conf.d/hwclock</path>. Изменяйте его в соответствии со своими
потребностями.
</p>

<pre caption="Открываем /etc/conf.d/hwclock">
# <i>nano -w /etc/conf.d/hwclock</i>
</pre>

<p>
Если аппаратные часы вашей системы настроены не на часовой пояс UTC (Гринвич), 
в файл необходимо добавить строку <c>clock="local"</c>. В противном случае 
вы заметите сдвиг часового пояса.
</p>

<p>
После завершения настройки <path>/etc/conf.d/hwclock</path> сохраните файл
и выйдите из редактора.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-date: 2014-05-27
source-cvs-revision: 1.131
translated-by: Alexey Chumakov [achumakov@gentoo.org]
edited-by: Alexey Chumakov
edited-by: Vladmimir Romanov [blueboar2@gmail.com]
-->
