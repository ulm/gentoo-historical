<?xml version='1.0' encoding='UTF-8'?>
<!-- *$Localization:
target-language: Russian
target-version: 2.2-r3
target-date: 2005-05-03
translated-by: (1.51 translator wanted!); Alexey Chumakov [info@chumakov.ru]
edited-by: none 
proof-by: none
links_checked_by: none
tested_by: none
-->

<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-config.xml,v 1.2 2005/05/27 19:47:35 sergey Exp $ -->
<!-- REV: 1.60 -->

<sections>

<version>2.2</version>
<date>2005-04-20</date>

<section>
<title>Сведения о файловой системе</title>
<subsection>
<title>Что такое fstab?</title>
<body>

<p>
В Linux все разделы, используемые системой, должны быть перечислены в <path>/etc/fstab</path>.
В этом файле указываются точки подключения разделов (mountpoints,
местоположение разделов в файловой системе), порядок подключения,
а также дополнительные параметры (автоматическое/ручное подключение, 
возможность подключения с правами пользователя и т.п.)
</p>

</body>
</subsection>
<subsection>
<title>Создание /etc/fstab</title>
<body>

<p>
В <path>/etc/fstab</path> используется специальный синтаксис. Каждая строка
состоит из шести полей, разделенных пробелами, знаками табуляции или их
сочетанием. Каждое поле имеет свое назначение:
</p>

<ul>
<li>
Первое поле обозначает <b>раздел (partition)</b> (путь к файлу устройства) 
</li>
<li>
Второе поле указывает <b>точку подключения (mountpoint)</b>, в которую монтируется раздел
</li>
<li>
Третье поле задает тип <b>файловой системы (filesystem)</b>, использующейся в разделе
</li>
<li>
В четвертом поле указываются <b>параметры подключения</b>,
используемые <c>mount</c> при подключении раздела.
Поскольку для каждой файловой системы существуют свои параметры,
рекомендуется прочитать страницу справки по mount (<c>man mount</c>), где
приведен полный перечень. При указании нескольких параметров подключения
их следует разделять запятыми.
</li>
<li>
Пятое поле используется <c>dump</c> для определения, требуется ли резервное 
копирование раздела средствами dump. Обычно это поле можно просто установить 
в <c>0</c> (ноль).
</li>
<li>
Шестое поле используется <c>fsck</c> для определения порядка <b>проверки (check)</b>
файловых систем после некорректного завершения работы системы. Для корневой файловой системы рекомендуется
значение <c>1</c>, а для остальных — <c>2</c> (или <c>0</c>, когда проверка
файловой системы не требуется).
</li>
</ul>

<p>
Файл <path>/etc/fstab</path> по умолчанию, входящий в Gentoo, <e>не является
работоспособным</e>, поэтому необходимо
создать собственный <path>/etc/fstab</path>, запустив <c>nano</c>
(или ваш любимый редактор).
</p>

<pre caption="Открытие /etc/fstab">
# <i>nano -w /etc/fstab</i>
</pre>

<p>
Рассмотрим, как указываются параметры загрузочного раздела <path>/boot</path>.
Это лишь пример, и если в вашей архитектуре не требуется раздел
<path>/boot</path> (например, как в <b>PPC</b>), не копируйте пример дословно.
</p>

<p>
Для примера возьмем архитектуру x86, <path>/boot</path> — это раздел на
устройстве <path>/dev/hda1</path> с файловой системой <c>ext2</c>. 
При загрузке требуется его проверка. Напишем следующее:
</p>

<pre caption="Пример строки /boot в /etc/fstab">
/dev/hda1   /boot     ext2    defaults        1 2
</pre>

<p>
Некоторые пользователи предпочитают не подключать раздел <path>/boot</path>
автоматически, чтобы повысить безопасность системы. Для этого нужно заменить
<c>defaults</c> на <c>noauto</c>. В этом случае вам придется подключать 
раздел вручную каждый раз, когда он потребуется.
</p>

<p>
Теперь, чтобы повысить быстродействие, большинству пользователей
стоит добавить параметр <c>noatime</c> в параметры подключения,
что приведет к ускорению за счет отключения регистрации отметки времени доступа
к файлам (обычно в ней все равно нет необходимости): 
</p>

<pre caption="Улучшенная строка /boot в /etc/fstab">
/dev/hda1   /boot     ext2    defaults,noatime    1 2
</pre>

<p>
Продолжая в том же духе, получим следующие три строки
(для <path>/boot</path>, <path>/</path>, и раздела подкачки):
</p>

<pre caption="Три строки из /etc/fstab">
/dev/hda1   /boot     ext2    defaults,noatime  1 2
/dev/hda2   none      swap    sw                0 0
/dev/hda3   /         ext3    noatime           0 1
</pre>

<p>
И наконец, добавим правила для <path>/proc</path>, <c>tmpfs</c>
(обязательно), а также для дисковода CD-ROM. Если у вас есть другие разделы или
устройства, их тоже нужно указать:
</p>

<pre caption="Пример полного /etc/fstab">
/dev/hda1   /boot     ext2    defaults,noatime     1 2
/dev/hda2   none      swap    sw                   0 0
/dev/hda3   /         ext3    noatime              0 1

none        /proc     proc    defaults             0 0
none        /dev/shm  tmpfs   nodev,nosuid,noexec  0 0

/dev/cdroms/cdrom0    /mnt/cdrom    auto      noauto,user    0 0
</pre>

<p>
Параметр <c>auto</c> позволит <c>mount</c> определять тип файловой системы
автоматически (рекомендуется для съемных носителей, которые 
могут быть размечены в одной из множества файловых систем),
а <c>user</c> позволит подключать CD обычным пользователям.
</p>

<p>
Теперь с помощью приведенного примера создайте свой файл <path>/etc/fstab</path>.
Если вы — пользователь <b>SPARC</b>, также добавьте следующую строку в свой
<path>/etc/fstab</path>:
</p>

<pre caption="Добавление файловой системы openprom в /etc/fstab">
none        /proc/openprom  openpromfs    defaults      0 0
</pre>

<p>
Дважды перепроверьте свой файл <path>/etc/fstab</path>, сохраните его, и выйдите из редактора, чтобы продолжить настройку.
</p>

</body>
</subsection>
</section>
<section>
<title>Сведения о настройке сети</title>
<subsection>
<title>Hostname, Domainname и т. д.</title>
<body>

<p>
Еще один вопрос, который нужно решить пользователю — как назвать свой компьютер.
Он кажется довольно простым, но <e>многие</e> пользователи затрудняются дать
подходящее имя для своей Linux-системы. Чтобы вам стало легче, знайте, что какое
бы имя вы ни выбрали, потом вы сможете его изменить. Например, вы могли бы
просто назвать свою систему <c>tux</c>, а домен — <c>homenetwork</c>.  
</p>

<p>
Мы будем использовать эти значения в следующих примерах. Во-первых, установим
имя хоста (hostname):
</p>

<pre caption="Установка имени хоста">
# <i>echo tux &gt; /etc/hostname</i>
</pre>

<p>
Во-вторых, установим имя домена (domainname):
</p>

<pre caption="Установка имени домена">
# <i>echo homenetwork &gt; /etc/dnsdomainname</i>
</pre>

<p>
Если у вас есть домен NIS (а если вы не знаете, что это такое, то у вас его нет),
его также необходимо указать: 
</p>

<pre caption="Установка имени NIS-домена">
# <i>echo nis.homenetwork &gt; /etc/nisdomainname</i>
</pre>

<p>
Теперь добавьте сценарий <c>domainname</c> к уровню запуска по умолчанию (default runlevel):
</p>

<pre caption="Добавление domainname в default runlevel">
# <i>rc-update add domainname default</i>
</pre>

</body>
</subsection>
<subsection>
<title>Настройка сети</title>
<body>

<p>
Прежде, чем возмутиться: «Эй, мы же это все уже делали!» — вспомните, что 
подключение к сети, настроенное вначале, было предназначено лишь для установки
Gentoo. Теперь же вы настроите сеть для постоянного использования.
</p>

<p>
Все сведения о настройке сети собраны в файле <path>/etc/conf.d/net</path>.
В нем используется простой синтаксис, хотя, если вы не знакомы с ручной
настройкой сети, он не очевиден. Но не бойтесь, мы все объясним :)
</p>

<p>
Во-первых, откройте <path>/etc/conf.d/net</path> в своем любимом редакторе 
(в этом примере используется <c>nano</c>):
</p>

<pre caption="Открытие /etc/conf.d/net для редактирования">
# <i>nano -w /etc/conf.d/net</i>
</pre>

<!-- Old baselayout - current stable -->

<p>
Первая переменная, которая вам встретится — <c>iface_eth0</c>. У нее такой
синтаксис: 
</p>

<pre caption="Синтаксис iface_eth0">
iface_eth0="<i>&lt;ваш ip-адрес&gt;</i> broadcast <i>&lt;ваш широковещательный адрес&gt;</i> netmask <i>&lt;ваша сетевая маска&gt;</i>"
</pre>

<p>
Если вы используете DHCP (автоматическое получение IP-адреса), просто установите
<c>iface_eth0</c> в значение <c>dhcp</c>. Если вы используете rp-pppoe (например,
для ADSL), установите значение <c>up</c>. 
Если вам нужно настроить сетевое подключение вручную, и вы не знакомы с
этими терминами, прочитайте раздел <uri link="?part=1&amp;chap=3#network_term">Понимание
сетевой терминологии</uri>, если вы еще этого не сделали.
</p>

<p>
Итак, приведем три примера: в первом используется DHCP, во втором —
статический IP (192.168.0.2) с сетевой маской 255.255.255.0, широковещательным адресом 192.168.0.255 
и шлюзом 192.168.0.1, а третий просто включает интерфейс для работы через rp-pppoe:
</p>

<pre caption="Примеры /etc/conf.d/net">
<comment>(для DHCP)</comment>
iface_eth0="dhcp"
<comment># Некоторые сетевые администраторы требуют, чтобы использовались</comment>
<comment># имя хоста и имя домена, полученные с DHCP-сервера. Чтобы</comment>
<comment># dhcpd использовал их, добавьте следующую строку. Это приведет </comment>
<comment># к подмене собственных значений имени узла и домена.</comment>
dhcpcd_eth0="-HD"
<comment># Если вы намерены использовать NTP для синхронизации часов, используйте</comment>
<comment># параметр -N для того, чтобы dhcpcd не перезаписывал ваш файл /etc/ntp.conf.</comment>
dhcpcd_eth0="-N"

<comment>(для статического IP)</comment>
iface_eth0="192.168.0.2 broadcast 192.168.0.255 netmask 255.255.255.0"
gateway="eth0/192.168.0.1"

<comment>(для rp-pppoe)</comment>
iface_eth0="up"
</pre>

<p>
Если у вас несколько сетевых интерфейсов, создайте дополнительные 
переменные <c>iface_eth</c>, например, <c>iface_eth1</c>, <c>iface_eth2</c> и т. д.
Переменную <c>gateway</c> повторять не следует, поскольку на одном компьютере
можно установить только один шлюз.
</p>

<!-- New baselayout - current testing

<p>
Первая переменная, которая вам встретится — <c>config_eth0</c>.
Как вы могли предположить, эта переменная отвечает за настройку сетевого
интерфейса eth0. Если нужно, чтобы интерфейс автоматически получал
параметры IP через DHCP, следует написать так:
</p>

<pre caption="Автоматическое получение параметров IP для eth0">
config_eth0=( "dhcp" )
</pre>

<p>
Однако, если вам нужно ввести свой собственный IP-адрес, маску сети
и шлюз, потребуется настроить как <c>config_eth0</c>, так и <c>routes_eth0</c>:
</p>

<pre caption="Ручная настройка параметров IP для eth0">
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )
routes_eth0=( "default gw 192.168.0.1" )
</pre>

<p>
Если у вас несколько сетевых интерфейсов, повторите эти шаги для
<c>config_eth1</c>, <c>config_eth2</c> и т.д.
</p>

-->

<p>
Теперь сохраните конфигурацию и выйдите из редактора, чтобы продолжить настройку.
</p>

</body>
</subsection>
<subsection>
<title>Автоматический запуск сетевого подключения при загрузке</title>
<body>

<p>
Для включения сетевых интерфейсов при загрузке необходимо добавить
их в уровень запуска по умолчанию. Если у вас интерфейсы типа PCMCIA,
пропустите этот шаг, поскольку интерфейсы PCMCIA включаются
сценарием инициализации PCMCIA.
</p>

<pre caption="Добавление net.eth0 в default runlevel">
# <i>rc-update add net.eth0 default</i>
</pre>

<p>
Если у вас несколько сетевых интерфейсов, потребуется создать для них
соответствующие сценарии инициализации <path>net.eth1</path>, <path>net.eth2</path> и т. д.
Для этого можно использовать <c>ln</c>:
</p>

<pre caption="Создание дополнительных сценариев инициализации">
# <i>cd /etc/init.d</i>
# <i>ln -s net.eth0 net.eth1</i>
# <i>rc-update add net.eth1 default</i>
</pre>

</body>
</subsection>
<subsection>
<title>Запись сведений о сети</title>
<body>

<p>
Теперь расскажем системе Linux о вашей сети.
Эти сведения указываются в <path>/etc/hosts</path>, и
помогают разрешению имен в IP-адреса для хостов,
не обрабатываемых  сервером имен. Например,
если внутренняя сеть состоит из трех компьютеров,
названных <c>jenny</c> (192.168.0.5), <c>benny</c> (192.168.0.6)
и <c>tux</c> (192.168.0.7 — рассматриваемая система),
нужно открыть <path>/etc/hosts</path> и ввести такие значения:
</p>

<pre caption="Открытие /etc/hosts">
# <i>nano -w /etc/hosts</i>
</pre>

<pre caption="Задание сведений о сети">
127.0.0.1     localhost
192.168.0.5   jenny.homenetwork jenny
192.168.0.6   benny.homenetwork benny
192.168.0.7   tux.homenetwork tux
</pre>

<p>
Если ваша система — единственная (или разрешение имен полностью
осуществляется серверами имен), хватит и одной строки.
Например, если вы назвали свою систему <c>tux</c>:
</p>

<pre caption="/etc/hosts для автономных или полностью интегрированных PC">
127.0.0.1     localhost tux
</pre>

<p>
Сохраните файл и выйдите из редактора, чтобы продолжить настройку.
</p>

<p>
Если у вас нет PCMCIA, можете перейти к разделу <uri link="#doc_chap3">Сведения о системе</uri>.
Пользователям PCMCIA рекомендуется прочитать следующий раздел, посвященный PCMCIA.
</p>

</body>
</subsection>
<subsection>
<title>Необязательный шаг: запуск PCMCIA</title>
<body>

<note>
pcmcia-cs существует только на платформах x86, amd64 and ppc.
</note>

<p>
Прежде всего, пользователям PCMCIA нужно установить пакет <c>pcmcia-cs</c>.
Это относится и к пользователям, работающим с ядром 2.6 (даже если они
не будут пользоваться драйверами PCMCIA из этого пакета).
Можете указать <c>USE="-X"</c>, чтобы избежать установки
xorg-x11:
</p>

<pre caption="Установка pcmcia-cs">
# <i>USE="-X" emerge pcmcia-cs</i>
</pre>

<p>
После установки <c>pcmcia-cs</c> добавьте <c>pcmcia</c> в уровень запуска
<e>по умолчанию (default runlevel)</e>:
</p>

<pre caption="Добавление pcmcia в default runlevel">
# <i>rc-update add pcmcia default</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Системные параметры</title>
<subsection>
<title>Пароль root</title>
<body>

<p>
Сначала установите пароль root, набрав:
</p>

<pre caption="Установка пароля root">
# <i>passwd</i>
</pre>

<p>
Если вы хотите, чтобы root мог входить в систему через последовательную
консоль, добавьте <c>tts/0</c> в <path>/etc/securetty</path>:
</p>

<pre caption="Добавление tts/0 to /etc/securetty">
# <i>echo "tts/0" &gt;&gt; /etc/securetty</i>
</pre>

</body>
</subsection>
<subsection>
<title>Системные параметры</title>
<body>

<p>
Для общесистемной конфигурации в Gentoo используется <path>/etc/rc.conf</path>.
Откройте <path>/etc/rc.conf</path> и насладитесь обильными комментариями, 
находящихся в этом файле :)
</p>

<pre caption="Открытие /etc/rc.conf">
# <i>nano -w /etc/rc.conf</i>
</pre>

<p>
Как видите, этот файл хорошо прокомментировано, что поможет вам
в настройке необходимых конфигурационных переменных.
Будьте особенно внимательны при установке <c>раскладки клавиатуры (KEYMAP)</c>:
выбрав неверную раскладку,  вы можете получить странные результаты
при попытке ввода с клавиатуры.
</p>

<note>
Пользователям систем SPARC, снабженных USB, и клонов SPARC может
потребоваться вместо раскладки «sunkeymap» указать раскладку i386
(например, американскую — «us»).
</note>

<p>
На большинстве систем <b>PPC</b> используются раскладки x86.
Пользователям, желающим при загрузке иметь возможность использования
раскладок клавиатуры ADB, необходимо разрешить
обработку клавиатурных кодов ADB в ядре, и установить раскладку mac/ppc в <path>rc.conf</path>.
</p>

<p>
После завершения конфигурирования <path>/etc/rc.conf</path> сохраните файл
и выйдите из редактора.
</p>

<p>
Если вы устанавливаете Gentoo не на систему IBM POWER5 или JS20, переходите к разделу
<uri link="?part=1&amp;chap=9">Установка необходимых системных средств</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Конфигурация консоли</title>
<body>

<note>
Следующий параграф относится к аппаратным платформам IBM POWER5 и JS20.
</note>

<p>
Если вы запускаете Gentoo на системе LPAR или JS20 blade, необходимо
раскомментировать строку hvc в /etc/inittab, чтобы виртуальная консоль порождала запрос входа в
систему. 
</p>

<pre caption="Включение поддержки hvc в /etc/inittab">
hvc:12345:respawn:/sbin/agetty -nl /bin/bashlogin 9600 hvc0 vt220
</pre>

<p>
Теперь можете переходить к разделу <uri link="?part=1&amp;chap=9">Установка
необходимых системных средств</uri>.
</p>

</body>
</subsection>
</section>
</sections>
