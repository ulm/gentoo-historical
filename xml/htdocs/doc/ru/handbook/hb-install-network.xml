<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-network.xml,v 1.14 2013/02/23 17:47:16 swift Exp $ -->

<sections>

<abstract>
Чтобы загрузить новейший исходный код, потребуется настройка сети.
</abstract>

<version>5</version>
<date>2013-01-02</date>

<section>
<title>Автоматическое подключение к сети</title>
<subsection>
<title>Может, она уже настроена?</title>
<body>

<p>
Если ваша система подсоединена к сети Ethernet, в которой есть сервер DHCP, 
очень вероятно, что сетевое подключение на вашей машине уже автоматически 
настроено. Если это так, вы сможете воспользоваться многими сетевыми командами, 
находящимися на установочном компакт-диске, например, <c>ssh</c>, <c>scp</c>, 
<c>ping</c>, <c>irssi</c>, <c>wget</c> и <c>links</c>.
</p>

<p>
Если сеть уже настроена, команда <c>ifconfig</c> должна показывать сетевые
интерфейсы кроме lo, например, eth0:
</p>

<pre caption="ifconfig для рабочей сетевой конфигурации">
# <i>ifconfig</i>
<comment>(...)</comment>
eth0      Link encap:Ethernet  HWaddr 00:50:BA:8F:61:7A
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::50:ba8f:617a/10 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1498792 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1284980 errors:0 dropped:0 overruns:0 carrier:0
          collisions:1984 txqueuelen:100
          RX bytes:485691215 (463.1 Mb)  TX bytes:123951388 (118.2 Mb)
          Interrupt:11 Base address:0xe800 
</pre>

</body>
</subsection>
<subsection>
<title>Дополнительно: указание прокси-серверов</title>
<body>

<p>
Если вы подключены к интернету через прокси-сервер, при установке вам может 
потребоваться ввести сведения о нем. Задать прокси-сервер очень просто: нужно
определить переменные, содержащие необходимые сведения.
</p>

<p>
В большинстве случаев в определении переменных достаточно указать имя 
прокси-сервера. Предположим, например, что прокси-сервер называется  
<c>proxy.gentoo.org</c>, а его порт &mdash; <c>8080</c>:
</p>

<pre caption="Указание прокси-сервера">
<comment> (если прокси-сервер фильтрует трафик HTTP)</comment>
# <i>export http_proxy="http://proxy.gentoo.org:8080"</i>
<comment> (если прокси-сервер фильтрует трафик FTP)</comment>
# <i>export ftp_proxy="ftp://proxy.gentoo.org:8080"</i>
<comment> (если прокси-сервер фильтрует трафик RSYNC)</comment>
# <i>export RSYNC_PROXY="proxy.gentoo.org:8080"</i>
</pre>

<p>
Если прокси-сервер запрашивает имя пользователя и пароль, для значения 
переменной следует использовать такой формат:
</p>

<pre caption="Указание имени/пароля в адресе прокси-сервера">
http://<i>имя_пользователя</i>:<i>пароль</i>@proxy.gentoo.org:8080
</pre>

</body>
</subsection>
<subsection>
<title>Проверка сети</title>
<body>

<p>
Может оказаться полезным проверить отклик DNS-сервера вашего поставщика услуг 
интернета (адрес сервера находится в <path>/etc/resolv.conf</path>), а также 
произвольного веб-сайта, чтобы убедиться, что ваши пакеты выходят в интернет, 
разрешение имен DNS работает и т.д.
</p>

<pre caption="Проверка доступности сети">
# <i>ping -c 3 www.gentoo.org</i>
</pre>

<p>
Сеть доступна? Тогда пропустите остаток этого раздела, и переходите к разделу
<uri link="?part=1&amp;chap=4">подготовка дисков</uri>. Если сеть все еще
недоступна, то читайте следующий раздел. 
</p>

</body>
</subsection>
</section>
<section>
<title>Автоматизированная настройка сети</title>
<subsection>
<body>

<p>
Если сеть не заработает сразу, при установке с некоторых носителей можно 
использовать <c>net-setup</c> (для обычных или беспроводных сетей), 
<c>pppoe-setup</c> (для пользователей ADSL) или <c>pptp</c> (для пользователей 
PPTP; есть на x86, amd64, alpha, ppc и ppc64).
</p>

<p>
Если на вашем установочном диске нет ни одного из этих средств, или сеть еще не 
подключена, приступайте к <uri link="#doc_chap3">ручной настройке сети</uri>:
</p>

<ul>
  <li>
    пользователи обычной сети Ethernet &mdash; переходите к разделу
    <uri link="#net-setup">по умолчанию: использование net-setup</uri>
  </li>
  <li>
    пользователи ADSL &mdash; переходите к разделу
    <uri link="#ppp">альтернатива: использование PPP</uri>
  </li>
  <li>
    пользователи PPTP &mdash; переходите к разделу
    <uri link="#pptp">альтернатива: использование PPTP</uri>
  </li>
</ul>

</body>
</subsection>
<subsection id="net-setup">
<title>По умолчанию: использование net-setup</title>
<body>

<p>
Простейший способ настройки сети, если она не произошла автоматически &mdash; 
запуск сценария <c>net-setup</c>:
</p>

<pre caption="Запуск сценария net-setup">
# <i>net-setup eth0</i>
</pre>

<p>
<c>net-setup</c> задаст вам несколько вопросов о вашей сетевой среде. В 
результате его работы у вас должно появиться работоспособное подключение к 
сети. Проверьте сетевое подключение, как это описано выше. Если проверка прошла 
успешно, примите наши поздравления &mdash; теперь вы готовы к установке 
Gentoo. Пропустите оставшуюся часть этого раздела и приступайте к <uri 
link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

<p>
Если ваша сеть все еще не заработала, переходите к <uri 
link="#doc_chap3">ручной настройке сети</uri>.
</p>

</body>
</subsection>
<subsection id="ppp">
<title>Альтернатива: использование PPP</title>
<body>

<p>
Для простоты подключения к интернету по PPPoE, в установочный диск (любой 
версии) включен <c>ppp</c>. Для настройки соединения используйте сценарий 
<c>pppoe-setup</c>, входящий в комплект. У вас будет запрошена информация о 
сетевом устройстве ethernet, подключенном к adsl-модему, имя пользователя, 
пароль, IP-адреса ваших серверов DNS. Также задается вопрос, нужно ли включать 
базовый межсетевой экран (firewall).
</p>

<pre caption="Использование ppp">
# <i>pppoe-setup</i>
# <i>pppoe-start</i>
</pre>

<p>
Если что-то пошло не так, проверьте, правильно ли вы ввели имя пользователя и 
пароль, посмотрев в <path>/etc/ppp/pap-secrets</path> или 
<path>/etc/ppp/chap-secrets</path>, и убедитесь, что устройство ethernet 
указано верно. Если ваше устройство не видно в системе, потребуется загрузить 
соответствующие сетевые модули. Для этого нужно перейти к разделу <uri 
link="#doc_chap3">ручная настройка сети</uri> где мы объясняем, как из 
загрузить.
</p>

<p>
Если же все заработало, переходите к <uri link="?part=1&amp;chap=4">подготовке
дисков</uri>.
</p>

</body>
</subsection>
<subsection id="pptp">
<title>Альтернатива: использование PPTP</title>
<body>

<p>
Если вам нужна поддержка PPTP, можно использовать <c>pptpclient</c>, который 
входит в состав нашего установочного диска. Но сначала нужно обеспечить 
правильность настройки. Отредактируйте файлы <path>/etc/ppp/pap-secrets</path>
или <path>/etc/ppp/chap-secrets</path> так, чтобы в них находилось правильное 
сочетание имени пользователя и пароля.
</p>

<pre caption="Редактирование /etc/ppp/chap-secrets">
# <i>nano -w /etc/ppp/chap-secrets</i>
</pre>

<p>
Затем, если нужно, измените параметры PPTP в файле 
<path>/etc/ppp/options.pptp</path>:
</p>

<pre caption="Редактирование /etc/ppp/options.pptp">
# <i>nano -w /etc/ppp/options.pptp</i>
</pre>

<p>
Когда все будет готово, просто запустите <c>pptp</c> (с параметрами, которые вы 
не стали прописывать в <path>options.pptp</path>), чтобы соединиться с сервером:
</p>

<pre caption="Подключение к серверу коммутируемого доступа">
# <i>pptp &lt;server ip&gt;</i>
</pre>

<p>
Теперь переходите к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Ручная настройка сети</title>
<subsection>
<title>Загрузка нужных сетевых модулей</title>
<body>

<p>
При загрузке установочный диск пытается выявить все установленные устройства 
и загружает подходящие модули ядра (драйверы) для поддержки вашего 
оборудования. В подавляющем большинстве случаев он очень хорошо справляется с 
этой работой. Однако, в некоторых случаях он может не справиться с 
автозагрузкой нужных вам модулей ядра.
</p>

<p>
Если <c>net-setup</c> или <c>pppoe-setup</c> не удалось загрузить нужный
модуль, возможно, ваша сетевая плата сразу не обнаружена. При этом вам может
потребоваться ручная загрузка необходимых модулей ядра.
</p>

<p>
Чтобы выяснить, какие модули ядра для поддержки сети существуют, используйте
<c>ls</c>:
</p>

<pre caption="Поиск имеющихся модулей">
# <i>ls /lib/modules/`uname -r`/kernel/drivers/net</i>
</pre>

<p>
Если вы найдете драйвер для своей сетевой платы, для загрузки модуля ядра 
используйте <c>modprobe</c>:
</p>

<pre caption="Использование modprobe для загрузки модуля ядра">
<comment>(для примера загрузим модуль pcnet32)</comment>
# <i>modprobe pcnet32</i>
</pre>

<p>
Чтобы убедиться, что ваша сетевая плата теперь обнаружена, используйте 
<c>ifconfig</c>. Если сетевая плата обнаружена, результат выглядит подобным 
образом:
</p>

<pre caption="Проверка доступности сетевой платы (удачная)">
# <i>ifconfig eth0</i>
eth0      Link encap:Ethernet  HWaddr FE:FD:00:00:00:00  
          BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</pre>

<p>
Однако, если вы получите такое сообщение об ошибке, сетевая плата не 
обнаружена:
</p>

<pre caption="Проверка доступности сетевой платы (неудачная)">
# <i>ifconfig eth0</i>
eth0: error fetching interface information: Device not found
</pre>

<p>
Если в вашей системе установлено несколько сетевых плат, они будут называться 
<e>eth0</e>, <e>eth1</e> и т.д. Убедитесь, что сетевая плата, которую вы 
собираетесь использовать, работает хорошо, и в дальнейшем не забудьте везде 
подставлять верное имя. Мы предполагаем, что используется сетевая плата 
<e>eth0</e>.
</p>

<p>
Когда ваша сетевая плата обнаружена, можно попробовать снова запустить 
<c>net-setup</c> или <c>pppoe-setup</c> (которые теперь должны сработать), но
на случай, если вы из крутых, мы опишем, как настроить сеть вручную.
</p>

<p>
Выберите один из следующих разделов, в зависимости от необходимого вида 
настройки:
</p>

<ul>
  <li>
    <uri link="#install-dhcp">использование DHCP</uri> для автоматического 
    присвоения IP-адреса
  </li>
  <li>
    <uri link="#wireless">подготовка беспроводного доступа</uri>, если у вас
    есть беспроводная плата
  </li>
  <li>
    <uri link="#network_term">освоение сетевой терминологии</uri>: рассказ о
    том, что нужно знать о подключении к сети
  </li>
  <li>
    <uri link="#ifconfig_route">использование ifconfig и route</uri>: описание
    ручной настройки сети
  </li>
</ul>

</body>
</subsection>
<subsection id="install-dhcp">
<title>Использование DHCP</title>
<body>

<p>
DHCP (Dynamic Host Configuration Protocol &mdash; протокол динамической 
настройки хоста) дает возможность автоматически получить параметры сетевого 
подключения (IP-адрес, маску сети, широковещательный адрес, шлюз, сервера имен 
и т. д.) Все это работает, только когда в вашей сети есть сервер DHCP (или ваш 
поставщик предоставляет услугу DHCP). Чтобы сетевой интерфейс получал эти 
сведения автоматически, используйте <c>dhcpcd</c>:
</p>

<pre caption="Использование dhcpcd">
# <i>dhcpcd eth0</i>
<comment>Некоторые сетевые администраторы требуют, чтобы вы использовали</comment>
<comment>имя хоста и домена, назначенное сервером DHCP.</comment>
<comment>В этом случае используйте</comment>
# <i>dhcpcd -HD eth0</i>
</pre>

<p>
Если это сработало (попробуйте &laquo;попинговать&raquo; какой-нибудь сервер 
интернета, например, <uri link="http://www.google.com">Google</uri>), то у вас 
все настроено, и можно двигаться дальше. Пропустите остаток этого раздела и 
приступайте к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
<subsection id="wireless">
<title>Подготовка беспроводного доступа</title>
<body>

<note>
Поддержка команды <c>iwconfig</c> есть только на установочных дисках для 
платформ x86, amd64 и ppc. В других случаях вы все же сможете запустить 
расширения, следуя инструкциям <uri 
link="ftp://ftp.linux-wlan.org/pub/linux-wlan-ng/README">проекта 
linux-wlan-ng (англ.)</uri>.
</note>

<p>
Если вы используете беспроводную плату (802.11), перед дальнейшими действиями 
может потребоваться настройка параметров беспроводного подключения. Для 
просмотра текущей настройки беспроводной платы можете использовать 
<c>iwconfig</c>. При запуске <c>iwconfig</c> вы увидите подобные сведения:
</p>

<pre caption="Вывод текущих параметров беспроводного подключения">
# <i>iwconfig eth0</i>
eth0      IEEE 802.11-DS  ESSID:"GentooNode"                                   
          Mode:Managed  Frequency:2.442GHz  Access Point: 00:09:5B:11:CC:F2    
          Bit Rate:11Mb/s   Tx-Power=20 dBm   Sensitivity=0/65535               
          Retry limit:16   RTS thr:off   Fragment thr:off                       
          Power Management:off                                                  
          Link Quality:25/10  Signal level:-51 dBm  Noise level:-102 dBm        
          Rx invalid nwid:5901 Rx invalid crypt:0 Rx invalid frag:0 Tx          
          excessive retries:237 Invalid misc:350282 Missed beacon:84            
</pre>

<note>
Некоторые беспроводные платы могут называться подобно <c>wlan0</c> или 
<c>ra0</c>, а не <c>eth0</c>. Для определения верного имени устройства 
запускайте <c>iwconfig</c> без каких-либо параметров командной строки.
</note>

<p>
Для большинства пользователей может потребоваться изменение только двух 
параметров: ESSID (названия беспроводной сети) и ключа шифрования WEP. Если 
ESSID и указанный адрес точки доступа уже принадлежат вашей точке доступа, и 
вы не используете WEP, значит, ваше беспроводное подключение работает. Если вам 
необходимо изменить свой ESSID или добавить ключ WEP, можно запустить следующие 
команды:
</p>

<note>
Если ваша беспроводная сеть настроена с WPA или WPA2, вам нужно использовать
<c>wpa_supplicant</c>. Для более детальной информации по конфигурации
беспроводной сети в Gentoo Linux, пожалуйста, прочитайте главу
<uri link="?part=4&amp;chap=4">Беспроводная Сеть</uri> в настольной книге Gentoo.
</note>

<pre caption="Замена ESSID и/или добавление ключа WEP">
<comment>(так название сети устанавливается в "GentooNode")</comment>
# <i>iwconfig eth0 essid GentooNode</i>

<comment>(так устанавливается шестнадцатиричный ключ WEP)</comment>
# <i>iwconfig eth0 key 1234123412341234abcd</i>

<comment>(так устанавливается текстовый ключ (ASCII); вначале нужно добавлять "s:")</comment>
# <i>iwconfig eth0 key s:some-password</i>
</pre>

<p>
Проверить сделанную настройку можно, снова запустив <c>iwconfig</c>. Как только 
ваша беспроводная сеть заработает, вы можете перейти к установке параметров 
сети, относящихся к протоколу IP, которые описываются в следующем разделе 
(<uri link="#network_term">освоение сетевой терминологии</uri>), или 
использовать утилиту <c>net-setup</c>, как описано ранее.
</p>

</body>
</subsection>
<subsection id="network_term">
<title>Освоение сетевой терминологии</title>
<body>

<note>
Если вы знаете свой IP-адрес, широковещательный адрес, маску сети и серверы 
имен, можете пропустить этот подраздел и перейти к разделу <uri 
link="#ifconfig_route">использование ifconfig и route</uri>.
</note>

<p>
Если все, рассказанное выше, не помогло, вам придется настроить свою сеть 
вручную. Это совсем нетрудно. Однако, вам понадобится освоить кое-какую сетевую
терминологию, знание которой требуется для удовлетворительной настройки 
сети. Прочитав этот текст, вы узнаете, что такое <e>шлюз</e>, зачем служит 
<e>маска сети</e>, как формируется <e>широковещательный адрес</e>, и зачем 
нужны <e>серверы имен</e>.
</p>

<p>
В сети узлы (хосты, компьютеры) различаются по <e>IP-адресу</e> (адресу 
протокола интернета). Такой адрес &mdash; это сочетание четырех чисел от 0 до 
255. Ну, по крайней мере, так мы его воспринимаем. В действительности, IP-адрес 
состоит из 32 бит (единиц и нулей). Давайте рассмотрим пример:
</p>

<pre caption="Пример IP-адреса">
IP-адрес (числа):       192.168.0.2
IP-адрес (биты):        11000000 10101000 00000000 00000010
                        -------- -------- -------- --------
                           192      168       0        2
</pre>

<p>
Такой IP-адрес уникален для узла в рамках всех доступных сетей (т. е. каждый 
узел, с которым вы можете связаться, должен иметь уникальный IP-адрес). Чтобы 
различать узлы, находящиеся внутри и извне сети, IP-адрес подразделяется на две 
части: часть <e>сети</e> и часть <e>узла</e>.
</p>

<p>
Это разделение записывается с помощью <e>маски сети</e> &mdash; набора единиц, 
за которым следует набор нулей. Часть IP-адреса, которая попадает на единицы 
&mdash; сетевая, оставшаяся часть &mdash; узловая. Как обычно, маска сети может 
записываться в виде IP-адреса.
</p>

<pre caption="Пример разделения сети/узла">
IP-адрес:      192      168      0         2
            11000000 10101000 00000000 00000010
Маска сети: 11111111 11111111 11111111 00000000
               255      255     255        0
           +--------------------------+--------+
                      Сеть               Узел
</pre>

<p>
Другими словами, 192.168.0.14 &mdash; все еще входит в состав сети из нашего 
примера, а 192.168.1.2 &mdash; уже нет.
</p>

<p>
<e>Широковещательный адрес</e> &mdash; это IP-адрес с такой же сетевой частью, 
как у вашей сети, но у которого узловая часть состоит только из единиц. Каждый 
узел вашей сети слушает этот IP-адрес. Он действительно предназначен для 
широковещательной рассылки пакетов.
</p>

<pre caption="Широковещательный адрес">
IP-адрес:             192      168      0         2
                   11000000 10101000 00000000 00000010
Широковещательный  11000000 10101000 00000000 11111111
адрес:                192      168      0        255
                  +--------------------------+--------+
                              Сеть              Узел
</pre>

<p>
Чтобы бороздить просторы интернета, вы должны знать, через какой узел 
происходит подключение к интернету. Этот узел называется <e>шлюзом</e>. Так как 
это обычный узел, ему присвоен обычный IP-адрес (например, 192.168.0.1).
</p>

<p>
Выше мы говорили, что каждому узлу присваивается свой собственный IP-адрес. 
Чтобы связываться с узлом по имени (вместо IP-адреса), нужна служба, которая 
переводит имя (такое, как<e> dev.gentoo.org</e>) в IP-адрес (например, 
<e>64.5.62.82</e>). Такая служба называется службой имен. Чтобы пользоваться 
ей, нужно указать необходимые <e>серверы имен</e> в 
<path>/etc/resolv.conf</path>.
</p>

<p>
Иногда ваш шлюз сам является сервером имен. В остальных случаях вам необходимо
указывать серверы имен, предоставляемые поставщиком интернета.
</p>

<p>
В итоге, для дальнейшего вам потребуется следующая информация:
</p>

<table>
<tr>
  <th>Параметр настройки сети</th>
  <th>Пример</th>
</tr>
<tr>
  <ti>Ваш IP-адрес</ti>
  <ti>192.168.0.2</ti>
</tr>
<tr>
  <ti>Маска сети</ti>
  <ti>255.255.255.0</ti>
</tr>
<tr>
  <ti>Широковещательный адрес</ti>
  <ti>192.168.0.255</ti>
</tr>
<tr>
  <ti>Шлюз</ti>
  <ti>192.168.0.1</ti>
</tr>
<tr>
  <ti>Сервер(ы) имен</ti>
  <ti>195.130.130.5, 195.130.130.133</ti>
</tr>
</table>

</body>
</subsection>
<subsection id="ifconfig_route">
<title>Использование ifconfig и route</title>
<body>

<p>
Настройка вашей сети состоит из трех шагов. Сначала мы назначаем себе IP-адрес 
с помощью <c>ifconfig</c>. Затем мы настраиваем маршрутизацию к шлюзу, 
пользуясь <c>route</c>. И в завершение мы помещаем IP-адреса серверов имен в 
<path>/etc/resolv.conf</path>.
</p>

<p>
Для назначения IP-адреса потребуется ваш IP-адрес, широковещательный адрес и
маска сети. Узнав их, выполните следующую команду, заменив <c>${IP_ADDR}</c>
на свой IP-адрес, <c>${BROADCAST}</c> на свой широковещательный адрес, а
<c>${NETMASK}</c> на свою маску сети:
</p>

<pre caption="Использование ifconfig">
# <i>ifconfig eth0 ${IP_ADDR} broadcast ${BROADCAST} netmask ${NETMASK} up</i>
</pre>

<p>
Теперь настройте маршрутизацию с помощью <c>route</c>. Подставьте IP-адрес
своего шлюза вместо <c>${GATEWAY}</c>:
</p>

<pre caption="Использование route">
# <i>route add default gw ${GATEWAY}</i>
</pre>

<p>
Затем откройте <path>/etc/resolv.conf</path> в своем любимом редакторе (в нашем
примере используется <c>nano</c>):
</p>

<pre caption="Создание /etc/resolv.conf">
# <i>nano -w /etc/resolv.conf</i>
</pre>

<p>
Заполните данные своих серверов имен по следующему образцу. Обязательно 
замените <c>${NAMESERVER1}</c> и <c>${NAMESERVER2}</c> на соответствующие
адреса серверов имен:
</p>

<pre caption="Образец /etc/resolv.conf">
nameserver ${NAMESERVER1}
nameserver ${NAMESERVER2}
</pre>

<p>
Готово. Теперь проверьте свою сеть, &laquo;попинговав&raquo; какой-либо сервер 
интернета (например, <uri link="http://www.google.com">Google</uri>). Если все 
заработало, примите наши поздравления! Теперь вы готовы к установке Gentoo. 
Приступайте к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-date: 2013-01-02
source-cvs-revision: 1.56
translated-by: Alexey Chumakov [achumakov@gentoo.org]
edited-by: Alexey Chumakov [achumakov@gentoo.org]
edited-by: Vladimir Romanov [blueboar2@gmail.com]
-->
