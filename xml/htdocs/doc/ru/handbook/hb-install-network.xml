<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-network.xml,v 1.2 2005/02/26 12:37:38 sergey Exp $ -->

<!-- REV: 1.41 -->

<sections>
<section>
<title>Автоматическое опреденеие установок сети</title>
<subsection>
<title>Может она сама заработает...</title>
<body>

<p>
Если ваша система подключена к сети Ethernet с DHCP-сервером, то вероятнее всего,
что ваша сеть уже была автоматически установлена.
Если это так, то вы можете воспользоваться преимуществом многих сетевых команд
включенных в LiveCD. Это такие команды как<c>ssh</c>, <c>scp</c>, 
<c>ping</c>, <c>irssi</c>, <c>wget</c>,<c>links</c>, и другими.
</p>

<p>
Если сеть была настроена, то команда <c>/sbin/ifconfig</c> 
должна перечислить другие сетевые интерфейсы помимо lo, например eth0:
</p>

<pre caption="/sbin/ifconfig для работающей конфигурации сети">
# <i>/sbin/ifconfig</i>
<comment>(...)</comment>
eth0      Link encap:Ethernet  HWaddr 00:50:BA:8F:61:7A
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::50:ba8f:617a/10 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1498792 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1284980 errors:0 dropped:0 overruns:0 carrier:0
          collisions:1984 txqueuelen:100
          RX bytes:485691215 (463.1 Mb)  TX bytes:123951388 (118.2 Mb)
          Interrupt:11 Base address:0xe800 
</pre>

</body>
</subsection>
<subsection>
<title>Опциoнально: Настройка прокси</title>
<body>

<p>
Если вы используете доступ к Интернет через прокси, то вам нужно сначала его установить и настроить.
Это делается очень легко: вам только надо задать переменную, которая будет содержать информацию о прокси-сервере. 
</p>

<p>В большинстве случаев, вы нужно только задать переменные, используемые
для указания имени хоста сервера.
Для примера мы будем использовать прокси с именем <e>proxy.gentoo.org</e> и 8080 портом.
</p>

<pre caption="Задание прокси серверов">
<comment>(Если прокси фильтрует HTTP трафик)</comment>
# <i>export http_proxy="http://proxy.gentoo.org:8080"</i>
<comment>(Если прокси фильтрует FTP трафик)</comment>
# <i>export ftp_proxy="ftp://proxy.gentoo.org:8080"</i>
<comment>(Если прокси фильтрует RSYNC трафик)</comment>
# <i>export rsync_proxy="rsync://proxy.gentoo.org:8080"</i>
</pre>

<p>
Если прокси требует указания имени пользователя и его пароля, то переменная должна иметь следующий синтаксис.</p>

<pre caption="Добавление имени пользователя/пароля к переменной">
http://<i>username</i>:<i>password</i>@proxy.gentoo.org:8080
</pre>

</body>
</subsection>

<subsection>
<title>Проверка сети</title>
<body>

<p>
Возможно вы захотите пропинговать ваши ISP'и DNS сервера (ищите в
<path>/etc/resolv.conf</path>) и проверить Веб-сайты на то, что вами отправляемые
пакеты их достигают а DNS-имена определяются правильно, и.т.д.
</p>

<pre caption="Проверака сети">
# <i>ping -c 3 www.yahoo.com</i>
</pre>

<p>
Ну как? Работает ваша сеть? Если да, то можете пропустить следующий раздел и
перейти к пунтку <uri link="?part=1&amp;chap=4">Подготовка дисков</uri>.
Если нет, то вам придется немного попотеть:)
</p>

</body>
</subsection>
</section>
<section>
<title>Автоматическая настройка сети</title>
<subsection>
<body>

<p>
Если сеть не была настроена сразу, некоторые инсталляционные носители позволяют
вам использовать <c>net-setup</c>
(для локальных и беспроводных сетей), <c>adsl-setup</c> (для 
ADSL-пользователей) или <c>pptp</c> (для PPTP-пользователей, но только на x86
платформе). 
</p>

<p>
Если ваш инсталляционный носитель не поддерживает ни одно выше указанное инструментальное средство, то переходите к разделу <uri link="#doc_chap4">Ручная настройка сети</uri>.
</p>

<ul>
  <li>
    Обычные Ethernet-пользователи могут перейти к разделу <uri
    link="#net-setup">По умолчанию: Использование net-setup.</uri>
  </li>
  <li>
    ADSL-пользователи могут перейти к разделу <uri link="#rp-pppoe">Альтернатива:
    Использование RP-PPPoE</uri>
  </li>
  <li>
    PPTP-пользователи могут перейти к разделу <uri link="#pptp">Альтернатива:
    Использование PPTP</uri>
  </li>
</ul>

</body>
</subsection>
<subsection id="net-setup">
<title>По умолчанию: Использование net-setup.</title>
<body>

<p>
Самый простой способ настроить и установить сеть, если это не было сделано автоматически, 
использовать скрипт <c>net-setup</c>:
</p>

<pre caption="Запуск скрипта net-setup">
# <i>net-setup eth0</i>
</pre>

<p>
<c>net-setup</c> задаст вам несколько вопросов о вашей сетевой среде.
Когда все завершится, у вас будет рабочая сеть.
Проверьте работу вашей сети как это описано выше.
Если тест прошел нормально, то примите наши поздравления - теперь можно устанавливать Gentoo.
Пропустите оставшуюся часть этого раздела и переходите к разделу <uri 
link="?part=1&amp;chap=4">Подготовка дисков.</uri>.
</p>

<p>
Если же ваша сеть все равно не работает, то переходите к разделу <uri link="#doc_chap4">Ручная
настройка сети</uri>.
</p>


</body>
</subsection>
<subsection id="rp-pppoe">
<title>Альтернатива: Использование RP-PPPoE</title>
<body>

<p>
Предположим, что вам нужен PPPoE для соединения с Интернетом, LiveCD (любой
версии) сильно oблегчит вам жизнь, т.к. содержит <c>rp-pppoe</c>. Используйте 
скрипт <c>adsl-setup</c> для настройки вашего соединения. Вас спросят о
устройствах ethernet, которые связаны с вашим adsl-модемом, ваше имя пользователя, 
пароль, IP ваших DNS-серверов и спросит о том, нужен ли вам firewall или нет.
</p>

<pre caption="Использование rp-pppoe">
# <i>adsl-setup</i>
# <i>adsl-start</i>
</pre>

<p>
Если что-то пошло не так, проверьте правильно ли вы ввели имя пользователя и пароль, 
посмотрев в <path>/etc/ppp/pap-secrets</path> или 
<path>/etc/ppp/chap-secrets</path> и проверьте, что правильно указали
ethernet-устройство. Если ваше ethernet-устройство не существует, вам надо загрузить соответствующие 
сетевые модули. В этом случае вам надо перейти к разделу
<uri link="#doc_chap4">Ручная настройка сети</uri> т.к. там мы объясняем как это сделать.
</p>

<p>
Если все заработало, то переходите к разделу <uri link="?part=1&amp;chap=4">Подготовка дисков</uri>.
</p>

</body>
</subsection>
<subsection id="pptp">
<title>Альтернатива: Использование PPTP</title>
<body>

<p>
Если вам нужна поддержка PPTP, вам надо использовать <c>pptpclient</c> который поставляется вместе с вашим 
LiveCD. Но сперва надо проверить, что у вас все правильно сконфигурировано.
Отредактируйте файлы <path>/etc/ppp/pap-secrets</path> или <path>/etc/ppp/chap-secrets</path> так,
чтобы они содержали правильное имя пользователя и пароль.
</p>

<pre caption="Редактирование /etc/ppp/chap-secrets">
# <i>nano -w /etc/ppp/chap-secrets</i>
</pre>

<p>
Затем, в случае необходимости, скорректируйте <path>/etc/ppp/options.pptp</path>:</p>

<pre caption="Корректирование /etc/ppp/options.pptp">
# <i>nano -w /etc/ppp/options.pptp</i>
</pre>

<p>
Когда все завершите, запустите <c>pptp</c> (указав при необходимости опции,
которые не могли прописать в <path>options.pptp</path>) для соединения с сервером:
</p>

<pre caption="Соединение с dial-in сервером">
# <i>pptp &lt;server ip&gt;</i>
</pre>

<p>
Теперь переходите к разделу <uri link="?part=1&amp;chap=4">Подготовка дисков</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Ручная настройка сети</title>
<subsection>
<title>Загрузка нужных сетевых модулей</title>
<body>

<p>
Когда Live CD загрузится, то он попробует найти все ваши устройства и загрузить
нужные модули (драйверы) для поддержки ваших устройств. В большинстве случаев,
этого достаточно. Однако, в некоторых случаях, некоторые модули он может не
загрузить.
</p>

<p>
Если <c>net-setup</c> или <c>adsl-setup</c> выдают ошибку, тогда скорее всего
ваша сетевая карта не была обнаружена. Это означает, что вам придется загрузить нужные модули вручную.
</p>
<warn>
Некоторые LiveCD не поддерживают модулей. Это значит, что все доступные драйвера
уже 'загружены'. Если ваша карта не найдены, возможно стоит отправить на отчет
об ошибке, чтобы получить обнолвенную версию LiveCD.
</warn>

<p>
Выяснить какие модули существуют для организации работы сети, можно при помощи команды <c>ls</c>.
</p>

<pre caption="Поиск модулей">
# <i>ls /lib/modules/`uname -r`/kernel/drivers/net</i>
</pre>

<p>
Если вы нашли нужный вам драйвер, используйте команду <c>modprobe</c> для его загрузки:
</p>

<pre caption="Использование modprobe для загрузки модуля">
<comment>(Например, мы загрузим модуль pcnet32)</comment>
# <i>modprobe pcnet32</i>
</pre>

<p>
Проверить обнаружена ли ваша карта или нет можно используя команду <c>ifconfig</c>. 
Если сетевая карта была нормально обнаружена, то она выдаст примерно такое сообщение:
</p>

<pre caption="Проверка готовности сетевой карты">
# <i>ifconfig eth0</i>
eth0      Link encap:Ethernet  HWaddr FE:FD:00:00:00:00  
          BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</pre>

<p>
Если же появится сообщение об ошибке, то карту не удалось обнаружить
</p>

<pre caption="Сообщение об ошибке">
# <i>ifconfig eth0</i>
eth0: error fetching interface information: Device not found
</pre>

<p>
Если у вас несколько сетевых карт в системе, то они будут названы <e>eth0</e>,
<e>eth1</e> и т.д. Проверьте, что карта, которую вы хотите использовать работает
правильно и используйте правильное имя в течение все процеса установки. Далее
будем считать, что используется сетевая карта <e>eth0</e>.
</p>

<p>
Предположим, что сетевая карта была обнаружена. Тогда можно снова дать команды
<c>net-setup</c> или <c>adsl-setup</c> (которые теперь должны работать), 
но мы все-таки расскажем как настроить сеть вручную.
</p>

<p>
Выберете один из этих разделов для настройки сети:
</p>

<ul>
  <li><uri link="#dhcp">Использование DHCP</uri> для автоматического получения
  IP</li>
  <li>
    <uri link="#wireless">Настройка беспроводного доступа</uri> если у вас
	беспроводная карта
  </li>
  <li>
    <uri link="#network_term">Разбираемся в сетевой терминологии</uri> если
	хотите побольше узнать о сетях
  </li>
  <li>
    <uri link="#ifconfig_route">Использование ifconfig и route</uri> объяснит
	как настроить сеть вручную
  </li>
</ul>

</body>
</subsection>
<subsection id="dhcp">
<title>Использование DHCP</title>
<body>

<p>
DHCP (Протокол Динамического Определения Хост Машины) делает возможным
автоматическое получение информации о сети (IP-адрес, маску сети,
broadcast-адрес, шлюз, адрес сервера имен  и т.д.). Это будет работать только если
в вашей сети есть DHCP-сервер (или если ваш провайдер обеспечивает вам DHCP-сервис).
Если у вас есть этот сетевой интерфейс, то получить автоматически всю нужную информацию можно используя <c>dhcpcd</c>:
</p>

<pre caption="Использование dhcpcd">
# <i>dhcpcd eth0</i>
<comment>Нетокоторые сетевые администраторы требуют использования</comment>
<comment>имени хоста и домена, предоставленных DHCP сервером.</comment>
<comment>В этом случае используйте</comment>
# <i>dhcpcd -HD eth0</i>
</pre>

<p>
Если все заработало (пингуются интернет-серверы, например <uri
link="http://www.google.com">Google</uri>), тогда мы все установили и можем перейти к следующему шагу.
Пропустите оставшуюся часть этого раздела, и перейдите к разделу <uri
link="?part=1&amp;chap=4">Подготовка дисков.</uri>.
</p>

</body>
</subsection>
<subsection id="wireless">
<title>Настройка беспроводного доступа</title>
<body>

<note>
Не на всех LiveCD есть программа <c>iwconfig</c>. Если у вас ее не оказалось, то
вы все равно можете настроить это расширение, следуя инструкциям приведенным
здесь: <uri
link="ftp://ftp.linux-wlan.org/pub/linux-wlan-ng/README">linux-wlan-ng
project</uri>.
</note>

<p>
Если вы используете беспроводную сетевую карточку (802.11), то вам скорее всего 
придется сначала ее настроить, а потом продолжить установку. Чтобы посмотреть
текущие настройки вашей карточки, воспользуйтесь коммандой <c>iwconfig</c>.
Результат может выглядеть вот так:
</p>

<pre caption="Смотрим текщие настройки беспроводной связи">
# <i>iwconfig eth0</i>
eth0      IEEE 802.11-DS  ESSID:"GentooNode"                                   
          Mode:Managed  Frequency:2.442GHz  Access Point: 00:09:5B:11:CC:F2    
          Bit Rate:11Mb/s   Tx-Power=20 dBm   Sensitivity=0/65535               
          Retry limit:16   RTS thr:off   Fragment thr:off                       
          Power Management:off                                                  
          Link Quality:25/10  Signal level:-51 dBm  Noise level:-102 dBm        
          Rx invalid nwid:5901 Rx invalid crypt:0 Rx invalid frag:0 Tx          
          excessive retries:237 Invalid misc:350282 Missed beacon:84            
</pre>

<note>
У беспроводных карт устрйство может называться <c>wlan0</c>, а не <c>eth0</c>.
</note>

<p>
Большинству пользоваталей может потребоваться изменить только две опции: ESSID
(так называемое имя сети) или WEP ключ. Если указанные в выводе ESSI и Access
Point address уже соответствуют вашей точке доступа и вы не испольуетре WEP,
тогда ваша беспроводная сеть уже работает. Если вам нужно изменить ESSID или
добавить WEP ключ, воспользуйтесь следующей командой:
</p>

<pre caption="Меняем ESSID и/или добавляем WEP">
<comment>(Это установит имя сети равным "GentooNode")</comment>
# <i>iwconfig eth0 essid GentooNode</i>

<comment>(Это добавит шестнадцатеричный WEP ключ)</comment>
# <i>iwconfig eth0 key 1234123412341234abcd</i>

<comment>(Это установит ASCII ключ - префикс "s:")</comment>
# <i>iwconfig eth0 key s:some-password</i>
</pre>

<p>
Теперь вы можете еще раз проверить свои настройки командой <c>iwconfig</c>.
После того, как ваша беспроводная сеть заработает, можете продолжить настройку
сети на уровне IP, как описывается в следующем разделе (<uri
link="#network_term">Разбираемя в сетевой терминологии</uri>) или использовать
<c>net-setup</c>, как описывалось ранее.
</p>

</body>
</subsection>
<subsection id="network_term">
<title>Разбираемся в сетевой терминологии</title>
<body>

<note>
Если вы знаете свой IP-адрес, broadcast-адрес, маску сети, сервер имен,
то можете перейти к разделу <uri
link="#ifconfig_route">Использование ifconfig и route</uri>.
</note>

<p>
Если же опять возникли проблемы, то придется настраивать сеть вручную.
Не бойтесь, это не очень трудно. Но в начале мы объясним некоторые понятия,
которые будут встречаться при настройке сети. Когда вы прочтете этот рааздел, вы
будете знать, что такое <e>шлюз</e>,что такое <e>маска сети</e> для сервера,
как формируется <e>broadcast</e>-адрес и для чего нужен <e>сервер имен</e>.
</p>

<p>
В сети, хосты индетефицируются по их <e>IP-адресу</e> (Internet
Protocol address). Каждый адрес состоит из четырех чисел
от 0 до 255. По крайней мере, так понятно для пользователей. 
В реальности, каждый IP-адрес состоит из 32-бит (числа один или ноль). 
Например:
</p>

<pre caption="Пример IP-адреса">
IP Адрес (числа):  192.168.0.2
IP Адрес (биты):   11000000 10101000 00000000 00000010
                   -------- -------- -------- --------
                      192      168       0        2
</pre>

<p>
Каждый IP-адрес является уникальным для хоста в сети, по крайней мере в пределах
видимости"
(т.е. все компьютеры с которыми вам надо установить соединение дожны иметь уникальный IP-адрес).
Чтобы различить между хостами в сети, 
и хостами вне сети, IP-адрес делится на две части: <e>сетевая</e> часть 
и <e>хост</e> часть. 
</p>

<p>
Разделение записывается в виде <e>сетевой маски</e> - бора единиц, за которым
идут нули. Часть IP которая соответствует единицам - это сетевая часть. Другая
часть - соответствует хосту. Как всегда, сетевая маска может быть записана в
виде IP адреса.
</p>

<pre caption="Пример разделения сеть/хост">
IP-адрес:        192      168      0         2
               11000000 10101000 00000000 00000010
Маска сети:    11111111 11111111 11111111 00000000
                 255      255     255        0
              +--------------------------+--------+
                         Сеть               Хост
</pre>

<p>
В данном случае, 192.168.0.14 может являться частью нашей сети, но
192.168.1.2 не может.
</p>

<p>
Адрес <e>broadcast</e> это  IP-адрес с той же сетевой частью как и в вашей сети,
но только единицам в хост-часте. Каждый компьютер сети слушает этот и он
действительно является широко вещательным (broadcast).
</p>

<pre caption="Broadcast-адрес">
IP-адрес:      192      168      0         2
            11000000 10101000 00000000 00000010
Broadcast:  11000000 10101000 00000000 11111111
               192      168      0        255
           +--------------------------+--------+
                     Сеть                Хост
</pre>

<p>
Чтобы вы могли заняться веб-серфингом в интернете, вам необходимо знать какой хост предоставляет Интернет соединение.
Этот хост называется <e>шлюзом</e>.
Т.к. это обычный хост, он имеет обычный IP-адрес (например 192.168.0.1).
</p>

<p>
Ранее мы говорили, что каждый хост имеет свой IP-адресс. Что бы
соединиться с этим хостом по его имени вместо IP-адреса, нужен специальный 
сервис который переведет имя хоста (например <e>dev.gentoo.org</e>) в его IP-адрес 
(например <e>64.5.62.82</e>). Такой сервис называется сервером имен.
Что бы использовать его, вам необходимо определить <e>сервера имен</e> в <path>/etc/resolv.conf</path>.
</p>

<p>
В некоторых случаях, ваш шлюз служит сервером имен. Если это не так, то вам необходимо будет задать сервер имен, который вам предоставляет ваш провайдер (ISP). 
</p>

<p>
Подведем итоги. Для продолжения работы вам нужна будет следующая информация:
</p>

<table>
<tr>
  <th>Понятие</th>
  <th>Пример</th>
</tr>
<tr>
  <ti>Ваш IP-адрес</ti>
  <ti>192.168.0.2</ti>
</tr>
<tr>
  <ti>Маска сети</ti>
  <ti>255.255.255.0</ti>
</tr>
<tr>
  <ti>Broadcast</ti>
  <ti>192.168.0.255</ti>
</tr>
<tr>
  <ti>Шлюз</ti>
  <ti>192.168.0.1</ti>
</tr>
<tr>
  <ti>Сервер(ы) имен</ti>
  <ti>195.130.130.5, 195.130.130.133</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>Использование ifconfig и route</title>
<body>

<p>
Процес установки сети состоит из трех шагов. Сначала мы назначим
IP-адрес используя <c>ifconfig</c>. Затем мы установим маршрутизацию к шлюзу 
используя <c>route</c>. И наконец поместим IP сервера имен в <path>/etc/resolv.conf</path>.
</p>

<p>
Для присвоение IP-адреса, вам нужно знать ваш IP-адрес, broadcast-адрес и маску
сети.
Если вы все это знаете, то выполните команды, заменив нужные параметры на свои
<c>${IP_ADDR}</c> на ваш IP-адрес, <c>${BROADCAST}</c> на ваш
broadcast-адрес и <c>${NETMASK}</c> на вашу маску сети:
</p>

<pre caption="Использование ifconfig">
# <i>ifconfig eth0 ${IP_ADDR} broadcast ${BROADCAST} netmask ${NETMASK} up</i>
</pre>

<p>
Теперь установите маршрутизацию при помощи команды <c>route</c>. Замените <c>${GATEWAY}</c> на
на IP-адрес шлюза:
</p>

<pre caption="Использование route">
# <i>route add default gw ${GATEWAY}</i>
</pre>

<p>
Теперь откройте <path>/etc/resolv.conf</path> в вашем любимом редакторе (например
в <c>nano</c>):
</p>

<pre caption="Создание /etc/resolv.conf">
# <i>nano -w /etc/resolv.conf</i>
</pre>

<p>
И задайте ваш(и) сервер(ы) имен, используя следующий шаблон.
Замените <c>${NAMESERVER1}</c> и <c>${NAMESERVER2}</c> на
соответствующие адреса сервера имен:
</p>

<pre caption="Шаблон /etc/resolv.conf">
nameserver ${NAMESERVER1}
nameserver ${NAMESERVER2}
</pre>

<p>
Вот и все. Теперь проверьте вашу сеть пропинговав какой нибудь Интернет сервер (например
<uri link="http://www.google.com">Google</uri>). Если все за работало, то можете
приступить к установке Gentoo. Теперь переходите к разделу
<uri link="?part=1&amp;chap=4">Подготовка дисков</uri>.
</p>

</body>
</subsection>
</section>
</sections>
