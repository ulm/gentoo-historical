<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-network.xml,v 1.4 2005/11/09 00:39:28 achumakov Exp $ -->

<sections>

<version>2.2</version>
<date>2005-07-02</date>

<section>
<title>Автоматическая настройка сети</title>
<subsection>
<title>Может, она уже настроена?</title>
<body>

<p>
Если ваша система подсоединена к сети Ethernet с сервером DHCP, очень вероятно, 
что сетевое подключение на вашей машине уже автоматически настроено. Если так, 
вы сможете воспользоваться многими сетевыми командами, находящимися на 
установочном компакт-диске, например, <c>ssh</c>, <c>scp</c>, <c>ping</c>, 
<c>irssi</c>, <c>wget</c> и <c>links</c>.
</p>

<p>
Если сеть уже настроена, команда <c>/sbin/ifconfig</c> должна показывать сетевые
интерфейсы кроме lo, например, eth0:
</p>

<pre caption="/sbin/ifconfig для рабочей сетевой конфигурации">
# <i>/sbin/ifconfig</i>
<comment>(...)</comment>
eth0      Link encap:Ethernet  HWaddr 00:50:BA:8F:61:7A
          inet addr:192.168.0.2  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::50:ba8f:617a/10 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1498792 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1284980 errors:0 dropped:0 overruns:0 carrier:0
          collisions:1984 txqueuelen:100
          RX bytes:485691215 (463.1 Mb)  TX bytes:123951388 (118.2 Mb)
          Interrupt:11 Base address:0xe800 
</pre>

</body>
</subsection>
<subsection>
<title>Необязательный шаг: указание прокси-серверов</title>
<body>

<p>
Если вы подключены к интернету через прокси-сервер, при установке вам может 
потребоваться указать сведения о нем. Задать прокси-сервер очень просто: нужно 
определить переменную, содержащую сведения о прокси-сервере.
</p>

<p>
В большинстве случаев будет достаточно указать имя прокси-сервера при 
определении переменной. Предположим, например, что прокси-сервер называется 
<c>proxy.gentoo.org</c>, а его порт &mdash; <c>8080</c>:
</p>

<pre caption="Указание прокси-серверов">
<comment> (Если прокси-сервер фильтрует трафик HTTP)</comment>
# <i>export http_proxy="http://proxy.gentoo.org:8080"</i>
<comment> (Если прокси-сервер фильтрует трафик FTP)</comment>
# <i>export ftp_proxy="ftp://proxy.gentoo.org:8080"</i>
<comment> (Если прокси-сервер фильтрует трафик RSYNC)</comment>
# <i>export RSYNC_PROXY="proxy.gentoo.org:8080"</i>
</pre>

<p>
Если прокси-сервер запрашивает имя пользователя и пароль, следует использовать
такой синтаксис для значения переменной:
</p>

<pre caption="Указание имени/пароля в адресе прокси-сервера">
http://<i>имя_пользователя</i>:<i>пароль</i>@proxy.gentoo.org:8080
</pre>

</body>
</subsection>
<subsection>
<title>Проверка сети</title>
<body>

<p>
Может оказаться полезным &laquo;пропинговать&raquo; DNS-сервер вашего 
поставщика услуг интернет (его адрес находится в 
<path>/etc/resolv.conf</path>), а также произвольный веб-сайт, чтобы убедиться, 
что ваши пакеты выходят в интернет, разрешение имен DNS работает корректно и 
т.д.
</p>

<pre caption="Проверка доступности сети">
# <i>ping -c 3 www.yahoo.com</i>
</pre>

<p>
Сеть доступна? Тогда пропустите остаток этого раздела, и переходите к разделу
<uri link="?part=1&amp;chap=4">Подготовка дисков</uri>. Если сеть все же
недоступна, то, к сожалению, вам придется еще поработать над ее настройкой. 
</p>

</body>
</subsection>
</section>
<section>
<title>Автоматическая настройка сети</title>
<subsection>
<body>

<p>
Если сеть не заработает сразу, при установке с некоторых носителей можно 
использовать <c>net-setup</c> (для обычных или беспроводных сетей), 
<c>adsl-setup</c> (для пользователей ADSL) или <c>pptp</c> (для пользователей 
PPTP; есть только для x86).
</p>

<p>
Если на вашем установочном носителе нет ни одного из этих средств, или сеть
еще не работает, приступайте к <uri link="#doc_chap3">ручной настройке
сети</uri>.
</p>

<ul>
  <li>
    пользователи обычной сети Ethernet могут переходить к разделу
    <uri link="#net-setup">По умолчанию: использование net-setup</uri>
  </li>
  <li>
    пользователи ADSL могут переходить к разделу
    <uri link="#rp-pppoe">Альтернатива: использование RP-PPPoE</uri>
  </li>
  <li>
    пользователи PPTP могут переходить к разделу
    <uri link="#pptp">Альтернатива: использование PPTP</uri>
  </li>
</ul>

</body>
</subsection>
<subsection id="net-setup">
<title>По умолчанию: использование net-setup</title>
<body>

<p>
Простейший способ настроить сеть, если это не произошло автоматически &mdash; 
это запустить сценарий <c>net-setup</c>:
</p>

<pre caption="Запуск сценария net-setup">
# <i>net-setup eth0</i>
</pre>

<p>
<c>net-setup</c> задаст вам несколько вопросов о вашей сетевой среде. В 
результате его работы у вас должно появиться работоспособное подключение к 
сети. Проверьте сетевое подключение, как это описано выше. Если проверка прошла 
успешно, примите наши поздравления &mdash; теперь вы готовы к установке 
Gentoo. Пропустите оставшуюся часть этого раздела и приступайте к <uri 
link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

<p>
Если ваша сеть все еще не заработала, переходите к <uri 
link="#doc_chap3">ручной настройке сети</uri>.
</p>

</body>
</subsection>
<subsection id="rp-pppoe">
<title>Альтернатива: использование RP-PPPoE</title>
<body>

<p>
Для простоты подключения к интернету по PPPoE, в установочный диск (любой 
версии) включен <c>rp-pppoe</c>. Для настройки соединения используйте сценарий 
<c>adsl-setup</c>, входящий в комплект. У вас будет запрошена информация о 
сетевом устройстве ethernet, подключенном к adsl-модему, имя пользователя, 
пароль, IP-адреса ваших серверов DNS. Также задается вопрос, нужно ли включать 
базовый межсетевой экран (firewall).
</p>

<pre caption="Использование rp-pppoe">
# <i>adsl-setup</i>
# <i>adsl-start</i>
</pre>

<p>
Если что-то пошло не так, проверьте, правильно ли вы ввели имя пользователя и 
пароль, посмотрев в <path>/etc/ppp/pap-secrets</path> или 
<path>/etc/ppp/chap-secrets</path>, и убедитесь, что правильно указали 
устройство ethernet. Если ваше устройство не существует, вам потребуется 
загрузить соответствующие сетевые модули. Для этого нужно перейти к разделу 
<uri link="#doc_chap3">Ручная настройка сети</uri> где мы объясняем, как это 
сделать.
</p>

<p>
Если же все заработало, переходите к <uri link="?part=1&amp;chap=4">подготовке
дисков</uri>.
</p>

</body>
</subsection>
<subsection id="pptp">
<title>Альтернатива: использование PPTP</title>
<body>

<note>
Поддержка PPTP имеется только для архитектуры x86.
</note>

<p>
Если вам нужна поддержка PPTP, вы можете использовать <c>pptpclient</c>, 
который входит в состав нашего установочного диска. Но сначала нужно обеспечить 
правильность настройки. Отредактируйте файлы <path>/etc/ppp/pap-secrets</path> 
или <path>/etc/ppp/chap-secrets</path> так, чтобы в них находилось правильное 
сочетание имени пользователя и пароля.
</p>

<pre caption="Редактирование /etc/ppp/chap-secrets">
# <i>nano -w /etc/ppp/chap-secrets</i>
</pre>

<p>
Затем, если нужно, поправьте <path>/etc/ppp/options.pptp</path>:
</p>

<pre caption="Редактирование /etc/ppp/options.pptp">
# <i>nano -w /etc/ppp/options.pptp</i>
</pre>

<p>
Когда все будет готово, просто запустите <c>pptp</c> (с параметрами, которые вы 
не могли прописать в <path>options.pptp</path>), чтобы соединиться с сервером:
</p>

<pre caption="Подключение к серверу доступа dial-in">
# <i>pptp &lt;server ip&gt;</i>
</pre>

<p>
Теперь переходите к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Ручная настройка сети</title>
<subsection>
<title>Загрузка нужных сетевых модулей</title>
<body>

<p>
При загрузке установочный диск пытается определить все установленные устройства 
и загружает подходящие модули ядра (драйверы) для поддержки вашего 
оборудования. В подавляющем большинстве случаев он очень хорошо справляется с 
этой работой. Однако, в некоторых случаях он может не справиться с 
автозагрузкой нужных вам модулей ядра.
</p>

<p>
Если <c>net-setup</c> или <c>adsl-setup</c> не удалось загрузить нужный модуль, 
возможно, ваша сетевая плата не обнаружена сразу. При этом вам может 
потребоваться загрузить необходимые модули ядра вручную.
</p>

<p>
Чтобы выяснить, какие есть модули ядра для поддержки сети, используйте 
<c>ls</c>:
</p>

<pre caption="Поиск имеющихся модулей">
# <i>ls /lib/modules/`uname -r`/kernel/drivers/net</i>
</pre>

<p>
Если вы найдете драйвер для своей сетевой платы, для загрузки модуля ядра 
используйте <c>modprobe</c>:
</p>

<pre caption="Использование modprobe для загрузки модуля ядра">
<comment>(В качестве примера мы загрузим модуль pcnet32)</comment>
# <i>modprobe pcnet32</i>
</pre>

<p>
Чтобы убедиться, что ваша сетевая плата теперь обнаружена, используйте 
<c>ifconfig</c>. Если сетевая плата обнаружена, результат выглядит подобным 
образом:
</p>

<pre caption="Проверка доступности сетевой платы (удачная)">
# <i>ifconfig eth0</i>
eth0      Link encap:Ethernet  HWaddr FE:FD:00:00:00:00  
          BROADCAST NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
</pre>

<p>
Однако, если вы получите такое сообщение об ошибке, сетевая плата не 
обнаружена:
</p>

<pre caption="Проверка доступности сетевой платы (неудачная)">
# <i>ifconfig eth0</i>
eth0: error fetching interface information: Device not found
</pre>

<p>
Если в вашей системе установлено несколько сетевых плат, они называются 
<e>eth0</e>, <e>eth1</e> и т.д. Убедитесь, что сетевая плата, которую вы хотите 
использовать, хорошо работает, и не забудьте везде подставлять верное имя. Мы 
предполагаем, что используется сетевая плата <e>eth0</e>.
</p>

<p>
Когда ваша сетевая плата обнаружена, можно попробовать снова запустить 
<c>net-setup</c> или <c>adsl-setup</c> (которые теперь должны сработать), но на 
случай, если вы из крутых, мы опишем, как настроить сеть вручную.
</p>

<p>
Выберите один из следующих разделов, в зависимости от необходимого вида 
настройки:
</p>

<ul>
  <li>
    <uri link="#dhcp">Использование DHCP</uri> для автоматического получения IP
  </li>
  <li>
    <uri link="#wireless">Подготовка беспроводного доступа</uri>, если у вас
    есть беспроводная плата
  </li>
  <li>
    <uri link="#network_term">Изучение сетевой терминологии</uri>: рассказ о
    том, что вам нужно знать о подключении к сети
  </li>
  <li>
    <uri link="#ifconfig_route">Использование ifconfig и route</uri>: описание
    ручной настройки сети
  </li>
</ul>

</body>
</subsection>
<subsection id="dhcp">
<title>Использование DHCP</title>
<body>

<p>
DHCP (Dynamic Host Configuration Protocol &mdash; протокол динамической 
настройки хоста) дает возможность автоматически получить параметры сетевого 
подключения (адрес IP, маску сети, широковещательный адрес, шлюз, сервера имен 
и т. д.) Все это работает, только когда в вашей сети есть сервер DHCP (или ваш 
провайдер предоставляет услугу DHCP). Чтобы сетевой интерфейс получал эти 
сведения автоматически, используйте <c>dhcpcd</c>:
</p>

<pre caption="Использование dhcpcd">
# <i>dhcpcd eth0</i>
<comment>Некоторые сетевые администраторы требуют, чтобы вы использовали</comment>
<comment>имя хоста и домена, предоставленное сервером DHCP.</comment>
<comment>В этом случая используйте</comment>
# <i>dhcpcd -HD eth0</i>
</pre>

<p>
Если это сработало (попробуйте &laquo;попинговать&raquo; какой-нибудь сервер 
интернета, например, <uri link="http://www.google.com">Google</uri>), то у вас 
все настроено, и можно продолжать дальше. Пропустите остаток этого раздела и 
приступайте к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
<subsection id="wireless">
<title>Подготовка беспроводного доступа</title>
<body>

<note>
Поддержка команды <c>iwconfig</c> есть только на установочных дисках для 
платформ x86, amd64 и ppc. В других случаях вы все же можете запустить 
расширения, следуя инструкциям <uri 
link="ftp://ftp.linux-wlan.org/pub/linux-wlan-ng/README">проекта 
linux-wlan-ng</uri>.
</note>

<p>
Если вы используете беспроводную плату (802.11), перед дальнейшими действиями 
вам может потребоваться настроить параметры беспроводного подключения. Для 
просмотра текущей настройки вашей беспроводной платы можно использовать 
<c>iwconfig</c>. При запуске <c>iwconfig</c> вы увидите подобные сведения:
</p>

<pre caption="Вывод текущих параметров беспроводного подключения">
# <i>iwconfig eth0</i>
eth0      IEEE 802.11-DS  ESSID:"GentooNode"                                   
          Mode:Managed  Frequency:2.442GHz  Access Point: 00:09:5B:11:CC:F2    
          Bit Rate:11Mb/s   Tx-Power=20 dBm   Sensitivity=0/65535               
          Retry limit:16   RTS thr:off   Fragment thr:off                       
          Power Management:off                                                  
          Link Quality:25/10  Signal level:-51 dBm  Noise level:-102 dBm        
          Rx invalid nwid:5901 Rx invalid crypt:0 Rx invalid frag:0 Tx          
          excessive retries:237 Invalid misc:350282 Missed beacon:84            
</pre>

<note>
Некоторые беспроводные платы могут называться подобно <c>wlan0</c> или 
<c>ra0</c>, а не <c>eth0</c>. Для определения правильного имени устройства 
запускайте <c>iwconfig</c> без каких-либо параметров командной строки.
</note>

<p>
Для большинства пользователей может потребоваться изменение только двух 
параметров: ESSID (названия беспроводной сети) и ключа шифрования WEP. Если 
ESSID и указанный адрес точки доступа уже соответствуют вашей точке доступа, и 
вы не используете WEP, значит, ваше беспроводное подключение работает. Если вам 
необходимо изменить свой ESSID или добавить ключ WEP, можно запустить следующие 
команды:
</p>

<pre caption="Замена ESSID и/или добавление ключа WEP">
<comment>(Так название сети устанавливается в "GentooNode")</comment>
# <i>iwconfig eth0 essid GentooNode</i>

<comment>(Так устанавливается шестнадцатиричный ключ WEP)</comment>
# <i>iwconfig eth0 key 1234123412341234abcd</i>

<comment>(Так устанавливается текстовый ключ (ASCII); вначале нужно добавлять "s:")</comment>
# <i>iwconfig eth0 key s:some-password</i>
</pre>

<p>
Проверить сделанную настройку можно, снова запустив <c>iwconfig</c>. Как только 
ваша беспроводная сеть заработает, можно перейти к установке сетевых 
параметров, относящихся к протоколу IP, как описывается в следующем разделе 
(<uri link="#network_term">Изучение сетевой терминологии</uri>), или 
использовать утилиту <c>net-setup</c>, как описано ранее.
</p>

</body>
</subsection>
<subsection id="network_term">
<title>Изучение сетевой терминологии</title>
<body>

<note>
Если вы знаете свой адрес IP, широковещательный адрес, маску сети и серверы 
имен, можете пропустить этот подраздел и перейти к разделу <uri 
link="#ifconfig_route">Использование ifconfig и route</uri>.
</note>

<p>
Если все, рассказанное выше, не помогло, вам придется настроить свою сеть 
вручную. Это совсем нетрудно. Однако, вам необходимо освоить некоторую сетевую 
терминологию, так как она вам потребуется для удовлетворительной настройки 
сети. Прочитав это, вы узнаете, что такое <e>шлюз</e>, зачем служит <e>маска 
сети</e>, как формируется <e>широковещательный адрес</e>, и зачем нужны 
<e>серверы имен</e>.
</p>

<p>
В сети узлы (хосты) различаются по <e>адресу IP</e> (адресу протокола 
интернета). Такой адрес &mdash; это сочетание четырех чисел от 0 до 255. Ну, 
по крайней мере так мы его воспринимаем. В действительности, адрес IP состоит 
из 32 бит (единиц и нулей). Давайте рассмотрим пример:
</p>

<pre caption="Пример адреса IP">
Адрес IP (числа):       192.168.0.2
Адрес IP (биты):        11000000 10101000 00000000 00000010
                        -------- -------- -------- --------
                           192      168       0        2
</pre>

<p>
Такой адрес IP уникален для узла в рамках всех доступных сетей (т. е. каждый 
узел, с которым вы можете связаться, должен иметь уникальный адрес IP). Чтобы 
различать узлы, находящиеся внутри и извне сети, адрес IP подразделяется на две 
части: часть<e>сети</e> и часть <e>узла</e>.
</p>

<p>
Это разделение записывается с помощью <e>маски сети</e>, набора единиц, за 
которым следует набор нулей. Часть IP, которая отображается на единицы &mdash; 
это сетевая часть, оставшаяся часть &mdash; это часть узла. Как обычно, маска 
сети может записываться в таком же виде, как и адрес IP.
</p>

<pre caption="Пример разделения сети/узла">
Адрес IP:      192      168      0         2
            11000000 10101000 00000000 00000010
Маска сети: 11111111 11111111 11111111 00000000
               255      255     255        0
           +--------------------------+--------+
                      Сеть               Узел
</pre>

<p>
Другими словами, 192.168.0.14 &mdash; все еще входит в состав сети из нашего 
примера, а 192.168.1.2 &mdash; уже нет.
</p>

<p>
<e>Широковещательный адрес</e> &mdash; это адрес IP с такой же сетевой частью, 
как у вашей сети, но у которого узловая часть состоит только из единиц. Каждый 
узел вашей сети слушает этот адрес IP. Он действительно преднозначен для 
широковещательной рассылки пакетов.
</p>

<pre caption="Широковещательный адрес">
Адрес IP:             192      168      0         2
                   11000000 10101000 00000000 00000010
Широковещательный  11000000 10101000 00000000 11111111
адрес:                192      168      0        255
                  +--------------------------+--------+
                              Сеть              Узел
</pre>

<p>
Чтобы бороздить просторы интернета, вы должны знать, через какой узел 
происходит подключение к интернету. Этот узел называется <e>шлюзом</e>. Так как 
это обычный узел, ему присвоен обычный адрес IP (например, 192.168.0.1).
</p>

<p>
Выше мы говорили, что каждому узлу присваивается свой собственный адрес IP. 
Чтобы связываться с узлом по имени (вместо адреса IP), нужна служба, которая 
переводит имя (такое, как<e> dev.gentoo.org</e>) в адрес IP (например, 
<e>64.5.62.82</e>). Такая служба называется службой имен. Чтобы пользоваться 
этой службой, вам нужно указать необходимые <e>серверы имен</e> в 
<path>/etc/resolv.conf</path>.
</p>

<p>
Иногда ваш шлюз сам является сервером имен. В остальных случаях вам необходимо
указывать серверы имен, предоставляемые вашим интернет-провайдером.
</p>

<p>
В итоге, для дальнейшего вам потребуется следующая информация:
</p>

<table>
<tr>
  <th>Параметр настройки сети</th>
  <th>Пример</th>
</tr>
<tr>
  <ti>Ваш адрес IP</ti>
  <ti>192.168.0.2</ti>
</tr>
<tr>
  <ti>Маска сети</ti>
  <ti>255.255.255.0</ti>
</tr>
<tr>
  <ti>Широковещательный адрес</ti>
  <ti>192.168.0.255</ti>
</tr>
<tr>
  <ti>Шлюз</ti>
  <ti>192.168.0.1</ti>
</tr>
<tr>
  <ti>Сервер(ы) имен</ti>
  <ti>195.130.130.5, 195.130.130.133</ti>
</tr>
</table>

</body>
</subsection>
<subsection id="ifconfig_route">
<title>Использование ifconfig и route</title>
<body>

<p>
Настройка вашей сети состоит из трех шагов. Сначала мы назначаем себе адрес IP 
с помощью <c>ifconfig</c>. Затем мы настраиваем маршрутизацию к шлюзу, 
используя <c>route</c>. И в завершение мы помещаем адреса IP серверов имен в 
<path>/etc/resolv.conf</path>.
</p>

<p>
Для назначения адреса IP потребуется ваш адрес IP, широковещательный адрес и
маска сети. Узнав их, выполните следующую команду, заменив <c>${IP_ADDR}</c>
на свой адрес IP, <c>${BROADCAST}</c> на свой широковещательный адрес, а
<c>${NETMASK}</c> на свою маску сети:
</p>

<pre caption="Использование ifconfig">
# <i>ifconfig eth0 ${IP_ADDR} broadcast ${BROADCAST} netmask ${NETMASK} up</i>
</pre>

<p>
Теперь настройте маршрутизацию с помощью <c>route</c>. Подставьте адрес IP
своего шлюза вместо <c>${GATEWAY}</c>:
</p>

<pre caption="Использование route">
# <i>route add default gw ${GATEWAY}</i>
</pre>

<p>
Затем откройте <path>/etc/resolv.conf</path> в своем любимом редакторе (в нашем
примере используется <c>nano</c>):
</p>

<pre caption="Создание /etc/resolv.conf">
# <i>nano -w /etc/resolv.conf</i>
</pre>

<p>
Заполните данные своих серверов имен по следующему шаблону. Обязательно 
замените <c>${NAMESERVER1}</c> и <c>${NAMESERVER2}</c> на соответствующие 
адреса серверов имен:
</p>

<pre caption="Шаблон /etc/resolv.conf">
nameserver ${NAMESERVER1}
nameserver ${NAMESERVER2}
</pre>

<p>
Готово. Теперь проверьте свою сеть, &laquo;попинговав&raquo; какой-либо сервер 
интернета (например, <uri link="http://www.google.com">Google</uri>). Если все 
заработало, примите наши поздравления! Теперь вы готовы к установке Gentoo. 
Приступайте к <uri link="?part=1&amp;chap=4">подготовке дисков</uri>.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 2.2-r2
target-date: 2005-07-17
source-cvs-revision: 1.45
translated-by: Alexey Chumakov [info@chumakov.ru]
edited-by: Alexey Chumakov [info@chumakov.ru]
-->
