<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/2006.0/hb-install-system.xml,v 1.1 2006/04/12 09:37:47 achumakov Exp $ -->

<sections>

<version>6.0</version>
<date>2006-02-27</date>

<section>
<title>Изменение корневого каталога</title>
<subsection>
<title>Монтирование файловых систем /proc и /dev</title>
<body>

<p>
Смонтируйте файловую систему <path>/proc</path> в
<path>/mnt/gentoo/proc</path>, чтобы после изменения корневого каталога
устанавливаемая система смогла обращаться к информации, предоставляемой ядром,
а затем создайте привязку монтирования файловой системы <path>/dev</path>.
</p>

<pre caption="Монтирование /proc и /dev">
# <i>mount -t proc none /mnt/gentoo/proc</i>
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>

</body>
</subsection>
<subsection>
<title>Дополнительно: копирование сведений о DNS</title>
<body>

<p>
Если вы настраивали сетевое подключение, собираясь позже извлечь 
соответствующий файл стадии из интернета, то необходимо скопировать в 
<path>/mnt/gentoo/etc/resolv.conf</path> информацию о DNS, находящуюся в 
файле <path>/etc/resolv.conf</path>. В этом файле указываются серверы 
имен, которыми ваша система пользуется для преобразования имен в IP-адреса.
</p>

<pre caption="Копирование информации о DNS">
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Переход в новую среду</title>
<body>

<p>
Итак, все разделы подготовлены, а базовая операционная среда установлена. 
Теперь пора войти в нее, <e>изменив корневой каталог</e>. Таким образом, мы 
перейдем из текущей установочной среды в свою устанавливаемую систему
(находящуюся в недавно размеченных разделах).
</p>

<p>
Изменение выполняется в три этапа. Сначала мы с помощью <c>chroot</c> изменим 
корневой каталог с <path>/</path> (находящийся на установочном носителе) на 
<path>/mnt/gentoo</path> (находящийся на ваших дисковых разделах). Затем мы 
создадим новую среду, пользуясь утилитой <c>env-update</c>, которая, 
собственно, создает переменные среды. Наконец, мы загрузим эти переменные в 
память при помощи <c>source</c>.
</p>

<pre caption="Изменение корневого каталога для перехода в новую среду">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
>>> Regenerating /etc/ld.so.cache...
# <i>source /etc/profile</i>
# <i>export PS1="(chroot) $PS1"</i>
</pre>

<p>
Поздравляем! Теперь вы в своей собственной среде Gentoo Linux. Конечно, на
этом она далеко еще не готова, поэтому в руководстве еще осталось несколько 
разделов :-)
</p>

</body>
</subsection>
<subsection>
<title>Создание кэша портежей</title>
<body>

<p>
У вас уже установлено дерево портежей, но сейчас для ускорения будущей 
установки пакетов рекомендуется сформировать кэш Portage. Это делается
командой <c>emerge --metadata</c>:
</p>

<pre caption="Создание кэша портежей">
# <i>emerge --metadata</i>
</pre>

</body>
</subsection>
</section>

<section id="configure_USE">
<title>Настройка переменной USE</title>
<subsection>
<title>Что такое переменная USE?</title>
<body>

<p>
<c>USE</c> (&laquo;использовать&raquo;) &mdash; одна из самых мощных 
переменных, имеющихся в распоряжении пользователей Gentoo. Она позволяет  
при компиляции программ включать или отключать поддержку определенных 
необязательных функций. Например, некоторые программы можно компилировать 
с поддержкой gtk или qt на выбор. Другие можно собирать, включая или отключая 
поддержку SSL. Некоторые программы можно даже компилировать с поддержкой 
кадрового буфера (svgalib) вместо поддержки X11 (X-сервера).
</p>

<p>
В большинстве дистрибутивов пакеты собраны с поддержкой практически всех
мыслимых вариантов. Это увеличивает размер программ и время запуска, не говоря 
уже о чрезмерных зависимостях. В Gentoo вы сами можете определять, с какими
возможностями следует компилировать пакет. Здесь играет роль переменная 
<c>USE</c>.
</p>

<p>
В переменной <c>USE</c> указываются ключевые слова, которые отражаются на
параметрах компиляции. Например, параметр <e>ssl</e> включает компиляцию с 
поддержкой ssl всех программ, которые способны его поддерживать. <e>-X</e> 
отключает поддержку X-сервера (обратите внимание на предшествующий знак 
&laquo;минус&raquo;). Параметры <e>gnome gtk -kde -qt</e> обеспечивают 
компиляцию ваших  программ с поддержкой Gnome и gtk, но без поддержки KDE и qt, 
делая систему оптимальной для GNOME.
</p>

</body>
</subsection>
<subsection>
<title>Изменение переменной USE</title>
<body>

<warn>
Если вы планируете использовать пакеты, подготовленные нами (набор GRP), пока 
не вносите никаких изменений в переменную USE. Изменить ее можно будет после 
установки всех нужных вам пакетов. Известно, что если вы пропустите мимо ушей 
это предупреждение, на вашу систему нападут гремлины!
</warn>

<p>
Настройки <c>USE</c> по умолчанию хранятся в
<path>/etc/make.profile/make.defaults</path>. Все, что вы вносите в
<path>/etc/make.conf</path>, рассчитывается относительно этих значений. Когда 
вы добавляете что-либо к значению <c>USE</c>, оно добавляется в список по 
умолчанию. Когда удаляете что-либо (указывая ключевое слово с предшествующим 
знаком минус), оно удаляется из списка по умолчанию (если оно там вообще было). 
<e>Никогда</e> ничего не меняйте в <path>/etc/make.profile</path>. Все, что там 
находится, перезаписывается при обновлении Portage! 
</p>

<p>
Полное описание переменной <c>USE</c> находится во второй части настольной 
книги Gentoo в главе <uri link="?part=2&amp;chap=2">USE-флаги</uri>. Полное 
описание возможных значений признаков использования находится в вашей системе 
в файле <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Просмотр допустимых USE-флагов">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(для прокрутки пользуйтесь клавишами стрелок, для выхода нажимайте "q")</comment>
</pre>

<p>
Например, приведем значение <c>USE</c> для системы, базирующейся на KDE, с
включением поддержки DVD, ALSA и записи CD:
</p>

<pre caption="Открытие файла /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Значение USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 6.0-r1
target-date: 2006-04-12
source-cvs-revision: 1.2
translated-by: Vasiliy Golubev [vas@nightmail.ru], Alexey Chumakov [achumakov@gentoo.org] (mostly copied from the main handbook)
edited-by: 
notes:
-->
