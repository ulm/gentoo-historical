<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-net-wireless.xml,v 1.6 2013/07/15 15:24:23 blueboar Exp $ -->

<sections>

<abstract>
Настроить беспроводную сеть не совсем просто. Надеемся, мы поможем 
вам заставить ее работать. 
</abstract>

<version>9</version>
<date>2011-08-13</date>

<section>
<title>Введение</title>
<body>

<p>
Беспроводная сеть на Linux обычно просто настраивается. Существует два пути конфигурации 
wifi: либо с использованием графического клиента, либо из командной строки.
</p>

<p>
<e>Самым простым</e> путем является использование графического клиента, как только вы 
установили <uri link="/doc/en/?catid=desktop">графическое окружение</uri>. Большинство 
графических клиентов, таких как <uri link="http://wicd.sourceforge.net">wicd</uri> или 
<uri link="http://www.gnome.org/projects/NetworkManager">NetworkManager</uri> 
достаточно понятны. Они дают вам простой интерфейс "покажите-и-кликните", и вы сможете 
настроить сеть за несколько секунд.
</p>

<note>
Программа <c>wicd</c> имеет утилиту для работы в командной строке, <e>в дополнение</e> 
к главному графическому интерфейсу. Вы можете получить ее установив <c>wicd</c> с 
USE-флагом <c>ncurses</c>. Утилита <c>wicd-curses</c> особенно полезна для тех людей, 
которые не используют окружение, основанное на gtk, однако все еще хотят простую 
утилиту командной строки, которая не требует ручного редактирования конфигурационных файлов.
</note>

<p>
Однако, если вам не нужно использовать графический клиент, то вы можете сконфигурировать 
wifi из командной строки, отредактировав несколько конфигурационных файлов. Это потребует 
немного больше времени для настройки, но также и требует меньше пакетов для скачивания 
и установки. Так как графические клиенты в большинстве своем понятны (с полезными 
скриншотами на своих сайтах), мы сфокусируемся на альтернативах — утилитах командной строки.
</p>

<p>
Вы можете настроить беспроводную сеть из командной строки, установив <c>wireless-tools</c> 
или <c>wpa_supplicant</c>. Важно запомнить, что вы конфигурируете беспроводные сети 
глобально, а не на каждый интерфейс.
</p>

<p>
<c>wpa_supplicant</c> будет лучшим выбором. Для того, чтобы увидеть список поддерживаемых 
драйверов <uri link="http://hostap.epitest.fi/wpa_supplicant">прочитайте сайт wpa_supplicant</uri>.
</p>

<p>
<c>wireless-tools</c> поддерживает практически все карты и драйвера, но эта программа не 
может соединяться к точкам доступа со стандартом WPA. Если ваши сети предоставляют только 
шифрование WEP или вообще открыты, тогда вы можете предпочесть простоту <c>wireless-tools</c>.
</p>

<warn>
Драйвер <c>linux-wlan-ng</c> в настоящее время не поддерживается. Это потому, что 
<c>linux-wlan-ng</c> имеет свою собственную настройку и конфигурационные файлы, 
которые полностью отличны от чего бы то ни было еще. Разработчики 
<c>linux-wlan-ng</c>, вроде бы, изменяют свою настройку, чтобы она была похожа на 
<c>wireless-tools</c>, так что, когда это произойдет, вы сможете использовать 
<c>linux-wlan-ng</c> с Gentoo.
</warn>

</body>
</section>
<section>
<title>WPA Supplicant</title>
<body>

<p>
<uri link="http://hostap.epitest.fi/wpa_supplicant">WPA Supplicant</uri> &mdash; пакет, позволяющий 
подсоединяться к точкам доступа с протоколом WPA.
</p>

<pre caption="Установка wpa_supplicant">
# <i>emerge net-wireless/wpa_supplicant</i>
</pre>

<impo>
Для работы <c>wpa_supplicant</c> в ядре должен быть включен параметр
<c>CONFIG_PACKET</c>. Попробуйте запустить 
<c>grep CONFIG_PACKET /usr/src/linux/.config</c> для проверки того, включена 
ли эта опция в вашем ядре.
</impo>

<note>
В зависимости от ваших USE-флагов, <c>wpa_supplicant</c> может установить 
графический интерфейс, написанный на Qt4, что будет способствовать хорошей 
интеграции с KDE. Чтобы получить его, запустите 
<c>echo "net-wireless/wpa_supplicant qt4" >> /etc/portage/package.use</c> как root, 
прежде чем устанавливать <c>wpa_supplicant</c>.
</note>

<p>
Теперь нам необходимо настроить <path>/etc/conf.d/net</path> для предпочтения
<c>wpa_supplicant</c> по отношению к <c>wireless-tools</c> (по умолчанию, если 
обе программы установлены, работает <c>wireless-tools</c>).
</p>

<pre caption="Настройка /etc/conf.d/net для wpa_supplicant">
<comment># выбор wpa_supplicant</comment>
modules="wpa_supplicant"

<comment># важно указать wpa_supplicant, какой драйвер нужно использовать,
# так как программа пока не слишком хорошо угадывает сама
</comment>
wpa_supplicant_eth0="-Dmadwifi"
</pre>

<note>
Если вы используете драйвер host-ap, то вам потребуется перевести плату
в <e>ведомый режим (managed mode)</e>, прежде чем она сможет правильно
работать с <c>wpa_supplicant</c>. Для этого можно указать 
<c>iwconfig_eth0="mode managed"</c> в <path>/etc/conf.d/net</path>.
</note>

<p>
Это довольно просто, не так ли? Однако, нужно настроить саму программу 
<c>wpa_supplicant</c>, что значительно сложнее. Сложность зависит от степени 
защиты точек доступа, к которым вы собираетесь подключаться. Следующий
упрощенный пример взят из 
<path>/usr/share/doc/wpa_supplicant-&lt;version&gt;/wpa_supplicant.conf.gz</path>, 
поставляемого в составе <c>wpa_supplicant</c>.
</p>

<pre caption="Пример /etc/wpa_supplicant/wpa_supplicant.conf">
<comment># следующую строку нельзя изменять, иначе программа не сможет работать</comment>
ctrl_interface=/var/run/wpa_supplicant

<comment># ограничим доступ к настройкам WPA только для root</comment>
ctrl_interface_group=0

<comment># пусть wpa_supplicant заботится о сканировании и выборе точки доступа</comment>
ap_scan=1

<comment># простой случай: WPA-PSK, согласованный ключ - текстовая строка,
# принимать любой допустимый шифр</comment>
network={
  ssid="просто"
  psk="очень тайный пароль"
  <comment># чем выше приоритет, тем скорее выбор</comment>
  priority=5
}

<comment># как в предыдущем, но с запросом сканирования по определенному SSID
# (для точек доступа, отклоняющих широковешательный SSID)</comment>
network={
  ssid="второй ssid"
  scan_ssid=1
  psk="очень тайный пароль"
  priority=2
}

<comment># использовать только WPA-PSK; принимать любое допустимое сочетание шифров</comment>

network={
  ssid="пример"
  proto=WPA
  key_mgmt=WPA-PSK
  pairwise=CCMP TKIP
  group=CCMP TKIP WEP104 WEP40
  psk=06b4be19da289f475aa46a33cb793029d4ab3db7a23ee92382eb0106c72ac7bb
  priority=2
}

<comment># открытое подключение без шифрования (не WPA, не IEEE #802.1X)</comment>

network={
  ssid="тест-открытого-текста"
  key_mgmt=NONE
}

<comment># подключение с общим ключом WEP (не WPA, не IEEE #802.1X)</comment>
network={
  ssid="тест-статического-wep"
  key_mgmt=NONE
  <comment># Ключи в кавычках считаются ASCII-ключами</comment>
  wep_key0="abcde"
  <comment># Ключи без кавычек считаются hex-ключами</comment>
  wep_key1=0102030405
  wep_key2="1234567890123"
  wep_tx_keyidx=0
  priority=5
}

<comment># подключение с общим ключом WEP (не WPA, не IEEE #802.1X),
# допуск c использованим общего ключа IEEE 802.11</comment>
network={
  ssid="тест2-статического-wep"
  key_mgmt=NONE
  wep_key0="abcde"
  wep_key1=0102030405
  wep_key2="1234567890123"
  wep_tx_keyidx=0
  priority=5
  auth_alg=SHARED
}

<comment># сеть IBSS/ad-hoc с WPA-None/TKIP</comment>
network={
  ssid="тест adhoc"
  mode=1
  proto=WPA
  key_mgmt=WPA-NONE
  pairwise=NONE
  group=TKIP
  psk="тайный пароль"
}
</pre>                  

</body>
</section>
<section>
<title>Утилиты Wireless tools</title>

<subsection>
<title>Начальная установка и режим ведомого</title>
<body>

<p>
<uri link="http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html">
Wireless Tools</uri> обеспечивают общий способ настройки базовых беспроводных 
интерфейсов, вплоть до защиты WEP. Хотя WEP является слабым методом защиты, он
наиболее распространен. 
</p>

<p>
Для настройки Wireless Tools служат несколько основных переменных.
В примере файла настроек, приведенном ниже, описано все, что вам потребуется. 
Нужно помнить, что отсутствие настройки означает &laquo;подключаться к 
нешифрующей точке доступа с самым сильным сигналом&raquo;. Программа будет
всегда пытаться подключить вас к чему-нибудь.
</p>

<pre caption="Установка wireless-tools">
# <i>emerge net-wireless/wireless-tools</i>
</pre>

<note>
Хотя вы можете хранить свои параметры настройки беспроводной сети в
<path>/etc/conf.d/wireless</path>, это руководство рекомендует хранить
их в <path>/etc/conf.d/net</path>.
</note>

<impo>
Вам <e>понадобится</e> обратиться к документации по <uri 
link="?part=4&amp;chap=2#variable_name">именам переменных</uri>.
</impo>

<pre caption="Пример настройки iwconfig /etc/conf.d/net">
<comment># приоритет использования iwconfig над wpa_supplicant</comment>
modules="iwconfig"

<comment># Настройка ключей WEP для точек доступа ESSID1 и ESSID2</comment>
<comment># Можно указывать до 4 ключей WEP, но только 1 может работать в каждый
# момент, поэтому мы указываем индекс по умолчанию [1], чтобы сделать ключ [1],
# а впоследствии снова, чтобы изменить активный ключ на [1].
# Это нужно, если вы настраиваете другие ESSID на использование WEP-ключей, 
# отличающихся от [1].
#
# Приставка s: перед ключом означает, что ключ текстовый, иначе - 
# шестнадцатиричный
#
# enc open указывает открытую защиту (более безопасно)
# enc restricted указывает ограниченную защиту (менее безопасно)</comment>
key_ESSID1="[1] s:ваш-ключ-здесь key [1] enc open"
key_ESSID2="[1] aaaa-bbbb-cccc-dd key [1] enc restricted"
#
<comment># Нижеследующее работает только при поиске доступных точек доступа.</comment>

<comment># Иногда видны несколько точек доступа, и требуется задать
# предпочтительный порядок подключения</comment>
preferred_aps="ESSID1 ESSID2"
</pre>

</body>
</subsection>
<subsection>
<title>Настройка порядка выбора точки доступа</title>
<body>

<p>
Можно указать несколько дополнительных параметров для уточнения порядка 
выбора точки доступа, но обычно этого не требуется. 
</p>

<p>
Вам решать, подключаться ли только к указанным точкам доступа, или нет.
По умолчанию, если подключение ко всем настроенным точкам доступа не удалось,
и есть возможность подключиться к нешифрующей точке доступа, такое соединение 
произойдет. Этот порядок зависит от переменной <c>associate_order</c>. Ниже 
приводится таблица значений и с описанием их действия.
</p>

<table>
<tr>
  <th>Значение</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><c>any</c></ti>
  <ti>поведение по умолчанию</ti>
</tr>
<tr>
  <ti><c>preferredonly</c></ti>
  <ti>соединяться только с видимыми точками доступа из списка</ti>
</tr>
<tr>
  <ti><c>forcepreferred</c></ti>
  <ti>
    принудительно подключаться к точкам доступа в заданной 
    последовательности, если они не обнаружены при сканировании 
  </ti>
</tr>
<tr>
  <ti><c>forcepreferredonly</c></ti>
  <ti>
    не сканировать точки доступа, просто пытаться подключиться к каждой по 
    списку
  </ti>
</tr>
<tr>
  <ti><c>forceany</c></ti>
  <ti>
    так же, как в <c>forcepreferred</c> + подключаться к любой доступной точке
    доступа
  </ti>
</tr>
</table>

<p>
Наконец, мы можем указать <c>blacklist_aps</c> и <c>unique_ap</c>. 
<c>blacklist_aps</c> работает подобно <c>preferred_aps</c>. <c>unique_ap</c> 
устанавливается в <c>yes</c> или <c>no</c>, указывая, можно ли подключать 
второй беспроводной интерфейс к той же точке доступа, что и первый.
</p>

<pre caption="Пример blacklist_aps и unique_ap">
<comment># иногда требуется полностью исключить возможность подключения
# к определенным точкам доступа</comment>
blacklist_aps="ESSID3 ESSID4"

<comment># если у вас несколько беспроводных плат, можно указать, можно ли им
# подключаться к одной и той же точке доступа
# значение - "yes" или "no"
# по умолчанию - "yes"</comment>
unique_ap="yes"
</pre>

</body>
</subsection>
<subsection>
<title>Режим отдельного и ведущего узла</title>
<body>

<p>
Если вы хотите становиться отдельным узлом (ad hoc), когда не удается 
подключиться ни к какой точке доступа в ведомом режиме, это тоже возможно.
</p>

<pre caption="Откат к режиму отдельного узла">
adhoc_essid_eth0="Этот отдельный узел"
</pre>

<p>
Как насчет подключения к сетям Ad-Hoc или запуска в режиме ведущего (master), 
чтобы стать точкой доступа? Есть конфигурация и для такой работы! Вам может 
потребоваться определить WEP-ключи, как показано выше.
</p>

<pre caption="Пример настройки ad-hoc/master">
<comment># установка режима: допускается managed (ведомый, по умолчанию),
# ad-hoc (отдельный) или или master (ведущий). Не все драйверы поддерживают 
# каждый режим</comment> 
mode_eth0="ad-hoc"

<comment># установка ESSID интерфейса
# в ведомом режиме заставляет интерфейс пытаться подключиться к указанному
# ESSID, и больше ничего</comment>
essid_eth0="Этот отдельный узел"

<comment># если не указан, используется канал 3</comment>
channel_eth0="9"
</pre>

<impo>
Следующий текст взят дословно из документации BSD wavelan, входящей в
<uri link="http://www.netbsd.org/Documentation/network/wavelan.html">
документацию NetBSD</uri>. &laquo;Существуют 14 каналов. Нам сообщили, что 
использование каналов с 1 по 11 является законным в Северной Америке, каналов с 
1 по 13 &mdash; в большинстве стран Европы, каналов с 10 по 13 &mdash; во 
Франции, и только канала 14 &mdash; в Японии. Если у вас есть сомнения, 
обратитесь к документации от вашей платы или точки доступа. Убедитесь что 
выбранный канал совпадает с каналом точки доступа (или другой платы в сети 
ad-hoc). По умолчанию на платах, продаваемых в Северной Америке и большинстве 
стран Европы, настроен канал 3; на платах, продаваемых во Франции &mdash; канал 
11; на платах, продаваемых в Японии &mdash; канал 14.&raquo;
</impo>

</body>
</subsection>
<subsection>
<title>Устранение неполадок в wireless tools</title>
<body>

<p>
Существуют дополнительные переменные, которые можно использовать для
запуска своего беспроводного оборудования и устранения неполадок, возникших 
из-за драйвера или проблем с сетевым окружением. Ниже приведена таблица прочих 
функций, которые можно перепробовать.
</p>

<table>
<tr>
  <th>Переменная</th>
  <th>Значение по умолчанию</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><c>iwconfig_eth0</c></ti>
  <ti/>
  <ti>
    За подробными сведениями о параметрах <c>iwconfig</c> обращайтесь к 
    странице справки iwconfig. 
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_eth0</c></ti>
  <ti/>
  <ti>
    За подробными сведениями о параметрах <c>iwpriv</c> обращайтесь к 
    странице справки iwpriv
  </ti>
</tr>
<tr>
  <ti><c>sleep_scan_eth0</c></ti>
  <ti><c>0</c></ti>
  <ti>
    Время задержки в секундах перед попыткой сканирования. Требуется, когда
    драйверу или прошивке нужно дополнительное время для перехода в рабочий
    режим.
  </ti>
</tr>
<tr>
  <ti><c>sleep_associate_eth0</c></ti>
  <ti><c>5</c></ti>
  <ti>
    Время ожидания связи интерфейса с точкой доступа (в секундах) перед 
    переходом к опросу следующей.
  </ti>
</tr>
<tr>
  <ti><c>associate_test_eth0</c></ti>
  <ti><c>MAC</c></ti>
  <ti>
    Некоторые драйверы не сбрасывают MAC-адрес, связанный с недоступной точкой
    доступа, при потере или попытки связи. Некоторые драйверы не сбрасывают 
    значение качества сигнала при потере или попытке соединения. Допустимые
    значения: <c>MAC</c>, <c>quality</c> и <c>all</c>.
  </ti>
</tr>
<tr>
  <ti><c>scan_mode_eth0</c></ti>
  <ti/>
  <ti>
    Некоторым драйверам необходимо сканировать в режиме ad-hoc. Если
    сканирование не удается, попробуйте указать здесь <c>ad-hoc</c>.
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_scan_pre_eth0</c></ti>
  <ti/>
  <ti>
    Посылать интерфейсу некоторые команды <c>iwpriv</c> перед сканированием.
    За дополнительными сведениями обращайтесь к странице справки iwpriv.
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_scan_post_eth0</c></ti>
  <ti/>
  <ti>
    Посылать интерфейсу некоторые команды <c>iwpriv</c> после сканирования.
    За дополнительными сведениями обращайтесь к странице справки iwpriv.
  </ti>
</tr>
</table>

</body>
</subsection>
</section>
<section>
<title>Раздельная настройка сети по ESSID</title>
<body>

<p>
Иногда необходим статический IP при соединении с <c>ESSID1</c>, и DHCP при 
соединении с <c>ESSID2</c>. На деле, большинство переменных модуля можно 
определять раздельно по ESSID. Вот как это сделать:
</p>

<note>
Это работает при использовании WPA Supplicant или Wireless Tools.
</note>

<impo>
Вам <e>потребуется</e> свериться с документацией по 
<uri link="?part=4&amp;chap=2#variable_name">именам переменных</uri>.
</impo>

<pre caption="Назначение сетевых настроек для ESSID">
config_ESSID1="192.168.0.3/24 brd 192.168.0.255"
routes_ESSID1="default via 192.168.0.1"

config_ESSID2="dhcp"
fallback_ESSID2="192.168.3.4/24"
fallback_route_ESSID2="default via 192.168.3.1"

<comment># можно также указать сервера имен и др.</comment>
<comment># ПРЕДУПРЕЖДЕНИЕ: DHCP переопределит настройки, если не указано иное</comment>
dns_servers_ESSID1="192.168.0.1 192.168.0.2"
dns_domain_ESSID1="some.domain"
dns_search_domains_ESSID1="search.this.domain search.that.domain"

<comment># перенастройка производится по МАС-адресу точки доступа;
# это полезно, когда в разных местах есть точки доступа с одинаковым ESSID</comment>
config_001122334455="dhcp"
dhcpcd_001122334455="-t 10"
dns_servers_001122334455="192.168.0.1 192.168.0.2"
</pre>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-date: 2011-08-13
source-cvs-revision: 1.21
translated-by: Igor Naum [naumi@vesti-rtr.com]
edited-by: Alexey Chumakov [achumakov@gentoo.org]
edited-by: Vladimir Romanov [blueboar2@gmail.com]
-->
