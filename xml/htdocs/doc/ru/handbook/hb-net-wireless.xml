<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-net-wireless.xml,v 1.1 2006/03/23 12:29:06 achumakov Exp $ -->

<sections>

<version>1.4</version>
<date>2005-12-22</date>

<section>
<title>Введение</title>
<body>

<p>
В настоящее время поддерживается подключение к беспроводной сети с помощью
<c>wireless-tools</c> или <c>wpa_supplicant</c>. Важно помнить, что подключение к 
беспроводным сетям настраивается глобально, а не для определённого интерфейса. 
</p>

<p>
<c>wpa_supplicant</c> &mdash; лучший выбор, но он поддерживает не все драйверы.
Список поддерживаемых драйверов <uri 
link="http://hostap.epitest.fi/wpa_supplicant">находится на сайте 
wpa_suppliant</uri>. Кроме того, сейчас <c>wpa_supplicant</c> может подключаться 
только к тем сетям, на SSID которых настроен.
</p>

<p>
<c>wireless-tools</c> поддерживает практически все платы и драйверы, но не способен
подключаться к точкам доступа, работающим исключительно с WPA.
</p>

<warn>
Драйвер <c>linux-wlan-ng</c> в данный момент не поддерживается в baselayout. Это 
из-за того, что в <c>linux-wlan-ng</c> своя собственная программа установки и 
настройки, которая ни на что не похожа. Разработчики <c>linux-wlan-ng</c>, по слухам, 
собираются перейти на установку как в <c>wireless-tools</c>; когда это произойдет, вы 
сможете использовать <c>linux-wlan-ng</c> с baselayout.
</warn>
</body>
</section>
<section>
<title>Запросчик WPA</title>
<body>

<p>
Запросчик WPA (<uri link="http://hostap.epitest.fi/wpa_supplicant">WPA 
Supplicant</uri>) &mdash; пакет, позволяющий подсоединяться к точкам доступа с 
протоколом WPA. Его настройка проходит достаточно гладко, и пакет работает 
достаточно стабильно, хотя находится на стадии бета-тестирования.
</p>

<pre caption="Установка wpa_supplicant">
# <i>emerge net-wireless/wpa_supplicant</i>
</pre>

<impo>
Для работы <c>wpa_supplicant</c> в ядре должен быть включен параметр
<c>CONFIG_PACKET</c>.
</impo>

<p>
Теперь нам необходимо настроить <path>/etc/conf.d/net</path> для предпочтения
<c>wpa_supplicant</c> по отношению к <c>wireless-tools</c> (по умолчанию, если 
обе программы установлены, работает <c>wireless-tools</c>).
</p>

<pre caption="Настройка /etc/conf.d/net для wpa_supplicant">
<comment># выбор wpa_supplicant</comment>
modules=( "wpa_supplicant" )

<comment># важно указать wpa_supplicant, какой драйвер нужно использовать,
# так как программа пока не слишком хорошо угадывает сама
</comment>
wpa_supplicant_eth0="-Dбезумный-wifi"
</pre>

<note>
Если вы используете драйвер host-ap, то вам потребуется перевести плату
в <e>ведомый режим (managed mode)</e>, прежде чем она сможет правильно
работать с <c>wpa_supplicant</c>. Для этого можно указать 
<c>iwconfig_eth0="mode managed"</c> в <path>/etc/conf.d/net</path>.
</note>

<p>
Это довольно просто, не так ли? Однако, нужно настроить саму программу 
<c>wpa_supplicant</c>, что значительно сложнее. Сложность зависит от степени 
защиты точек доступа, к которым вы собираетесь подключаться. Следующий
упрощенный пример взят из <path>/etc/wpa_supplicant.conf.example</path>, 
поставляемого в составе <c>wpa_supplicant</c>.
</p>

<pre caption="Пример /etc/wpa_supplicant.conf">
<comment># следующую строку нельзя изменять, иначе программа не сможет работать</comment>
ctrl_interface=/var/run/wpa_supplicant

<comment># ограничим доступ к настройкам WPA только для root</comment>
ctrl_interface_group=0

<comment># пусть wpa_supplicant заботится о сканировании и выборе точки доступа</comment>
ap_scan=1

<comment># простой случай: WPA-PSK, согласованный ключ - текстовая строка,
# принимать любой допустимый шифр</comment>
network={
  ssid="просто"
  psk="очень тайный пароль"
  <comment># чем выше приоритет, тем скорее выбор</comment>
  priority=5
}

<comment># как в предыдущем, но с запросом сканирования по определенному SSID
# (для точек доступа, отклоняющих широковешательный SSID)</comment>
network={
  ssid="второй ssid"
  scan_ssid=1
  psk="очень тайный пароль"
  priority=2
}

<comment># использовать только WPA-PSK; принимать любое допустимое сочетание шифров</comment>

network={
  ssid="пример"
  proto=WPA
  key_mgmt=WPA-PSK
  pairwise=CCMP TKIP
  group=CCMP TKIP WEP104 WEP40
  psk=06b4be19da289f475aa46a33cb793029d4ab3db7a23ee92382eb0106c72ac7bb
  priority=2
}

<comment># открытое подключение без шифрования (не WPA, не IEEE #802.1X)</comment>

network={
  ssid="тест-открытого-текста"
  key_mgmt=NONE
}

<comment># подключение с общим ключем WEP (не WPA, не IEEE #802.1X)</comment>
network={
  ssid="тест-статического-wep"
  key_mgmt=NONE
  wep_key0="abcde"
  wep_key1=0102030405
  wep_key2="1234567890123"
  wep_tx_keyidx=0
  priority=5
}

<comment># подключение с общим ключом WEP (не WPA, не IEEE #802.1X),
# допуск c использованим общего ключа IEEE 802.11</comment>
network={
  ssid="тест2-статического-wep"
  key_mgmt=NONE
  wep_key0="abcde"
  wep_key1=0102030405
  wep_key2="1234567890123"
  wep_tx_keyidx=0
  priority=5
  auth_alg=SHARED
}

<comment># сеть IBSS/ad-hoc с WPA-None/TKIP</comment>
network={
  ssid="тест adhoc"
  mode=1
  proto=WPA
  key_mgmt=WPA-NONE
  pairwise=NONE
  group=TKIP
  psk="тайный пароль"
}
</pre>                  

</body>
</section>
<section>
<title>Утилиты Wireless tools</title>

<subsection>
<title>Начальная установка и ведомый режим</title>
<body>

<p>
<uri link="http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html">
Wireless Tools</uri> дают общий способ настройки базовых беспроводных 
интерфейсов до уровня защиты WEP. Хотя WEP является слабым методом защиты, он 
наиболее распространенн. 
</p>

<p>
Для настройки Wireless Tools служат несколько основных переменных.
В примере файла настроек, приведенном ниже, описано все что вам потребуется. 
Нужно помнить, что отсутствие настройки означает &laquo;подключаться к 
нешифрующей точке доступа с самым сильным сигналом&raquo;. Программа будет
всегда пытаться подключить вас к чему-нибудь.
</p>

<pre caption="Установка wireless-tools">
# <i>emerge net-wireless/wireless-tools</i>
</pre>

<note>
Хотя вы можете хранить свои параметры настройки беспроводной сети в
<path>/etc/conf.d/wireless</path>, это руководство рекомендует хранить
их в <path>/etc/conf.d/net</path>.
</note>

<impo>
Вам <e>понадобится</e> обратиться к документации по <uri 
link="?part=4&amp;chap=2#variable_name">именам переменных</uri>.
</impo>

<pre caption="Пример настройки iwconfig /etc/conf.d/net">
<comment># приоритет использования iwconfig над wpa_supplicant</comment>
modules=( "iwconfig" )

<comment># Настройка ключей WEP для точек доступа ESSID1 и ESSID2</comment>
<comment># Можно указывать до 4 ключей WEP, но только 1 может работать в каждый
# момент, поэтому мы указываем индекс по умолчанию [1], чтобы сделать ключ [1],
# а впоследствии снова, чтобы изменить активный ключ на [1].
# Это нужно, если вы настраиваете другие ESSID на использование WEP-ключей, 
# отличающихся от [1].
#
# Приставка s: перед ключом означает, что ключ текстовый, иначе - 
# шестнадцатиричный
#
# enc open указывает открытую защиту (более безопасно)
# enc restricted указывает ограниченную защиту (менее безопасно)</comment>
key_ESSID1="[1] s:ваш-ключ-здесь key [1] enc open"
key_ESSID2="[1] aaaa-bbbb-cccc-dd key [1] enc restricted"
#
<comment># Нижеследующее работает только при поиске доступных точек доступа.</comment>

<comment># Иногда видны несколько точек доступа, и требуется задать
# предпочтительный порядок подключения</comment>
preferred_aps=( "ESSID1" "ESSID2" )
</pre>

</body>
</subsection>
<subsection>
<title>Настройка порядка выбора точки доступа</title>
<body>

<p>
Можно добавить несколько дополнительных параметров для уточнения настройки 
выбора точки доступа, но обычно этого не требуется. 
</p>

<p>
Вам решать, подключаться ли только к указанным точкам доступа, или нет.
По умолчанию, если подключение ко всем настроенным точкам доступа не удалось,
и есть возможность подключиться к нешифрующей точке доступа, такое соединение 
произойдет. Этот порядок зависит от переменной <c>associate_order</c>. Ниже 
приводится таблица значений и их действие.
</p>

<table>
<tr>
  <th>Значение</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><c>any</c></ti>
  <ti>поведение по умолчанию</ti>
</tr>
<tr>
  <ti><c>preferredonly</c></ti>
  <ti>соединяться только с видимыми точками доступа из списка</ti>
</tr>
<tr>
  <ti><c>forcepreferred</c></ti>
  <ti>
    принудительно подключаться к точкам доступа в заданной 
    последовательности, если они не обнаружены при сканировании 
  </ti>
</tr>
<tr>
  <ti><c>forcepreferredonly</c></ti>
  <ti>
    не сканировать точки доступа, просто пытаться подключиться к каждой по 
    списку
  </ti>
</tr>
<tr>
  <ti><c>forceany</c></ti>
  <ti>
    так же, как в <c>forcepreferred</c> + подключаться к любой доступной точке
    доступа
  </ti>
</tr>
</table>

<p>
Наконец, мы можем указать <c>blacklist_aps</c> и <c>unique_ap</c>. 
<c>blacklist_aps</c> работает подобно <c>preferred_aps</c>. <c>unique_ap</c> 
устанавливается в <c>yes</c> или <c>no</c>, указывая, можно ли подключать 
второй беспроводной интерфейс к той же точке доступа, что и первый.
</p>

<pre caption="Пример blacklist_aps и unique_ap">
<comment># иногда требуется полностью исключить возможность подключения
# к определенным точкам доступа</comment>
blacklist_aps=( "ESSID3" "ESSID4" )

<comment># если у вас несколько беспроводных плат, можно указать, можно ли им
# подключаться к одной и той же точке доступа
# значение - "yes" или "no"
# по умолчанию - "yes"</comment>
unique_ap="yes"
</pre>

</body>
</subsection>
<subsection>
<title>Режим отдельного и ведущего узла</title>
<body>

<p>
Если вы хотите стать отдельным узлом (ad hoc), когда не удается 
подключиться ни к какой точке доступа в ведомом режиме, это тоже
можно сделать.
</p>

<pre caption="Откат к режиму отдельного узла">
adhoc_essid_eth0="This Adhoc Node"
</pre>

<p>
Как насчет подключения к сетям Ad-Hoc или запуска в ведущем режиме (master), 
чтобы стать точкой доступа? Вот конфигурация и для такой работы! Вам может 
потребоваться определить WEP-ключи, как показано выше.
</p>

<pre caption="Пример настройки ad-hoc/master">
<comment># установка режима: допускается managed (ведомый, по умолчанию),
# ad-hoc (отдельный) или или master (ведущий). Не все драйверы поддерживают 
# каждый режим</comment> 
mode_eth0="ad-hoc"

<comment># установка ESSID интерфейса
# в ведомом режиме заставляет интерфейс пытаться подключиться к указанному
# ESSID, и больше ничего</comment>
essid_eth0="Этот отдельный узел"

<comment># если не указан, используется канал 3</comment>
channel_eth0="9"
</pre>

<impo>
Следующий текст взят дословно из документации BSD wavelan, находящейся в
<uri link="http://www.netbsd.org/Documentation/network/wavelan.html">
документации NetBSD</uri>. Существуют 14 каналов. Нам сообщили, что 
использование каналов с 1 по 11 законно в Северной Америке, каналов с 1 по 13 
&mdash; в большинстве стран Европы, каналов с 10 по 13 &mdash; во Франции, и 
только канала 14 &mdash; в Японии. Если у вас есть сомнения, обращайтесь к 
документации от вашей платы или точки доступа. Убедитесь что выбранный канал 
совпадает с каналом точки доступа (или другой платы в сети ad-hoc). По 
умолчанию на платах, продаваемых в Северной Америке и большинстве стран 
Европы, настроен канал 3; на платах, продаваемых во Франции &mdash; канал 11; 
на платах, продаваемых в Японии &mdash; канал 14. 
</impo>

</body>
</subsection>
<subsection>
<title>Устранение неполадок в wireless tools</title>
<body>

<p>
Существуют дополнительные переменные, которые можно использовать для
устранения неполадок, возникших из-за драйвера или проблем с сетевым
окружением, и запуска своего беспроводного оборудования. Ниже приведена
таблица прочих функций, которые можно перепробовать.
</p>

<table>
<tr>
  <th>Переменная</th>
  <th>Значение по умолчанию</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><c>iwconfig_eth0</c></ti>
  <ti/>
  <ti>
    За подробными сведениями о параметрах <c>iwconfig</c> обращайтесь к 
    странице справки iwconfig. 
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_eth0</c></ti>
  <ti/>
  <ti>
    За подробными сведениями о параметрах <c>iwpriv</c> обращайтесь к 
    странице справки iwpriv
  </ti>
</tr>
<tr>
  <ti><c>sleep_scan_eth0</c></ti>
  <ti><c>0</c></ti>
  <ti>
    Время задержки в секундах перед попыткой сканирования. Требуется, когда
    драйверу или прошивке нужно дополнительное время для перехода в рабочий
    режим.
  </ti>
</tr>
<tr>
  <ti><c>sleep_associate_eth0</c></ti>
  <ti><c>5</c></ti>
  <ti>
    Время ожидания связи интерфейса с точкой доступа (в секундах) перед 
    переходом к опросу следующей.
  </ti>
</tr>
<tr>
  <ti><c>associate_test_eth0</c></ti>
  <ti><c>MAC</c></ti>
  <ti>
    Некоторые драйверы не сбрасывают MAC-адрес, связанный с недоступной точкой
    доступа, при потере или попытки связи. Некоторые драйверы не сбрасывают 
    значение качества сигнала при потере или попытке соединения. Допустимые
    значения: <c>MAC</c>, <c>quality</c> и <c>all</c>.
  </ti>
</tr>
<tr>
  <ti><c>scan_mode_eth0</c></ti>
  <ti/>
  <ti>
    Некоторым драйверам необходимо сканировать в режиме ad-hoc. Если
    сканирование не удается, попробуйте указать здесь <c>ad-hoc</c>.
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_scan_pre_eth0</c></ti>
  <ti/>
  <ti>
    Посылать интерфейсу некоторые команды <c>iwpriv</c> перед сканированием.
    За дополнительными сведениями обращайтесь к странице справки iwpriv.
  </ti>
</tr>
<tr>
  <ti><c>iwpriv_scan_post_eth0</c></ti>
  <ti/>
  <ti>
    Посылать интерфейсу некоторые команды <c>iwpriv</c> после сканирования.
    За дополнительными сведениями обращайтесь к странице справки iwpriv.
  </ti>
</tr>
</table>

</body>
</subsection>
</section>
<section>
<title>Раздельная настройка сети по ESSID</title>
<body>

<p>
Иногда необходим статический IP при соединении с <c>ESSID1</c>, и DHCP при 
соединении с <c>ESSID2</c>. В действительности, большинство переменных модуля
можно определять раздельно по ESSID. Вот как это сделать. 
</p>

<note>
Это работает при использовании WPA Supplicant или Wireless Tools.
</note>

<impo>
Вам <e>потребуется</e> свериться с документацией по 
<uri link="?part=4&amp;chap=2#variable_name">именам переменных</uri>.
</impo>

<pre caption="Назначение сетевых настроек для ESSID">
config_ESSID1=( "192.168.0.3/24 brd 192.168.0.255" )
routes_ESSID1=( "default via 192.168.0.1" )

config_ESSID2=( "dhcp" )
fallback_ESSID2=( "192.168.3.4/24" )
fallback_route_ESSID2=( "default via 192.168.3.1" )

<comment># можно также указать сервера имен и др.</comment>
<comment># ПРЕДУПРЕЖДЕНИЕ: DHCP переопределит настройки, если не указано иное</comment>
dns_servers_ESSID1=( "192.168.0.1" "192.168.0.2" )
dns_domain_ESSID1="some.domain"
dns_search_domains_ESSID1="search.this.domain search.that.domain"

<comment># перенастройка производится по МАС-адресу точки доступа;
# это полезно, когда в разных местах есть точки доступа с одинаковым ESSID</comment>
config_001122334455=( "dhcp" )
dhcpcd_001122334455="-t 10"
dns_servers_001122334455=( "192.168.0.1" "192.168.0.2" )
</pre>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 1.4-r2
target-date: 2006-03-23
source-cvs-revision: 1.11
translated-by: Igor Naum [naumi@vesti-rtr.com]
edited-by: Alexey Chumakov [achumakov@gentoo.org]

note:
-->
