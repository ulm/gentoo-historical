<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-ppc-disk.xml,v 1.4 2012/12/09 19:13:29 swift Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<sections>

<abstract>
Чтобы установить Gentoo, вы должны создать необходимые разделы. Данная
глава описывает, как разбить диск для последующего использования.
</abstract>

<version>3</version>
<date>2012-10-18</date>

<section>
<title>Общие сведения о блочных устройствах</title>
<subsection>
<include href="hb-install-blockdevices.xml"/>
</subsection>

<subsection>
<title>Разделы</title>
<body>

<p>
Несмотря на то, что теоретически возможно использовать весь диск для
размещения вашей Linux системы, этого почти никогда не случается на практике.
Вместо этого все большое блочное устройство (диск) разбивается на меньшие,
более удобные для обращения, блочные устройства. Для всех систем они
называются <e>разделами</e>.
</p>

</body>
</subsection>
</section>
<section>
<title>Разработка схемы разделения диска</title>
<subsection>
<title>Схема разделения по умолчанию</title>
<body>

<p>
Если вы не хотите заниматься разработкой схемы для вашей системы, вы можете
воспользоваться схемой, которую мы используем в этой книге. Выберите схему
файловой системы, которая лучше соответствует типу системы PowerPC, на который
вы проводите установку.
</p>


</body>
</subsection>
<subsection>
<title>Apple New World</title>
<body>

<p>
Компьютеры Apple New World достаточно просты для конфигурации. Первый раздел
всегда будет <e>Apple Partition Map</e>. Данный раздел хранит разбиение диска.
Вы не можете удалить данный раздел. Следующий раздел всегда должен быть
разделом "bootstrap". Данный раздел содержит маленькую файловую систему
HFS (800Кб), которая содержит копию начального загрузчика Yaboot и его
файл конфигурации. Этот раздел <e>не</e> то же самое, что и раздел
<path>/boot</path>, который обычно используется на других архитектурах.
После загрузочного раздела обычно размещаются файловые системы Linux,
согласно схемы ниже. Раздел для файла подкачки это временное место, куда ваша система
помещает информацию, когда у нее заканчивается физическая память. Корневой
раздел содержит файловую систему, на которую устанавливается Gentoo. Если
вы хотите одновременную загрузку двух систем, то раздел OSX может быть
в любом месте после раздела "bootstrap" (чтобы быть уверенным, что
yaboot запустится первым).
</p>

<note>
На вашем диске могут быть разделы драйвера диска, такие как <path>Apple_Driver63</path>,
<path>Apple_Driver_ATA</path>, <path>Apple_FWDriver</path>, <path>Apple_Driver_IOKit</path>, 
<path>Apple_Patches</path>. Они используются для загрузки MacOS, поэтому если она вам не нужна, вы
можете удалить их, инициализировав диск c с помощью опции <c>i</c> программы
<c>mac-fdisk</c>. Это полностью удалит диск! Если вы сомневаетесь, не удаляйте
их.
</note>

<note>
Если вы разбили диск с помощью Apple Disk Utility, между разделами могут
остаться пустые места по 128Мб, которые Apple резервирует для 
"будущих использований". Их можно просто удалить.
</note>

<table>
<tr>
<th>Раздел</th>
<th>Размер</th>
<th>Файловая система</th>
<th>Описание</th>
</tr>
<tr>
<ti><path>/dev/sda1</path></ti>
<ti>32Кб</ti>
<ti>Никакой</ti>
<ti>Apple Partition Map</ti>
</tr>
<tr>
<ti><path>/dev/sda2</path></ti>
<ti>800Кб</ti>
<ti>HFS</ti>
<ti>Bootstrap раздел</ti>
</tr>
<tr>
<ti><path>/dev/sda3</path></ti>
<ti>512Мб</ti>
<ti>Swap</ti>
<ti>Файл подкачки Linux</ti>
</tr>
<tr>
<ti><path>/dev/sda4</path></ti>
<ti>Оставшаяся часть диска</ti>
<ti>ext3, ext4, reiserfs, xfs</ti>
<ti>Корневой раздел Linux</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>Apple Old World</title>
<body>

<p>
Компьютеры Apple Old World немного более сложны для конфигурирования. Первый
раздел всегда будет <e>Apple Partition Map</e>. Данный раздел хранит разбиение
диска. Вы не можете удалить данный раздел. Если вы используете BootX, то
конфигурация, приведенная ниже, предполагает, что ваш MacOS установлен на
отдельном диске. Если это не так, то будут дополнительные разделы для
драйверов диска Apple, такие как <path>Apple_Driver63, Apple_Driver_ATA, Apple_FWDriver,
Apple_Driver_IOKit, Apple_Patches</path>, и раздел для MacOS. Если вы
используете Quik, вам нужно будет создать загрузочный раздел, в котором
будет находиться ядро (в отличие от других методов загрузки Apple). После
загрузочного раздела размещаются обычные файловые системы Linux, согласно
схеме, приведенной ниже. Раздел для файла подкачки это временное место, куда ваша система
помещает информацию, когда у нее заканчивается физическая память. Корневой
раздел содержит файловую систему, на которую устанавливается Gentoo.
</p>

<note>
Если вы используете машину OldWorld, вам будет нужно оставить MacOS.
Приведенная ниже разбивка предполагает, что MacOS находится на отдельном
устройстве.
</note>

<table>
<tr>
<th>Раздел</th>
<th>Размер</th>
<th>Файловая система</th>
<th>Описание</th>
</tr>
<tr>
<ti><path>/dev/sda1</path></ti>
<ti>32Кб</ti>
<ti>Никакой</ti>
<ti>Apple Partition Map</ti>
</tr>
<tr>
<ti><path>/dev/sda2</path></ti>
<ti>32Мб</ti>
<ti>ext2</ti>
<ti>Загрузочный раздел Quik (только в случае с quik)</ti>
</tr>
<tr>
<ti><path>/dev/sda3</path></ti>
<ti>512Мб</ti>
<ti>Swap</ti>
<ti>Файл подкачки Linux</ti>
</tr>
<tr>
<ti><path>/dev/sda4</path></ti>
<ti>Оставшаяся часть диска</ti>
<ti>ext3, ext4, reiserfs, xfs</ti>
<ti>Корневой раздел Linux</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>Pegasos</title>
<body>

<p>
Схема разделов Pegasos очень проста, в сравнении со схемами Apple.
Первый раздел это загрузочный раздел, содержащий ядра, которые можно
загружать, а также скрипт Open Firmware, который показывает меню при
загрузке. После загрузочного раздела размещаются обычные файловые системы Linux, согласно
схеме, приведенной ниже. Раздел для файла подкачки это временное место, куда ваша система
помещает информацию, когда у нее заканчивается физическая память. Корневой
раздел содержит файловую систему, на которую устанавливается Gentoo.
</p>

<table>
<tr>
<th>Раздел</th>
<th>Размер</th>
<th>Файловая система</th>
<th>Описание</th>
</tr>
<tr>
<ti><path>/dev/sda1</path></ti>
<ti>32Мб</ti>
<ti>affs1 или ext2</ti>
<ti>Загрузочный раздел</ti>
</tr>
<tr>
<ti><path>/dev/sda2</path></ti>
<ti>512Мб</ti>
<ti>Swap</ti>
<ti>Файл подкачки Linux</ti>
</tr>
<tr>
<ti><path>/dev/sda3</path></ti>
<ti>Оставшаяся часть диска</ti>
<ti>ext3, ext4, reiserfs, xfs</ti>
<ti>Корневой раздел Linux</ti>
</tr>
</table>

</body>
</subsection>
<subsection>
<title>IBM PReP (RS/6000)</title>
<body>

<p>
IBM PowerPC Reference Platform (PReP) требует небольшого загрузочного
раздела PReP, как первого раздела диска, и, далее, раздела для файла
подкачки и корневого раздела.
</p>

<table>
<tr>
<th>Раздел</th>
<th>Размер</th>
<th>Файловая система</th>
<th>Описание</th>
</tr>
<tr>
<ti><path>/dev/sda1</path></ti>
<ti>800Кб</ti>
<ti>Никакой</ti>
<ti>Загрузочный раздел PReP (Тип 0x41)</ti>
</tr>
<tr>
<ti><path>/dev/sda2</path></ti>
<ti>512Мб</ti>
<ti>Swap</ti>
<ti>Файл подкачки Linux (Тип 0x82)</ti>
</tr>
<tr>
<ti><path>/dev/sda3</path></ti>
<ti>Оставшаяся часть диска</ti>
<ti>ext3, ext4, reiserfs, xfs</ti>
<ti>Корневой раздел Linux (Тип 0x83)</ti>
</tr>
</table>

<warn>
<c>parted</c> способна изменять размер разделов, включая HFS+. К сожалению, 
могут быть проблемы при изменении журналируемых разделов HFS+, так что перед 
изменением обязательно отключайте журналирование в MacOS X. Помните, что 
операция изменения размера опасна, и вы действуете на свой страх и риск! 
Перед изменением размера всегда создавайте резервные копии своих данных!
</warn>

<p>
Если вам интересно знать, какого размера должны быть разделы, а равно как и
сколько их вообще вам потребуется, продолжайте чтение. В противном случае
начинайте создание разделов и переходите к главе <uri
link="#mac-fdisk">Использование mac-fdisk (Apple) для создания разделов</uri>
или <uri link="#parted">Альтернатива: использование parted (IBM/Pegasos) для
создания разделов</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Сколько и какого размера?</title>
<body>

<p>
Количество разделов очень сильно зависит от используемого ПО. Например если в
вашей системе зарегистрировано большое количество пользователей, вероятно вы
захотите, чтобы <path>/home</path> находился отдельно для увеличения
безопасности и упрощения создания резервных копий. Если вы устанавливаете
Gentoo в качестве почтового сервера, то <path>/var</path> должен находиться на
отдельном разделе, т.к. вся получаемая почта хранится в <path>/var</path>. Правильный
выбор файловой системы для разделов позволит увеличить производительность вашей
системы. Игровые серверы должны иметь отдельный раздел с <path>/opt</path>,
т.к. большая часть ПО для их работы устанавливается в этот каталог. Причина
выделения на собственный раздел аналогична для <path>/home</path>: безопасность
и резервные копии. Какой вариант вы бы не выбрали, вы явно захотите оставить побольше места для 
<path>/usr</path> т.к. помимо того, что здесь хранится большинство приложений,
одно дерево Portage занимает около 500 Мб, не считая архивов с исходными кодами,
размещенных внутри дерева.
</p>

<p>
Как вы можете видеть, все зависит от ваших целей. Наличие отдельных разделов или
томов имеет следующие преимущества:
</p>

<ul>
<li>
  Вы можете выбрать наиболее подходящую файловую систему для каждого раздела
  или тома
  </li>
<li>
  Вы не столкнетесь с нехваткой места на диске для всей системы, например если  
  какое-нибудь неправильно работающее приложение постоянно производит запись на
  раздел или том.
</li>
<li>
  В случае необходимости проверка ФС займет меньше времени, т.к. проверка
  разных разделов может выполняться параллельно (однако еще больший выигрыш по
  времени дает использование нескольких физических дисков)
</li>
<li>
  Безопасность системы может быть улучшена если некоторые разделы будут
  смонтированы в режиме read-only (только для чтения), nosuid (setuid бит
  игнорируется), noexec (бит запуска игнорируется) и т.д.
</li>
</ul>

<p>
Однако, создание множества разделов имеет и минусы: при неправильной
настройке вы получите систему в которой много свободного места на одном
разделе и полная его нехватка на другом. Еще одной особенностью является то,
что при использовании отдельных разделов  - особенно для важных точек монтирования,
таких, как <path>/usr</path> или <path>/var</path> - нужно загружаться с
использованием initramfs для монтрирования данных разделов, перед тем,
как запустятся другие загрузочные скрипты. Это не всегда является
проблемой, у вас все может быть по-другому.
</p>

<p>
Кроме того, существует ограничение в размере 15 штук на возможное количество 
разделов для дисков SCSI и SATA.
</p>

</body>
</subsection>
</section>
<section id="mac-fdisk">
<title>По умолчанию: использование mac-fdisk (Apple) для создания
разделов</title>
<body>

<p>
В этом случае создайте разделы, используя <c>mac-fdisk</c>:
</p>

<pre caption="Запуск mac-fdisk">
# <i>mac-fdisk /dev/sda</i>
</pre>

<p>
Если вы используете Apple Disk Utility для выделения места под Linux, сначала
удалите разделы, которые вы создали ранее, чтобы появилось место для новой
установки. Используйте <c>d</c> в <c>mac-fdisk</c> для удаления этих разделов. 
Вас спросят, какой из разделов удалить. Обычно на машинах NewWorld первый 
раздел (Apple_partition_map) не может быть удален. Если вы хотите начать
с чистого диска, вы можете просто инициализировать диск, нажав <c>i</c>. Это
полностью удалит диск, так что используйте данную опцию с осторожностью.
</p>

<p>
Во-вторых, создайте раздел <e>Apple_Bootstrap</e>, используя <c>b</c>.
Вас спросят, с какого блока начать. Введите номер первого свободного
раздела, нажав затем на <c>p</c>. Например, <c>2p</c>.
</p>

<note>
Этот раздел <e>не является</e> разделом <path>/boot</path>. Он не используется
Linux; не размещайте никакую файловую систему сюда и никогда не монтируйте
этот раздел. Пользователям Apple не нужен дополнительный раздел для
<path>/boot</path>.
</note>

<p>
Теперь создайте раздел подкачки, нажав <c>c</c>. <c>mac-fdisk</c> снова
спросит, с какого блока начать этот раздел. Т.к. ранее мы использовали <c>2</c>
для создания раздела Apple_Bootstrap, вы должны ввести <c>3p</c>. Когда вас
спросят о размере, наберите <c>512M</c> (или другой требуемый размер &mdash;
рекомендуется минимум в 512 МБ, но обычно приемлемым размером будет размер,
в 2 раза больший размера вашей оперативной памяти). Когда вас спросят имя, 
наберите <c>swap</c>.
</p>

<p>
Чтобы создать корневой раздел, наберите <c>c</c>, а затем <c>4p</c> чтобы
выбрать, с какого блока должен начинаться корневой раздел. Когда спросят
размер, наберите снова <c>4p</c>. <c>mac-fdisk</c> растолкует это как
&laquo;Использовать все доступное пространство&raquo;. Когда вас спросят имя,
наберите <c>root</c>.
</p>

<p>
Чтобы закончить, запишите разделы на диск нажав <c>w</c> и <c>q</c> для выхода
из <c>mac-fdisk</c>.
</p>

<note>
Чтобы убедиться, что все в порядке, запустите <c>mac-fdisk -l</c>, и проверьте,
что все разделы на месте. Если вы не видите созданных разделов или внесенных
изменений, реинициализируйте разделы, нажав <c>i</c> в <c>mac-fdisk</c>.
Помните, что это создаст заново карту разделов, вследствие чего удаляться
все ваши разделы.
</note>

<p>
Теперь, когда разделы созданы, вы можете продолжить с 
<uri link="#filesystems">создания файловых систем</uri>.
</p>

</body>
</section>
<section id="parted">
<title>Использование parted для разбивки вашего диска (Pegasos и RS/6000)</title>
<body>

<p>
<c>parted</c>, Редактор Разделов, теперь может работать с разделами HFS+,
используемыми MacOS и MacOS X. С помощью этой утилиты вы можете изменять
размер Mac-разделов и создать пространство для разделов Linux. Однако
представленный ниже пример описывает создание разделов только для
компьютеров Pegasos.
</p>

<p>
Сначала запустим <c>parted</c>:
</p>

<pre caption="Запуск parted">
# <i>parted /dev/sda</i>
</pre>

<p>
Если диск не разделен, запустите <c>mklabel amiga</c> чтобы создать метку диска
для устройства.
</p>

<p>
Вы можете в любое время набрать <c>print</c> в <c>parted</c>, чтобы просмотреть
текущую таблицу разделов. В любое время если во время изменений вы
почувствовали, что совершили ошибку, вы можете нажать <c>Ctrl-c</c> для отмены
изменений.
</p>

<p>
Если вы намереваетесь установить MorphOS на ваш компьютер Pegasos, создайте ФС
affs1 в начале диска. 32 МБ должно быть более чем достаточно для записи ядра 
MorphOS. Если у вас Pegasos I или вы планируете использовать любую файловую систему,
отличную от ext2 или ext3, то на этом же разделе вам нужно будет хранить Linux-ядро
(так как Pegasos II может загружаться только с разделов ext2/ext3 или affs1). 
Для создания раздела наберите <c>mkpart primary affs1 START END</c>,
где <c>START</c> и <c>END</c> должны быть заменены диапазоном в мегабайтах
(например <c>0 32</c> для создания раздела 32 МБ, начинающегося на 0 МБ и
заканчивающегося на 32 МБ). Если, вместо этого, вы выберете создать раздел
ext2 или ext3, подставьте ext2 или ext3 вместо affs1 в команде <c>mkpart</c>.
</p>

<p>
Вам нужно создать два раздела для Linux, одну для корневой ФС и однин раздел
для файла подкачки. Запустите <c>mkpart primary ext3 START END</c> для создания каждого из
разделов, заменив <c>START</c> и <c>END</c> желаемыми границами в мегабайтах.
</p>

<p>
Обычно рекомендуется, чтобы вы создали раздел подкачки, размер которого равен 
двойному размеру оперативной памяти, но не менее 512 МБ. Чтобы создать раздел 
подкачки, запустите <c>mkpart primary linux-swap START END</c>, где START и
END, опять же, обозначают границы разделов.
</p>

<p>
Когда вы закончите в <c>parted</c>, просто наберите <c>quit</c>.
</p>

</body>
</section>
<section id="filesystems">
<title>Создание файловых систем</title>
<subsection>
<title>Введение</title>
<body>

<p>
Разделы созданы, настало время разместить файловые системы на них. Если вы
не уверены, какую ФС использовать и вы вполне довольны нашим выбором
по умолчанию, вы можете перейти к
разделу <uri link="#filesystems-apply">Размещение файловых систем на
разделе</uri>. Если нет, то продолжайте чтение и узнайте больше о доступных для
использования файловых системах.
</p>

</body>
</subsection>
<subsection>
<include href="hb-install-filesystems.xml"/>
</subsection>

<subsection>
<title>Активация раздела подкачки</title>
<body>

<p>
<c>mkswap</c> &mdash; команда, используемая для инициализации раздела подкачки:
</p>

<pre caption="Создание сигнатуры раздела подкачки">
# <i>mkswap /dev/sda3</i>
</pre>

<p>
Для активации раздела подкачки используется <c>swapon</c>:
</p>

<pre caption="Активация раздела подкачки">
# <i>swapon /dev/sda3</i>
</pre>

<p>
Создайте и активируйте раздел подкачки.

</p>

</body>
</subsection>

<subsection id="filesystems-apply">
<title>Размещение файловых систем на разделе</title>
<body>

<p>
Для создания файловой системы на разделе или томе существуют утилиты для
каждого доступного типа:
</p>

<table>
<tr>
  <th>Файловая система</th>
  <th>Команда</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti><c>mke2fs</c></ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti><c>mke2fs -j</c></ti>
</tr>
<tr>
  <ti>ext4</ti>
  <ti><c>mkfs.ext4</c></ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti><c>mkreiserfs</c></ti>
</tr>
<tr>
  <ti>xfs</ti>
  <ti><c>mkfs.xfs</c></ti>
</tr>
</table>

<p>
К примеру, для создания файловой системы ext3 на корневом разделе 
(<path>/dev/sda4</path> в нашем примере), вы должны выполнить следующие команды:
</p>

<pre caption="Размещение ФС на разделе">
# <i>mke2fs -j /dev/sda4</i>
</pre>

<p>
Теперь разместите файловые системы на вновь созданных разделах (или логических
томах).
</p>

<impo>
Если вы выберете использовать ReiserFS для <path>/</path>, не изменяйте
размер блока по умолчанию, если вы будете использовать <c>yaboot</c>
как ваш начальный загрузчик, как это объяснено в разделе 
<uri link="?part=1&amp;chap=10">Настройка начального загрузчика</uri>.
</impo>

<note>
На PegasosII раздел, содержащий ядро, должен быть ext2, ext3 или affs1. Компьютеры
NewWorld могут загружаться с ext2, ext3, XFS, ReiserFS или даже HFS/HFS+
файловых систем. На компьютерах OldWorld при загрузке с помощью BootX, ядро
должно находиться в HFS разделе, но это может быть преодолено, когда вы
настроите свой начальный загрузчик.
</note>

</body>
</subsection>
</section>

<section>
<title>Монтирование</title>
<body>

<p>
Теперь, когда разделы созданы и файловые системы размещены, настало время
смонтировать эти разделы. Используйте команду <c>mount</c>. В качестве
примера мы смонтируем корневой раздел:
</p>

<pre caption="Монтирование разделов">
# <i>mount /dev/sda4 /mnt/gentoo</i>
</pre>

<note>
Если вы хотите разместить <path>/tmp</path> на отдельном разделе, не забудьте
изменить права доступа к этому каталогу после монтирования и распаковки с
помощью команды <c>chmod 1777 /mnt/gentoo/tmp</c>. То же самое верно для <path>/var/tmp</path>.
</note>

<p>
Нам также необходимо будет смонтировать ФС proc (виртуальный интерфейс ядра) в
каталог <path>/proc</path>. Но для начала надо разместить необходимые нам файлы
на разделах.
</p>

<p>
Переходите к разделу <uri link="?part=1&amp;chap=5">Подготовка установочных
файлов Gentoo</uri>.
</p>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-date: 2012-10-18
source-cvs-revision: 1.52
translated-by: Vasiliy Golubev <vas@nightmail.ru>
translated-by: Azamat H. Hackimov <azazello1984@mail.ru>
edited-by: Vladimir Romanov <blueboar2@gmail.com>
-->
