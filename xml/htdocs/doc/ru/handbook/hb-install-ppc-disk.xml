<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-ppc-disk.xml,v 1.1 2005/11/11 02:50:52 achumakov Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<sections>

<version>2.4</version>
<date>2005-08-25</date>

<section>
<title>Общие сведения о блочных устройствах</title>
<subsection>
<title>Блочные устройства</title>
<body>

<p>
Мы достаточно подробно рассмотрим аспекты работы с дисками в Gentoo Linux 
и Linux вообще, включая файловые системы, разделы и блочные устройства. 
Позже, когда вы уже разберетесь с вводом-выводом на диск и файловыми системами 
мы поможем вам с разметкой диска на разделы и файловые системы для 
вашей установки Gentoo Linux.
</p>

<p>
Для начала давайте познакомимся с <e>блочными устройствами</e>. Наиболее 
известным блочным устройством, вероятно, является устройство, представляющее
собой первый IDE диск в Linux системе, и известное как <path>/dev/hda</path>.
Если в вашей системе используются диски SCSI или SATA, тогда ваш первый жесткий
диск будет именоваться <path>/dev/sda</path>.
</p>

<p>
Блочные устройства, аналогичные приведенным примерам, представляют собой 
абстрактный интерфейс к диску. Это позволяет пользовательскому ПО использовать 
эти блочные устройства для обращения к дискам не беспокоясь, к какому типу они 
принадлежат: IDE, SCSI или какому-то еще. ПО может адресовать место на диске, 
как набор смежных 512-байтных блоков с произвольным доступом.
</p>

</body>
</subsection>
<subsection>
<title>Разделы</title>
<body>

<p>
Не смотря на то, что теоретически возможно использовать весь диск для
размещения вашей Linux системы, этого почти никогда не случается на практике.
Вместо этого все большое блочное устройство (диск) разбивается на меньшие,
более удобные для обращения, блочные устройства. Для всех систем они
называются <e>разделами</e>.
</p>

</body>
</subsection>
</section>
<section>
<title>Разработка схемы разделения диска</title>
<subsection>
<title>Схема разделения по умолчанию</title>
<body>

<p>
Если вы не хотите заниматься разработкой схемы для вашей системы, вы можете
воспользоваться схемой, которую мы используем в этой книге:
</p>

<table>
<tr>
  <th>Раздел NewWorld</th>
  <th>Раздел OldWorld</th>
  <th>Раздел Pegasos</th>
  <th>Раздел RS/6000</th>
  <th>Файловая система</th>
  <th>Размер</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><path>/dev/hda1</path></ti>
  <ti><path>/dev/hda1</path></ti>
  <ti>(неприменимо)</ti>
  <ti>(неприменимо)</ti>
  <ti>(карта разделов)</ti>
  <ti>32k</ti>
  <ti>Apple_partition_map</ti>
</tr>
<tr>
  <ti><path>/dev/hda2</path></ti>
  <ti>(неприменимо)</ti>
  <ti>(неприменимо)</ti>
  <ti>(неприменимо)</ti>
  <ti>(bootstrap)</ti>
  <ti>800k</ti>
  <ti>Apple_Bootstrap</ti>
</tr>
<tr>
  <ti>(неприменимо)</ti>
  <ti>(неприменимо)</ti>
  <ti>(неприменимо)</ti>
  <ti><path>/dev/sda1</path></ti>
  <ti>(PReP Boot)</ti>
  <ti>800k</ti>
  <ti>Тип 0x41</ti>
</tr>
<tr>
  <ti>(неприменимоe)</ti>
  <ti><path>/dev/hda2</path> (если используется quik)</ti>
  <ti><path>/dev/hda1</path></ti>
  <ti>(не нужен)</ti>
  <ti>ext2</ti>
  <ti>32 МБ</ti>
  <ti>Загрузочный раздел</ti>
</tr>
<tr>
  <ti><path>/dev/hda3</path></ti>
  <ti><path>/dev/hda2</path>(<path>/dev/hda3</path>, если используется
  quik)</ti>
  <ti><path>/dev/hda2</path></ti>
  <ti><path>/dev/sda2</path></ti>
  <ti>(раздел подкачки)</ti>
  <ti>512M</ti>
  <ti>Раздел подкачки, тип 0x82</ti>
</tr>
<tr>
  <ti><path>/dev/hda4</path></ti>
  <ti><path>/dev/hda3</path> (<path>/dev/hda4</path> если используется
  quik)</ti>
  <ti><path>/dev/hda3</path></ti>
  <ti><path>/dev/sda3</path></ti>
  <ti>ext3, xfs</ti>
  <ti>Оставшаяся часть диска</ti>
  <ti>Корневой раздел, тип 0x83</ti>
</tr>
</table>

<note>
Есть несколько разделов: <path>Apple_Driver43, Apple_Driver_ATA, 
Apple_FWDriver, Apple_Driver_IOKit, Apple_Patches</path>. Если не планируете
использовать MacOS 9, то вы можете удалить их, т.к. MacOS X и Linux не
нуждаются в них. Чтобы удалить их, используйте parted или сотрите диск,
инициализировав карту разделов.
</note>

<warn>
<c>parted</c> способна изменять размер разделов. На установочном диске на него 
наложены заплатки для изменения размера ФС HFS+. К сожалению, опасно изменять 
размер журналируемой ФС HFS+, удостоверьтесь, что сначала отключили 
журналирование в MacOS X и что запустили утилиту проверки диска после 
изменения размера. Все, что связано с изменением размера с помощью parted, вы 
делаете на свой страх и риск! Убедитесь, что у вас есть резервные копии ваших 
данных!
</warn>

<p>
Если вам интересно знать какого размера должны быть разделы, а равно как и
сколько их вообще вам потребуется продолжайте чтение. В противном случае
начинайте создание разделов и переходите к главе <uri
link="#mac-fdisk">Использование mac-fdisk (Apple) для создания разделов</uri>
или <uri link="#parted">Альтернатива: использование parted (IBM/Pegasos) для
создания разделов</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Сколько и какого размера?</title>
<body>

<p>
Количество разделов очень сильно зависит от используемого ПО. Например если в
вашей системе зарегистрировано большое количество пользователей, вероятно вы
захотите, чтобы <path>/home</path> находился отдельно для увеличения
безопасности и упрощения создания резервных копий. Если вы устанавливаете
Gentoo в качестве почтового сервера, то <path>/var</path> должен находиться на
отдельном разделе, т.к. вся почта хранится в <path>/var</path>. Правильный
выбор файловой системы для разделов позволит увеличить производительность вашей
системы. Игровые серверы должны иметь отдельный раздел с <path>/opt</path>,
т.к. большая часть ПО для их работы устанавливается в этот каталог. Причина
выделения на собственный раздел аналогична для <path>/home</path>: безопасность
и резервные копии. Определенно стоит оставить побольше места для 
<path>/usr</path> т.к. помимо того, что здесь хранится большинство приложений,
одно дерево Portage занимает около 500 Мб, не считая архивов с исходными кодами,
размещенных внутри дерева.
</p>

<p>
Как вы можете видеть, все зависит от ваших целей. Наличие отдельных разделов или
томов имеет следующие преимущества:
</p>

<ul>
<li>
  Вы можете выбрать наиболее подходящую файловую систему для каждого раздела
  или тома
  </li>
<li>
  Вы не столкнетесь с нехваткой места на диске для всей системы, например если  
  какое-нибудь неправильно работающее приложение постоянно производит запись на
  раздел или том.
</li>
<li>
  В случае необходимости проверка ФС займет меньше времени, т.к. проверка
  разных разделов может выполняться параллельно (однако еще больший выигрыш по
  времени дает использование нескольких физических дисков)
</li>
<li>
  Безопасность системы может быть улучшена если некоторые разделы будут
  смонтированы в режиме read-only (только для чтения), nosuid (setuid бит
  игнорируется), noexec (бит запуска игнорируется) и т.д.
</li>
</ul>

<p>
Однако, создание множества разделов имеет один большой минус: при неправильной
настройке вы можете получит систему в которой много свободного места на одном
разделе и полная его нехватка на другом. Также существует ограничение, в
размере 15 штук на возможное количество разделов для дисков SCSI и SATA.
</p>

</body>
</subsection>
</section>
<section id="mac-fdisk">
<title>По умолчанию: использование mac-fdisk (Apple) для создания
разделов</title>
<body>

<p>
В этом случае создайте разделы, используя <c>mac-fdisk</c>:
</p>

<pre caption="Запуск mac-fdisk">
# <i>mac-fdisk /dev/hda</i>
</pre>

<p>
Сначала удалите, чтобы расчистить место для разделов Linux. Используйте <c>d</c>
в <c>mac-fdisk</c> чтобы удалить раздел(ы). Вас спросят, какой из разделов
удалить. На компьютерах Apple первый раздел (Apple_partition_map) не может
быть удален.
</p>

<p>
Для NewWorld Mac, создайте раздел <e>Apple_Bootstrap</e>, используя <c>b</c>.
Вас спросят, с какого блока начать. Введите номер первого свободного
раздела, нажав затем на <c>p</c>. Например, <c>2p</c>.
</p>

<note>
Этот раздел <e>не является</e> разделом <path>/boot</path>. Он не используется
Linux; не размещайте никакую файловую систему сюда и никогда не монтируйте
этот раздел. Пользователям Apple не нужен дополнительный раздел для
<path>/boot</path>.
</note>

<p>
Теперь создайте раздел подкачки, нажав <c>c</c>.<c>mac-fdisk</c> снова
спросит, с какого блока начать этот раздел. Т.к. ранее мы использовали <c>2</c>
для создания раздела Apple_Bootstrap, вы должны ввести <c>3p</c>. Когда вас
спросят о размере, наберите <c>512M</c> (или другой требуемый размер &mdash;
хотя рекомендуется 512 МБ). Когда вас спросят имя, наберите <c>swap</c>
(необязательно).
</p>

<p>
Чтобы создать корневой раздел, наберите <c>c</c>, а затем <c>4p</c> чтобы
выбрать, с какого блока должен начинаться корневой раздел. Когда спросят
размер, наберите снова <c>4p</c>. <c>mac-fdisk</c> растолкует это как
&laquo;Использовать все доступное пространство&raquo;. Когда вас спросят имя,
наберите <c>root</c> (необязательно).
</p>

<p>
Чтобы закончить, запишите разделы на диск нажав <c>w</c> и <c>q</c> для выхода
из <c>mac-fdisk</c>.
</p>

<note>
Чтобы убедиться, что все в порядке, запустите mac-fdisk еще раз и проверьте,
что все разделы на месте. Если вы не видите созданных разделов или внесенных
изменений, реинициализируйте разделы, нажав &laquo;i&raquo; в mac-fdisk.
Помните, что это создаст заново карту разделов, вследствие чего удаляться
все ваши разделы.
</note>

<p>
Теперь, когда разделы созданы, вы можете продолжить с <uri
link="#filesystems">создания файловых систем</uri>.
</p>

</body>
</section>
<section id="parted">
<title>Использование parted (главным образом Pegasos) для создания
разделов</title>
<body>

<p>
<c>parted</c>, Редактор Разделов, теперь может работать с разделами HFS+,
используемыми MacOS и MacOS X. С помощью этой утилиты вы можете изменять
размер Mac-разделов и создать пространство для разделов Linux. Однако
представленный ниже пример описывает создание разделов только для
компьютеров Pegasos.
</p>

<p>
Сначала запустим <c>parted</c>:
</p>

<pre caption="Запуск parted">
# <i>parted /dev/hda</i>
</pre>

<p>
Если диск не разделен, запустите <c>mklabel amiga</c> чтобы создать метку диска
для устройства.
</p>

<p>
Вы можете в любое время набрать <c>print</c> в parted, чтобы просмотреть
текущую таблицу разделов. В любое время если во время изменений вы
почувствовали, что совершили ошибку, вы можете нажать <c>Ctrl-c</c> для отмены
изменений.
</p>

<p>
Если вы намереваетесь установить MorphOS на ваш компьютер Pegasos, создайте ФС
affs1 с именем &laquo;BI0&raquo; (BI-ноль) в начале диска. 32 МБ должно быть
более чем достаточно для записи ядра MorphOS. Если у вас Pegasos I или вы
планируете использовать reiserfs или xfs, вам понадобится еще один раздел для
хранения на нем ядра (Pegasos II может загружаться только с разделов ext2/ext3
или affs1). Для создания раздела наберите <c>mkpart primary affs1 START END</c>,
где <c>START</c> и <c>END</c> должны быть заменены диапазоном в мегабайтах
(например <c>0 32</c> для создания раздела 32 МБ, начинающегося на 0 МБ и
заканчивающегося на 32 МБ.
</p>

<p>
Вам нужно создать два раздела для Linux, для корневой ФС, где будут все ваши
программные файлы, и для раздела подкачки. Чтобы создать корневую ФС, сначала
вы должны решить, какую ФС использовать. Выбор возможен между ext2, ext3,
reiserfs и xfs. Пока вы не знаете, что делаете, используйте ext3. Запустите
<c>mkpart primary ext3 START END</c>, чтобы создать раздел ext3. И снова
замените <c>START</c> и <c>END</c> начальным и конечным значениями раздела в
мегабайтах.
</p>

<p>
Обычно рекомендуется, чтобы вы создали раздел подкачки, размер которого равен 
двойному размеру оперативной памяти. Возможно, вы хотите использовать меньший
размер раздела подкачки, если вы не планируете запускать одновременно много
приложений (хотя рекомендуется по меньшей мере 512 МБ). Чтобы создать раздел 
подкачки, запустите <c>mkpart primary linux-swap START END</c>.
</p>

<p>
Запишите младшие номера разделов, т.к. они потребуются во время установки.
Чтобы узнать эти номера, наберите <c>print</c>. Ваши диски отображаются в
качестве <path>/dev/hdaX</path>, где X является младшим номером раздела.
</p>

<p>
Когда вы закончите в parted, просто наберите <c>quit</c>.
</p>

</body>
</section>
<section id="filesystems">
<title>Создание файловых систем</title>
<subsection>
<title>Введение</title>
<body>

<p>
Разделы созданы, настало время разместить файловые системы на них. Если вам
безразлично, какую ФС использовать и вы вполне довольны файловой системой,
используемой нами в этой Настольной книге по-умолчанию, вы можете перейти к
разделу <uri link="#filesystems-apply">Размещение файловых систем на
разделе</uri>. Если нет, то продолжайте чтение и узнайте больше о доступных для
использования файловых системах...
</p>

</body>
</subsection>
<subsection>
<title>Файловые системы?</title>
<body>

<p>
Доступно несколько файловых систем. ext2, ext3, ReiserFS и XFS признаны
стабильным для архитектуры PPC.
</p>

<p>
<b>ext2</b> &mdash; это проверенная временем и родная для Linux файловая
система, но она не обладает средствами журналирования метаданных, что при
повседневном использовании означает, что проверка целостности во время запуска
системы может оказаться весьма продолжительной. Сегодня существует достаточно
широкий выбор ФС нового поколения, т.н. журналируемых файловых систем, которые
могут быть проверены на целостность очень быстро и по этому более
предпочтительны нежели их не журналируемые собратья. Журналируемая ФС позволяет
избежать долгих задержек при старте системы, если при том ваша файловая система
оказалась в нестабильном состоянии.
</p>

<p>
<b>ext3</b> &mdash; это журналируемая версия ext2. Она обладает средствами
журналирования метаданных для быстрого восстановления наряду с другими
режимами ведения журнала, такими как журналирование всех данных и упорядоченное
ведение журнала данных. ext3 &mdash; это очень хорошая и надежная ФС. У нее
есть дополнительная возможность индексации через хэшированные B-деревья, что
позволяет повысить производительность практически в любой ситуации. Подводя
итог, можно сказать, что ext3 &mdash; превосходная ФС.
</p>

<p>
<b>ReiserFS</b> &mdash; это ФС, основанная на т.н. B*-деревьях. Она обладает
очень хорошей производительностью и сильно (иногда в 10&mdash;15 раз)
превосходит ext2 и ext3 при работе с файлами малого размера (размером менее 4
КБ). ReiserFS также очень хорошо масштабируется и обладает средствами
журналирования. Начиная со времени выхода ядра версии 2.4.18, ReiserFS признана
стабильной и пригодной для использования как в системах общего назначения, так и
в системах с большой нагрузкой, такой как создание больших файловых систем,
использованием множества файлов малого размера, файлов очень большого размера и
каталогов, содержащих десятки тысяч файлов.
</p>

<p>
<b>XFS</b> &mdash; это файловая система, обладающая наряду со средствами
ведения журнала хорошим набором дополнительных возможностей, оптимизирована для
хорошей масштабируемости. Мы рекомендуем ее применение только в Linux-системах
с высококлассными SCSI и/или оптоволоконными дисками и оборудованными
источниками бесперебойного питания. Из-за того, что XFS очень агрессивно
кеширует данные в памяти, очень вероятна ситуация, когда неправильно
спроектированная программа (не обладающая достаточной осторожностью при записи
файлов на диск, но таких мало) может потерять большой объем информации при
неожиданном отключении питания.
</p>

</body>
</subsection>
<subsection id="filesystems-apply">
<title>Размещение файловых систем на разделе</title>
<body>

<p>
Для создания файловой системы на разделе или томе существуют утилиты для
каждого доступного типа:
</p>

<table>
<tr>
  <th>Файловая система</th>
  <th>Команда</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti><c>mkfs.ext2</c></ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti><c>mkfs.ext3</c></ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti><c>mkfs.reiserfs</c></ti>
</tr>
<tr>
  <ti>xfs</ti>
  <ti><c>mkfs.xfs</c></ti>
</tr>
</table>

<p>
К примеру, для создания корневого раздела (<path>/dev/hda4</path> в нашем
примере) с ФС ext3 (как в нашем примере), вы должны выполнить следующие команды:
</p>

<pre caption="Размещение ФС на разделе">
# <i>mkfs.ext3 /dev/hda4</i>
</pre>

<p>
Теперь разместите файловые системы на вновь созданных разделах (или логических
томах).
</p>

<note>
На Pegasos II раздел, содержащий ядро, должен быть ext2 или ext3. Компьютеры
NewWorld могут загружаться с ext2, ext3, XFS, ReiserFS или даже HFS/HFS+
файловых систем. На компьютерах OldWorld при загрузке с помощью BootX, ядро
должно находится в HFS разделе, но это может быть преодолено, когда вы
настроете свой начальный загрузчик.
</note>

</body>
</subsection>
<subsection>
<title>Активация раздела подкачки</title>
<body>

<p>
<c>mkswap</c> &mdash; команда, используемая для инициализации раздела подкачки:
</p>

<pre caption="Создание сигнатуры раздела подкачки">
# <i>mkswap /dev/hda3</i>
</pre>

<p>
Для активации раздела подкачки используется <c>swapon</c>:
</p>

<pre caption="Активация раздела подкачки">
# <i>swapon /dev/hda3</i>
</pre>

<p>
Создайте и активируйте раздел подкачки.

</p>

</body>
</subsection>
</section>
<section>
<title>Монтирование</title>
<body>

<p>
Теперь, когда разделы созданы и файловые системы размещены настало время
смонтировать эти разделы. Используйте команду <c>mount</c>. Не забудьте
предварительно создать необходимые каталоги для монтирования каждого раздела.
В этом примере мы создаем точку монтирования и монтируем корневой раздел:
</p>

<pre caption="Монтирование разделов">
# <i>mkdir /mnt/gentoo</i>
# <i>mount /dev/hda4 /mnt/gentoo</i>
</pre>

<note>
Если вы хотите разместить <path>/tmp</path> на отдельном разделе, не забудьте
изменить права доступа к этому каталогу после монтирования: <c>chmod 1777
/mnt/gentoo/tmp</c>. В этом каталоге также размещается <path>/var/tmp</path>.
</note>


<p>
Нам также необходимо будет смонтировать ФС proc (виртуальный интерфейс ядра) в
каталог <path>/proc</path>. Но для начала надо разместить необходимые нам файлы
на разделах.
</p>

<p>
Переходите к разделу <uri link="?part=1&amp;chap=5">Подготовка установочных
файлов Gentoo</uri>.
</p>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 2.4-r1
target-date: 2005-09-03
source-cvs-revision: 1.32
translated-by: Vasiliy Golubev <vas@nightmail.ru>, Azamat H. Hackimov
<azazello1984@mail.ru>
edited-by: none

notes:
hb-install-x86-* is used as translation template (by V. Golubev)
-->
