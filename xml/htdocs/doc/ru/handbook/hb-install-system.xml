<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-system.xml,v 1.12 2006/03/31 07:41:50 achumakov Exp $ -->

<sections>

<version>2.19</version>
<date>2006-03-06</date>

<section>
<title>Изменение корневого каталога</title>
<subsection>
<title>Дополнительно: выбор зеркала</title>
<body>

<p>
Для ускорения загрузки исходного кода рекомендуется выбрать быстрое зеркало. 
Portage ищет переменную GENTOO_MIRRORS в файле <path>make.conf</path> и 
использует зеркала, перечисленные в ней. Конечно, можно просмотреть наш <uri 
link="/main/en/mirrors.xml">список зеркал (англ.)</uri> и выбрать одно или 
несколько, географически ближайших к вам (чаще всего они и будут самыми
быстрыми), но мы предлагаем вам удобную утилиту <c>mirrorselect</c>, которая
позволяет выбрать желаемые зеркала более удобным способом.
</p>

<pre caption="Запуск mirrorselect для установки переменной GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt;/mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Не выбирайте зекрала IPv6. Файлы стадий пока не поддерживают протокол IPv6.
</warn>

<p>
Вторая важная настройка &mdash; установка значения переменной SYNC в файле 
<path>make.conf</path>. Эта переменная указывает на сервер rsync (сервер 
удаленной синхронизации), выбранный вами для обновления дерева Portage 
(коллекции файлов ebuild &mdash; сборочных сценариев, содержащих все данные, 
нужные Portage для скачивания и установки программ). Хотя вписать адрес сервера 
в SYNC можно и вручную, <c>mirrorselect</c> позволяет упростить это действие:
</p>

<pre caption="Выбор зеркала rsync с помощью mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
После выполнения <c>mirrorselect</c>, мы рекомендуем проверить все значения в
файле <path>/mnt/gentoo/etc/make.conf</path>!
</p>

</body>
</subsection>
<subsection>
<title>Копирование сведений о DNS</title>
<body>

<p>
Перед тем, как перейти в новую среду, осталось сделать одно дело: скопировать 
информацию о DNS (системе доменных имен) в файл <path>/etc/resolv.conf</path>.
Это нужно, чтобы при переходе сохранить работоспособность сети. В файле 
<path>/etc/resolv.conf</path> содержатся адреса серверов имен, используемых в 
вашей сети.
</p>

<pre caption="Копирование информации о DNS">
<comment>(параметр &laquo;-L&raquo; нужен, чтобы случайно не скопировать
 символьную ссылку)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Монтирование файловых систем /proc и /dev</title>
<body>

<p>
Смонтируйте файловую систему <path>/proc</path> в
<path>/mnt/gentoo/proc</path>, чтобы после изменения корневого каталога
устанавливаемая система смогла обращаться к информации, предоставляемой ядром,
а затем создайте привязку монтирования файловой системы <path>/dev</path>.
</p>

<pre caption="Монтирование /proc и /dev">
# <i>mount -t proc none /mnt/gentoo/proc</i>
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>

</body>
</subsection>
<subsection>
<title>Переход в новую среду</title>
<body>

<p>
Итак, все разделы подготовлены, а базовая операционная среда установлена. 
Теперь пора войти в нее, <e>изменив корневой каталог</e>. Таким образом, мы 
перейдем из текущей установочной среды (с компакт-диска или другого 
установочного носителя) в свою устанавливаемую систему (находящуюся в недавно 
размеченных разделах).
</p>

<p>
Изменение выполняется в три этапа. Сначала мы с помощью <c>chroot</c> изменим 
корневой каталог с <path>/</path> (находящийся на установочном носителе) на 
<path>/mnt/gentoo</path> (находящийся на ваших дисковых разделах). Затем мы 
создадим новую среду, пользуясь утилитой <c>env-update</c>, которая, 
собственно, создает переменные среды. Наконец, мы загрузим эти переменные в 
память при помощи <c>source</c>.
</p>

<pre caption="Изменение корневого каталога для перехода в новую среду">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
>> Regenerating /etc/ld.so.cache...
# <i>source /etc/profile</i>
# <i>export PS1="(chroot) $PS1"</i>
</pre>

<p>
Поздравляем! Теперь вы в своей собственной среде Gentoo Linux. Конечно, на
этом она далеко еще не готова, поэтому в руководстве еще осталось несколько 
разделов :-)
</p>

</body>
</subsection>
</section>

<section>
<title>Настройка Portage</title>
<subsection>
<title>Обновление дерева Portage</title>
<body>

<p>
Теперь надо обновить дерево Portage до самой последней версии с помощью команды
<c>emerge --sync</c>:
</p>

<pre caption="Обновление дерева портежей">
# <i>emerge --sync</i>
<comment>(если вы пользуетесь медленным терминалом, например, последовательным
 терминалом или кадровым буфером, для ускорения процесса можно добавить 
 параметр --quiet :)</comment> 
# <i>emerge --sync --quiet</i>
</pre>

<p>
Если компьютер подключен к интернету через межсетевой экран, блокирующий 
прохождение rsync-пакетов, вы можете воспользоваться командой 
<c>emerge-webrsync</c>, которая скачивает и устанавливает снимок дерева.
</p>

<p>
Если выдано предупреждение, что имеется новая версия Portage и ее нужно 
обновить, проигнорируйте его. Обновление произойдет позже в процессе установки.
</p>

</body>
</subsection>
<subsection>
<title>Выбор нужного профиля</title>
<body>

<p>
Сначала дадим небольшое определение.
</p>

<p>
Профиль &mdash; конструктивный элемент любой системы Gentoo. В нем указываются
не только значения по умолчанию для CHOST, CFLAGS и других важных переменных, 
он также привязывает систему к определенному диапазону допустимых версий 
пакетов. Диапазоны поддерживаются разработчиками Gentoo.
</p>

<p>
Раньше пользователь редко касался профиля. Однако, пользователи х86, hppa 
и alpha могут выбирать из двух вариантов профиля: одного для ядра 2.4, другого 
для ядра 2.6. Это вызвано необходимостью улучшения интеграции ядер 2.6. Для 
архитектур ppc и ppc64 также существует несколько профилей. Мы поговорим о них 
позже.
</p>

<p>
Узнать, какой профиль используется в системе в данный момент, вы можете 
командой:
</p>

<pre caption="Выяснение используемого профиля">
# <i>ls -FGg /etc/make.profile</i>
lrwxrwxrwx  1 48 Apr  8 18:51 /etc/make.profile -> ../usr/portage/profiles/default-linux/x86/2006.0/
</pre>

<p>
Если вы используете одну из трех упомянутых архитектур, профиль по умолчанию 
даст вам систему с ядром 2.6. Это рекомендуется по умолчанию, но за вами 
сохраняется и право выбора другого профиля.
</p>

<p>
Некоторые пользователи, возможно, захотят установить систему, основанную на
старом профиле, с ядром 2.4. Если для этого есть веские основания, сначала надо 
проверить, существует ли такой дополнительный профиль. На системах x86 это 
можно сделать следующей командой:
</p>

<pre caption="Выяснение наличия дополнительного профиля">
# <i>ls -d /usr/portage/profiles/default-linux/x86/no-nptl/2.4</i>
/usr/portage/profiles/default-linux/x86/no-nptl/2.4
</pre>

<p>
В приведенном примере дополнительный профиль 2.4 существует (т.е. нет сообщений 
об отсутствующем файле или каталоге). Рекомендуется использовать профиль по 
умолчанию, но если вы все же хотите сменить его, это можно сделать так:
</p>

<pre caption="Переключение профиля на 2.4">
<comment>(убедитесь, что используете нужную архитектуру; этот пример - для x86)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/x86/no-nptl/2.4 /etc/make.profile</i>
<comment>(вывод списка файлов в профиле 2.4)</comment>
# <i>ls -FGg /etc/make.profile/</i>
total 12
-rw-r--r--  1 939 Dec 10 14:06 packages
-rw-r--r--  1 347 Dec  3  2004 parent
-rw-r--r--  1 573 Dec  3  2004 virtuals
</pre>

<p>
Для архитектуры ppc в выпуске 2006.0 появилось несколько новых профилей:
</p>

<pre caption="Профили для PPC">
<comment>(базовый профиль PPC, подходит для всех PPC-машин, минимальный)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0 /etc/make.profile</i>
<comment>(профиль для G3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G3 /etc/make.profile</i>
<comment>(профиль для G3 Pegasos)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G3/Pegasos/ /etc/make.profile</i>
<comment>(профиль для G4 (Altivec))</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G4 /etc/make.profile</i>
<comment>(профиль для G4 (Altivec) Pegasos)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc32/2006.0/G4/Pegasos/ /etc/make.profile</i>
</pre>

<p>
Для архитектуры ppc64 в выпуске 2006.0 также появилось несколько новых 
профилей:
</p>

<pre caption="Профили для PPC64">
<comment>(базовый профиль PPC64 с 64-битным режимом пользователя, для всех PPC64-машин)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/64bit-userland /etc/make.profile</i>
<comment>(базовый профиль PPC64 с 32-битным режимом пользователя, для всех PPC64-машин)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/32bit-userland /etc/make.profile</i>
<comment>(для каждого режима пользователя существуют подпрофили, как показано ниже.)</comment>
<comment>(&laquo;userland&raquo; необходимо заменять на нужный вариант режима из примеров выше)</comment>
<comment>(профиль 970 для JS20)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/970 /etc/make.profile</i>
<comment>(профиль для G5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/970/pmac /etc/make.profile</i>
<comment>(профиль для POWER3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power3 /etc/make.profile</i>
<comment>(профиль для POWER4)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power4 /etc/make.profile</i>
<comment>(профиль для POWER5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/ppc64/2006.0/(userland)/power5 /etc/make.profile</i>
<comment>(многорежимные профили на дату выхода этого выпуска нестабильны)</comment>
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Настройка переменной USE</title>
<body>

<p>
<c>USE</c> (&laquo;использовать&raquo;) &mdash; одна из самых мощных 
переменных, имеющихся в распоряжении пользователей Gentoo. Она позволяет  
при компиляции программ включать или отключать поддержку определенных 
необязательных функций. Например, некоторые программы можно компилировать 
с поддержкой gtk или qt на выбор. Другие можно собирать, включая или отключая 
поддержку SSL. Некоторые программы можно даже компилировать с поддержкой 
кадрового буфера (svgalib) вместо поддержки X11 (X-сервера).
</p>

<p>
В большинстве дистрибутивов пакеты собраны с поддержкой практически всех
мыслимых вариантов. Это увеличивает размер программ и время запуска, не говоря 
уже о чрезмерных зависимостях. В Gentoo вы сами можете определять, с какими
возможностями следует компилировать пакет. Здесь играет роль переменная 
<c>USE</c>.
</p>

<p>
В переменной <c>USE</c> указываются ключевые слова, которые отражаются на
параметрах компиляции. Например, параметр <e>ssl</e> включает компиляцию с 
поддержкой ssl всех программ, которые способны его поддерживать. <e>-X</e> 
отключает поддержку X-сервера (обратите внимание на предшествующий знак 
&laquo;минус&raquo;). Параметры <e>gnome gtk -kde -qt</e> обеспечивают 
компиляцию ваших  программ с поддержкой Gnome и gtk, но без поддержки KDE и qt, 
делая систему оптимальной для GNOME.
</p>

<p>
Настройки <c>USE</c> по умолчанию хранятся в файлах <path>make.defaults</path>
вашего профиля. Файлы <path>make.defaults</path> находятся в каталоге, на
который указывает <path>/etc/make.profile</path>, а также во всех родительких
каталогах. Значение <c>USE</c> по умолчанию &mdash; это сумма всех значений
<c>USE</c> во всех файлах <path>make.defaults</path>. Все, что вы вносите в
<path>/etc/make.conf</path>, рассчитывается относительно этих значений. Когда 
вы добавляете что-либо к значению <c>USE</c>, оно добавляется в список по 
умолчанию. Когда удаляете что-либо (указывая ключевое слово с предшествующим 
знаком минус), оно удаляется из списка по умолчанию (если оно там вообще было). 
<e>Никогда</e> ничего не меняйте в <path>/etc/make.profile</path>. Все, что там 
находится, перезаписывается при обновлении Portage! 
</p>

<p>
Полное описание переменной <c>USE</c> находится во второй части настольной 
книги Gentoo в главе <uri link="?part=2&amp;chap=2">USE-флаги</uri>. Полное 
описание возможных значений признаков использования находится в вашей системе 
в файле <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Просмотр допустимых USE-флагов">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(для прокрутки пользуйтесь клавишами стрелок, для выхода нажимайте "q")</comment>
</pre>

<p>
Например, приведем значение <c>USE</c> для системы, базирующейся на KDE, с
включением поддержки DVD, ALSA и записи CD:
</p>

<pre caption="Открытие файла /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Значение USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Дополнительно: региональные параметры GLIBC</title>
<body>

<p>
Скорее всего, вы будете использовать в системе один-два набора региональных 
параметров. До сих пор, компиляция <c>glibc</c> приводила к созданию полного 
набора всех возможных регионов. Теперь появилась возможность включить USE-флаг
<c>userlocales</c> и указать в <path>/etc/locales.build</path> только нужные 
регионы. Делайте это лишь в том случае, если точно знаете, какие из них вам 
понадобятся.
</p>

<pre caption="Включение USE-флага userlocales специально для glibc">
# <i>mkdir -p /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Теперь укажите регионы, которые вам могут потребоваться:
</p>

<pre caption="Открытие /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Вот пример одновременного подключения как английского (США), так и немецкого 
(Германия) с соответствующими кодировками (например, UTF-8).
</p>
<!-- (**) решить с русским языком: ссылка на руководство или как? -->
<pre caption="Укажите свои региональные настройки">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

<note>
Настройки, подобная приведенной, для поддержки русского языка недостаточно.
За дополнительными сведениями обращайтесь к отдельным руководствам по 
русификации Gentoo. <e>&mdash; прим. пер.</e>
</note>

<p>
Теперь приступим к <uri link="?part=1&amp;chap=7">настройке ядра</uri>.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 2.19-r2
target-date: 2006-03-07
source-cvs-revision: 1.93
translated-by: Vasiliy Golubev [vas@nightmail.ru]
edited-by:  Azamat H. Hackimov; Alexey Chumakov [achumakov@gentoo.org] 
notes:
-->
