<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-system.xml,v 1.4 2005/11/17 22:22:11 achumakov Exp $ -->

<sections>

<version>2.12</version>
<date>2005-11-11</date>

<section>
<title>Смена корня</title>
<subsection>
<title>Опция: выбор зеркала</title>
<body>

<p>
Для уменьшения затрат времени на загрузку исходных кодов мы рекомендуем вам
выбрать наиболее быстрое зеркало. Portage просматривает файл
<path>make.conf</path> в поисках переменной GENTOO_MIRRORS и использует
перечисленные в ней адреса зеркала. Также вы можете просмотреть подготовленный
нами <uri link="/main/en/mirrors.xml">список зеркал</uri> и выбрать зеркало
(или зеркала), расположенное географически ближе к вам (т.к. чаще всего оно и
является наиболее быстрыми), но мы предлагаем вам воспользоваться удобным
инструментом, под названием <c>mirrorselect</c>, который поможет выбрать
желаемые зеркала.
</p>

<pre caption="Использование mirrorselect для переменной GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt;/mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
Не выбирайте зекрала IPv6. Stage файлы не поддерживают протокол IPv6.
</warn>

<p>
Второй очень важной настройкой является установка значения для переменной SYNC
в файле <path>make.conf</path>. Эта переменная содержит адрес rsync-сервера
используемого при обновлении дерева Portage (коллекции ebuild'ов, сценариев
содержащих всю необходимую информацию для скачивания и установки ПО). Несмотря
на то, что вы можете вручную прописать адрес сервера, <c>mirrorselect</c> может
упростить эту операцию:
</p>

<pre caption="Использование mirrorselect при выборе зеркала rsync">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Мы рекомендуем после выполнения <c>mirrorselect</c> проверить все значения в
файле <path>/mnt/gentoo/etc/make.conf</path>!
</p>

</body>
</subsection>
<subsection>
<title>Копирование информации о DNS</title>
<body>

<p>
До начала работы в новой среде осталось выполнить только одну операцию &mdash;
скопировать информацию о DNS (Domain name server) в файл
<path>/etc/resolv.conf</path>, чтобы сохранить работоспособность сети в новой
среде. В файле <path>/etc/resolv.conf</path> содержатся адреса серверов имен,
используемых в вашей сети.
</p>

<pre caption="Копирование информации о DNS">
<comment>(Параметр &quot;-L&quot; чтобы не скопировать случайно символическую ссылку)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Монтирование файловой системы /proc</title>
<body>

<p>
Смонтируйте файловую систему <path>/proc</path> в
<path>/mnt/gentoo/proc</path>, чтобы в процессе установки была доступна
информация о ядре, даже после перехода в новой корень.
</p>

<pre caption="Монтируем /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Вход в новую среду</title>
<body>

<p>
Итак, все разделы инициированы и базовая операционная среда установлена. Теперь
необходимо войти в новую инсталляционную среду с помощью <e>изменения корневого
каталога</e> (chroot). Это значит, что мы переходим из текущей инсталляционной
среды (компакт-диск или другой установочный носитель), в нашу базовую
систему.
</p>

<p>
Операция проходит в три этапа. Сначала мы изменим корневой каталог
<path>/</path> (в установочной среде) на каталог <path>/mnt/gentoo</path>(на
вашем разделе), используя <c>chroot</c>. Затем мы создадим переменные
окружающей среды, пользуясь <c>env-update</c>, и загрузим их в память, при
помощи <c>source</c>.
</p>

<pre caption="Переход в новую среду">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Поздравляем! Теперь вы в вашей собственной среде Gentoo Linux. Конечно, на
этом установка совсем не закончена, поэтому вам еще надо пройти несколько
разделов руководства. :)
</p>

</body>
</subsection>
</section>

<section>
<title>Настройка Portage</title>
<subsection>
<title>Обновление дерева Portage</title>
<body>

<p>
Теперь надо обновить дерево Portage до самой последней версии с помощью команды
<c>emerge --sync</c>:
</p>

<pre caption="Обновление Portage">
# <i>emerge --sync</i>
<comment> (Если вы используете медленный терминал, как, например, некоторые
последовательные терминалы или кадровые буферы, вы можете добавить параметр
--quiet для ускорения процесса:)</comment>
# <i>emerge --sync --quiet</i>
</pre>

<p>
Если ваш компьютер подключен к интернету через межсетевой экран, который
блокирует прохождение rsync-пакетов, вы можете воспользоваться командой
<c>emerge-webrsync</c>, которая скачивает и устанавливает копию дерева.
</p>

<p>
Если вы получили сообщение, что доступна новая версия Portage и требуется ее
обновление, можете игнорировать это сообщение. Обновление будет произведено в
процессе установки.
</p>

</body>
</subsection>
<subsection>
<title>Выбор правильного профиля</title>
<body>

<p>
Сначала небольшое пояснение.
</p>

<p>
Профиль &mdash; основа Gentoo. Он не только определяет значения по умолчанию для
CHOST, CFLAGS и других важных переменных, он также определяет диапазон
разрешенного для установки на данной системе ПО (версий ПО). Это регулируется
разработчиками Gentoo.
</p>

<p>
Раньше профиль не особо волновал пользователя. Однако, пользователи систем с
архитектурами х86, hppa и alpha имеют возможность выбора из двух вариантов
профиля, один вариант для ядер ветви 2.4, другой для ветви 2.6. Это было
сделано для улучшения интеграции ядер 2.6. Для архитектур ppc и ppc64 также
существует несколько профилей. Мы поговорим о них позже.
</p>

<p>
Вы можете узнать, какой профиль используется в системе в настоящее время,
введя команду:
</p>

<pre caption="Используемый профиль">
# <i>ls -FGg /etc/make.profile</i>
lrwxrwxrwx  1 48 Apr  8 18:51 /etc/make.profile -> ../usr/portage/profiles/default-linux/x86/2005.1/
</pre>

<p>
Если вы используете одну из трех архитектур, упомянутых ранее, профиль по
умолчанию использует систему на основе ядра 2.6. Это рекомендованные установки
по умолчанию, но за вами сохраняется право выбора другого профиля.
</p>

<p>
Некоторые пользователи, возможно, захотят установить систему, основанную на
старом профиле, ориентированном на ядро 2.4. Если у вас есть весомые основания
для этого, сначала надо проверить существует ли этот дополнительный профиль. На
системах x86 мы можем сделать это следующей командой:
</p>

<pre caption="Информация о дополнительных профилях">
# <i>ls -d /usr/portage/profiles/default-linux/x86/2005.1/2.4</i>
/usr/portage/profiles/default-linux/x86/2005.1/2.4
</pre>

<p>
Как видно из приведенного примера, дополнительный профиль 2.4 существует
(например, не было сообщений об отсутствующем файле или каталоге). Рекомендуется
использовать профиль по умолчанию, но если вы все же хотите сменить его, вы
можете проделать это, как показано ниже:
</p>

<pre caption="Переключение профиля на 2.4">
<comment>(Удостоверьтесь, что используете правильную архитектуру, этот пример для x86)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/x86/2005.1/2.4 /etc/make.profile</i>
<comment>(Список файлов профиля 2.4)</comment>
# <i>ls -FGg /etc/make.profile/</i>
total 12
-rw-r--r--  1 939 Dec 10 14:06 packages
-rw-r--r--  1 347 Dec  3  2004 parent
-rw-r--r--  1 573 Dec  3  2004 virtuals
</pre>

<p>
Для архитектуры ppc существует несколько новых профилей, появившихся в версии
2005.1.
</p>

<pre caption="Профили для PPC">
<comment>(базовый профиль PPC, подходит для всех PPC-машин)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc /etc/make.profile</i>
<comment>(профиль для G3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G3 /etc/make.profile</i>
<comment>(профиль для G3 Pegasos)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G3/Pegasos/ /etc/make.profile</i>
<comment>(профиль для G4 (Altivec))</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G4 /etc/make.profile</i>
<comment>(профиль для G4 Pegasos)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc/G4/Pegasos/ /etc/make.profile</i>
</pre>

<p>
Для архитектуры ppc64 существует несколько новых профилей, появившихся в версии
2005.1.
</p>

<pre caption="Профили для PPC64">
<comment>(базовый профиль PPC64 с 64-битной пользовательской средой, для всех PPC64-машин)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/64bit-userland /etc/make.profile</i>
<comment>(базовый профиль PPC64 с 32-битной пользовательской средой, для всех PPC64-машин)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/32bit-userland /etc/make.profile</i>
<comment>(для каждого типа пользовательской среды существует подпрофиль, как показано ниже.)</comment>
<comment>(&laquo;userland&raquo; необходимо заменять на выбранный тип среды, как в примерах выше)</comment>
<comment>(профиль 970 для JS20)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/970 /etc/make.profile</i>
<comment>(профиль для G5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/970/pmac /etc/make.profile</i>
<comment>(профиль для POWER3)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power3 /etc/make.profile</i>
<comment>(профиль для POWER4)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power4 /etc/make.profile</i>
<comment>(профиль для POWER5)</comment>
# <i>ln -snf /usr/portage/profiles/default-linux/ppc/2005.1/ppc64/(userland)/power5 /etc/make.profile</i>
<comment>(профили с одновременной поддержкой разной пользовательской среды в этом выпуске нестабильны)</comment>
</pre>

</body>
</subsection>
<subsection id="configure_USE">
<title>Конфигурация переменной USE</title>
<body>

<p>
<c>USE</c> &mdash; одна из самых мощных переменных Gentoo. Она позволяет 
собирать программы с необходимыми вам параметрами. Например, некоторые 
программы собираются с поддержкой gtk или qt. Одни могут быть собраны с 
поддержкой SSL, а другие с поддержкой кадрового буфера (svgalib) вместо X11 
(X-сервер).
</p>

<p>
В большинстве дистрибутивов пакеты собраны с максимальным количеством
возможностей, тем самым увеличивая размер программ и время запуска, не говоря
уже о зависимостях. В Gentoo вы сами можете выбрать необходимые возможности
программы, включая или выключая их в переменной <c>USE</c>.
</p>

<p>
В переменной <c>USE</c> вы определяете параметры с которыми необходимо
компилировать программу. Например, указав параметр <e>ssl</e>, вы будете
собирать все программы, поддерживающие его, с ssl-поддержкой. Параметр
<e>-X</e> выключит поддержку X-сервера во всех собираемых программах (для
выключения используется знак &laquo;минус&raquo; перед названием параметра).
Параметры <e>gnome gtk -kde -qt</e> соберут ваши программы с поддержкой Gnome
и gtk, но без поддержки KDE и qt.
</p>

<p>
Настройки <c>USE</c> по умолчанию хранятся в файле <path>make.defaults</path>
вашего профиля. Вы можете найти файл <path>make.defaults</path> в каталоге, на
который указывает <path>/etc/make.profile</path> а также во всех родительких
каталогах. Настройки <c>USE</c> по умолчанию &mdash; это сумма всех настроек
этой переменной во всех <path>make.defaults</path> файлах. Все, что вы вносите в
<path>/etc/make.conf</path> считается относительно этих настроек. Если добавили
что-то к настройкам <c>USE</c> это добавляется к списку по умолчанию. Если же
удалили, поставив перед параметром знак минус, то это удаляется из списка по
умолчанию (если это что-то там вообще было). <e>Никогда</e> не меняйте настройки
в <path>/etc/make.profile</path>. Они будут переписаны при обновлении Portage!
</p>

<p>
Полное описание переменной <c>USE</c>, вы можете найти во второй части
руководства Gentoo в главе <uri link="?part=2&amp;chap=2">Значения
переменной USE</uri>. Полное описание всех доступных значений переменной USE,
вы найдете в файле <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Просмотр доступных значений переменной USE">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Прокручивать можно используя кнопки вниз/вверх. Для выхода нажмите "q")</comment>
</pre>

<p>
В качестве примера мы покажем вам установки переменной <c>USE</c>, для системы,
базирующейся на KDE, включая DVD, ALSA и записывающий CD.
</p>

<pre caption="Открытие файла /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Установка значений переменной USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Дополнительно: локали GLIBC</title>
<body>

<p>
Скорее всего вы будете использовать одну или две локали в системе. Если же
сейчас ничего не трогать, то при установке <c>glibc</c> будут созданы все
возможные локали. Однако, вы можете включить USE-флаг <c>userlocales</c> и
прописать нужные локали в <path>/etc/locales.build</path>. Делайте это только в
том случае, если знаете, какие локали вам понадобятся.
</p>

<pre caption="Включаем USE флаг userlocales специально для glibc">
# <i>mkdir -p /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Теперь укажем нужные нам локали:
</p>

<pre caption="Открываем /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Вот пример для английского (США) и немецкого с соответствующими кодировками
(например UTF-8).
</p>
<!-- Надо изменить для русской локали. Мы же из России, верно? :) -->
<!-- Например, убрать немецкие локали и добавить ru_RU.UTF-8/UTF-8. editor -->
<pre caption="Указываем локали">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

<p>
Теперь перейдем к следующему разделу: <uri
link="?part=1&amp;chap=7">Конфигурирование ядра</uri>.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 2.12-r1
target-date: 2005-11-17
source-cvs-revision: 1.85
translated-by: Vasiliy Golubev [vas@nightmail.ru]
edited-by:  Azamat H. Hackimov [azazello1984@mail.ru]; 
notes:
2.9 to 2.12 inclusions checked by achumakov
(**) see comment above about userlocales
-->
