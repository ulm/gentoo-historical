<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<!-- REV: 1.69 -->
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-system.xml,v 1.1 2005/03/03 16:35:14 sergey Exp $ -->
<sections>

<version>1.64</version>
<date>2005-01-04</date>

<section>
<title>Смена корня</title>
<subsection>
<title>Опция: выбор зеркала</title>
<body>

<p>
Если вы загрузились, используя Gentoo LiveCD, то можете воспользоваться
<c>mirrorselect</c> для обновления файла <path>/etc/make.conf</path>. Это
позволит вам использовать быстрые сервера как для обновления Portage,
так и для обновления исходников (конечно если у вас работает подключение к интернет):
</p>

<pre caption="Выбор быстрого зеркала">
# <i>mirrorselect -a -s4 -o |grep 'GENTOO_MIRRORS=' &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Если <c>mirrorselect</c> даст сбой, не стоит паниковать, значения по умолчанию 
полностью работоспособны.
</p>

</body>
</subsection>
<subsection>
<title>Копирование информации DNS</title>
<body>

<p>
Перед тем как начать работу в новой среде, вы должны скопировать информацию о 
DNS (Domain name server) в файл <path>/etc/resolv.conf</path>, что бы сохранить
работоспособность сети. В файле <path>/etc/resolv.conf</path> прописан
nameserver (сервер имен), используемый в вашей сети.
</p>

<pre caption="Копирование информации о DNS">
<comment>(Опция "-L" чтобы не скопировать случайно символьную ссылку)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Монтирование /proc файловой системы</title>
<body>

<p>
	Смонтируйте <path>/proc</path> файловую систему в <path>/mnt/gentoo/proc</path>,
	чтобы в процессе установке была доступна информация о ядре даже после
	перехода в новой корень.
</p>

<pre caption="Монтируем /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Вход в новую среду</title>
<body>

<p>
Итак, все разделы инициированы и базовая операционная среда установлена.
Теперь необходимо войти в новую инсталяционную среду с помощью
<e>изменения корневого каталога</e> (chroot). Это значит, что мы переходим из
текущей инсталляционной среде (LiveCD или другой инсталляционный 
носитель), в нашу базовую систему.
</p>

<p>
	Операция проходит в три этапа.
	Сначала мы изменим корневой каталог <path>/</path> (в инсталляционной среде) на
	каталог <path>/mnt/gentoo</path>(на вашем разделе), используя <c> chroot </c>.
	Затем мы создадим переменные окружающей среды, пользуясь <c>env-update</c>,
	и загрузим их в память, при помощи <c>source</c>.
</p>

<pre caption="Переход в новую среду">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Поздравляем! вы - теперь в вашей собственной среде Gentoo Linux.
Конечно на этом установка совсем не закончена, вам еще надо пройти через
несколько разделов руководства.
</p>

</body>
</subsection>
<subsection>
<title>Обновление дерева Portage</title>
<body>

<p>
	Теперь надо обновить дерево Portage до самой свежей версии с помощью
	команды <c>emerge --sync</c>:
</p>

<pre caption="Обновление Portage">
# <i>emerge sync</i>
</pre>

<p>
Если вы получили сообщение, что доступна новая версия Portage и требуется 
ее обновление, можете игнорировать это сообщение. Обновление будет 
произведено в процессе установки.
</p>

</body>
</subsection>
<subsection id="configure_USE">
<title>Конфигурация переменной USE</title>
<body>

<p>
<c>USE</c> - одна из самых мощных переменных Gentoo. Она позволяет
собирать программы с необходимыми вам параметрами. Например, некоторые программы 
собираются с поддержкой gtk или qt. Одни могут быть собраны
с поддержкой SSL, а другие с поддержкой framebuffer вместо X11 (X-сервер).
</p>

<p>
В большинстве дистрибутивов пакеты собраны с максимальным количеством
опций, тем самым увеличивая размер программ и время запуска, не говоря 
уже о зависимостях. В Gentoo вы сами можете выбрать необходимые опции, 
включая или выключая их в переменной <c>USE</c>.
</p>

<p>
В переменной <c>USE</c> вы определяете опции с которыми необходимо компилировать
программу. Например указав опцию <e>ssl</e>, вы будете собирать все программы,
поддерживающие эту опцию, с ssl-поддержкой. Опция <e>-X</e> выключит поддержку
X-сервера во всех собираемых программах(для выключения используется знак минус
перед названием опции). Опции <e>gnome gtk -kde -qt</e> соберут ваши программы
с поддержкой Gnome и gtk, но без поддержки KDE и qt.
</p>

<p>
Дефолтовые настройки <c>USE</c> хранятся в файле <path>make.defaults</path>
вашего профиля. Вы можете найти файле <path>make.defaults</path> в папке, на
которую указывает <path>/etc/make.profile</path> а также во всех родительких
директориях. Дефолтовые настройки <c>USE</c> это сумма всех настроек этой
переменной во всех <path>make.defaults</path> файлах. Все, что вы вносите в
<path>/etc/make.conf</path> считается относительно этих настроек. Если добавили
что-то к настройкам <c>USE</c> это добавляется к дефолтовому списку. Если же
удалили, поставив перед ключом знак минус), то это удаляется из дефолтового
списка (если это что-то там вообще было). <e>Никогда</e> не меняйте настройки в
<path>/etc/make.profile</path>. Они будут переписаны при обновлении Portage!
</p>

<p>
Полное описание переменной <c>USE</c>, вы можете найти во второй части 
руководства Gentoo <uri link="?part=2&amp;chap=2">USE flags</uri>.
Полное описание всех доступных опций переменной USE, вы найдете в файле 
<path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Просмотр доступных опций переменной USE">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Прокручивать можно используя кнопки вниз/вверх. Для выхода, нажмите 'q')</comment>
</pre>

<p>
В качестве примера, мы покажем вам установки переменной <c>USE</c>, для 
системы базирующейся на KDE, включая DVD, ALSA и записывающий CD.  
</p>

<pre caption="Открытие /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Установки USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>По выбору: Локали GLIBC</title>
<body>

	<p>
		Скорее всего вы будете использовать одну или две локали в системе. Если
		же сейчас ничего не трогать, то при установке <c>glibc</c> будут созданы
		все возможные локали. Однако, вы можете включить USE флаг
		<c>userlocales</c> и прописать нужные локали в
		<path>/etc/locales.build</path>. Делайте то только в том случае, если
		знаете, какие локали вам понадобятся.
</p>

<pre caption="Включаем USE флаг userlocales специально для glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
	Теперь укажем нужные нам локали:
</p>

<pre caption="Открываем /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
	Вот пример для английского (США) и немецкого с соответствующими кодировками
	(например UTF-8).
</p>

<pre caption="Указываем локали">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

</body>
</subsection>

</section>
<section>
<title>Различия между Stage1, Stage2 и Stage3</title>
<body>

<p>
Теперь вспомните ваши предыдущие действия. Мы просили вас выбрать
<e>stage1</e>, <e>stage2</e> или <e>stage3</e> и предупреждали о 
важности этого выбора. Итак, это первое место где вы делаете выбор,
определяющий ваши дальнейшие шаги.
</p>

<ul>
<li>
  Если вы выбрали <e>stage1</e>, вы должны пройти через оба этапа в этой главе
  (начиная с <uri link="#doc_chap3">Продолжение от Stage1 до Stage2</uri>).
</li>
<li>
  Если вы выбрали <e>stage2</e>, вы должны пропустить первый шаг и сразу 
  перейти ко второму (<uri link="#doc_chap4">Продолжение от  Stage2 до 
  Stage3</uri>)
</li>
<li>
  Если вы выбрали <e>stage3</e>, вы должны пропустить
  оба и перейти к разделу продолжить с <uri link="?part=1&amp;chap=7">Конфигурация 
  ядра</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Продолжение от Stage1 до Stage2</title>
<subsection>
<title>Инициализация системы (bootstrapping)</title>
<body>

<p>
Итак, вы хотите скомпилировать систему с самого начала? Хорошо :)
</p>

<p>
На этом этапе мы будем создавать базу вашей системы Gentoo. 
Это займет много времени, но в результате вы получите систему,
оптимизированную под вашу машину и задачи.
</p>

<p>
<e>Bootstrapping (инизиализация)</e> означает создание библиотеки
GNU C, Компилятора GNU Compiler Collection (GCC) и других системных 
программ. 
</p>

<p>
Перед началом компиляции вашей базовой системы, вы, возможно, захотите скачать
все исходники. Если вам это не нужно,переходите к к разделу 
<uri link="#bottstrap">Инициализация системы</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Дополнительно: сначала загрузим исходники</title>
<body>

<p>
Если вы еще не скопировали исходники, bootstrap скрипт загрузит все
необходимые файлы. Если вы хотите сначала загрузить исходный код и после этого
запустить начальную загрузку системы (например, вы не хотите
иметь подключенный интернет во время компиляции), используйте опцию
<e>-f </e> bootstrap-скрипта.
</p>

<pre caption="Загрузка необходимых исходников">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Инициализация системы</title>
<body>

<p>
Для запуска компиляции начальной загрузки, наберите следующие
команды, и можете заняться чем нибудь еще, так как этот шаг
займет некоторое время.
</p>

<pre caption="Инициализация системы">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
	Если вы установили USE флаг <c>nptl</c> перезапуск <c>bootstrap.sh</c> может
	оборваться с ошибкой, что <c>linux-headers</c> блокирует
	<c>linux26-headers</c>. Если вы получили такое сообщение, удалите
	<c>linux-headers</c> и попробуйте еще раз:
</p>

<pre caption="Убираем linux-headers из системы">
# <i>emerge -C linux-headers</i>
# <i>emerge --oneshot --nodeps linux26-headers</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Теперь продолжим со следующего шага, <uri link="#doc_chap4">Продолжение от
Stage2 до Stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Продолжение от Stage2 до Stage3</title>
<subsection>
<title>Введение</title>
<body>

<p>
Если вы читаете эту секцию, значит или вы уже завершили инициализацию системы 
или используете <e>stage2</e>.
А это значит, что пришло время компилировать все пакеты системы. 
</p>

<p>
<e>Все </e> пакеты системы? Нет, не так. В этом шаге, вы будете компилировать
пакеты, без которых система не будет работать. Некоторые пакеты системы 
имеют несколько альтернатив (например, пакеты отвечающие за log-файлы системы),
а так как основной идеей Gentoo является свобода выбора мы не будем выбирать его
вместо вас.
</p>

</body>
</subsection>
<subsection>
<title>Дополнительно: Что же мы будем ставить?</title>
<body>

<p>
Если вы хотите знать, какие пакеты будут установлены, выполните <c>emerge
--pretend system</c>. Эта комманда выведет список всех пакетов, которые будут
собраны. Т.к. список достаточно длинный, используйте <c>less</c> или <c>more</c>, для
постраничного вывода списка.
</p>

<pre caption="Просмотр пакетов, предназначенных для установки">
# <i>emerge --pretend system | less</i>
</pre>

</body>
</subsection>
<subsection>
<title>Дополнительно: Загрузка исходников</title>
<body>

<p>
Если вы хотите использовать <c>emerge</c> для получения исходников
до начала компиляции (например, вы не хотите иметь связь с интернетом во
время компиляции пакетов), вы можете использовать опцию <e>--fetchonly</e>,
которая загрузит все исходники.
</p>

<pre caption="загрузка исходников">
# <i>emerge --fetchonly system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Компиляция системы</title>
<body>

<p>
Для начала компиляции системы наберите <c>emerge system</c> и можете
спокойно заниматься своими делами, так как выполнение этого шага занимает 
довольно много времени. 
</p>

<pre caption="Компиляция системы">
# <i>emerge system</i>
</pre>

<p>
	Сейчас вы можете спокой игнорировать все сообщения об обновленных
	конфигурационных файлах (и запуске <c>etc-update</c>). Когда вы полностью
	установите системы и загрузитесь в нее, не забудьте однако прочитать раздел <uri
link="?part=3&amp;chap=2#doc_chap3">Защита конфигурационных файлов</uri>.
</p>

<p>
Когда компиляция закончится можете переходить к следующему разделу - <uri
link="?part=1&amp;chap=7">Конфигурация ядра</uri>.
</p>

</body>
</subsection>
</section>

</sections>
