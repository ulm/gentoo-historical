<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<!-- REV: 1.46 -->
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-working-portage.xml,v 1.1 2005/02/26 14:05:20 sergey Exp $ -->

<sections>

<version>1.42</version>
<date>2004-10-24</date>

<section>
<title>Добро пожаловать в мир Portage</title>
<body>

<p>
Portage является пожауй самым значимым нововведением Gentoo в систему правления
пакетами. Будучи крайне гибким и имея огромное количество возможностей, он часто
рассматривается как лучий иснтрумент для управления программами в Linux.
</p>

<p>
Portage полностью написан на <uri link="http://www.python.org">Python</uri>
и <uri link="http://www.gnu.org/software/bash">Bash</uri> и значит полностью
видим для пользователя, так как оба языка являются скриптовыми.
</p>

<p>
Большинство пользователей работает с Portage с помощью утилиты <c>emerge</c>.
Мы не собираемся повторять в этой главе информацию из страниц руководства (man
emerge). Для полного описания опций emerge, пожалуй воспользуйтес коммандой:
</p>

<pre caption="Получение помощи для emerge">
$ <i>man emerge</i>
</pre>

</body>
</section>
<section>
<title>Дерево Portage</title>
<subsection>
<title>Ebuild'ы</title>
<body>
<p>
Когда мы говорим о пакетах, мы обычно имеем в виду элементы, доступные
пользователям Gentoo через дерево Portage. Это дерево представляет собой
коллекцию <e>ebuild'ов</e> - файлов с с информацией, необходимой Portage для
работы с программой (установка, поиск, сбор информации, ...). Эти ebuild'ы по
умолчанию находятся в <path>/usr/portage</path>.
</p>

<p>
Когда вы просите Portage произвести некое действие с программой, он использует
ebuild в вашей системы ка отправную точку. Очень важно регулярно обновлять
ebuild'ы, чтобы Portge знал о новых программах, обновлениях безпосности и т.д.
</p>

</body>
</subsection>

<subsection>
<title>Обновление дерева Portage</title>
<body>

<p>
Portage обычно обновляется через<uri
link="http://rsync.gentoo.org">rsync</uri> - быстрой системы инкрементальной
загрузки файлов. Процесс обновления крайне прост, т.к. <c>emerge</c>
преодставляет удобный интерфей с rsync.
</p>

<pre caption="Обновление дерева Portage">
# <i>emerge --sync</i>
</pre>

<p>
Если вы не можете использовать rsync изза ограничений firewall'а, вы можете
воспользоваться еьедневно генерируемым снимком дерева. Утилита
<c>emerge-webrsync</c> автоматически загрузит и установит в вашей системе самый
свежий снимок:
</p>

<pre caption="Запуск emerge-webrsync">
# <i>emerge-webrsync</i>
</pre>

</body>
</subsection>
</section>

<section>
	<title>Поддержка програмного обеспечения</title>

<subsection>
<title>Поиск программного обеспечения</title>
<body>

	<p>
		Чтобы найти нужную вам программу вы можете воспользоваться встроенной в
		<c>emerge</c> функсией поиска. По умолчанию <c>emerge search</c>
		возвращает имена пакетов, которые полностью или частично совпали с
		условием поиска.
</p>

<p>
	Например, чтобы найти все пакеты, у которых в имени есть "pdf":
</p>

<pre caption="Ишем пакеты с pdf в названии">
$ <i>emerge search pdf</i>
</pre>

<p>
	Если вы хотите также искать в описании, можете воспользоваться опцией
	<c>--searchdesc</c> (или <c>-S</c>):
</p>

<pre caption="Ищем все пакеты отноцящиеся с pdf">
$ <i>emerge --searchdesc pdf</i>
</pre>

<p>
	В результатах поиска содержится много полезной информации. Т.к. названия
	полей говорят сами за себя, мы не будем их подробно расписывать.
</p>

<pre caption="Пример вывода emerge search">
*  net-print/cups-pdf
      Latest version available: 1.5.2
      Latest version installed: [ Not Installed ]
      Size of downloaded files: 15 kB
      Homepage:    http://cip.physik.uni-wuerzburg.de/~vrbehr/cups-pdf/
      Description: Provides a virtual printer for CUPS to produce PDF files.
      License:     GPL-2
</pre>

</body>
</subsection>


<subsection>
<title>Установка програмного обеспечения из исходных кодов.</title>
<body>

<p>
	Теперь, когда вы нашли нужный вам пакет, вы можете установить его с помощью
	<c>emerge</c> - просто добавьте его название в конце. Например, если вы
	хотите установить <c>gnumeric</c>:
</p>

<pre caption="Установка gnumeric">
# <i>emerge gnumeric</i>
</pre>

<p>
	Т.к. многие программы зависят друг от друга, попытка установить один
	программный пакет может привести к установке нескольких зависимостей. Не
	волнуйтес, Portage с этим разберется сам. Если вы хотите узнать что именно
	Portage <c>собирается</c> поставить, когда вы просите установить тот или
	иной пакет, воспользуйтесь опцией <c>--pretend</c>:
</p>

<pre caption="Проверка зависимостей для  gnumeric">
# <i>emerge --pretend gnumeric</i>
</pre>

<p>
	Когда вы просите Portage то установить программный пакет, он загрузит если
	нужны исходные коды (исходники) из интернета и сохранит их по умолчанию в 
	<path>/usr/portage/distfiles</path>. Потом он их распакует, скомпилирует и
	установит программу/ Если вы хотите, чтобы Portage только скачал нужные
	файлы, ничего не устанавливая, добавьте к комманде <c>emerge</c> опцию
	<c>--fetchonly</c>.
</p>

<pre caption="Загрузка исходников для gnumeric">
# <i>emerge --fetchonly gnumeric</i>
</pre>

</body>
</subsection>

<subsection>
<title>Удаление пакетов</title>
<body>

	<p>
		Если вы хотите удалить пакет из системы, воспользуйтес коммандой
		<c>emerge unmerge</c>. Таким образом вы удалите все файлы, которые были
		скопированы в ходе установки пакета, кроме конфигурационных файлов,
		измененных уже после установки. Эта функция позволит вам снова работать
		с программой если вы вдруг захотите поставить ее вновь.
</p>

<p>
	<brite>Остроржно!</brite> Portage <e>НЕ</e> проверяет, требуется ли пкет,
	который вы хтите удалить каким либо другим программам. Он лишь предупредит
	вас если вы попробуете удалить пакет необходимый для функционированния
	системы. </p>

<pre caption="Удаляем gnumeric">
# <i>emerge unmerge gnumeric</i>
</pre>

<p>
	Когда вы удаляете пакет, автоматически установленные зависимости остаются.
	Используйте функцию <c>depclean</c> у <c>emerge</c> чтобы найти и удалить
	все зависимости, которые больше не нужны. Однако, мы поговорим об этом чуть
	позже.
</p>

</body>
</subsection>

<subsection>
<title>Обновление системы</title>
<body>

	<p>
		Чтобы поддерживать систему на дольном уровне (я уж молчу про обновления
		касающиеся безопаности) ее надо регулярно обновлять. Т.к. Portage
		использует только те ebuild'ы, которые есть в вашем дереве, вам надо
		сначала обновить дерево Portage. После этого можете приступать к
		обновлению системы коммандой <c>emerge --update world</c>:
</p>

<pre caption="Обновление системы">
# <i>emerge --update world</i>
</pre>

<p>
	Portage попробует найти более свежие версии установленных программ. Однкао,
	он будет проверять версии только тех програм, которые сами просили
	установить. Зависимости обновляться не будут. Если вы хотите обновить все
	пакеты в системе, используйте опцию <c>--deep</c>:
</p>

<pre caption="Обновление всей системы">
# <i>emerge --update --deep world</i>
</pre>

<p>
Если вы недавно сменили свои <uri link="?part=2&amp;chap=2">USE флаги</uri>,
возможно вы захотите также добавить опцию <c>--newuse</c>, тогда Portage
проверит, требует ли изменение флагов установки новых пакетов или пересборки
усановленных.
</p>

<pre caption="Полнов обновление">
# <i>emerge --update --deep --newuse world</i>
</pre>

</body>
</subsection>
<subsection>
<title>Псевдо пакеты</title>
<body>

	<p>
		Некоторые пакеты в портежах не имеют как такого наполнения и служат
		только для установки целого набора других пакетов. Одинм из примеров
		является пакет <c>kde</c>, который устанавливает в системе полную среду
		KDE со всеми компонентами и зависимостями.
</p>

<p>
	Если вы удалите такой пакет командой <c>emerge unmerge</c>, болошого проку
	от этого не будет, т.к. все зависимости все равно останутся в системе.
</p>

<p>
	В Portage есть функция для удаления ненужных зависимостей. Но т.к.
	зависимости могут динамически меняться, сначала надо обновить всю систему,
	включая изменения, которые могло повлечь редактирование USE флагов. После
	этого можно запустить <c>emerge depclean</c> и удалить зависимости, которые
	больше не нужны. Затем нужно пересобрать программы, которые были динамически
	линкованы с ныне удаленным библиотеками.
</p>

<p>
	Всего этого можно добиться с помощью следующих комманд:
</p>

<pre caption="Удаление ненужных зависимостей">
# <i>emerge --update --deep --newuse world</i>
# <i>emerge depclean</i>
# <i>revdep-rebuild</i>
</pre>

<p>
<c>revdep-rebuild</c> идет в пакете <c>gentoolkit</c>, так что не забудтье
поставить его сначала:
</p>

<pre caption="Ставим gentoolkit">
# <i>emerge gentoolkit</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Если Portage возмущается...</title>
<subsection>
	<title>О слотах (SLOT), виртуалных пакетах, ветвях, архитектурах и профилях</title>
<body>

	<p>
		Мы уже говорили, что Portage - это очень мощная система, с большим
		количеством функций, многие из которых отсутствуют в гругих системах
		контроля пакетов. Сейчас мы опишем некоторые аспекты Portage, не
		углубляясь, однако, в детали.
</p>

<p>
	Portage позволяет разным версиям пакетов сосуществовать в системе. В то
	время как в других дистрибутивах обычно меняется имя пакета (например 
	<c>freetype</c> и <c>freetype2</c>) Portage использует технолотию слотов
	(<e>SLOT</e>). В ebuild'е определяется слот для данной версии. Ebuild'ы с
	разными слотами могут сосуществовать. Например для пакета
	<c>freetype</c> есть ebuild'ы со <c>SLOT="1"</c> и <c>SLOT="2"</c>.
</p>

<p>
	Кроме того существуют пакеты, которые предоставляют одни и теже фунцкии, хотя
	и реализованы по разному. Пример может служить <c>metalogd</c>, <c>sysklogd</c> 
	и <c>syslog-ng</c>. Все это программы для записи лог файлов. Программы,
	которым нужен "системный журнал" не зависеть только от <c>metalog</c>, т.к.
	другие альтернативы ничем не хуже. Для таких случаев Portage предоставляет
	так называемые <c>виртуальные</c> пакеты. Кажый системный журнал
	предоставляет <c>virtual/syslog</c>, от которого другие программы и будут
	зависеть.
</p>

<p>
	Программное обеспечение в дереве Portage может относится к разным веткам. По
	умолчанию, система принимает только те пакеты, которые Gentoo считает
	стабильными. Самые свежие программы добавляются сначала в тестовую ветку,
	это значит что их нужно протестировать прежде чем пометить ка стабильные.
	Хотя вы будете видеть ebuild'ы для них в дереве, Portage не будет их
	ставить, пока они не будут перенесены в стабильную ветку.
</p>

<p>
	Иногда программы доступны только для некоторых архитектур. Это может быть
	связано с тем, что программа не работает на других архитектурах или же
	требует большего тестирования. Другой причиной может быть, что разработчик
	добвлявший пакет в дерево Portage не имел возможности протестировать его на
	разных архитектурах.
</p>

<p>
	Каждая установка Gentoo следует определенному <c>профилю</c> (profile),
	который помимо прочего содержит список пакетов, необходимых для нормального
	функционирования системы.
</p>

</body>
</subsection>
<subsection id="blocked">
<title>Блокированные пакеты</title>
<body>

<pre caption="Предупреждение Portage о блокированных пакетах (с опцией --pretend)">
[blocks B     ] gnome-base/bonobo-activation (from pkg gnome-base/libbonobo-2.4.0)
</pre>

<pre caption="Предупреждение Portage о блокированных пакетах (с опцией --pretend)">
!!! Error: the gnome-base/bonobo-activation package conflicts with another package.
!!!        both can't be installed on the same system together.
!!!        Please use 'emerge --pretend' to determine blockers. 
</pre>

<p>
	В ebuild'е есть специальные поля, содержащие информацию для Portage о
	зависимостях пакета. Есть два вида зависимостей: времени сброки,
	они объявлены в <c>DEPEND</c>, и времени запуска (run-time) в
	<c>RDEPEND</c>. Если в одном из полей пакет (реальный или виртуальный)
	помечен как <c>несовместимый</c> - это приводит к блокировке.
</p>

<p>
	Чтобы решить эту проблему или не устанавливайте пакет или удалите сначала
	пакет вызвавший блокировку. В нашем примере выжете или отказаться от
	установки <c>libbonobo</c> или удалить сначала <c>bonobo-activation</c>.
</p>

</body>
</subsection>
<subsection id="masked">
	<title>Замаскированые пакеты</title>
<body>

<pre caption="Предупреждение Portage о замаскированных пакетах">
!!! all ebuilds that could satisfy "bootsplash" have been masked. 
</pre>

<pre caption="Предупреждение Portage о замаскированных пакетах - причина">
!!! possible candidates are:

- gnome-base/gnome-2.8.0_pre1 (masked by: <i>~x86 keyword</i>)
- lm-sensors/lm-sensors-2.8.7 (masked by: <i>-sparc keyword</i>)
- sys-libs/glibc-2.3.4.20040808 (masked by: <i>-* keyword</i>)
- dev-util/cvsd-1.0.2 (masked by: <i>missing keyword</i>)
- media-video/ati-gatos-4.3.0 (masked by: <i>package.mask</i>)
- sys-libs/glibc-2.3.2-r11 (masked by: <i>profile</i>)
</pre>

<p>
	Если вы попытаетесь поставить пакет, который не доступен для вашей
	архитектуры, то получите предупреждение о маскировке. Вам придется или
	поставить другой пакет, доступный для вашей системы, или подождать пока
	пакет не будет размаскирован. Пакеты всегда маскируются по определенной
	причине:
</p>

<ul>
  <li>
	  <b>~arch keyword</b> означает, что пакет прошел достаточного тестирования,
	  чтобы оказаться в стабильной ветке. Подождите несколько дней или недель и
	  попробуйте снова.
  </li>
  <li>
	  <b>-arch keyword</b> или <b>-* keyword</b> означает, что программа не
	  работает на вашей архитектуре. Если вы считаете, что она все же работает,
	  отправьте нам отчет об ошибке использую вебсайт 
	  <uri link="http://bugs.gentoo.org">bugzilla</uri>.
  </li>
  <li>
	  <b>missing keyword</b> означает, что работоспообность программы на вашей
	  архитектуре не проверялась. Попросите команду по портированию
	  протестироватьпакет или же протестируйте его сами и сообщте о результатах
	  на сайте <uri link="http://bugs.gentoo.org">bugzilla</uri>.
  </li>
  <li>
	  <b>package.mask</b> - этот пакет сломан или очень нестабилен и его
	  специально запретили к использованию.
  </li>
  <li>
	  <b>profile</b> - пакет не подходит для вашего профиля. Он или поломает
	  вашу систему или просто несовместим с профилем.
  </li>
</ul>

</body>
</subsection>
<subsection id="missingdependencies">
<title>Отсутствующие зависимости</title>
<body>

<pre caption="Предупреждение Portage об отсутствующий зависимостях">
emerge: there are no ebuilds to satisfy "&gt;=sys-devel/gcc-4.2-r4".

!!! Problem with ebuild sys-devel/gcc-3.4.2-r2
!!! Possibly a DEPEND/*DEPEND problem. 
</pre>

<p>
	Пакет, который вы пытаетесь установить зависит от других пакетов,
	недоступных для вашей системы. Проверь сайт 
	<uri link="http://bugs.gentoo.org">bugzilla</uri>, и если отчета об этом еще
	нет - напишите его. Если только вы не смешиваете разные ветви, такого не
	должно происходить, и значит это ошибка.
</p>

</body>
</subsection>
<subsection id="ambiguousebuild">
<title>Неоднозначное название ebuild'а</title>
<body>

<pre caption="Предупреждение Portage, что имя ebuild'а неоднозначно">
!!! The short ebuild name "aterm" is ambiguous.  Please specify
!!! one of the following fully-qualified ebuild names instead:

    dev-libs/aterm
    x11-terms/aterm
</pre>

<p>
	Название программы, которую вы хотите поставить соответствует более чем
	одному пакету. Вы должны указать не только имя пакета, но и категорию.
	Portage сообщит вам о возможных вариантах.
</p>

</body>
</subsection>
<subsection id="circulardependencies">
<title>Круговые зависимости</title>
<body>

<pre caption="Предупреждение Portage о круговых зависимостях">
!!! Error: circular dependencies: 

ebuild / net-print/cups-1.1.15-r2 depends on ebuild / app-text/ghostscript-7.05.3-r1
ebuild / app-text/ghostscript-7.05.3-r1 depends on ebuild / net-print/cups-1.1.15-r2 
</pre>

<p>
	Два или более пакета пакета из тех что вы хотите поставить зависят друг от
	друга и, следовательно, не могут быть установлены. Скорее всего это ошибка в
	дереве Portage. Синхронизируйте дерево еще раз и повторите попытку. Так же
	можете проверить <uri link="http://bugs.gentoo.org">bugzilla</uri>, на
	предмет соответствующего отчета об ошибке.
</p>

</body>
</subsection>
<subsection id="fetchfailed">
<title>Ошибка загрузки</title>
<body>

<pre caption="Предупреждение Portage об ошибке при загрузке">
!!! Fetch failed for sys-libs/ncurses-5.4-r5, continuing...
<comment>(...)</comment>
!!! Some fetch errors were encountered.  Please see above for details.
</pre>

<p>
	Portage не смог загрузит некоторые исходники и попробует (если возжможно)
	установить пока остальные программы. Такая ситуация может возникнуть изза
	ошибки в синхронизации зеркал или если в ebuild'е указан неверный адрес
	файла. Возможно также, что сервер с исхидниками временно не функционирует.
</p>

<p>
	Попробуйте повторить операцию через час.
</p>

</body>
</subsection>
<subsection id="profileprotect">
<title>Защита системного профиля</title>
<body>

<pre caption="Portage предупреждает о пакете, защищенном профилем">
!!! Trying to unmerge package(s) in system profile. 'sys-apps/portage'
!!! This could be damaging to your system.
</pre>

<p>
	Вы попытались удалить пакет, входящий в базовую часть системы. Он указан в
	вашем профиле как необходимый и, следовательно, не может быть удален.
</p>

</body>
</subsection>
</section>
</sections>

