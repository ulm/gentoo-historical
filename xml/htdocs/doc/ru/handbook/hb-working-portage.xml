<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-working-portage.xml,v 1.3 2005/11/27 17:35:35 achumakov Exp $ -->

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<sections>

<version>1.51</version>
<date>2005-06-30</date>

<section>
<title>Добро пожаловать в Portage</title>
<body>

<p>
Система Portage &mdash; вероятно, самое известное нововведение Gentoo в 
управлении программным обеспечением. Благодаря высокой гибкости и чрезмерно 
богатым возможностям, она зачастую считается лучшим средством управления 
программным обеспечением, существующим в Linux.
</p>

<p>
Portage полностью написана на языках сценариев <uri
link="http://www.python.org">Python</uri> и <uri
link="http://www.gnu.org/software/bash">Bash</uri>, и, следовательно, полностью 
прозрачна для пользователей, поскольку оба &mdash; языки сценариев.
</p>

<p>
Большинство пользователей работает с Portage посредством команды <c>emerge</c>. 
Эта глава не предназначена для замены страницы справки emerge. Для просмотра всех 
параметров команды emerge, обратитесь к странице справки:
</p>

<pre caption="Чтение страницы справки emerge">
$ <i>man emerge</i>
</pre>

</body>
</section>

<section>
<title>Дерево портежей</title>
<subsection>
<title>Сборочные файлы ebuild</title>
<body>

<p>
Говоря о пакетах, мы часто имеем в виду программы, доступные пользователям
Gentoo через дерево портежей. Дерево портежей &mdash; это набор 
<e>сборочных файлов ebuild</e>, содержащих всю информацию, необходимую Portage 
для управления программным обеспечением (установки, поиска, запроса и т.п.)
По умолчанию сборочные файлы находятся в <path>/usr/portage</path>.
</p>

<p>
Каждый раз, когда вы просите Portage выполнить какое-то действие над 
программами, оно основывается на сборочных файлах, имеющихся в системе. Поэтому 
очень важно регулярно обновлять их, чтобы Portage узнавала о новых программах,
обновлениях для систем безопасности и т.д.
</p>

</body>
</subsection>
<subsection>
<title>Обновление дерева портежей</title>
<body>

<p>
Дерево портежей обычно обновляется с помощью <uri 
link="http://rsync.samba.org/">rsync</uri>, средства быстрой разностной 
передачи файлов. Обновление происходит довольно просто, так как команда 
<c>emerge</c> обеспечивает запуск этой утилиты:
</p>

<pre caption="Обновление дерева портежей">
# <i>emerge --sync</i>
</pre>

<p>
Если невозможно выполнить rsync из-за ограничений межсетевого экрана, дерево 
портежей все еще можно обновить с использованием ежедневных 
&laquo;снимков&raquo; дерева Portage. Утилита <c>emerge-webrsync</c> 
автоматически извлекает и устанавливает в вашей системе последний снимок:
</p>

<pre caption="Запуск emerge-webrsync">
# <i>emerge-webrsync</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Поддержка программного обеспечения</title>
<subsection>
<title>Поиск программ</title>
<body>

<p>
Для поиска программ в дереве портежей по названию можно использовать встроенные 
возможности поиска команды <c>emerge</c>. По умолчанию команда <c>emerge 
--search</c> выдает названия пакетов, соответствующих (как полностью, так и 
частично) заданному условию поиска.
</p>

<p>
Например, чтобы найти все пакеты, содержащие &laquo;pdf&raquo; в названии:
</p>

<pre caption="Поиск пакетов с pdf в названии">
$ <i>emerge --search pdf</i>
</pre>

<p>
Для поиска пакетов еще и по тексту описания можно использовать параметр
<c>--searchdesc</c> (или <c>-S</c>):
</p>

<pre caption="Поиск пакетов, связанных с pdf">
$ <i>emerge --searchdesc pdf</i>
</pre>

<p>
Посмотрев на вывод команды, вы отметите, что вам дается множество информации. 
Поля четко обозначены, поэтому мы не будем вдаваться в подробности их 
значения:
</p>

<pre caption="Пример вывода emerge --search">
*  net-print/cups-pdf
      Latest version available: 1.5.2
      Latest version installed: [ Not Installed ]
      Size of downloaded files: 15 kB
      Homepage:    http://cip.physik.uni-wuerzburg.de/~vrbehr/cups-pdf/
      Description: Provides a virtual printer for CUPS to produce PDF files.
      License:     GPL-2

<comment>(Русский перевод:
*  net-print/cups-pdf
      Последняя доступная версия: 1.5.2
      Последняя установленная версия: [ не установлен ]
      Размер загружаемых файлов: 15 kB
      Веб-страница:  http://cip.physik.uni-wuerzburg.de/~vrbehr/cups-pdf/
      Описание:      Снабжает CUPS виртуальным принтером для печати PDF-файлов.
      Лицензия:      GPL-2 )</comment>
</pre>

</body>
</subsection>
<subsection>
<title>Установка программ</title>
<body>
<!-- (**) editing paused here -->
<p>
После того, как вы нашли нужное программное обеспечение, его можно легко
установить с помощью команды <c>emerge</c>. Вот пример установки пакета
<c>gnumeric</c>:
</p>

<pre caption="Установка gnumeric">
# <i>emerge gnumeric</i>
</pre>

<p>
Так как множество приложений зависят друг от друга, любая попытка установить
какое-либо программное обеспечение может повлечь за собой также установку
дополнительных пакетов. Не беспокойтесь, дерево портежей справится и с этим.
Если вы хотите посмотреть, что именно Portage собирается установить вместе с
нужным вам пакетом, добавьте опцию <c>--pretend</c>. Например:
</p>

<pre caption="Проверка зависимостей пакета gnumeric">
# <i>emerge --pretend gnumeric</i>
</pre>

<p>
После команды на установку пакета загружается необходимый исходный код (при
необходимости) из интернета и по умолчанию сохраняется в директории
<path>/usr/portage/distfiles</path>. После этого пакет будет распакован,
скомпилирован и установлен. Если вы хотите только получить исходный код без
установки, добавьте опцию <c>--fetchonly</c> к команде <c>emerge</c>:
</p>

<pre caption="Получение исходного кода пакета gnumeric">
# <i>emerge --fetchonly gnumeric</i>
</pre>

</body>
</subsection>
<subsection>
<title>Проверка установки документации к пакету</title>
<body>

<p>
Множество пакетов содержат собственную документацию. Иногда флаг <c>doc</c>
в переменной USE определяет, должна ли быть установлена документация к пакету
или нет. Вы можете проверить наличие флага <c>doc</c> в USE с помощью
команды <c>emerge -vp &lt;название пакета&gt;</c>.
</p>

<pre caption="Проверка установки флага doc в USE">
<comment>(alsa-lib - это только пример)</comment>
# <i>emerge -vp alsa-lib</i>
[ebuild  N    ] media-libs/alsa-lib-1.0.9_rc3  +doc -jack 674 kB
</pre>

<p>
Вы можете включить или выключить флажок <c>doc</c> в USE для всех пакетов в
файле <path>/etc/make.conf</path> или для каждого пакета в отдельности в
файле <path>/etc/portage/package.use</path>.
В главе <uri link="?part=2&amp;chap=2">USE-флаги</uri> этот вопрос описан
более подробно.
</p>

<p>
Документация вновь установленного пакета обычно помещается в подкаталог с
названием пакета в каталоге <path>/usr/share/doc</path>. Вы также
можете создать список всех установленных файлов с помощью утилиты
<c>equery</c>, которая является частью <uri
link="/doc/ru/gentoolkit.xml">пакета</uri> <c>app-portage/gentoolkit</c>.
</p>

<pre caption="Расположение документации пакета">
# <i>ls -l /usr/share/doc/alsa-lib-1.0.9_rc3</i>
total 28
-rw-r--r--  1 root root  669 May 17 21:54 ChangeLog.gz
-rw-r--r--  1 root root 9373 May 17 21:54 COPYING.gz
drwxr-xr-x  2 root root 8560 May 17 21:54 html
-rw-r--r--  1 root root  196 May 17 21:54 TODO.gz

<comment>(В качестве альтернативы используйте команду equery для поиска
интересующих файлов :)</comment>
# <i>equery files alsa-lib | less</i>
media-libs/alsa-lib-1.0.9_rc3
* Contents of media-libs/alsa-lib-1.0.9_rc3:
/usr
/usr/bin
/usr/bin/alsalisp
<comment>(Усеченный вывод)</comment>
</pre>

</body>
</subsection>
<subsection>
<title>Удаление пакета</title>
<body>

<p>
Если вы хотите удалить пакет из системы, используйте команду <c>emerge
--unmerge</c>. Эта команда позволит дереву портежей удалить из
системы все файлы, установленные этим пакетом, кроме файлов конфигурации
или тех файлов, которые были изменены после установки. Оставшиеся файлы
конфигурации позволят вам продолжить работу с пакетом, если вы когда-нибудь
решите установить его снова.
</p>

<p>
<brite>Внимание</brite>: Portage <e>не</e> проверяет зависимости удаляемого
пакета! Однако вы получите предупреждение, если захотите удалить пакет,
важный для системы.
</p>

<pre caption="Удаление пакета gnumeric из системы">
# <i>emerge --unmerge gnumeric</i>
</pre>

<p>
После удаления пакета из системы, зависимости этого пакета, установленные
автоматически вместе с ним, остаются. Чтобы дерево портежей выбрало
зависимости, которые должны быть удалены, используйте <c>emerge --depclean</c>.
Этот вопрос будет далее разобран подробнее.
</p>

</body>
</subsection>
<subsection>
<title>Обновление системы</title>
<body>

<p>
Чтобы система находилась в рабочем состоянии, вы должны её регулярно обновлять.
Так как Portage проверяет ebuilds только в дереве портежей, вы должны в первую
очередь обновить это дерево. После того, как дерево портежей обновлено, вы
можете обновить систему с помощью команды <c>emerge --update world</c>:
</p>

<pre caption="Обновление системы">
# <i>emerge --update world</i>
</pre>

<p>
Portage будет искать более новые версии установленных приложений. Однако
проверяется только версии приложений, которые были установлены вами, но
зависимости не проверяются. Если вы хотите обновить также и все зависимости в
системе, добавьте аргумент <c>--deep</c>:
</p>

<pre caption="Обновление всей системы">
# <i>emerge --update --deep world</i>
</pre>

<p>
При исправлениях безопасности в пакетах, которые вы не устанавливали в своей
системе (но которые установились в качестве зависимостей для других программ),
рекомендуется запускать эту команду.
</p>

<p>
Если вы изменили какой-либо из <uri link="?part=2&amp;chap=2">USE-флагов
</uri>, возможно, вы захотите добавить также опцию <c>--newuse</c>. Portage
проверит, требуются ли изменения новым пакетам при установке, а также нужна ли
перекомпиляция существующих:
</p>

<pre caption="Выполнение полного обновления">
# <i>emerge --update --deep --newuse world</i>
</pre>

</body>
</subsection>
<subsection>
<title>Метапакеты</title>
<body>

<p>
У некоторых пакетов в дереве портежей нет содержимого как такового, но они
используются для установки набора программ. Например, пакет <c>kde</c>
полностью установит среду KDE на вашей системе с помощью привлечения
различных KDE-пакетов в качестве зависимостей.
</p>

<p>
Если вы захотите удалить такой пакет из системы, запуск <c>emerge--unmerge</c>
не будет иметь должного эффекта, так как зависимости останутся в системе.
</p>

<p>
В Portage также есть функция удаления оставшихся зависимосей, но так как
доступность программного обеспечения для установки динамично зависима, прежде
всего необходимо полностью обновить всю систему, включая новые изменения,
которые вы приняли, изменяя флаги USE. После этого вы можете запустить
команду  <c>emerge --depclean</c>, чтобы удалить оставшиеся зависимости. Затем
вам нужно перекомпилировать приложения, которые были динамично привязаны к
удаленным пакетам, в которых они больше не нуждаются.
</p>

<p>
Все это регулируется с помощью следующих трех команд:
</p>

<pre caption="Удаление ненужных зависимостей">
# <i>emerge --update --deep --newuse world</i>
# <i>emerge --depclean</i>
# <i>revdep-rebuild</i>
</pre>

<p>
<c>revdep-rebuild</c> находится в пакете <c>gentoolkit</c>
</p>

<pre caption="Установка пакета gentoolkit">
# <i>emerge gentoolkit</i>
</pre>

</body>
</subsection>
</section>
<section>
<title>Собщения Portage</title>
<subsection>
<title>Что такое слоты, виртуальные пактеы, ветви, архитектуры и профили</title>
<body>

<p>
Как уже было сказано, Portage &mdash; чрезвычайно мощный инструмент,
поддерживающий множество функций, чего нет в других системах управления
программным обеспечением. Чтобы это понять, разберем несколько аспектов Portage,
не вникая в детали.
</p>

<p>
С помощью Portage разные версии отдельного пакета могут сосуществовать в одной
системе. В то время, как другие системы управления имеют тенденцию называть
пакеты соответственно версии (например <c>freetype</c> и <c>freetype2</c>),
Portage использует технологию, которая называется <e>Слотами (SLOTs)</e>.
Еbuild присваивает определенный SLOT своей версии. Ebuilds с разными SLOT
сосуществуют в одной системе. Например, у пакета <c>freetype</c> есть ebuild
с <c>SLOT="1"</c> и с <c>SLOT="2"</c>.
</p>

<p>
Существуют также пакеты выполняющие одни и те же функции, но эти функции
осуществляются по-разному. Например <c>metalogd</c>, <c>sysklogd</c> и
<c>syslog-ng</c> являются системными программами журналирования. Приложения,
которые используют эти программы, не могут зависеть от одной, конкретной
программы, например от <c>metalogd</c>, так как остальные программы ничем не
хуже. Portage учитывает это в <e>виртуальном пакете</e>: каждая
системная программа журналирования обеспечивает <c>virtual/syslog</c> и, таким
образом, приложения зависят от <c>virtual/syslog</c>. То есть, вы можете
использовать ту программу журналирования, с которой вы привыкли работать.
</p>

<p>
Программное обеспечение может быть расположено в различных ветвях дерева
портежей. По умолчанию ваша система принимает только стабильные пакеты.
Это означает, что все пакеты, помеченные как стабильные, прошли все фазы
тестирования. Хотя вы и можете видеть ebuilds для нестабильного программного
обеспечения, Portage не будет обновлять их до тех пор, пока они не будут
помещены в стабильную ветвь.
</p>

<p>
Некоторое программное обеспечение доступно не для всех архитектур. Такое
программное обеспечение или не работает на других архитектурах, или требует
дополнительного тестирования, или разработчик не может проверить
работоспособность пакета на другой архитектуре.
</p>

<p>
Каждая установка Gentoo придерживается определенного <c>профиля</c>,
который содержит, помимо прочей информации, список пакетов, которые требуются
системе для нормального функционирования.
</p>

</body>
</subsection>
<subsection id="blocked">
<title>Блокирование пакетов</title>
<body>

<pre caption="Предупреждение о блокированных пакетах (с опцией --pretend)">
[blocks B     ] mail-mta/ssmtp (is blocking mail-mta/postfix-2.2.2-r1)
</pre>

<pre caption="Предупреждение о блокированных пакетах (без опции --pretend)">
!!! Error: the mail-mta/postfix package conflicts with another package.
!!! both can't be installed on the same system together.
!!! Please use 'emerge --pretend' to determine blockers.
</pre>

<p>
Ebuilds содержат особые поля, которые информируют Portage о своих
зависимостях. Существуют две возможные зависимости: зависимости сборки,
отображенные в <c>DEPEND</c> и зависимости выполнения, отображенные в
<c>RDEPEND</c>. Когда одна из этих зависимостей явно маркирует пакет или
фактически <e>не</e> совместима, то пакет блокируется.
</p>

<p>
Для разблокировки вы можете выбрать отмену установки пакета или маскировку
конфликтующего пакета. В данном примере вы можете остановить свой выбор
на установке <c>postfix</c> или сначала удалить <c>ssmtp</c>.
</p>

<p>
Также возможно, что два установливаемых пакета блокируют друг друга. В этом
редчайшем случае вы должны определить, зачем вам устанавливать оба пакета.
В большинстве случаев вы можете отказаться от одного из них. Если нет, то,
пожалуйста, отправьте отчет об ошибке в <uri
link="http://bugs.gentoo.org">в систему управления изменениями Gentoo</uri>
</p>

</body>
</subsection>
<subsection id="masked">
<title>Маскировка пакетов</title>
<body>

<pre caption="Предупреждение о замаскированных пакетах">
!!! all ebuilds that could satisfy "bootsplash" have been masked.
</pre>

<pre caption="Предупреждение о замаскированных пакетах с указанием причины">
!!! possible candidates are:

- gnome-base/gnome-2.8.0_pre1 (masked by: <i>~x86 keyword</i>)
- lm-sensors/lm-sensors-2.8.7 (masked by: <i>-sparc keyword</i>)
- sys-libs/glibc-2.3.4.20040808 (masked by: <i>-* keyword</i>)
- dev-util/cvsd-1.0.2 (masked by: <i>missing keyword</i>)
- media-video/ati-gatos-4.3.0 (masked by: <i>package.mask</i>)
- sys-libs/glibc-2.3.2-r11 (masked by: <i>profile</i>)
</pre>

<p>
Если вы хотите установить пакет, недоступный вашей системе, вы получите эту
ошибку. Вы должны попытаться установить другое приложение, доступное вашей
системе, или подождать до тех пор, пока пакет станет доступным. Всегда есть
причина для маскировки пакета:
</p>

<ul>
  <li>
    <b>~arch keyword</b>. Пакет не прошел все стадии тестирования и не может
    быть помещен в стабильную ветку. Подождите несколько дней или недель и
    попробуйте установить пакет еще раз.
  </li>
  <li>
    <b>-arch keyword</b> или <b>-* keyword</b>. Пакет не работает на вашей
    архитектуре. Если вы полагаете, что пакет выдает ошибочное сообщение,
    сообщите об этом в <uri link="http://bugs.gentoo.org">bugzilla</uri>.
  </li>
  <li>
    <b>missing keyword</b>. Пакет не тестировался на вашей архитектуре.
    Сообщите группе, поддерживающей этот пакет на вашей архитектуре, или
    протестируйте его сами и отправьте сообщение в <uri
    link="http://bugs.gentoo.org">bugzilla</uri>.
  </li>
  <li>
    <b>package.mask</b>. Пакет был заблокирован преднамеренно, так как он
    нестабильный, имеет неправильную контрольную сумму или не работает
    по каким-либо другим причинам.
  </li>
  <li>
    <b>profile</b>. Пакет не предназначен для вашей конфигурации и может
    повредить систему в случае установки.
  </li>
</ul>

</body>
</subsection>
<subsection id="missingdependencies">
<title>Ошибка зависимостей</title>
<body>

<pre caption="Предупреждение об ошибке зависимостей">
emerge: there are no ebuilds to satisfy "&gt;=sys-devel/gcc-3.4.2-r4".

!!! Problem with ebuild sys-devel/gcc-3.4.2-r2
!!! Possibly a DEPEND/*DEPEND problem.
</pre>

<p>
Приложение, которое вы пытаетесь установить зависит от другого пакета,
недоступного вашей системе. Пожалуйста, проверьте, известна ли эта ошибка в
<uri link="http://bugs.gentoo.org">bugzilla</uri>, и если нет, то отправьте
отчет о ней. Если вы не перепутали ветви, то этой ошибки не должно быть.
</p>

</body>
</subsection>
<subsection id="ambiguousebuild">
<title>Неоднозначное имя пакета</title>
<body>

<pre caption="Предупреждение Portage о совпадающих именах ebuild">
!!! The short ebuild name "aterm" is ambiguous.  Please specify
!!! one of the following fully-qualified ebuild names instead:

    dev-libs/aterm
    x11-terms/aterm
</pre>

<p>
Приложение, которое вы хотите установить, имеет имя соответствующее более чем
одному пакету. Вам необходимо указать название категории. Portage сообщит вам о
возможных вариантах выбора.
</p>

</body>
</subsection>
<subsection id="circulardependencies">
<title>Перекрестные зависимости</title>
<body>

<pre caption="Предупреждение Portage о перекрестных зависимостях">
!!! Error: circular dependencies:

ebuild / net-print/cups-1.1.15-r2 depends on ebuild /
app-text/ghostscript-7.05.3-r1
ebuild / app-text/ghostscript-7.05.3-r1 depends on ebuild /
net-print/cups-1.1.15-r2
</pre>

<p>
Два или более пакета, которые вы хотите установить, зависят друг от друга и
таким образом не могут быть установлены. Это похоже на ошибку в дереве
портежей. Пожалуйста, обновите дерево портежей и через некоторое время
попытайтесь снова. Вы можете также проверить, известна ли эта ошибка в
<uri link="http://bugs.gentoo.org">bugzilla</uri> и если нет, отправить отчет о
ней.
</p>

</body>
</subsection>
<subsection id="fetchfailed">
<title>Ошибка получения исходного кода</title>
<body>

<pre caption="Предупреждение Portage об ошибке получения">
!!! Fetch failed for sys-libs/ncurses-5.4-r5, continuing...
<comment>(...)</comment>
!!! Some fetch errors were encountered.  Please see above for details.
</pre>

<p>
Portage не смогла загрузить исходный код для указанных приложений и попытается
продолжить установку других приложений (если они есть). Эта ошибка может
произойти из-за зеркала, которое не было синхронизировано правильно,
или из-за того, что ebuild указывает на неправильное месторасположение.
Сервер, на котором находятся исходные коды, также может не работать по
каким-либо причинам.
</p>

<p>
Повторите действие через час и проверьте, повторится ли эта ошибка.
</p>

</body>
</subsection>
<subsection id="profileprotect">
<title>Основные пакеты системы</title>
<body>

<pre caption="Предупреждение Portage о защищенном пакете">
!!! Trying to unmerge package(s) in system profile. 'sys-apps/portage'
!!! This could be damaging to your system.
</pre>

<p>
Вы попросили удалить пакет, который является частью базовых пакетов вашей
системы. Список пакетов перечислен в конфигурации вашей системы, и таким
образом пакет не может быть удален из системы.
</p>

</body>
</subsection>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 1.51-r2
target-date: 2005-11-27
translated-by: Igor Naum <naumi@vesti-rtr.com>
edited-by: Azamat H. Hackimov <azazello1984@mail.ru>

notes:
Currently in editing by Alexey Chumakov
-->