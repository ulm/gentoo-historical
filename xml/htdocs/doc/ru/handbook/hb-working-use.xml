<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<!-- REV: 1.13 -->
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-working-use.xml,v 1.1 2004/06/09 16:23:18 sergey Exp $ -->

<sections>
<section>
<title>Что такое USE флаги?</title>
<subsection>
<title>Суть USE флагов.</title>
<body>

<p>
Когда вы устанавливаете Gentoo (или любой другой дистрибутив или даже в общем
операционную систему) вы выбираете те или иные опции в зависимости от среды, с
которой работаете. Установка для сервера отличается от установки для рабочей
станции, а установка игровой станции - от платформы 3D рендеринга.
</p>

<p>
Это касается не только того, какие пакеты устанавливать, но и какие функции
должны поддерживаться. Если вам не нужен OpenGL, с какой радости вам его ставить
и собирать поддержку OpenGL в большинстве програм? Если вы не используете KDE,
зачем вам собирать пакеты с его поддержкой, если без этого можно обойтись?
</p>

<p>
Чтобы помочь пользователю выбрать какие программы ставить и какие опции включать,
мы предоставляем простой способ описания рабочей среды. Это позволяет
пользователю сконцентрироваться на том, что же ему на самом деле надо, и
облегчает работу Portage, нашей системе управления пакетам.
</p>

</body>
</subsection>
<subsection>
<title>Определение USE флагов.</title>
<body>

<p>
USE флаг представляет собой ключевое слово, описывающие поддержку и информацию о
зависимостях той или иной функции или концепции. Если вы определяете какой-то
USE флаг, то Portage знает, что вы хотите активировать поддержку данной функции.
Конечно это изменит также и информацию о зависимостях пакета.
</p>

<p>
Давайте рассмотрим конкретный пример - ключевое слово <c>kde</c>. Если у вас нет этого
слова в переменной <c>USE</c>, то все пакеты, где поддержка KDE является
<e>выборочной</e>,
будут собраны <e>без</e> нее. Все пакеты, где зависимость от KDE является
<e>выборочной</e>,
будут установлены <e>без</e> установки KDE, как зависимой библиотеки. Если же вы
определили ключевое слово <c>kde</c>, то эти пакеты будут собраны с поддержкой KDE, и
она (KDE) будет установлена как необходимая зависимость.
</p>

<p>
Если вы правильно укажете ключевые слова, то получите систему заточенную под ваши
нужды.
</p>

</body>
</subsection>
<subsection>
<title>Какие существуют USE флаги?</title>
<body>

<p>
Существует два типа USE флагов: <e>глобальные</e> и <e>локальные</e>.
</p>

<ul>
  <li>
    <e>Глобальный</e> USE флаг используется несколькими пакетами и является
	системным.
  </li>
  <li>
    <e>Локальный</e> USE флаг используется одним пакетом для каких-то
	специфичных настроек.
  </li>
</ul>

<p>
Список глобальных USE флагов можно найти <uri
link="/dyn/use-index.xml">в онлайне</uri> или локально в
<path>/usr/portage/profiles/use.desc</path>. Вот <e>небольшая</e> выдержка из этого
файла:
</p>

<pre caption="Короткая выдержка из списка доступных USE флагов">
gtk     - Adds support for x11-libs/gtk+ (The GIMP Toolkit)
gtk2    - Use gtk+-2.0.0 over gtk+-1.2 in cases where a program supports both.
gtkhtml - Adds support for gnome-extra/gtkhtml
guile   - Adds support for dev-util/guile (interpreter for Scheme)
icc     - Use the Intel C++ Compiler if the package supports it
icc-pgo - Enable PGO data generation or use when use icc.
imap    - Adds support for IMAP
</pre>

</body>
</subsection>
</section>
<section>
<title>Использование USE флагов.</title>
<subsection>
<title>Определение постоянных USE флагов.</title>
<body>

<p>
Надеюсь теперь у вас нет сомнений в необходимости USE флагов и мы можем вам
рассказать, как их установить.
</p>

<p>
Как было ранее отмечено, все USE флаги определяются в переменной <c>USE</c>. Для
того, чтобы упростить пользователям поиск и выбор флагов мы предоставляем
настройки <e>по умолчанию</e>, которые представляют собой список USE флагов, которые,
как нам кажется, наиболее часто используются пользователями Gentoo. Эти настройки прописаны в
файле <path>/etc/make.profile/make.defaults</path>. Давайте взглянем на них:
</p>

<pre caption="Переменная USE в /etc/make.profile/make.defaults">
USE="x86 oss apm arts avi berkdb crypt cups encode foomaticdb gdbm gif gpm gtk 
     imlib jpeg kde gnome libg++ libwww mad mikmod motif mpeg ncurses nls 
     oggvorbis opengl pam pdflib png python qt quicktime readline sdl slang 
     spell ssl svga tcpd truetype X xml2 xmms xv zlib"
</pre>

<p>
Как видите, эта переменная уже содержит достаточно много ключевых слов. <b>Не
меняйте</b> файл <path>/etc/make.profile/make.defaults</path> для настройки
<c>USE</c> под свои нужды: изменения в этом файле будут удалены, когда вы
обновите Poratage!
</p>

<p>
Чтобы изменить настройки по умолчанию, вам надо добавить или удалить ключевые
слова из переменной <c>USE</c>. Это можно сделать глобально, определив
переменную <c>USE</c> в <path>/etc/make.conf</path>. В эту переменную вы
прописываете флаги, которые хотите добавить. Чтобы удалить флаг, его надо
прописать с приставкой "-" (знак минус).
</p>

<p>
Например, чтобы убрать поддержку KDE и QT, но добавить поддержку ldap,
<c>USE</c> слдеющего вида может быть определана в <path>/etc/make.conf</path>:
</p>

<pre caption="Пример настроек USE из /etc/make.conf">
USE="-kde -qt ldap"
</pre>

</body>
</subsection>
<subsection>
<title>Объявление временных USE флагов.</title>
<body>

<p>
Иногда необходимо установить какой-то USE флаг отлько на один раз. Вместо того,
чтобы дважды редактировать <path>/etc/make.conf</path> (сначала добавить его, а
потом удалить), вы можете объявить USE как перемнную среды.
</p>

<p>
В качестве примера, мы уберём java и настроек USE, на время установки mozilla.
</p>

<note>
Команда <c>emerge</c> будет подробно рассмотрена в разделе <uri
link="?part=2&amp;chap=2">Portage и его программы</uri>.
</note>

<pre caption="Использование USE как переменной среды">
# <i>USE="-java" emerge mozilla</i>
</pre>

</body>
</subsection>
<subsection>
<title>Предоставление USE флагов</title>
<body>

<p>
Некоторые пакеты не только проверяют USE флаги, но и предоставляют их. Когда вы
устанавливаете такой пакет, USE, предоставлемый им, добавляется в ваши настройки
USE. Чтобы просмотреть список таких пакетов обратитесь к
<path>/etc/make.profile/use.defaults</path>:
</p>

<pre caption="Выдержка из /etc/make.profile/use.defaults">
gnome           gnome-base/gnome
gtk             x11-libs/gtk+
qt              x11-libs/qt
kde             kde-base/kdebase
motif           x11-libs/openmotif
</pre>

</body>
</subsection>
<subsection>
<title>Последовательность наследования</title>
<body>

<p>
Конечно же существует определённая последовательность наследование настроек USE.
Вы же не хотите объявить <c>USE="-java"</c> только для того, чтобы узнать, что
<c>java</c> определена в любом случае. Последовательность наследования настроек
USE в порядке приоретета (от меньшего к большему) такова:
</p>

<ol>
  <li>
    Настройки по умолчанию в <path>/etc/make.profile/make.defaults</path>
  </li>
  <li>
    Унаследованные настройки USE, если пакеты из 
    <path>/etc/make.profile/use.defaults</path> установлены.
  </li>
  <li>
    Настройки, определенные пользователем в <path>/etc/make.conf</path>
  </li>
  <li>
    Настройки, определённые пользователям, как переменная среды
  </li>
</ol>

<p>
Чтобы узнать, какие же настройки <c>USE</c> в конечном счете видит Portage,
запустите <c>emere info</c>. Эта команда выведет значение всех переменных,
имеющих отношение к делу, включая <c>USE</c>.
</p>

<pre caption="Запускаем emerge info">
# <i>emerge info</i>
</pre>

</body>
</subsection>
<subsection>
<title>Подстраиваем ВСЮ систему под новые USE флаги</title>
<body>

<p>
Если вы изменили свои USE фалги и хотите подстроить всю систему по новые
значения, можете попробовать воспользоватся этими инструкциями. Однако, вы
должны знать, что это займет очень много времени. В будущем Portage сможет
делать это автоматически и намного быстрее.
</p>

<p>
Для начала пересоберите всю систему с новыми USE флагами:
</p>

<pre caption="Пересборка всей системы">
# <i>emerge --emptytree world</i>
</pre>

<p>
Теперь запустите функцию depclean чтобы удалить выборочные зависимости
установленные в "старой" системе и которые больше не нужны с новыми USE флагами.
</p>

<warn>
Запуск <c>emerge depclean</c> является достаточно опасной операцией. Дважды
перепроверьте список "ненужных" пакетов и удебитесь что он не собирается удалить
что-то нужное. В следующем примере мы добавили ключ <c>-p</c>, чтобы depclean
только перечислил пакеты, не удаляя их.
</warn>

<pre caption="Удаляем ненужные пакеты">
# <i>emerge -p depclean</i>
</pre>

<p>
Когда depclean закончит работу, ваша система будет полностью использовать новые
USE флаги.
</p>

</body>
</subsection>
</section>
<section>
<title>USE флаги специфичные для отдельных пакетов</title>
<subsection>
<title>Просмотр доступных USE флагов</title>
<body>

<p>
В следующей главе, <uri link="?part=2&amp;chap=2">Portage и его
программы</uri>, мы покажем, как управлять установленным программным
обеспечением и как использовать <c>emerge</c>. Однако, мы затронем <c>emerge</c>
уже сейчас, чтобы показать вам, как можно увидеть список USE флагов, используемых
тем или иным пакетом.
</p>

<p>
Возьмем к примеру <c>mozilla</c> - какие USE флаги она проверяет? Чтобы это
выяснить, запустим <c>emerge</c> с опциями <c>--pretend</c> (на самом деле
ничего не делать) и <c>--verbose</c> (дать расширенный вывод):
</p>

<pre caption="Просмотр используемых USE флагов">
# <i>emerge --pretend --verbose mozilla</i>
These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild  N    ] net-www/mozilla-1.5-r1 +java +crypt -ipv6 -gtk2 +ssl +ldap 
+gnome -debug +mozcalendar -mozaccess -mozxmlterm -moznoirc -moznomail
-moznocompose -moznoxft 
</pre>

<p>
<c>emerge</c> - это не единственная утилит для этой задачи. Есть программа
специально предназначенная для вывода информация о пакетах. Она называется
<c>etcat</c> и находится в пакете <c>gentoolkit</c>. Для начала установим этот
пакет:
</p>

<pre caption="Устанавливаем gentoolkit">
# <i>emerge --usepkg gentoolkit</i>
</pre>

<p>
Теперь запустим <c>etcat</c> с аргументом <c>uses</c> для просмотра USE флагов
некого пакета. На этот раз посмотрим на <c>gnumeric</c>:
</p>

<pre caption="Используем etcat для просмотра доступных USE флагов">
# <i>etcat uses gnumeric</i>
[ Colour Code : <i>set</i> <comment>unset</comment> ]
[ Legend      : (U) Col 1 - Current USE flags        ]
[             : (I) Col 2 - Installed With USE flags ]

 U I [ Found these USE variables in : app-office/gnumeric-1.2.0 ]
 - - <comment>libgda</comment>  : Adds GNU Data Access (CORBA wrapper) support for gnumeric
 - - <comment>gnomedb</comment> : unknown
 + + <i>python</i>  : Adds support/bindings for the Python language
 + + <i>bonobo</i>  : Adds support for gnome-base/bonobo (Gnome CORBA interfaces)
</pre>

</body>
</subsection>
</section>
</sections>
