<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-net-modules.xml,v 1.4 2006/04/01 20:03:27 achumakov Exp $ -->

<sections>

<version>1.8</version>
<date>2006-04-01</date>

<section>
<title>Сетевые модули</title>
<body>

<p>
Cейчас мы поддерживаем модульные сетевые сценарии. Это значит, что мы можем 
легко добавлять поддержку для новых типов интерфейсов и конфигурационных 
модулей, сохраняя совместимость с существующими.
</p>

<p>
По умолчанию, модули загружаются только если пакет, нужный им, установлен. Если 
отметить модуль, для которого не установлен пакет, будет выдана ошибка с 
указанием, какой пакет нужно установить. В идеале, настройка модулей требуется  
только тогда, когда установленно несколько пакетов, представляющих одну и ту же 
службу, а вам установить приоритет одного из них.
</p>

<note>	
Все обсуждаемые значения хранятся в <path>/etc/conf.d/net</path>, если явно не 
указано иное.	
</note>

<pre caption="Предпочтение модуля">
<comment># выбор iproute2, а не ifconfig</comment>
modules=( "iproute2" )

<comment># можно также указать другие модули для отдельного интерфейса
# здесь мы выбираем udhcpc, а не dhcpcd</comment>
modules_eth0=( "udhcpc" )

<comment># также можно указать, какие модули не надо использовать: например,
# возможно, вы используете supplicant или linux-wlan-ng для управления
# параметрами беспроводной сети, но при этом желаете настраивать сетевые
# параметры раздельно для каждого связанного ESSID</comment>
modules=( "!iwconfig" )
</pre>

</body>
</section>
<section>
<title>Обработчики интерфейса</title>
<body>

<p>
Сейчас мы предоставляем два обработчика интерфейса: <c>ifconfig</c> и 
<c>iproute2</c>. Для настройки сети вам нужен только один из них.
</p>

<p>
<c>ifconfig</c> в текущем Gentoo используется по умолчанию, и включен в 
системный профиль. <c>iproute2</c> &mdash; более мощный и гибкий пакет, который
не включен в системный профиль по умолчанию.
</p>

<pre caption="Установка iproute2">
# <i>emerge sys-apps/iproute2</i>

<comment># выбор iproute2, а не ifconfig, когда установлены оба</comment>
modules=( "iproute2" )
</pre>

<p>
Так как и <c>ifconfig</c> и <c>iproute2</c> делают очень сходные вещи, то мы 
сделали их базовую настройку взаимозаменяемой. Например, оба приведенных ниже
примера работают не зависимо от того, какой модуль используется.
</p>

<pre caption="Примеры ifconfig и iproute2">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># также можно указать широковещательный адрес</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>

</body>
</section>
<section id="dhcp">
<title>DHCP</title>
<body>

<p>
DHCP &mdash; это способ получения сетевой информации (адреса IP, сервера DNS, 
шлюза и т.д.) с сервера. Это значит, что если в сети запущен сервер DHCP, вам 
остается только сказать каждому клиенту, чтобы он использовал DHCP, и сеть 
настроится сама собой. Конечно, вам придется настраивать все остальное
(бесроводную сеть, подключение точка-точка и т.д.), если они должны работать
до использования DHCP.
</p>

<p>
Поддержка DHCP обеспечивается <c>dhclient</c>, <c>dhcpcd</c>, <c>pump</c> или 
<c>udhcpc</c>. У каждого модуля DHCP есть свои плюсы и минусы: здесь мы 
быстренько рассмотрим их.
</p>

<table>
<tr>
  <th>Модуль DHCP</th>
  <th>Пакет</th>
  <th>Плюсы</th>
  <th>Минусы</th>
</tr>
<tr>
  <ti><c>dhclient</c></ti>
  <ti><c>net-misc/dhcp</c></ti>
  <ti>
    Сделан ISC, теми же людьми, кто делает BIND DNS. Гибок в настройке. 
  </ti>
  <ti>
    Настройка чрезмерно сложна, программа довольно &laquo;распухшая&raquo;, не 
    может получать данные о серверах NTP с DHCP, по умолчанию не отправляет
    имя узла.
  </ti>
</tr>
<tr>
  <ti><c>dhcpcd</c></ti>
  <ti><c>net-misc/dhcpcd</c></ti>
  <ti>
    Давно в Gentoo по умолчанию, не зависит от внешних утилит.
  </ti>
  <ti>
    Более не поддерживается разработчиком, может быть временами медленным, 
    не становится демоном при неограниченном сроке аренды адреса.
  </ti>
</tr>
<tr>
  <ti><c>pump</c></ti>
  <ti><c>net-misc/pump</c></ti>
  <ti>
    Компактный, не зависит от внешних утилит.
  </ti>
  <ti>
    Более не поддерживается разработчиком, ненадежен, особенно по модему, не 
    может получать данные о серверых NIS по DHCP.
  </ti>
</tr>
<tr>
  <ti><c>udhcpc</c></ti>
  <ti><c>net-misc/udhcp</c></ti>
  <ti>
    Компактный; наименьший существующий клиент DHCP, сделан для встроенных 
    систем.
  </ti>
  <ti>
    Не зарекомендовал себя &mdash; ни в одном дистрибутиве не используется
    по умолчанию; не поддерживает длительность таймаута более 3 секунд.
  </ti>
</tr>
</table>

<p>
Если у вас установлено больше одного DHCP клиента, вам нужно указать, какой 
использовать; иначе по умолчанию используется <c>dhcpcd</c>, если есть.
</p>

<p>
Чтобы передать определенные параметры модулю DHCP, используйте 
<c>модуль_eth0="..."</c> <e>(замените модуль на имя используемого модуля DHCP,
например, <c>dhcpcd_eth0</c>)</e>.
</p>
                                
<p>
Мы попытались сделать DHCP относительным агностиком: по существу, мы 
поддерживаем следующие команды, с использованием переменной <c>dhcp_eth0</c>. 
По умолчанию не включена ни одна из них.
</p>

<ul>
  <li>
    <c>release</c> &mdash; освобождать IP-адрес для повторного использования
  </li> 
  <li><c>nodns</c> &mdash; не замещать <path>/etc/resolv.conf</path></li>
  <li><c>nontp</c> &mdash; не замещать <path>/etc/ntp.conf</path></li>
  <li><c>nonis</c> &mdash; не замещать <path>/etc/yp.conf</path></li>
</ul>

<pre caption="Простая настройка DHCP в /etc/conf.d/net">
<comment># требуется только если у вас несколько модулей DHCP</comment>
modules=( "dhcpcd" )

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># прекращение после 10 секунд</comment>
dhcp_eth0="release nodns nontp nonis" <comment># только получать адрес</comment>
</pre>

<note>
По умолчанию, <c>dhcpcd</c>, <c>udhcpc</c> и <c>pump</c> передают текущее
узла на сервер DHCP, поэтому его больше не требуется указывать.
</note>

</body>
</section>
<section>
<title>Модем ADSL</title>
<body>

<p>
Сначала нужно установить программное обеспечение для ADSL.
</p>

<pre caption="Установка пакета rp-pppoe">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
В <c>baselayout-1.11.x</c> поддерживается только PPPoE. Надеемся, что в будущих
версиях появится поддержка PPPoA.
</warn>

<p>
Сейчас нам нужно указать, что на <c>eth0</c> будет ADSL-интерфейс, и ввести наше 
имя пользователя, обновив <path>/etc/conf.d/net</path>. 
</p>

<pre caption="Настройка eth0 для ADSL в /etc/conf.d/net">                           	
config_eth0=( "adsl" )
adsl_user_eth0="имя-пользователя"
</pre>

<p>
Наконец, нужно указать ваше имя и пароль в <path>/etc/ppp/pap-secrets</path>.
</p>

<pre caption="Пример /etc/ppp/pap-secrets">
<comment># * обязательна</comment>
"пользователь"  *  "пароль"
</pre>

</body>
</section>
<section id="apipa">
<title>APIPA (автоматическая частная IP-адресация)</title>
<body>

<p>
APIPA пытается найти свободный адрес в диапазоне 169.254.0.0-169.254.255.255,
проверяя отклик на интерфейсе произвольного адреса из этого диапазона по 
протоколу arp. Если отклика нет, адрес назначается интерфейсу.
</p>

<p>
Это полезно только в локальных сетях, где нет сервера DHCP, нет прямого 
подключения к интернету, и все другие компьютеры используют APIPA.
</p>

<p>
Для поддержки APIPA установите <c>net-misc/iputils</c> или 
<c>net-analyzer/arping</c>.
</p>

<pre caption="Настройка APIPA в /etc/conf.d/net">
<comment># сначала пробуем DHCP, при неудаче переходим на APIPA</comment>
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># использование только APIPA</comment>
config_eth0=( "apipa" )
</pre>

</body>
</section>
<section>
<title>Объединение интерфейсов</title>
<body>

<p>
Для объединения каналов в ствол (bonding) установите <c>net-misc/ifenslave</c>.
</p>

<p>
Объединение используется для повышения пропускной способности сети. Если у вас 
есть две сетевых карты, выходящих в одну и ту же сеть, можно объединить их, 
так что ваши приложения увидят только один интерфейс, но реально будут 
пользоваться двумя сетевыми платами.
</p>

<pre caption="Настройка объединения в /etc/conf.d/net">
<comment># объединение интерфейсов</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># вы можете не захотеть назначать адрес IP объединенному интерфейсу</comment>
config_bond0=( "null" )

<comment># указание зависимости от eth0, eth1 и eth2, так как им может требоваться
# дополнительная настройка</comment>
depend_bond0() {
need net.eth0 net.eth1 net.eth2
}
</pre>

</body>
</section>
<section>
<title>Образование моста (поддержка 802.1d)</title>
<body>

<p>
Для поддержки мостов установите <c>net-misc/bridge-utils</c>.
</p>

<p>
Мосты используются для объединения сетей. Например, у вас может быть сервер, 
подсоединенный к интернету через ADSL-модем, и плата беспроводного доступа
для предоставления доступа в интернет через ADSL модем другим компьютерам. 
Чтобы соединить оба интерфейса, можно создать &laquo;мост&raquo;.
</p>

<pre caption="Настройка моста в /etc/conf.d/net">
<comment># настройка моста: подробности в "man btctl"</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># включаем порты в мост br0</comment>
bridge_br0="eth0 eth1"

<comment># устанавливаем порты в "null", чтобы не запускался dhcp</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># наконец, даем мосту адрес; можно использовать и DHCP</comment>
config_br0=( "192.168.0.1/24" )

<comment># указываем зависимость от eth0 и eth1, так как им может требоваться
# дополнительная настройка</comment>
depend_br0() {
need net.eth0 net.eth1
}
</pre>

<impo>
Для использования некоторых вариантов моста вам может потребоваться обращение к 
документации по <uri link="?part=4&amp;chap=2#variable_name">именам 
переменных</uri>.
</impo>

</body>
</section>
<section>
<title>MAC-адрес</title>
<body>

<p>
Для изменения MAC-адреса своего интерфейса вам не потребуется ничего
устанавливать, если у вас <c>sys-apps/baselayout-1.11.14</c> или новее, и вы
собираетесь сменить MAC-адрес на какой-то определенный. Однако, если вам нужно 
сменить MAC-адрес на случайный, или ваш baselayout старше указанной версии, 
для смены адреса потребуется установить пакет командой emerge 
<c>net-analyzer/macchanger</c>.
</p>

<pre caption="Пример изменения MAC-адреса">
<comment># установка MAC-адреса интерфейса</comment>
mac_eth0="00:11:22:33:44:55"

<comment># случайная установка последних 3 байт адреса</comment>
mac_eth0="random-ending"

<comment># установка случайного адреса из диапазона для физического соединения
# того же типа (оптического, медного, беспроводного) любого изготовителя</comment>
mac_eth0="random-samekind"

<comment># установка случайного адреса из диапазона для любого типа физического
# соединения (оптического, медного, беспроводного) любого изготовителя</comment>
mac_eth0="random-anykind"

<comment># полностью случайный; ВНИМАНИЕ, некоторые MAC-адреса, сгенерированные
# таким образом, могут вести себя НЕ ТАК, как предполагается</comment>
mac_eth0="random-full"
</pre>

</body>
</section>
<section>
<title>Образование тоннеля</title>
<body>

<p>
Для образования тоннеля вам не нужно ничего устанавливать, поскольку на это 
способен сам обработчик интерфейса.
</p>

<pre caption="Настройка тоннеля в /etc/conf.d/net">
<comment># для тоннелей GRE</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># для тоннелей IPIP</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># для настройки интерфейса</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" )
</pre>

</body>
</section>
<section>
<title>Виртуальные сети (поддержка 802.1q)</title>
<body>

<p>
Для поддержки VLAN, установите <c>net-misc/vconfig</c>.
</p>

<p>
Виртуальная локальная сеть (VLAN) &mdash; это группа сетевых устройств, которые 
ведут себя, как будто подключены к одному сегменту сети, даже когда это не так. 
Членам VLAN видны только члены той же VLAN даже если в той же физической сети
присутствуют другие.
</p>

<pre caption="VLAN configuration in /etc/conf.d/net">
<comment># указание номеров VLAN для интерфейса</comment>
<comment># пожалуйста, убедитесь, что ваши номера VLAN НЕ дополнены нулем</comment>
vlans_eth0="1 2"

<comment># можно также настроить VLAN</comment>
<comment># за подробностями обращайтесь к man vconfig</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># настройка интерфейса как обычно</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Для использования некоторых вариантов VLAN вам может потребоваться обращение к
документации по <uri link="?part=4&amp;chap=2#variable_name">именам 
переменных</uri>.
</impo>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 1.8-r1
target-date: 2006-04-01
source-cvs-revision: 1.16
translated-by: Analyzer <subscribe2k@yandex.ru>
edited-by: Alexey Chumakov <achumakov@gentoo.org>
-->
