<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-net-modules.xml,v 1.2 2006/01/23 21:37:40 achumakov Exp $ -->

<sections>

<version>1.7</version>
<date>2006-01-03</date>

<section>
<title>Сетевые модули</title>
<body>

<p>
Мы сейчас поддерживаем модульные сетевые скрипты. Это значит, что мы можем 
легко добавлять поддержку для новых типов интерфейсов и конфигураций модулей, 
сохраняя совместимость с существующими.
</p>

<p>
По умолчанию, модули грузятся только если нужный для них пакет установлен. Если 
вы отметите модуль для которого не установлен пакет, то получите ошибку с 
сообщением о том, какой пакет вам нужно установить. В идеале, вы используите 
настройки модулей когда у вас установленно два или более пакетов, которые 
поддерживают один и тотже сервис, и вам нужно выбрать только один.
</p>

<pre caption="Module preference">
<comment># Выбираем iproute2, а не ifconfig</comment>
modules=( "iproute2" )

<comment># Вы можете так же отметить другие модули для интерфейса
# В этом случае мы выбираем udhcpc, а не dhcpcd</comment>
modules_eth0=( "udhcpc" )

<comment># Вы можете так же отметить модули, которые не надо использовать - например,
# может быть, вы используете supplicant или linux-wlan-ng для управления
# настройками wireless, но все еще желаете настраивать сетевые параметры
# раздельно по каждому ESSID.</comment>
modules=( "!iwconfig" )
</pre>

</body>
</section>
<section>
<title>Обработчики интерфейса</title>
<body>

<p>
Сейчас мы обеспечиваем двумя обработчиками интерфейса: <c>ifconfig</c> и 
<c>iproute2</c>. Вам нужен только один из них, чтобы настраивать сеть.
</p>

<p>
<c>ifconfig</c> &mdash; в текущем Gentoo идет по умолчанию и включен в 
системный профиль. <c>iproute2</c> &mdash; более мощный и гибкий пакет, но не 
включен в системный профиль по умолчанию.
</p>

<pre caption="Установка iproute2">
# <i>emerge sys-apps/iproute2</i>

<comment># Чтобы выбрать iproute2, а не ifconfig, если установленны оба</comment>
modules=( "iproute2" )
</pre>

<p>
Так как и <c>ifconfig</c> и <c>iproute2</c> делают очень похожие вещи, то мы сделали их 
базовую настройку рабочую для обоих. Например, код, что ниже, работает не 
обращая внимания на то какой модуль вы используете.
</p>

<pre caption="ifconfig and iproute2 examples">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># Мы также можем отметить broadcast</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>

</body>
</section>
<section id="dhcp">
<title>DHCP</title>
<body>

<p>
DHCP означает, что берется сетевая информация (IP адрес, DNS сервер, Шлюз и 
т.д.) с DHCP сервера. Это значит, что если в сети запущен DHCP сервер, то вы 
должны только сказать каждому клиенту чтобы он использовал DHCP и сеть 
настроется сама. Конечно, вы должны настроить все остальное(wireless, PPP и 
т.д.), если вам нужно это использовать до DHCP.
</p>

<p>
Педдержка DHCP обеспечивается <c>dhclient</c>, <c>dhcpcd</c>, <c>pump</c> или 
<c>udhcpc</c>. Каждый DHCP модуль имеет свои плюсы и минусы - здесь мы 
быстренько рассмотрим их.
</p>

<table>
<tr>
  <th>DHCP Модуль</th>
  <th>Пакет</th>
  <th>Плюсы</th>
  <th>Минусы</th>
</tr>
<tr>
  <ti><c>dhclient</c></ti>
  <ti><c>net-misc/dhcp</c></ti>
  <ti>
    Сделали ISC, теже самые люди кто делает BIND DNS. Очень гибко 
    настраиваемый.
  </ti>
  <ti>
    Настройка черезмерно сложная, программа довольно "распухшая", не может 
    брать NTP серверы с DHCP, по умолчанию не отправляет имя хоста.
  </ti>
</tr>
<tr>
  <ti><c>dhcpcd</c></ti>
  <ti><c>net-misc/dhcpcd</c></ti>
  <ti>
    Долгое время в Gentoo по умолчанию, нет доверия внешним утилитам
  </ti>
  <ti>
    Более не поддерживается главным разработчиком, может быть медленным иногда, 
    не становится демоном при неограниченном сроке аренды адреса
  </ti>
</tr>
<tr>
  <ti><c>pump</c></ti>
  <ti><c>net-misc/pump</c></ti>
  <ti>
    Легкий, нет доверия внешним утилитам
  </ti>
  <ti>
    Более не поддерживается главным разработчиком, ненадежный, особенно через 
    модемы, не может брать NIS серверы с DHCP
  </ti>
</tr>
<tr>
  <ti><c>udhcpc</c></ti>
  <ti><c>net-misc/udhcp</c></ti>
  <ti>
    Легкий - самый маленький клиент DHCP, сделан для встроенных систем
  </ti>
  <ti>
    Не поставляется - нет дистрибутивов используемых этот клиент по умолчанию, 
    не может установить значение перерыва более 3 секунд
  </ti>
</tr>
</table>

<p>
Если у вас установлено больше одного DHCP клиента, то вам нужно выбрать какой 
использовать - иначе будет установлен по умолчанию <c>dhcpcd</c>, если он 
конечно будет доступен.
</p>

<p>
Чтобы отправить определенные опции модулю DHCP, используйте 
<c>module_eth0="..."</c> <e>(измените module на имя DHCP модуля, который вы 
используете - например, <c>dhcpcd_eth0</c>)</e>.
</p>

<p>
Мы попытались сделать DHCP относительным агностиком - так же мы поддерживаем 
следующие комманды, используя переменную <c>dhcp_eth0</c>. По умолчанию не 
установлен ни один из них.
</p>

<ul>
  <li><c>release</c> - освобождать IP адрес для повторного использования</li>
  <li><c>nodns</c> - не переписывать <path>/etc/resolv.conf</path></li>
  <li><c>nontp</c> - не переписывать <path>/etc/ntp.conf</path></li>
  <li><c>nonis</c> - не переписывать <path>/etc/yp.conf</path></li>
</ul>

<pre caption="Sample DHCP configuration in /etc/conf.d/net">
<comment># Нужен только если у вас установлено более одного DHCP модуля</comment>
modules=( "dhcpcd" )

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># Перерыв после 10 секунд</comment>
dhcp_eth0="release nodns nontp nonis" <comment># Берет только адрес</comment>
</pre>

<note>
<c>dhcpcd</c>, <c>udhcpc</c> и <c>pump</c>, по умолчанию, отправляют текущее 
имя хоста на DHCP сервер, вам не нужно указывать это более.
</note>

</body>
</section>
<section>
<title>ADSL модем</title>
<body>

<p>
Для начала нам нужно установить программное обеспечение для ADSL.
</p>

<pre caption="Install the rp-pppoe package">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
<c>baselayout-1.11.x</c> поддерживает только PPPoE. Надеемся, что будущие 
версии будут поддерживать и PPPoA.
</warn>

<p>
Сейчас нам нужно сказать в конфегурации что на <c>eth0</c> будет ADSL интерфейс 
и ввести наше имя пользователя.
</p>

<pre caption="Настройка eth0 для ADSL">
config_eth0=( "adsl" )
adsl_user_eth0="username"
</pre>

<p>
В конце вам нужно определить ваше имя и пароль в 
<path>/etc/ppp/pap-secrets</path>.
</p>

<pre caption="Пример /etc/ppp/pap-secrets">
<comment># * обязательна</comment>
"username"  *  "password"
</pre>

</body>
</section>
<section id="apipa">
<title>APIPA (автоматическая частная IP-адресация)</title>
<body>

<p>
APIPA пытается найти свободный адрес в диапазоне 169.254.0.0-169.254.255.255 by 
arping a random address in that range on the interface. Если ответ не найден, 
то мы назначаем этот адрес интерфейсу.
</p>

<p>
Это полезно только для LAN, где нет DHCP сервера и вы не соединены напрямую к 
интернету и все другие компьютеры используют APIPA.
</p>

<p>
Для поддержки APIPA установите <c>net-misc/iputils</c> или 
<c>net-analyzer/arping</c>.
</p>

<pre caption="Настройка APIPA в /etc/conf.d/net">
<comment># Сначала попробуем DHCP, если неудачно, то будем использовать APIPA</comment>
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># Использовать только APIPA</comment>
config_eth0=( "apipa" )
</pre>

</body>
</section>
<section>
<title>"Связывание" (Bonding)</title>
<body>

<p>
Для "связывания"/trunking линка установите <c>net-misc/ifenslave</c>.
</p>

<p>
Bonding используется для увеличения ширины сетевого канала. Если у вас есть две 
сетевых карты, которые идут на одну сеть, то вы можете "связать" их вместе и 
выши приложения будут видеть только один интерфейс, но реально будут 
использоваться 2 сетевые карты.
</p>

<pre caption="Настройка связывания в /etc/conf.d/net">
<comment># Чтобы "связать" интерфейсы вместе</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># Если вы не хотите назначать IP "связвнному" интерфейсу</comment>
config_bond0=( "null" )

<comment># Зависеть от eth0, eth1 и eth2, так как им может понадобится дополнительная
# настройка</comment>
depend_bond0() {
need net.eth0 net.eth1 net.eth2
}
</pre>

</body>
</section>
<section>
<title>Bridging (поддержка 802.1d) - "Мост"</title>
<body>

<p>
Для поддержки bridging - установите <c>net-misc/bridge-utils</c>.
</p>

<p>
Bridging используется для соединения сетей вместе. Например, у вас может быть 
сервер, который подсоединен к интернет через ADSL модем и карту беспроводного 
доступа, чтобы подключить другие компьютеры к интернету через ADSL модем.
Вы можете создать "мост" для соединения двух интерфейсов вместе.
</p>

<pre caption="Bridge configuration in /etc/conf.d/net">
<comment># Настройка "моста" - "man btctl" для большей информации</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># Чтобы добавить порты к "мосту" br0</comment>
bridge_br0="eth0 eth1"

<comment># Вам нужно настроить порты в "null", иначе dhcp не запустится</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># В конце, дайте адрем "мосту" - вы могли также использовать DHCP</comment>
config_br0=( "192.168.0.1/24" )

<comment># Зависет от eth0 и eth1, так как они могут потребовать дополнительную 
# настройку</comment>
depend_br0() {
need net.eth0 net.eth1
}
</pre>

<impo>
Для использования некоторых настроек "моста", вы можете проконсультироваться с 
документацией по <uri link="?part=4&amp;chap=2#variable_name">variable 
name</uri>.
</impo>

</body>
</section>
<section>
<title>MAC адрес</title>
<body>

<p>
Вам не надо ничего устанавливать для смены MAC адреса вашего интерфейса, если  
у вас установлен <c>sys-apps/baselayout-1.11.14</c> или более новый, и вы
вы меняете MAC-адрес на определенный. Однако, если вам нужно сменить на 
случайный MAC-адрес, или ваш baselayout старше указанной версии, потребуется 
выполнить emerge <c>net-analyzer/macchanger</c>.
</p>

<pre caption="Пример изменения MAC-адреса">
<comment># Чтобы установить MAC адрес интерфейса</comment>
mac_eth0="00:11:22:33:44:55"

<comment># Чтобы смешать только 3 последних байта</comment>
mac_eth0="random-ending"

<comment># Чтобы смешать с такими же типами физического соединения (например fibre,
# copper, wireless), все продавцы</comment>
mac_eth0="random-samekind"

<comment># Чтобы смешать с различными физическими типами соединений
# (например fibre, copper, wireless), все продавцы</comment>
mac_eth0="random-anykind"

<comment># Полное перемешивание - ПРЕДУПРЕЖДЕНИЕ: некоторые MAC адреса,
# сгенерированные этим способом, могут НЕ действовать как предполагается</comment>
mac_eth0="random-full"
</pre>

</body>
</section>
<section>
<title>Tunnelling (Туннелирование)</title>
<body>

<p>
Вам не нужно ничего устанавливать для туннелирования, так как обработчик 
интерфейса может это делать.
</p>

<pre caption="Tunnelling configuration in /etc/conf.d/net">
<comment># Для GRE туннелей</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># Для IPIP туннелей</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># Для конфигурации интерфейса</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" )
</pre>

</body>
</section>
<section>
<title>VLAN (поддержка 802.1q)</title>
<body>

<p>
Для поддержки VLAN - установите <c>net-misc/vconfig</c>.
</p>

<p>
Виртуальная LAN - это группа сетевых устройств, которые ведут себя, как будто 
они соединены в сегмент одной сети - даже если они не соединены. Члены VLAN 
могут видеть только членов той же самой VLAN даже если они доступны в одной и 
той же физический сети.
</p>

<pre caption="VLAN configuration in /etc/conf.d/net">
<comment># Отмечаем номера VLAN для интерфейса</comment>
<comment># Пожалуйста, убедитесь, что ваши VLAN ID установлены НЕ в ноль</comment>
vlans_eth0="1 2"

<comment># Вы можете так же настроить VLAN</comment>
<comment># посмотрите man vconfig для больших деталей</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># Настраиваем интерфейс как обычно</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Для использования некоторых настроек VLAN, вам возможно потребуется 
проконсультироваться с документацией по <uri 
link="?part=4&amp;chap=2#variable_name">variable name</uri>.
</impo>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-version: 1.7-r1
target-date: 2006-01-23
source-cvs-revision: 1.13
translated-by: Analyzer <subscribe2k@yandex.ru>
edited-by: none
-->
