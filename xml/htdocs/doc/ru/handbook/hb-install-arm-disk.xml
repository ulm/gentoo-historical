<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/handbook/hb-install-arm-disk.xml,v 1.1 2013/04/11 07:00:13 swift Exp $ -->

<sections>

<version>1</version>
<date>2013-02-23</date>

<!-- TODO: Add section about MTD and such -->

<section>
<title>Общие сведения о блочных устройствах</title>

<subsection>
<include href="hb-install-blockdevices.xml"/>
</subsection>

<subsection>
<title>Разделы</title>
<body>

<p>
Хотя теоретически для размещения системы Linux диск можно использовать целиком, 
так почти никогда не делают на практике. Вместо этого большое физическое блочное 
устройство разбивают на меньшие блочные устройства, более удобные для обращения. 
В архитектуре <keyval id="arch"/> они называются <e>разделами</e>. 
</p>

<p>
Существуют разделы трех типов: <e>первичные</e> (primary), <e>расширенные</e> 
(extended) и <e>логические</e> (logical). 
</p>

<p>
<e>Первичный</e> раздел — это раздел, информация о котором хранится в MBR 
(Master Boot Record — главной загрузочной записи). Так как MBR очень мала 
(512 байт), можно определять всего четыре первичных раздела 
(например, от <path>/dev/sda1</path> до <path>/dev/sda4</path>). 
</p>

<p>
<e>Расширенный</e> раздел — это особый первичный раздел (имеется в виду, 
что расширенный раздел должен быть одним из четырех возможных первичных 
разделов), в котором содержатся другие разделы. Таких разделов изначально 
не существовало, но их введение помогло расширить существующую схему 
разметки без потери совместимости, как только четырех разделов перестало хватать. 
</p>

<p>
<e>Логический раздел</e> — это раздел, входящий в расширенный раздел. Его 
определение находится не в MBR, а внутри расширенного раздела. 
</p>

</body>
</subsection>
</section>
<section>
<title>Разработка схемы разбиения диска</title>
<subsection>
<title>Схема разбиения по умолчанию</title>
<body>

<warn>
Прошивка NetWinder, NeTTrom умеет надежно читать только разделы ext2, поэтому
вам обязательно нужно определить отдельный загрузочный раздел с файловой
системой ext2.
</warn>

<p>
Если вам не интересно заниматься разработкой схемы для своей системы, 
можно воспользоваться схемой, используемой в этой книге: 
</p>

<table>
<tr>
  <th>Раздел</th>
  <th>Файловая система</th>
  <th>Размер</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><path>/dev/sda1</path></ti>
  <ti>ext2</ti>
  <ti>32M</ti>
  <ti>загрузочный раздел</ti>
</tr>
<tr>
  <ti><path>/dev/sda2</path></ti>
  <ti>(swap)</ti>
  <ti>512M</ti>
  <ti>раздел подкачки</ti>
</tr>
<tr>
  <ti><path>/dev/sda3</path></ti>
  <ti>ext4</ti>
  <ti>оставшаяся часть диска </ti>
  <ti>корневой раздел</ti>
</tr>
</table>

<p>
Если вам интересно узнать, какого размера должны быть разделы, и сколько их 
вам вообще может потребоваться, читайте дальше. В противном случае 
приступайте к созданию разделов, описанному в главе 
<uri link="#fdisk">использование fdisk для создания разделов</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Сколько и каких именно?</title>
<body>

<p>
Количество разделов очень сильно зависит от назначения системы. Например, если 
у вас много пользователей, вам, скорее всего, захочется отделить <path>/home</path> 
для повышения безопасности и упрощения резервного копирования. Если вы 
устанавливаете Gentoo в роли почтового сервера, следует отделить <path>/var</path>, 
т.к. вся почта хранится там. Затем, правильно выбрав файловую систему, вы добьетесь 
максимальной производительности. Для игровых серверов потребуется отдельный раздел 
<path>/opt</path>, так как большинство программ для их работы устанавливается туда. 
Причины выделения те же, что и для <path>/home</path>: безопасность и резервное 
копирование. Определенно не помешает побольше места для <path>/usr</path>: не только 
потому, что там хранится большинство приложений, а еще из-за того, что лишь дерево 
Portage, не считая размещенных в нем архивов с исходными кодами, занимает около 500 МБ.
</p>

<p>
Как видите, все зависит от ваших целей. Наличие отдельных разделов или томов имеет 
следующие плюсы:
</p>

<ul>
<li>
  для каждого раздела или тома можно выбрать наиболее подходящую файловую систему
</li>
<li>
  свободное место во всей системе не кончится из-за того, что одна-единственная 
  сбойная программа постоянно записывает файлы в раздел или том
</li>
<li>
  необходимая проверка файловых систем будет занимать меньше времени, т.к. 
  проверка разных разделов может выполняться параллельно (еще больший выигрыш 
  времени дает использование нескольких физических дисков)
</li>
<li>
  можно повысить безопасность системы, монтируя часть разделов в режиме 
  read-only (только для чтения), nosuid (игнорируется бит setuid), noexec 
  (игнорируется бит исполнения) и т.д.
</li>
</ul>

<p>
Однако у множества разделов также есть недостатки. Если они не сконфигурированы 
правильно, у вас будет система с огромным количеством свободного места на 
одном разделе и отсутствием его на другой. Другой проблемой является то, что 
отдельные разделы, особенно для важных точек монтирования, например 
<path>/usr</path> или <path>/var</path>, часто требуют загрузки некоторого 
кода в ОЗУ, чтобы смонтировать разделы прежде чем запустятся другие 
загрузочные скрипты. Это не всегда является проблемой, так что результаты 
могут быть разные.
</p>

<p>
Также существует лимит в 15 разделов для SCSI и SATA.
</p>

<p>
Для примера мы покажем разбиение диска объемом 20ГБ, используемого в 
демонстрационном ноутбуке (с веб-сервером, почтовым сервером, средой Gnome и т.д.): 
</p>

<pre caption="Пример файловой системы">
$ <i>df -h</i>
Filesystem    Type    Size  Used Avail Use% Mounted on
/dev/sda5     ext4    509M  132M  351M  28% /
/dev/sda2     ext4    5.0G  3.0G  1.8G  63% /home
/dev/sda7     ext4    7.9G  6.2G  1.3G  83% /usr
/dev/sda8     ext4   1011M  483M  477M  51% /opt
/dev/sda9     ext4    2.0G  607M  1.3G  32% /var
/dev/sda1     ext2     51M   17M   31M  36% /boot
/dev/sda6     swap    516M   12M  504M   2% &lt;не смонтировано&gt;
<comment>(свободное место для будущего использования: 2 GB)</comment>
</pre>

<p>
Раздел <path>/usr</path>, как видим, почти заполнен (использовано 83%), но 
когда все программы установлены, <path>/usr</path> растет не слишком 
быстро. Хотя отведение нескольких гигабайт дискового пространства для 
<path>/var</path> может показаться расточительством, помните, что этот 
раздел по умолчанию используется Portage для компиляции пакетов. 
Если вы захотите удержать <path>/var</path> в рамках более разумного 
размера, например, 1ГБ, вам потребуется изменить переменную <c>PORTAGE_TMPDIR</c> 
в <path>/etc/portage/make.conf</path>, чтобы она указывала на раздел, 
где достаточно свободного места для компиляции чрезвычайно больших 
пакетов, таких как OpenOffice. 
</p>

</body>
</subsection>
</section>
<section id="fdisk">
<title>Использование fdisk для создания разделов</title>
<subsection>
<body>

<p>
В следующих разделах описывается, как разбить диск в соответствии с 
примерной схемой, которая была описана ранее: 
</p>

<table>
<tr>
  <th>Раздел</th>
  <th>Описание</th>
</tr>
<tr>
  <ti><path>/dev/sda1</path></ti>
  <ti>Загрузочный раздел</ti>
</tr>
<tr>
  <ti><path>/dev/sda2</path></ti>
  <ti>Раздел подкачки</ti>
</tr>
<tr>
  <ti><path>/dev/sda3</path></ti>
  <ti>Корневой раздел</ti>
</tr>
</table>

<p>
Эту схему вы можете изменять по своему усмотрению.
</p>

</body>
</subsection>
<subsection>
<title>Просмотр текущей схемы разбиения диска</title>
<body>

<p>
<c>fdisk</c> — это популярная и очень мощная утилита для создания разделов 
на ваших дисках. Запустите <c>fdisk</c>, указав свой диск в качестве 
параметра (в примере мы используем <path>/dev/sda</path>): 
</p>

<pre caption="Запуск fdisk">
# <i>fdisk /dev/sda</i>
</pre>

<p>
После запуска <c>fdisk</c> выдаст такое приглашение: 
</p>

<pre caption="Приглашение fdisk">
Command (m for help): 
</pre>

<p>
Нажмите <c>p</c>, чтобы вывести текущую схему разбиения диска: 
</p>

<pre caption="Пример схемы разделов диска">
Command (m for help): <i>p</i>

Disk /dev/sda: 240 heads, 63 sectors, 2184 cylinders
Units = cylinders of 15120 * 512 bytes

Device Boot    Start       End    Blocks   Id  System
/dev/sda1             1        14    105808+  83  Linux
/dev/sda2            15        49    264600   82  Linux swap
/dev/sda3            50        70    158760   83  Linux
/dev/sda4            71      2184  15981840    5  Extended
/dev/sda5            71       209   1050808+  83  Linux
/dev/sda6           210       348   1050808+  83  Linux
/dev/sda7           349       626   2101648+  83  Linux
/dev/sda8           627       904   2101648+  83  Linux
/dev/sda9           905      2184   9676768+  83  Linux

Command (m for help): 
</pre>

<p>
В данном случае на диске есть семь разделов Linux (для которых 
в графе System указано Linux) и один раздел подкачки (в списке показан 
как Linux swap). 
</p>

</body>
</subsection>
<subsection>
<title>Удаление всех разделов</title>
<body>

<p>
Сначала удалим с диска все существующие разделы. Для удаления раздела 
вводите <c>d</c>. Например для удаления существующего <path>/dev/sda1</path>: 
</p>

<pre caption="Удаление раздела">
Command (m for help): <i>d</i>
Partition number (1-4): <i>1</i>
</pre>

<p>
Удаление раздела будет запланировано. Он больше не будет отображаться при вводе 
<c>p</c>, но фактически не будет удалятся до тех пор, пока вы не сохраните 
внесенные изменения. Если вы ошиблись и хотите прервать разбиение без 
сохранения изменений, немедленно введите <c>q</c> и нажмите ENTER; тогда ваш 
раздел сохранится в неизменном виде. 
</p>

<p>
Теперь, если вы действительно собираетесь удалить в своей системе все разделы, 
повторяйте ввод <c>p</c> для показа оставшихся разделов, затем <c>d</c> и 
номера удаляемого раздела до тех пор, пока разделы не кончатся. В итоге 
вы получите пустую таблицу разделов: 
</p>

<pre caption="Пустая таблица разделов">
Disk /dev/sda: 30.0 GB, 30005821440 bytes
240 heads, 63 sectors/track, 3876 cylinders
Units = cylinders of 15120 * 512 = 7741440 bytes

Device Boot    Start       End    Blocks   Id  System

Command (m for help):
</pre>

<p>
Теперь, когда мы очистили таблицу разделов, хранящуюся в оперативной памяти, 
настало время создавать разделы. Мы воспользуемся примерной схемой разбиения, 
описанной выше. Естественно, не следуйте этим инструкциям буквально, если только 
вам не нужна таблица разделов, идентичная нашей! 
</p>

</body>
</subsection>
<subsection>
<title>Создание загрузочного раздела</title>
<body>

<p>
Сначала создадим маленький загрузочный раздел. Введите <c>n</c> для создания 
нового раздела, затем <c>p</c>, чтобы выбрать первичный раздел, и <c>1</c> для 
указания первого первичного раздела. На вопрос о первом цилиндре нажмите ввод. 
На вопрос о последнем цилиндре введите <c>+32M</c>, чтобы создать раздел 
размером 32МБ:
</p>

<pre caption="Создание загрузочного раздела">
Command (m for help): <i>n</i>
Command action
  e   extended
  p   primary partition (1-4)
<i>p</i>
Partition number (1-4): <i>1</i>
First cylinder (1-3876, default 1): <comment>(Hit Enter)</comment>
Using default value 1
Last cylinder or +size or +sizeM or +sizeK (1-3876, default 3876): <i>+32M</i>
</pre>

<p>
Теперь, введя <c>p</c>, вы должны увидеть следующий текст: 
</p>

<pre caption="Созданный загрузочный раздел">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.0 GB, 30005821440 bytes
240 heads, 63 sectors/track, 3876 cylinders
Units = cylinders of 15120 * 512 = 7741440 bytes

Device Boot    Start       End    Blocks   Id  System
/dev/sda1          1        14    105808+  83  Linux
</pre>

<p>
Нам необходимо сделать этот раздел загружаемым. Введите <c>a</c> для включения 
признака загрузки с раздела, затем нажмите <c>1</c>. Если снова ввести <c>p</c>, 
можно увидеть, что в столбце Boot появился знак <path>*</path>. 
</p>

</body>
</subsection>
<subsection>
<title>Создание раздела подкачки</title>
<body>

<p>
Теперь создадим раздел подкачки. Для этого введите <c>n</c> (создание нового 
раздела), затем <c>p</c> для выбора первичного раздела. Потом нажмите <c>2</c>, 
чтобы создать второй первичный раздел, в нашем случае <path>/dev/sda2</path>. 
На вопрос о первом цилиндре просто нажмите ввод. На вопрос о последнем — 
ответьте <c>+512M</c>, чтобы создать раздел размером 512МБ. Сделав это, введите 
<c>t</c> для указания типа раздела, <c>2</c>, для выбора только что созданного 
раздела, и <c>82</c>, чтобы установить тип раздела "Linux Swap". При нажатии 
<c>p</c> по завершении этих действий, таблица разделов должна выглядеть примерно так: 
</p>

<pre caption="Список разделов после создания раздела подкачки">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.0 GB, 30005821440 bytes
240 heads, 63 sectors/track, 3876 cylinders
Units = cylinders of 15120 * 512 = 7741440 bytes

Device Boot    Start       End    Blocks   Id  System
/dev/sda1 *        1        14    105808+  83  Linux
/dev/sda2         15        81    506520   82  Linux swap
</pre>

</body>
</subsection>
<subsection>
<title>Создание корневого раздела</title>
<body>

<p>
Теперь создадим корневой раздел. Для этого введите <c>n</c> (создание нового 
раздела), затем <c>p</c> (первичный раздел). После этого нажмите <c>3</c> для 
создания третьего первичного раздела, в нашем случае <path>/dev/sda3</path>. 
На вопрос о первом цилиндре нажмите ввод. На вопрос о последнем — также 
нажмите ввод, чтобы раздел занял все оставшееся свободное место на диске. 
По завершении этих шагов, при вводе <c>p</c> должна выводиться подобная таблица разделов: 
</p>

<pre caption="Список разделов после создания корневого раздела">
Command (m for help): <i>p</i>

Disk /dev/sda: 30.0 GB, 30005821440 bytes
240 heads, 63 sectors/track, 3876 cylinders
Units = cylinders of 15120 * 512 = 7741440 bytes

Device Boot    Start       End    Blocks   Id  System
/dev/sda1 *        1        14    105808+  83  Linux
/dev/sda2         15        81    506520   82  Linux swap
/dev/sda3         82      3876  28690200   83  Linux
</pre>

</body>
</subsection>
<subsection>
<title>Сохранение схемы разбиения</title>
<body>

<p>
Для сохранения схемы разбиения и выхода из <c>fdisk</c>, введите <c>w</c>. 
</p>

<pre caption="Сохранение и выход из fdisk">
Command (m for help): <i>w</i>
</pre>

<p>
Теперь, создав все разделы, перейдем к 
<uri link="#filesystems">Созданию файловых систем</uri>.
</p>

</body>
</subsection>
</section>
<section id="filesystems">
<title>Создание файловых систем</title>
<subsection>
<title>Введение</title>
<body>

<p>
Разделы созданы, настало время разместить на них файловые системы. 
Если вам безразлично, какую файловую систему использовать, и вы вполне довольны 
той, что мы предлагаем в книге по умолчанию, переходите к 
<uri link="#filesystems-apply">размещению файловой системы в разделе</uri>. 
Если нет, читайте дальше, чтобы разузнать о существующих файловых системах... 
</p>

</body>
</subsection>

<subsection>
<include href="hb-install-filesystems.xml"/>
</subsection>

<subsection id="filesystems-apply">
<title>Размещение файловой системы в разделе</title>
<body>

<p>
Для создания в разделе или томе файловой системы каждого типа существуют 
специальные средства: 
</p>

<table>
<tr>
  <th>Файловая система</th>
  <th>Команда создания</th>
</tr>
<tr>
  <ti>ext2</ti>
  <ti><c>mkfs.ext2</c></ti>
</tr>
<tr>
  <ti>ext3</ti>
  <ti><c>mkfs.ext3</c></ti>
</tr>
<tr>
  <ti>ext4</ti>
  <ti><c>mkfs.ext4</c></ti>
</tr>
<tr>
  <ti>reiserfs</ti>
  <ti><c>mkreiserfs</c></ti>
</tr>
<tr>
  <ti>xfs</ti>
  <ti><c>mkfs.xfs</c></ti>
</tr>
<tr>
  <ti>jfs</ti>
  <ti><c>mkfs.jfs</c></ti>
</tr>
</table>

<p>
Например, чтобы у загрузочного раздела (<path>/dev/sda1</path> в наших примерах) 
была файловая система ext2, а у корневого раздела (<path>/dev/sda3</path> в 
наших примерах) — ext4, требуется выполнить: 
</p>

<pre caption="Создание файловых систем разделов">
# <i>mkfs.ext2 /dev/sda1</i>
# <i>mkfs.ext4 /dev/sda3</i>
</pre>

<p>
Теперь самостоятельно создайте файловые системы на своих только что 
созданных разделах (или логических томах). 
</p>

</body>
</subsection>
<subsection>
<title>Подключение раздела подкачки</title>
<body>

<p>
<c>mkswap</c> — команда, используемая для инициализации разделов подкачки: 
</p>

<pre caption="Создание идентификатора раздела подкачки">
# <i>mkswap /dev/sda2</i>
</pre>

<p>
Для подключения раздела подкачки воспользуйтесь <c>swapon</c>: 
</p>

<pre caption="Подключение раздела подкачки">
# <i>swapon /dev/sda2</i>
</pre>

<p>
Теперь командами, приведенными выше, создайте и подключите раздел 
подкачки в своей системе. 
</p>

</body>
</subsection>
</section>
<section>
<title>Монтирование</title>
<body>

<p>
Теперь, когда разделы созданы, а файловые системы размещены, настало время 
смонтировать (подключить к системе) эти разделы. Используйте команду <c>mount</c>. 
Не забудьте создать для каждого раздела соответствующие каталоги монтирования. 
Например, смонтируем корневой и загрузочный разделы: 
</p>

<pre caption="Монтирование разделов">
# <i>mount /dev/sda3 /mnt/gentoo</i>
# <i>mkdir /mnt/gentoo/boot</i>
# <i>mount /dev/sda1 /mnt/gentoo/boot</i>
</pre>

<note>
Если вы хотите разместить каталог <path>/tmp</path> в отдельном разделе, не 
забудьте изменить права доступа к этому каталогу после монтирования: 
<c>chmod 1777 /mnt/gentoo/tmp</c>. Это также относится к <path>/var/tmp</path>. 
</note>

<p>
Еще нам потребуется смонтировать файловую систему proc (виртуальный интерфейс ядра) 
в каталог <path>/proc</path>. Но сначала надо поместить в разделы нужные файлы. 
</p>

<p>
Переходите к <uri link="?part=1&amp;chap=5">установке установочных файлов Gentoo</uri>.
</p>

</body>
</section>
</sections>

<!-- *$Localization:
target-language: Russian
target-date: 2013-02-23
source-cvs-revision: 1.16
translated-by:  Vladimir Romanov [blueboar2@gmail.com]
-->
