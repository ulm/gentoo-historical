<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/en/security/shb-kernel.xml,v 1.3 2006/09/18 09:22:48 neysx Exp $ -->
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<sections>

<version>1.1</version>
<date>2006-08-03</date>

<section>
<title>Удаление функциональности</title>
<body>

<p>
Основное правило при конфигурации ядра &mdash; удалять все ненужное. Это не
только создаст маленькое ядро, но и также исключит вероятные уязвимости,
которые могут присутствовать в драйверах и других возможностях.
</p>

<p>
Также рекомендуется отключить поддержку загружаемых модулей. Хотя возможность
внедрения руткитов сохраняется, это делает систему более неприступной для
обычного злоумышленника, пытающегося установить руткит в виде модуля ядра.
</p>

</body>
</section>
<section>
<title>Файловая система proc</title>
<body>

<p>
Множество параметров ядра может быть изменено с помощью файловой системы
<path>/proc</path> или <c>sysctl</c>.
</p>

<p>
Чтобы иметь возможность на лету изменять параметры и переменные ядра, вам
понадобится определить в ядре <c>CONFIG_SYSCTL</c>. Она включена по умолчанию в
ядрах серии 2.4.
</p>

<pre caption="Отключения IP-форвардинга">
# <i>/bin/echo "0" &gt; /proc/sys/net/ipv4/ip_forward</i>
</pre>

<p>
Проверьте, что проброс IP-пакетов отключен. Эта возможность необходима лишь
для узла, имеющего доступ к нескольким сетям. Рекомендуется устанавливать и
отключать этот флаг до включения или отключения других флагов.
</p>

<pre caption="Отбрасывание пакетов ping">
# <i>/bin/echo "1" > /proc/sys/net/ipv4/icmp_echo_ignore_all</i>
</pre>

<p>
Это просто заставит ядро игнорировать все сообщения ping (ICMP-пакеты типа
0). IP-пакет, несущий ICMP-сообщение, может содержать также в нагрузку и другую
информацию, о которой вы можете не подозревать, поэтому следует отключить
прием. Администраторы используют ping как утилиту диагностики и часто выражают
недовольство, если она отключена, но нет причины позволять чужакам пинговать
узел. Тем не менее, если необходимо разрешить внутренним пользователям
использовать ping, то можно отключить сообщения ICMP типа 0 в межсетевом экране
(тем самым позволив локальным администраторам использовать эту утилиту).
</p>

<pre caption="Игнорирование широковещательных запросов ping">
# <i>/bin/echo "1" &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts</i>
</pre>

<p>
Это отключает ответ на широковещательные ICMP-запросы, предотвращая реализацию
Smurf-атаки. Smurf-атака основана на отправке ICMP-пакета типа 0 (ping) по
широковещательному адресу сети. Обычно для этого злоумышленник использует
поддельный адрес. Все компьютеры сети ответят на сообщение ping, что может
вызвать наводнение трафика на узел, адрес которого был подделан.
</p>

<pre caption="Отключение исходящих маршрутизированных пакетов.">
# <i>/bin/echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_source_route</i>
</pre>

<p>
Не принимать исходящие маршрутизированные пакеты. Злоумышленники могут
использовать исходящую маршрутизацию для генерации трафика, имеющего адрес
внутренней сети, но на самом деле возвращаемого назад злоумышленнику, что
позволит ему компрометировать сеть. Исходящая маршрутизация очень редко
используется по назначению, так что безопаснее ее отключить.
</p>

<pre caption="Отключение приема перенаправлений">
# <i>/bin/echo "0" &gt; /proc/sys/net/ipv4/conf/all/accept_redirects</i>
# <i>/bin/echo "0" &gt; /proc/sys/net/ipv4/conf/all/secure_redirects</i>
</pre>

<p>
Не принимать ICMP-пакеты перенаправления. ICMP-перенаправления могут быть
использованы злоумышленником для изменения таблиц маршрутизации.
</p>

<pre caption="Защита против неправильных сообщений об ошибках">
# <i>/bin/echo "1" &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses</i>
</pre>

<p>
Включить защиту против приходящих неправильных сообщений об ошибках.
</p>

<pre caption="Включение фильтрации обратного пути">
# <i>for i in /proc/sys/net/ipv4/conf/*; do
        /bin/echo "1" &gt; $i/rp_filter
done</i>
</pre>

<p>
Включает фильтрацию обратного пути. Это поможет быть уверенным, что в пакетах
используются правомерные адреса, при этом входящие пакеты будут автоматически
отброшены, если запись в таблице маршрутизации об адресе этих пакетов не
соответствуют сетевому интерфейсу, с которого они пришли. Это позволит
предотвратить подделку IP-адресов. Необходимо включить эту возможность для
каждого <path>net/ipv4/conf/*</path>, иначе проверка исходящих пакетов не будет
полностью функционировать.
</p>

<warn>
Тем не менее включение фильтрации обратного пути может стать проблемой при
использовании асимметричной маршрутизации (исходящие пакеты идут отличным от
входящих пакетов путем) или при использовании немаршрутизируемом узле с
несколькими IP-адресами на различных интерфейсах.
</warn>

<pre caption="Регистрация всех поддельных, исходящих маршрутизированных и перенаправленных пакетов">
# <i>/bin/echo "1" &gt; /proc/sys/net/ipv4/conf/all/log_martians</i>
</pre>

<p>
Регистрировать поддельные пакеты, пакеты с исходящей маршрутизацией и пакеты
перенаправлений.
</p>

<p>
Все настройки будут сброшены после перезагрузки компьютера. Рекомендуется
добавлять их в <path>/etc/sysctl.conf</path>, который будет автоматически
загружен сценарием инициализации <path>/etc/init.d/bootmisc</path>.
</p>

<p>
Синтаксис <path>/etc/sysctl.conf</path> достаточно понятный. Удалите из
указанных путей <path>/proc/sys/</path> и замените <path>/</path> на
<path>.</path>:
</p>

<pre caption="Переход к файлу sysctl.conf">
<comment>(Вручную с помощью команды echo:)</comment>
/bin/echo "0" &gt; /proc/sys/net/ipv4/ip_forward

<comment>(Автоматически в файле sysctl.conf:)</comment>
net.ipv4.ip_forward = 0
</pre>

</body>
</section>
<section>
<title>Grsecurity</title>
<body>

<p>
Заплатка от <uri link="http://grsecurity.net">Grsecurity</uri> входит в
<c>sys-kernel/hardened-sources</c>, но по умолчанию отключена. Сначала
сконфигурируйте ядро, а затем настройте параметры Grsecurity. Подробное
описание доступных параметров Grsecurity можно найти на странице проекта
<uri link="/proj/en/hardened">укрепленного Gentoo</uri>.
</p>

<p>
Последние версии <c>hardened-sources</c> содержат Grsecurity версии 2.*. Для
дополнительной информации о наборе патчей Grsecurity обратитесь к
документации, доступной на <uri link="http://www.grsecurity.net/">домашнем
сайте Grsecurity</uri>.
</p>

</body>
</section>
<section>
<title>Kerneli</title>
<body>

<p>
<uri link="http://www.Kerneli.org">Kerneli</uri> &mdash; это заплатка, которая
добавляет функции шифрования к существующему ядру. Наложив эту заплатку на
ядро, вы получите такие новые параметры, как алгоритмы шифрования, дайджеста и
фильтры к зашифрованным образам.
</p>

<warn>
В настоящий момент заплатка kerneli для последнего ядра нестабильна, поэтому
будьте осторожны при ее использовании.
</warn>

</body>
</section>
<section>
<title>Другие заплатки к ядру</title>
<body>

<ul>
  <li><uri link="http://www.openwall.com">Проект OpenWall</uri></li>
  <li>
    <uri link="http://www.lids.org">Linux Intrusion Detection System</uri>
  </li>
  <li><uri link="http://www.rsbac.org">Rule Set Based Access Control</uri></li>
  <li>
    <uri link="http://www.nsa.gov/selinux">NSA's security enhanced kernel</uri>
  </li>
  <li><uri link="http://sourceforge.net/projects/wolk/">Wolk</uri></li>
</ul>

<p>
И множество других.
</p>

</body>
</section>
</sections>
