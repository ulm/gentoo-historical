<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet href="/xsl/guide.xsl" type="text/xsl"?>

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/ru/desktop.xml">
<title>Руководство по настройке "рабочего окружения" в Gentoo Linux</title>
<author title="Author"><mail link="zhen@gentoo.org">John P. Davis</mail></author>
<author title="Author"><mail link="g2boojum@gentoo.org">Grant Goodyear</mail></author>
<author title="Переводчик"><mail link="yuribff@wolf.istc.kiev.ua">Юрий Борисов</mail></author>

<abstract>Это руководство показывает, как настроить Gentoo Linux в качестве
полноценной настольной системы. А именно, мы пройдем по установкам и
настройкам X, KDE, GNOME, OSS (звук), postfix (электронная почта), и
samba (взаимодействие unix/windows).</abstract>

<version>1.4.2</version>
<date>14 April 2003</date>

<chapter>
<title>Предварительные замечания</title>
<section>

<body>

<p>Необходимо сказать, что для начала вы должны иметь установленный
Gentoo Linux (<uri>http://www.gentoo.org/doc/en/build.xml</uri>).
После окончания этого довольно приятного процесса, вы должны загрузить
дерево <e>Портэджей</e>. Настоятельно рекомендуется прочесть
Руководство по работе с portage
(<uri>http://www.gentoo.org/doc/en/portage-user.xml</uri>), но если Вы
очень спешите, то просто можете набрать следующую команду:</p>

<pre caption = "Получение актуальных версий.">
# <c>emerge sync</c>
</pre>

<p>Коротко о пакетах, о которых рассказывается в данном руководстве.
Gentoo Linux имеет богатый выбор оконных менеджеров, MTA, и других
программ, которые могут быть легко установлены. Пакеты, которые
описываются в данном документе не являются предпочтительными для
использования в Gentoo Linux, это пакеты, которые просто нравятся
автору и/или он знает, как они настраиваются. Другими словами, это
пакеты, с которыми автор работает на собственной машине.</p>

<impo> В зависимости от типа рабочего окружения, которое Вы хотите
установить, Вы можете отключить поддержку оконных менеджеров, которые
вы не будете использовать, в файле <path>/etc/make.conf</path>. В
секции <i>USE</i>, добавьте <e>-gnome -gtk</e> если Вы используете
KDE, или <e>-kde -qt</e> если GNOME.</impo>

<warn>Если вы столкнетесь с ошибкой в любом из этих пакетов, сообщите
о ней в <uri>http://bugs.gentoo.org/</uri>. <e>НЕ СООБЩАЙТЕ</e> о ней
мэйнтэйнерам данного пакета (например KDE), если потребуется,
разработчики Gentoo передадут сообщение об ошибке сами.</warn>

</body>
</section>
</chapter>

<chapter>
<title>Установка XFree86</title>
<section>
<title>Установка</title>

<body>

<p>Установка (emerge) XFree86 занимает достаточно много времени даже
на быстрой системе. Программа большая, так что, в процессе установки
вы сможете почитать книгу, вздремнуть, и т.д.</p>

<p>Для установки X, все что Вам надо сделать это набрать:</p> 

<pre caption = "Установка XFree86">
# <c>emerge xfree</c>
</pre>

<p>После этого довольно длительного процесса начинается конфигурация.</p>

</body>
</section>

<section>
<title>Конфигурация XFree86</title>

<body>

<p>Я предпочитаю использовать консольную программу <c>xf86config</c>
для конфигурации XFree86, хотя генерируемый ею файл
<path>/etc/X11/XF86Config</path> выглядит не очень элегантно -- смотри
<uri link="http://www-105.ibm.com/developerworks/education.nsf/linux-onlinecourse-bytitle/3100FF4795B3F31F86256AF70056FDB3?OpenDocument">это
руководство</uri> по альтернативной и более полной (тонкой) настройке
XFree86. Перед началом, вы должны узнать вертикальную и горизонтальную
частоту развертки вашего монитора (Мой viewsonic G773 имеет
Горизонтальную: 30-69 КГц, Вертикальную: 55-90 Гц), тип (модель) и
количество памяти (в KB) в вашей видео карте (32768 KB GeForce, в моём
случае), тип (модель) и к какому типу порта подключена ваша мышь
(intellimouse включенная в ps/2 порт <path>/dev/psaux</path>).</p>

<pre caption = "Запуск xf86config">
# <c>/usr/X11R6/bin/xf86config</c>
</pre>

<p>Так как у меня трех-кнопочная мышь, я не использую режим эмуляции
третьей кнопки. Не забудьте включить поддержку XKB, если Вы
используете интернациональные клавиатуру или Вам необходима поддержка
нескольких языков. Вы должны выставить разрешение экрана и глубину
цветности на свой вкус. Я использую 1280x1024 при 24бит на моем
viewsonic, но это только потому, что он не работает в более высоких
разрешениях. Если вы не делали такого раньше, не удивляйтесь что
работа с <c>xf86config</c> заняла много времени.</p>

<note>Если Вы не знаете частоты развёртки вашего монитора,
воспользуйтесь поиском в google, <uri>http://www.google.com/</uri>, по
номеру модели и производителю Вашего монитора. Частоты развёртки
обычно даются в спецификациях на монитор.</note>

<p>Если Вы ветеран в настройке XFree86, то Вы можете сделать
символическую ссылку с мыши на <path>/dev/mouse</path>. Такие
символические ссылки имели некоторые проблемы с devfs, они пропадали
после перезагрузки. Теперь Gentoo Linux взаимодействует с
<path>/dev</path> корректно. Просто сделайте символьную ссылку на
/dev/mouse с помощью <c>ln -s</c> и она будет <e>сохранена</e> после
перезагрузки.</p>

<p>Если Вы хотите использовать XFS (XFontServer), следуйте 
приведённым ниже инструкциям. Использование XFS настоятельно 
рекомендуется, так как делает настройку шрифтов <e>намного</e> легче. 
Обратитесь к этой статье о XFS на сайте <uri link="http://www.redhat.com/docs/manuals/linux/RHL-7.3-Manual/ref-guide/s1-x-fonts.html">RedHat</uri>.</p>

<pre caption = "Тестирование Ваших настроек">
# <c>rc-update add xfs default</c>
# <c>/etc/init.d/xfs start</c>
# <c>startx</c>
</pre>

<p>Если Вы сконфигурировали XFree86 правильно, после запуска startx
стартует достаточно гадкий оконный менеджер (twm, если быть
точным). Если Xы подымутся, то Вы можете двигаться дальше. Нажмите
<c>&lt;ctrl&gt;&lt;alt&gt;&lt;backspace&gt;</c> для остановки X сервера.</p>

<p>xf86config создаёт только базовые конфигурационные настройки. Видео
карты на чипах NVIDIA, USB мыши и многие другие установки должны быть
сделаны вручную. Я расскажу об этих функциях ниже, но советую Вам
посмотреть в файл XF86Config.Он не сильно зашифрован, и Вы можете
найти в нём некоторые интересные настройки.  Хорошее место для
получения информации о тонкой настройке находится <uri link="http://www.tldp.org/HOWTO/mini/FDU/">здесь</uri>.</p>

</body>
</section>

<section>
<title>Настройка PS/2 мыши</title>

<body>

<p>Если у Вас мышь с колесом, то отредактируйте файл XF86Config вручную:</p> 

<pre caption = "Редактирование файла XF86Config">
# <i>cp /etc/X11/XF86Config /etc/X11/XF86Config.working</i>
# <i>vim /etc/X11/XF86Config</i>
</pre>

<pre caption="Раздел Pointer section в XF86Config">
Section "InputDevice"

#Identifier and driver

Identifier	"Mouse1"
Driver	"mouse"
<i>Option "Protocol"    "IMPS/2" </i>
Option "Device"      "/dev/psaux"
<i>Option "ZAxisMapping"	"4 5"</i>
</pre>

<p>Так как у меня intellimouse, я изменяю "протокол" с "PS/2" на 
"IMPS/2". Включение прокрутки с помощью колеса требует добавления 
строки 'Option "ZAxisMapping" "4 5"', где '4' и '5' сообщает мыши о 
прокрутке вверх\вниз.</p>

<note>В Netscape 4.x прокрутка не работает по умолчанию; 
для начала Вы должны создать файл .Xdefaults. Как это сделать 
смотрите <uri link="http://www-sop.inria.fr/koala/colas/mouse-wheel-scroll/">тут</uri>. Но лучше используйте <c>konqueror</c>, <c>opera</c>, <c>mozilla</c>, 
<c>galeon</c>, или другой броузер.</note>

<p>Запустите <c>startx</c> снова и убедитесь, что XFree86 запускаются.</p> 

</body>
</section>

<section>
<title>Настройка USB мыши</title>

<body>

<p>USB мышь это ваш друг при работе в высоких разрешениях экрана. Ядро
следит за масштабированием, что бы Вам не нужно было водить мышкой
пять раз по коврику для перемещения курсора через весь экран.</p>

<p>Первое, что должно быть сделано, инсталляция модулей ядра. Модули
необходимые для работы USB мыши это <i>usbmouse</i>, <i>mousedev</i>,
<i>hid</i>, <i>usbcore</i>, <i>usb-uhci</i>, и <i>input</i>. После
окончания необходимой настройки, подключите модули командой
<i>insmod</i>.</p>

<note>Используйте <i>usbmouse</i> <b>ИЛИ</b> <i>hid</i>. Если Вы
установите оба модуля, мышь перестанет работать.</note>

<note>Когда будете настраивать поддержку Input Core для мыши,
установите то же разрешение экрана которое вы будете использовать в
XFree86. Это сделает масштабирование удобным и правильным.</note>

<p>Теперь, отключите мышь, включите обратно, и проверьте логи ядра на
предмет сообщения похожего на это</p>

<pre caption = "Сообщение ядра">
hub.c: USB new device connect on bus1/1, assigned device number 2
input0,hiddev0: USB HID v1.00 Mouse [Microsoft Microsoft IntelliMouse Optical] on usb1:2.0
</pre>

<p>Теперь, когда мышь определилась, проверьте <path>/dev/input</path> что бы
убедится ваша мышь присутствует и работает.</p>

<pre caption = "Проверка USB мыши">
# <c>cd /dev/input</c>
# <c>cat mice</c>
<comment>Подвигайте мышкой во время выполнения команды <i>cat</i>, Вы должны увидеть мусор на экране.</comment>
</pre>

<p>Как только мышь должным образом обнаружена и установлена, мы должны 
сказать XFree86 использовать USB мышь. Всё что для этого нужно, это 
сделать небольшие изменения в настройках XFree.</p>

<pre caption = "Редактирование XF86Config">
# <c>cp /etc/X11/XF86Config /etc/X11/XF86Config.working</c>
# <c>vim /etc/X11/XF86Config</c>
</pre>

<pre caption="Секция Pointer section в XF86Config">
Section "InputDevice"

# Identifier and driver

Identifier	"Mouse1"
Driver	"mouse"
<i>Option "Protocol"    "IMPS/2" </i>
Option "Device"      "/dev/input/mice"
<i>Option "ZAxisMapping"	"4 5"</i>

</pre>

<p>Окей, перезапустим XFree и мышь должна заработать!</p>

<p>Не забудьте добавить используемые Вашей мышью модули в <i>modules.autoload</i>.</p>

<pre caption = "Добавление модулей в modules.autoload">
# <c>echo $'/n'mousedev $'/n'hid #'/n'usbcore $'/n'input >> /etc/modules.autoload</c>
</pre>

</body>
</section>

<section>
<title>Настройка видео карт на чипах NVIDIA</title>

<body>
<p>Если вы обладатель карты от NVIDIA, сейчас самое время 
настроить драйвера NVIDIA с поддержкой акселерации.</p>

<note>Если Вы перекомпилируете ядро, Вы должны так же 
перекомпилировать <i>nvidia-kernel</i>. Это делается, потому что 
новое ядро не увидит модули nvidia принадлежащие старому ядру.</note>

<pre caption="Только для владельцев карт NVIDIA">
# <c>emerge nvidia-glx</c>
# <c>emerge nvidia-kernel</c>
# <c>nano -w /etc/X11/XF86Config</c>
# <c>echo "NVdriver" >> /etc/modules.autoload</c>
# <c>modprobe NVdriver</c>
</pre>

<pre caption="Включение GLX в /etc/X11/XF86Config">
Section "Module"

# This loads the GLX module
#    Load       "glx" <comment>(Раскоментируйте эту строку)</comment>
</pre>

<pre caption="Говорим XFree использовать драйвера NVIDIA в /etc/X11/XF86Config">
Section "Device"
	Identifier  "NVIDIA GeForce"
	#Driver      "nv"
	Driver      "nvidia"
	#VideoRam    32768
	# Insert Clocks lines here if appropriate
EndSection
</pre>

<p>Запустите <c>startx</c> опять, что бы убедится, что X работает (вы должны 
увидеть заставку с логотипом NVIDIA, если вы установили драйвера).</p>

</body>
</section>
</chapter>

<chapter>	
<title>Оконные менеджеры</title>

<section>
<title>Введение</title>
<body>

<p>Вообще то, первое, что происходит после установки XFree, это
установка симпатичного оконного менеджера. Конечно, вы можете,
остановится на tvm если вам нужен действительно убогий, в смысле
функциональности, оконный менеджер.</p>

<p>Существует много оконных менеджеров из которых Вы можете выбрать. Вот
некоторые из них KDE, GNOME, Fluxbox, Blackbox, другие *box 'ы,
Windowmaker, Sawfish, и т.д. Как Вы можете видеть, в Gentoo Linux
весьма приятный выбор оконных менеджеров.</p>

</body>
</section>

<section>
<title>KDE</title>
<body>

<p>Я предполагаю, что вы будете использовать KDE, если вы читаете этот
раздел. KDE полностью поддерживается в Gentoo Linux, но есть несколько
вещей, которые Вы должны проверить перед установкой KDE:</p>

<li>Убедитесь, что "qt" и "kde" установлены как переменные USE в файле
<i>make.conf</i>.</li>

<li>Убедитесь (не обязательно), что  "-gnome" и "-gtk" установлены как переменные USE в файле <i>make.conf.</i></li>

<p>Оба эти шага могут быть выполнены путём редактирования файла <path>/etc/make.conf</path> например, так:</p>

<pre caption = "Редактирование make.conf">
# <c>vim /etc/make.conf </c>
<comment>Inside of <i>make.conf</i></comment>

USE="qt kde -gnome -gtk"

</pre>

<p>Для получения информации о переменных USE, читайте <uri link="http://www.gentoo.org/doc/en/use-howto.xml">USE HOWTO</uri>.</p>

<p>Всегда полезно использовать ключ <c>--pretend</c> перед выполнением
<c>emerge</c> для того, что бы увидеть зависимомти устанавливаемого
пакета, в нашем случае их очень много.</p>

<pre caption = "Смотрим пакеты/зависимости для KDE">
# <c>emerge --pretend kde</c>
# <c>emerge kde</c>
</pre>

<note>Будьте осторожны при использовании <i>emerge kde-base</i>. Эта команда
устанавливает только пакеты KDE и не устанавливает приложения помощи KDE.</note>

<note>Если Вы планируете использовать CUPS для печати, вы должны установить
переменную "cups" в USE в <path>/etc/make.conf</path> перед установкой
KDE. Это делается из командной строки с помощью <i>USE="cups" emerge
kde</i>. Прочтите руководство Gentoo Print Guide для полной установки
CUPS.</note>

<p>Можете подремать!</p>

<note>Если у Вас есть бинарные пакеты Gentoo Linux на CD, вы можете установить
пакет прямо с CD.</note>

<pre caption="Установка бинарных пакетов с CD">
# <c>export PKGDIR=/mnt/cdrom/gentoo/packages</c>
<comment>Обычно Portage ищет бинарные пакеты в /usr/portage/packages</comment>
# <c>emerge --usepkg /mnt/cdrom/gentoo/packages/All/kdebase-x.y.z.tbz2</c>
<comment>Ключ <c>--usepkg</c> даёт уверенность, что будут использованы бинарные пакеты и для зависимостей (если они доступны).</comment>
</pre>

</body>
</section>

<section>
<title>Настройка KDM</title>
<body>

<p>После установки KDE, предпочтительно использовать хороший login
manager, а конкретнее KDE login manager, или KDM. KDM идёт вместе с
пакетами KDE, всё, что Вам надо сделать для его запуска это:</p>

<pre caption = "Запуск KDM">
# <c>kdm</c>
</pre>

<p>Теперь вы можете войти и увидеть полностью рабочее окружение KDE.
Конечно, звук пока не работает, так что вы пропустите надоедливый звук
приветствия, но мы скоро это поправим. Откройте консоль в окне и
наберите <c>ls /usr/bin</c> (или что либо, что активно заполняет консольное
окно), и посмотрите, скролит ли мышка окно консоли. Это должно
работать!</p>

<note>Если запускаемый <c>kdm</c> возвращает "command not found", то
Вы должны обновит значение переменной $PATH в<path>
/etc/profile</path>.</note>

<p>Всё что осталось сделать это убедиться, что XFree стартуют во время
загрузки Gentoo. Отредактируйте в <path>/etc/rc.conf</path> строку
<e>DISPLAYMANAGER="kdm"</e>.</p>

<pre caption = "Редактирование /etc/rc.conf">
# <c>vim /etc/rc.conf</c>
</pre>

<pre caption="/etc/rc.conf -- Установка DISPLAYMANAGER">
# What display manager do you use ?  [ xdm | gdm | kdm ]
DISPLAYMANAGER=kdm</pre>

<p>Теперь необходимо убедится, что загрузочные скрипты <e>xdm</e> читаются при  загрузке.</p>

<pre caption = "Добавление скриптов XDM в default runlevel">
# <c>rc-update add xdm default</c>
</pre>

<p>Перезагрузитесь, и проследите, что бы X/KDE поднялись!</p>

<impo>Команда <c>rc-update</c> в Gentoo Linux's это улучшена версия
команды <c>chkconfig</c> для управления init скриптами. Наберите
<c>rc-update</c> без параметров, для просмотра списка опций этой
команды.</impo>

</body>
</section>
</chapter>

<chapter>
<title>GNOME</title>

<section>
<title>Установка</title>
<body>

<p>Перед установкой GNOME, Вы должны отредактировать переменные USE.
Выполнение этого включит поддержку GNOME в поддерживаемых приложениях,
которые Вы собираете.</p>

<li>Убедитесь что "gtk" and "gnome" установлены как переменные USE
<i>make.conf</i>.</li>
<li> Убедитесь (не обязательно), что "-kde" and "-qt" установлены как переменные USE <i>make.conf</i>.</li> 

<p> Оба эти шага могут быть выполнены путём редактирования файла
<path>/etc/make.conf</path> например так:</p>

<pre caption = "Редактирование make.conf">
# <c>vim /etc/make.conf </c>
<comment>Внутри <i>make.conf</i></comment>

USE="gnome gtk -kde -qt"

</pre>

<p>Для получения информации о переменных USE, читайте <uri link="http://www.gentoo.org/doc/en/use-howto.xml">USE HOWTO</uri>.</p>

<p>Теперь установим необходимые пакеты для GNOME.</p>

<pre caption = "Установка пакетов GNOME">
# <c>emerge --pretend gnome</c>
# <c>emerge gnome</c>
</pre>

<p>После этого можно откинутся назад, и посмотреть кино. Автор
рекомендует Криминальное Чтиво.</p>

<p>Начиная с этого пункта конфигурация GNOME такая же, как и KDE. Не
используются специфические для GNOME конфигурационные файлы, только
login manager для GNOME - GDM.</p>

</body>
</section>

<section>
<title>Настройка GDM</title>
<body>

<p>После установки GNOME, предпочтительно использовать хороший login
manager, а конкретнее GNOME login manager, или GDM. GDM идёт вместе с
пакетами GNOME, всё, что Вам надо сделать для его запуска это:</p>

<pre caption = "Запуск GDM">
# <c>gdm</c>
</pre>

<p>Теперь вы можете войти и увидеть полностью рабочее окружение GNOME.
Конечно звук пока не работает, так что вы пропустите надоедливый звук
приветствия, но мы мгновенно это поправим. Откройте консоль в окне и
наберите <c>ls /usr/bin</c> (или что либо, что активно заполняет консольное
окно), и посмотрите, скролит ли мышка окно консоли. Это должно
работать!</p>

<note>Если запускаемый gdm возвращает "command not found", то Вы
должны обновит значение переменной $PATH в <path>/etc/profile</path>.</note>

<p>Всё, что осталось сделать это убедиться, что XFree стартуют во время
загрузки Gentoo. Отредактируйте в <path>/etc/rc.conf</path> строку
<e>DISPLAYMANAGER="gdm"</e>.</p>

<pre caption = "Редактирование /etc/rc.conf">
# <c>vim /etc/rc.conf</c>
</pre>

<pre caption="/etc/rc.conf -- установка DISPLAYMANAGER">
# What display manager do you use ?  [ xdm | gdm | kdm ]
DISPLAYMANAGER=gdm
</pre>

<p>Теперь необходимо убедится, что загрузочные скрипты <e>xdm</e> читаются
при загрузке.</p>

<pre caption = "Добавление скриптов  XDM в default runlevel">
# <c>rc-update add xdm default</c>
</pre>

<p>Перезагрузитесь, и проследите что бы X/GNOME поднялись!</p>

<impo>Команда <c>rc-update</c> в Gentoo Linux's это улучшеная версия команды
<c>chkconfig</c> для управления init скриптами. Наберите
<c>rc-update</c> без параметров, для просмотра списка опций этой
команды.</impo>

</body>
</section>
</chapter>

<chapter>
<title>Настройка звука</title>
<section>
<title>Alsa</title>
<body>

<p>Для установки ALSA, прочитайте Gentoo Linux ALSA setup guide <uri link = "http://www.gentoo.org/doc/alsa-guide.html">здесь</uri></p>

</body>
</section>

<section>
<title>KDE и звук</title>
<body>

<p>KDE имеет отличные звуковые утилиты, включая KDE микшер <c>kmix</c>.</p>

<note>Если kmix не может найти микшер, возможно у вас не установлена
поддержка звука. Выйдете и удалите <path>~/.kde/share/config/kmixrc</path> и
<path>~/.kde/share/config/kmix:*</path> и зайдите опять. В этот раз он
должен найти микшер должным образом.</note>

</body>
</section>

<section>
<title>GNOME и звук</title>
<body>

<p>Будет в следующей версии.</p>

</body>
</section>
</chapter>

<chapter>
<title>Почта</title>
<section>
<title>Postfix -- установка и настройка</title>
<body>

<p>Я предпочитаю использовать почтовую систему <c>postfix</c>, так как
она имеет возможности сходные <c>sendmail</c> без необходимости
использования кошмарной процедуры настройки <c>sendmail</c>. Также мы
инсталлируем программу для чтения почты <c>mutt</c>, что даст нам
возможность протестировать настройки
<c>postfix</c>.</p>

<pre caption = " Установка postfix и mutt">
# <c>emerge postfix mutt</c>
</pre>

<p>Если Вы хотите использовать Ваш почтовый сервер только для отправки
почты, то postfix уже настроен для Вас. Иначе, вы захотите
отредактировать файл <path>/etc/postfix/main.cf</path>. Файл
<path>main.cf</path> подробно документирован , и настройки по
умолчанию хорошо подходят для личной машины. Если ваша рабочая станция
подключена к internet напрямую (т.е., имеет собственный не приватный
IP и DNS имя) то пожалуй единственное изменение, которое нужно будет сделать,
это разрешить.postfix получать почту</p>

<pre caption="Включение получения почты в main.cf">
# RECEIVING MAIL

# The inet_interfaces parameter specifies the network interface
# addresses that this mail system receives mail on.  By default,
# the software claims all active interfaces on the machine. The
# parameter also controls delivery of mail to user@[ip.address].
#
#inet_interfaces = all
#inet_interfaces = $myhostname
#inet_interfaces = $myhostname, localhost
<i>inet_interfaces = $myhostname, localhost</i>
<i>mydestination = $myhostname, localhost.$mydomain</i>
</pre>

</body>
</section>

<section>
<title>Postfix Testing (with Mutt)</title>
<body>

<p>Давайте посмотрим, работает ли это.</p>

<pre caption = "Тестирование Postfix">
# <c>postfix check</c>
# <c>newaliases</c>
# <c>postfix start</c>
postfix-script: starting the Postfix mail system
# <c>mutt -x root</c>
/root/.maildir does not exist. Create it? ([y]/n): <comment>[ответьте y]</comment>
To:  &lt;root&gt;
Subject: test
(End message with a . on a line by itself)
test
.

# <c>mutt</c>
<comment>[Вы должны увидеть ваше сообщение]</comment>
</pre>

<p>Используя <c>postfix check</c> мы убеждаемся, что файл
<path>main.cf</path> обрабатывается правильно и что созданы
необходимые директории.  Запустите <c>newaliases</c> для установки
системных почтовых алиасов, и наберите <c>postfix start</c> для
запуска. Я использую <c>mutt</c> (в <c>mailx</c>, или в старомодном
mail, режиме) для отправке сообщений себе на моей локальной машине. По
ходу <c>mutt</c> создаёт пользовательские (root'овую, в данном случае)
почтовую spool директорию, <path>~/.maildir</path>. При запуске
 в полностью диалоговом режиме <c>mutt</c> показал мне моё
сообщение, значит доставка местных сообщений работает. После этого я
отправил сообщение на один из моих не локальных адресов и проверил что
почта действительно дошла.</p>

<warn>Если Вы шлёте сообщение, используя стандартный
<path>main.cf</path> с машины, находящейся в локальной сети, Вы можете
никогда не увидеть это сообщение. Многие почтовые сервера отклоняют
почту с узлов, которые не могут быть проверены с помощью обратного
DNS.</warn>

<p>Предположим всё работает, тогда настало время установить загрузку
postfix'а при старте системы.</p>

<pre caption = "Настраиваем Postfix на загрузку при старте">
# <c>postfix stop</c>
postfix-script: starting the Postfix mail system
# <c>rc-update add postfix default</c>
 * postfix added to runlevel default...
 * Caching service dependencies...          [ ok ] 
 * rc-update complete.
# <c>/etc/init.d/postfix start</c>
Starting postfix......     [  ok  ]
</pre>

<impo>Ветераны <c>sendmail</c> или <c>postfix</c> наркоманы возможно
предпочитают сохранять почту в <path>/var/spool/mail</path> вместо
пользовательских каталогов, и эта почта сохраняется в формате
<e>mbox</e> вместо формата <e>maildir</e>. Не труqдно
переконфигурировать <c>postfix</c> и <c>mutt</c> для использования
стандартной unix mailbox системы (<e>mbox</e>) вместо
этого. Отредактируйте <path>/etc/postfix/main.cf</path>,
закомментируйте <i>home_mailbox</i> и раскоментируйте
<i>mail_spool_directory = /var/spool/mail</i>. Создайте директорию
mail spool командой <c>mkdir -p /var/spool/mail</c> и перезапустите
<c>postfix</c>. Теперь надо позаботиться о почтовой программе, для
<c>mutt</c> необходимо отредактировать <path>/etc/mutt/Muttrc</path>
для использования mbox с помощью установки <i>set mbox_type = mbox</i>
и установки пути <path>/var/spool/mail</path> в <i>set
spoolfile=/var/spool/mail</i>.</impo>

<p>Если Вы предпочитаете GUI почтовый клиент, мы установим
web-базированый почтовый сервер, Squirrelmail, ниже в данном
руководстве. Как алтернативу, Daniel Robbins настоятельно рекомендует
комбинацию IMAP (который мы установим далее как требуемый для
Squirrelmail) и почтовый клиент kmail из состава KDE. <c>Kmail</c> это часть
<path>kde-base/kdenetwork</path>.</p>

<p>Далее мы установим Ximian's Evolution в качестве Менеджера
Персональной Информации, поддерживающего Palm pilot. Он, так же, может
работать как отличный почтовый клиент.</p>

</body>
</section>
</chapter>

<chapter>
<title>Samba</title>

<section>
<title>Установка/настройка Samba</title>
<body>

<p>Samba замечательный пакет, дающий возможность Вашей linux машине,
использовать файлы и принтеры совместно с машинами под Windows. Для
получения более детальной информации читайте статью о Samba написанную
Daniel Robbins <uri>http://www.ibm.com/developerworks</uri>.</p>

<pre caption = "Установка Samba">
# <c>emerge samba</c>
# <c>rc-update add samba default</c>
# <c>cd /etc/samba</c>
# <c>cp smb.conf.example smb.conf</c>
# <c>nano -w smb.conf</c>
</pre>

<pre caption="smb.conf -- workgroup">
# workgroup = NT-Domain-Name or Workgroup-Name, eg: REDHAT4
workgroup = MYGROUP <comment>[измените на имя своей рабочей группы]</comment>
</pre>

<pre caption="smb.conf --  печать с cups">
# It should not be necessary to specify the print system type unless
# it is non-standard. Currently supported print systems include:
# bsd, sysv, plp, lprng, aix, hpux, qnx
;   printing = bsd
printing = cups
</pre>

<pre caption="smb.conf -- шифрование">
# You may wish to use password encryption. Please read
# ENCRYPTION.txt, Win95.txt and WinNT.txt in the Samba documentation.
# Do not enable this option unless you have read those documents
encrypt passwords = yes
</pre>

<p>Я довольствуюсь минимумом возможностей Samba. Всё что мне необходимо,
это совместное использование файлов между моими linux и windows
машинами, и использование linux машины как принт сервера (используя
<c>cups</c>). После установки, необходимо сделат некоторые изменения в
файле <path>/etc/samba/smb.conf</path>. Определённо, переменная
<e>workgroup</e> должна соответствовать имени вашей рабочей группы в
windows сети (Я обычно использую "OLYMPUS", но "WORKGROUP" значение по
умолчанию, если я правильно помню, <e>printing</e> должно соответствовать
<e>cups</e> вместо <e>bsd</e>, а строка <e>encrypt passwords = yes</e>
должна быть раскоментирована. Машины Windows используют зашифрованные
пароли по умолчанию, это может быть изменено путём внесения изменений
в registry на всех windows машинах <comment>[Не
рекомендуется]</comment>. К сожалению, Windows использует метод
шифрования паролей отличный от Linux, по этому вам прийдётся
поддерживать отдельный файл с паролями для samba.</p>

<pre caption = "Добаление пользователей в Samba">
# <i>smbpasswd -a grant</i> <comment>[замените "grant" на необходимое имя пользователя]</comment>
New SMB password:
Retype new SMB password:
Added user grant.
</pre>

<note>Перед добавлением этого пользователя в лист паролей samba, этот
пользователь должен быть добавлен в <path>/etc/passwd</path>.</note>

<p>Для каждого пользователя, которому вы хотите дать возможность
использовать samba с windows машины, Вы должны запустить команду
<c>smbpasswd</c>. Samba сохраняет пароли в файле
<path>/etc/samba/private/smbpasswd</path>, который создаётся после
первого запуска <c>smbpasswd</c>.</p>

<pre caption = "Запуск Samba">
# <c>/etc/init.d/samba start</c>
Starting samba...        [  ok  ]
</pre>

<p>Запустите samba, и вы должны получить возможность подключаться к
Вашей машине с Gentoo Linux с любой windows машины и видеть домашнюю
директорию пользователя в качестве, которого Вы подключились и
использовать любой подключённый принтер. Если вы не можете
подключиться, посмотрите
<path>/usr/share/doc/samba-2.2.5-r1/full_docs/textdocs/DIAGNOSIS.txt.gz</path>
для более полной помощи.</p>

</body>
</section>
</chapter>

<chapter>
<title>Apache и Squirrelmail Webmail</title>
<section>
<title>Apache с поддержкой SSL и PHP</title>
<body>

<p>Допустим вы имеете статический IP адрес (или используете сервис вроде
dyndns с динамическим IP адресом), тогда вы можете захотеть получить
эффективный способ проверки своей почты, находясь вне города. Для
решения этой задачи я выбрал установку webmail сервера, Squirrelmail,
к которому я могу получить удалённый доступ используя любой web
браузер.</p>

<p>Первый шаг установка web сервера. Большая часть мира использует
Apache; и мы тоже будем его использовать. Мы так же установим PHP
(PHP4, в действительности), т.к. Squirrelmail написан на PHP. Номера
версий программ показанных в листинге могут не совпадать с теми
которые Вы устанавливаете, читая это руководство. Пожалуйста
откорректируйте их в соответствии с версиями Ваших программ. Не
делайте copy'n'paste этих команд в Ваш терминал!</p>

<pre caption = "Установка и настройка Apache">
# <c>emerge apache php mod_php mod_ssl</c>
# <c>ebuild /var/db/pkg/dev-php/mod_php-4.2.2-r1/mod_php-4.2.2-r1.ebuild config</c>
# <c>ebuild /var/db/pkg/net-www/mod_ssl-2.8.10/mod_ssl-2.8.10.ebuild config</c>
</pre>

<impo>Вы должны удостовериться, что Вы установили mod_ssl если Вы
хотите получит поддержку SSL в Apache. Если Вы хотите проверять свою
почту удаленно, не пересылая незашифрованный пароль через весь
internet, <e>значит</e> Вам нужен SSL!</impo>

<p>Посмотрите на файл <path>/etc/apache/conf/apache.conf</path>,
т.к. Apache очень гибко настраиваемый. По умолчанию корневая
директория Apache (где он первым делом ищет файлы html при обращении к
http://www.servername.foo или http://localhost) это
<path>/home/httpd/htdocs</path>; но Вы вольны перенастроить ее, если
хотите.</p>

<pre caption="/etc/apache/conf/apache.conf">
# Do NOT add a slash at the end of the directory path.
#
DocumentRoot "/home/httpd/htdocs" <comment>(отредактируйте эту строку, если хотите)</comment>
</pre>

<pre caption = "Делаем Apache загружаемым при старте">
# <c>rc-update add apache default</c>
 * apache added to runlevel default...
 * Caching service dependencies...               [ ok ]
 * rc-update complete.
# <c>nano -w /etc/conf.d/apache</c>
</pre>

<p>Используйте <c>rc-update</c> для установки Apache в default
runlevel, а затем отредактируйте <path>/etc/conf.d/apache</path> на
предмет добавления нескольких строк, чтобы Apache автоматически
загружал SSL и PHP модули.</p>

<pre caption="/etc/conf.d/apache">
APACHE_OPTS="-D SSL -D PHP4"
</pre>

<pre caption = "Перезагрузка Apache">
# <c>/etc/init.d/apache start</c>
 * Starting Apache...                            [ OK ]
# <c>lynx localhost</c>
</pre>

<p>Вы должны удостовериться что Ваш Apache работает, обратившись из
любого броузера к localhost. Для того, что бы убедится что поддержка
SSL функционирует, зайдите броузером на
<uri>http<comment>s</comment>://localhost</uri>. Префикс <c>https</c>
говорит броузеру произвести безопасное подключение к серверу используя
SSL. Графические броузеры показывают наличие безопасного подключения
иконкой замочка.</p>

<note>Когда вы подключаетесь к серверу используя безопасное
подключение, Вы, вероятно, получите предупреждение что сертификат
безопасности для данного сайта не опознан. Дело в том, что mod_ssl
устанавливает подписанный собой сертификат безопасности, годящийся
только для тестовых задач. Для более полной информации по
<c>mod_ssl</c> читайте следующее руководство:
<path>/usr/share/doc/mod_ssl-2.8.10</path>. Для собственного
использования такой сертификат вполне пригоден.</note>

<p> Теперь необходимо убедиться, что PHP работает нормально. Первый
шаг это создание простого PHP файла и размещение его в директории
Apache DocumentRoot.</p>

<pre caption = "Проверка PHP">
# <c>echo "&lt;? phpinfo(); ?&gt;" > /home/httpd/htdocs/test.php</c>
# <c>lynx http://localhost/test.php</c>
</pre>

<pre caption="Работа Apache + PHP">
             	                                              phpinfo() (p1 of 26)
               	                  PHP Logo

   	                         PHP Version 4.0.6

     System Linux my.server.edu 2.4.10 #1 Tue Oct 9 16:33:50 Local
 	        time zone must be set--see zic manuali686 i686 unknown
   	                       Build Date Oct 16 2001
</pre>

<p>Если Вы видите что либо подобное, значит Apache корректно 
обрабатывает код PHP.</p>

<warn>Если Вы смотрите на полный вывод вышеупомянутого скрипта, то Вы
видите, что скрипт <path>test.php</path> выводит очень <e>много</e>
информации о Вашей системе. Вы должны избавиться от него, как только
удостоверитесь, что php работает. (Или сделайте как я <c>mv test.php
test.phps</c>. Apache отобразит <path>test.phps</path> как исходник
PHP, а не выполнит его).</warn>

</body>
</section>

<section>
<title>Courier-imap</title>
<body>

<p>Squirrelmail приложение PHP, но он полагается на IMAP server как
на прослойку между web сэрвером и e-mail. Так как Gentoo linux использует
Maildir почтовые папки по умолчанию, Courier IMAP - хороший выбор.</p>

<pre caption = "Установка/Тестирование Courier-imap">
# <c>emerge courier-imap</c>
# <c>rc-update add courier-imapd default</c>
 * courier-imapd added to runlevel default...
 * Caching service dependencies...                        [ ok ]
 * rc-update complete.
# <c>nano -w /etc/courier-imap/authdaemonrc</c>
# <c>/etc/init.d/courier-imapd start</c>
# <c>telnet localhost 143</c>
Trying 127.0.0.1...
Connected to localhost.localdomain.
Escape character is '^]'.
* OK Courier-IMAP ready. Copyright 1998-2001 Double Precision, Inc.  
See COPYING for distribution information.
1 LOGIN grant passwd <comment>(&lt;-- вставте вместо "grant"  ваше имя пользователя
и пароль вместо "passwd")</comment>
1 OK LOGIN OK
<comment>(Нажмите &lt;ctrl&gt;-"]" и введите  "quit" для выхода)</comment>
</pre>

<pre caption=" Корректная авторизация в /etc/courier-imap/authdaemonrc">
##NAME: authmodulelist:0
#
# The authentication modules that are linked into authdaemond.  The
# default list is installed.  You may selectively disable modules simply
# by removing them from the following list.  The available modules you
# can use are: authcustom authcram authuserdb authpam

#authmodulelist="authcustom authcram authuserdb authpam"
authmodulelist="authpam"
</pre>

<impo>Courier IMAP обычно подключает имена директорий ползователей
Maildir-типа которые устанвливаются в rc загрузочных скриптах, в
<path>/usr/lib/courier-imap/imapd.rc</path>, это
<path>$HOME/Maildir</path>. Gentoo linux, однако, использует для этого
<path>$HOME/.maildir</path>, courier-imap ebuild изменяет
<path>imapd.rc</path> скрипт для использования <e>$MAILDIR</e>,
знасение которого он получает из init скриптов Gentoo
<path>/etc/init.d/courier-imap</path>. Если вы решили использовать
home user's mailbox отличный от <path>.maildir</path>, Вы должны
изменить строку <e>MAILDIR=.maildir</e> в стартовом скрипте
courier-imap.</impo>

<p>Если Вы хотите использовать Courier IMAP с поддержкой SSL Вы должны
создать IMAP SSL сертификат (и указать courier-imap где его
найти),</p>

<pre caption = " Создание SSL сертификата для IMAP">
# <i>/usr/sbin/mkimapdcert</i> 
</pre>

<p> и запустить imap-ssl.</p>

<pre caption = "Добавление Courier IMAP в default">
# <c>rc-update add courier-imapd-ssl default</c>
# <c>/etc/init.d/courier-imapd-ssl start</c>
</pre>

<p>Вы можете проверить работу imap с помощью любого поддерживающего 
IMAP клиента, такого как netscape, kmail, или mutt.</p>

<pre caption = "Проверка Вашего IMAP сервера">
# <c>mutt -f imap://localhost</c>
</pre>

<pre caption = " Проверка Вашего SSL IMAP сервера">
# <c>mutt -f imaps://localhost</c>
</pre>
</body>
</section>

<section>
<title>Squirrelmail</title>
<body>

<p>К счастью, установка и конфигурация Squirrelmail, если все 
компоненты находятся вместе, является простой.</p>

<pre caption = "Установка Squirrelmail">
# <c>emerge squirrelmail</c>
# <c>cd /home/httpd/htdocs</c>
# <c>cd squirrelmail</c>
# <c>./configure</c>
</pre>

<note>Если Ваша директория Apache DocumentRoot не
<path>/home/httpd/htdocs</path>, вы должны отредактировать так, чтобы
переменная в <path>net-mail/squirrelmail</path> указывала туда.</note>

<p>Для корректной работы squirrelmail, необходимо, что бы владельцем
всех файлов, был пользователь от имени, которого запущен Apache (для
squirrelmail предполагается что это "apache"). Выполните <c>./configure</c> и
выберите опцию <e>2</e>.</p>

<pre caption="Squirrelmail настройка -- Server settings">
SquirrelMail Configuration : Read: config.php
---------------------------------------------------------
Server Settings
1.  Domain               : my.server.edu
2.  IMAP Server          : localhost
3.  IMAP Port            : 143
4.  Use Sendmail/SMTP    : SMTP
6.    SMTP Server        : localhost
7.    SMTP Port          : 25
8.    Authenticated SMTP : false
9.  Server               : courier
10. Invert Time          : false
11. Delimiter            : detect

R   Return to Main Menu
C.  Turn color off
S   Save data
Q   Quit

Command >>
</pre>

<p>Убедитесь что переменная <e>Server</e> установлена в значение <e>courier</e>.
Вернитесь в главное меню и выберите опцию <e>4</e>, General Options.</p>

<pre caption="Squirrelmail настройка -- General options">
SquirrelMail Configuration : Read: config.php
---------------------------------------------------------
General Options
1.  Default Charset        : iso-8859-1
2.  Data Directory         : ../data/
3.  Attachment Directory   : /tmp/
4.  Default Left Size      : 150
5.  Usernames in Lowercase : false

R   Return to Main Menu
C.  Turn color off
S   Save data
Q   Quit

Command >>
</pre>

<p>Я использую директорию data принадлежащую пакету, хотя было бы
безопаснее использовать директорию лежащую вне дерева директорий
Apache. Я так же использую <path>/tmp</path> как директорию для хранения
присоединенных файлов.</p>

<p>Теперь необходимо перезапустить Apache, и всё готово!</p>

<pre caption = " Перезапуск Apache">
# <c>/etc/init.d/apache restart</c>
</pre>

<p>Теперь зайдите по адресу
<uri>https://localhost/squirrelmail/src/login.php</uri>, всё должно
работать!</p>

<pre caption = "Тестирование Squirrelmail">
# <c>lynx https://localhost/squirrelmail/</c>
</pre>

<pre caption="Squirrelmail login page">
                                           SquirrelMail - Login
   	                           [sm_logo.jpg]

       	              SquirrelMail version 1.2.0 [rc2]
           	        By the SquirrelMail Development Team

               	             SquirrelMail Login

       Name: ____________________
 Password: ____________________

   	                               Login
</pre>

<p> (Я не советую использовать lynx с Squirrelmail, Но Вы можете делать это!)</p>

</body>
</section>
</chapter>

<chapter>
<title>Управление персональной информацией</title>

<section>
<title>Evolution с поддержкой Palm</title>
<body>

<p>Evolution исключительно хороший инструмент для Управления
Персональной Информацией, который хорошо синхронизируется с Palm.
Первый шаг, установка evolution. Если Вы хотите использовать evolution
с Palm pilot, убедитесь, что установлен ключ "pda" в USE в файле
<path>/etc/make.conf</path> перед установкой evolution.</p>

<pre caption = "Установка Evolution">
# <c>emerge --pretend evolution</c>
# <c>emerge evolution</c> 
</pre>

<p>К сожалению, установка evolution занимает больше времени чем обычно
(учтите зависимость от <c>mozilla</c>!); запаситесь несколькими
галлонами кофе/чая на время ожидания.</p>

<p>При установке <c>evolution</c> необходимо так же, что бы утилиты Palm
pilot были установлены. Что бы быть уверенным, что обычные
пользователи смогут синхронизировать свой pilot, мы должны внести
некоторые изменения в права на последовательный порт. Я предполагаю
что ваша стыковочная база подключена к первому последовательному
порту(/dev/ttyS0, или /dev/tts/0 в "devfs").</p>

<pre caption = "Adding serial device">
# <c>groupadd serial</c>
# <c>chown root.serial /dev/tts/0</c>
# <c>chmod g+rw /dev/tts/0</c>
# <c>ls -l /dev/tts/0</c>
crw-rw----    1 root     serial     4,  64 Dec 31  1969 /dev/tts/0
# <c>ln -s /dev/tts/0 /dev/pilot</c>
# <c>nano -w /etc/group</c> <comment>(добавьте соответствующих пользователей в группу serial)</comment>
</pre>

<p>Мы создали группу "serial" в системе, и Вы должны добавлять в неё
любого пользователя, которому необходимо использовать последовательный
порт (все пользователи Palm pilot). Мы дали этой группе "rw" права на
<path>/dev/tts/0</path>, и на будущее мы должны сделать символическую
ссылку с <path>/dev/pilot</path> на <path>/dev/tts/0</path>. Благодаря
недавним изменениям в том, как devfs обрабатывается в Gentoo, эти
изменения сохранятся после перезагрузки.</p>

<note>Пользователи версии pre-rc6-r13 должны или обновить
<path>sys-apps/baselayout</path> и sys-apps/devfsd (и соединить все "._cfg*" файлы
в <path>/etc</path> в результате), или просто добавить соответствующие права и
символическую ссылку на <path>/etc/devfsd.conf</path>.</note>

<p>Пользователи захотят использовать пункт меню <path>tools/Pilot settings</path> в
evolution для установки программного обеспечения Gnome pilot. Не
забудьте установить "Pilot Conduits" и не плохо бы "Pilot Link" в
Gnome Control Center.</p>

</body>
</section>
</chapter>
</guide>
