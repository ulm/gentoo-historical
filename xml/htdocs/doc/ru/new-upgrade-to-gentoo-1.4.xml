<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/new-upgrade-to-gentoo-1.4.xml,v 1.7 2012/04/18 18:30:37 swift Exp $ -->

<guide lang="ru" disclaimer="draft">
<title>Руководство по обновлению Gentoo до версии 1.4</title>

<author title="автор">
  <mail link = "rac@gentoo.org">Robert Coie</mail>
</author>
<author title="редактор копии">
  <mail link = "avenj@gentoo.org">Jon Portnoy</mail>
</author>
<author title="переводчик">
  <mail link = "zenkov@gentoo.org">Иван Зенков</mail>
</author>

<abstract>
Способ обновления старых систем Gentoo до версии 1.4 &laquo;по месту&raquo;.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<!-- Текст этого документа распространяется на условиях лицензии CC-BY-SA -->
<!-- См. http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>0.1</version>
<date>2003-05-20</date>

<chapter>
<title>Прежде чем начать</title>
<section>
<title>Подготовка</title>
<body>

<p>
Как и с любым глобальным обновлением базовой системы, есть вероятность того, 
что что-то может пойти не так.  И именно потому было бы благоразумно создать 
копии всей важной для вас информации, перед тем как приступить к данному 
процессу. Если возможно, попытайтесь также уделить ему как можно больше 
времени, дабы без сбоев провести полную перекомпиляцию всего установленного 
на вашей машине программного обеспечения.
</p>

</body>
</section>
<section>
<title>Другие способы</title>
<body>

<p>
Это не единственный способ обновления вашей системы. К примеру, вы можете 
установить новую систему 1.4 на другой раздел диска, после чего постепенно 
добавлять туда свои старые конфигурационные файлы. Это хорошо ещё и тем, что 
позволяет в любой момент вернуться к своей старой системе, что-то вроде 
аварийного режима. Вы также можете вообще не обновлять свою систему, но уж 
если вы решили её обновить, тогда уж точно прочтите следующее.
</p>

</body>
</section>
<section>
<title>Основное примечание</title>
<body>

<p>
Всякий раз перед выполнением команды <c>emerge</c> было бы хорошо запустить её 
же с ключом <c>-p</c> или <c>--pretend</c> дабы знать, что именно она будет 
делать.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Обновления на месте</title>
<section>
<title>Получить насколько это возможно, последний Portage</title>
<body>

<p>
Иногда синтаксис текущих ebuild скриптов не читаем старой версией Portage.  
Попытайтесь обновить portage хотя бы до версии 2.0.44.
</p>

<pre caption="">
# <i>emerge sync</i>
# <i>emerge -u portage</i>
</pre>

<note>
Если у вас уж очень старая версия Portage, скорее всего вы получите сообщение 
об ошибке "unscriptable object". Прочтите следующие инструкции в файле 
<path>/usr/portage/sys-apps/portage/files/README.RESCUE</path>. Установленная 
вами версия Portage должна соответствовать текущей.
</note>

</body>
</section>
<section>
<title>Подготовка GCC к обновлению</title>
<body>

<p>
В процессе данного обновления вы должны будете установить свежую версию GCC.  
Версии более ранние чем 2.95.3-r8 не приспособлены для установки нескольких 
копий GCC на одном компьютере.  Поэтому сначала вы должны обновить GCC хотя бы 
до версии 2.95.3-r8. Также будет полезно установить пакет <c>gcc-config</c> 
который позволяет переключаться между различными версиями GCC.
</p>

<pre caption="">
# <i>emerge -u gcc</i>
</pre>

<p>
Теперь вы можете выяснить, работает ли gcc-config должным образом:
</p>

<pre caption="">
# <i>gcc-config --get-current-profile</i>
</pre>

<p>
На большинстве x86 систем это должно вернуть строку i686-pc-linux-gnu-2.95.3.  
На более старых системах строка может быть такой: i586-pc-linux-gnu-2.95.3.
</p>

</body>
</section>
<section>
<title>Установка GCC 3</title>
<body>

<p>
Теперь вы можете установить новую версию GCC, не повредив текущий компилятор. В 
поисках новой версии GCC (по крайней мере не старше 3.2.1-r6) смотрите наличие 
ebuild скрипта в <path>/usr/portage/sys-devel/gcc</path>. Выберите последнюю 
стабильную (stable) версию для вашей архитектуры, посмотрев строку KEYWORDS в 
ebuild файле. При этом, если перед названием архитектуры не стоит знак ~, это 
означает, что версия принята как полностью стабильная. На данный момент 
наиболее стабильной является версия 3.2.2, которую и нужно установить следующей 
командой:
</p>

<pre caption="">
#<i>emerge /usr/portage/sys-devel/gcc/gcc-3.2.2.ebuild</i>
</pre>

</body>
</section>
<section>
<title>Изменение профилей</title>
<body>

<p>
Теперь необходимо изменить два профиля: ваш gcc-config профиль и ваш же Portage 
профиль.
</p>

<pre caption="">
# <i>cd /etc</i>
# <i>rm make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-x86-1.4 make.profile</i> <comment>(замените "x86" на нужную вам архитектуру)</comment>
</pre>

<pre caption="">
# <i>gcc-config --list-profiles</i> <comment>(для выбора просто установленной версии, используйте следующие.)</comment>
# <i>gcc-config i686-pc-linux-gnu-3.2.2</i> <comment>(замените версию на ту, которая есть у вас)</comment>
</pre>

</body>
</section>
<section>
<title>Перекомпиляция цепочки необходимых инструментов</title>
<body>

<p>
Теперь необходимо новым компилятором перекомпилировать ряд нужных компонентов.  
Если вы находитесь в той же самой рабочей среде, выполните <c>source 
/etc/profile</c>, как вас проинструктировал gcc-config. После чего установится 
glibc и binutils, используя ваш новый компилятор:
</p>

<pre caption="">
# <i>emerge glibc binutils</i>
</pre>

<warn>
Вероятно, что вы обновляете glibc со старых версий 2.2 до 2.3. Не возвращайтесь 
впоследствии к старой версии glibc. Любое программное обеспечение, 
скомпилированное с glibc 2.3, просто может перестать работать, что приведет 
вашу систему к полной непригодности.
</warn>

</body>
</section>
<section>
<title>Перекомпиляция новым компилятором всего программного обеспечения</title>
<body>

<p>
Теперь можно пересобрать всё установленное программное обеспечение новым 
компилятором:
</p>

<pre caption="">
# <i>emerge -e world</i>
</pre>

<note>
Если на данном этапе команда выдаёт ошибку, запустите <c>emerge --resume</c>, 
чтобы продолжить с места обрыва. Для этого требуется Portage 2.0.47 и старше.
</note>

</body>
</section>
</chapter>
</guide>
