<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet href="/xsl/guide.xsl" type="text/xsl"?>

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/ru/new-upgrade-to-gentoo-1.4.xml">
<title>Руководство по обновлению Gentoo до версии 1.4</title>
<author title = "Author"><mail link = "rac@gentoo.org">Robert Coie</mail></author>
<author title = "Copy Editor"><mail link = "avenj@gentoo.org">Jon Portnoy</mail></author>
<author title = "Переводчик"><mail link = "zenkov@gentoo.org">Иван Зенков</mail></author>

<version>0.1</version>
<date>20 May 2003</date>

<abstract>Способ обновления устаревшей установки Gentoo, до версии 1.4</abstract>

<chapter>
<title>Перед тем как начать</title>
<section>
<title>Подготовка</title>
<body>

<p>Как и с любым глобальным обновление ядра системы, есть вероятность,
что что-то может пойти ни так.  И именно потому было бы благоразумно
создать копии всей важной для вас информации, перед тем как приступить
к данному процессу.  Если возможно попытайтесь также уделить ему как
можно больше времени, дабы беспрерывно провести полную перекомпиляцию
всего установленного на вашей машине, программного обеспечения.</p>

</body>
</section>

<section>
<title>Другие способы</title>
<body>

<p>Это ни единственный способ обновления вашей системы.  К примеру вы
можете установить новую систему 1.4, на другой раздел диска, после
чего постепенно добавлять туда ваши старые конфигурационные файлы.  Это
ещё и хорошо тем, что позволяет в любой момент вернуться к своей
старой системе, что-то вроде аварийного режима.  Вы также можете вообще
не обновлять свою систему, но уж если вы решили её обновить, тогда
уж точно прочтите следующие.</p>

</body>
</section>

<section>
<title>Основное примечание</title>
<body>

<p>Всякий раз перед выполнением команды <c>emerge</c> было бы хорошо
запустить её же с ключом <c>-p</c> или <c>--pretend</c> дабы знать,
что именно она будет делать.</p>

</body>
</section>
</chapter>

<chapter>
<title>Обновления с места</title>
<section>
<title>Получить насколько это возможно, последний Portage</title>
<body>

<p>Иногда синтаксис текущих ebuild скриптов, не читаем старой версией
Portage.  Попытайтесь обновить portage хотя бы до версии 2.0.44.</p>

<pre>
# <i>emerge sync</i>
# <i>emerge -u portage</i>
</pre>

<note>Если у вас уж очень старая версия Portage, скорей всего вы
получите сообщение об ошибке "unscriptable object".  Прочтите следующие
инструкции в файле <path>/usr/portage/sys-apps/portage/files/README.RESCUE</path>.
Установленная вами версия Portage должна соответствовать текущей.</note>

</body>
</section>

<section>
<title>Подготовка GCC к обновлению</title>
<body>

<p>В процессе данного обновления вы должны будете установить свежую
версию GCC.  Версии старше 2.95.3-r8 не приспособлены для установки
нескольких копий GCC на одном компьютере.  Поэтому сначала вы должны
обновить GCC хотя бы до версии 2.95.3-r8.  Также будет полезно
установить пакет <c>gcc-config</c> который позволяет переключаться
между различными версиями GCC.</p>

<pre>
# <i>emerge -u gcc</i>
</pre>

<p>Теперь вы можете выяснить работает ли gcc-config должным образом:</p>

<pre>
# <c>gcc-config --get-current-profile</c>
</pre>

<p>На большинстве x86 системах, это должно вернуть строку
i686-pc-linux-gnu-2.95.3 on most x86 systems.  На более старых системах
строка может быть такой i586-pc-linux-gnu-2.95.3.</p>

</body>
</section>

<section>
<title>Установка GCC 3</title>
<body>

<p>Теперь вы можете установить новую версию GCC не повредив текущий
компилятор.  В поисках новой версии GCC (по крайней мере не старше
3.2.1-r6) смотрите наличие ebuild скрипта в
<path>/usr/portage/sys-devel/gcc</path>.  Выберите последнюю стабильную
(stable) версию для вашей архитектуры, посмотрев строку KEYWORDS в
ebuild файле.  При этом если перед названием архитектуры не стоит знак
~, это означает, что версия принята как полностью стабильная.  На
данный момент наиболее стабильной является версия 3.2.2, которую и
нужно установить следующей командой:</p>

<pre>
#<i>emerge /usr/portage/sys-devel/gcc/gcc-3.2.2.ebuild</i>
</pre>

</body>
</section>

<section>
<title>Изменение профилей</title>
<body>

<p>Теперь необходимо изменить два профиля: ваш gcc-config профиль и
ваш же Portage профиль.</p>

<pre>
# <i>cd /etc</i>
# <i>rm make.profile</i>
# <i>ln -s ../usr/portage/profiles/default-x86-1.4 make.profile</i> <codenote>Замените "x86" на нужную вам архитектуру</codenote>
</pre>

<pre>
# <i>gcc-config --list-profiles</i> <codenote>Для выбора просто установленной версии, используйте следующие.</codenote>
# <i>gcc-config i686-pc-linux-gnu-3.2.2</i> <codenote>Замение версию, на ту которая есть у вас</codenote>
</pre>

</body>
</section>

<section>
<title>Перекомпиляция цепочки необходимых инструментов</title>
<body>

<p>Теперь необходимо, новым компилятором, перекомпилировать ряд нужных
компонентов.  Если вы находитесь в той же самой рабочей среде,
выполните <c>source /etc/profile</c> как вас проинструктировал
gcc-config.  После чего установится glibc и binutils используя ваш новый компилятор:</p>

<pre>
# <i>emerge glibc binutils</i>
</pre>

<warn>Вероятно, что вы обновляете glibc со старых версий 2.2 до
2.3.  Не возвращайтесь впоследствии к старой версии glibc.  Любое
программное обеспечение скомпилированое с glibc 2.3, просто может
перестать работать, что приведет вашу систему к полной
непригодности.</warn>

</body>
</section>

<section>
<title>Перекомпиляция, новым компилятором всего программного обеспечения</title>
<body>

<p>Теперь можно пересобрать всё установленное программное обеспечение, новым компилятором:</p>

<pre>
# <i>emerge -e world</i>
</pre>

<note>
Если на данном этапе, команда выдёт ошибку, запустите
<c>emerge --resume</c> чтобы продолжить в любом случае.  Для этого
требуется Portage 2.0.47 и старше.
</note>

</body>
</section>
</chapter>
</guide>