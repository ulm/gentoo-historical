<?xml version='1.0' encoding='UTF-8'?>
<!-- REV: 1.3 -->
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/ru/xorg-config.xml,v 1.3 2005/11/09 23:52:49 achumakov Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/ru/xorg-config.xml" lang="ru" disclaimer="draft">

<title>HOWTO по настройке X сервера</title>

<author title="автор">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>

<author title="переводчик">
  <mail link="selecter@spray.se">Антон Кузьмин</mail>
</author>

<abstract>
Xorg - это X сервер, который позволяет пользователям иметь в своём распоряжении графическую среду. Этот HOWTO объясняет что из себя представляет Xorg, как его установить и какие имеются опции настройки.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.2</version>
<date>2004-05-29</date>

<chapter>
<title>Что такое X Window Server?</title>
<section>
<title>Графический интерфейс против командной строки</title>
<body>

<p>
Среднего пользователя могут испугать мысли о необходимости печатать в командной строке. Почему бы ему не воспользоваться свободой предоставленной Gentoo (и линуксом вообще), и пользоваться мышью. Ну, *большая улыбка* конечно, вы можете это сделать. Linux предлагает широкое разнообразие пользовательских интерфейсов и сред, которые вы можете установить в вашу систему.
</p>

<p>
Один из самых больших сюрпризов, с которым сталкиваются новые пользователи: графический пользовательский интерфейс - программа. Она <e>не</e> является частью ядра Linux или любой другой внутренностью системы. Эта программа - мощный инструмент, который полностью позволяет использовать графические возможности вашего компьютера.
</p>

<p>
Так как стандарты очень важны, был создан стандарт <e>X Window System</e>
(сокращённо <e>X11</e> или просто <e>X</e>), который отвечает за прорисовку и передвижение окон по экрану, взаимодействие с пользователем через мышь и клавиатуру, и за другие ещё более важные основные аспекты. Он используется в Unix, Linux и других Unix-подобных операционных системах.
</p>

<p>
Программа, которая обеспечивает пользователей линукса возможностью запускать пользовательские графические интерфейсы и использует стандарт X11, называется Xorg-X11. Это fork проекта XFree86. Проект XFree86 поменял лицензию, которая стала не совместима с лицензией GPL, поэтому рекомендуется использовать Xorg. Хотя заметьте, что отличия между Xorg и XFree86 на данный момент очень незначительные. Предыдущие версии XFree86 (до 4.4) доступны через Portage.
</p>

</body>
</section>
<section>
<title>Проект X.org</title>
<body>

<p>
По проекту <uri link="http://www.x.org">X.org</uri> была создана и до сих пор поддерживается бесплатно распространяемая open-source реализация системы X11. Это open-source инфраструктура рабочей станции, основанная на X11.
</p>

<p>
Xorg предоставляет интерфейс между оборудованием вашего компьютера и графическим программным обеспечением. Кроме того, Xorg полностью работает на сетевой основе (network-aware). Это значит, что вы сможете запускать программы на одной системе в то время, как получать картинку на другой.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Установка Xorg</title>
<section>
<title>Используем утилиту emerge</title>
<body>

<p>
Достаточно болтовни, давайте что-ли делом займёмся? Чтобы установить Xorg, вам просто нужно запустить <c>emerge xorg-x11</c>. Установка Xorg займёт достаточно времени, так что вы можете перекусить, пока ждёте.
</p>

<pre caption="Устанавливаем Xorg">
# <i>emerge xorg-x11</i>
</pre>

<p>
После завершения установки, вам наверняка придётся обновить некоторые переменные окружения перед тем, как продолжить. Просто запустите <c>env-update</c> и <c>source /etc/profile</c>. Это не навредит вашей системе ни в коем случае.
</p>

<pre caption="Обновляем переменные окружения">
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Настройка Xorg</title>
<section>
<title>xorg.conf файл</title>
<body>

<p>
Конфигурационный файл Xorg называется <path>xorg.conf</path> и лежит в папке <path>/etc/X11</path>. Пакет Xorg-X11 предоставляет пример конфига <path>/etc/X11/xorg.conf.example</path>, который вы можете использовать для создания вашего собственного конфигурационного файла. Он очень хорошо прокоментирован, но если вам нужно больше документации по синтаксису, не стесняйтесь читать страницы из справочника (man page):
</p>

<pre caption="xorg.conf man page">
# <i>man 5 xorg.conf</i>
</pre>

<p>
Счастливого прочтения тем из вас, кто этого хочет. Мы, конечно же, не хотим, поэтому продолжим узнавать, как можно создать конфиг автоматически.
</p>

</body>
</section>
<section>
<title>По умолчанию: Автоматическая генерация xorg.conf файла</title>
<body>

<p>
Сам Xorg способен отгадать большую часть параметров за вас. В основном, вам придётся всего лишь изменить несколько строк, чтобы получить правильное разрешение экрана. Если вы заинтересованы в более глубокой настройке, обязательно проверьте ресурсы в конце этой главы. Но сначала давайте сгенерируем (надеюсь работающий) конфигурационный файл Xorg.
</p>

<pre caption="Генерируем конфигурационный файл xorg.conf">
# <i>Xorg -configure</i>
</pre>

<p>
Обязательно прочтите последние строчки, которые появятся после определения оборудования с помощью вышеназванной команды. Если вы увидите, что где-то Xorg не смог определить всё правильно, то придётся вам ручками писать <path>xorg.conf</path> файл. Если же всё прошло гладко, вы должны увидеть, что конфиг <path>/root/xorg.conf.new</path> был создан для тестирования.
</p>

<pre caption="Тестируем xorg.conf.new">
# <i>Xorg -config /root/xorg.conf.new</i>
</pre>

<p>
Если всё пройдёт нормально, то вы увидите уродливый, отвратительный, омерзительный, искажённый оконный менеджер под названием <c>twm</c>, наверное самый маленький из всех существующих оконных менеджеров. Попробуйте поводить мышкой, а также проверить работает ли клавиатура. Далее мы оптимизируем наш <path>xorg.conf</path> для того, чтобы он подходил к нашему оборудованию. Теперь напишите в одном из терминалов <c>exit</c> (или нажмите Ctrl-D) для выхода из Xorg. Если вы не можете управлять мышкой, то нажмите комбинацию клавиш Ctrl-Alt-Backspace, чтобы "убить" (kill) X сервер.
</p>

</body>
</section>
<section>
<title>Альтернатива: Полуавтоматическая генерация xorg.conf</title>
<body>

<p>
Xorg предоставляет утилиту - <c>xorgconfig</c>, которая будет спрашивать у вас различные вопросы, связанные с настройкой вашей системы (графический адаптер, клавиатура, ...) Основываясь на введённой информации она создаст <path>xorg.conf</path> файл.
</p>

<pre caption="Полуавтоматическая генерация xorg.conf">
# <i>xorgconfig</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Настройка xorg.conf</title>
<section>
<title>Копируем org.conf</title>
<body>

<p>
Давайте сначала скопируем <path>xorg.conf.new</path> в <path>/etc/X11/xorg.conf</path>, чтобы больше не приходилось постоянно запускать <c>Xorg -config</c> Использовать команду <c>startx</c> намного легче :)
</p>

<pre caption="Копируем xorg.conf">
# <i>cp /root/xorg.conf.new /etc/X11/xorg.conf</i>
</pre>

<p>
Теперь запускайте <c>startx</c> для того, чтобы запустить X сервер. При этом будет использован именно тот конфиг, который вы только что скопировали. Чтобы отключить X сессию, используйте команду <c>exit</c> или Ctrl-D в терминале. Вы также можете "убить" X сессию с помощью комбинации клавиш Ctrl-Alt-Backspace. Последний способ заставит X выйти без всяких разговоров. Хотя иксам больно не будет :)
</p>

<pre caption="Стартуем X">
# <i>startx</i>
</pre>

</body>
</section>
<section>
<title>Устанавливаем разрешение экрана</title>
<body>

<p>
Если вы чувствуете, что разрешение экрана неправильное, то вам необходимо проверить два раздела в конфигурации. В разделе <e>Screen</e> указаны разные разрешения экрана, с которыми X сервер может запускаться. По умолчанию, в этом разделе вообще может не быть никаких строк о разрешении экрана. В этом случае Xorg возьмёт данные из раздела <e>Monitor</e>.
</p>

<p>
Xorg проверяет настройки <c>HorizSync</c> и <c>VertRefresh</c> в разделе <e>Monitor</e> для вычисления правильных разрешений. Пока что оставьте настройки как есть. Если же изменения в разделе <e>Screen</e> не сработают, тогда вам придётся заглянуть в технические характеристики вашего монитора и расставить правильные значения. Также можно использовать утилиту <c>sys-apps/ddcxinfo-knoppix</c>, которая сможет определить технические характеристики вашего монитора.
</p>

<warn>
<b>НЕ</b> меняйте значения этих двух переменных не проконсультировавшись с техническими характеристиками вашего монитора. Неправильные значения могут привести к ошибкам синхронизации или, в худшем случае, к поломке монитора.
</warn>

<p>
Теперь давайте поменяем разрешения. В следующем примере из <path>/etc/X11/xorg.conf</path> мы добавим строчки <c>Modes</c> и <c>DefaultDepth</c>, чтобы X сервер по умолчанию запускался в 24-х битном 1024x768 разрешении экрана. Особо не обращайте внимания на данные строчки - это просто пример и, скорее всего, отличаются от настроек вашей системы.
</p>

<pre caption="Изменяем раздел Screen в /etc/X11/xorg.conf">
Section "Screen"
  Identifier  "Default Screen"
  Device    "S3 Inc. ProSavage KN133 [Twister K]"
  Monitor   "Generic Monitor"
  <i>DefaultDepth  24</i>
  <comment># Пропустим несколько строчек, чтобы улучшить читабельность</comment>
  SubSection "Display"
    Depth   24
    <i>Modes   "1024x768"</i>
  EndSubSection
EndSection
</pre>

<p>
Запустите X (<c>startx</c>), чтобы узнать, что сервер использует разрешение, которое вам нужно :)
</p>

</body>
</section>
<section>
<title>Настройка клавиатуры</title>
<body>

<p>
Настройка клавиатуры и её раскладки (<c>XkbLayout</c>) находится в разделе <e>InputDevice</e>. В пример мы покажем, как добавить бельгийскую раскладку. Просто замените код страны:
</p>

<pre caption="Changing the keyboard layout">
Section "InputDevice"
  Identifier  "Generic Keyboard"
  Driver    "keyboard"
  Option    "CoreKeyboard"
  Option    "XkbRules"  "xorg"
  Option    "XkbModel"  "pc105"
  <i>Option    "XkbLayout" "be"</i>
EndSection
</pre>

</body>
</section>
<section>
<title>Настройка мыши</title>
<body>

<p>
Если ваша мышка не работает, то сначала придётся узнать определена ли она ядром. PS/2 мышки видны, как <path>/dev/psaux</path>. Другие (например USB) видны, как <path>/dev/input</path> (или <path>/dev/input/mice</path>). В другом случае можно проверить, представляют ли эти устройства вашу мышь, получив вывод этих файлов при движении мышкой. Чтобы завершить сессию, нажмите <c>Ctrl-C</c>.
</p>

<pre caption="Проверяем файлы устройств">
# <i>cat /dev/input</i>
<comment>(Не забудьте нажать Ctrl-C для завершения)</comment>
</pre>

<p>
Если ваша мышь не определена, убедитесь, что все необходимые модули загружены.
</p>

<p>
Если же ваша мышь определена, заполните опцию Device в разделе <e>InputDevice</e>. В следующем примере видно, что мы добавили ещё две опции <c>Protocol</c> (который определяет протокол используемый мышью - многие пользователи используют PS/2 или IMPS/2) и <c>ZAxisMapping</c> (который позволяет использование колёсика).
</p>

<pre caption="Меняем настройки мыши в Xorg">
Section "InputDevice"
  Identifier  "TouchPad Mouse"
  Driver    "mouse"
  Option    "CorePointer"
  <i>Option    "Device"    "/dev/psaux"</i>
  <i>Option    "Protocol"    "IMPS/2"</i>
  <i>Option    "ZAxisMapping"    "4 5"</i>
EndSection
</pre>

<p>
Запустите <c>startx</c> и радуйтесь результату :) Поздравляем, теперь у вас работает (надеюсь) Xorg. Следующий шаг - это удалить этот уродливый оконный менеджер и использовать высокофункциональный оконный менеджер (или даже desktop environment), как KDE или GNOME, но об этом в другой раз :)
</p>

</body>
</section>
</chapter>
<chapter>
<title>Ресурсы</title>
<section>
<title>Создаём и настраиваем xorg.conf</title>
<body>

<p>
Прежде всего, <c>man 5 xorg.conf</c> даёт быстрое и полное руководство по синтаксису конфигурационного файла.
</p>

<p>
Во-вторых, есть папка <path>/usr/X11R6/lib/X11/doc</path> с различными <path>README</path> файлами для определённых чипсетов видео карт.
</p>

<p>
Также есть много онлайн ресурсов по настройке Xorg конфига. Мы затронули лишь некоторые из них, обязательно поищите больше информации в поисковике <uri link="http://www.google.com">Google</uri> :) Так как синтаксис <path>xorg.conf</path> и <path>XF86Config</path> очень схож, ниже даны ссылки по <path>XF86Config</path>
</p>

<ul>
  <li>
    <uri link="http://tldp.org/HOWTO/XFree-Local-multi-user-HOWTO/">The XFree
    Local Multi-User HOWTO</uri>
  </li>
  <li>
    <uri
    link="http://www-106.ibm.com/developerworks/edu/os-dw-linuxxwin-i.html">An
    Introduction to XFree 4.x</uri> by Chris Houser
  </li>
</ul>

</body>
</section>
</chapter>
</guide>
