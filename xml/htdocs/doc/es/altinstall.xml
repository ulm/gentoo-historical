<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/altinstall.xml,v 1.29 2006/08/01 17:44:37 yoswink Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
	  
<guide link="/doc/es/altinstall.xml" lang="es">

<title>Método alternativo de instalación de Gentoo Linux (HOWTO)</title>

<author title="Contributor">
  <mail link="gerrynjr@gentoo.org">Gerald Normandin Jr.</mail>
</author>
<author title="Contributor">
  <mail link="lordviram@rebelpacket.net">Travis Tilley</mail>
</author>
<author title="Contributor">
  <mail link="volontir@yahoo.com">Oleg Raisky</mail>
</author>
<author title="Contributor">
  <mail link="luminousit@hotmail.com">Alex Garbutt</mail>
</author>
<author title="Contributor">
  <mail link="alex@openvs.com">Alexandre Georges</mail>
</author>
<author title="Contributor">
  <mail link="vargen@b0d.org">Magnus Backanda</mail>
</author>
<author title="Contributor">
  <mail link="davoid@gentoo.org">Faust A. Tanasescu</mail>
</author>
<author title="Contributor">
  <mail link="aliz@gentoo.org">Daniel Ahlberg</mail>
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Reviewer">
  Ken Nowack <!-- antifa@gentoo.org seems out -->
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="smithj@gentoo.org">Jonathan Smith</mail>
</author>
<author title="Editor Es">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Editor Es">
  <mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>
<author title="Traductor">
  <mail link="pdmp@interhoster.com">Pedro Del Medico P.</mail>
</author>
<author title="Traductora">
  <mail link="thenewkrispowa@hotmail.com">Cristina Aguilar</mail>
</author>
<author title="Traductor">
  <mail link="enrique@barbeito.org">Enrique Barbeito García</mail>
</author>

<abstract>
Este HOWTO tiene como fin, ofrecer los diferentes métodos alternativos 
para la instalación de Gentoo/Linux, es decir, para aquellos con necesidades 
especiales de instalación tales como falta de cdrom u ordenadores que no 
puedan arrancar por medio de cds.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>0.69</version>
<date>2006-07-21</date>

<chapter>
<title>Acerca de este documento</title>
<section>
<body>

<p>
Si el método estándar de arranque para la instalación por CD no es posible 
desde su ordenador (o simplemente no es el que le gusta) ahora tiene ayuda al 
respecto. Este documento servirá para proveerle de un repositorio de 
técnicas y métodos alternativos para la instalación de Gentoo Linux. O si lo
prefiere, servirá como medio para publicar su más novedoso método de
instalación. Si posee alguna técnica de instalación, la cual considera útil 
para sí mismo, o conoce de alguna otra manera adecuada para instalar 
Gentoo Linux, por favor, no dude en documentarla y enviarla a
<uri link="http://bugs.gentoo.org">Bugzilla</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Iniciando el CD de Instalación con Smart BootManager</title>
<section>

<body>
<p>
Descargue Smart BootManager desde 
<uri>http://btmgr.sourceforge.net/download.html</uri>. Las
versiones en código fuente para linux o formato binario y los .exe de
windows están disponibles, así como muchos packs de idiomas. Sin
embargo, por ahora, el método más adecuado sería utilizar el formato
binario, ya que el código no compila con las nuevas versiones de NASM.
</p>

<p>
Compile el programa desde el código o simplemente grabe el archivo
binario. Hay varias opciones que pueden utilizarse durante la creación
de su disco de arranque, como puede observar a continuación.
</p>

<pre caption="Opciones de Smart BootManager">
sbminst [-t theme] [-d drv] [-b backup_file] [-u backup_file]

   -t theme     select the theme to be used, in which the theme could be:
                  us = English theme       de = German theme 
                  hu = Hungarian theme     zh = Chinese theme 
                  ru = Russian theme       cz = Czech theme
                  es = Spanish theme       fr = French theme 
                  pt = Portuguese theme 

                 
   -d drv       set the drive that you want to install Smart BootManager on;
                for Linux:
                  /dev/fd0 is the first floppy driver, 
                  /dev/hda is the first IDE harddisk driver.
                  /dev/sda is the first SCSI harddisk driver.
                for DOS:
                  0   is the first floppy drive
                  128 is the first hard drive;

   -c             disable CD-ROM booting feature;

   -b backup_file backup the data that will be overwritten for
                  future uninstallation;

   -u backup_file uninstall Smart BootManager, should be used alone;

   -y             do not ask any question or warning.
</pre>

<pre caption="Utilizando sbminst para crear el disco de arranque">
# <i>sbminst -t us  -d /dev/fd0</i>
</pre>

<note>
Reemplace <path>fd0</path> por el nombre de su dispositivo de disquetes si
fuera distinto.
</note>

<p>
Ahora simplemente sitúe el disquete en la disquetera del ordenador
si quiere cargar el CD de Instalación, así como el CD de Instalación dentro 
del CD-ROM e inicie el ordenador.
</p>

<p>
Será recibido por el menú del Smart BootManager. Seleccione su CD-ROM
y presione ENTER para cargar el CD. Una vez cargado, continúe con
las instrucciones normales de instalación.
</p>

<p>
Puede encontrar más información sobre Smart BootManager en
<uri>http://btmgr.sourceforge.net/</uri>.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Instalación con Knoppix</title>
<section>
<body>

<note>
Knoppix solamente está disponible para usuarios de arquitecturas x86.
</note>

<!-- esto funciona con knoppix 3.6+ y gentoo 2004.3, 2005.0-->

<p>
Iniciar desde el LiveCD <uri
link="http://www.knoppix.org/">Knoppix</uri> es una manera de tener un
sistema completamente funcional mientras está compilando Gentoo. Tux Racer le
ayudará a pasar el rato mientras espera, además de poder utilizar OpenOffice
para trabajar. 
</p>

<warn>
Sepa que si guarda cualquier cosa en el directorio de usuario de Knoppix
mientras espera a que se instale su sistema Gentoo, lo perderá todo cuando
reinicie a Gentoo. ¡Asegúrese de guardar los ficheros importantes en el disco
duro o en otro ordenador!
</warn>

<p>
Inicie desde el CD de Knoppix. Si tiene Knoppix 3.6-3.8.2, necesitará
especificar <c>knoppix26</c> como opción de inicio para cargar un kernel 2.6.
Si omite este paso, cuando haga <c>chroot</c>, recibirá un error diciendo que
su kernel es deasiado antiguo. Si, por el contrario, tiene Knoppix 3.9+, este
paso es innecesario, desde que el kernel 2.6 es el predeterminado.
</p>
 
<p>
Por defecto, Knoppix carga un escritorio KDE. Abra <c>konsole</c> y teclee
<c>su -</c> para así poder cambiar su contraseña. Esto le permite poner la
contraseña de root para Knoppix. Ahora puede configurar <c>sshd</c> para
acceder remotamente al sistema, como prefiera.
</p>

<pre caption="Creando el punto de montaje /mnt/gentoo">
# <i>mkdir /mnt/gentoo</i>
</pre>

<p>
Llegados a este punto, puede seguir con la instalación normal en la
<uri link="/doc/es/handbook/handbook.xml?part=1&amp;chap=4">parte 4</uri>. 
Sin embargo, cuando tenga que montar el sistema proc, sustituya el comando por:
</p>

<pre caption = "Montando el pseudo sistema de archivos /proc con bind">
# <i>mount -o bind /proc /mnt/gentoo/proc</i>
</pre>

<p>
También, sepa que algunas de las CARACTERÍSTICAS de Portage no funcionarán en
knoppix. Tenga especialmente cuidado con <c>userpriv</c> y <c>usersandbox</c>.
Si se encuentra con errores, puede ser acertado deshabilitar algunas, o todas,
de las características opcionales.
</p>

<!-- 
  Commenting out due to #78716. If it needs to be restated again, note
  that some will require to bind-mount it, others don't, and that you have
  a 50-50 chance of winning the gold strike.
  

<p>
También necesita montar (a través de bind) el árbol de dispositivos para 
solventar algunos problemas con los permisos de los archivos de dispositivo.
</p>

< ! - -
  If this doesn't seem to work, #71901 mentions the following command:
    mount -o remount,rw,nosuid /dev/hd* /mnt/hd*
  before all. Looks weird to me, but if this doesn't work, we might want to try
  that.
- - >

<pre caption="Montando (a través de Bind) el árbol de dispositivos">
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
</pre>
-->

</body>
</section>
</chapter>

<chapter>
<title>Instalando desde el stage1 sin acceso a la red</title>
<section>
<body>


<p>
Grabe una imagen de CD (ISO) del CD de Instalación.
</p>

<p>
Obtenga la última imagen de Portage de
<uri>http://distro.ibiblio.org/pub/linux/distributions/gentoo/snapshots/</uri>
(o de su servidor <uri
link="http://www.gentoo.org/main/en/mirrors.xml"> espejo</uri>
favorito).  Coloque este tarball en una partición existente en el
ordenador donde vaya a instalarlo, o cópielo en un CD.
</p>

<p>
Siga todas las instrucciones de la documentación sobre <uri
link="/doc/es/handbook">la instalación de Gentoo</uri> hasta <c>chroot
/mnt/gentoo</c> en el capítulo 6. Si solamente tiene un CD-ROM acuérdese de
usar la opción <c>docache</c> en el inicio para poder desmontar el CD de
Instalación y montar su CD con la imagen de Portage.
</p>

<p>
Abra una nueva consola (Alt-F2). Continuaremos con la documentación de
instalación hasta la ejecución del guión <c>bootstrap.sh</c>.
</p>

<warn>
Antiguas versiones del CD de Instalación necesitan que se cambie el password
utilizando el comando <c>passwd</c>, antes de entrar al sistema
manualmente.
</warn>


<p>
Vuelva a la primera consola (Alt-F1, sin chroot) y monte el segundo CD
en <path>/mnt/gentoo/mnt/cdrom2</path>. Copie el tarball de Portage
desde el cdrom2 y descomprímalo en <path>/mnt/gentoo/usr</path>. 
</p>

<pre caption="Montar la imagen del cd">
# <i>umount /mnt/cdrom</i>
# <i>mkdir /mnt/gentoo/mnt/cdrom2</i>
# <i>mount /dev/cdroms/cdrom0 /mnt/gentoo/mnt/cdrom2</i>
# <i>cp /mnt/gentoo/mnt/cdrom2/portage-$date.tar.bz2 /mnt/gentoo/usr</i>
# <i>cd /mnt/gentoo/usr</i>
# <i>tar -xvjpf portage-$date.tar.bz2</i>
</pre>

<p>
Cambie a la consola de F2. Ahora, si intenta ejecutar <c>bootstrap.sh</c>, este
fallará porque no es capaz de descargar ningún archivo. Iremos a buscar estos
archivos a otro sitio y los situaremos en <path>/usr/portage/distfiles</path>
(en la consola F2).
</p>

<p>
Necesita una lista con los paquetes del stage1: glibc, baselayout,
texinfo, gettext, zlib, binutils, gcc, ncurses además de sus
dependencias.
</p>

<note>
Fíjese que necesita las versiones de cada paquete sincronizadas
con su árbol de Portage.
</note>

<pre caption="Obteniendo la lista de descargas">
<comment>(No olvide colocar el 2 delante de &gt;)</comment>
# <i>emerge -fp glibc baselayout texinfo gettext zlib binutils gcc ncurses 2&gt; stage1.list</i>
# <i>mount -t vfat /dev/fd0 /mnt/floppy</i>
# <i>cp /mnt/gentoo/stage1.list /mnt/floppy</i>
# <i>umount /mnt/floppy</i>
</pre>

<p>
Lleve el disquete a un ordenador que tenga un acceso rápido (a la red). Si
echa un vistazo al archivo <path>stage1.list</path>, podrá ver que contiene
una serie de URLs para descargar. Por desgracia, esta lista de posibles URLs 
para cada paquete no es lo que queremos. Eliminaremos todas, menos la 
primera, de las URLs (por paquete):
</p>

<pre caption="Eliminando URLs">
<comment>(Este guión depende del formato de salida dado por el emerge
el cual puede cambiar en un futuro sin aviso previo - utilícelo con
precaución</comment>
# <i>cut -f 1 -d ' ' stage1.list > stage1.download</i>
</pre>

<p>
Ahora utilice <c>wget</c> para obtener la lista de las fuentes mencionadas:
</p>

<pre caption="Usando wget para obtener las fuentes de los paquetes">
# <i>wget -N -i stage1.download</i>
</pre>

<p>
Una vez que haya obtenido todos los archivos, llévelos al ordenador y
cópielos en <path>/mnt/gentoo/usr/portage/distfiles</path>. Ya puede
ejecutar <c>bootstrap.sh</c>. Repita este mismo procedimiento para el
stage2 y 3.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Instalación sin disco, usando el arranque PXE.</title>

<section>
<title>Requerimientos</title>
<body>

<p>
Necesitará una tarjeta de red en la máquina cliente que use el protocolo 
PXE para arrancar, como muchas tarjetas 3Com. Necesitará también una 
BIOS que soporte el arranque desde PXE.
</p>

</body>
</section>

<section>
<title>Configuración básica del servidor </title>
<body>

<p>
Crear directorios: lo primero que hay que hacer es crear los
directorios donde su sistema sin disco será almacenado. Cree un
directorio llamado <path>/diskless</path> el cual acogerá un
directorio para cada cliente sin disco. De aquí en adelante
trabajaremos con un cliente llamado 'eta'.
</p>

<pre caption="Configuración de directorios">
# <i>mkdir /diskless</i>
# <i>mkdir /diskless/eta</i>
# <i>mkdir /diskless/eta/boot</i>
</pre>

<p>
Configurar DHCP y TFTP: el cliente dará información de arranque
utilizando DHCP y descargando todos los archivos requeridos usando
TFTP. Sólo tiene que emerger DHCP y configurarlo según sus necesidades
básicas. Entonces, añada lo siguiente
en<path>/etc/dhcp/dhcpd.conf</path>.
</p>

<note>
Esto proporciona una dirección IP estática para el cliente y la ruta imagen de
arranque PXE, aquí <path>pxegrub</path>. Tendrá que reemplazar la dirección MAC
de la tarjeta del Ethernet del cliente y el directorio donde pondrá los
archivos del cliente, por los que vaya a usar.
</note>

<p>
Para DHCpd, ejecute <c>emerge dhcp</c> (o cualquier otro servidor de DHCP de
su elección). Asegúrese de que el interfaz correcto haya sido seleccionado en 
<path>/etc/conf.d/dhcp</path>.
</p>

<pre caption="dhcp.conf">
option option-150 code 150 = text ;
ddns-update-style none ;
host eta {
hardware ethernet 00:00:00:00:00:00;
fixed-address <i>ip.add.re.ss</i>;
option option-150 "/eta/boot/grub.lst";
filename "/eta/boot/pxegrub";
}
</pre>

<p>
Para TFTP, realice un emerge <c>app-admin/tftp-hpa</c>. En el archivo
<path>/etc/conf.d/in.tftpd</path>, ponga lo siguiente:
</p>

<pre caption="in.tftpd">
INTFTPD_PATH="/diskless"
INTFTPD_USER="nobody"
INTFTPD_OPTS="-u ${INTFTPD_USER} -l -vvvvvv -p -c -s ${INTFTPD_PATH}"
</pre>

<p>
Configurar GRUB: para habilitar arranques PXE, yo uso GRUB. Debe
compilarlo uno mismo para habilitar la compilación de la imagen PXE
... pero es bastante fácil. Primero, coja la última versión del código
fuente de GRUB (<c>emerge -f grub</c> situará el tarball en
<path>/usr/portage/distfiles</path>). Copie el tarball en
<path>/diskless</path> y después configúrelo para hacer el binario con
PXE activado. Una vez compilado el binario, cópielo en el directorio
de arranque del cliente sin disco. A continuación edite su archivo de
configuración <path>grub.lst</path>.
</p>

<pre caption="Configuración y compilación de Grub">
# <i>tar zxvf grub-0.92.tar.gz</i>
# <i>cd grub-0.92</i>
# <i>./configure --help</i>

<comment>(En las opciones verá una lista con los drivers de interfaces de red soportados.)</comment>
<comment>(Seleccione un driver compatible con su tarjeta. Aquí lo llamamos $nic)</comment>

# <i>./configure --enable-diskless --enable-$nic</i>
# <i>make</i>
# <i>cd stage2</i>
# <i>cp pxegrub /diskless/eta/boot/pxegrub</i>
# <i>nano -w /diskless/eta/boot/grub.lst</i>
</pre>

<pre caption="grub.lst">
default 0
timeout 30

title=Diskless Gentoo
root (nd)
kernel /eta/bzImage ip=dhcp root=/dev/nfs nfsroot=<i>ip.add.re.ss</i>:/diskless/eta

<comment># Para la opción nfsroot, la dirección IP es la del servidor y el directorio
es en el cual los archivos del cliente sin disco están ubicados (en el
servidor).</comment>
</pre>

<p>
Configurar NFS: NFS es bastante fácil de configurar. Lo único que debe
hacer es añadir una línea en el archivo de configuración
<path>/etc/exports</path>:
</p>

<pre caption="/etc/exports">
# <i>nano -w /etc/exports</i>
# /etc/exports: NFS file systems being exported. See exports(5).
/diskless/eta eta(rw,sync,no_root_squash)
</pre>

<p>
Actualice su archivo hosts: una cosa importante que hacer ahora, es
modificar su archivo <path>/etc/hosts</path> para ajustarlo a sus
necesidades. 
</p>

<pre caption="/etc/hosts">
127.0.0.1 localhost

192.168.1.10 eta.example.com eta
192.168.1.20 sigma.example.com sigma
</pre>
</body>
</section>

<section>
<title>Creando el sistema en el servidor</title>
<body>

<p>
Quizá quiera reiniciar el servidor con un CD de Instalación Gentoo, aunque
también puede continuar perfectamente (sin reiniciar) si conoce como proceder
con las instrucciones de instalación de Gentoo desde una instalación existente.
Siga el procedimiento de instalación estándar como se explica en el <uri
link="/doc/es/handbook/">Manual de Gentoo</uri> PERO con las siguientes
diferencias. Cuando  monte el sistema de archivos, haga lo siguiente (donde
hdaX es la partición en la cual creó el directorio <path>/diskless</path>). No
necesita montar ninguna otra partición, ya que todos los archivos residirán en
el directorio <path>/diskless/eta</path>.
</p>

<pre caption="Montando el sistema de ficheros">
#<i> mount /dev/hdaX /mnt/gentoo</i>
</pre>

<p>
Tarballs stage y chroot: Este ejemplo utiliza el tarball de
stage3. Monte <path>/proc</path> en su directorio
<path>/diskless</path> y haga <c>chroot</c> para continuar con la
instalación. Después siga el manual de instalación hasta la
configuración del kernel.
</p>

<warn>Sea cuidadoso cuando extraiga su tarball stage. No quiere
terminar extrayéndolo sobre su instalación existente.
</warn>

<pre caption="Extrayendo el tarball stage">
# <i>cd /mnt/gentoo/diskless/eta/</i>
# <i>tar -xvjpf  /mnt/cdrom/gentoo/stage3-*.tar.bz2</i>
# <i>mount -t proc /proc /mnt/gentoo/diskless/eta/proc</i>
# <i>cp /etc/resolv.conf /mnt/gentoo/diskless/eta/etc/resolv.conf</i>
# <i>chroot /mnt/gentoo/diskless/eta/ /bin/bash</i>
# <i>env-update</i>
# <i>source /etc/profile</i>
</pre>

<p>
Configuración del Kernel: cuando haga el <c>make menuconfig</c> en su
configuración kernel, no olvide habilitar las siguientes opciones
junto a las otras recomendadas en el manual de instalación.
</p>

<pre caption="Opciones de menuconfig">
- Your network card device support
 <comment>(¡En el kernel, no como un módulo!)</comment>
 
- Bajo "Networking options" :

[*] TCP/IP networking
[*] IP: kernel level autoconfiguration
[*] IP: DHCP support
[*] IP: BOOTP support


- Bajo "File systems --> Network File Systems" :

&lt;*&gt; NFS file system support
[*] Provide NFSv3 client support
[*] Root file system on NFS
</pre>

<p>
Guarde el kernel en su <path>/</path> de chroot (no en <path>/boot</path>)
de acuerdo con las configuraciones de pxegrub definidas anteriormente.
A continuación, configure el archivo <path>/etc/fstab</path> de su
cliente sin disco.
</p>

<pre caption="/etc/fstab">
# <i>nano -w /etc/fstab</i>
/dev/cdroms/cdrom0 /mnt/cdrom iso9660 noauto,ro 0 0
proc /proc proc defaults 0 0
tmpfs /dev/shm tmpfs defaults 0 0
</pre>

<p>
También necesita prevenir al cliente de ejecutar un chequeo sobre el sistema 
de archivos:
</p>

<pre caption="Previniendo al cliente de la ejecución de un chequeo sobre el sistema de ficheros">
# <i>touch /fastboot</i>
# <i>echo "touch /fastboot" &gt;&gt; /etc/conf.d/local.start</i>
</pre>
 
<p>
Instale <c>nfs-utils</c> ya que su cliente dependerá en gran parte de ellas.
</p>

<pre caption="Installing nfs-utils">
# <i>emerge nfs-utils</i>
</pre>

<p>
Gestor de arranque. No instale otro gestor de arranque, porque ya
tenemos uno - <c>pxegrub</c>. Simplemente acabe la instalación y reinicie el
servidor. Inicie los servicios que necesitará para arrancar el nuevo
cliente: DHCP, TFTPD, y NFS.
</p>

<pre caption="Iniciando los servicios">
# <i>/etc/init.d/dhcp start</i>
# <i>/etc/init.d/tftpd start</i>
# <i>/etc/init.d/nfs start</i>
</pre>
</body>
</section>

<section>
<title>Iniciando el nuevo cliente</title>
<body>

<p>
Para que el nuevo cliente arranque adecuadamente, necesitará
configurar la BIOS y la tarjeta de red para que use PXE como primer
método de arranque - antes CD-ROM o floppy. Para ayudarle con esto,
consulte los manuales de su hardware o la página web de los
proveedores. La tarjeta de red debería conseguir una dirección IP
usando DHCP y descargar la imagen PXE del grub usando TFTP. Entonces,
debería ver un bonito menú de arranque del grub blanco y negro
en el que seleccionará el kernel de arranque y presione intro. Si todo
está bien, el kernel debería arrancar, montando el sistema de archivos
del root usando NFS y poniendo a su disposición el símbolo de sistema
para hacer el login. Disfrute.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Instalando Gentoo desde una distribución Linux existente</title> 
<section>
<title>Requerimientos </title> 
<body>

<p>
Para instalar Gentoo desde su distribución Linux, necesita tener el 
comando <c>chroot</c> instalado, y tener una copia del tarball (o ISO) de 
instalación de Gentoo que quiera instalar. Una conexión a la red sería lo 
aconsejado, si desea más de lo que viene suministrado en su tarball (de 
todas formas, un tarball es sólo un archivo terminado en .tbz o .tar.gz). 
El autor usó RedHat Linux 7.3 como sistema operativo anfitrión, pero no
importa mucho. ¡Empecemos!
</p>
</body>
</section>

<section>
<title>Perspectiva general</title>
<body>
<p>
Primero asignaremos una partición a Gentoo reajustando el tamaño de nuestra
partición Linux ya existente, montar la partición, descomprimir el tarball en
la partición montada, hacer <c>chroot</c> dentro del pseudo-sistema y empezar a
compilar. Una vez que la rutina de arranque se ha llevado a cabo, haremos una
configuración final en el sistema para asegurarnos de que arranca, entonces
estaremos preparados para reiniciar y usar Gentoo.
</p>
</body>
</section>

<section>
<title>¿Cómo deberíamos hacer espacio a Gentoo?</title>
<body>

<p>
La partición de root es el sistema de fichero montado bajo
<path>/</path>. Una rápida ejecución de  <c>mount</c> en mi sistema muestra
de qué estoy hablando. Usamos también <c>df</c> (disco libre) para ver cuánto
espacio nos queda y como reajustar su tamaño. ¡Tenga en cuenta que no
es obligatorio redistribuir la partición de su root! Podría
redistribuir cualquier cosa soportada por nuestro redistribuidor, pero
hablemos de eso más tarde.
</p>

<pre caption="Información del sistema de ficheros">
# <i>mount</i>
/dev/hdb2 on / type ext3 (rw) 
none on /proc type proc (rw) 
none on /dev/pts type devpts (rw,gid=5,mode=620) 
none on /dev/shm type tmpfs (rw) 
# <i>df -h </i>
Filesystem           Size Used Avail Use% Mounted on 
/dev/hdb2            4.0G 1.9G  2.4G  82% /
none		      38M    0    38M   0% /dev/shm 
</pre>

<p>
Como se puede ver, la partición montada como <path>/</path> llamada
<path>/dev/hdb2</path> tiene 2.4 gigabytes libres. En mi caso, creo
que lo redistribuiré para dejar 400 Mb de espacio libre, asignando 2
Gb para Gentoo. No está mal, tendría bastante material instalado. De
todas formas, piense que 1 gigabyte suele ser suficiente para la
mayoría de los usuarios. ¡Así que, vamos a particionarlo!
</p> 
</body>
</section>

<section>
<title>Instalando parted para redistribuir particiones. </title> 
<body>

<p>
Parted es una aplicación suministrada por la fundación GNU, un antiguo
y respetable gran proyecto cuyo software está usando en este
mismo momento. De todas formas, hay una herramienta que ahora nos es
extremadamente útil. Se llama <c>parted</c>, editor de particiones y podemos
conseguirlo en <uri>http://www.gnu.org/software/parted/</uri>.
</p>

<note>
Hay otras herramientas para redistribuir particiones, pero el autor 
no está seguro/interesado en que ni PartitionMagic(tm) ni ningún 
otro software de ese tipo lo haga. Es trabajo del lector probarlos.
</note>

<p> 
Busque en esta página el tipo de sistema de archivos cuyo tamaño desea
reajustar y vea si <c>parted</c> puede hacerlo. Si no, no ha tenido suerte,
tendrá que borrar alguna partición para hacerle espacio a Gentoo, y
volver a instalar. Adelante, descargue el software e instálelo. Aquí
encontramos un problema. Queremos reajustar el tamaño de nuestra
partición root de Linux, por tanto, debemos iniciar desde un disquete
un sistema linux mínimo y usar un <c>parted</c> previamente compilado y
copiado a un disquete para redimensionar <path>/</path>. De todas
formas, si puede desmontar la partición estando aún en Linux, es
afortunado, no necesitará hacer lo siguiente. Sólo compile <c>parted</c> y
ejecútelo en una partición desmontada que elija para reajustar su
tamaño. Así es como yo lo hice en mi sistema.
</p>

<impo>
¡Asegúrese de que las operaciones que desea hacer en su partición 
son soportadas por parted!
</impo>

<p>
Obtenga el disco de inicio mininux (una mini distribución de Linux basada en
un kernel 2.4 y que cabe en un solo disquete, además de ser gratuito) de 
<uri>http://mininux.free.fr/uk/</uri>, cree un disquete como viene
indicado en la documentación que acompaña el paquete de software e
inserte un nuevo disquete en la disquetera para el siguiente paso.
</p>

<note>
Observe de nuevo que Linux es sinónimo de "Hay más de una forma de
hacerlo". Su objetivo es ejecutar parted en una partición desmontada
para que pueda funcionar. Podría utilizar algún software de
discos de inicio diferente de mininux. No debería necesitar hacer
este paso, es sólo desmontar el sistema de archivos que desea
reparticionar en su sesión de Linux y ejecutar parted en ella.
</note>

<pre caption="Creación del disco de utilidad">
# <i>mkfs.minix /dev/fd0</i>
480 inodes
1440 blocks
Firstdatazone=19 (19)
Zonesize=1024
Maxsize=268966912
</pre>

<p>
Ahora procederemos con la configuración e instalación de parted. Si no
está todavía descargado y descomprimido, hágalo ahora y cambie de
directorio al correspondiente (a parted). Ahora ejecute la siguiente
secuencia de comandos para construir la aplicación y cópielo en su
disquete.
</p>

<pre caption="Generando el disco de utilidad">
# <i> mkdir /floppy; mount -t minix /dev/fd0 /floppy &amp;&amp; 
export CFLAGS="-O3 -pipe -fomit-frame-pointer -static" &amp;&amp; ./configure 
&amp;&amp; make &amp;&amp; cp parted/parted /floppy &amp;&amp; umount /floppy </i>
</pre>

<p>
Enhorabuena, está preparado para reiniciar y redistribuir su
partición. Hágalo sólo después de echarle un vistazo a la
documentación de parted en el website de GNU. El reajuste de tamaño
suele tardar unos 30 minutos para los discos duros más largos, sea
paciente. Reinicie su sistema con el disco de minuiux (sólo déjelo
dentro), y una vez que se haya iniciado la sesión, sustituya el disco
de la unidad por el disco de utilidades que hemos creado arriba y
teclee <c>mount /dev/fd0 /floppy</c> para montar parted bajo 
<path>/floppy</path>. Ejecute parted y podrá redimensionar su partición. 
Una vez acabado este largo proceso, estaremos listos para lo realmente 
divertido, instalar Gentoo. Vuelva a iniciar su sistema linux anterior. 
La unidad en el que desea operar es la que contiene la partición cuyo 
tamaño queremos reajustar. Por ejemplo, si queremos reajustar 
<path>/dev/hda3</path>, el disco es <path>/dev/hda</path>.
</p>

<pre caption="Comandos a ejecutar una vez estemos dentro del sistema mininux">
# <i>mount /dev/fd0 /floppy </i>
# <i>cd /floppy; ./parted [disco sobre el que se trabaja]</i>
(parted) <i> print </i>
Disk geometry for /dev/hdb: 0.000-9787.148 megabytes
Disk label type: msdos
Minor    Start       End     Type      Filesystem  Flags
1          0.031   2953.125  primary   ntfs        
3       2953.125   3133.265  primary   linux-swap  
2       3133.266   5633.085  primary   ext3        
4       5633.086   9787.148  extended              
5       5633.117   6633.210  logical               
6       6633.242   9787.148  logical   ext3        
(parted) <i> help resize </i>
  resize MINOR START END        resize filesystem on partition MINOR

        MINOR is the partition number used by Linux.  On msdos disk labels, the
        primary partitions number from 1-4, and logical partitions are 5
        onwards.
        START and END are in megabytes
(parted) <i> resize 2 3133.266 4000.000 </i>
</pre>

<impo>
¡Sea paciente! ¡El ordenador está trabajando! Revise el led 
en su cpu para ver que realmente está funcionando. Esto llevará 
entre 2 y 30 minutos.
</impo>

<p>
Una vez que haya reajustado el tamaño, inicie de nuevo su linux
antiguo como hemos descrito. Después vaya a  <uri
link="/doc/es/handbook/handbook.xml?part=1&amp;chap=4">El Gentoo
Handbook: Preparando los discos</uri> y siga
las instrucciones. Cuando haga el <c>chroot</c>, use el siguiente comando
para limpiar su entorno:
</p>

<pre caption = "Limpiando el entorno durante chroot">
 # <i>env -i HOME=$HOME TERM=$TERM chroot /mnt/gentoo /bin/bash</i>
 # <i>/usr/sbin/env-update</i>
 # <i>source /etc/profile</i>
</pre>

<p>
¡Disfrute!
</p>

</body>
</section>
</chapter>
</guide>
