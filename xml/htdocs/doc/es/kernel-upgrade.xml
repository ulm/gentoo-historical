<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/kernel-upgrade.xml,v 1.1 2004/12/18 16:37:16 chiguire Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="kernel-upgrade.xml" lang="es">
<title>Guía Gentoo Linux de Actualización del Kernel</title>
<author title="Autor">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Editor Es">
	<mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es Adjunto">
	<mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>

<abstract>
Este documento describe el proceso de actualizar su kernel de un
lanzamiento a otro.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->
<license/>

<version>0.1.1</version>
<date>2004-12-06</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
El kernel es uno de las pocas clases de paquete que requiere alguna
intervención manual para completar la actualización. Portage bajará e
instalará las fuentes, pero le toca hacer la compilación antes de
obtener algún cambio.
</p>

<p>
Aunque esta guía está dirigida a los usuarios que actualizan el kernel
de un lanzamiento a otro, también es útil para los que migran de un
paquete de fuentes de kernel a otro.
</p>

<p>
<c>gentoo-dev-sources</c> se utiliza como ejemplo en este documento,
aunque las instrucciones usadas acá aplican igualmente a los demás
paquetes presentes en nuestro árbol.
</p>
</body>
</section>
</chapter>

<chapter>
<title>¿Porqué actualizar el kernel?</title>
<section>
<body>

<p>
Generalmente hablando, actualizar de un lanzamiento menor al siguiente
no traerá alguna diferencia mayor. Las razones para actualizar el
kernel generalmente tienen que ver con aprovechar una característica
nueva específica, o manejador, para protegerse contra alguna
vulnerabilidad de seguridad o sencillamente para mantener su sistema
saludable y actual.
</p>

<p>
Aunque escoja no actualizar el kernel cada revisión, se recomienda que
lo haga de vez en cuando. Si recomendamos fuertemente que actualice
inmediatamente al kernel nuevo que resuelva problemas de seguridad.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Obteniendo las fuentes nuevas a través de Portage</title>
<section>
<body>

<p>
Se actualizan las fuentes del kernel como lo haría con cualquier otro
paquete usando la herramienta <c>emerge</c>. Probablemente sea el caso
que quiera actualizar al ver aparecer las fuentes en la lista de
actualizaciones de "world". Por ejemplo:
</p>

<pre caption="Fuentes nuevas del kernel aparecen en lista de actualizaciones">
# <i>emerge -Dup world</i>
Calculating dependencies ...done!
[ebuild     U ] sys-kernel/gentoo-dev-sources-2.6.9-r2 [2.6.8-r5]
</pre>

<p>
Puede entonces instalar la actualización, así:
</p>

<pre caption="Actualizando las fuentes del kernel">
# <i>emerge -u gentoo-dev-sources</i>
</pre>

<p>
Las fuentes serán instaladas en un subdirectorio bajo
<path>/usr/src</path>. En el ejemplo anterior, mis fuentes nuevas
serán instaladas en <path>/usr/src/linux-2.6.9-gentoo-r2</path>.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Actualizando el enlace simbólico /usr/src/linux</title>
<section>
<body>

<p>
Gentoo requiere mantener el enlace simbólico
<path>/usr/src/linux</path>, el cual debe apuntar al kernel actual.
</p>

<p>
En este caso, debemos actualizar el enlace simbólico para que apunte
al kernel al cual actualizaremos. Continuando nuestro ejemplo:
</p>

<pre caption="Actualizando en enlace simbólico /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>
</body>
</section>
</chapter>

<chapter id="install">
<title>Configurando, compilando e instalando el kernel nuevo</title>
<section>
<body>

<p>
Para cualquiera de estas opciones, deberá referirse a las
instrucciones dadas en el <uri
link="http://www.gentoo.org/doc/es/handbook/index.xml">Manual
Gentoo</uri> relacionadas a la <e>Configuración del Kernel</e> y la
<e>Configuración del Gestor de Arranque</e>. Aquí suminstramos un
breve resumen.
</p>
</body>
</section>

<section>
<title>Opción 1: Configuración automática del kernel con Genkernel</title>
<body>

<p>
Si usted es un usuario genkernel, solo hará falta repetir las etapas
cumplidas al instalar el kernel por primera vez.</p>

<p>
Sencillamente ejecute genkernel normalmente:
</p>

<pre caption="Invocando a genkernel">
# <i>genkernel all</i>
</pre>

<p>
También puede agregar parámetros adicionales para otras
funcionalidades de genkernel. Por ejemplo, si desea configurar
opciones adicionales para el kernel usando <c>menuconfig</c> y desea
que genkernel automáticamente actualice el archivo de configuración
del gestor de arranque grub, invoque genkernel de la siguiente manera:
</p>

<pre caption="Invocando genkernel con parámetros comunes">
# <i>genkernel --menuconfig --bootloader=grub all</i>
</pre>

<p>
Para más información, siga la <uri
link="http://www.gentoo.org/doc/en/genkernel.xml">Guía Genkernel de
Gentoo Linux</uri>, o refiérase al manual.
</p>
</body>
</section>

<section>
<title>Opción 2: Configuración Manual</title>
<body>

<p>
Para empezar, abra la herramienta <c>menuconfig</c> dentro del árbol
de fuentes del kernel:
</p>

<pre caption="Invocando menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Selecciones la opciones requeridas para su hardware y ambiente
operativo. Refiérase al <e>Manual Gentoo</e> para más información al respecto.
</p>

<p>
A continuación, compile su kernel y cópielo a su partición de
arranque. De nuevo, siga las instrucciones dadas en el Manual, pero ¡no
se olvide montar la partición /boot primero! En la instalación
inicial, la habría montada en una etapa anterior.
</p>

<pre caption="Compilando e instalando el kernel nuevo">
# <i>make &amp;&amp; make modules_install</i>
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Finalmente, actualice su archivo de configuración del gestor de
arranque, agregando una línea para el kernel nuevo (¡no borre la
anterior todavía!) y desmonte la partición <path>/boot</path>
partition. De nuevo, refiérase al Manual para instrucciones.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Reinstalando módulos externos</title>
<section>
<body>

<p>
Si usa algún módulo externo del kernel que no está incluido en el
propio árbol de fuentes y que son suministrados por otro lado en
portage (por ejemplo, los manejadores gráficos nVidia o ATI), entonces
debe reinstalarlos cada vez que actualice el kernel. Esto es tan
sencillo como volver a hacer emerge a estos paquetes. Refiérase al
<uri link="http://www.gentoo.org/doc/es/handbook/index.xml">Manual
Gentoo</uri> cuyo capítulo <e>Configurando el Kernel</e> tiene más
información. El hacer emerge de nuevo a estos paquetes asegura que
serán construidos contra las fuentes apuntadas por
<path>/usr/src/linux</path> y por ende serán instaladas para el kernel
que acabamos de compilar.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Reiniciando al nuevo kernel</title>
<section>
<body>

<p>
A continuación, cierre todas las aplicaciones y reinicie su
sistema. Si siguió las instrucciones anteriores correctamente, verá
una selección para el nuevo kernel en su gestor de
arranque. Seleccione el kernel nuevo y continue arrancando.
</p>

<p>
Esperemos que su sistema haya arrancado si problemas y que pueda hacer
login y comenzar a trabajar como siempre. Si todo funciona bien, ha
concluido la actualización en este momento.
</p>
 
<p>
Si ha cometido una equivocación y su sistema no arranca con el nuevo
kernel, entonces sencillamente arranque con el kernel anterior. Puede
recomenzar el proceso a partir de <uri link="#install">Configurando,
compilando e instalando el nuevo kernel</uri> haciendo los cambios
apropiados para corregir su error. En algunos casos (como si se hubiese
saltado compilar un manejador de red), entonces ni siquiera habría que
reiniciar la máquina.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Corriendo múltiples kernels</title>
<section>
<body>

<p>
Podrá haber notado que al instalar las fuentes de su kernel más nuevo,
las fuentes para sus demás kernels no fueron desinstaladas. Esto es a
propósito y permite cambiar fácilmente entre kernels distintos.
</p>

<p>
El cambiar entre múltiples kernels es tan sencillo como dejar que
permanezcan las fuentes bajo <path>/usr/src/</path> y los binarios
<path>bzImage</path> en la partición de arranque <path>/boot</path>
(con sus líneas de referencia en el archivo de configuración del
gestor de arranque). Cada vez que inicie, será presentado con un menú
de opciones de kernels con el cual iniciar.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Desintalando los kernels viejos</title>
<section>
<body>

<p>
Continuando desde la sección anterior, tal vez esté contento con su
kernel nuevo y no desea mantener las versiones anteriores. Para
remover fácilmente todas la fuentes de un kernel en particular, puede
aprovecharse de la opción <e>prune</e> de emerge. Continuando el
ejemplo usando gentoo-dev-sources:
</p>

<pre caption="Podando versiones anteriores">
# <i>emerge -P gentoo-dev-sources</i>
</pre>

<p>
En la mayoría de los casos, los archivos temporarios usados durante la
compilación permanecerán bajo sus respectivos directorios de fuentes
bajo <path>/usr/src</path>. Puede borrarlos seguramente con <c>rm</c>.
</p>

<p>
Puede borrar con seguridad cualquier módulo usado por este kernel,
borrando los subdirectorios apropiados bajo <path>/lib/modules/</path>
relacionados a las versiones de kernel que está borrando. ¡Tenga
cuidado de no borrar los módulos pertenecientes a kernels que estén en
uso!
</p>

<p>
Finalmente, puede montar su partición de arranque <path>/boot</path> y
borrar los archivos <path>bzImage</path> y <path>System.map</path>
para los kernels que está borrando. También puede editar el archivo de
configuración de su gestor de arranque para que haga referencias a los
kernels no existentes.
</p>
</body>
</section>
</chapter>

<chapter>
<title>¿Problemas luego de una actualización del kernel?</title>
<section>
<body>

<p>
Con el veloz desarrollo del kernel Linux, es inevitable que cambios
realizados de un lanzamiento a otro pudieran causar algún problema. Si
observa alguna situación con las últimas versiones de <uri link="http://www.gentoo.org/doc/es/gentoo-kernel.xml#doc_chap2">
Kernels soportados por Gentoo</uri>, entonces por favor agradecemos
reportarla a nosotros.
</p>
</body>
</section>
</chapter>
</guide>
