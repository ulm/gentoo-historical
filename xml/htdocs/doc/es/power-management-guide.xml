<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header -->
<guide link="/doc/es/power-management-guide.xml" lang="es">
<title>Guía de Administración de Energía</title>

<author title="Autor">
  <mail link="earthwings@gentoo.org">Dennis Nienhüser</mail>
</author>
<author title="Traductor">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Traductor">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Traductor">
  <mail link="anpereir@gentoo.org">Andrés Pereira</mail>
</author>

<abstract>
La Administración de Energía es la clave para extender el tiempo
de duración de la batería en sistemas móviles como los portátiles.
Ésta guía le ayuda a configurarla en su portátil.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.27</version>
<date>2006-02-16</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
La capacidad y el tiempo de vida de las baterías de un portátil han mejorado
mucho en los últimos años. No obstante, los procesadores modernos consumen
mucha más energía que los antiguos y cada generación de portátiles trae
consigo más dispositivos hambrientos de energía. Por eso es que la
Administración de Energía es más importante que nunca. Incrementar el
tiempo de duración de una batería no significa necesariamente comprar otra.
Mucho se puede lograr con tan sólo aplicar políticas inteligentes de
Administración de Energía.
</p>
</body>
</section>

<section>
<title>Una rápida vista general</title>
<body>

<p>
Por favor, observe que esta guía describe la Administración de Energía
para <e>portátiles</e>. Aunque algunas secciones pueden ser válidas
para <e>servidores</e>, otras no lo son e incluso pueden causar daño. Por favor,
no aplique nada de esta guía a un servidor a menos que realmente sepa lo
que está haciendo.
</p>

<p>
Como esta guía se ha convertido un poco larga, a continuación hay un corta vista
general que le ayudará a encontrar su camino a lo largo de ésta.
</p>

<p>
El capítulo de <e>Prerrequisitos</e> habla acerca de algunos requerimientos
que deberían cumplirse antes de que funcione cualquiera de las siguientes
secciones individuales de dispositivos. Esto incluye los ajustes a la BIOS,
configuración del kernel y algunas simplificaciones en el área del usuario.
Los siguientes tres capítulos se enfocan en los dispositivos que típicamente
consumen más energía - procesador, pantalla y disco duro. Cada uno puede ser
configurado de forma separada. La <e>Administración de Energía de la CPU</e>
muestra cómo ajustar la frecuencia del procesador para ahorrar un máximo de
energía sin perder mucho rendimiento. Distintos trucos previenen a su disco
duro de trabajar innecesariamente más de lo usual en la sección
<e>Administración de Energía del Disco</e> (disminuyendo el nivel de ruido
como agradable efecto secundario). Algunas notas sobre LAN inalámbricas y
USB completan la sección de dispositivos en <e>Administración de Energía
para otros dispositivos</e> mientras que otro capítulo está dedicado
(más experimentalmente) a los <e>estados de sueño</e>.  Última pero no menos
importante está la sección de <e>Solución de problemas</e> que
lista los errores comunes.
</p>
</body>
</section>

<section>
<title>Presupuesto de Energía para cada componente</title>
<body>

<figure link="/images/energy-budget.png" short="¿Cuánta energía consume cada
componente?" caption="Presupuesto de Energía para cada componente"/>

<p>
Casi toda componente puede operar en estados diferentes - apagada, durmiendo,
inactiva, activa por nombrar unos pocos - consumiendo una cantidad distinta de
energía. La mayor parte de la energía es consumida por la pantalla LCD, la CPU,
el chipset y los discos duros. Frecuentemente se puede activar la Administración
de Energía independiente del SO en la BIOS, pero una configuración inteligente
en los sistemas operativos que se adapta a situaciones diferentes puede lograr
mucho más.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Prerrequisitos</title>
<section>
<body>

<p>
Antes de discutir los detalles acerca de cómo hacer que los dispositivos
individuales sepan de sus propias capacidades de Administración de
Energía, asegúrese que se cumplan ciertos requerimientos. Después de controlar
los ajustes de la BIOS, algunas opciones del kernel deben estar activadas -
éstas son en resumen: ACPI, estados de sueño y calibración de frecuencia de
la CPU.
Como el ahorro de energía viene la mayoría de la veces junto a pérdida de
rendimiento o latencia incrementada, debería ser sólo activada cuando se están
usando las baterías. Aquí es cuando viene a mano un nuevo runlevel denominado
<e>battery</e>.
</p>
</body>
</section>

<section>
<title>La parte de la BIOS</title>
<body>

<p>
Primero demos una mirada a su configuración de Administración de Energía
en la BIOS. La mejor forma es combinar políticas de la BIOS y del sistema
operativo, pero por el momento es mejor desactivar la mayor parte referente a la
BIOS. Esto le asegura que no va a interferir con sus políticas. No olvide
revisar nuevamente su configuración de la BIOS luego de que haya configurado
el resto de las cosas.
</p>
</body>
</section>

<section>
<title>Ajustando los parámetros USE</title>
<body>

<p>
Por favor, revise que el parámetro USE <c>acpi</c> esté presente en el fichero
<path>/etc/make.conf</path>. Otros parámetros USE que pueden ser interesantes
para su sistema son: <c>apm</c>, <c>lm_sensors</c>, <c>nforce2</c>,
<c>nvidia</c> y <c>pmu</c>. Vea <path>/usr/portage/profiles/use*.desc</path>
para más detalles. Si olvidó ajustar alguno estos parámetros, puede recompilar
los paquetes afectados usando el parámetro <c>--newuse</c> al usar
<c>emerge</c>, vea <c>man 1 emerge</c>.
</p>
</body>
</section>

<section>
<title>Configurando el núcleo</title>
<body>

<p>
El soporte de ACPI (siglas en inglés de Configuración Avanzada e Interfaz
de Energía) en el núcleo aún está en progreso. Al usar un núcleo reciente se
asegurará de tener el soporte más actualizado.
</p>

<p>
Existen diferentes fuentes del núcleo en Portage. Le recomendamos usar
<c>gentoo-sources</c> o <c>suspend2-sources</c>. La última contiene parches
para Software Suspend 2, vea el capítulo sobre los estados de sueño para más
detalles. Cuando configure el núcleo, active al menos estas opciones:
</p>

<pre caption="Configuración mínima del núcleo para la Administración de Energía (Núcleo 2.6)">
Power Management Options ---&gt;
  [*] Power Management Support
  [ ] Software Suspend

  ACPI( Advanced Configuration and Power Interface ) Support ---&gt;
    [*] ACPI Support
    [ ]   Sleep States
    [ ]     /proc/acpi/sleep (deprecated)
    [*]   AC Adapter
    [*]   Battery
    &lt;M&gt;   Button
    &lt;M&gt;   Video
    [ ]   Generic Hotkey
    &lt;M&gt;   Fan
    &lt;M&gt;   Processor
    &lt;M&gt;     Thermal Zone
    &lt; &gt;   ASUS/Medion Laptop Extras
    &lt; &gt;   IBM ThinkPad Laptop Extras
    &lt; &gt;   Toshiba Laptop Extras
    (0)   Disable ACPI for systems before Jan 1st this year
    [ ]   Debug Statements
    [*]   Power Management Timer Support
    &lt; &gt;   ACPI0004,PNP0A05 and PNP0A06 Container Driver (EXPERIMENTAL)
   
  CPU Frequency Scaling ---&gt;
    [*] CPU Frequency scaling
    [ ]   Enable CPUfreq debugging
    &lt; &gt;   CPU frequency translation statistics
    [ ]     CPU frequency translation statistics details
          Default CPUFreq governor (userspace)
    &lt;*&gt;   'performance' governor
    &lt;*&gt;   'powersave' governor
    &lt;*&gt;   'ondemand' cpufreq policy governor
    &lt;*&gt;   'conservative' cpufreq governor
    &lt;*&gt;   CPU frequency table helpers
    &lt;M&gt; ACPI Processor P-States driver
    &lt;*&gt; <i>CPUFreq driver for your processor</i>
</pre>

<p>
Decida si quiere activar "Software Suspend" (Suspensión del Software),
"Suspend-to-Disk" (Suspender a Disco) y "Sleep States" (Estados de Sueño)
(ver más abajo). Si posee un portátil ASUS, Medion o Toshiba,
active la sección apropiada.
</p>

<p>
El núcleo debe saber cómo activar la calibración de la frecuencia de la CPU
en su procesador. Debido a que cada tipo de CPU tiene una interfaz distinta,
tiene que elegir el controlador apropiado para su procesador. Tenga cuidado aquí,
por ejemplo, al activar la <e>modulación del reloj de un Pentium 4</e> en un
sistema Pentium M llevará a resultados extraños. Consulte la documentación del
núcleo si no está seguro cuál elegir.
</p>

<p>
Compile su núcleo, asegúrese de que se carguen los módulos adecuados al inicio y
arranque su nuevo núcleo con ACPI activada. A continuación ejecute <c>emerge
sys-power/acpid</c> para obtener el demonio acpi. Éste le informa sobre los
eventos como el cambio de Corriente Alterna a la batería o al cerrar la tapa del
portátil. Verifique que estén cargados los módulos si es que no los
compiló en el núcleo e inicie acpid mediante  <c>/etc/init.d/acpid
start</c>. Ejecute <c>rc-update add acpid default</c>  para cargarlo al inicio.
Pronto verá cómo usarlo.
</p>

<pre caption="Instalando acpid">
# <i>emerge sys-power/acpid</i>
# <i>/etc/init.d/acpid start</i>
# <i>rc-update add acpid default</i>
</pre>
</body>
</section>

<section>
<title>Creando un nivel de ejecución "battery"</title>
<body>

<p>
La política por defecto será activar la Administración de Energía sólo
cuando se necesite, al usar baterías. Para que sea conveniente el cambio
entre Corriente Alterna y batería, haga un nivel de ejecución <e>battery</e> que
contenga todos los guiones que inician y detienen la Administración de
Energía.
</p>

<note>
Puede saltarse con seguridad esta sección si no le agrada la idea de tener otro
nivel de ejecución. No obstante, al saltarse este paso hará que el resto sea más
complicado de configurar. Las siguientes secciones asumen que existe el nivel de
ejecución <e>battery</e>.
</note>

<pre caption="Creando el nivel de ejecución battery">
# <i>cd /etc/runlevels</i>
# <i>cp -a default battery</i>
</pre>

<p>
Listo. Su nuevo nivel de ejecución <e>battery</e> contiene todo tal como el
<e>default</e>, pero todavía no existe un cambio automático entre ellos. Es hora
de cambiar eso.
</p>
</body>
</section>

<section>
<title>Reaccionando a los eventos de ACPI</title>
<body>

<p>
Entre los típicos eventos de ACPI están el cerrar la tapa del portátil, cambiar
la fuente de energía o presionar el botón para dormir. Un evento importante es
el cambiar la fuente de energía, que debería gatillar un cambio del nivel de
ejecución. Un pequeño script se encargará de esto.
</p>

<p>
Primero necesita un script que cambie el nivel de ejecución a <c>default</c>
y respectivamente a <c>battery</c> dependiendo de la fuente de energía. El
script usa el comando <c>on_ac_power</c> de <c>sys-power/powermgmt-base</c> -
asegúrese de que el paquete está instalado en su sistema.
</p>

<pre caption="Instalando powermgt-base">
<i># emerge powermgmt-base</i>
</pre>

<p>
Ahora puede determinar la fuente de energía ejecutando
<c>on_ac_power &amp;&amp; echo AC available || echo Running on batteries</c>
en una shell. El script de abajo es el responsable de cambiar los niveles
de ejecución. Guárdelo como
<path>/etc/acpi/actions/pmg_switch_runlevel.sh</path>.
</p>

<pre caption="/etc/acpi/actions/pmg_switch_runlevel.sh">
#!/bin/bash

<comment># INICIO configuración</comment>
RUNLEVEL_AC="default"
RUNLEVEL_BATTERY="battery"
<comment># FIN configuración</comment>
if [ ! -d "/etc/runlevels/${RUNLEVEL_AC}" ]
then
        logger "${0}: Runlevel ${RUNLEVEL_AC} does not exist. Aborting."
        exit 1
fi

if [ ! -d "/etc/runlevels/${RUNLEVEL_BATTERY}" ]
then
        logger "${0}: Runlevel ${RUNLEVEL_BATTERY} does not exist. Aborting."
        exit 1
fi

if on_ac_power
then
    if [[ "$(cat /var/lib/init.d/softlevel)" != "${RUNLEVEL_AC}" ]]
  then
            logger "Switching to ${RUNLEVEL_AC} runlevel"
            /sbin/rc ${RUNLEVEL_AC}
        fi
elif [[ "$(cat /var/lib/init.d/softlevel)" != "${RUNLEVEL_BATTERY}" ]]
then
        logger "Switching to ${RUNLEVEL_BATTERY} runlevel"
        /sbin/rc ${RUNLEVEL_BATTERY}
fi
</pre>

<p>
No olvide correr <c>chmod +x /etc/acpi/actions/pmg_switch_runlevel.sh</c>
para que el script sea ejecutable. La última cosa que debe ser hecha es
llamar al script siempre y cuando la fuente de energía cambie. Esto se hace
capturando los eventos ACPI con la ayuda de <c>acpid</c>. Primero necesita
saber qué eventos son generados cuando cambia la fuente de energía. Los eventos
se denominan <e>ac_adapter</e> y <e>battery</e> en la mayoría de los
portátiles, pero puede ser diferente en el suyo.
</p>

<pre caption="Determinando los eventos ACPI para cambiar la fuente de energía">
<i># tail -f /var/log/acpid | grep "received event"</i>
</pre>

<p>
Ejecute el comando de arriba y saque el cable de energía del portátil. Debería
ver algo como esto:
</p>

<pre caption="Salida de muestra para cambios de fuente de energía">
[Tue Sep 20 17:39:06 2005] received event "ac_adapter AC 00000080 00000000"
[Tue Sep 20 17:39:06 2005] received event "battery BAT0 00000080 00000001"
</pre>

<p>
La parte interesante es la cadena entre comillas después de <e>received
event</e>. Esta será contrastada por la línea de evento en los archivos que
va a crear más abajo. No se preocupe si su sistema genera múltiples eventos o
siempre el mismo. Siempre que se genere algún evento, el cambio de nivel de
ejecución funcionará.
</p>

<pre caption="/etc/acpi/events/pmg_ac_adapter">
<comment># Reemplace "ac_adapter" que aparece abajo con el evento generado en su portátil</comment>
<comment># Por ejemplo, ac_adapter.* empareja o tiene un calce con ac_adapter AC 00000080 00000000</comment>
event=ac_adapter.*
action=/etc/acpi/actions/pmg_switch_runlevel.sh %e
</pre>

<pre caption="/etc/acpi/events/pmg_battery">
<comment># Reemplace "battery" que aparece abajo con el evento generado en su portátil</comment>
<comment># Por ejemplo, battery.* empareja o tiene un calce con battery BAT0 00000080 00000001</comment>
event=battery.*
action=/etc/acpi/actions/pmg_switch_runlevel.sh %e
</pre>

<p>
Finalmente acpid tiene que ser reiniciado para reconocer los cambios.
</p>

<pre caption="Finalizando el cambio de nivel de ejecución con acpid">
<i># /etc/init.d/acpid restart</i>
</pre>

<p>
Pruébelo: Conecte su portátil a la Corriente Alterna y observe en syslog los
mensajes "Switching to AC mode" o "Switching to battery mode". Vea la sección de
Solución de Problemas si el guión no es capaz de detectar la fuente de
energía de forma apropiada.
</p>

<p>
Debido a la naturaleza del mecanismo de eventos, su portátil arrancará en el
nivel de ejecución <e>default</e> sin importar el estado de la Corriente Alterna
o la batería. Esto es adecuado cuando usa Corriente Alterna pero nos gustaría
arrancar en el nivel de ejecución battery en otros casos. Una solución sería
agregar un parámetro adicional al gestor de arranque con
<c>softlevel=battery</c>, pero es fácil que dicha elección se olvide. Una mejor
manera es falsear un evento ACPI al término del proceso de arranque y dejar que
el guión <path>/etc/acpi/default.sh</path> decida si es necesario un cambio del
nivel de ejecución. Abra  <path>/etc/conf.d/local.start</path> en su editor
favorito y agregue estas líneas:
</p>

<pre caption="Ajuste del nivel de ejecución al momento del arranque mediante la
edición de local.start">
<comment># Falsear un evento acpi para cambiarse el nivel de ejecución si se
están usando baterías
</comment>
/etc/acpi/actions/pmg_switch_runlevel.sh "battery/battery"
</pre>

<p>
Al estar preparado tal como se ha hecho antes, ya puede activar las políticas de
Administración de Energía para los dispositivos individuales.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Administración de Energía de la CPU</title>
<section>
<body>

<p>
Los procesadores de portátiles pueden operar en frecuencias diferentes. Algunos
también permiten cambiar el voltaje. La mayoría del tiempo su CPU no necesita
funcionar al máximo de rapidez y ajustarla para que disminuya hará que ahorre
mucha energía - frecuentemente sin disminución de rendimiento.
</p>
</body>
</section>

<section>
<title>Algunos términos técnicos</title>
<body>

<p>
La calibración de frecuencia de la CPU trae algunos términos técnicos que
pueden ser desconocidos. A continuación se presenta una rápida introducción.
</p>

<p>
Primero que todo, el núcleo debe ser capaz de cambiar la frecuencia del
procesador. El <e>controlador CPUfreq del procesador</e> conoce los comandos para
hacerlo en su CPU. Por lo tanto es importante elegir el controlador correcto en su
núcleo. Ya debería haber hecho esto más arriba. Una vez que el kernel sabe cómo
cambiar las frecuencias, debe conocer qué frecuencia debería configurar. Ésto es
realizado de acuerdo a la <e>política</e> que consiste de una <e>política
CPUfreq</e> y un <e>gobernador</e>. Una política CPUfreq la constituyen dos
números que definen el rango en que debe estar la frecuencia - la mínima y
máxima frecuencia. Por ejemplo, el <e>gobernador powersave</e> siempre elige la
mínima frecuencia disponible, el <e>gobernador de performance</e> elige la
más alta. El <e>gobernador userspace</e> no hace decisión alguna pero elige
aquello que el usuario (o el programa en el área del usuario) quiera - lo que
significa que lee la frecuencia desde
<path>/sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed</path>.
</p>

<p>
Éstos todavía no parecen ser los cambios dinámicos de frecuencia esperados y de
hecho no lo son. Sin embargo, es posible llevar a cabo el ansiado dinamismo
con varias aproximaciones. Por ejemplo, el <e>gobernador ondemand</e> realiza
sus decisiones dependiendo de la carga actual de la CPU. Es lo mismo que
realizan otra herramientas de usuario como <c>cpudyn</c>,
<c>cpufreq</c>, <c>powernowd</c> y muchas más. Los eventos de ACPI
pueden ser usados para activar o desactivar los cambios dinámicos dependiendo de
la fuente de energía.
</p>
</body>
</section>

<section>
<title>Ajustando manualmente la frecuencia</title>
<body>

<p>
Disminuir la velocidad de la CPU y el voltaje tiene dos ventajas: Por un lado se
consume menos energía y en el otro hay una mejora térmica ya que su sistema no
se calienta como si estuviera corriendo a toda velocidad. La principal
desventaja es que obviamente hay una pérdida de rendimiento. El disminuir la
velocidad del procesador es un contrapeso entre la pérdida de rendimiento y el
ahorro de energía.
</p>

<note>
No todo portátil ofrece la capacidad de calibración de la frecuencia. Si no i
está seguro, déle una mirada a la lista de procesadores soportados en la
sección <e>Solución de Problemas</e> para verificar si el suyo lo está.
</note>

<p>
Es hora de probar si funciona el cambio de frecuencia de la CPU. Instalemos
otra herramienta que es muy útil para propósitos de depuración:
<c>sys-power/cpufrequtils</c>
</p>

<pre caption="Chequeando la frecuencia de la CPU">
# <i>emerge cpufrequtils</i>
# <i>cpufreq-info</i>
</pre>

<p>
Aquí hay un ejemplo de la salida del comando:
</p>

<pre caption="Salida de ejemplo de cpufreq-info">
cpufrequtils 0.3: cpufreq-info (C) Dominik Brodowski 2004
Report errors and bugs to linux@brodo.de, please.
analyzing CPU 0:
  driver: centrino
  CPUs which need to switch frequency at the same time: 0
  hardware limits: 600 MHz - 1.40 GHz
  available frequency steps: 600 MHz, 800 MHz, 1000 MHz, 1.20 GHz, 1.40 GHz
  available cpufreq governors: conservative, ondemand, powersave, userspace, performance
  current policy: frequency should be within 924 MHz and 1.40 GHz.
    The governor "performance" may decide which speed to use
    within this range.
  current CPU frequency is 1.40 GHz.
</pre>

<p>
Pruebe <c>cpufreq-set</c> para estar seguro que funciona el cambio de
frecuencia. Ejecute, por ejemplo, <c>cpufreq-set -g ondemand</c> para activar
el gobernador ondemand y verifique el cambio con <c>cpufreq-info</c>. Si no
funciona como es esperado, puede encontrar ayuda en la sección Solución de
Problemas al final de esta guía.
</p>

</body>
</section>

<section>
<title>Adaptación automatizada de la frecuencia</title>
<body>

<p>
Lo de arriba es agradable, pero no para realizarlo a diario. Es mejor dejar que
su sistema ajuste automáticamente la frecuencia apropiada. Hay muchos
enfoques diferentes para hacer ésto. La siguiente tabla le da una visión
general para ayudarle a decidirse en una de ellos. Está separada en tres
categorías: <e>núcleo</e> para los enfoques que sólo necesitan apoyo en el
núcleo, <e>demonio</e> para los programas que corren en segundo plano y
<e>gráfica</e> para los programas que provean de una interfaz para realizar una
fácil configuración y cambios.
</p>

<table>
<tr>
  <th>Nombre</th>
  <th>Categoría</th>
  <th>Decisión de cambio</th>
  <th>Gobernadores del Núcleo</th>
  <th>Gobernadores adicionales</th>
  <th>Comentarios</th>
</tr>
<tr>
  <ti>Gobernador 'en demanda'</ti>
  <ti>Núcleo</ti>
  <ti>Carga de la CPU</ti>
  <ti>N/D</ti>
  <ti>N/D</ti>
  <ti>
    Elige la frecuencia máxima donde la CPU esté con carga y la disminuye
    cuando la CPU está con poca actividad. Se pueden hacer afinamientos
    adicionales a través de los archivos en
    <path>/sys/devices/system/cpu/cpu0/cpufreq/ondemand/</path>. Aún requiere
    de herramientas del área del usuario (programas y guiones) si se desea
    cambiar de gobernador (o similar).
  </ti>
</tr>
<tr>
  <ti>Gobernador 'conservador'</ti>
  <ti>Núcleo</ti>
  <ti>Carga de la CPU</ti>
  <ti>N/D</ti>
  <ti>N/D</ti>
  <ti>
    A diferencia del gobernador 'en demanda', el 'conservador' no salta a la
    frecuencia máxima cuando la carga de la CPU es alta, sino que incrementa la
    frecuencia paso a paso.
  </ti>
</tr>
<tr>
  <ti><uri link="http://mnm.uib.es/~gallir/cpudyn/">cpudyn</uri></ti>
  <ti>Demonio</ti>
  <ti>Carga de la CPU</ti>
  <ti>Performance, powersave</ti>
  <ti>"Dynamic"</ti>
  <ti>
    También permite disk standby - No obstante, note que el <e>laptop mode</e>
    hará un mejor trabajo en la mayoría de los casos.
    Se pueden hacer afinamientos adicionales a través de los archivos en
    <path>/sys/devices/system/cpu/cpu0/cpufreq/conservative/</path>. Aún
    requiere de herramientas del área del usuario (programas y guiones) si se
    desea cambiar de gobernador (o similar).
  </ti>
</tr>
<tr>
  <ti><uri link="http://sourceforge.net/projects/cpufreqd/">cpufreqd</uri></ti>
  <ti>Demonio</ti>
  <ti>Estado de la batería, carga de la CPU, temperatura, programas en ejecución</ti>
  <ti>Todos disponibles</ti>
  <ti>Ninguno</ti>
  <ti>
    Configuración sofisticada (pero también complicada). Extensible mediante
    plugins como monitoreo de sensores (lm_sensors) o posible de coordinar con
    algunas tarjetas gráficas y core basados en nVidia. Cpufreqd es capaz de
    reconocer SMP y opcionalmente puede ser controlado de forma manual en
    tiempo de ejecución.
  </ti>
</tr>
<tr>
  <ti>
    <uri link="http://www.deater.net/john/powernowd.html">powernowd</uri>
  </ti>
  <ti>Demonio</ti>
  <ti>Carga de la CPU</ti>
  <ti>Ninguno</ti>
  <ti>"Passive", "sine", "aggressive"</ti>
  <ti>
    Acepta SMP.
  </ti>
</tr>
<tr>
  <ti>
    <uri link="http://fatcat.ftj.agh.edu.pl/~nelchael/index.php?cat=projs&amp;subcat=ncpufreqd&amp;language=en">ncpufreqd</uri>
  </ti>
  <ti>Demonio</ti>
  <ti>Temperatura</ti>
  <ti>Ninguno</ti>
  <ti>"Powersave", "Performance"</ti>
  <ti>
    Activa el gobernador a usar entre "performance" y "powersave" dependiendo
    de la temperatura del sistema. Muy útil en portátiles con notorios
    problemas de calentamiento.
  </ti>
</tr>
<tr>
  <ti><uri link="http://www.goop.org/~jeremy/speedfreq/">speedfreq</uri></ti>
  <ti>Demonio</ti>
  <ti>Carga de la CPU</ti>
  <ti>Ninguno</ti>
  <ti>"Dynamic", "powersave", "performance", "fixed speed"</ti>
  <ti>
    Fácil de configurar con una útil interfaz cliente/servidor. Requiere de un
    núcleo 2.6. No parece seguir siendo mantenido y fue borrado de Portage. Por
    favor, cámbiese a cpufreqd si todavía lo está usando.
  </ti>
</tr>
<tr>
  <ti><uri link="http://cpuspeedy.sourceforge.net/">gtk-cpuspeedy</uri></ti>
  <ti>Gráfica</ti>
  <ti>Ninguno</ti>
  <ti>Ninguno</ti>
  <ti>Ninguno</ti>
  <ti>
    Herramienta gráfica de Gnome para ajustar manualmente la frecuencia de la
    CPU. No ofrece automatización alguna.
  </ti>
</tr>
<tr>
  <ti>klaptopdaemon</ti>
  <ti>Gráfica</ti>
  <ti>Estado de la batería</ti>
  <ti>Todos disponibles</ti>
  <ti>Ninguno</ti>
  <ti>
    Sólo para KDE, se requiere del gobernador 'ondemand' para la calibración
    dinámica de frecuencia.
  </ti>
</tr>
</table>

<p>
Aunque a primera vista parece simple ajustar la frecuencia al nivel actual de
carga, no es una tarea trivial. Un mal algoritmo puede causar que se cambie
entre dos frecuencias todo el tiempo o gastar energía cuando se ajusta la
frecuencia a un nivel innecesariamente alto.
</p>

<p>
¿Cuál elegir? Si no tiene idea acerca de esto, primero intente <c>cpufreqd</c>:
</p>

<pre caption="Instalando cpufreqd">
# <i>emerge cpufreqd</i>
</pre>

<p>
<c>cpufreqd</c> puede ser configurado editando <path>/etc/cpufreqd.conf</path>.
La configuración por defecto que viene con cpufreqd puede parecer algo
confusa. Recomendamos reemplazarla con la hecha por el desarrollador de Gentoo
Henrik Brix Andersen (ver más abajo). Por favor, observe que necesita la
versión cpufreqd-2.0.0 o superior. Las versiones previas tienen una sintaxis
diferente para el archivo de configuración.
</p>

<pre caption="/etc/cpufreqd.conf (cpufreqd-2.0.0 y siguientes)">
[General]
pidfile=/var/run/cpufreqd.pid
poll_interval=3
enable_plugins=acpi_ac, acpi_battery
enable_remote=1
remote_group=wheel
verbosity=5
[/General]

[Profile]
name=ondemand
minfreq=0%
maxfreq=100%
policy=ondemand
[/Profile]

[Profile]
name=conservative
minfreq=0%
maxfreq=100%
policy=conservative
[/Profile]

[Profile]
name=powersave
minfreq=0%
maxfreq=100%
policy=powersave
[/Profile]

[Profile]
name=performance
minfreq=0%
maxfreq=100%
policy=performance
[/Profile]

[Rule]
name=battery
ac=off
profile=conservative
[/Rule]

[Rule]
name=battery_low
ac=off
battery_interval=0-10
profile=powersave
[/Rule]

[Rule]
name=ac
ac=on
profile=ondemand
[/Rule]
</pre>

<p>
Ahora puede iniciar el demonio cpufreqd. Agréguelo a los niveles de ejecución
<e>default</e> y <e>battery</e> también.
</p>

<pre caption="Iniciando cpufreqd">
# <i>rc-update add cpufreqd default battery</i>
# <i>rc</i>
</pre>

<p>
Algunas veces puede ser deseable seleccionar otra política distinta a la
escogida por el demonio, por ejemplo, cuando la energía de la batería está baja
pero sabe que tendrá pronto disponible corriente alterna (AC). En ese caso
puede activar el modo manual de cpufreqd con <c>cpufreqd-set manual</c> y
seleccionar una de sus políticas configuradas (listadas por
<c>cpufreqd-get</c>). Puede dejar el modo manual ejecutando
<c>cpufreqd-set dynamic</c>.
</p>

<warn>
No ejecute al mismo tiempo más de uno de los programas indicados arriba.
Puede causar confusión como intercambios sucesivos entre dos frecuencias.
</warn>

</body>
</section>

<section>
<title>Verificando el resultado</title>

<body>

<p>
La última cosa por chequear es que sus nuevas políticas hagan bien el trabajo.
Una forma fácil de comprobarlo es monitorizando la velocidad de la CPU mientras
esté trabajando con su portátil:
</p>

<pre caption="Monitoreando la velocidad de la CPU">
# <i>watch grep \"cpu MHz\" /proc/cpuinfo</i>
</pre>

<p>
Si no se actualiza <path>/proc/cpuinfo</path> (ver sección de Solución de
Problemas), monitoree la frecuencia de la CPU con:
</p>

<pre caption="Monitoreo alternativo de la velocidad de la CPU">
# <i>watch x86info -mhz</i>
</pre>

<p>
Dependiendo de su configuración, la velocidad de la CPU debería aumentar en
situaciones de alta carga, disminuir cuando no hay actividad o permanecer en el
mismo nivel. Cuando se usa cpufreqd y el nivel de verbosidad está ajustado en
5 o más en <path>cpufreqd.conf</path>, obtendrá información adicional de
lo que está pasando y será reportada a syslog.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Administración de Energía de la pantalla LCD</title>
<section>
<body>
<p>
Como puede ver en la <uri link="#doc_chap1_fig1">figura 1.1</uri>, la pantalla
LCD consume la mayor parte de la energía (puede que no sea el caso para CPUs no
móviles). Por tanto, es bien importante no sólo apagar la pantalla cuando ésta
no se necesite, sino también reducir su contraluz si es posible. La mayoría de
los portátiles ofrece la posibilidad para controlar la disminución de aquello.
</p>
</body>
</section>

<section>
<title>Ajustes de Standby</title>
<body>

<p>
La primera cosa a revisar son los tiempos de standby/suspensión/apagado de la
pantalla. Como esto depende fuertemente de su gestor de ventanas, le dejaremos
esa tarea. Hay dos lugares en común: Se puede blanquear el terminal con 
<c>setterm -blank &lt;número de minutos&gt;</c>, <c>setterm -powersave on</c> y
<c>setterm -powerdown &lt;número de minutosM&gt;</c>.
Para X.org, modifique  <path>/etc/X11/xorg.conf</path> en forma similar a ésto:
</p>

<pre caption="Ajustes para suspender el LCD en X.org y XFree86">
Section "ServerLayout"
  Identifier  [...]
  [...]
  Option  "BlankTime"  "5"  <comment># Blanquea la pantalla luego de 5 minutos (Falso)</comment>
  Option  "StandbyTime"  "10"  <comment># Apaga la pantalla luego de minutos (DPMS)</comment>
  Option  "SuspendTime"  "20"  <comment># Suspensión total luego de 20 minutos</comment>
  Option  "OffTime"  "30"  <comment># Apagado completo pasado una media hora</comment>
  [...]
EndSection

[...]

Section "Monitor"
  Identifier  [...]
  Option  "DPMS"  "true"
  [...]
EndSection
</pre>

<p>
Esto es lo mismo para XFree86 y <path>/etc/X11/XF86Config</path>.
</p>
</body>
</section>

<section>
<title>Disminución de contraluz</title>
<body>

<p>
Probablemente es más importante la disminución de contraluz. Si tiene acceso a
los ajustes de disminución vía alguna herramienta, escriba un pequeño guión que
disminuya el contraluz en el modo battery y ubíquelo en su nivel de ejecución
<e>battery</e>. El siguiente script debería funcionar en la mayoría de los
portátiles IBM Thinkpad y Toshiba. Tiene que activar la opción apropiada en
su núcleo (Sólo para pórtatiles IBM Thinkpad). Para pórtatiles Toshiba,
instale el paquete <c>app-laptop/acpitool</c> y salte la configuración de
ibm_acpi descrita más abajo.
</p>

<warn>
El soporte para el ajusto del brillo está marcado como experimental en
ibm-acpi. Este accede directamente al hardware y puede causar daño severo
a su sistema. Por favor, lea el <uri link="http://ibm-acpi.sourceforge.net/">
sitio Web ibm-acpi</uri>.
</warn>

<p>
Para poder ajustar el nivel de brillo debe ser cargado el módulo ibm_acpi
con el parámetro experimental.
</p>

<pre caption="Cargar automáticamente el módulo ibm_acpi">
<comment>(¡Por favor, lea las advertencias indicadas arriba antes de seguir!)</comment>
<i># echo "options ibm_acpi experimental=1" >> /etc/modules.d/ibm_acpi</i>
<i># /sbin/modules-update</i>
<i># echo ibm_acpi >> /etc/modules.autoload.d/kernel-2.6</i>
<i># modprobe ibm_acpi</i>
</pre>

<p>
Esto debería funcionar sin mensajes de error y debería ser creado el
archivo <path>/proc/acpi/ibm/brightness</path> luego de que sea cargado
el módulo. Un script de inicio se preocupará de elegir el brillo de acuerdo
a la fuente de energía que esté presente.
</p>

<pre caption="/etc/conf.d/lcd-brightness">
<comment># Vea /proc/acpi/ibm/brightness para los valores disponibles</comment>
<comment># Por favor lea /usr/src/linux/Documentation/ibm-acpi.txt</comment>

<comment># Nivel de brillo en modo CA (Corriente Alterna). El valor por defecto es 7.</comment>
BRIGHTNESS_AC=7

<comment># Nivel de brillo en modo batería. El valor por defecto es 4.</comment>
BRIGHTNESS_BATTERY=4
</pre>

<pre caption="/etc/init.d/lcd-brightness">
#!/sbin/runscript

set_brightness() {
    if on_ac_power
    then
        LEVEL=${BRIGHTNESS_AC:-7}
    else
        LEVEL=${BRIGHTNESS_BATTERY:-4}
    fi

    if [ -f /proc/acpi/ibm/brightness ]
    then
        ebegin "Setting LCD brightness"
        echo "level ${LEVEL}" > /proc/acpi/ibm/brightness
        eend $?
    elif [[ -e /usr/bin/acpitool &amp;&amp; -n $(acpitool -T | grep "LCD brightness") ]]
    then
        ebegin "Setting LCD brightness"
        acpitool -l $LEVEL >/dev/null || ewarn "Unable to set lcd brightness"
        eend $?
    else
        ewarn "Setting LCD brightness is not supported."
        ewarn "For IBM Thinkpads, check that ibm_acpi is loaded into the kernel"
        ewarn "For Toshiba laptops, you've got to install app-laptop/acpitool"
    fi
}

start() {
    set_brightness
}

stop () {
    set_brightness
}
</pre>

<p>
Cuando esté listo, asegúrese de que el brillo sea ajustado de forma automática
mediante la adición de este al nivel de ejecución battery.
</p>

<pre caption="Activando el ajuste de brillo automático">
<i># chmod +x /etc/init.d/lcd-brightness</i>
<i># rc-update add lcd-brightness battery</i>
<i># rc</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Administración de energía del Disco</title>
<section>
<body>

<p>
Los discos duros consumen menos energía en el modo "sleep". Por lo tanto, tiene
sentido activar las características de ahorro de energía siempre y cuando el
disco no esté siendo usado por una cierta cantidad de tiempo. Le mostraremos
dos posibles alternativas para hacerlo. Primero, el "laptop-mode"
ahorrará la mayor cantidad de energía debido a las muchas mediciones que
impiden o al menos retrasan los accesos de escritura. La desventaja es que
a causa de los accesos de escritura retrasados, en caso de corte de energía o
caída abrupta del núcleo será más riesgoso a la pérdida de datos. Si no le
agrada esto, tiene que asegurarse que no hay procesos que escriban con
frecuencia al disco. Luego puede activar las características de ahorro de
energía del disco duro con hdparm como segunda alternativa.
</p>

</body>
</section>

<section>
<title>Aumentando el tiempo de inactividad - laptop-mode</title>
<body>

<p>
Los núcleos recientes (2.6.6 y superiores, versiones actuales de la serie 2.4 y
otros con parches) incluyen el denominado <e>laptop-mode</e>. Cuando está
activado, los contenidos de las memorias de tránsito en estado sucio se escriben
a disco cuando hay llamadas de lectura o después de 10 minutos (en vez de 30
segundos).  Esto minimiza el tiempo de rotación del disco.
</p>

<pre caption="Inicio automátizado del laptop-mode">
# <i>emerge laptop-mode-tools</i>
</pre>

<p>
<c>laptop-mode-tools</c> tiene su archivo de configuración en
<path>/etc/laptop-mode/laptop-mode.conf</path>. Ajústelo como le plazca, está
bien documentado. Ejecute <c>rc-update add laptop_mode battery</c> para
iniciarlo automáticamente.
</p>

<p>
Las versiones recientes (1.11 y siguientes) de laptop-mode-tools incluyen una
herramienta nueva: <c>lm-profiler</c>. Esta monitorizará el uso de disco de
su sistema, los servicios de red en ejecución y sugiere desactivar aquellos
innecesarios. Puede ya sea desactivarlo a través del soporte de niveles de
ejecución incluido en laptop-mode-tools (lo que puede ser revertido por el
<c>/sbin/rc</c> de Gentoo) o usar sus niveles de ejecución <e>default</e>/
<e>battery</e> (recomendado).
</p>

<pre caption="Salida de muestra de lm-profiler en ejecución">
# lm-profiler
Profiling session started.
Time remaining: 600 seconds
[4296896.602000] amarokapp
Time remaining: 599 seconds
[4296897.714000] sort
[4296897.970000] mv
Time remaining: 598 seconds
Time remaining: 597 seconds
[4296900.482000] reiserfs/0
</pre>

<p>
Luego de realizar un perfil de su sistema por unos 10 minutos, lm-profiler
presentará una lista de servicios que pueden haber causado accesos a disco
durante este tiempo.
</p>

<pre caption="lm-profiler sugiere desactivar algunos servicios">
Program:     "atd"
Reason:      standard recommendation (program may not be running)
Init script: /etc/init.d/atd (GUESSED)

Do you want to disable this service in battery mode? [y/N]: n
</pre>

<p>
Para desactivar atd como se sugiere en el ejemplo de arriba, tendría que
ejecutar <c>rc-update del atd battery</c>. Sea cuidadoso en no desactivar
servicios que son necesarios para que su sistema funcione adecuadamente
- lm-profiler es probable que genere algunos falsos positivos. No desactive
un servicio si está inseguro que este es necesario.
</p>
</body>
</section>

<section>
<title>Limitar los accesos de escritura</title>
<body>

<p>
Si no quiere usar el laptop-mode, debe prestar especial cuidado para desactivar
los servicios que escriben frecuentemente a su disco - por ejemplo,
<c>syslogd</c> es un buen candidato. Probablemente no querrá apagarlo por
completo, pero es posible modificar el archivo de configuración de manera que
las cosas innecesarias no se escriban a la bitácora y por tanto, no creen
tráfico a disco. Cups escribe a disco periódicamente, así que considere
desactivarlo y sólo actívelo de forma manual cuando sea necesario.
</p>

<pre caption="Desactivar cups en el modo battery">
# <i>rc-update del cupsd battery</i>
</pre>

<p>
También puede usar <c>lm-profiler</c> de laptop-mode-tools (ver más arriba)
para encontrar los servicios a desactivar. Una vez que los haya eliminado todos,
siga con la configuración de hdparm.
</p>

</body>
</section>

<section>
<title>hdparm</title>
<body>

<p>
La segunda posibilidad es usar un pequeño guión y hdparm. Omita esto si está
usando laptop-mode. De otro modo cree el archivo
<path>/etc/init.d/pmg_hda</path>:
</p>
<pre caption="Usando hdparm para la suspensión temporal del disco">
#!/sbin/runscript

depend() {
after hdparm
}

start() {
ebegin "Activating Power Management for Hard Drives"
hdparm -q -S12 /dev/hda
eend $?
}

stop () {
ebegin "Deactivating Power Management for Hard Drives"
hdparm -q -S253 /dev/hda
eend $?
}
</pre>

<p>
Revise las opciones con <c>man hdparm</c>. Si su guión está listo, agréguelo al
nivel de ejecución battery.
</p>

<pre caption="Automatizando la configuración de la suspensión temporal del disco">
# <i>chmod +x /etc/init.d/pmg_hda</i>
# <i>/sbin/depscan.sh</i>
# <i>rc-update add pmg_hda battery</i>
</pre>

<impo>
Sea cuidadoso con los ajustes de disminución de velocidad/rotación de su disco
duro. Ajustándolos a valores pequeños puede que dañe su disco y pierda la
garantía.
</impo>
</body>
</section>

<section>
<title>Otros trucos</title>
<body>

<p>
Otra posibilidad es desactivar el archivo de intercambio ("swap") en el modo
batería. Antes de escribir el guión para realizar el swapon/swapoff, asegúrese
que haya suficiente memoria RAM y que el archivo de intercambio no se use
intensivamente, de otro modo estará en problemas.
</p>

<p>
Si no quiere usar el laptop-mode, todavía es posible minimizar el acceso
al disco montando ciertos directorios como <e>tmpfs</e> - los accesos de
escritura no son almacenados en el disco sino que permanecen en memoria
principal y se pierden al desmontar. A menudo es útil montar el directorio
<path>/tmp</path> de esta forma - pues no se le presta mayor atención
ya que se limpia en cada arranque sin importar si fue montado en disco
o en RAM. Sólo asegúrese tener suficiente RAM y que no haya algún programa
(tal como un cliente de descargas o herramienta de compresión) que necesite
mucho espacio en <path>/tmp</path>. Para activar ésto, active la opción de
tmpfs en su núcleo y agregue a una línea como la siguiente al
<path>/etc/fstab</path>:
</p>

<pre caption="Editando /etc/fstab para que el /tmp sea aún más volátil">
none  /tmp  tmpfs  size=32m  0 0
</pre>

<warn>
Preste atención al parámetro "size" y modifíquelo para su sistema. Si no está
seguro, no intente probar esto, puede convertirse fácilmente en un cuello
de botella del rendimiento. En caso de que quiera montar el
<path>/var/log</path> de esta manera, asegúrese de escribir los archivos de
bitácora a disco antes de desmontar el directorio. Son archivos esenciales.
No intente montar el directorio /var/tmp de esta forma. Portage lo usa para
compilar ...
</warn>

</body>
</section>
</chapter>

<chapter>
<title>Administración de Energía para otros dispositivos</title>
<section>
<title>Tarjetas gráficas</title>
<body>

<p>
En caso de que posea una tarjeta gráfica ATI que soporte PowerPlay (escalado
dinámico del reloj para la unidad gráfica de procesamiento GPU), puede activar
esta característica en X.org. Abra el archivo <path>/etc/X11/xorg.conf</path>
y agregue (o active) la opción <c>DynamicClocks</c> en la sección Device. Por
favor note que esta característica puede resultar en caídas o cuelgues en
algunos sistemas.
</p>

<pre caption="Activando el soporte PowerPlay de ATI en X.org">
Section "Device"
[...]
Option      "DynamicClocks" "on"
EndSection
</pre>

</body>
</section>

<section>
<title>Administración de Energía para tarjetas inalámbricas</title>
<body>

<p>
Las tarjetas LAN inalámbricas consumen bastante energía. Colóquelas en el
modo de Administración de Energía en analogía al guión pmg_hda.
</p>

<note>
Este guión asume que su interfaz inalámbrica se llama <c>wlan0</c>; reemplácela
con el nombre real de su interfaz.
</note>

<pre caption="Administración de Energía automatizada para WLAN">
#!/sbin/runscript
start() {
  ebegin "Activating Power Management for Wireless LAN"
  iwconfig wlan0 power on
  eend $?
}

stop () {
  ebegin "Deactivating Power Management for Wireless LAN"
  iwconfig wlan0 power off
  eend $?
}
</pre>

<p>
Al iniciar este guión se activarán las características de ahorro de energía para
wlan0. Guárdelo como  <path>/etc/init.d/pmg_wlan0</path> y
agréguelo al nivel de ejecución battery tal como se hizo con el guión para el
disco de más arriba. Vea <c>man iwconfig</c> para más detalles y opciones como
el periodo de tiempo entre despertares (wakeups) o ajustes de timeouts. Si
su controlador y punto de acceso están habilitados para cambiar el tiempo de
reconocimiento de la señal ("beacon time"), ésto es un buen punto de partida
para ahorrar aún más energía:
</p>

<pre caption="Administración de Energía de WLAN">
# <i>chmod +x /etc/init.d/pmg_wlan0</i>
# <i>/sbin/depscan.sh</i>
# <i>rc-update add pmg_wlan0 battery</i>
</pre>
</body>
</section>

<section>
<title>Administración de Energía USB</title>
<body>

<p>
Existen dos problemas con los dispositivos USB respecto al consumo de
energía: Primero, los dispositivos como el mouse USB, cámaras digitales
o llaveros USB consumen energía mientras están enchufados. No puede evitar
ésto (no obstante desenchúfelos es caso de que no se necesiten). Segundo, cuando
hay dispositivos USB enchufados, la controladora USB accede periódicamente
al bus lo que previene que la CPU entre en el modo "sleep". El núcleo ofrece
una opción experimental para activar la suspensión de dispositivos USB a través
de llamadas del driver o uno de los archivos <path>power/state</path> en
<path>/sys</path>.
</p>

<pre caption="Activando el soporte USB suspend en el núcleo">
Device Drivers
  USB support
    [*]   Support for Host-side USB
      [*]   USB suspend/resume (EXPERIMENTAL)
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Estados de sueño: Suspensión, en espera e hibernación </title>
<section>
<body>

<p>
ACPI define tres estados de sueño. Los más importantes son:
</p>

<ul>
  <li>S1 alias En espera ("standby")</li>
  <li>S3 alias Suspensión a RAM o Suspensión</li>
  <li>S4 alias Suspensión a Disco o Hibernación</li>
</ul>

<p>
Dichos estados pueden ser invocados siempre y cuando el sistema no
esté en uso de forma de evitar apagar el sistema debido al largo tiempo
de arranque.
</p>
</body>
</section>
<section>
<title>Suspensión (S3)</title>
<body>

<p>
El soporte de ACPI para estos estados de suspensión es considerado experimental
por una buen motivo. Los estados de sueño de APM parecen ser más estables, sin
embargo, no puede usar APM y ACPI juntos.
</p>

<pre caption="Configuración del núcleo para los varios tipos de suspensión">
  Power Management Options ---&gt;
    [*]  Power Management support
      ACPI (Advanced Configuration and Power Interface) Support ---&gt;
        [*]  ACPI Support
          [*]   Sleep States
</pre>

<p>
Una vez que su núcleo esté configurado adecuadamente, puede usar el
script <c>hibernate-script</c> para activar el modo de suspensión o sueño.
Instalaremos esto primero.
</p>

<pre caption="Instalando el hibernate-script">
<i># emerge hibernate-script</i>
</pre>

<p>
Deben configurarse algunas cosas en <path>/etc/hibernate</path>. El paquete
por defecto incorpora dos archivos de configuración: <path>hibernate.conf</path>
y <path>ram.conf</path>.
</p>

<p>
Para configurar la suspensión, edite <path>ram.conf</path> en
<path>/etc/hibernate</path>. <c>UseSysfsPowerState mem</c> está
ya configurado correctamente, pero tiene seguir con el resto del archivo de
configuración y ajustarlo a su sistema. Los comentarios y nombres de opciones
le servirán de guía. Si usa NFS o recursos compartidos en red vía Samba,
asegúrese de apagar los scripts de inicio apropiados para evitar timeouts.
</p>

<p>
¿Listo? Ahora es la última oportunidad de respaldar aquellos datos que desea
preservar luego de ejecutar el siguiente comando. Note que probablemente tendrá
que presionar una tecla especial como <e>Fn</e> para volver desde el estado
de suspensión.
</p>

<pre caption="Llamando al estado de suspensión">
<i># hibernate-ram</i>
</pre>

<p>
Si todavía está leyendo es porque funciona. Puede también configurar standby
(S1) en forma similar copiado el archivo <path>ram.conf</path> a
<path>standby.conf</path> y creando un enlace simbólico
<path>/usr/sbin/hibernate-standby</path> apuntando a
<path>/usr/sbin/hibernate</path>. S3 y S4 son los estados de sueño más
interesantes debido a los mayores ahorros de energía involucrados.
</p>

</body>
</section>
<section>
<title>Hibernar (S4)</title>
<body>

<p>
Esta sección lo introduce al concepto de hibernación, donde una "foto" del
sistema en ejecución se lleva a disco antes de apagarlo. Al regreso, la
"foto" se carga y puede seguir trabajando exactamente en el punto donde
ejecutó antes la hibernación.
</p>

<warn>
No intercambie hardware no hot-pluggable cuando está en el modo suspensión. No
intente cargar una "foto" con una imagen del núcleo diferente de la que se creó.
Apague cualquier servidor/cliente NFS o Samba antes de hibernar.
</warn>

<p>
Existen dos implementaciones distintas para S4. El original denominado
swsusp, luego está la más nueva, swsusp2, que tiene una interfaz agradable
(incluyendo soporte para fbsplash). Una <uri
link="http://suspend2.net/features.html#compare">comparación de características
</uri> está disponible en la <uri link="http://suspend2.net">página Web de
suspend2</uri>. Solía existir Suspend-to-Disk (pmdisk), un proyecto clon
de swsusp, pero fue mezclado con el anterior.
</p>

<p>
Suspend2 todavía no está incluido en el núcleo principal, por tanto, tendrá
que parchar sus fuentes del núcleo con los parches ofrecidos por
<uri link="http://suspend2.net">suspend2.net</uri> o usar
<c>sys-kernel/suspend2-sources</c>.
</p>

<p>
La parte relacionada al núcleo para swsup y suspend2 es como sigue:
</p>

<pre caption="Configuración del núcleo para los diversos tipos de suspensión">
Power Management Options ---&gt;
  <comment>(hibernación con swsusp)</comment>
  [*] Software Suspend
      <comment>(reemplace /dev/SWAP con su partición de intercambio</comment>
      (/dev/SWAP)      Default resume partition

  <comment>(hibernación con swsusp2)</comment>
  Software Suspend 2
    --- Image Storage (you need at least one writer)
    [*]     File Writer
    [*]    Swap Writer
    ---   General Options
    [*]    LZF image compression
    <comment>(reemplace /dev/SWAP con su partición de intercambio</comment>
    (swap:/dev/SWAP)   Default resume device name
    [ ]     Allow Keep Image Mode
</pre>

<p>
La configuración para swsup es fácil. Si no guardó la ubicación de su partición
de intercambio en la configuración del núcleo, puede pasarla también como
parámetro con la directiva <c>resume=/dev/SWAP</c> (Reemplazando SWAP por su
partición de intercambio). Si no puede arrancar posiblemente debido a una
imagen dañada, use el parámetro <c>noresume</c> del núcleo. El script de
inicio <c>hibernate-cleanup</c> invalida las imagenes swsusp durante el proceso
de arranque.
</p>

<pre caption="Invalidando las imagenes swsup durante el proceso de arranque">
<i># rc-update add hibernate-cleanup boot</i>
</pre>

<p>
Para activar la hibernación con swsup use el script hibernate y ajuste
<c>UseSysfsPowerState disk</c> en <path>/etc/hibernate/hibernate.conf</path>.
</p>

<warn>
Respalde sus datos antes de hacer esto. Corra <c>sync</c> antes de ejecutar
uno de los comando para llevar los datos en caché a disco. Primero inténtelo
fuera del servidor X, luego con X corriendo pero sin haber ingresado.
</warn>

<p>
Si experimenta errores del tipo "kernel panic" debido a uhci o similar, intente
compilar el soporte USB como módulo y descargue los módulos antes de enviar su
portátil al modo de suspensión. Hay opciones de configuración para esto en
el archivo <path>hibernate.conf</path>.
</p>

<pre caption="Hibernando con swsusp">
<i># nano -w /etc/hibernate.conf</i>
<comment>(Asegúrese de haber respaldado sus datos)</comment>
<i># hibernate</i>
</pre>

<p>
La siguiente sección discute la configuración de suspend2 incluyendo el soporte
de fbsplash para obtener una agradable barra de progreso durante la suspensión
y reactivación (resume).
</p>

<p>
La primera parte de la configuración es similar a la hecha para swsup.Si no
guardó la ubicación de su partición de intercambio en la configuración del
núcleo, tiene que pasarla como parámetro del núcleo con la directiva
<c>resume2=swap:/dev/SWAP</c> (Reemplazando SWAP por su
partición de intercambio). Si no puede arrancar posiblemente debido a una
imagen dañada, use el parámetro <c>noresume2</c> del núcleo. Adicionalmente,
el script de inicio <c>hibernate-cleanup</c> invalida las imagenes suspend2
durante el proceso de arranque.
</p>

<pre caption="Invalidando las imagenes suspend2 durante el proceso de arranque">
<i># rc-update add hibernate-cleanup boot</i>
</pre>

<p>
Ahora edite <path>/etc/hibernate/hibernate.conf</path>, active la sección
<e>suspend2</e> y comente todo en las secciones <e>sysfs_power_state</e> y
<e>acpi_sleep</e>. No active todavía la parte fbsplash en las opciones globales.
</p>

<pre caption="Hibernando con suspend2">
<i># nano -w /etc/hibernate.conf</i>
<comment>(Asegúrese de tener un respaldo de sus datos)</comment>
<i># hibernate</i>
</pre>

<p>
Por favor configure ahora fbsplash si no lo ha hecho hasta ahora. Para activar
el soporte de fbsplash durante la hibernación, se necesita el paquete
<c>sys-apps/suspend2-userui</c>. Adicionalmente, debe activar la bandera USE
<e>fbsplash</e>.
</p>

<pre caption="Instalando suspend2-userui">
<i># mkdir -p /etc/portage</i>
<i># echo sys-apps/suspend2-userui fbsplash >> /etc/portage/package.use</i>
<i># emerge suspend2-userui</i>
</pre>

<p>
El ebuild le dice que haga un enlace simbólico al tema que desea usar. Por
ejemplo, para usar el tema <c>livecd-2005.1</c>, ejecute el siguiente comando:
</p>

<pre caption="Usando el tema livecd-2005.1 durante la hibernación">
<i># ln -sfn /etc/splash/livecd-2005.1 /etc/splash/suspend2</i>
</pre>

<p>
Si no quiere que aparezca una pantalla negra en la primera parte del proceso
de vuelta, tiene que agregar la herramienta <c>suspend2ui_fbsplash</c> a su
imagen initrd. Asumiendo que creó la imagen initrd con
<c>splash_geninitramfs</c> y la guardó como
<path>/boot/fbsplash-emergence-1024x768</path>, aquí es como se hace esto.
</p>

<pre caption="Agregando suspend2ui_fbsplash a la imagen initrd">
<i># mount /boot</i>
<i># mkdir ~/initrd.d</i>
<i># cp /boot/fbsplash-emergence-1024x768 ~/initrd.d/</i>
<i># cd ~/initrd.d</i>
<i># gunzip -c fbsplash-emergence-1024x768 | cpio -idm --quiet -H newc</i>
<i># rm fbsplash-emergence-1024x768</i>
<i># cp /usr/sbin/suspend2ui_fbsplash sbin/</i>
<i># find . | cpio --quiet --dereference -o -H newc | gzip -9 > /boot/fbsplash-suspend2-emergence-1024x768</i>
</pre>

<p>
A continuación, ajuste <path>grub.conf</path> y respectivamente
<path>lilo.conf</path> de manera que su núcleo suspend2 use
<path>/boot/fbsplash-suspend2-emergence-1024x768</path> como imagen initrd.
Ahora puede si todo fue configurado correctamente.
</p>

<pre caption="Prueba para la hibernación fbsplash">
<i># suspend2ui_fbsplash -t</i>
</pre>

<p>
Después abra <path>/etc/hibernate/hibernate.conf</path> nuevamente y active
las opciones fbsplash. Ejecute <c>hibernate</c> y disfrute.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Solución de Problemas</title>
<section>
<body>

<p>
<e>P:</e>
Estoy intentando cambiar la frecuencia de la CPU pero
<path>/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</path> no existe.
</p>

<p>
<e>R:</e>Asegúrese que su procesador soporta la característica de calibración
de frecuencia de la CPU y que haya elegido el controlador CPUFreq adecuado (kernel
2.6.7): ARM Integrator, ARM-SA1100,ARM-SA1110, AMD Elan - SC400, SC410,
AMD mobile K6-2+, AMD mobile K6-3+, AMD mobile Duron, AMD mobile Athlon,
AMD Opteron, AMD Athlon 64, Cyrix Media GXm,
Intel mobile PIII e Intel mobile PIII-M en algunos chipsets, Intel Pentium 4,
Intel Xeon, Intel Pentium M (Centrino), National Semiconductors Geode GX,
Transmeta Crusoe, VIA Cyrix 3 / C3, UltraSPARC-III, SuperH SH-3, SH-4, varios
"PowerBook" e "iBook2" y algunos procesadores en sistemas ACPI 2.0-compatible
(sólo si está disponible la opción "ACPI Processor Performance States" en la
interfaz ACPI/BIOS).
</p>

<p>
<e>P:</e> Mi portátil tiene la capacidad de calibración de la frecuencia, pero
<path>/sys/devices/system/cpu/cpu0/cpufreq/</path> está vacío.
</p>

<p>
<e>R:</e> Revise los errores relacionados a ACPI en el núcleo con
<c>dmesg | grep ACPI</c>. Intente actualizar la BIOS, en especial
si se reporta que está dañado el DSDT. También puede intentar arreglándolo
por si mismo (lo que escapa del alcance de esta guía).
</p>

<p>
<e>P:</e> Mi portátil tiene la capacidad de calibración de la frecuencia, pero
de acuerdo a <path>/proc/cpuinfo</path> la velocidad nunca cambia.
</p>

<p>
<e>R:</e> Es probable que haya activado en su núcleo el soporte para
multiprocesamiento simétrico (CONFIG_SMP). Desactívelo y debería funcionar.
Algunos núcleos antiguos tienen un error que causa ésto. En ese caso, ejecute
<c>emerge x86info</c>, actualice su núcleo tal como se pide y chequee la
frecuencia actual con <c>x86info -mhz</c>.
</p>

<p>
<e>P:</e> Puedo cambiar la frecuencia de la CPU, no obstante el rango no
es tan amplio como lo es en otro SO.
</p>

<p>
<e>R:</e> Puede combinar la calibración de la frecuencia con la regulación
de temperatura de la CPU ("ACPI CPU throttling") para obtener un mínimo más bajo
de frecuencia. Note que la regulación de temperatura del procesador no ahorra
mucha energía y se usa principalmente con propósitos de gestión térmica
(mantener su portátil a baja temperatura y en silencio). Puede leer el estado
actual de regulación de temperatura del procesador con <c>cat
/proc/acpi/processor/CPU/throttling</c> y cambiarlo con <c>echo -n "0:x" >
/proc/acpi/processor/CPU/limit</c> donde x es uno de los Tx estados mencionados
en <path>/proc/acpi/processor/CPU/throttling</path>.
</p>

<p>
<e>P:</e> Al configurar el núcleo aparecen los gobernadores powersave,
performance y userspace, pero falta el relacionado a ondemand. ¿Dónde lo
obtengo?
</p>

<p>
<e>R:</e> El gobernador ondemand sólo está incluido en las fuentes recientes del
núcleo. Intente actualizarlas.
</p>

<p>
<e>P:</e> La vida la batería parece ser peor que antes.
</p>

<p>
<e>R:</e> Revise la configuración de su BIOS. Quizás olvidó reactivar algunos
ajustes.
</p>

<p>
<e>P:</e> Mi batería está cargada, pero KDE reporta que el nivel actual es 0%
restante y se apaga de inmediato.
</p>

<p>
<e>R:</e> Revise que esté compilado el soporte de batería en su núcleo. Si
puede usarlo como módulo, asegúrese que esté cargado.
</p>

<p>
<e>P:</e> Mi gestor de bitácoras del sistema reporta cosas como:
"logger: ACPI group battery / action battery is not defined".
</p>

<p>
<e>R:</e> Este mensaje es generado por el guión /etc/acpi/default.sh que viene
con acpid. Puede ignorarlo con seguridad. Si desea deshacerse de este, puede
comentar la línea apropiada en /etc/acpi/default.sh como se muestra a
continuación:
</p>

<pre caption="Desactivar las advertencias sobre eventos acpi desconocidos">
        *)      # logger "ACPI action $action is not defined"
</pre>

<p>
<e>P:</e> Tengo un portátil Dell Inspiron 51XX y no obtengo eventos ACPI.
</p>

<p>
<e>R:</e> Esto parece ser un error del núcleo. Lea el siguiente <uri
link="http://bugme.osdl.org/show_bug.cgi?id=1752">reporte</uri>.
</p>

<p>
<e>P:</e> Activé la opción DynamicClocks en <path>xorg.conf</path> y ahora
X.org se cae / la pantalla queda en negro / mi portátil no se apaga
adecuadamente.
</p>

<p>
<e>R:</e> Esto pasa en algunos sistemas. Deberá desactivar DynamicClocks.
</p>

<p>
<e>P:</e> Quiero usar suspend2 pero me dice que mi partición de intercambio
es muy pequeña. Redimensionarla no es una opción.
</p>

<p>
<e>R:</e> Si hay suficiente espacio libre en su sistema, puede usar el escritor
a archivo en vez del escritor de swap. El script <c>hibernate-script</c> lo
reconoce también. Puede encontrar más información en el archivo
<path>/usr/src/linux/Documentation/power/suspend2.txt</path>.
</p>

<p>
<e>P:</e> Me acabo de comprar una batería nueva, ¡pero dura sólo unos pocos
minutos!  ¿Qué estoy haciendo mal?
</p>

<p>
<e>R:</e> Primero siga los consejos de su fabricante acerca de cómo cargar
adecuadamente la batería.
</p>

<p>
<e>P:</e> Lo mencionado anteriormente no me ayudó. ¿Qué debería hacer entonces?
</p>

<p>
<e>R:</e> Algunas baterías vendidas como "nuevas" en realidad son viejas.
Intente lo siguiente:
</p>

<pre caption="Consultando el estado de la batería">
$ <i>grep capacity /proc/acpi/battery/BAT0/info</i>
design capacity:     47520 mWh
last full capacity:  41830 mWh
</pre>

<p>
Si el ítem "última capacidad llena" ("last full capacity") difiere
significativamente de la capacidad diseñada, su batería está probablemente
dañada. Intente reclamar su garantía.
</p>

<p>
<e>P:</e> Mi problema no aparece mencionado acá. ¿Qué debería hacer?
</p>

<p>
<e>R:</e> No dude en contactar directamente a <mail
link="earthwings@gentoo.org">Dennis Nienhüser</mail>. También los <uri
link="http://forums.gentoo.org">Foros de Gentoo</uri> son un buen lugar para
obtener ayuda. Si prefiere IRC, únase al canal <e>#gentoo-laptop</e> en la
red <e>irc.freenode.net</e>.
</p>
</body>
</section>
</chapter>
</guide>
