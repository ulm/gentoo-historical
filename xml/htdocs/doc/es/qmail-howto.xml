<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/qmail-howto.xml,v 1.1 2005/11/02 10:17:03 yoswink Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/es/qmail-howto.xml" lang="es">

<title>Guía para el sistema de hosting de mail virtual con
qmail/vpopmail</title>

<author title="Autor">
  <mail link="vapier@gentoo.org">Mike Frysinger</mail>
</author>

<author title="Traductor">
	<mail link="nmiyasato@datafull.com">Nicolás Miyasato</mail>
</author>

<abstract>
Este documento explica como crear un sistema de hosting de mail basado
en qmail, vpopmail, courier-imap, mysql y horde/imp.
</abstract>

<license/>

<version>1.11</version>
<date>2005-04-24</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
Ya sea estés manejando el correo solamente para los demonios del sistema,
un simple servidor, un dominio o varios dominios virtuales, qmail puede
fácilmente ser configurado para tus necesidades. Esta guía te ayudará a
configurar el qmail para todos estos escenarios con un enfoque en acceso remoto
y comunicaciones encriptadas punto a punto.
</p>

<p>
En particular, los paquetes que nos serán de ayuda para esta guía son
qmail, courier-immp, vpopmail y horde/imp. Estos paquetes elementales
también nos brindarán daemontools, ucspi-tcp, mysql, apache y mod_php. qmail
nos provee de las funciones elementales de un mta, courier-imap nos provee de
los servicios de acceso remoto, vpopmail nos ayudará en el manejo de los
dominios virtuales y horde/imp nos brindará acceso al webmail.
</p>

<p>
Antes que nada, se deben tener los siguientes parámetros USE habilitados. Si ya
has realizado un emerge de cualquiera de estos paquetes, tal vez tendrás que
instalarlos nuevamente. <c>USE="maildir ssl imap mysql"</c>. Además, si quieres
usar horde/imp para tu webmail, entonces tendrás que usar <c>USE="nls"</c>
al realizar el emerge del mod_php.
</p>

<note>
Esta guía fué escrita en pasos, por lo que si en cualquier momento crees que tu
configuración ha sido "completada", no es necesario que continúes.
</note>

<p>
El último paso será obviamente a que te dediques a tu sistema qmail.
Hay muchos otros paquetes con los cuales puedes construir tu sistema de correo
electrónico. Ahora es el momento para investigar y decidir que qmail es para
vos. Tenemos otra <uri link="virt-mail-howto.xml">muy buena guía</uri> centrada
en <uri link="http://www.postfix.org/">Postfix</uri>, o podrías echarle un
vistazo a <uri link="http://www.exim.org/">exim</uri>. La decisión depende
enteramente de vos y depende de nosotros en mostrarte como usar el qmail.
</p>

</body>
</section>
</chapter>

<chapter>
<title>qmail</title>
<section>
<body>

<pre caption="Emerge qmail">
# <i>emerge qmail</i>
</pre>

<impo>
Esta guía fué diseñada para que funcione con qmail-1.03-r13 o versiones
mayores.¿Funcionará con versiones anteriores? Puede ser. ¿Tendría que
actualizar el sistema? Si se quiere  estar seguro de que esta guía funcione, SI.
</impo>

<warn>
Si obtienes un mensaje como <c>el paquete virtual/mta está en conflicto con
otro paquete</c> entonces tienes que asegurarte de desinstalar el otro MTA de tu
sistema. Para saber cual es dicho paquete, solo tienes que ejecutar <c>emerge
qmail -p</c>
</warn>

<p>
Cuando realices el emerge de qmail, también se realizará el emerge de ucspi-tcp
y daemontools. Para más información acerca de ucspi-tcp puedes ir a
<uri
link="http://cr.yp.to/ucspi-tcp.html">http://cr.yp.to/ucspi-tcp.html</uri>, y
para información acerca de daemontools puedes ir a <uri 
link="http://cr.yp.to/daemontools.html">http://cr.yp.to/daemontools.html</uri>.
Básicamente, daemontools es responsable de manejar a qmail como servicio,
mientras que ucspi-tcp es responsable del manejo de conexiones entrantes del
tipo TCP al servicio de qmail.
</p>

<p>
Luego de la instalación, debemos configurar algunas cosillas.
</p>

<pre caption="Configuración por defecto para qmail">
<comment>(Editar para tu sistema en particular</comment>
# <i>nano /var/qmail/control/servercert.cnf</i>
# <i>ebuild /var/db/pkg/mail-mta/qmail-1.03-r*/qmail-1.03-r*.ebuild config</i>
</pre>

<p>
El diseño de qmail ha sido completamente enfocado hacia la seguridad.
Para ello, el correo-e jamás es enviado al usuario 'root'. Así que ahora debes
de elegir un usuario que será el que recibirá el correo de 'root'. A partir de
este momento, yo me referiré a dicho usuario como lo tengo configurado en mi
sistema, 'vapier'.
</p>

<pre caption="Configurando el usuario que recibirá el correo de root">
# <i>cd /var/qmail/alias</i>
# <i>echo vapier > .qmail-root</i>
# <i>echo vapier > .qmail-postmaster</i>
# <i>echo vapier > .qmail-mailer-daemon</i>
</pre>

<p>
Ahora ejecutaremos el servicio de envío de qmail.
</p>

<pre caption="Comenzar el servicio de envío de qmail">
# <i>rc-update add svscan default</i>
# <i>/etc/init.d/svscan start</i>
# <i>cd /service</i>
# <i>ln -s /var/qmail/supervise/qmail-send qmail-send</i>
</pre>

<p>
Nos aseguraremos de que qmail se está ejecutando correctamente. Para
ello, una pequeña prueba.
</p>

<pre caption="Prueba del servicio de envío">
# <i>ssh vapier@localhost</i>
# <i>maildirmake .maildir</i>
# <i>qmail-inject root &lt;&lt; EOF
test root e-mail!
EOF</i>
# <i>qmail-inject postmaster &lt;&lt; EOF
test postmaster e-mail!
EOF</i>
# <i>qmail-inject vapier &lt;&lt; EOF
test vapier e-mail!
EOF</i>
# <i>mutt</i> 
<comment>(En este momento tendrías que tener 3 mensajes nuevos en tu bandeja
de entrada)</comment>
</pre>

<p>
Y eso es todo!. Ahora tienes un sistema de correo que manejará el
correo en tu computadora local y el correo de los usuarios y demonios de
sistema que hagan uso de él.
</p>

<warn>
	Si no has recibido ningún correo o si has visto errores raros en los
archivos de log (échale un vistazo a <path>/var/log/qmail/</path>) relacionados
con 'localhost.localhost', esto quiere decir que la información relacionada al
dominio y hostname de tu sistema no ha sido configurada correctamente. qmail
utiliza por defecto la salida de <c>hostname --fqdn</c>. Si la ejecución de
dicho comando devuelve 'localhost', entonces deberás de chequear el contenido
de <path>/etc/hostname</path>, <path>/etc/hosts</path>, y la configuración de tu
dns. Dicho esto, deberás de editar algunos de los archivos de configuración que
se encuentran en <path>/var/qmail/control/</path>. Utiliza los siguientes
ejemplos como guía.
</warn>

<pre caption="Ejemplo de los archivos en /var/qmail/control/ para un dominio
de segundo nivel">
# <i>hostname --fqdn</i>
wh0rd.org
# <i>cat me</i>
wh0rd.org
# <i>cat defaultdomain</i>
wh0rd.org
# <i>cat plusdomain</i>
wh0rd.org
# <i>cat locals</i>
wh0rd.org
# <i>cat rcpthosts</i>
wh0rd.org
</pre>

<pre caption="Ejemplo de los archivos en /var/qmail/control/ para un dominio
de tercer nivel">
# <i>hostname --fqdn</i>
mail.wh0rd.org
# <i>cat me</i>
mail.wh0rd.org
# <i>cat defaultdomain</i>
wh0rd.org
# <i>cat plusdomain</i>
wh0rd.org
# <i>cat locals</i>
mail.wh0rd.org
# <i>cat rcpthosts</i>
mail.wh0rd.org
</pre>

</body>
</section>
</chapter>

<chapter>
<title>vpopmail</title>
<section>
<body>

<pre caption="Emerge vpopmail">
# <i>emerge vpopmail</i>
</pre>

<impo>
¿¿Esta guía fué diseñada alrededor de vpopmail-5.4.6 o mayor. ¿Funcionará con
versiones anteriores? Posiblemente. ¿Tendrías que actualizar? Si, si quieres
estar seguro de que esta guía funcione.
</impo>

<p>
La configuración de vpopmail requiere de un esfuerzo un poco mayor que los
paquetes anteriores. Ya que vpopmail trabaja con mysql, es necesario asegurar
que el mismo se encuentre funcionando. Luego de esto, realizaremos la
configuración correspondiente y continuaremos con qmail.
Antes de seguir con qmail, asegúrate de haber realizado el emerge y
configurado el mysql. Fíjate que la contraseña que yo uso para la base de datos
del vpopmail será 'vpoppw', obviamente tu tendrás que seleccionar otro.
</p>

<pre caption="Configurando el vpopmail en mysql">
# <i>rc-update add mysql default</i>
<comment>Si esta es la primera vez que has realizado el emerge de mysql,
antes de levantar al servidor de mysql, asegúrate de ejecutar <i>ebuild
&lt;mysql.ebuild&gt; config</i> y sigue las instrucciones que se te presenten en
la pantalla.</comment>
# <i>/etc/init.d/mysql start</i>
# <i>nano /etc/vpopmail.conf</i> 
<comment>(Cambiando la contraseña de 'secret' a 'vpoppw')</comment>
# <i>mysql -p &lt;&lt; EOF
create database vpopmail;
use mysql;
grant select, insert, update, delete, create, drop on vpopmail.* to vpopmail@localhost identified by 'vpoppw';
flush privileges;
EOF</i>
<comment>(Los siguientes pasos podrían no ser necesarios, pero los
ejecutaremos simplemente para estar seguros)</comment>
# <i>chown root:vpopmail /etc/vpopmail.conf</i>
# <i>chmod 640 /etc/vpopmail.conf</i>
# <i>chown root:vpopmail /var/vpopmail/bin/vchkpw</i>
# <i>chmod 4711 /var/vpopmail/bin/vchkpw</i>
</pre>

<warn>
Si surgen problemas de permisos con mysql/vpopmail, reinicia al servidor mysql.
Simplemente ejecuta <c>/etc/init.d/mysql restart</c>.
</warn>

<p>
En este preciso momento, vpopmail ya se encuentra listo para ejecutarse. En
esta guía, estaremos proveyendo hosting virtual a 'wh0rd.org'. Esto significa
que necesitaremos de decirle a vpopmail acerca de dicho dominio. También
agregaremos una cuenta para el usuario 'vapier'.
</p>

<pre caption="Agragando un domain">
<comment>(Solamente tendrás que hacer esto si la ejecución del comando
<i>vadddomain</i> resulta un "comando no encontrado")</comment>
# <i>source /etc/profile</i>

<comment>(Mientras estemos depurando al vpopmail, fíjate de echarle un
vistazo a los logs del mismo)</comment>
# <i>mysql -u vpopmail -p</i>
mysql> <i>select * from vpopmail.vlog;</i>

# <i>vadddomain wh0rd.org postpass</i>
<comment>(Ahora realizamos una verificación rápida de la correcta
configuración del dominio en cuestión)</comment>
# <i>printf "postmaster@wh0rd.org\0postpass\0blah\0" | vchkpw `which id`
3&lt;&amp;0</i>
uid=89(vpopmail) gid=89(vpopmail) groups=0(root)
<comment>(Si observar algo diferente a lo de arriba, entonces quiere decir que
en algún lugar se encuentran problemas con los permisos)</comment>
# <i>vadduser vapier@wh0rd.org vappw</i>
</pre>

<p>
Cada dominio que vpopmail genera, el mismo viene con una cuenta 'postmaster'.
Aquí le hemos dicho a vpopmail que la contraseña de la cuenta de 'postmaster'
es 'postpass'. Antes de que vpopmail sea realmente útil, necesitaremos recibir
el correo vía courier y enviarlo vía qmail y SMTP.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Courier POP/IMAP</title>
<section>
<body>

<pre caption="Emerge courier-imap">
# <i>emerge net-mail/courier-imap</i>
</pre>

<impo>
Debes de realizar el emerge de courier-imap luego de haber instalado el
vpopmail. De esta manera será construido el módulo llamado authvchkpw 
</impo>

<impo>
Esta guía está basada net-mail/courier-imap-3.0.7 o versiones superiores.
¿Funcionará con versiones anteriores? Tal vez. ¿Tendrías que actualizarte? Si
quieres estar seguro de que esta guía funcione, entonces debes
actualizarte.
</impo>

<p>
A continuación se detallarán los pasos de configuración de post-instalación.
Estos pasos son solamente necesarios se quieres realizar comunicaciones
mediante SSL (que por cierto, tendrías que hacerlo!) En caso contrario, puedes
saltarte esta etapa y continuar en los últimos dos pasos del siguiente código,
quitando el '-ssl' del nombre del script.
</p>

<pre caption="Configuración por defecto del POP3/SSL">
# <i>nano /etc/courier/authlib/authdaemonrc</i>
<comment>(Asignamos solamente el valor "authvchkpw" a la variable authmodulelist
)</comment>
# <i>cd /etc/courier-imap</i>
# <i>nano pop3d.cnf</i> 
<comment>(Editar la sección [ req_dn ] )</comment>
# <i>mkpop3dcert</i>
# <i>rc-update add courier-pop3d-ssl default</i>
# <i>/etc/init.d/courier-pop3d-ssl start</i>
</pre>

<pre caption="Configuración por defecto del IMAP/SSL">
# <i>cd /etc/courier-imap</i>
# <i>nano imapd.cnf</i> 
<comment>(Editar la sección [ req_dn ] )</comment>
# <i>mkimapdcert</i>
# <i>rc-update add courier-imapd-ssl default</i>
# <i>/etc/init.d/courier-imapd-ssl start</i>
</pre>

<p>
Tu cliente de mail tendría que ser capaz de entrar al host que se encuentra
ejecutando courier (con nombre de usuario y contraseña) y obtener el correo del
host virtual. En mi caso, yo puedo entrar con el usuario 'vapier@wh0rd.org' y
contraseña 'vappw'.
</p>

</body>
</section>
</chapter>

<chapter>
<title>qmail (hablando con el mundo)</title>
<section>
<body>

<p>
Configuremos y ejecutemos el SMTP teniendo en cuenta de no transformarnos en un
generador de spam.
</p>

<pre caption="Start qmail SMTP service">
# <i>cd /var/qmail/control/</i>
# <i>nano conf-smtpd</i>
<comment>(Descomenta las variables SMTP-AUTH y asigna a QMAIL_SMTP_CHECKPASSWORD
el valor "/var/vpopmail/bin/vchkpw")</comment>
# <i>nano servercert.cnf</i> 
<comment>(Edita la sección [ req_dn ] )</comment>
# <i>mkservercert</i>
# <i>cd /service</i>
# <i>ln -s /var/qmail/supervise/qmail-smtpd qmail-smtpd</i>
# <i>/etc/init.d/svscan restart</i>
</pre>

<p>
	Teniendo en cuenta que no has modificado los archivos de control de
qmail, en este momento, qmail se encontrará aceptando el correo para el dominio
virtual wh0rd.org y los usuarios de la máquina local. Es más, qmail realizará
un relay a cualquiera que mande un mail vía 127.0.0.1  y a cualquiera que se
autentique con vpopmail. Cuando configures tu cliente de correo para que
realice un envío, asegúrate de seleccionar las opciones como 'Servidor requiere
autenticación'. En mi caso, yo configuré el usuario como 'vapier@wh0rd.org' y
mi contraseña como 'vappw'. El último detalle es asegurarse de decirle a su
cliente de correo de usar SSL/TLS para la comunicación. qmail no te dejará
autenticar si la sesión no se encuentra cifrada.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Horde / El cliente Webmail IMP </title>
<section>
<body>

<p>
	
Aunque existen muchos clientes de webmail, (y eres libre de usar cualquiera de
ellos), yo prefiero usar el cliente <uri link="http://www.horde.org/imp/">IMP
Webmail </uri> que es parte de la infraestructura de Horde. La razón más
importante de mi elección, es que Horde puede proveer acceso al webmail, y
además puedes agregarle ciertas funcionalidades tales como la libreta de
direcciones, el calendario, tareas, etc... Si esto no te ha convencido todavía,
probablemente quieras leer un poquito acerca de <uri 
link="http://www.horde.org/">Horde</uri>.
</p>

<p>
Ahora realizaremos el emerge del IMP. 
</p>

<pre caption="Realizando el emerge del IMP">
# <i>emerge horde-imp</i>
</pre>

<impo>
	Esta guía se encuentra basada en horde-2.2.x y horde-imp-3.2.x. Las
versiones del CVS ( y por lo tanto versiones superiores), probablemente tengan
configuraciones deferentes a las que usamos aquí. También hay que fijarse que
php-5.x probablemente traiga grandes problemas al horde-2.x.
</impo>

<p>
	Actualmente Horde no tiene una configuración fácil, a menos que sepas
exactamente que hacer. Afortunadamente para ti, yo se exactamente que hacer, así
que muy pronto tu también lo sabrás.
</p>

<pre caption="Configuración por defecto del Horde">
# <i>cd /var/www/localhost/htdocs/horde/config/</i>
# <i>for f in *.dist ; do mv ${f} ${f/.dist} ; done</i>
# <i>nano horde.php</i>
<comment>(En 'Horde Authentication':)</comment>
$conf['auth']['driver'] = 'imap';
$conf['auth']['params']['dsn'] = '{localhost:993/imap/ssl/novalidate-cert}';

<comment>(En 'Horde Logging':)</comment>
$conf['log']['name'] = '/var/log/apache2/horde.log';

<comment>(En  'Problem Reporting':)</comment>
$conf['problems']['enabled'] = true;
$conf['problems']['email'] = 'webmaster@wh0rd.org';

# <i>nano registry.php</i>
<comment>(En 'Handlers':)</comment>
$this->registry['auth']['login'] = 'imp';
$this->registry['auth']['logout'] = 'imp';

<comment>(En 'Application registry':)
Configura al elemento 'status' de applications['imp'] de 'inactive' a
'active'</comment>

# <i>touch /var/log/apache2/horde.log</i>
# <i>chown apache:apache /var/log/apache2/horde.log</i>
</pre>

<note>
	Debes cambiar la cuenta de correo del 'webmaster' a otra cosa. Si
quieres usar esa dirección de correo, entonces recuerda que tendrás que
agregarlo vía vpopmail (o fíjate como lo hacemos con el qmailadmin).
</note>

<p>
Ahora rápidamente configuraremos el IMP.
</p>

<pre caption="Configuración por defecto del IMP">
# <i>cd /var/www/localhost/htdocs/horde/imp/config/</i>
# <i>for f in *.dist ; do mv ${f} ${f/.dist} ; done</i>
# <i>nano servers.php</i>

<comment>(Editamos el arreglo de $servers['imap']:)</comment>
$servers['imap'] = array(
	'name' => 'wh0rd.org',
	'server' => 'localhost',
	'protocol' => 'imap/ssl/novalidate-cert',
	'port' => 993,
	'folders' => '',
	'namespace' => 'INBOX.',
	'maildomain' => 'wh0rd.org',
	'smtphost' => 'localhost',
	'realm' => '',
	'preferred' => ''
);
</pre>

<p>
Finalmente, iniciamos el apache para poder empezar a usar el webmail.
</p>

<pre caption="Ejecutando el apache">
# <i>nano /etc/conf.d/apache2</i> 
<comment>(Descomenta APACHE2_OPTS="-D SSL -D PHP4")</comment>
# <i>rc-update add apache2 default</i>
# <i>/etc/init.d/apache2 start</i>
</pre>

<warn>
Considera el uso obligatorio de https para los usuarios de horde. No es
algo trivial, pero al menos échale una mirada por el bien de la seguridad de tu
sistema.
</warn>

<p>
Para probar la nueva configuración del IMP, lanza un navegador y visita 
<uri>http://localhost/horde/</uri> (o cambia localhost con el servidor en donde
estás realizando la configuración). Tendrías que ver el mensaje de bienvenida
de Horde, en el cual puedes autenticarte. 
Nuevamente, en mi configuración, yo simplemente me autentico con
el nombre de usuario 'vapier@wh0rd.org' y contraseña 'vappw'.
</p>

<p>
En este momento, Horde e IMP se encuentran configurados. Si
quieres, podrías modificar los archivos de configuración  a tu gusto..
</p>

</body>
</section>
</chapter>

<chapter>
<title>Paquete extra</title>
<section>
<title>qmailadmin</title>
<body>

<p>
El primer paquete que te sugiero que veas es el <uri 
link="http://www.inter7.com/qmailadmin.html">qmailadmin</uri>. Es una interfaz
para manejar dominios virtuales desde tu navegador. Simplemente ejecuta
<c>emerge net-mail/qmailadmin</c> y luego para poder usarlo, tienes que ir a
<uri>http://localhost/cgi-bin/qmailadmin</uri>. Y listo, nada de vueltas.
</p>

</body>
</section>
<section>
<title>qmHandle</title>
<body>

<p>	
Si te encuentras en problemas con las colas de qmail y te encuentras en un
momento no muy agradable tratando de solucionar el problema, te sugiero que
veas <uri 
link="http://qmhandle.sourceforge.net/">qmHandle</uri>. Es un simple programa
en Perl que te permite ver y manejar la cola de mensajes de qmail. Nuevamente,
lo único que debes de hacer es <c>emerge net-mail/qmhandle</c>.
</p>

</body>
</section>
<section>
<title>Aplicaciones para el horde</title>
<body>

<p>
Recomiendo que veas algunas aplicaciones para el Horde, tales como 
<uri link="http://www.horde.org/turba/">Turba</uri>, <uri 
link="http://www.horde.org/kronolith/">Kronolith</uri>, y <uri 
link="http://www.horde.org/nag/">Nag</uri>. Su configuración es muy similar
al de Horde, de manera que no tendrás muchos problemas al configurarlos.
Solamente recuerda que para editar el archivo registry.php en el directorio de
la configuración de horde, de esta forma, las nuevas aplicaciones aparecerán al
pie del sitio web de horde.
</p>

</body>
</section>
<section>
<title>ucspi-tcp</title>
<body>

<p>
qmail usa al paquete ucspi-tcp para manejar las conexiones entrantes
para qmail. Si quieres modificar las reglas de filtrado, entonces échale un
vistazo a los archivos de configuración en <path>/etc/tcprules.d/</path>
(versiones anteriores de qmail ubican a dichos archivos en /etc). Allí
encontrarás dos archivos por cada servicio, el archivo de configuración (ej.
tcp.qmail-smtp) y la versión compilada del mismo, que es el que usa
ucspi-tcp (ej. tcp.qmail-smtp.cdb). Cuando realizes una actualización del
archivo de configuración, tendrás que reconstruir la versión binaria.
Simplemente ejecuta <c>tcprules tcp.qmail-smtp.cdb tcp.qmail-smtp &lt;
tcp.qmail-smtp</c>. Siempre que entre una conexión al servicio de qmail, las
reglas compiladas serán releídas, de manera que no tienes que reiniciar el
servicio.
</p>

</body>
</section>
<section>
<title>qmail-scanner</title>
<body>

<p>
Si quieres configurar a tu servidor de mail para que realice un filtrado de
acuerdo al contendido de cada mail (spam y virus), tendrás que reemplazar al
programa de encolado con el cual viene por defecto. Un programa de encolado muy
bueno<uri link="http://qmail-scanner.sourceforge.net/">qmail-scanner</uri> es
un muy buen reemplazo. Para instalarlo, simplemente debes ejecutar <c>emerge
qmail-scanner</c>. Luego debes editar el archivo
<path>/etc/tcprules.d/tcp.qmail-smtp</path> para modificar el mecanismo de
encolado de los mails.
</p>

<impo>
El proceso de construcción de qmail-scanner es bastante tedioso. Para dar
soporte a ciertos paquetes, los mismos deben existir en tu sistema. Esto quiere
decir que tendrás que instalar al SpamAssasin y/o Clam Antivirus antes de
instalar el qmail-scanner. Sigue leyendo para mayor información.
</impo>

<pre caption="Cambiando el gestor de la cola">
# <i>cd /etc/tcprules.d/</i>
# <i>nano tcp.qmail-smtp</i>
<comment>(Agrega QMAILQUEUE="/var/qmail/bin/qmail-scanner-queue" a la regla
por defecto del allow)</comment>
# <i>tcprules tcp.qmail-smtp.cdb tcp.qmail-smtp.tmp &lt; tcp.qmail-smtp</i>
</pre>

<p>
Las siguientes secciones explican como configurar el filtrado de spam y virus.
Para una configuración más personalizada, puedes editar el archivo 
<path>/var/qmail/bin/qmail-scanner-queue.pl</path>.
</p>

</body>
</section>
<section>
<title>SpamAssassin</title>
<body>

<p>
Uno de los mejores programas de código abierto para el filtrado de spam
es <uri link="http://www.spamassassin.org/">SpamAssassin</uri>. Para
instalarlo, simplemente ejecuta <c>emerge mail-filter/spamassassin</c>.
Este paquete viene en dos sabores, una versión para la línea de comandos, y la
otra se ejecuta en un modo cliente/servidor. Para servidores que manejan una
cantidad pequeña de correo, el uso de la versión de línea de comando es
aceptable, en caso de estar manejando una cantidad importante de correo, es
prácticamente obligatorio el uso de la versión cliente/servidor.
</p>

<pre caption="Configuración por defecto del SpamAssassin">
# <i>nano /etc/mail/spamassassin/local.cf</i>
<comment>(Al menos, agrega estas opciones:)</comment>
required_hits 6
skip_rbl_checks 1

# <i>rc-update add spamd default</i>
# <i>/etc/init.d/spamd start</i>
# <i>nano /var/qmail/bin/qmail-scanner-queue.pl</i>
<comment>(Asegurate de que la variable $spamc_binary contenga el valor
 '/usr/bin/spamc'.)</comment>
<comment>(Si no tiene ningún valor, entonces fíjate la siguiente
nota.)</comment>
</pre>

<impo>
	Si no tenías SpamAssassin en tu sistema antes de haber instalado el
qmail-scanner, entonces tendrás que reinstalar el qmail-scanner nuevamente. Su
proceso de construcción solamente agregará el soporte a ciertas funcionalidades
de acuerdo a la detección de los mismos en el tiempo de construcción.
</impo>

<p>
Llegado a este punto, el mail entrante será enviado a qmail-scanner, el cual
ejecutará SpamAssassin sobre el mismo.
</p>

</body>
</section>
<section>
<title>Clam AntiVirus</title>
<body>

<p>
Al igual que SpamAssassin, <uri link="http://www.clamav.net/">Clam
AntiVirus</uri>  viene en dos sabores, una versión para la línea de comandos, y
la otra del tipo cliente/servidor. Te mostraré como configurarlo. Primero
ejecuta <c>emerge app-antivirus/clamav</c>.

</p>

<pre caption="Configuración por defecto de Clam AntiVirus">
# <i>nano /etc/conf.d/clamd</i> 
<comment>(Configurar START_CLAMD=yes)</comment>
# <i>nano /etc/clamav.conf</i>
<comment>(Configura las cosas de la manera que lo desees.)</comment>
# <i>rc-update add clamd default</i>
# <i>/etc/init.d/clamd start</i>
# <i>nano /var/qmail/bin/qmail-scanner-queue.pl</i>
<comment>(Asegurate que la variable $clamscan_binary contenga el valor
'/usr/bin/clamscan'.)</comment>
<comment>(En caso contrario, lee la siguiente nota.)</comment>
# <i>nano /var/qmail/control/conf-common</i>
<comment>(Si ClamAV se queja acerca de problemas de memoria, entonces
trata de aumentar el softlimit)</comment>
</pre>

<impo>
Si no tenías el Clam Antivirus instalado en el momento de la instalación de
qmail-scanner, entonces debes reinstalar el qmail-scanner nuevamente. Como he
dicho anteriormente, qmail-scanner solamente agrega las funcionalidades que
llega a detectar en el momento de la construcción del mismo. 
</impo>

<p>
En este momento, el mail entrante será enviado al qmail-scanner, quién
ejecutará Clam Antivirus sobre el mismo.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Notas finales</title>
<section>
<body>

<p>
No tengo nada que decir más que si experimentas algún tipo de problemas con
esta guía, por favor contacta conmigo a <mail
link="vapier@gentoo.org">conmigo</mail> o reporta un error al
<uri link="http://bugs.gentoo.org/">sitio de búsqueda de errores de
Gentoo</uri>. Si tienes algún tipo de consejos para mejorar esta guía,
envíamelo para ver si se la puede incluir en el mismo.
</p>

</body>
</section>
</chapter>
</guide>
