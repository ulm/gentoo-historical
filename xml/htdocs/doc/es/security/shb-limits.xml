<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/security/shb-limits.xml,v 1.3 2006/03/03 14:26:18 chiguire Exp $ -->
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<sections>

<version>1.2</version>
<date>2005-12-26</date>

<section id="limits_conf">
<title>/etc/security/limits.conf</title>
<body>

<p>
El control de uso de recursos puede ser muy efectivo para prevenir
denegaciones de servicio locales o limitar el máximo de entradas
permitidas a un grupo o usuario.
Sin embargo, una configuración demasiado estricta puede dificultar
el comportamiento del sistema y causar fallos en los programas por
lo que deberá asegurarse de comprobar primero cada configuración.
</p>

<pre caption="/etc/security/limits.conf">
*    soft core      0
*    hard core      0
*    hard nproc     15
*    hard rss       10000
*    -    maxlogins 2
@dev hard core      100000
@dev soft nproc     20
@dev hard nproc     35
@dev -    maxlogins 10
</pre>

<p>
Si quiere establecer <c>nproc</c> o <c>maxlogins</c> a 0, quizás sea
mejor borrar el usuario. En el ejemplo anterior se configura el grupo
<c>dev</c> para procesos, fichero core y <c>maxlogins</c>. El resto se
configura con el valor predeterminado.
</p>

<note>
<path>/etc/security/limits.conf</path> forma parte del paquete PAM y
será sólo aplicable a paquetes que utilicen PAM.
</note>
</body>
</section>

<section>
<title>/etc/limits</title>
<body>

<p>
<path>/etc/limits</path> es muy similar al fichero de limitaciones
<path>/etc/security/limits.conf</path>. Las únicas diferencias son el
formato y que sólo trabaja con usuarios o comodines (no
grupos). Echemos un vistazo a una configuración de ejemplo:
</p>

<pre caption="/etc/limits">
*   L2 C0 U15 R10000
kn L10 C100000 U35
</pre>

<p>
Aquí establecemos la configuración por defecto y una configuración
específica para el usuario kn. Limits forma parte del paquete
sys-apps/shadow. No es necesario configurar ningún límite en este
archivo si usted ha deshabilitado <c>pam</c> en <path>make.conf</path>
o no ha configurado PAM correctamente.
</p>
</body>
</section>

<section id="quotas">
<title>Cuotas</title>
<body>

<warn>
Asegúrese que los sistemas de ficheros con los que trabaja soportan
cuotas. Para utilizarlas con ReiserFS debe parchear su kernel con los
parches disponibles en <uri link="ftp://ftp.namesys.com/pub/reiserfs-for-2.4/testing/quota-2.4.20">Namesys</uri>. Las herramientas de usuario están disponibles en <uri link="http://www.sf.net/projects/linuxquota/">El proyecto Linux Cuota
de Disco</uri>. Hasta que las cuotas no estén operativas con ReiserFS,
debería encontrar otras alternativas mientras trate de
utilizarlas. ¡Está avisado!
</warn>

<p>
Establecer cuotas en un sistema de ficheros restringe el uso de disco
en un esquema por usuario o por grupo. Las cuotas se habilitan en el
kernel y se añaden a un punto de montaje en
<path>/etc/fstab</path>. La opción del kernel se habilita en la
configuración del kernel en <c>File systems->Quota
support</c>. Aplique la siguiente configuración, recompile el kernel y
reinicie usando el nuevo kernel.
</p>

<p>
Empiece instalando cuotas con <c>emerge quota</c>. Entonces modifique
el <path>/etc/fstab</path> y añada <c>usrquota</c> y <c>grpquota</c> a
las particiones en las que quiera restringir el uso de disco, como en
el ejemplo siguiente.
</p>

<pre caption="/etc/fstab">
/dev/sda1 /boot ext2 noauto,noatime 1 1
/dev/sda2 none swap sw 0 0
/dev/sda3 / reiserfs notail,noatime 0 0
/dev/sda4 /tmp ext3 noatime,nodev,nosuid,noexec,usrquota,grpquota 0 0
/dev/sda5 /var ext3 noatime,nodev,usrquota,grpquota 0 0
/dev/sda6 /home ext3 noatime,nodev,nosuid,usrquota,grpquota 0 0
/dev/sda7 /usr reiserfs notail,noatime,nodev,ro	0 0
/dev/cdroms/cdrom0 /mnt/cdrom iso9660 noauto,ro 0 0
proc /proc proc defaults 0 0
</pre>

<p>
En cada partición en la que haya establecido las cuotas, cree los
ficheros de cuota (<path>aquota.user</path> y <path>aquota.group</path>)
y guárdelos en la raíz de la partición.
</p>

<pre caption="Crear los ficheros de cuota">
# <i>touch /tmp/aquota.user</i>
# <i>touch /tmp/aquota.group</i>
# <i>chmod 600 /tmp/aquota.user</i>
# <i>chmod 600 /tmp/aquota.group</i>
</pre>

<p>
Este paso debe hacerse en cada partición en la que se hayan activado
las cuotas. Después de añadir y configurar los ficheros de cuota,
necesitamos añadir el guión <c>quota</c> al nivel de ejecución boot.
</p>

<pre caption="Añadir cuotas al nivel de ejecución boot">
# <i>rc-update add quota boot</i>
</pre>

<p>
Ahora configuraremos el sistema para comprobar las cuotas una vez a la
semana añadiendo la siguiente línea a <path>/etc/crontab</path>:
</p>

<pre caption="Añadir la comprobación de cuotas en crontab">
0 3 * * 0 /usr/sbin/quotacheck -avug.
</pre>

<p>
Después de reiniciar la máquina, es el momento para establecer las
cuotas de usuarios y grupos. <c>edquota -u kn</c> ejecutará el editor
definido en $EDITOR (por defecto es nano) y le permitirá editar la
cuotas para el usuario kn. <c>edquota -g</c> hará lo mismo para los
grupos.
</p>

<pre caption="Configurando las cuotas para el usuario kn">
Quotas for user kn:
/dev/sda4: blocks in use: 2594, limits (soft = 5000, hard = 6500)
 inodes in use: 356, limits (soft = 1000, hard = 1500)
</pre>

<p>
Para más detalles lea <c>man edquota</c> o el 
<uri link="http://www.tldp.org/HOWTO/Quota.html">Quota mini howto</uri>.
</p>
</body>
</section>

<section>
<title>/etc/login.defs</title>
<body>

<p>
Si las políticas de seguridad indican que los usuarios deben cambiar
su contraseña cada dos semanas, cambie el valor <c>PASS_MAX_DAYS</c> a
14 y <c>PASS_WARN_AGE</c> a 7. Es recomendable que use la caducidad de
contraseñas puesto que los ataques por fuerza bruta permiten encontrar
cualquier contraseña, es sólo cuestión de tiempo. También le alentamos
a que establezca <c>LOG_OK_LOGINS</c> a sí.
</p>
</body>
</section>

<section>
<title>/etc/login.access</title>
<body>

<p>
El fichero <path>login.access</path> también pertenece al paquete
sys-apps/shadow, que proporciona una tabla de control de acceso. La
tabla se usa para controlar quien puede y quien no puede acceder
basándose en el nombre de usuario, nombre de grupo o nombre de
host. Por defecto, todos los usuarios del sistema tienen permitido
hacer login por lo que el fichero consiste sólo en comentarios y
ejemplos. Si usted está asegurando su servidor o estación de trabajo,
le recomendamos que configure este fichero para que nadie más que
usted (el administrador) tenga acceso a la consola.
</p>

<note>
Esta configuración no se aplica al usuario root.
</note>

<pre caption="/etc/login.access">
-:ALL EXCEPT wheel sync:console
-:wheel:ALL EXCEPT LOCAL .gentoo.org
</pre>

<impo>
Tenga cuidado cuando configure estas opciones, puesto que ciertos
errores podrán impedirle acceder a la máquina si usted no tiene acceso
de root.
</impo>

<note>
Estas configuraciones no se aplican a SSH, puesto que SSH no ejecuta
por defecto <c>/bin/login</c>. Pero se puede habilitar usando
<c>UseLogin yes</c> en <path>/etc/ssh/sshd_config</path>.
</note>

<p>
Esto permitirá a los miembros del grupo wheel el acceso local o desde
el dominio gentoo.org. Puede que sea paranoico, pero mejor prevenir
que curar.
</p>
</body>
</section>
</sections>
