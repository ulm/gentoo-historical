<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/guide-to-mutt.xml,v 1.5 2006/04/06 00:39:23 yoswink Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/es/guide-to-mutt.xml" lang="es">
<title>Guía de inicio rápido con Mutt</title>
<author title="Autor">
  <mail link="mikpolniak@adelphia.net">Mike Polniak</mail>
</author>
<author title="Editor">
  <mail link="antifa@gentoo.org">Ken Nowack</mail>
</author>
<author title="Colaborador">
  <mail link="hitch17@gmail.com">John Hitchings</mail>
</author>
<author title="Editor Es">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Editor Es">
  <mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>
<author title="Traductor">
  <mail link="anpereir@gentoo.org">Andrés Pereira</mail>
</author>

<abstract>
Esta guía le muestra cómo empezar a usar las poderosas herramientas
de línea de comandos para correo electrónico: fetchmail, procmail, mutt,
nbsmtp, msmtp.
</abstract>

<!-- El contenido de este documento está liberado bajo la licencia CC-BY-SA -->
<!-- Vea http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.4</version>
<date>2005-07-01</date>

<chapter>
<title>Introducción al Correo electrónico</title>
<section>
<body>

<p>
Si no es un fan de los clientes de correo electrónico con adornadas
interfaces de usuario gráficas, o si le gustaría experimentar con otros
clientes de correo antes de decidir cuál es el que más le acomoda, a
continuación hay una manera fácil de comenzar usando estas poderosas
herramientas de línea de comandos:
</p>

<p>
<b>fetchmail->procmail->mutt->smtp</b>
</p>

<p>
Estos programas no sólo son poderosos y altamente adaptables sino también
pequeños y eficientes. Una vez que los tenga funcionando con este sistema
de correo electrónico se sorprenderá de lo que puede hacer.
</p>

<p>
Debido a que esta es una guía de inicio rápido, no abordaremos los Agentes de
Transferencia de Correo (MTA por Mail Transfer Agent) tales como: sendmail,
postfix o exim. Esto significa que no hay que hacer una compleja configuración
del MTA. También elimina hacer uso del puerto 25 para el servicio
de correo.
</p>

<p>
Podemos hacer esto ya que con fetchmail es posible forzar que el correo que
rescata se vaya directamente a un Agente de Reparto de Correo (MDA por Mail
Delivery Agent) en vez de redireccionarlo al puerto 25. Así no necesita usar
un complejo MTA para el reparto del correo plano saliente.
</p>

<p>
Éstos son los programas que necesitará para tener funcionando
su correo electrónico.
</p>

<pre caption="Obteniendo los programas">
# <i>emerge fetchmail procmail mutt nbsmtp</i>
</pre>

<p>
Luego, hay que seguir sólo cuatro pasos para configurar algunos archivos
y estará corriendo un nuevo sistema de correo electrónico.
</p>

<impo>
Luego de cada paso puede realizar una prueba para estar seguro de que
la configuración está correcta. De esta forma tendrá funcionando
un completo sistema de correo electrónico una vez que finalice los pasos
de la guía.
</impo>
</body>
</section>
</chapter>

<chapter>
<title>Fetchmail</title>
<section>
<body>

<p>
Fetchmail trae el correo electrónico desde los servidores remotos y
lo redirecciona a sus máquinas locales que actúan como sistemas de
distribución. Para usarlo necesita configurar un archivo denominado
<path>.fetchmailrc</path> en su directorio de usuario tal como el
siguiente ejemplo:
</p>

<pre caption="Archivo .fetchmailrc de muestra">
<i>poll mail.su_isp.net  protocol pop3 user "su_nombre" password "su_clave"</i>
</pre>

<p>
Una vez que haya creado el archivo <path>.fetchmailrc</path>, tiene que cambiar
los permisos del archivo usando el comando chmod. El archivo debe ser posible de
leer sólo por el dueño del archivo. Ajuste los permisos con el siguiente
comando:
</p>

<pre caption="Cambiando los permisos">
# <i>chmod 600 .fetchmailrc</i>
</pre>

<p>
Para verlo en acción, use el modo verboso (-v). Para traer todos los
mensajes use la opción "-a". Y debe usar la opción "-m" para decirle
a fetchmail que envíe el correo al programa procmail.
</p>

<warn>
Mientras realiza pruebas, es buena idea decirle a fetchmail que mantenga
el correo en el servidor remoto (opción -k) en caso de que algo malo suceda
y necesite traerlo de nuevo.
</warn>

<p>
¡Ejecútelo ahora para ver a fetchmail en acción!
</p>

<pre caption="Prueba de Fetchmail #1">
# <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i>
</pre>

<p>
Una vez que tenga el sistema de correo funcionando, puede configurar lo anterior
usando cron o colocarlo en un monitor como gkrellm. Fetchmail también puede
ser ejecutado en modo demonio al cual debe especificarle un intervalo de tiempo
en segundos para sondear si hay nuevo correo electrónico por traer.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Procmail</title>
<section>
<body>

<p>
Procmail es el procesador que filtra el correo que le es redireccionado
mediante fetchmail. También actúa como MDA para repartir el correo a sus
buzones donde mutt (su cliente de correo electrónico) pueda leerlo.
</p>

<p>
Para usar procmail necesita crear un archivo <path>.procmailrc</path> en su
directorio de usuario. Para nuestros propósitos de inicio rápido, usaremos un
archivo <path>.procmailrc</path> muy simple que filtrará el correo de tres
listas de correos de gentoo en estos buzones: <e>gentoo-dev, gentoo-user</e> y
<e>gentoo-announce</e>
</p>

<note>
Las reglas de filtro de procmail se llaman recetas y se han incluido
algunas de ellas para filtrar algo de spam.
</note>

<pre caption="Archivo .procmailrc de muestra">
MAILDIR=$HOME/MuttMail                ##Asegúrese que exista el directorio
LOGFILE=$HOME/.procmaillog
LOGABSTRACT=no
#VERBOSE=on...sólo se usa para depurar
VERBOSE=off
FORMAIL=/usr/bin/formail
NL="
"
##Las líneas de recetas comienzan con :0
##No coloque comentarios en las líneas de recetas
##Puede desactivar una receta con la condición falsa: !
##Las líneas de condiciones comienzan con * y puede usar expresiones regulares
##Las condiciones se evalúan con un Y lógico y todo lo que hay después de un asterico se va directo a egrep
##A una condición le sigue una línea de acción, en este caso, el nombre del buzón

#Capturar los duplicados usando formail
:0 Whc: .msgid.lock
| $FORMAIL -D 16384 .msgid.cache

:0 a
$MAILDIR/duplicates

#Direcciones de correo electrónico permitidas para recibir correo desde ellas
:0
* ^From:.*(craig\@hotmail|renee\@local.com)
$MAILDIR/friends

#Filtrar algo de spam
:0
* ^Subject:.*(credit|cash|money|debt|sex|sale|loan)
$MAILDIR/spam

#No permitir mensajes en HTML
:0
* ^Content-Type:.*html
$MAILDIR/junk

#Dirigir las listas de correo a sus buzones
:0
* ^List-Id:.*gentoo-user
gentoo-user

:0
* ^List-Id:.*gentoo-dev
gentoo-dev

:0
* ^List-Id:.*gentoo-announce
gentoo-announce

#Capturar algún otro correo de Gentoo
:0
* ^From:.*gentoo.org
gentoo

#Capturar correos desde Freshmeat
:0
* ^From:.*@freshmeat\.net
freshmeat

######################################################
# Última receta: El correo que no cumple las recetas #
# anteriores se va al buzón por defecto              #
######################################################
:0
* .*
default

# Fin del archivo
</pre>

<note>
Sólo se requiere crear el directorio de correo <path>$HOME/MuttMail</path> ya
que Procmail creará en este directorio el resto de los archivos de buzones a
medida que se necesiten usando los nombres indicados en las líneas de acción.
En <uri>http://www.procmail.org/</uri> puede encontrar enlaces útiles al
respecto.
</note>

<p>
Ahora puede probar el <path>.procmailrc</path> ejecutando nuevamente el
comando fetchmail tal como lo hizo en el primer paso. Recuerde que la opción -k
mantiene todo el correo en el servidor remoto por si necesita ejecutar la prueba
otra vez.
</p>

<pre caption="Prueba de Procmail #1">
# <i>fetchmail -akv -m "/usr/bin/procmail -d %T"</i>
</pre>

<p>
Ahora que están funcionando fetchmail y procmail, vaya a
<path>$HOME/MuttMail</path> y lea sus mensajes con <c>less</c> o su
administrador de archivos.
</p>
</body>
</section>
</chapter>

<chapter>
<title>El cliente de correo electrónico Mutt</title>
<section>
<body>

<p>
Mutt se usa para leer y escribir correo electrónico. Es poderoso y altamante
adaptable pero también pequeño y eficiente.
</p>

<p>
Mutt permite la lectura y escritura de cuatro formatos de buzones distintos:
mbox, MMDF, MH y Maildir.El tipo del buzón es detectado automáticamente. En
nuestro caso estamos usando el formato mbox, buzón en el que se guardan todos
los mensajes en un archivo simple.
</p>

<p>
Mutt también tiene la capacidad de trabajar con carpetas ubicadas en un
servidor IMAP remoto. Vea el soporte de IMAP en la sección 4.11 del manual
de Mutt y el sitio Web de Mutt <uri>http://www.mutt.org/</uri>
</p>

<p>
Cuando instaló mutt mediante emerge en el primer paso de esta guía, se
instaló un archivo de configuración en <path>/etc/mutt/Muttrc</path>. También
necesita crear un archivo  <path>.muttrc</path> en su directorio de usuario.
</p>

<pre caption="Archivo .muttrc de ejemplo">
<comment>(Asegúrese de leer el excelente manual de Mutt en  /usr/share/doc/mutt*)</comment>
<comment>(Cualquiera de los ajustes realizados aquí prevalecen por sobre los ajustes de sistema en /etc/mutt/Muttrc)</comment>

# <i>cp /etc/mutt/Muttrc ~/.muttrc</i>
# <i>nano -w .muttrc</i>
set pager_context=1
set pager_index_lines=6                 #Muestra un mini-índice en el paginador
set menu_scroll
set pgp_verify_sig=no                   #No muestra PGP en el paginador
set status_on_top                       #Coloca la línea de estado en la parte superior
set sort=threads                        #Ordena según hilos de mensajes en el índice

set status_format=" %r %b %f %n      Del %d      Msgs %m %l %> (%P)"
set pager_format="%-10.10i %[!%a %b %d %R]"
set date_format="!%H:%M %a %d %b     "
set index_format="%4C %Z %[%b%d] %-15.15F %s"
set folder_format="%2C %t %8s %d %N %f"

#set sendmail="/usr/bin/nbsmtp -d isp.net -h smtp.isp.net -f yourname@isp.net"

#set from="direccion de correo por defecto"         #Configurar su dirección en el FROM
#set realname="mi_nombre"

set record="$HOME/MuttMail/sent"        #El correo enviado se guarda aquí
set delete=yes                          #Borrar mensajes sin pedir confirmación
set include=yes                         #Citar el mensaje original al responder
set fast_reply=yes                      #Responder sin pedir confirmación
set beep=no                             #Desactivar el sonido
set markers=no                          #No colocar el símbolo + en las líneas con retorno automático
set confirmappend=no                    #Guardar a =keep sin pedir confirmación
set to_chars=" +TCF"                    #No usar la tecla L para mail_list

set folder = $HOME/MuttMail
mailboxes =gentoo-user
mailboxes =gentoo-dev
mailboxes =gentoo-announce
mailboxes =gentoo
mailboxes =freshmeat
mailboxes =duplicates
mailboxes =default
mailboxes =friends
mailboxes =junk
mailboxes =spam
mailboxes =keep

save-hook .* =keep                      #El buzón por defecto para guardar el correo es =keep
subscribe gentoo-user gentoo-dev        #Se está subscrito a estas listas de correo

bind pager h display-toggle-weed        #Ver los encabezados con la tecla h

# Simula el antiguo menú de URL
macro index \cb |urlview\n 'call urlview to extract URLs out of a message'
macro pager \cb |urlview\n 'call urlview to extract URLs out of a message'

#Ejecuta fetchmail al presionar la tecla G
macro index G "!fetchmail -a -m 'procmail -d %T'\r"
macro pager G "!fetchmail -a -m 'procmail -d %T'\r"

#Macros para editar .muttrc y aplicar los cambios sin necesidad de reiniciar el programa
macro generic ,sm ":source $HOME/.muttrc\r"
macro generic \cj "!rxvt -bg wheat -e joe $HOME/.muttrc\r"

#Lista de campos de encabezado por defecto que se omiten al mostrar el correo
#Se ignoran todos y luego aceptamos sólo los que queremos ver y en qué orden
ignore *
unignore  Date To From: Subject X-Mailer Organization User-Agent
hdr_order Date From To Subject X-Mailer User-Agent Organization

##Su Mutt puede tener colores
##A continuación hay cuatro niveles para el texto citado
##Dichos niveles prevalecen por sobre los ajuste de sistema en /etc/mutt/Muttrc

#color quoted green  default
color  quoted1 magenta blue
#color quoted2 yellow default
#color quoted3 red default
#color signature cyan cyan


#La siguiente configuración de color fue copiada desde /etc/mutt/Muttrc.color
#Coméntela si desea usar los colores por defecto configurados en /etc/mutt/Muttrc
# Je vois la vie en rose (o sea, veo la vida en rosa) :-)
color   hdrdefault      brightcyan      blue
color   header          brightwhite     blue "^from:"
color   header          brightwhite     blue   "^subject:"

color   quoted          brightgreen     blue
color   signature       brightwhite     blue

color   indicator       blue            green

color   error           red             black
mono    error           bold
color   status          black cyan
mono    status          bold
color   tree            yellow          blue

color   tilde           brightmagenta   blue
color   body            brightwhite     blue  "[-a-z_0-9.]+@[-a-z_0-9.]+"
mono    body            bold                  "[-a-z_0-9.]+@[-a-z_0-9.]+"
color   body            brightyellow    black   "^Good signature"
mono    body            bold                    "^Good signature"
color   body            brightwhite     red     "^Bad signature from.*"
mono    body            bold                    "^Bad signature from.*"
color   normal          white           blue
color   message         green           black
color   attachment      brightgreen     blue

# Fin del archivo ... pero este puede crecer y crecer ... :)
</pre>

<p>
Para su información, esto es sólo un ejemplo de <path>.muttrc</path>. Hay
muchas más opciones que puede configurar, por ejemplo ajustes de GPG. Déle
una mirada a <uri>http://www.dotfiles.com/index.php3?app_id=27</uri> para
más ejemplos y ayuda al respecto.</p>

<p>
Ahora está listo para probar su <path>.muttrc</path>
</p>

<pre caption="Probando su archivo .muttrc">
# <i>mutt -y</i>
</pre>

<p>
Este debería abrir Mutt con un menú que muestra los buzones de correo
de Mutt que se crearon en el paso 2 cuando ejecutó el comando fetchmail.
</p>

<p>
Escriba el símbolo de interrogación (?) para obtener ayuda al navegar por
los buzones de Mutt.
</p>
</body>
</section>
</chapter>

<chapter>
<title>SMTP</title>
<section>
<body>

<p>
El último paso es configurar nbsmtp (conocido como 'No-Brainer SMTP') el cual
es usado para enviar correo a su servidor SMTP. Esta configuración es la más
fácil de todas y sólo requiere agregar una línea en su archivo
<path>.muttrc</path>.
</p>

<p>
-d dominio: Es el nombre dominio que usará nbsmtp para decir a cuál
pertenece. Esto será en la mayor parte de los casos el mismo nombre de dominio
de su dirección de correo electrónico.
</p>

<p>
-f remitente@host.tld: Esta es la dirección de correo que usará nbsmtp para
decir de dónde viene el mensaje. Note que esto puede ser diferente de línea
"From:" en su MUA.
</p>

<p>
-h host: Este es el servidor smtp al cual le enviará los correos
</p>

<pre caption="Agregando soporte de smtp a Mutt">
# <i>nano -w .muttrc</i>
set sendmail="/usr/bin/nbsmtp -d isp.net -h smtp.isp.net -f su_nombre@isp.net"
</pre>

<p>
Ahora está listo para enviar un mensaje. Desde el paginador de Mutt o desde
el índice presione la tecla <c>m</c> para escribir un mensaje de prueba y
enviarlo a su dirección de correo. Mutt usará el valor de la variable de
entorno EDITOR o VISUAL como editor para escribir correos a menos que haya
configurado la opción <c>editor=</c> en el archivo <path>.muttrc</path>. Cuando
haya terminado de escribir su mensaje, presione la tecla <c>y</c> para enviarlo.
Si no hay mensajes de error, podrá observar 'sending mail' seguido de 'Mail
sent'.
</p>

<p>
Recuerde que en  <path>.muttrc</path> configuró dónde se guardará el correo
enviado con <c>set record="$HOME/MuttMail/sent"</c>
</p>

<p>
Ahora para completar la prueba, ejecute fetchmail nuevamente para obtener todo
su correo y verificar que haya recibido el mensaje enviado a su dirección de
correo electrónico. Una vez que encuentre su mensaje de prueba, presione la
tecla <c>h</c> para activar la visualización de todos los encabezados y
observe la ruta completa de transferencia del correo.
</p>

<note>
Hay un programa más que probablemente quiera agregar denominado urlview. Este
extrae las URLs en los textos de mensajes y las envía a su navegador.
</note>

<pre caption="Obteniendo urlview">
# <i>emerge urlview</i>
</pre>

<p>
Luego cree el archivo <path>~/.urlview</path> copiando el archivo de
configuración desde <path>/usr/share/doc/urlview*/</path> y configure
el comando para ejecutar su navegador.
</p>

<p>
Ahora tiene un sistema de correo poderoso y altamente adaptable. Así que lea
todos los manuales y documentación y encuentre los diversos archivos de
configuración de usuario disponibles en la Web usando 'google'
<path>procmailrc</path> y <path>muttrc</path>.
</p>
</body>
</section>
</chapter>

<chapter>
<title>SMTP Autenticado</title>
<section>
<title>Usando nbSMTP</title>
<body>

<p>
Si necesita darle a su servidor SMTP un nombre de usuario y una clave, puede
editar el comando <c>set sendmail</c> en su archivo <path>.muttrc</path> para
incluir <c>-U &lt;nombre de usuario&gt; -P &lt;clave&gt;</c> tal como se muestra
a continuación:
</p>

<pre caption="Configurando el nombre de usuario y clave para SMTP">
set sendmail="/usr/bin/nbsmtp -U <i>nombre_de_usuario</i> -P <i>clave</i> -d isp.net -h smtp.isp.net -f sunombre@isp.net"
</pre>

<p>
Si no quiere que esta información quede en su archivo <path>.muttrc</path>,
también puede crear un archivo <path>.nbsmtprc</path> en el cual se incluye
dicha información:
</p>

<pre caption="Ejemplo de ~/.nbsmtprc">
auth_user = <i>nombre_de_usuario</i>
auth_pass = <i>clave</i>
</pre>
</body>
</section>

<section>
<title>Alternativa: Usando msmtp</title>
<body>

<p>
<c>msmtp</c> es una alternativa simple a  <c>nbsmtp</c> y que ofrece
características similares.
</p>

<pre caption="Instalando msmtp">
# <i>emerge msmtp</i>
</pre>

<p>
Configure mstmp creando un archivo <path>~/.msmtprc</path> que contenga
la información de su servidor SMTP. ¡Recuerde ajustar los permisos a un valor
seguro!
</p>

<pre caption="Configurando msmtp">
# <i>nano -w .msmtprc</i>
account default
host <i>smtp.su_proveedor.net</i>
from <i>su_nombre_de_usuario@proveedor1.net</i>
<comment>#Vea la página del manual para más opciones de autentificación</comment>
auth login
user <i>su_nombre_de_usuario</i>
password <i>su_clave</i>
<comment>#Si su servidor SMTP ofrece la posibilidad de cifrado TLS, descomente la siguiente línea
#tls</comment>
</pre>

<p>
Ahora configure los permisos del archivo a un valor seguro:
</p>

<pre caption="Ajustando los permisos del archivo de configuración">
# <i>chmod 600 .msmtprc</i>
</pre>

<p>
Finalmente, edite o agregue la siguiente línea a su <path>.muttrc</path>
</p>

<pre caption="Usando msmtp con Mutt">
# <i>nano -w .muttrc</i>
set sendmail="/usr/bin/msmtp"
</pre>

<p>
Ejecute <c>mutt</c> y ¡envíese un correo a si mismo para ver si funcionó!
Vea la página del manual de mstmp para más opciones y otros ejemplos.
</p>
</body>
</section>
</chapter>
</guide>
