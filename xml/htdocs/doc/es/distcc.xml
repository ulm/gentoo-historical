<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/distcc.xml,v 1.4 2005/03/26 15:56:04 chiguire Exp $ -->

<guide link="/doc/es/distcc.xml" lang="es">

<title>Documentación de Gentoo Distcc</title>

<author title="Autora">
    <mail link="lisa@gentoo.org">Lisa M. Seelye</mail>
</author>
<author title="Editor">
  <mail link="vapier@gentoo.org">Mike Frysinger</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="pylon@gentoo.org">Lars Weiler</mail>
</author>
<author title="Revisor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor Es">
	<mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es">
	<mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Editor Es">
	<mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>
<author title="Traductor">
	<mail link="jjptapia@eresmas.com">Juan Jesús Prieto</mail>
</author>

<abstract>
Este documento explica cómo usar distcc con Gentoo.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.11</version>
<date>2005-03-25</date>

<chapter>
<title>Introducción</title>
<section>
<title>¿Qué es distcc?</title>
<body>

<p>
Distcc es un programa diseñado para distribuir tareas de compilación
a través de la red hacia máquinas participantes. Consiste en un servidor,
<c>distccd</c> y un programa cliente, <c>distcc</c>. Distcc puede trabajar
de manera transparente con <uri link="http://ccache.samba.org">ccache</uri>
y Portage mediante una sencilla configuración.
</p>
</body>
</section>

<section>
<title>Usando distcc para hacer el bootstrap</title>
<body>

<p>
Si planea usar distcc para hacer el bootstrap en una instalación
Gentoo, asegúrese de leer <uri link="#bootstrapping">Usando distcc
para hacer el bootstrap</uri> más adelante en este mismo documento.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Configuración</title>
<section>
<title>Dependencias</title>
<body>

<p>
Para utilizar distcc, todas las máquinas en su red deben tener la misma
versión del GCC. El mezclar 3.3.x (variando la x) está bien, pero el
mezclar 3.3.x y 3.2.x hará que los programas <b>tengan</b> errores.
</p>
</body>
</section>

<section>
<title>Instalando Distcc</title>
<body>
<p>
Existen un par de opciones que debe conocer antes de comenzar a
instalar distcc.
</p>

<p>
Distcc tiene un monitor gráfico para vigilar las tareas que su
computador está enviando para compilación. Si usa Gnome, entonces
agregue 'gnome' a sus parámetros USE. Sin embargo, si no lo usa y
todavía desea poder vigilar, entonces coloque 'gtk' en la lista de
parámetros USE.
</p>

<pre caption="Instalando distcc">
# <i>emerge distcc</i>
</pre>
</body>
</section>

<section>
<title>Configurando Portage para usar Distcc</title>
<body>
<p>
Configurar Portage para usar distcc es fácil. Siga estos sencillos
pasos en cada sistema participante en la compilación distribuida:
</p>

<pre caption="Integrando Distcc y Portage">
# <i>emerge distcc</i>
# <i>nano -w /etc/make.conf</i>
<comment>(Ajuste N a un número que refleje su configuración particular)</comment>
<comment>(Una estrategia común es duplicar el número de CPUs + 1)</comment>
MAKEOPTS="-jN"
<codenote>(Agregue distcc a su variable FEATURES)</codenote>
FEATURES="distcc"
</pre>
</body>
</section>

<section>
<title>Especifique las máquinas participantes</title>
<body>
<p>
Utilice el comando <c>distcc-config</c> para indicar la lista de
máquinas. Aquí hay un ejemplo de lista:
</p>

<pre caption="Ejemplo de definicion de maquinas">
192.168.0.1        192.168.0.2                     192.168.0.3
192.168.0.1/2      192.168.0.2                     192.168.0.3/10
192.168.0.1:4000/2 192.168.0.2/1                   192.168.0.3:3632/4
@192.168.0.1       @192.168.0.2:/usr/bin/distccd   192.168.0.3
<comment>(Existen varios otras maneras de configurar esta lista. Vea
192.168.0.la página man de distcc para más detalles.)</comment>
</pre>

<p>
Puede parecer complicado, pero en la mayoría de los casos una
variante de la línea 1 ó 2 funcionará.
</p>

<ul>
  <li>La línea 1 es una lista de máquinas separada por espacios</li>
  <li>
    La línea 2 es una lista de máquinas que especifica la cantidad
    máxima de compilaciones (al definir <c>/N</c>) que se enviarán a
    la máquina en algún momento en particular
  </li>
</ul>

<p>
Como la mayoría no usará las líneas 3 ó 4, enlazaremos con los <uri 
link="http://distcc.samba.org/man/distcc_1.html">documentos de
distcc</uri> para mayor información.
</p>

<p>
Por ejemplo, para establecer la primera línea como el ejemplo
anterior:
</p>

<pre caption="Ejemplo del comando para establecer las máquinas">
# <i>/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"</i>
</pre>

<p>
Modifique su <path>/etc/conf.d/distccd</path> según sus necesidades y
asegúrese usar la directiva <c>--allow</c> para permitir solamente
máquinas en las cuales confía. Para mayor seguridad use también la
directiva <c>--listen</c> para indicarle al demonio distcc cuál
interfaz utilizar en sistema de múltiples interfaces. Para más
información acerca de seguridad y distcc vea el documento <uri link="http://distcc.samba.org/security.html">Distcc Security
Design</uri> (en inglés).
</p>

<p>
Ahora inicie el demonio distcc en todos las máquinas participantes:
</p>

<pre caption="Iniciando el demonio distcc">
<comment>(Agregue distccd al nivel de ejecución default)</comment>
# <i>rc-update add distccd default</i>
<comment>(Inicie el demonio distcc)</comment>
# <i>/etc/init.d/distccd start</i>
</pre>
</body>
</section>

<section>
<title>Configurar Distcc para trabajar con Automake</title>
<body>
<p>
Esto es más fácil de configurar en algunos casos que con Portage. Hay
actualizar su variable de entorno <c>PATH</c> para incluir
<path>/usr/lib/distcc/bin</path> antes del directorio donde gcc esté
situado (<path>/usr/bin</path>). No obstante, hay un problema. Si usa
ccache, deberá poner distcc después de ccache. Sería algo así:
</p>

<pre caption="Configurando su path">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>

<p>
Entonces, así como normalmente escribiría <c>make</c>, escribirá
<c>make -jN</c> (donde N es un entero). El valor de N varía según su
red y la cantidad de máquinas disponibles para compilación. En mi
caso, tengo un P3 dual y un K6-2/400 que compilan todo para mi
escritorio (un Athlon Thunderbird de 1200MHz) y uso -j5. Pruebe
con sus propios ajustes para encontrar el número N que le dé el mejor
desempeño.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Compilación Cruzada</title>
<section>
<title>Una nota sobre Compilación Cruzada</title>
<body>
<p>
La compilación cruzada consiste en usar una arquitectura para
construir programas para otra arquitectura. Esto puede ser tan simple
como usar un Athlon (i686) para construir un programa para un K6-2
(i586), o usar un Sparc para realizar un programa para un ppc.
</p>
</body>
</section>

<section>
<title>Una Introducción a la Compilación Cruzada</title>
<body>

<p>
Si desea probar la compilación cruzada, puede hacer emerge al paquete
crossdev. No puedo proveerle soporte, ya que no lo escribí, pero al
menos es un buen comienzo a la compilación cruzada.
</p>
</body>
</section>
</chapter>

<chapter id="bootstrapping">
<title>Usando Distcc para hacer el Bootstrap</title>
<section>
<title>Paso 1: Configuración de Portage </title>
<body>
<p>
Arranque su máquina nueva con un LiveCD Gentoo Linux y siga las <uri 
link="/doc/en/handbook/handbook-x86.xml?part=1">instrucciones de
instalación</uri> hasta la parte que cubre el bootstrapping. Luego
configure Portage para usar distcc:
</p>

<pre caption="Configuración preliminar">
# <i>nano -w /etc/make.conf</i>
<comment>(Agregue distcc a la variable FEATURES)</comment>
FEATURES="distcc"
<comment>(Modifique MAKEOPTS para incluir -jN con un valor entero
apropiado para N)</comment>
MAKEOPTS="-jN"
</pre>

<pre caption="Estableciendo el path">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>
</body>
</section>

<section>
<title>Step 2: Obteniendo Distcc</title>
<body>

<p>
Antes de instalar distcc, debe agregar un usuario con ese nombre al
<path>/etc/passwd</path>:
</p>

<pre caption="Creando el usuario distcc">
# <i>echo "distcc:x:240:2:distccd:/dev/null:/bin/false" &gt;&gt; /etc/passwd</i>
</pre>

<p>
Instale distcc:
</p>

<pre caption="Obteniendo Distcc en la máquina nueva">
# <i>USE='-*' emerge --nodeps distcc</i>
</pre>
</body>
</section>

<section>
<title>Step 3: Configurando Distcc</title>
<body>

<p>
Ejecute <c>distcc-config</c> para configurar distcc:
</p>

<pre caption="Configuración final de distcc">
<comment>(Sustituya host1, host2, ... con las direcciones IP de las
demás máquinas participantes)</comment>
# <i>/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."</i>
<comment>Un ejemplo: <i>/usr/bin/distcc-config --set-hosts "localhost 192.168.0.4 192.168.0.6"</i></comment>
</pre>

<p>
¡Distcc ya está configurado para hacer bootstrap! Continue con las
instrucciones de instalación oficiales y <e>no se olvide</e> de hacer
emerge distcc otra vez luego de hacer <c>emerge system</c>. Esto
asegurará que la dependencias requeridas serán instaladas también.
</p>

<note>
Durante el bootstrap y <c>emerge system</c> pudiera parecer que distcc
no esté siendo usado. Esto se espera, ya que algunos ebuilds no
trabajan bien con distcc, por lo que intencionalmente se le
desactiva.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Solucionando Problemas</title>
<section>
<title>Mozilla y Xfree</title>
<body>

<p>
A medida que haga emerge con varios paquetes, notará que algunos no
están siendo distribuidos (no siendo construidos en paralelo). Esto es
porque los desarrolladores de los ebuild de Mozilla y Xfree
intencionalmente desactivan la construcción en paralelo porque causa
problemas.
</p>

<p>
A veces, distcc causará que falle la compilación de algún paquete. Si
esto le ocurre, por favor <uri
link="http://bugs.gentoo.org">repórtelo</uri>.
</p>
</body>
</section>

<section>
<title>Una combinación de máquinas con compiladores hardened-gcc y
non-hardened-gcc causará problemas</title>
<body>

<p>
Con un título tan largo, cualquier explicación es casi
irrelevante. Sin embargo, si planea usar distcc en una combinación de
máquinas que usan el compilador <uri
link="/proj/en/hardened/etdyn-ssp.xml">PaX/hardened-gcc</uri> y otras
que no, tendrá problemas.
</p>

<p>
La solución requiere algo de planificación de su parte; debe ejecutar
<c>hardened-gcc -R</c> en la máquina que tiene el compilador
PaX/hardened-gcc o debe activar la protección PaX en su kernel y hacer
<c>emerge hardened-gcc</c>. Ambas cosas son útiles ya que la
protección ofrecida por ambos paquetes es buena y transparente al
usuario.
</p>
</body>
</section>

<section>
<title>Combinación de versiones del GCC</title>
<body>

<p>
Si tiene versiones distintas de GCC en sus máquinas, podrá haber
problemas muy extraños. La solución está en asegurarse que todas las
máquinas tengan la misma versión de GCC.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Extras de Distcc</title>
<section>
<title>Monitors de Distcc</title>
<body>

<p>
Distcc trae dos monitores. El de consola siempre se construye y se
llama <c>distccmon-text</c>. Ejecutarlo por la primera vez puede ser
una experiencia algo confusa, pero sin embargo es realmente fácil de
usar. Si lo ejecuta sin parámetros solo correrá una vez, pero si le
pasa un número N como argumento, actualizará cada N segundos.
</p>

<p>
El otro monitor solo se construye si activa los parámetros USE
<c>gtk</c> o <c>gnome</c>. Es basado en GTK+, corre en el entorno X y
es bastante bonito.
</p>

<pre caption="Iniciando los monitores">
# <i>distccmon-text N</i>
<comment>(o)</comment>
# <i>distccmon-gnome</i>
<comment>Para verificar el funcionamiento de distcc por Portage, puede usar:</comment>
# <i>DISTCC_DIR="/var/tmp/portage/.distcc/" distccmon-text N</i>
<comment>(o sino)</comment>
# <i>DISTCC_DIR="/var/tmp/portage/.distcc/" distccmon-gnome</i>
</pre>

<impo>
Si su directorio distcc está ubicado en otra parte, cambie la variable
de entorno DISTCC_DIR de manera correspondiente.
</impo>
</body>
</section>
</chapter>
</guide>
