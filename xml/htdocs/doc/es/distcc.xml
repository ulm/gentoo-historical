<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/distcc.xml,v 1.8 2006/02/16 12:55:04 chiguire Exp $ -->

<guide link="/doc/es/distcc.xml" lang="es">

<title>Documentación de Gentoo Distcc</title>

<author title="Autora">
  <mail link="lisa@gentoo.org">Lisa M. Seelye</mail>
</author>
<author title="Editor">
  <mail link="vapier@gentoo.org">Mike Frysinger</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="pylon@gentoo.org">Lars Weiler</mail>
</author>
<author title="Revisor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Traductor">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Traductor">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Traductor">
  <mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>
<author title="Traductor">
  <mail link="jjptapia@eresmas.com">Juan Jesús Prieto</mail>
</author>
<author title="Traductor">
  <mail link="anpereir@gentoo.org">Andrés Pereira</mail>
</author>

<abstract>
Este documento explica cómo usar distcc con Gentoo.
</abstract>

<!-- El contenido de este documento está registrado bajo los términos de la licencia CC-BY-SA -->
<!-- http://creativecommons.org/licenses/by-sa/1.0/deed.es -->

<license/>

<version>1.13</version>
<date>2006-01-25</date>

<chapter>
<title>Introducción</title>
<section>
<title>¿Qué es distcc?</title>
<body>

<p>
Distcc es un programa diseñado para distribuir tareas de compilación
a través de la red hacia máquinas participantes. Consiste en un servidor,
<c>distccd</c> y un programa cliente, <c>distcc</c>. Distcc puede trabajar
de manera transparente con <uri link="http://ccache.samba.org">ccache</uri>
, Portage y Automake con una sencilla configuración.
</p>
</body>
</section>

<section>
<title>Usando distcc para hacer el bootstrap</title>
<body>

<p>
Si planea usar distcc para hacer el bootstrap en una instalación
Gentoo, asegúrese de leer la sección <uri link="#bootstrapping">Usando distcc
para hacer el bootstrap</uri> más adelante en este mismo documento.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Configuración</title>
<section>
<title>Dependencias</title>
<body>

<p>
Para utilizar distcc, todas las máquinas en su red deben tener la misma
versión del GCC. El mezclar 3.3.x (variando la x) está bien, pero el
mezclar 3.3.x y 3.2.x <b>puede</b> resultar en que hayan errores
en tiempo de compilación o ejecución.
</p>

</body>
</section>

<section>
<title>Instalando Distcc</title>
<body>
<p>
Existen un par de opciones que debiera conocer antes de comenzar a
instalar distcc.
</p>

<p>
Distcc tiene un monitor gráfico para monitorizar las tareas que su
computador está enviando para compilación. Si usa Gnome, entonces
agregue 'gnome' a sus parámetros USE. Sin embargo, si no lo usa y
todavía desea poder monitorizar, entonces coloque 'gtk' en la lista de
parámetros USE.
</p>

<pre caption="Instalando distcc">
# <i>emerge distcc</i>
</pre>
</body>
</section>

<section>
<title>Configurando Portage para usar Distcc</title>
<body>

<p>
Configurar Portage para usar distcc es fácil. Siga estos sencillos
pasos en cada sistema participante en la compilación distribuida:
</p>

<pre caption="Integrando Distcc y Portage">
# <i>emerge distcc</i>
# <i>nano -w /etc/make.conf</i>
<comment>(Ajuste N a un número que refleje su configuración particular)</comment>
<comment>(Una estrategia común es duplicar el número de CPUs + 1)</comment>
MAKEOPTS="-jN"
<comment>(Agregue distcc a su variable FEATURES)</comment>
FEATURES="distcc"
</pre>
</body>
</section>

<section>
<title>Especifique las máquinas participantes</title>
<body>
<p>
Utilice el comando <c>distcc-config</c> para indicar la lista de
máquinas. Aquí hay un ejemplo de lista:
</p>

<pre caption="Ejemplo de definicion de maquinas">
192.168.0.1        192.168.0.2                     192.168.0.3
192.168.0.1/2      192.168.0.2                     192.168.0.3/10
192.168.0.1:4000/2 192.168.0.2/1                   192.168.0.3:3632/4
@192.168.0.1       @192.168.0.2:/usr/bin/distccd   192.168.0.3
<comment>(Existen varios otras maneras de configurar esta lista. Vea
la página man de distcc para más detalles.)</comment>
<comment>Si desea compilar en la máquina local debería colocar 'localhost'
en la lista de máquinas. Contrariamente si no desea usar la máquina local
para compilar (que frecuentemente es el caso) omítala de la lista. En una
máquina lenta usar localhost puede de hecho hacer las cosas más lentas. 
Asegúrese de probar sus ajustes en pos del rendimiento.</comment>
</pre>

<p>
Puede parecer complicado, pero en la mayoría de los casos una
variante de la línea 1 ó 2 funcionará.
</p>

<p>
Como la mayoría no usará las líneas 3 ó 4, enlazaremos con los <uri 
link="http://distcc.samba.org/man/distcc_1.html">documentos de
distcc</uri> para mayor información.
</p>

<p>
Por ejemplo, para ajustar la primera línea como el ejemplo
anterior:
</p>

<pre caption="Ejemplo del comando para establecer las máquinas">
# <i>/usr/bin/distcc-config --set-hosts "192.168.0.1 192.168.0.2 192.168.0.3"</i>
</pre>

<p>
Modifique su <path>/etc/conf.d/distccd</path> según sus necesidades y
asegúrese usar la directiva <c>--allow</c> para permitir solamente
máquinas en las cuales confía. Para mayor seguridad use también la
directiva <c>--listen</c> para indicarle al demonio distcc cuál
interfaz utilizar en sistema de múltiples interfaces. Para más
información acerca de seguridad y distcc vea el documento <uri
link="http://distcc.samba.org/security.html">Distcc Security
Design</uri> (en inglés).
</p>

<impo>
Es importante usar las opciones --allow y --listen. Por favor lea
la página del manual de distccd o el documento de seguridad señalado
arriba para mayor información.
</impo>

<p>
Ahora inicie el demonio distcc en todas las máquinas participantes:
</p>

<pre caption="Iniciando el demonio distcc">
<comment>(Agregue distccd al nivel de ejecución default)</comment>
# <i>rc-update add distccd default</i>
<comment>(Inicie el demonio distcc)</comment>
# <i>/etc/init.d/distccd start</i>
</pre>
</body>
</section>

<section>
<title>Configurar Distcc para trabajar con Automake</title>
<body>
<p>
Esto es más fácil de configurar en algunos casos que con Portage. Hay que
actualizar su variable de entorno <c>PATH</c> para incluir
<path>/usr/lib/distcc/bin</path> antes del directorio donde gcc esté
situado (<path>/usr/bin</path>). No obstante, hay un problema. Si usa
ccache, deberá poner distcc después de ccache. Sería algo así:
</p>

<pre caption="Configurando su path">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
<comment>Puede colocar esto en su archivo .bashrc o su equivalente para
tener configurada la variable PATH cada vez que ingrese al sistema.
</comment>
</pre>

<p>
Entonces, así como normalmente escribiría <c>make</c>, escribirá
<c>make -jN</c> (donde N es un entero). El valor de N varía según su
red y la cantidad de máquinas disponibles para la compilación. 
Pruebe con sus propios ajustes para encontrar el número N que le dé el mejor
desempeño.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Compilación Cruzada</title>
<section>
<body>
<p>
La compilación cruzada consiste en usar una arquitectura para
construir programas para otra arquitectura. Esto puede ser tan simple
como usar un Athlon (i686) para compilar un programa para un K6-2
(i586), o usar un Sparc para compilar un programa para un ppc. Esto se
encuentra documentado en nuestra <uri link="/doc/en/cross-compiling-distcc.xml">
Guía de compilación cruzada con distcc</uri>.
</p>
</body>
</section>
</chapter>

<chapter id="bootstrapping">
<title>Usando Distcc para hacer el Bootstrap</title>
<section>
<title>Paso 1: Configuración de Portage </title>
<body>

<p>
Arranque su máquina nueva con un CD de Instalación Gentoo Linux y siga las <uri
link="/doc/es/handbook/handbook-x86.xml?part=1">instrucciones de
instalación</uri> hasta la parte que cubre el bootstrapping. Luego
configure Portage para usar distcc:
</p>

<pre caption="Configuración preliminar">
# <i>nano -w /etc/make.conf</i>
<comment>(Agregue distcc a la variable FEATURES)</comment>
FEATURES="distcc"
<comment>(Modifique MAKEOPTS para incluir -jN, donde N representa
el doble de la cantidad de CPUs disponibles + 1)
</comment>
MAKEOPTS="-jN"
</pre>

<pre caption="Configurar la ruta">
# <i>export PATH="/usr/lib/ccache/bin:/usr/lib/distcc/bin:${PATH}"</i>
</pre>
</body>
</section>

<section>
<title>Paso 2: Obtener Distcc</title>
<body>

<p>
Antes de instalar distcc, debe agregar un usuario con ese nombre al
<path>/etc/passwd</path>:
</p>

<pre caption="Crear el usuario distcc">
# <i>echo "distcc:x:240:2:distccd:/dev/null:/bin/false" &gt;&gt; /etc/passwd</i>
</pre>

<impo>
Es importante señalar que agregar usuarios de esta forma es muy malo.
Sólo lo hacemos aquí porque todavía no existe la utilidad <c>useradd</c> 
(que normalmente se usa para agregar usuarios) en esta etapa de la
instalación.
</impo>

<p>
Instale distcc:
</p>

<pre caption="Obtener Distcc en la máquina nueva">
# <i>USE='-*' emerge --nodeps sys-devel/distcc</i>
</pre>
</body>
</section>

<section>
<title>Paso 3: Configurar Distcc</title>
<body>

<p>
Ejecute <c>distcc-config</c> para configurar distcc:
</p>

<pre caption="Configuración final de distcc">
<comment>(Substituya host1, host2, ... con las direcciones IP de las
demás máquinas participantes)</comment>
# <i>/usr/bin/distcc-config --set-hosts "localhost host1 host2 host3 ..."</i>
<comment>Un ejemplo: <i>/usr/bin/distcc-config --set-hosts "localhost 192.168.0.4 192.168.0.6"</i></comment>
</pre>

<p>
¡Distcc ya está configurado para hacer bootstrap! Continúe con las
instrucciones de instalación oficiales y <e>no se olvide</e> de hacer
emerge distcc otra vez luego de ejecutar <c>emerge system</c>. Esto
asegurará que la dependencias requeridas también sean instaladas.
</p>

<note>
Durante el bootstrap y <c>emerge system</c> pudiera parecer que distcc
no esté siendo usado. Esto es esperable ya que algunos ebuilds no
trabajan bien con distcc, por lo que intencionalmente se le
desactiva.
</note>
</body>
</section>
</chapter>

<chapter>
<title>Solucionando Problemas</title>
<section>
<title>Mozilla y Xfree</title>
<body>

<p>
A medida que haga emerge con varios paquetes, notará que algunos no
están siendo distribuidos (no están siendo compilados en paralelo). Esto es
porque los desarrolladores de los ebuilds de Mozilla y Xfree
intencionalmente desactivan la complicación en paralelo ya que causa
problemas.
</p>

<p>
A veces, distcc causará que falle la compilación de algún paquete. Si
esto le ocurre, por favor <uri link="http://bugs.gentoo.org">repórtelo</uri>.
</p>
</body>
</section>

<section>
<title>Una combinación de máquinas con compiladores hardened-gcc y
non-hardened-gcc causará problemas</title>
<body>

<p>
Con un título tan largo, cualquier explicación es casi
irrelevante. Sin embargo, si planea usar distcc en una combinación de
máquinas que usan el compilador <uri
link="/proj/en/hardened/etdyn-ssp.xml">PaX/hardened-gcc</uri> y otras
que no, tendrá problemas.
</p>

<p>
La solución requiere algo de planificación de su parte; debe ejecutar
<c>hardened-gcc -R</c> en la máquina que tiene el compilador
PaX/hardened-gcc o debe activar la protección PaX en su kernel y hacer
<c>emerge hardened-gcc</c>. Ambas cosas son útiles ya que la
protección ofrecida por ambos paquetes es buena y transparente al
usuario.
</p>
</body>
</section>

<section>
<title>Combinación de versiones del GCC</title>
<body>

<p>
Si tiene versiones distintas de GCC en sus máquinas, podrá haber
problemas muy extraños. La solución está en asegurarse que todas las
máquinas tengan la misma versión de GCC.
</p>

<p>
Las actualizaciones recientes de Portage hacen que este use <c>${CHOST}-gcc</c>
en vez de <c>gcc</c>. Esto significa que si está combinando máquinas i686
con otras de distinto tipo (i386, i586) tendrá problemas. Una solución temporal
a esto puede ser exportar la variable de entorno CC con <c>export CC='gcc' CXX='c++'</c>
o colocarla en el archivo <path>/etc/make.conf</path>.
</p>

<impo>
Hacer esto explícitamente redefine algo del comportamiento de Portage y puede
que tenga resultados un tanto extraños en el futuro. Sólo haga esto si está
combinando CHOSTs.
</impo>
</body>
</section>
</chapter>

<chapter>
<title>Extras de Distcc</title>
<section>
<title>Monitores de Distcc</title>
<body>

<p>
Distcc trae dos monitores. El de consola siempre se compila y se
llama <c>distccmon-text</c>. Ejecutarlo por la primera vez puede ser
una experiencia algo confusa, sin embargo es realmente fácil de
usar. Si lo ejecuta sin parámetros solo correrá una vez, pero si le
pasa un número N como argumento, actualizará cada N segundos.
</p>

<p>
El otro monitor solo se compila si activa los parámetros USE
<c>gtk</c> o <c>gnome</c>. Es basado en GTK+, se ejecuta en el entorno X y
es bastante bonito. En Gentoo el monitor gráfico ha sido llamado 
<c>distccmon-gui</c> para evitar confusiones. En otras partes
puede que sea llamado <c>distccmon-gnome</c>.
</p>

<pre caption="Iniciar los monitores">
# <i>distccmon-text N</i>
<comment>(O)</comment>
<i>distccmon-gui</i>
<comment>Para verificar el funcionamiento de distcc por Portage, puede usar:</comment>
# <i>DISTCC_DIR="/var/tmp/portage/.distcc/" distccmon-text N</i>
<comment>(O sino)</comment>
# <i>DISTCC_DIR="/var/tmp/portage/.distcc/" distccmon-gui</i>
</pre>

<impo>
Si su directorio distcc está ubicado en otra parte, cambie la variable
de entorno DISTCC_DIR de manera correspondiente.
</impo>
</body>
</section>
</chapter>
</guide>
