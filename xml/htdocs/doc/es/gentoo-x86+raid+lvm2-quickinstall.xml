<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/gentoo-x86+raid+lvm2-quickinstall.xml,v 1.4 2007/05/10 22:27:33 chiguire Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/es/gentoo-x86+raid+lvm2-quickinstall.xml" lang="es">
<title>Guía de Instalación Rápida Gentoo Linux x86 con Software Raid y LVM2</title>

<author title="Autor">
  <mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Autor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Autor">Steven Wagner</author>
<author title="Traductor">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>

<abstract>
Esta guía de instalación rápida cubre el proceso de instalación de
Gentoo de manera resumida. Su propósito es permitirle a los usuarios
realizar una instalación stage3 con software raid y lvm2 en poco
tiempo. Los usuarios deberían tener experiencia previa de instalación
de Gentoo para poder seguir esta guía.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>9</version>
<date>2007-05-08</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
Esta guía contiene todos los comandos usados para completar una
instalación stage3 incluyendo LVM2 sobre software raid. Esta guía está
dirigida hacia usuarios experimentados. Se necesita una conexión a
Internet para descargar los archivos stage3 e imagen de Portage.
</p>

<p>
Información acerca del tiempo sigue todos los comandos que ejecutan
en más de dos segundos. Los tiempos fueron tomados en una máquina AMD
2000 de 1,66 GHz con 512 Mb de RAM y dos discos SATA conectados a un
controlador configurado como JBOD (por ejemplo, en Gentoo se ven como
dos discos duros separados). Si tienen un controlador raid en
"hardware" en su tarjeta madre, lo más probable es que <b>no</b> sea
un controlador raid verdadero.
</p>

<pre caption="Especificaciones de la máquina de prueba">
<comment>(Las siguientes especificaciones y tiempos pueden ayudarlo a
formar un estimado del tiempo requerido para completar la instalación)</comment>

# <i>grep bogo /proc/cpuinfo</i>
bogomips       : 3337.81

# <i>hdparm -tT /dev/sda /dev/sdb</i>
/dev/sda:
reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

/dev/sdb:
 Timing cached reads:   1048 MB in  2.00 seconds = 524.00 MB/sec
 Timing buffered disk reads:  152 MB in  3.01 seconds =  50.50 MB/sec

# <i>grep MemTotal /proc/meminfo</i>
MemTotal:       509248 kB
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Guía de Instalación Rápida</title>
<section>
<title>Medios para la Instalación</title>
<body>

<p>
Descargue un CD de uno de nuestros <uri
link="/main/en/mirrors.xml">servidores réplica</uri>. Podrá encontrar
el iso del CD mínimo en
<path>releases/x86/&lt;release&gt;/installcd</path> o el iso del
LiveCD ISO en <path>releases/x86/&lt;release&gt;/livecd</path>. El CD
de instalación <e>mínimo</e> solamente es útil para instalaciones con
conexión a Internet. Puede usar el <e>LiveCD</e> para realizar una
instalación sin acceso a la red, tal como se documenta en el <uri
link="/doc/es/handbook/2007.0/handbook-x86.xml">manual de instalación
2007.0 para x86</uri>. Recomendamos el CD de instalación mínimo.
</p>

<p>
<uri link="/doc/es/faq.xml#isoburning">Queme</uri> el CD y luego úselo
para arrancar.
</p>
</body>
</section>

<section>
<title>Arrancando con el CD</title>
<body>

<p>
Pulse <c>F2</c> en la pantalla de inicio para averiguar cuáles son las
opciones existentes. Puede iniciar con <c>gentoo</c>
o <c>gentoo-nofb</c>, el último desactiva el framebuffer. Si inicia
con el LiveCD, no se olvide agregar la opción <c>nox</c> para evitar
que arranque el entorno gráfico X. Varias otras opciones permiten
activar o desactivar algunas características. Si todo va bien, el
hardware será detectado y los módulos correspondientes cargados. Si el
kernel no inicia correctamente o si el computador se cuelga durante el
inicio, podrá tener que experimentar con distintas configuraciones. La
forma más segura probablemente será usar la opción <c>nodetect</c> y
luego cargar los módulos requeridos manualmente.
</p>

<pre caption="Iniciar el CD mínimo">
Gentoo Linux Installation LiveCD                     http://www.gentoo.org
Enter to Boot; F1 for kernels  F2 for options.
boot: <i>gentoo-nofb</i>
  <comment>(o en caso de problemas)</comment>
boot: <i>gentoo-nofb nodetect</i>
</pre>
</body>
</section>

<section>
<title>Opcional: cargando los módulos</title>
<body>

<p>
Si usó la opción <c>nodetect</c>, una vez iniciado el equipo, cargue
los módulos necesarios. Hará falta activar las redes y tener accesos a
sus discos. El comando <c>lspci</c> es útil para ayudar a identificar
el hardware.
</p>

<pre caption="Cargando los módulos requeridos">
livecd root # <i>lspci</i>
<comment>(Use la salida de lspci para identificar los módulos necesarios)</comment>

<comment>(Lo siguiente es a modo de ejemplo, adáptelo según su hardware)</comment>
livecd root # <i>modprobe 3w-9xxx</i>
livecd root # <i>modprobe r8169</i>
</pre>
</body>
</section>

<section>
<title>Configuración de Red</title>
<body>

<p>
Si no está funcionando la red, puede usar <c>net-setup</c> para
configurarla. Puede necesitar cargar el soporte para la tarjeta de red
con <c>modprobe</c> antes de configurar. Si tiene ADSL, use
<c>pppoe-setup</c> y <c>pppoe-start</c>. Si está usando un enrutador
ADSL, este establecerá la conexión y no necesit correr esos
guiones. Para soportar PPTP, primero
modifique <path>/etc/ppp/chap-secrets</path>
y <path>/etc/ppp/options.pptp</path> y use el <c>pptp
&lt;server&nbsp;ip&gt;</c>.
</p>

<p>
Para acceso inalámbrico, use <c>iwconfig</c> para configurar los
parámetros de red inalámbrica y luego o use <c>net-setup</c> de nuevo
o <c>ifconfig</c>, <c>dhcpcd</c> y/o <c>route</c> manualmente.
</p>

<p>
Si está detrás de un proxy, no se olvide inicializar el sistema
con <c>export http_proxy</c>, <c>ftp_proxy</c> y <c>RSYNC_PROXY</c>.
</p>

<pre caption="Configuración de redes, la manera guiada">
livecd root # <i>net-setup eth0</i>
</pre>

<p>
Alternativamente, puede iniciar la red manualmente. El siguiente
ejemplo asigna la dirección IP 192.168.1.10 al PC y define a
192.168.1.1 como el enrutador y servidor DNS.
</p>

<pre caption="Configuración de redes, la manera manual">
livecd root # <i>ifconfig eth0 192.168.1.10/24</i>
livecd root # <i>route add default gw 192.168.1.1</i>
livecd root # <i>echo nameserver 192.168.1.1 > /etc/resolv.conf</i>
</pre>

<p>
El CD de instalación permite iniciar el servidor <c>sshd</c>, agregar
usuarios adicionales, ejecutar <c>irssi</c> (un cliente de chat por
irc de consola) y surfear la web con <c>lynx</c> o <c>links</c>.
</p>
</body>
</section>

<section>
<title>Opcional: conecte a su nueva máquina con ssh</title>
<body>

<p>
La más interesante característica es, por supuesto <c>sshd</c>. Puede
iniciarlo y luego conectarse desde otra máquina y luego cortar y pegar
los comandos de esta guía.
</p>

<pre caption="Iniciar sshd">
livecd root # <i>time /etc/init.d/sshd start</i>
 * Generating hostkey ...
<comment>(sshd genera las claves y salida adicional)</comment>
 * starting sshd ...                            [ok]

real   0m13.688s
user   0m9.420s
sys    0m0.090s
</pre>

<p>
Ahora debe asignarle una contraseña al usuario del liveCD para poder
conectarse desde otro PC. Por favor note que el permitirle a root
conectarse no es recomendable bajo circunstancias normales. Si no
confía en la red local, use una clave larga y compleja. Úsela una sola
vez, ya que desaparecerá después del primer reinicio.
</p>

<pre caption="Configurar la contraseña de root">
livecd root # <i>passwd</i>
New UNIX password: <comment>escriba_la_contraseña</comment>
Retype new UNIX password: <comment>escriba_la_contraseña</comment>
passwd: password updated successfully
</pre>

<p>
Ahora puede iniciar una consola en otra máquina y conectar al equipo
nuevo, siguiendo esta guía en otra ventana mientras cómodamente corta
y pega los comandos.
</p>

<pre caption="Conecte al equipo nuevo desde otra máquina">
<comment>(Use la dirección IP de la máquina nueva)</comment>
$ <i>ssh root@192.168.1.10</i>
The authenticity of host '192.168.1.10 (192.168.1.10)' can't be established.
RSA key fingerprint is 96:e7:2d:12:ac:9c:b0:94:90:9f:40:89:b0:45:26:8f.
Are you sure you want to continue connecting (yes/no)? <i>yes</i>
Warning: Permanently added '192.168.1.10' (RSA) to the list of known hosts.
Password: <comment>escriba_la_contraseña</comment>
</pre>
</body>
</section>

<section>
<title>Preparando los Discos</title>
<body>

<p>
Cargue los módulos para RAID en software y LVM2.
</p>

<pre caption="Cargar los módulos RAID y LVM2">
livecd ~ # <i>modprobe raid0</i>
livecd ~ # <i>modprobe raid1</i>
<comment>(también están disponibles raid5, raid6 y raid10)</comment>

livecd ~ # <i>modprobe dm-mod</i>
</pre>

<p>
Use <c>fdisk</c> o <c>cfdisk</c> para crear el esquema de
particiones. Los nombres de los dispositivos probablemente serán
o <path>/dev/sda</path> y <path>/dev/sdb</path> para un disco SATA o
SCSI, o <path>/dev/hda</path> y <path>/dev/hdb</path> para discos
IDE. El siguiente esquema será usado en esta guía:
</p>

<table>
  <tr>
    <ti/>
    <th><path>/dev/sda</path></th>
    <th><path>/dev/sdb</path></th>
    <th>Tipo</th>
  </tr>
  <tr>
    <th><path>/dev/md1</path></th>
    <th><path>/boot</path></th>
    <th><path>/boot</path></th>
    <ti>Raid-1 (espejos)</ti>
  </tr>
  <tr>
    <th/>
    <th>intercambio</th>
    <th>intercambio</th>
    <ti>Particiones normales</ti>
  </tr>
  <tr>
    <th><path>/dev/md3</path></th>
    <th><path>/</path></th>
    <th><path>/</path></th>
    <ti>Raid-1 (mirroring)</ti>
  </tr>
  <tr>
    <th><path>/dev/md4</path></th>
    <th colspan="2">LVM2 volumes</th>
    <ti>Raid-0 (striped)</ti>
  </tr>
</table>

<impo>
La partición desde donde arrancamos no debe usar el modo distribuido
por bandas (conocido como "striping"), ni puede ser raid-5 o raid-0.
</impo>

<note>
Por otra parte, si desea estabilidad adicional, considere el uso de
raid-1 (o incluso raid-5) para la(s) particion(es) de intercambio, de
manera que si falla un disco no se corrompa el espacio de intercambio
y cuelgue las aplicaciones que la estén usando. Si desea desempeño
adicional, sencillamente permita al kernel usar distintas particiones
de intercambio, ya que por defecto usará el modo "striping".
</note>

<pre caption="Crear las particiones">
livecd ~ # <i>fdisk /dev/sda</i>
<comment>(Asegúrese de usar el tipo fd)</comment>

<comment>(El resto de esta guía usa el siguiente esquema de particiones)</comment>
livecd ~ # <i>fdisk -l /dev/sda</i>

Disk /dev/sda: 299.9 GB, 299989204992 bytes
255 heads, 63 sectors/track, 36471 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1          11       88326   fd  Linux raid autodetect
/dev/sda2              12          61      401625   82  Linux swap / Solaris
/dev/sda3              62         311     2008125   fd  Linux raid autodetect
/dev/sda4             312       36471   290455200   fd  Linux raid autodetect

<comment>(Particione el segundo disco igual que el primero)</comment>
livecd ~ # <i>fdisk /dev/sdb</i>
</pre>

<p>
Luego creamos los nodos y dispositivos RAID:
</p>

<pre caption="Crear los nodos y dispositivos">
livecd ~ # <i>mknod /dev/md1 b 9 1</i>
livecd ~ # <i>mknod /dev/md3 b 9 3</i>
livecd ~ # <i>mknod /dev/md4 b 9 4</i>

livecd ~ # <i>mdadm --create /dev/md1 --level=1 --raid-devices=2 /dev/sda1 /dev/sdb1</i>
mdadm: array /dev/md1 started.
livecd ~ # <i>mdadm --create /dev/md3 --level=1 --raid-devices=2 /dev/sda3 /dev/sdb3</i>
mdadm: array /dev/md3 started.
livecd ~ # <i>mdadm --create /dev/md4 --level=0 --raid-devices=2 /dev/sda4 /dev/sdb4</i>
mdadm: array /dev/md4 started.

<comment>(Debemos esperar hasta que todas las unidades esten listas)</comment>
livecd ~ # <i>cat /proc/mdstat</i>
Personalities : [raid0] [raid1]
md4 : active raid0 sdb4[1] sda4[0]
581006592 blocks 64k chunks

md3 : active raid1 sdb3[1] sda3[0]
1959808 blocks [2/2] [UU]

md1 : active raid1 sdb1[1] sda1[0]
88256 blocks [2/2] [UU]
</pre>

<p>
Entonces creamos los volúmenes LVM2 en <path>/dev/md4</path>. El
siguiente esquema se usa a modo de <b>ejemplo</b>:
</p>

<table>
<tr>
  <th>Directorio</th>
  <th>Tamaño</th>
  <th>Sistema de archivos</th>
</tr>
<tr>
  <ti>/usr</ti>
  <ti>8 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/usr/portage</ti>
  <ti>2 GB</ti>
  <ti>ext2, con bloques pequeños, muchos nodos i (inodes)</ti>
</tr>
<tr>
  <ti>/usr/portage/distfiles</ti>
  <ti>4 GB</ti>
  <ti>ext2, con bloques grandes, menor número de nodos i</ti>
</tr>
<tr>
  <ti>/home</ti>
  <ti>10 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/opt</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var</ti>
  <ti>4 GB</ti>
  <ti>ext3</ti>
</tr>
<tr>
  <ti>/var/tmp</ti>
  <ti>6 GB</ti>
  <ti>ext2</ti>
</tr>
<tr>
  <ti>/tmp</ti>
  <ti>2 GB</ti>
  <ti>ext2</ti>
</tr>
</table>

<pre caption="Creando los volúmenes LVM2">
livecd ~ # <i>vgscan</i>
  Reading all physical volumes.  This may take a while...
  No volume groups found
livecd ~ # <i>vgchange -a y</i>
  No volume groups found

<comment>(Crear volúmenes físicos, solo tenemos uno en nuestro ejemplo)</comment>
livecd ~ # <i>pvcreate /dev/md4</i>
  Physical volume "/dev/md4" successfully created

<comment>(Create grupos de volúmenes, de nuevo, tenemos solo uno en el ejemplo)</comment>
livecd ~ # <i>vgcreate vg /dev/md4</i>
  Volume group "vg" successfully created

<comment>(Crear volúmenes lógicos)</comment>
livecd ~ # <i>lvcreate -L8G -nusr vg</i>
  /dev/cdrom: open failed: Read-only file system
  Logical volume "usr" created <comment>(A continuación no mostramos mensajes similares)</comment>
livecd ~ # <i>lvcreate -L2G -nportage vg</i>
livecd ~ # <i>lvcreate -L4G -ndistfiles vg</i>
livecd ~ # <i>lvcreate -L10G -nhome vg</i>
livecd ~ # <i>lvcreate -L4G -nopt vg</i>
livecd ~ # <i>lvcreate -L4G -nvar vg</i>
livecd ~ # <i>lvcreate -L6G -nvartmp vg</i>
livecd ~ # <i>lvcreate -L2G -ntmp vg</i>

<comment>(Mostrar grupos de volúmenes y volúmenes lógicos)</comment>
livecd ~ # <i>vgs</i>
  VG   #PV #LV #SN Attr  VSize   VFree
  vg     1   8   0 wz--n 554.09G 514.09G
livecd ~ # <i>lvs</i>
  LV        VG   Attr   LSize  Origin Snap%  Move Copy%
  distfiles vg   -wi-a-  4.00G
  home      vg   -wi-a- 10.00G
  opt       vg   -wi-a-  4.00G
  portage   vg   -wi-a-  2.00G
  tmp       vg   -wi-a-  2.00G
  usr       vg   -wi-a-  8.00G
  var       vg   -wi-a-  4.00G
  vartmp    vg   -wi-a-  6.00G
</pre>

<p>
Use los comandos <c>mke2fs</c>, <c>mke2fs
-j</c>, <c>mkreiserfs</c>, <c>mkfs.xfs</c> y <c>mkfs.jfs</c> para
crear los sistema de archivos. Inicialice particiones de intercambio
con <c>mkswap</c> y actívelas con <c>swapon</c>.
</p>

<pre caption="Creando los sistemas de archivos y activando particiones de intercambio">
<comment>(ext2 es todo lo que necesita para la partición /boot)</comment>
livecd ~ # <i>mke2fs /dev/md1</i>

<comment>(Usemos ext3 en la partición raíz)</comment>
livecd ~ # <i>mke2fs -j -O /dev/md3</i>

<comment>(Creamos los sistemas de archivo en los volúmenes lógicos)</comment>
livecd ~ # <i>mke2fs -b 4096 -T largefile /dev/vg/distfiles</i>
livecd ~ # <i>mke2fs -j -O /dev/vg/home</i>
livecd ~ # <i>mke2fs -j -O /dev/vg/opt</i>
livecd ~ # <i>mke2fs -b 1024 -N 200000 /dev/vg/portage</i>
livecd ~ # <i>mke2fs /dev/vg/tmp</i>
livecd ~ # <i>mke2fs -j -O /dev/vg/usr</i>
livecd ~ # <i>mke2fs -j -O /dev/vg/var</i>
livecd ~ # <i>mke2fs -O /dev/vg/vartmp</i>

<comment>(Creando y activando particiones de intercambio)</comment>
livecd ~ # <i>mkswap /dev/sda2 &amp;&amp; mkswap /dev/sdb2</i>
livecd ~ # <i>swapon -p 1 /dev/sda2 &amp;&amp; swapon -p 1 /dev/sdb2</i>
<comment>(Asegúrese que todas las particiones de intercambio tengan la misma prioridad)</comment>
livecd ~ # <i>swapon -v -s</i>
Filename                   Type            Size    Used    Priority
/dev/sda2                  partition       401616  0       1
/dev/sdb2                  partition       401616  0       1
</pre>

<p>
Monte los sistemas de archivo recién creados
en <path>/mnt/gentoo</path>. Cree los directorios para los otros
puntos de montaje y móntelos también.
</p>

<pre caption="Monte los sistema de archivos">
livecd ~ # <i>mount /dev/md3 /mnt/gentoo</i>
livecd ~ # <i>cd /mnt/gentoo</i>
livecd gentoo # <i>mkdir boot home usr opt var tmp</i>
livecd gentoo # <i>mount /dev/md1 /mnt/gentoo/boot</i>
livecd gentoo # <i>mount /dev/vg/usr /mnt/gentoo/usr</i>
livecd gentoo # <i>mount /dev/vg/home /mnt/gentoo/home</i>
livecd gentoo # <i>mount /dev/vg/opt /mnt/gentoo/opt</i>
livecd gentoo # <i>mount /dev/vg/tmp /mnt/gentoo/tmp</i>
livecd gentoo # <i>mount /dev/vg/var /mnt/gentoo/var</i>
livecd gentoo # <i>mkdir usr/portage var/tmp</i>
livecd gentoo # <i>mount /dev/vg/vartmp /mnt/gentoo/var/tmp</i>
livecd gentoo # <i>mount /dev/vg/portage /mnt/gentoo/usr/portage</i>
livecd gentoo # <i>mkdir usr/portage/distfiles</i>
livecd gentoo # <i>mount /dev/vg/distfiles /mnt/gentoo/usr/portage/distfiles</i>

<comment>(Asigne los permisos correctos en los directorios tmp)</comment>
livecd gentoo # <i>chmod 1777 /mnt/gentoo/tmp /mnt/gentoo/var/tmp</i>
</pre>
</body>
</section>

<section>
<title>Preparando para el Stage</title>
<body>

<p>
Primero, asegúrese que la fecha y la hora sean las correctas
usando <c>date MMDDhhmmYYYY</c>. Use hora UTC.
</p>

<pre caption="Ajuste la fecha y hora UTC">
<comment>(Revise el reloj)</comment>
livecd gentoo # <i>date</i>
Mon Mar  6 00:14:13 UTC 2006

<comment>(Ajuste la fecha y hora si hiciera falta)</comment>
livecd gentoo # <i>date 030600162006</i> <comment>(Format is MMDDhhmmYYYY)</comment>
Mon Mar  6 00:16:00 UTC 2006
</pre>

<p>
A continuación, descargue un stage de uno de
nuestros <uri link="/main/en/mirrors.xml">servidores
espejo</uri>. Diríjase a <path>/mnt/gentoo</path> y descomprima el
stage con <c>tar xjpf &lt;stage3 tarball&gt;</c>.
</p>

<pre caption="Descargue el archivo stage3">
livecd gentoo # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Escoja un servidor espejo, cambie al directorio releases/x86/current/stages y escoja el stage3, probablemente el stage i686 y pulse D para descargar)</comment>

<comment>(<b>O sino</b> descárguelo directamente con wget sin escoger un espejo cercano)</comment>
livecd gentoo # <i>wget ftp://gentoo.osuosl.org/pub/gentoo/releases/x86/current/stages/stage3-i686*tar.bz2</i>
</pre>

<pre caption="Descomprima el archivo stage3">
livecd gentoo # <i>time tar xjpf stage3*</i>

real  1m14.157s
user  1m2.920s
sys   0m7.530s
</pre>

<p>
Instale la imagen de Portage más reciente. Proceda igual que con el
archivo stage3: escoja un servidor espejo cercano de
nuestra <uri link="/main/en/mirrors.xml">lista</uri>, descárguelo y
descomprímalo.
</p>

<pre caption="Descargue la imagen más reciente de Portage">
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Escoja un servido espejo y vaya al directorio snapshots/,
seleccione <b>portage-latest.tar.bz2</b> y pulse D para descargar el archivo)</comment>

<comment>(<b>O</b> descárguelo directamente con wget sin escojer el servidor espejo más cercano)</comment>
livecd gentoo # <i>cd /mnt/gentoo/usr</i>
livecd usr # <i>wget http://gentoo.osuosl.org/snapshots/portage-latest.tar.bz2</i>
</pre>

<pre caption="Desempaque la imagen de Portage">
livecd usr # <i>time tar xjf portage-lat*</i>

real  0m40.523s
user  0m28.280s
sys   0m8.240s
</pre>
</body>
</section>

<section>
<title>Ingresando al entorno enjaulado</title>
<body>

<p>
Monte el sistema de archivos <path>/proc</path>, copie el archivo
<path>/etc/resolv.conf</path>, luego ingrese al entorno enjaulado
Gentoo.
</p>

<pre caption="Chroot">
livecd usr # <i>cd /</i>
livecd / # <i>mount -t proc proc /mnt/gentoo/proc</i>
livecd / # <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/</i>
livecd / # <i>chroot /mnt/gentoo /bin/bash</i>
livecd / # <i>env-update &amp;&amp; source /etc/profile</i>
>>> Regenerating /etc/ld.so.cache...
</pre>
</body>
</section>

<section>
<title>Ajuste su zona horaria</title>
<body>

<p>
Ajuste la zona horario usando el listado del directorio
<path>/usr/share/zoneinfo</path>.
</p>

<pre caption="Ajustando la zona horaria">
livecd / # <i>ls /usr/share/zoneinfo</i>
<comment>(Usemos como ejemplo a Bruselas)</comment>
livecd / # <i>cp /usr/share/zoneinfo/Europe/Brussels /etc/localtime</i>
livecd / # <i>date</i>
Wed Mar  8 00:46:05 CET 2006
</pre>
</body>
</section>

<section>
<title>Coloque el nombre de anfitrión y de dominio</title>
<body>

<p>
Coloque el nombre del anfitrión en el
archivo <path>/etc/conf.d/hostname</path> y
en <path>/etc/hosts</path>. En el ejemplo a continuación
usamos <c>mybox</c> como nombre del anfitrión y <c>at.myplace</c> como
el del dominio. Puede modificar los archivos de configuración con el
editor de texto <c>nano</c> o usar los siguientes comandos:
</p>

<pre caption="Colocar el nombre del anfitrión y del dominio">
livecd / # <i>cd /etc</i>
livecd etc # <i>echo "127.0.0.1 mybox.at.myplace mybox localhost" > hosts</i>
livecd etc # <i>sed -i -e 's/HOSTNAME.*/HOSTNAME="mybox"/' conf.d/hostname</i>
<comment>(Use el nombre definido y revíselo)</comment>
livecd etc # <i>hostname mybox</i>
livecd etc # <i>hostname -f</i>
mybox.at.myplace
</pre>
</body>
</section>

<section>
<title>Configuración del Kernel</title>
<body>

<p>
Instale fuentes para un kernel (usualmente <c>gentoo-sources</c>),
configure, compile y copie el
archivo <path>arch/i386/boot/bzImage</path> a <path>/boot</path>.
</p>

<pre caption="Instale fuentes, compile e instale el kernel">
livecd etc # <i>time emerge gentoo-sources</i>

real  3m3.110s
user  1m2.320s
sys   0m34.990s
livecd etc # <i>cd /usr/src/linux</i>
livecd linux # <i>make menuconfig</i>

<comment>(Configure el kernel de la manera usual y asegúrese que el
soporte para raid y lvm estén incluidos y <b>no</b> cómo modules. Lo
mismo aplica para los manejadores de disco y sistemas de archivos.)</comment>
Multi-device support (RAID and LVM)  --->
[*] Multiple devices driver support (RAID and LVM)
  &lt;*&gt;   RAID support
  &lt; &gt;     Linear (append) mode (NEW)
  &lt;*&gt;     RAID-0 (striping) mode
  &lt;*&gt;     RAID-1 (mirroring) mode
  &lt; &gt;     RAID-10 (mirrored striping) mode (EXPERIMENTAL) (NEW)
  &lt; &gt;     RAID-4/RAID-5 mode (NEW)
  &lt; &gt;     RAID-6 mode (NEW)
  &lt; &gt;     Multipath I/O support (NEW)
  &lt; &gt;     Faulty test module for MD (NEW)
  &lt;*&gt;   Device mapper support
  &lt; &gt;     Crypt target support (NEW)
  &lt; &gt;     Snapshot target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Mirror target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Zero target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Multipath target (EXPERIMENTAL) (NEW)
  &lt; &gt;     Bad Block Relocation Device Target (EXPERIMENTAL) (NEW)

livecd linux # <i>time make -j2</i>

<comment>(El tiempo depende altamente en las opciones seleccionadas)</comment>
real  5m5.869s
user  4m32.320s
sys   0m32.930s

livecd linux # <i>make modules_install</i>
livecd linux # <i>cp arch/i386/boot/bzImage /boot/kernel</i>
</pre>
</body>
</section>

<section>
<title>Configure el sistema</title>
<body>

<p>
Modifique el archivo <path>/etc/fstab</path> y cambie <c>BOOT</c>, <c>ROOT</c> y
<c>SWAP</c> con los nombres verdaderos de las particiones y agregue
los volúmenes lógicos. No se olvide de cerciorar que los sistemas de
archivo sean iguales a los de la instalación.
</p>

<pre caption="Ejemplo de fstab">
livecd linux # <i>cd /etc</i>
livecd etc # <i>nano -w fstab</i>
/dev/<i>md1</i>          /boot                   ext2  noauto,noatime  1 2
/dev/<i>md3</i>          /                       ext3  noatime         0 1
/dev/<i>sda2</i>         none                    swap  sw,pri=1        0 0
/dev/<i>sdb2</i>         none                    swap  sw,pri=1        0 0
/dev/vg/usr       /usr                    ext3  noatime         1 2
/dev/vg/portage   /usr/portage            ext2  noatime         1 2
/dev/vg/distfiles /usr/portage/distfiles  ext2  noatime         1 2
/dev/vg/home      /home                   ext3  noatime         1 2
/dev/vg/opt       /opt                    ext3  noatime         1 2
/dev/vg/tmp       /tmp                    ext2  noatime         1 2
/dev/vg/var       /var                    ext3  noatime         1 2
/dev/vg/vartmp    /var/tmp                ext2  noatime         1 2
</pre>

<p>
Configure la red en el archivo <path>/etc/conf.d/net</path>. Agregue
el guión de inicio <c>net.eth0</c> al nivel de ejecución default. Si
tiene múltiples interfaces haga enlaces simbólicos al guión de
inicio <c>net.eth0</c> y agréguelos al nivel de ejecución default
también. Modifique el archivo <path>/etc/conf.d/net</path>
con <c>nano</c> o sino, use los siguientes comandos:
</p>

<pre caption="Configure la red">
livecd etc # <i>cd conf.d</i>
livecd conf.d # <i>echo 'config_eth0=( "192.168.1.10/24" )' >> net</i>
livecd conf.d # <i>echo 'routes_eth0=( "default via 192.168.1.1" )' >> net</i>
livecd conf.d # <i>rc-update add net.eth0 default</i>
<comment>(Si compiló el manejador de interfaz de red como un módulo, agréguelo a /etc/modules.autoload.d/kernel-2.6)</comment>
livecd conf.d # <i>echo r8169 >> /etc/modules.autoload.d/kernel-2.6</i>
<comment>(Si desea reconectarse via ssh después de reiniciar la máquina nueva)</comment>
livecd conf.d # <i>rc-update add sshd default</i>
</pre>

<note>
Haga emerge <c>pcmcia-cs</c> y agréguelo al nivel de ejecución default
si lo necesita.
</note>

<p>
Configure la contraseña del superusuario (root) con <c>passwd</c>.
</p>

<pre caption="Configurando la contraseña del superusuario">
livecd conf.d # <i>passwd</i>
New UNIX password: <comment>escriba_la_contraseña</comment>
Retype new UNIX password: <comment>escríbala_otra_vez</comment>
passwd: password updated successfully
</pre>

<p>
Modifique el archivo <path>/etc/conf.d/clock</path> para definir la
zona horaria usada previamente.
</p>

<pre caption="Modifique /etc/conf.d/clock">
livecd conf.d # <i>nano -w /etc/conf.d/clock</i>
TIMEZONE="Europe/Brussels"
</pre>

<p>
Revise la configuración del sistema en <path>/etc/rc.conf</path>,
<path>/etc/conf.d/rc</path>, <path>/etc/conf.d/keymaps</path> y
modifique cualquiera de estos archivos según sea necesario.
</p>

<pre caption="Opcional: modificar archivos de configuración">
livecd conf.d # <i>nano -w /etc/rc.conf</i>
livecd conf.d # <i>nano -w /etc/conf.d/rc</i>
livecd conf.d # <i>nano -w /etc/conf.d/keymaps</i>
livecd conf.d # <i>nano -w /etc/conf.d/clock</i>
</pre>
</body>
</section>

<section>
<title>Instalación de herramientas del sistema</title>
<body>

<p>
Instalar herramientas RAID y LVM2.
</p>

<pre caption="Instalar herramientas RAID y LVM2">
livecd conf.d # <i>emerge mdadm lvm2</i>
</pre>

<p>
Instale un gestor de registro como <c>syslog-ng</c> y un demonio cron
como <c>vixie-cron</c> y agréguelos al nivel de ejecución default.
</p>

<note>
Los demonios cron dependen de un MTA. <c>mail-mta/ssmtp</c> será
instalado como una dependencia. Si desea usar un MTA más avanzado tal
vez quiera hacerlo ahora. Si esta apurando, permita que se instale
ssmtp y desinstálelo luego al instalar el MTA de su preferencia.
</note>

<pre caption="Instale un gestor de registro y un demonio cron">
livecd conf.d # <i>time emerge syslog-ng vixie-cron</i>

real  1m54.099s
user  1m2.630s
sys   0m34.620s
livecd conf.d # <i>rc-update add syslog-ng default</i>
livecd conf.d # <i>rc-update add vixie-cron default</i>
</pre>

<p>
Instale las herramientas necesarias para sistema de archivos
(<c>xfsprogs</c>, <c>reiserfsprogs</c> o <c>jfsutils</c>) y las
herramientas de red (<c>dhcpcd</c> o <c>rp-pppoe</c>) si las requiere.
</p>

<pre caption="Instale herramientas necesarias si las necesita">
livecd conf.d # <i>emerge xfsprogs</i>           <comment>(Si usa el sistema de archivos XFS)</comment>
livecd conf.d # <i>emerge jfsutils</i>           <comment>(Si usa el sistema de archivos JFS)</comment>
livecd conf.d # <i>emerge reiserfsprogs</i>      <comment>(Si usa el sistema de archivos Reiser)</comment>
livecd conf.d # <i>emerge dhcpcd</i>             <comment>(Si necesita un cliente DHCP)</comment>
livecd conf.d # <i>emerge ppp</i>                <comment>(Si necesita conectividad PPPoE para ADSL)</comment>
</pre>
</body>
</section>

<section>
<title>Configurando el Gestor de Arranque</title>
<body>

<p>
Instale <c>grub</c> y configúrelo.
</p>

<pre caption="Haga emerge grub y modifique el archivo de configuración">
livecd conf.d # <i>time emerge grub</i>

real  1m4.634s
user  0m39.460s
sys   0m15.280s
livecd conf.d # <i>nano -w /boot/grub/grub.conf</i>
</pre>

<pre caption="Archivo grub.conf de ejemplo">
default 0
timeout 10

title=Gentoo
root (hd0,0)
kernel /boot/kernel root=/dev/md3
</pre>

<pre caption="Instale grub en ambos discos">
livecd conf.d # <i>grub</i>
Probing devices to guess BIOS drives. This may take a long time.

grub> <i>root (hd0,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd0)</i>
 Checking if "/boot/grub/stage1" exists... yes
 Checking if "/boot/grub/stage2" exists... yes
 Checking if "/boot/grub/e2fs_stage1_5" exists... yes
 Running "embed /boot/grub/e2fs_stage1_5 (hd0)"...  16 sectors are embedded.
succeeded
 Running "install /boot/grub/stage1 (hd0) (hd0)1+16 p (hd0,0)/boot/grub/stage2 /boot/
grub/menu.lst"... succeeded
Done.

grub> <i>root (hd1,0)</i>
 Filesystem type is ext2fs, partition type 0x83

grub> <i>setup (hd1)</i>

grub> <i>quit</i>
</pre>
</body>
</section>

<section>
<title>Reinicie</title>
<body>

<p>
Salga del entorno enjaulado, desmonte todos los sistemas de archivo y reinicie:
</p>

<pre caption="Reinicie">
livecd conf.d # <i>exit</i>
livecd / # <i>umount /mnt/gentoo/usr/portage/distfiles /mnt/gentoo/usr/portage /mnt/gentoo/usr</i>
livecd / # <i>umount /mnt/gentoo/var/tmp /mnt/gentoo/tmp /mnt/gentoo/var /mnt/gentoo/opt</i>
livecd / # <i>umount /mnt/gentoo/proc /mnt/gentoo/home /mnt/gentoo/boot /mnt/gentoo</i>
livecd / # <i>reboot</i>
<comment>(No se olvide de sacar el CD)</comment>
</pre>

<p>
Por favor siga la sección <uri
link="gentoo-x86-quickinstall.xml#after-reboot">Finalizando la
Instalación</uri> de la guía de instalación rápida normal para
concluir su instalación.
</p>
</body>
</section>
</chapter>
</guide>
