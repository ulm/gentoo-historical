<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/openafs.xml,v 1.5 2005/12/29 14:10:27 chiguire Exp $ -->
 
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link = "/doc/es/openafs.xml" lang="es">
<title>GuÃ­a Gentoo Linux OpenAFS</title>
<author title="Editor">
  <mail link="darks@gentoo.org">Holger Brueckner</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="fnjordy@gmail.com">Steven McCoy</mail>
</author>
<author title="Editor">
  <mail link="stefaan@gentoo.org">Stefaan De Roeck</mail>
</author>
<author title="Editor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Editor Es">
  <mail link="bass@gentoo.org">JosÃ© Alberto SuÃ¡rez LÃ³pez</mail>
</author>
<author title="Editor Es">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
 </author>
<author title="Editor Es">
  <mail link="yoswink@gentoo.org">JosÃ© Luis Rivero</mail>
</author>
<author title="Traductor">
  <mail link="rlazo.paz@gmail.com">Rodrigo Lazo</mail>
</author>

<abstract>
Esta guÃ­a muestra cÃ³mo instalar un servidor y clientes de OpenAFS en
gentoo linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.1</version>
<date>2005-11-10</date>

<chapter>
<title>IntroducciÃ³n</title>
<section>
<title>Sobre este documento</title>
<body>

<p>
Este documento te provee con todos los pasos necesarios para instalar
un servidor OpenAFS en Gentoo Linux. Partes de este documento estÃ¡n
tomadas del AFS PUF y la GuÃ­a de inicio rÃ¡pido sobre AFS de
IBM. Bueno, nunca reinventaremos la rueda. :)
</p>
</body>
</section>

<section>
<title>Â¿QuÃ© es AFS?</title>
<body>

<p>
AFS es un sistema de archivos distribuido que permite compartir,
eficientemente, recursos del sistema de archivos a travÃ©s de una
red de Ã¡rea local y una red de Ã¡rea amplia entre mÃ¡quinas
co-operativas (clientes y servidores). Los clientes mantienen un
cachÃ© de los objetos mÃ¡s utilizados (archivos), para tener un
acceso mÃ¡s rÃ¡pido.
</p>

<p>
AFS estÃ¡ basado en el sistema de archivos distribuido
originalmente desarrollado en el Centro de TecnologÃ­a de la
InformaciÃ³n de la Universidad Carnegie-Mellon que fue llamado el
"Sistema de Archivos Andrew". "Andrew" era el nombre del proyecto
de investigaciÃ³n de la CMU - honrando a los fundadores de la
universidad. Una vez que Transarc fue formado y AFS se convirtiÃ³
en un producto, el "Andrew" fue dejado de lado como una forma de
indicar que AFS habÃ­a ido mÃ¡s allÃ¡ del proyecto de investigaciÃ³n
Andrew y se habÃ­a convertido en un producto con soporte, un
sistema de archivos de calidad. Sin embargo, ya habÃ­an numerosas
celdas cuyo sistema de archivos raÃ­z era /afs. Inicialmente,
cambiar este detalle no era una operaciÃ³n sencilla, asÃ­ que, para
evitar que los primero sitios AFS tuviesen que renombrar sus
sistemas de archivos, se mantuvo el nombre AFS.
</p> 
</body>
</section>  
  
<section>
<title>Â¿QuÃ© es una celda AFS?</title>
<body>

<p>
Una celda AFS es una colecciÃ³n de servidores agrupados juntos
administrativamente y que representan un Ãºnico y cohesionado
sistema de archivos. TÃ­picamente, una celda AFS es un conjunto
de mÃ¡quinas que comparten el mismo nombre de dominio de Internet
(como por ejemplo gentoo.org). Los usuarios ingresan al sistema
a travÃ©s de una de las estaciones de trabajo cliente y esta
solicita, a nombre del usuario, la informaciÃ³n y archivos
necesarios de los servidores de la celda. El usuario no sabe en
quÃ© servidor se encuentra el archivo al que estÃ¡ accediendo,
incluso no notarÃ¡ si el servidor estÃ¡ localizado en otra
habitaciÃ³n, dado que cada volumen puede ser replicado y movido a
otro servidor sin que el usuario pueda notarlo. Los archivos son
siempre accesibles. Es como NFS, pero con esteroides :)
</p>
</body>
</section>  

<section>
<title>Â¿CuÃ¡les son los beneficios de usar AFS ?</title>
<body>

<p>
Las principales fortalezas de AFS son:
facilidad en el manejo del cachÃ© (en el lado del cliente,
normalmente de 100M a 1GB), caracterÃ­sticas de seguridad (basado
en Kerberos 4, listas de control de acceso), simplicidad en el
direccionamiento (Ãºnicamente posees un sistema de archivos),
escalabilidad (aÃ±ade servidores a la celda cuando los
necesites), protocolo de comunicaciones.
</p>
</body>
</section>  

<section>
<title>Â¿DÃ³nde puedo encontrar mÃ¡s informaciÃ³n?</title>
<body>

<p>
Lee el <uri
link="http://www.angelfire.com/hi/plutonic/afs-faq.html">AFS
PUF</uri>.
</p>

<p>
La pÃ¡gina principal de OpenAFS <uri
link="http://www.openafs.org">www.openafs.org</uri>.
</p>

<p>
AFS fue originalmente desarrollado por Transarc que es ahora
parte de IBM. Puedes encontrar algo de informaciÃ³n de AFS en la <uri
link="http://www.transarc.ibm.com/Product/EFS/AFS/index.html">PÃ¡gina
web de Transarcs</uri>.
</p>
</body>
</section>  

<section>
<title>Â¿CÃ³mo puedo depurar problemas?</title>
<body>

<p>
OpenAFS tiene grandes capacidades de bitÃ¡cora. Sin embargo, por
defecto lo hace directamente dentro de sus propias bitÃ¡coras en vez de
hacerlo a travÃ©s de los mecanismos que tienes en tu sistema. Para que
tus servidores usen este mecanismo utiliza la opciÃ³n <c>-syslog</c> en
todos los comandos <c>bos</c>.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Actualizando desde versiones anteriores</title>
<section>
<title>IntroducciÃ³n</title>
<body>

<p>
Esta secciÃ³n apunta a ayudarte a travÃ©s del proceso de actualizaciÃ³n
de una instalaciÃ³n existente a OpenAFS versiÃ³n 1.4.0 o superior (o
1.2.x empezando desde 1.2.13. Lo antes mencionado no serÃ¡ manejado
especÃ­ficamente, ya que la mayorÃ­a de las personas querrÃ¡n la versiÃ³n
1.4 para soporte apropiado de linux-2.6, soporte para archivos mÃ¡s
grandes y correcciones de fallos).
</p>

<p>
Si lo que estÃ¡s haciendo es una instalaciÃ³n completamente nueva de la
versiÃ³n 1.4 de OpenAFS, entonces puedes saltarte este capÃ­tulo sin
dudarlo. Sin embargo, si estÃ¡s actualizando de una versiÃ³n anterior,
es muy recomendable que sigas las instrucciones de las siguientes
secciones. El guiÃ³n de transiciÃ³n en el ebuild estÃ¡ diseÃ±ado para
asistirte en una actualizaciÃ³n rÃ¡pida y el reinicio del sistema en
poco tiempo. Por favor, nota que (por razones de seguridad) no borrarÃ¡
los archivos de configuraciÃ³n y guiones de arranque de los lugares
antiguos, tampoco alterarÃ¡ tu configuraciÃ³n de arranque para que
utilice los nuevos guiones, etc. Si necesitas mÃ¡s razones para
convencerte, utilizando un mÃ³dulo OpenAFS del nÃºcleo junto con los
binarios del sistema actualizados, muy probablemente causarÃ¡ que tu
nÃºcleo enloquezca. AsÃ­ que, sigamos leyendo para tener una transiciÃ³n
limpia y tranquila, ok?
</p>

<note>
Este capÃ­tulo ha sido escrito teniendo distintas configuraciones de
sistema en mente. Sin embargo, es posible que debido a ajustes que el
usuario haya realizado, su configuraciÃ³n especÃ­fica no serÃ¡ descrita
aquÃ­. Un usuario con suficiente confianza en sÃ­ mismo como para
modificar sus sistema debe tener suficiente experiencia cÃ³mo para
aplicar los consejos aquÃ­ presentados cuando sea
necesario. Viceversa, un usuario que haya hecho pocas modificaciones
puede saltarse la mayorÃ­a de las advertencias.
</note>

</body>
</section>
<section>
<title>Diferencias con versiones anteriores</title>
<body>

<p>
Tradicionalmente, OpenAFS ha utilizado las mismas convenciones de
rutas que el IBM TransArc labs, antes de que exista la separaciÃ³n. Por
lo cual se entiende que configuraciones antiguas de AFS sigan con
aquellas convenciones de rutas antiguas. Instalaciones mÃ¡s recientes
estÃ¡n mas acorde con el FHS al utilizar ubicaciones estÃ¡ndar (como se
ve en muchas distribuciones de Linux). La siguiente tabla es una
compilaciÃ³n del guiÃ³n de configuraciÃ³n y el LEEME que acompaÃ±a los
comprimidos de la distribuciÃ³n de OpenAFS:
</p>

<table>
<tr>
  <th>Directorio</th>
  <th>PropÃ³sito</th>
  <th>Modo Transarc</th>
  <th>Modo por defecto</th>
  <th>TraducciÃ³n en Gentoo</th>
</tr>
<tr>
  <ti>viceetcdir</ti>
  <ti>ConfiguraciÃ³n del cliente</ti>
  <ti>/usr/vice/etc</ti>
  <ti>$(sysconfdir)/openafs</ti>
  <ti>/etc/openafs</ti>
</tr>
<tr>
  <ti>sin nombre</ti>
  <ti>Binarios del cliente</ti>
  <ti>sin especificar</ti>
  <ti>$(bindir)</ti>
  <ti>/usr/bin</ti>
</tr>
<tr>
  <ti>afsconfdir</ti>
  <ti>ConfiguraciÃ³n del servidor</ti>
  <ti>/usr/afs/etc</ti>
  <ti>$(sysconfdir)/openafs/server</ti>
  <ti>/etc/openafs/server</ti>
</tr>
<tr>
  <ti>afssrvdir</ti>
  <ti>Binarios internos del servidor</ti>
  <ti>/usr/afs/bin (servers)</ti>
  <ti>$(libexecdir)/openafs</ti>
  <ti>/usr/libexec/openafs</ti>
</tr>
<tr>
  <ti>afslocaldir</ti>
  <ti>Estado del servidor</ti>
  <ti>/usr/afs/local</ti>
  <ti>$(localstatedir)/openafs</ti>
  <ti>/var/lib/openafs</ti>
</tr>
<tr>
  <ti>afsdbdir</ti>
  <ti>Auth/serverlist/... bases de datos</ti>
  <ti>/usr/afs/db</ti>
  <ti>$(localstatedir)/openafs/db</ti>
  <ti>/var/lib/openafs/db</ti>
</tr>
<tr>
  <ti>afslogdir</ti>
  <ti>Archivos de bitÃ¡cora</ti>
  <ti>/usr/afs/logs</ti>
  <ti>$(localstatedir)/openafs/logs</ti>
  <ti>/var/lib/openafs/logs</ti>
</tr>
<tr>
  <ti>afsbosconfig</ti>
  <ti>ConfiguraciÃ³n del supervisor</ti>
  <ti>$(afslocaldir)/BosConfig</ti>
  <ti>$(afsconfdir)/BosConfig</ti>
  <ti>/etc/openafs/BosConfig</ti>
</tr>
</table>

<p>
Hay algunas rarezas, como binarios siendo colocados en
<path>/usr/vice/etc</path> en modo Transarc, pero esta lista no
intenta ser exhaustiva. Es mÃ¡s que nada para dar una referencia a
aquellos tratando de resolver problemas con la transiciÃ³n de sus
archivos de configuraciÃ³n.
</p>

<p>
Otro resultado del cambio de rutas es que el cachÃ© de disco ha sido
cambiado de ubicaciÃ³n de <path>/usr/vice/cache</path> a
<path>/var/cache/openafs</path>.
</p>

<p>
AdemÃ¡s, el guiÃ³n de inicio ha sido dividido en una parte cliente y
otra servidor. SolÃ­as tener <path>/etc/init.d/afs</path>, pero ahora
tienes ambos, <path>/etc/init.d/openafs-client</path> y
<path>/etc/init.d/openafs-server</path>. Consecuentemente, el archivo
de configuraciÃ³n <path>/etc/conf.d/afs</path> a sido dividido en
<path>/etc/conf.d/openafs-client</path> y
<path>/etc/conf.d/openafs-server</path>. Junto con esto, las opciones
dentro de <path>/etc/conf.d/afs</path> para definir la mÃ¡quina como
cliente o servidor son obsoletas.
</p>

<p>
Otro cambio al guiÃ³n de inicio es que ya no revisa la configuraciÃ³n
de tu cachÃ© de disco. El antiguo cÃ³digo requiere que una particiÃ³n
ext2 separada sea montada en <path>/usr/vice/cache</path>. HabÃ­an
algunos problemas con ello:
</p>
<ul>
  <li>
    Aunque es una configuraciÃ³n muy lÃ³gica, tu cachÃ© no necesita estar
    en una particiÃ³n separada. Mientras te asegures que existe la
    cantidad de espacio libre que especificas en
    <path>/etc/openafs/cacheinfo</path> para el uso del cachÃ© de
    disco, estÃ¡s a salvo. AsÃ­ que no existe un problema real con que
    tu cachÃ© estÃ© en tu particiÃ³n raÃ­z.
  </li>
  <li>
    Algunas personas utilizan enlaces simbÃ³licos para apuntar a la
    verdadera ubicaciÃ³n del cachÃ© de disco. El guiÃ³n de inicio no se
    llevaba bien con ello, ya que la ubicaciÃ³n del cachÃ© no era
    mostrada en <path>/proc/mounts</path>.
  </li>
  <li>
    En estos dÃ­as, muchos prefieren ext3 sobre ext2. Ambos sistemas de
    archivos son vÃ¡lidos para utilizarlos en el cachÃ© de
    disco. Cualquier otro sistema de archivos no estÃ¡ soportado (como
    por ejemplo: no intentes reiserfs, recibirÃ¡s una enorme
    advertencia, de todas formas espera fallos).
  </li>
</ul>

</body>
</section>
<section>
<title>TransiciÃ³n a las nuevas rutas</title>
<body>

<p>
Antes de nada, emerger una nueva versiÃ³n de OpenAFS no debe
sobreescribir ningÃºn archivo de configuraciÃ³n antiguo. El guiÃ³n estÃ¡
diseÃ±ado para no alterar ningÃºn archivo de configuraciÃ³n ya existente
en el sistema. Incluso si tienes una configuraciÃ³n completamente
entreverada utilizando nuevas y antiguas ubicaciones, el guiÃ³n no debe
causar mayores problemas. TambiÃ©n, si detecta que hay un servidor
OpenAFS ejecutÃ¡ndose, la instalaciÃ³n se detendrÃ¡, previniendo
cualquier posible corrupciÃ³n en la base de datos.
</p>

<p>
Una advertencia sin embargo -- han habido algunos ebuilds flotando a
travÃ©s de la Internet que desactivan parcialmente la protecciÃ³n que
Gentoo pone en <path>/etc</path>. Estos ebuilds nunca han sido
distribuidos por Gentoo. QuizÃ¡s quieras revisar la variable
<c>CONFIG_PROTECT_MASK</c> en la salida del siguiente comando:
</p>

<pre caption="Revisando tu CONFIG_PROTECT_MASK">
# <i>emerge info | grep "CONFIG_PROTECT_MASK"</i>
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/texmf/web2c /etc/env.d"
</pre>

<p>
Aunque nada en este ebuild tocarÃ¡ el archivo <path>/etc/afs</path>, la
actualizaciÃ³n causarÃ¡ que tu antigua instalaciÃ³n de OpenAFS sea
eliminada. Los archivos en <c>CONFIG_PROTECT_MASK</c> que pertenezcan
a la antigua instalaciÃ³n tambiÃ©n serÃ¡n retirados.
</p>

<p>
Debe ser claro para el usuario experimentado que en caso se haya
ajustado el sistema aÃ±adiendo enlaces simbÃ³licos manualmente
(e.g. <path>/usr/afs/etc</path> hacia <path>/etc/openafs</path>), la
nueva instalaciÃ³n posiblemente se llevarÃ¡ bien con los antiguos
archivos de configuraciÃ³n. En este caso, no ha habido una transiciÃ³n
real, asÃ­ que eliminar la antigua instalaciÃ³n resultarÃ¡ en una
configuraciÃ³n de OpenAFS rota.
</p>

<p>
Ahora que sabes que no sucede, quizÃ¡s quieras saber lo que sÃ­ pasa:
</p>

<ul>
  <li>
    <path>/usr/afs/etc</path> es copiado a <path>/etc/openafs/server</path>
  </li>
  <li>
    <path>/usr/vice/etc</path> es copiado a <path>/etc/openafs</path>
  </li>
  <li>
    <path>/usr/afs/local</path> es copiado a <path>/var/lib/openafs</path>
  </li>
  <li>
    <path>/usr/afs/local/BosConfig</path> es copiado a
    <path>/etc/openafs/BosConfig</path>, mientras se reemplazan las
    ocurrencias de <path>/usr/afs/bin/</path> con
    <path>/usr/libexec/openafs</path>, <path>/usr/afs/etc</path> con
    <path>/etc/openafs/server</path> y <path>/usr/afs/bin</path>
    (sin el / como previamente) con <path>/usr/bin</path>
  </li>
  <li>
    <path>/usr/afs/db</path> es copiado a <path>/var/lib/openafs/db</path>
  </li>
  <li>
    El archivo de configuraciÃ³n <path>/etc/conf.d/afs</path> es
    copiado a <path>/etc/conf.d/openafs-client</path>, ya que todas
    las opciones antiguas estaban destinadas para uso sÃ³lo del
    cliente.
  </li>
</ul>

</body>
</section>
<section>
<title>La actualizaciÃ³n en sÃ­</title>
<body>

<p>
AsÃ­ que no tienes un servidor OpenAFS? O quizÃ¡s sÃ­, y las secciones
anteriores te han informado de que va a suceder, y aÃºn quieres seguir?
</p>

<p>
Â¡Entonces vamos a hacerlo!
</p>

<p>
Si tienes un servidor levantado, querrÃ¡s detenerlo ahora.
</p>

<pre caption="Deteniendo OpenAFS (en caso que tengas un servidor)">
# <i>/etc/init.d/afs stop</i>
</pre>

<p>
Ahora, a actualizar.
</p>

<pre caption="Â¡Actualiza!">
# <i>emerge -u openafs</i>
</pre>

</body>
</section>
<section>
<title>Reiniciando OpenAFS</title>
<body>

<p>
Si no tienes un servidor OpenAFS levantado, no deberÃ­as haber sido
obligado a detener el cliente. Ahora es tiempo para que lo hagas.
</p>

<pre caption="Deteniendo el cliente OpenAFS luego de la actualizaciÃ³n">
# <i>/etc/init.d/afs stop</i>
</pre>

<p>
De seguro querrÃ¡s mantener bajo el tiempo que pase tu servidor
detenido, asÃ­ que ahora puedes reactivar tu servidor OpenAFS.
</p>

<pre caption="Reiniciando el servidor OpenAFS luego de la actualizaciÃ³n">
# <i>/etc/init.d/openafs-server start</i>
</pre>

<p>
Puedes revisar si estÃ¡ corriendo de manera adecuada con el siguiente
comando:
</p>

<pre caption="Revisando el estado del servidor OpenAFS">
# <i>/usr/bin/bos status localhost -localauth</i>
</pre>

<p>
Antes de que reinicies el cliente OpenAFS, por favor toma algÃºn tiempo
en revisar la configuraciÃ³n de tu cachÃ©. Estas son determinadas en
<path>/etc/openafs/cacheinfo</path>.  Para reiniciar tu cliente
OpenAFS, ejecuta el siguiente comando:
</p>

<pre caption="Reiniciando el cliente OpenAFS luego de la actualizaciÃ³n">
# <i>/etc/init.d/openafs-client start</i>
</pre>

</body>
</section>
<section>
<title>Haciendo la limpieza</title>
<body>

<p>
Antes de eliminar lo anterior, por favor asegÃºrate bien que todo estÃ©
corriendo de manera adecuada y que efectivamente has reiniciado todo
luego de la actualizaciÃ³n (de otra forma, puede que aÃºn estÃ©s
ejecutando tu antigua instalaciÃ³n).
</p>

<impo>
Â¡Â¡Por favor asegÃºrate que no estÃ¡s utilizando
<path>/usr/vice/cache</path> para el cachÃ© de disco si vas a eliminar
el directorio <path>/usr/vice</path>!!
</impo>

<p>
Los siguientes directorios pueden ser eliminados del sistema de manera
segura:
</p>

<ul>
  <li><path>/etc/afs</path></li>
  <li><path>/usr/vice</path></li>
  <li><path>/usr/afs</path></li>
  <li><path>/usr/afsws</path></li>
</ul>

<p>
Los siguientes archivos tambiÃ©n son innecesarios:
</p>

<ul>
  <li><path>/etc/init.d/afs</path></li>
  <li><path>/etc/conf.d/afs</path></li>
</ul>

<pre caption="Eliminando los archivos antiguos">
# <i>tar czf /root/oldafs-backup.tgz /etc/afs /usr/vice /usr/afs /usr/afsws</i>
# <i>rm -R /etc/afs /usr/vice /usr/afs /usr/afsws</i>
# <i>rm /etc/init.d/afs /etc/conf.d/afs</i>
</pre>

<p>
En caso que hayas utilizado previamente los ebuilds =openafs-1.2.13 o
=openafs-1.3.85, es probable que tambiÃ©n tengas algunos archivos innecesarios mÃ¡s:
</p>

<ul>
  <li><path>/etc/init.d/afs-client</path></li>
  <li><path>/etc/init.d/afs-server</path></li>
  <li><path>/etc/conf.d/afs-client</path></li>
  <li><path>/etc/conf.d/afs-server</path></li>
</ul>

</body>
</section>
<section>
<title>Cambios en los guiones de inicio</title>
<body>

<p>
La mayorÃ­a de la gente posiblemente tenga configurado sus sistema para
que inicie el cliente y el servidor OpenAFS automÃ¡ticamente. Aquellos
que no, pueden saltarse esta secciÃ³n con seguridad. Si tienes un
sistema que los arranca automÃ¡ticamente, debes reactivar esta
caracterÃ­stica ya que los nombres de lo guiones de inicio han cambiado.
</p>

<pre caption="Reactivando el inicio de OpenAFS al arrancar el sistema">
# <i>rc-update del afs default</i>
# <i>rc-update add openafs-client default</i>
# <i>rc-update add openafs-server default</i>
</pre>

<p>
Si tienes <c>=openafs-1.2.13</c> o <c>=openafs-1.3.85</c>, debes
eliminar <path>afs-client</path> y <path>afs-server</path> del nivel
de ejecuciÃ³n por defecto, en vez de <path>afs</path>.
</p>

</body>
</section>
<section>
<title>Solucionando problemas: que hacer si falla la actualizaciÃ³n
automÃ¡tica</title>
<body>
<!--TRADUCIR!!! -->
<p>
No entres en pÃ¡nico. No deberÃ­as haber perdido ninguna informaciÃ³n ni
tampoco archivos de configuraciÃ³n. AsÃ­ que analicemos la situaciÃ³n. Por
favor envÃ­a informaciÃ³n sobre la falla a <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri> en cualquier caso,
con la mayor cantidad de informaciÃ³n posible.
</p>

<p>
Si tienes problemas iniciando el cliente, esto debe ayudarte a
diagnosticar el problema.
</p>

<ul>
  <li>
    Ejecuta <c>dmesg</c>. El cliente normalmente envÃ­a mensajes de error ahÃ­.
  </li>
  <li>
    Revisa <path>/etc/openafs/cacheinfo</path>. DeberÃ­a estar con el
    siguiente formato: /afs:{ruta al cachÃ© de disco}:{nÃºmero de
    bloques para el cachÃ© de disco}.  Normalmente, tu cachÃ© de disco
    estarÃ¡ localizado en <path>/var/cache/openafs</path>.
  </li>
  <li>
    Revisa la salida de <c>lsmod</c>. Debes revisar las lineas que
    empiecen con la palabra openafs.
  </li>
  <li><c>pgrep afsd</c> te dirÃ¡ si afsd se estÃ¡ ejecutando o no.</li>
  <li>
    <c>cat /proc/mounts</c> debe revelar si <path>/afs</path> fue
    montado.
  </li>
</ul>

<p>
Si tienes problemas iniciando el servidor, entonces estos consejos
deben ser Ãºtiles:
</p>

<ul>
  <li>
    <c>pgrep bosserver</c> te dirÃ¡ si el supervisor se estÃ¡ ejecutando
    o no. Si tienes mÃ¡s de uno corriendo, entonces algo ha salido
    mal. En ese caso, deberÃ­as intentar apagar el servidor OpenAFS
    elegantemente con <c>bos shutdown localhost -localauth -wait</c>,
    revisa el resultado con <c>bos status localhost -localauth</c>,
    elimina los procesos supervisores restantes que sigan ejecutÃ¡ndose
    (<c>ls /usr/libexec/openafs</c> para obtener una lista de ellos).
    Luego de ello, haz un <c>/etc/init.d/openafs-server zap</c> para
    reiniciar el estado del servidor y <c>/etc/init.d/openafs-server
    start</c> para intentar iniciarlo de nuevo.
  </li>
  <li>
    Si estÃ¡s utilizando el sistema de bitÃ¡coras propio de OpenAFS (que
    es cÃ³mo se configura por defecto), revisa
    <path>/var/lib/openafs/logs/*</path>.  Si estÃ¡s utilizando syslog,
    revisa sus propias bitÃ¡coras en bÃºsqueda de cualquier informaciÃ³n
    Ãºtil.
  </li>
</ul>

</body>
</section>
</chapter>


<chapter>
<title>DocumentaciÃ³n</title>
<section>
<title>Obteniendo la documentaciÃ³n sobre AFS</title>
<body>

<p>
Puedes obtener la documentaciÃ³n original AFS de IBM. EstÃ¡ muy
bien escrita y si vas a administrador un servidor AFS es lectura
muy recomendada.
</p>

<pre caption="Instalando afsdoc">
# <i>emerge app-doc/afsdoc</i>
</pre>
</body>   
</section>
</chapter>

<chapter>
<title>InstalaciÃ³n del cliente</title>
<section>
<title>Trabajo preliminar</title>
<body>

<note>
Â¡Todos los comandos deben ser escritos en una sola linea!
En este documento estÃ¡n, algunas veces, divididos en dos
lÃ­neas para hacerlos mÃ¡s fÃ¡ciles de leer.
</note>

<note>
Desafortunadamente el cliente AFS necesita una particiÃ³n ext2
para que su cache funcione de manera correcta, ya que existen
algunos problemas de bloque con resiserfs.  Necesitas crear
una particiÃ³n ext2 de aproximadamente 200MB (mÃ¡s no le hace
daÃ±o a nadie) y montarla en <path>/usr/vice/cache</path>.
</note>

<p>
DeberÃ¡s ajustar los dos archivos llamados CellServDB y
ThisCell antes de crear tu cliente afs. (Estos archivos estÃ¡n
en el directorio <path>/usr/portage/net-fs/openafs/files</path>)
</p>

<pre caption="Ajustando CellServDB y ThisCell">
CellServDB:
>netlabs        #Nombre de la celda
10.0.0.1        #almacenamiento

ThisCell:
netlabs       
</pre>

<warn>
Utiliza solamente espacios dentro del archivo
<path>CellServDB</path>. El cliente muy probablemente fallarÃ¡ si
utilizas TABs.
</warn>
 
<p>
CellServDB le indica a tu cliente quÃ© servidor(es) necesita
contactar en una celda especÃ­fica. ThisCell debe ser bastante
obvio. Normalmente utilizas un nombre que es Ãºnico en tu
organizaciÃ³n. Tu dominio (oficial) debe ser una buena opciÃ³n.
</p>
</body>
</section>

<section>
<title>Creando al cliente</title>
<body>

<pre caption="Instalando openafs">
# <i>emerge net-fs/openafs</i>
</pre>

<p>
Luego de una compilaciÃ³n exitosa debes estar listo para seguir.
</p>
</body>
</section>

<section>
<title>Iniciando AFS en el arranque</title>
<body>

<p>
El siguiente comando crearÃ¡ los apropiados enlaces para que
se inicie el cliente afs en el arranque del sistema.
</p>

<warn>
Siempre debes tener activo el servidor AFS cuando trates de
iniciar un cliente afs. Tu sistema no arrancarÃ¡ hasta que
llegue a un lÃ­mite de tiempo si el servidor estÃ¡ fuera de
lÃ­nea. (y esto es un tiempo muy, muy largo).
</warn>

<pre caption="Agregando AFS al nivel de ejecuciÃ³n default">
# <i>rc-update add afs default</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>InstalaciÃ³n del servidor</title>
<section>
<title>Construyendo el servidor</title>
<body>

<p>
El siguiente comando instalarÃ¡ todos los binarios necesarios
para crear un servidor AFS <e>y</e> un cliente.
</p>

<pre caption="Instalando openafs">
# <i>emerge net-fs/openafs</i>
</pre>
</body>
</section>

<section>
<title>Iniciando el servidor AFS</title>    
<body>
<p>
Necesitas remover los archivos de ejemplo CellServDB y
ThisCell previamente.
</p>

<pre caption="Borrando archivos de ejemplos">
# <i>rm /usr/vice/etc/ThisCell</i>
# <i>rm /usr/vice/etc/CellServDB</i>
</pre>

<p>
Ahora ejecutaremos el comando <c>bosserver</c> para
inicializar el Servidor Basic OverSeer (BOS), que monitorea y
controla otros procesos del servidor AFS. TÃ³malo como si fuera
el init del sistema. Incluye la bandera <c>-noauth</c> para
desactivar la comprobaciÃ³n de autorizaciÃ³n, ya que no has
aÃ±adido al usuario administrador todavÃ­a.
</p>

<warn>
Deshabilitar la comprobaciÃ³n de autenticaciÃ³n compromete
gravemente la seguridad de la celda. Debes completar todos los
siguientes pasos subsecuentemente de manera ininterrumpida y no
debes dejar desatendida la mÃ¡quina en ningÃºn momento hasta que
reinicies el servidor BOS con la comprobaciÃ³n de autorizaciÃ³n
habilitada. Bueno, eso es lo que la documentaciÃ³n sobre AFS dice
:).
</warn>

<pre caption="Inicializando el servidor Basico OverSeer (supervisor bÃ¡sico)">
# <i>/usr/afs/bin/bosserver -noauth &amp;</i>
</pre>

<p>
Verifica que el Servidor BOS
creÃ³ <path>/usr/vice/etc/CellServDB</path>
y <path>/usr/vice/etc/ThisCell</path>
</p>

<pre caption="Revise si CellServDB y ThisCell han sido creados">
# <i>ls -al /usr/vice/etc/</i>
-rw-r--r--    1 root     root           41 Jun  4 22:21 CellServDB
-rw-r--r--    1 root     root            7 Jun  4 22:21 ThisCell
</pre>
</body>    
</section>

<section>
<title>Definiendo nombre de celda y membrecÃ­a para los procesos del servidor</title>
<body>

<p>
Ahora asÃ­gnale un nombre a tu celda.
</p>

<impo>
Hay algunas restricciones en el formato del nombre. Dos de las
mÃ¡s importantes son que el nombre no puede incluir mayÃºsculas
y tiene que ser menor a 64 caracteres. Recuerda que el nombre
de tu celda estarÃ¡ bajo <path>/afs</path>, asÃ­ que quizÃ¡s
desees escoger un nombre corto.
</impo>

<note>
En la siguiente y en las demÃ¡s instrucciones de esta guÃ­a,
sustituye el argumento &lt;server name&gt; por el nombre
calificado completo (como por ejemplo<b> afs.gentoo.org</b>)
de la mÃ¡quina en la que estÃ¡s instalando. Por el argumento
&lt;cell name&gt; pon el nombre completo de tu celda
(como <b>gentoo</b>).
</note>

<p>
Ejecuta el comando <c>bos setcellname</c> para definir el nombre de la celda:
</p>

<pre caption="Asignando el nombre de la celda">
# <i>/usr/afs/bin/bos setcellname &lt;server name&gt; &lt;cell name&gt; -noauth</i>
</pre>
</body>
</section>

<section>
<title>Iniciando el proceso de servidor de base de datos</title>
<body>

<p>
Ahora, utiliza el comando <c>bos create</c> para crear
las entradas para los cuatro procesos servidores de base de
datos en el archivo <path>/usr/afs/local/BosConfig</path>. Los
cuatro procesos corren Ãºnicamente en las mÃ¡quinas servidoras
de base de datos.
</p>

<table>
<tr>
   <ti>kaserver</ti>
   <ti>El servidor de autenticaciÃ³n mantiene la base de datos de
   autenticaciÃ³n. Este puede ser reemplazado por un demonio kerberos
   5. Si alguien quiere intentarlo siÃ©ntase libre de agregarlo a este
   documento :)</ti> 
</tr>
<tr>
   <ti>buserver</ti>
   <ti>El servidor de respaldo mantiene la base de datos de respaldo</ti>
</tr>
<tr>
   <ti>ptserver</ti>
   <ti>El servidor de protecciÃ³n mantiene la base de datos de protecciÃ³n</ti>
</tr>
<tr>
   <ti>vlserver</ti>
   <ti>El servidor de localizaciÃ³n de volumen mantiene la base de
   datos de localizaciÃ³n de volumen(VLDB). Muy importante por cierto.</ti>
</tr>
</table>    

<pre caption="Creando los registros para los procesos de bases de datos">
# <i>/usr/afs/bin/bos create &lt;server name&gt; kaserver simple 
    /usr/afs/bin/kaserver -cell &lt;cell name&gt; -noauth</i>
# <i>/usr/afs/bin/bos create &lt;server name&gt; buserver simple 
    /usr/afs/bin/buserver -cell &lt;cell name&gt; -noauth</i>
# <i>/usr/afs/bin/bos create &lt;server name&gt; ptserver simple 
    /usr/afs/bin/ptserver -cell &lt;cell name&gt; -noauth</i>
# <i>/usr/afs/bin/bos create &lt;server name&gt; vlserver simple 
    /usr/afs/bin/vlserver -cell &lt;cell name&gt; -noauth</i>
</pre>

<p>
Puedes comprobar que todos los servidores estÃ¡n funcionando
con el comando <c>bos status</c>:
</p>

<pre caption="Revisar que estÃ©n corriendo todos los servidores">
# <i>/usr/afs/bin/bos status &lt;server name&gt; -noauth</i>
Instance kaserver, currently running normally.
Instance buserver, currently running normally.
Instance ptserver, currently running normally.
Instance vlserver, currently running normally.
</pre>
</body>
</section>

<section>
<title>Inicializando la seguridad de la celda</title>
<body>

<p>
Es hora de inicializar los mecanismos de seguridad de la
celda. Empezaremos creando las dos siguientes entradas
iniciales en la base de datos de autenticaciÃ³n: La cuenta
administrativa principal, llamada <b>admin</b> por convenciÃ³n
y una entrada para el proceso del servidor AFS,
llamado <c>afs</c>. NingÃºn usuario pude ingresar al sistema
bajo la identidad de <b>afs</b>, pero el mÃ³dulo del Servicio
de Entrega de Tickets (TGS) del Servidor de AutenticaciÃ³n
utiliza esta cuenta para encriptar todos los tickets que
entrega a clientes AFS. Esto suena muy parecido a Kerberos :)
</p>

<p>
Entrando al modo interactivo de <c>kas</c>
</p>

<pre caption="Entrando al modo interactivo">
# <i>/usr/afs/bin/kas -cell &lt;cell name&gt; -noauth</i>
ka&gt; <i>create afs</i>
initial_password:
Verifying, please re-enter initial_password:
ka&gt; <i>create admin</i>
initial_password:
Verifying, please re-enter initial_password:
ka&gt; <i>examine afs</i>

User data for afs
  key (0) cksum is 2651715259, last cpw: Mon Jun  4 20:49:30 2001
  password will never expire.
  An unlimited number of unsuccessful authentications is permitted.
  entry never expires.  Max ticket lifetime 100.00 hours.
  last mod on Mon Jun  4 20:49:30 2001 by $lt;none&gt;
  permit password reuse
ka&gt; <i>setfields admin -flags admin</i>
ka&gt; <i>examine admin</i>
 
User data for admin (ADMIN)
  key (0) cksum is 2651715259, last cpw: Mon Jun  4 20:49:59 2001
  password will never expire.
  An unlimited number of unsuccessful authentications is permitted.
  entry never expires.  Max ticket lifetime 25.00 hours.
  last mod on Mon Jun  4 20:51:10 2001 by $lt;none&gt;
  permit password reuse
ka&gt;
</pre>

<p>
Ejecuta el comando <c>bos adduser</c>, para aÃ±adir el
usuario <b>admin</b> a <path>/usr/afs/etc/UserList</path>.
</p>

<pre caption="Agregue al usuario admin al UserList">
# <i>/usr/afs/bin/bos adduser &lt;server name&gt; admin -cell &lt;cell name&gt; -noauth</i>
</pre>

<p>
Utiliza el comando <c>bos addkey</c> para definir la llave de
encriptaciÃ³n del servidor AFS
en <path>/usr/afs/etc/KeyFile</path>
</p>

<note>
Si se te pregunta por una llave de entrada, usa la contraseÃ±a
que ingresaste al crear la entrada afs con <b>kas</b>
</note>

<pre caption="Ingresando la contraseÃ±a">
# <i>/usr/afs/bin/bos addkey  &lt;server name&gt; -kvno 0 -cell &lt;cell name&gt; -noauth</i>
    input key:
    Retype input key:
</pre>

<p>
Con el comando <c>pts createuser</c> crea una entrada para el
usuario admin en la Base de Datos de ProtecciÃ³n
</p>

<note>
Por defecto el servidor de protecciÃ³n asigna AFS UID 1 al
usuario <b>admin</b>, porque es el primer usuario cuya entrada
se crea. Si el archivo de contraseÃ±as local (<path>/etc/passwd</path> o
equivalente) ya tiene una entrada para <b>admin</b> que le
asigna un UID distinto, utiliza el argumento <c>-id</c> para
crear UID que sean iguales.
</note>

<pre caption="CreaciÃ³n del registro en la base de datos de protecciÃ³n
para el usuario">
# <i>/usr/afs/bin/pts createuser -name admin -cell &lt;cell name&gt; [-id &lt;AFS UID&gt;] -noauth</i>
</pre>

<p>
Ejecuta el comando <c>pts adduser</c> para hacer al
usuario <b>admin</b> miembro del grupo system:administrators, y
el comando <c>pts membership</c> para verificar la membresÃ­a.
</p>

<pre caption="Hacer a admin miembro del grupo de administradores y verificaciÃ³n">
# <i>/usr/afs/bin/pts adduser admin system:administrators -cell &lt;cell name&gt; -noauth</i>
# <i>/usr/afs/bin/pts membership admin -cell &lt;cell name&gt; -noauth</i>
      Groups admin (id: 1) is a member of:
        system:administrators
</pre>

<p>
Reinicie todos los procesos del servidor AFS
</p>

<pre caption="Reinicie todos los procesos de servidor AFS">
# <i>/usr/afs/bin/bos restart &lt;server name&gt; -all -cell &lt;cell name&gt; -noauth</i>
</pre>
</body>
</section>

<section>
<title>Iniciando el Servidor de Archivos, el Servidor de Volumen y Salvager</title>
<body>

<p>
Inicia el proceso <c>fs</c>, que consiste en el Servidor de
Archivos, el Servidor de Volumen y Salvager (procesos
fileserver, volserver y salvager).
</p>

<pre caption="Inicie el proceso fs">
# <i>/usr/afs/bin/bos create &lt;server name&gt; fs fs /usr/afs/bin/fileserver
 /usr/afs/bin/volserver /usr/afs/bin/salvager -cell &lt;cell name&gt; -noauth</i>
</pre>

<p>
Es hora de verificar que todos los procesos estÃ©n en ejecuciÃ³n.
</p>

<pre caption="Verifique que todos los procesos estÃ©n corriendo">
 # <i>/usr/afs/bin/bos status &lt;server name&gt; -long -noauth</i>
 Instance kaserver, (type is simple) currently running normally.
     Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
     Last exit at Mon Jun  4 21:07:17 2001
     Command 1 is '/usr/afs/bin/kaserver'

 Instance buserver, (type is simple) currently running normally.
     Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
     Last exit at Mon Jun  4 21:07:17 2001
     Command 1 is '/usr/afs/bin/buserver'

 Instance ptserver, (type is simple) currently running normally.
     Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
     Last exit at Mon Jun  4 21:07:17 2001
     Command 1 is '/usr/afs/bin/ptserver'

 Instance vlserver, (type is simple) currently running normally.
     Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
     Last exit at Mon Jun  4 21:07:17 2001
     Command 1 is '/usr/afs/bin/vlserver'

 Instance fs, (type is fs) currently running normally.
     Auxiliary status is: file server running.
     Process last started at Mon Jun  4 21:09:30 2001 (2 proc starts)
     Command 1 is '/usr/afs/bin/fileserver'
     Command 2 is '/usr/afs/bin/volserver'
     Command 3 is '/usr/afs/bin/salvager'
</pre>

<p>
Lo que tienes que hacer ahora depende en si alguna vez has
ejecutado en la celda un servidor de archivos AFS.
</p>

<p>
En caso que estÃ©s instalando el primer servidor AFS de la celda,
crea el primer volumen AFS <b>root.afs</b>
</p>

<note>
En el argumento del nombre de la particiÃ³n, sustituye el nombre
de una de las particiones de la mÃ¡quina Servidor AFS. Por
convenciÃ³n estas particiones son llamadas <path>/vicepx</path>,
donde x estÃ¡ en el rango a-z.
</note>

<pre caption="CreaciÃ³n del volumen root.afs">
# <i>/usr/afs/bin/vos create &lt;server name&gt; &lt;partition name&gt; root.afs -cell &lt;cell name&gt; -noauth</i>
</pre>

<p>
Si hay mÃ¡quinas servidoras de archivos AFS y volÃºmenes ya
creados en la celda, utiliza los comandos <c>vos sncvldb</c>
y <c>vos syncserv</c> para sincronizar el VLDB (Base de Datos de
LocalizaciÃ³n de Volumen) con el estado actual de la localizaciÃ³n
de los volÃºmenes. Esto copiarÃ¡ toda la informaciÃ³n necesaria a
tu nuevo servidor.
</p>

<p>
Si el comando falla con el mensaje "partition /vicepa does not
exist on the server", asegÃºrate que la particiÃ³n estÃ¡ montada
antes de levantar los servidores OpenAFS, o monta el directorio
y reinicia los procesos utilizando<c>/usr/afs/bin/bos restart
&lt;server name&gt; -all -cell &lt;cell name&gt; -noauth</c>.
</p>

<pre caption="Sincronice el VLDB">
# <i>/usr/afs/bin/vos syncvldb &lt;server name&gt; -cell &lt;cell name&gt; -verbose -noauth</i>
# <i>/usr/afs/bin/vos syncserv &lt;server name&gt; -cell &lt;cell name&gt; -verbose -noauth</i> 
</pre>
</body>
</section>

<section>
<title>Iniciando la parte servidor del servidor de actualizaciones</title>
<body>

<pre caption="Inicie el servidor de actualizaciÃ³n">
# <i>/usr/afs/bin/bos create &lt;server name&gt; upserver simple "/usr/afs/bin/upserver -crypt /usr/afs/etc -clear /usr/afs/bin" -cell &lt;cell name&gt; -noauth</i>
</pre>
</body>
</section>

<section>
<title>Configurando el Nivel Superior del espacio de archivos AFS</title>
<body>

<p>
Primero necesitas definir algunos ACLs, de manera que
cualquier usuario pueda ve <path>/afs</path>.
</p>

<pre caption="Configure las listas de control de acceso">
# <i>/usr/afs/bin/fs setacl /afs system:anyuser rl</i>
</pre>

<p>
Ahora necesitas crear el volumen raÃ­z, montarlo como de sÃ³lo
lectura en <path>/afs/&lt;cell name&gt;</path> y
lectura-escritura en <path>/afs/.&lt;cell name&gt;</path>.
</p>

<pre caption="Prepare el volumen raÃ­z">
# <i>/usr/afs/bin/vos create &lt;server name&gt;&lt;partition name&gt; root.cell</i>
# <i>/usr/afs/bin/fs mkmount /afs/&lt;cell name&gt; root.cell </i>
# <i>/usr/afs/bin/fs setacl /afs/&lt;cell name&gt; system:anyuser rl</i>
# <i>/usr/afs/bin/fs mkmount /afs/.&lt;cell name&gt; root.cell -rw</i>
</pre>

<p>
Finalmente, Â¡terminaste!. Ahora debes tener un servidor de
archivos AFS funcionando en tu red local. Â¡Â¡Es hora de tomar una
gran taza de cafÃ© e imprimir la documentaciÃ³n sobre AFS!!
</p>

<note>
Es muy importante para el correcto funcionamiento de servidor
AFS que todos los relojes de todos los sistemas estÃ©n
sincronizados. Esto lo puedes conseguir instalando un servidor
ntp en una mÃ¡quina (por ejemplo el servidor AFS) y sincronizar
los relojes como clientes ntp. Esto tambiÃ©n puede ser echo por
el cliente AFS.
</note>
</body>
</section>
</chapter>

<chapter>
<title>AdministraciÃ³n bÃ¡sica</title>
<section>
<title>Renuncia de responsabilidad</title>
<body>

<p>
OpenAFS es una tecnologÃ­a extensa. Por favor lee la documentaciÃ³n de
AFS para mayor informaciÃ³n. Nosotros sÃ³lo listamos una pequeÃ±a lista
de tareas administrativas en este capÃ­tulo.
</p>
</body>
</section>

<section>
<title>Configurando PAM para obtener una ficha AFS al ingresar</title>
<body>

<p>
Para poder utilizar AFS necesitas autenticarte con el servidor KA si
utilizas una implementaciÃ³n AFS Kerberos 4, o con un servidor Kerberos
5 KDC si utilizas MIT, Heimdal o ShiShi Kerberos 5. Sin embargo, para
poder ingresar a una mÃ¡quina tambiÃ©n necesitaras una cuenta de
usuario, que puede ser local mediante <path>/etc/passwd</path>, NIS, LDAP
(OpenLDAP), o una base de datos Hesiod. PAM permite a Gentoo atar la
autenticaciÃ³n de ingreso al sistema y de AFS a la cuenta del usuario.
</p>

<p>
NecesitarÃ¡s actualizar <path>/etc/pam.d/system-auth</path> que es
utilizado por las demÃ¡s configuraciones. "use_first_pass" indica que
primero se revisarÃ¡ el ingreso al sistema, e "ignore_root" evita que
el usuario root sea autenticado de manera que pueda ingresar al
sistema si el AFS o la red falla.
</p>

<pre caption="/etc/pam.d/system-auth">
auth       required     pam_env.so
auth       sufficient   pam_unix.so likeauth nullok
auth       sufficient   pam_afs.so.1 use_first_pass ignore_root
auth       required     pam_deny.so

account    required     pam_unix.so

password   required     pam_cracklib.so retry=3
password   sufficient   pam_unix.so nullok md5 shadow use_authtok
password   required     pam_deny.so

session    required     pam_limits.so
session    required     pam_unix.so
</pre>

<p>
Para hacer que <c>sudo</c> mantenga la ficha del usuario real y prevenir a los
usuarios locales ganar acceso AFS cambia /etc/pam.d/su de la siguiente
manera:
</p>

<pre caption="/etc/pam.d/su">
<comment># AquÃ­ usuarios con uid &gt; 100 se consideran miembros del AFS y usuarios con 
# uid &lt;= 100 son ignorados por pam_afs.</comment>
auth       sufficient   /usr/afsws/lib/pam_afs.so.1 ignore_uid 100

auth       sufficient   /lib/security/pam_rootok.so

<comment># Si quieres restringir mÃ¡s a los usuarios de utilizar el comando su, crea el archivo,
# /etc/security/suauth.allow que es solo con permisos de escritura por el superusuario
# y aÃ±ade a los usuarios que se les permite hacer "su" a ese archivo, uno por lÃ­nea
#auth       required     /lib/security/pam_listfile.so item=ruser \
#       sense=allow onerr=fail file=/etc/security/suauth.allow

# Descomenta esta linea para permitir que los usuarios del grupo 
# wheel puedan hacer "su" sin utilizar passwd.
#auth       sufficient   /lib/security/pam_wheel.so use_uid trust

# Alternativamente a lo anterior, puedes implementar una lista de usuarios 
# que no necesitan dar una contraseÃ±a con una lista.
#auth       sufficient   /lib/security/pam_listfile.so item=ruser \
#       sense=allow onerr=fail file=/etc/security/suauth.nopass

# Comenta las siguiente lineas para permitir a cualquier usuario, incluso a
# aquellos fuera del grupo 'wheel', poder hacer "su"</comment>
auth       required     /lib/security/pam_wheel.so use_uid

auth       required     /lib/security/pam_stack.so service=system-auth

account    required     /lib/security/pam_stack.so service=system-auth

password   required     /lib/security/pam_stack.so service=system-auth

session    required     /lib/security/pam_stack.so service=system-auth
session    optional     /lib/security/pam_xauth.so

<comment># AquÃ­ prevenimos que la ficha del id real del usuario sea dejada atrÃ¡s</comment>
session    optional     /usr/afsws/lib/pam_afs.so.1 no_unlog
</pre>
</body>
</section>
</chapter>
</guide>
