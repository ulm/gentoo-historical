<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/openafs.xml,v 1.11 2013/08/29 16:36:15 nimiux Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide disclaimer="obsolete" redirect="https://wiki.gentoo.org/wiki/OpenAFS" lang="es">
<title>Guía Gentoo Linux OpenAFS</title>

<author title="Editor">
  <mail link="stefaan@gentoo.org">Stefaan De Roeck</mail>
</author>
<author title="Editor">
  <mail link="darks@gentoo.org">Holger Brueckner</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="fnjordy@gmail.com">Steven McCoy</mail>
</author>
<author title="Editor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Traductor">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
 </author>
<author title="Traductor">
  <mail link="rlazo.paz@gmail.com">Rodrigo Lazo</mail>
</author>

<abstract>
Esta guía muestra cómo instalar un servidor y clientes OpenAFS en
Gentoo Linux.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2</version>
<date>2011-12-13</date>

<chapter>
<title>Introducción</title>
<section>
<title>Sobre este documento</title>
<body>

<p>
Este documento provee todos los pasos necesarios para instalar un
servidor OpenAFS en Gentoo Linux. Partes de este documento están
tomadas del AFS PUF y la Guía de inicio rápido sobre AFS de
IBM. Bueno, nunca reinventaremos la rueda. :)
</p>

</body>
</section>

<section>
<title>¿Qué es AFS?</title>
<body>

<p>
AFS es un sistema de archivos distribuido que permite compartir,
eficientemente, recursos del sistema de archivos a través de una
red de área local y una red de área amplia entre máquinas
co-operativas (clientes y servidores). Los clientes mantienen un
caché de los objetos más utilizados (archivos), para tener un
acceso más rápido.
</p>

<p>
AFS está basado en el sistema de archivos distribuido
originalmente desarrollado en el Centro de Tecnología de la
Información de la Universidad Carnegie-Mellon que fue llamado el
"Sistema de Archivos Andrew". "Andrew" era el nombre del proyecto
de investigación de la CMU - honrando a los fundadores de la
universidad. Una vez que Transarc fue formada y AFS se convirtió
en un producto, el "Andrew" fue dejado de lado como una forma de
indicar que AFS había ido más allá del proyecto de investigación
Andrew y se había convertido en un producto con soporte, un
sistema de archivos de calidad. Sin embargo, ya habían numerosas
celdas cuyo sistema de archivos raíz era /afs. Inicialmente,
cambiar este detalle no era una operación sencilla, así que, para
evitar que los primero sitios AFS tuviesen que renombrar sus
sistemas de archivos, se mantuvo el nombre AFS.
</p> 

</body>
</section>  
  
<section>
<title>¿Qué es una celda AFS?</title>
<body>

<p>
Una celda AFS es una colección de servidores agrupados juntos
administrativamente y que representan un único y cohesionado sistema
de archivos. Típicamente, una celda AFS es un conjunto de máquinas que
comparten el mismo nombre de dominio de Internet (como por ejemplo
gentoo.org). Los usuarios ingresan al sistema a través de una de las
estaciones de trabajo cliente y esta solicita, a nombre del usuario,
la información y archivos necesarios de los servidores de la celda. El
usuario no sabe en qué servidor se encuentra el archivo al que está
accediendo, incluso no notará si el servidor está localizado en otra
habitación, dado que cada volumen puede ser replicado y movido a otro
servidor sin que el usuario lo note. Los archivos son siempre
accesibles. Es como NFS, pero con esteroides :)
</p>

</body>
</section>  

<section>
<title>¿Cuáles son los beneficios de usar AFS ?</title>
<body>

<p>
Las principales fortalezas de AFS son: facilidad en el manejo del
caché (en el lado del cliente, normalmente de 100M a 1GB),
características de seguridad (basado en Kerberos 4, listas de control
de acceso), simplicidad en el direccionamiento (existe un único sistema
de archivos), escalabilidad (es posible agregar servidores a la celda
cuando sea necesario), protocolo de comunicaciones.
</p>

</body>
</section>  

<section>
<title>¿Dónde puedo encontrar más información?</title>
<body>

<p>
Lee el <uri
link="http://www.angelfire.com/hi/plutonic/afs-faq.html">AFS
PUF</uri>.
</p>

<p>
La página principal de OpenAFS <uri
link="http://www.openafs.org">www.openafs.org</uri>.
</p>

<p>
AFS fue desarrollado originalmente por Transarc que es ahora
parte de IBM. No ha vuelto a aparecer en el catálogo de productos
de IBM desde abril de 2005.
</p>

</body>
</section>  

<section>
<title>¿Cómo puedo depurar problemas?</title>
<body>

<p>
OpenAFS tiene grandes capacidades de bitácora. Sin embargo, por
defecto, los mensajes son direccionados directamente a sus propias
bitácoras en vez de hacerlo a través de los mecanismos que tienes en
tu sistema. Para que los servidores utilicen estos mecanismos agrega
la opción <c>-syslog</c> a todos los comandos <c>bos</c>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Actualizando desde versiones anteriores</title>
<section>
<title>Introducción</title>
<body>

<p>
Esta sección apunta a ayudarte a través del proceso de actualización
de una instalación existente a OpenAFS versión 1.4.0 o superior (o
1.2.x empezando desde 1.2.13. Lo antes mencionado no será atacado
específicamente, ya que la mayoría de las personas querrán la versión
1.4 debido a que incorpora soporte apropiado de linux-2.6, soporte para
archivos más grandes y correcciones de ciertos fallos).
</p>

<p>
Si, en cambio, estás haciendo una instalación completamente nueva de
la versión 1.4 de OpenAFS, entonces no dudes en saltarte este
capítulo. Sin embargo, si estás actualizando de una versión anterior,
es muy recomendable que sigas las instrucciones de las siguientes
secciones. El guión de transición en el ebuild está diseñado para
asistirte en una actualización rápida y el reinicio del sistema en
poco tiempo. Por favor, nota que (por razones de seguridad) no borrará
los archivos de configuración y guiones de arranque de los lugares
antiguos, tampoco alterará tu configuración de arranque para que
utilice los nuevos guiones, etc. Si necesitas más razones para
convencerte, utilizando el antiguo módulo OpenAFS del núcleo junto con
los binarios del sistema actualizados, muy probablemente causará que
tu núcleo enloquezca. Así que, sigamos leyendo para tener una
transición limpia y tranquila, ¿ok?
</p>

<note>
Este capítulo ha sido escrito teniendo en mente distintas
configuraciones del sistema. Sin embargo, es posible que debido a
ajustes que el usuario haya realizado, su configuración específica no
esté descrita aquí. Un usuario con suficiente confianza en sí mismo
como para modificar sus sistema debe tener suficiente experiencia cómo
para aplicar los consejos aquí presentados cuando sean
necesarios. Viceversa, un usuario que haya hecho pocas modificaciones
puede saltarse la mayoría de las advertencias.
</note>

</body>
</section>
<section>
<title>Diferencias con versiones anteriores</title>
<body>

<p>
Tradicionalmente, OpenAFS ha utilizado las mismas convenciones de
rutas que utilizaba IBM TransArc labs, antes de que el código sea
bifurcado. Por lo cual se entiende que configuraciones antiguas de AFS
sigan con aquellas convenciones de rutas antiguas. Instalaciones más
recientes están más acorde con el FHS al utilizar ubicaciones estándar
(como se ve en muchas distribuciones de Linux). La siguiente tabla es
una compilación del guión de configuración y el LEEME que acompaña los
comprimidos de la distribución de OpenAFS:
</p>

<table>
<tr>
  <th>Directorio</th>
  <th>Propósito</th>
  <th>Modo Transarc</th>
  <th>Modo por defecto</th>
  <th>Traducción hacia Gentoo</th>
</tr>
<tr>
  <ti>viceetcdir</ti>
  <ti>Configuración del cliente</ti>
  <ti>/usr/vice/etc</ti>
  <ti>$(sysconfdir)/openafs</ti>
  <ti>/etc/openafs</ti>
</tr>
<tr>
  <ti>sin nombre</ti>
  <ti>Binarios del cliente</ti>
  <ti>sin especificar</ti>
  <ti>$(bindir)</ti>
  <ti>/usr/bin</ti>
</tr>
<tr>
  <ti>afsconfdir</ti>
  <ti>Configuración del servidor</ti>
  <ti>/usr/afs/etc</ti>
  <ti>$(sysconfdir)/openafs/server</ti>
  <ti>/etc/openafs/server</ti>
</tr>
<tr>
  <ti>afssrvdir</ti>
  <ti>Binarios internos del servidor</ti>
  <ti>/usr/afs/bin (servers)</ti>
  <ti>$(libexecdir)/openafs</ti>
  <ti>/usr/libexec/openafs</ti>
</tr>
<tr>
  <ti>afslocaldir</ti>
  <ti>Estado del servidor</ti>
  <ti>/usr/afs/local</ti>
  <ti>$(localstatedir)/openafs</ti>
  <ti>/var/lib/openafs</ti>
</tr>
<tr>
  <ti>afsdbdir</ti>
  <ti>Auth/serverlist/... bases de datos</ti>
  <ti>/usr/afs/db</ti>
  <ti>$(localstatedir)/openafs/db</ti>
  <ti>/var/lib/openafs/db</ti>
</tr>
<tr>
  <ti>afslogdir</ti>
  <ti>Archivos de bitácora</ti>
  <ti>/usr/afs/logs</ti>
  <ti>$(localstatedir)/openafs/logs</ti>
  <ti>/var/lib/openafs/logs</ti>
</tr>
<tr>
  <ti>afsbosconfig</ti>
  <ti>Configuración del supervisor</ti>
  <ti>$(afslocaldir)/BosConfig</ti>
  <ti>$(afsconfdir)/BosConfig</ti>
  <ti>/etc/openafs/BosConfig</ti>
</tr>
</table>

<p>
Hay algunas rarezas, como binarios siendo colocados en
<path>/usr/vice/etc</path> en modo Transarc, pero esta lista no
intenta ser exhaustiva. Es más que nada para dar una referencia a
aquellos tratando de resolver problemas con la transición de sus
archivos de configuración antiguos.
</p>

<p>
Otro resultado del cambio de rutas es que el caché de disco ha sido
movido de ubicación de <path>/usr/vice/cache</path> a
<path>/var/cache/openafs</path>.
</p>

<p>
Además, el guión de inicio ha sido dividido en una parte cliente y
otra servidor. Solía existir <path>/etc/init.d/afs</path>, pero ahora
existen tanto <path>/etc/init.d/openafs-client</path> como
<path>/etc/init.d/openafs-server</path>. Consecuentemente, el archivo
de configuración <path>/etc/conf.d/afs</path> a sido dividido en
<path>/etc/conf.d/openafs-client</path> y
<path>/etc/conf.d/openafs-server</path>. Junto con esto, las opciones
dentro de <path>/etc/conf.d/afs</path> para definir la máquina como
cliente o servidor son ahora obsoletas.
</p>

<p>
Otro cambio en el guión de inicio ha causado que la configuración de
tu caché de disco ya no sea revisada. El antiguo código requería que
una partición ext2 separada sea montada en
<path>/usr/vice/cache</path>. Habían algunos problemas con ello:
</p>
<ul>
  <li>
    Aunque es una configuración muy lógica, tu caché no necesita estar
    en una partición separada. Mientras te asegures que exista la
    cantidad de espacio libre que especificas en
    <path>/etc/openafs/cacheinfo</path> para el uso del caché de
    disco, estás a salvo. Así que no existe un problema real con que
    tu caché esté en tu partición raíz.
  </li>
  <li>
    Algunas personas utilizan enlaces simbólicos para apuntar a la
    verdadera ubicación del caché de disco. El guión de inicio no se
    llevaba bien con ello, ya que la ubicación del caché no era
    mostrada en <path>/proc/mounts</path>.
  </li>
  <li>
    En estos días, muchos prefieren ext3 sobre ext2. Ambos sistemas de
    archivos son válidos para utilizarlos en el caché de
    disco. Cualquier otro sistema de archivos no está soportado (como
    por ejemplo: no intentes reiserfs, recibirás una enorme
    advertencia, y ocurrirán fallos de todas formas).
  </li>
</ul>

</body>
</section>

<section>
<title>Transición a las nuevas rutas</title>
<body>

<p>
Antes de nada, emerger una nueva versión de OpenAFS no debe
sobreescribir ningún archivo de configuración antiguo. El guión está
diseñado para no alterar ningún archivo de configuración ya existente
en el sistema. Incluso si tienes una configuración completamente
entreverada utilizando nuevas y antiguas ubicaciones, el guión no debe
causar mayores problemas. También, si se detecta que hay un servidor
OpenAFS ejecutándose, la instalación se detendrá, previniendo
cualquier posible corrupción en la base de datos.
</p>

<p>
Una advertencia sin embargo -- han estado circulando algunos ebuilds a
través de la Internet que desactivan parcialmente la protección que
Gentoo impone a <path>/etc</path>. Estos ebuilds nunca han sido
distribuidos por Gentoo. Quizás quieras revisar la variable
<c>CONFIG_PROTECT_MASK</c> en la salida del siguiente comando:
</p>

<pre caption="Revisando tu CONFIG_PROTECT_MASK">
# <i>emerge info | grep "CONFIG_PROTECT_MASK"</i>
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/texmf/web2c /etc/env.d"
</pre>

<p>
Aunque nada en este ebuild tocará el archivo <path>/etc/afs</path>, la
actualización causará que tu antigua instalación de OpenAFS sea
eliminada. Los archivos en <c>CONFIG_PROTECT_MASK</c> que pertenezcan
a la antigua instalación también serán eliminados.
</p>

<p>
Debe ser claro para el usuario experimentado que en caso se haya
ajustado el sistema añadiendo enlaces simbólicos manualmente
(e.g. <path>/usr/afs/etc</path> hacia <path>/etc/openafs</path>), la
nueva instalación posiblemente se llevará bien con los antiguos
archivos de configuración. En este caso, no ha habido una transición
real, así que eliminar la antigua instalación resultará en una
configuración de OpenAFS rota.
</p>

<p>
Ahora que sabes que no sucede, quizás quieras saber lo que sí pasa:
</p>

<ul>
  <li>
    <path>/usr/afs/etc</path> es copiado a <path>/etc/openafs/server</path>
  </li>
  <li>
    <path>/usr/vice/etc</path> es copiado a <path>/etc/openafs</path>
  </li>
  <li>
    <path>/usr/afs/local</path> es copiado a <path>/var/lib/openafs</path>
  </li>
  <li>
    <path>/usr/afs/local/BosConfig</path> es copiado a
    <path>/etc/openafs/BosConfig</path>, mientras se reemplazan las
    ocurrencias de <path>/usr/afs/bin/</path> con
    <path>/usr/libexec/openafs</path>, <path>/usr/afs/etc</path> con
    <path>/etc/openafs/server</path> y <path>/usr/afs/bin</path>
    (sin el / como previamente) con <path>/usr/bin</path>
  </li>
  <li>
    <path>/usr/afs/db</path> es copiado a <path>/var/lib/openafs/db</path>
  </li>
  <li>
    El archivo de configuración <path>/etc/conf.d/afs</path> es
    copiado a <path>/etc/conf.d/openafs-client</path>, ya que todas
    las opciones antiguas estaban destinadas para el uso exclusivo del
    cliente.
  </li>
</ul>

</body>
</section>

<section>
<title>La actualización en sí</title>
<body>

<p>
¿Así que no tienes un servidor OpenAFS? O quizás sí, y las secciones
anteriores te han informado de que va a suceder, ¿y aún quieres seguir?
</p>

<p>
¡Entonces vamos a hacerlo!
</p>

<p>
Si tienes el servidor corriendo, es recomendable que lo apagues ahora.
</p>

<pre caption="Deteniendo OpenAFS (en caso que tengas un servidor)">
# <i>/etc/init.d/afs stop</i>
</pre>

<p>
Ahora, a actualizar.
</p>

<pre caption="¡Actualiza!">
# <i>emerge -u openafs</i>
</pre>

</body>
</section>
<section>
<title>Reiniciando OpenAFS</title>
<body>

<p>
Si tenías el servidor OpenAFS corriendo, no deberías haber sido
obligado a detener el cliente. Ahora es tiempo de hacerlo.
</p>

<pre caption="Deteniendo el cliente OpenAFS luego de la actualización">
# <i>/etc/init.d/afs stop</i>
</pre>

<p>
De seguro querrás mantener al mínimo el tiempo de inactividad del
servidor, así que ahora reinicia tu servidor OpenAFS.
</p>

<pre caption="Reiniciando el servidor OpenAFS luego de la actualización">
# <i>/etc/init.d/openafs-server start</i>
</pre>

<p>
Puedes revisar si está corriendo adecuadamente con el siguiente
comando:
</p>

<pre caption="Revisando el estado del servidor OpenAFS">
# <i>/usr/bin/bos status localhost -localauth</i>
</pre>

<p>
Antes de reiniciar el cliente OpenAFS, por favor revisa la
configuración de la caché. La configuración está definida en
<path>/etc/openafs/cacheinfo</path>.  Para reiniciar tu cliente
OpenAFS, ejecuta el siguiente comando:
</p>

<pre caption="Reiniciando el cliente OpenAFS luego de la actualización">
# <i>/etc/init.d/openafs-client start</i>
</pre>

</body>
</section>
<section>
<title>Haciendo la limpieza</title>
<body>

<p>
Antes de hacer la limpieza de tu sistema, asegúrate bien que todo esté
corriendo adecuadamente y que efectivamente has reiniciado el cliente
y el servidor luego de la actualización (de otra forma, puede que aún
estés ejecutando tu antigua instalación).
</p>

<impo>
¡¡Asegúrate de no estar estás utilizando <path>/usr/vice/cache</path>
para el caché de disco si vas a eliminar el directorio
<path>/usr/vice</path>!!
</impo>

<p>
Los siguientes directorios pueden ser eliminados del sistema de manera
segura:
</p>

<ul>
  <li><path>/etc/afs</path></li>
  <li><path>/usr/vice</path></li>
  <li><path>/usr/afs</path></li>
  <li><path>/usr/afsws</path></li>
</ul>

<p>
Los siguientes archivos también son innecesarios:
</p>

<ul>
  <li><path>/etc/init.d/afs</path></li>
  <li><path>/etc/conf.d/afs</path></li>
</ul>

<pre caption="Eliminando los archivos antiguos">
# <i>tar czf /root/oldafs-backup.tgz /etc/afs /usr/vice /usr/afs /usr/afsws</i>
# <i>rm -R /etc/afs /usr/vice /usr/afs /usr/afsws</i>
# <i>rm /etc/init.d/afs /etc/conf.d/afs</i>
</pre>

<p>
En caso que hayas utilizado previamente los ebuilds =openafs-1.2.13 o
=openafs-1.3.85, es probable que también tengas algunos archivos
innecesarios más:
</p>

<ul>
  <li><path>/etc/init.d/afs-client</path></li>
  <li><path>/etc/init.d/afs-server</path></li>
  <li><path>/etc/conf.d/afs-client</path></li>
  <li><path>/etc/conf.d/afs-server</path></li>
</ul>

</body>
</section>
<section>
<title>Cambios en los guiones de inicio</title>
<body>

<p>
La mayoría de la gente tiene configurado su sistema para que inicie el
cliente y el servidor OpenAFS automáticamente durante el inicio del
sistema. Aquellos que no, pueden saltarse esta sección con
seguridad. Si tienes un sistema que inicia automáticamente el cliente
y el servidor, debes reactivar esta característica ya que los nombres
de lo guiones de inicio han cambiado.
</p>

<pre caption="Reactivando el inicio de OpenAFS al arrancar el sistema">
# <i>rc-update del afs default</i>
# <i>rc-update add openafs-client default</i>
# <i>rc-update add openafs-server default</i>
</pre>

<p>
Si tienes <c>=openafs-1.2.13</c> o <c>=openafs-1.3.85</c>, debes
eliminar <path>afs-client</path> y <path>afs-server</path> del nivel
de ejecución por defecto, en lugar de <path>afs</path>.
</p>

</body>
</section>
<section>
<title>Solucionando problemas: qué hacer si falla la actualización
automática</title>
<body>

<p>
No entres en pánico. No deberías haber perdido ninguna información ni
tampoco archivos de configuración. Así que analicemos la situación. En
cualquier caso envía información sobre la falla a <uri
link="http://bugs.gentoo.org">bugs.gentoo.org</uri>, con la mayor
cantidad de información posible.
</p>

<p>
Si tienes problemas iniciando el cliente, los siguientes pasos deben
ayudarte a diagnosticar el problema.
</p>

<ul>
  <li>
    Ejecuta <c>dmesg</c>. El cliente normalmente envía mensajes de error ahí.
  </li>
  <li>
    Revisa <path>/etc/openafs/cacheinfo</path>. Debería estar con el
    siguiente formato: /afs:{ruta al caché de disco}:{número de
    bloques para el caché de disco}.  Normalmente, tu caché de disco
    estará localizado en <path>/var/cache/openafs</path>.
  </li>
  <li>
    Revisa la salida de <c>lsmod</c>. Debes revisar las lineas que
    empiecen con la palabra openafs.
  </li>
  <li><c>pgrep afsd</c> te dirá si afsd se está ejecutando o no.</li>
  <li>
    <c>cat /proc/mounts</c> debe mostrar si <path>/afs</path> fue
    montado.
  </li>
</ul>

<p>
Si tienes problemas iniciando el servidor, entonces estos consejos
deben ser útiles:
</p>

<ul>
  <li>
    <c>pgrep bosserver</c> te dirá si el supervisor está en ejecución
    o no. Si tienes más de uno corriendo, entonces algo ha salido
    mal. En ese caso, deberías intentar apagar el servidor OpenAFS
    elegantemente con <c>bos shutdown localhost -localauth -wait</c>,
    revisar el resultado con <c>bos status localhost -localauth</c> y
    eliminar los procesos supervisores restantes que sigan
    ejecutándose (<c>ls /usr/libexec/openafs</c> para obtener una
    lista de ellos).  Luego de ello, haz un
    <c>/etc/init.d/openafs-server zap</c> para reiniciar el estado del
    servidor y <c>/etc/init.d/openafs-server start</c> para intentar
    arrancarlo nuevamente.
  </li>
  <li>
    Si estás utilizando el sistema de bitácoras propio de OpenAFS (que
    es la configuración por defecto), revisa
    <path>/var/lib/openafs/logs/*</path>.  Si estás utilizando syslog,
    revisa sus propias bitácoras en búsqueda de cualquier información
    útil.
  </li>
</ul>

</body>
</section>
</chapter>


<chapter>
<title>Documentación</title>
<section>
<title>Obteniendo la documentación sobre AFS</title>
<body>

<p>
Puedes obtener la documentación original AFS de IBM. Está muy bien
escrita y si vas a administrador un servidor AFS es una lectura muy
recomendada.
</p>

<pre caption="Instalando afsdoc">
# <i>emerge app-doc/afsdoc</i>
</pre>

<p> 
También tienes la opción de utilizar la documentación distribuida con
OpenAFS. Esta es instalada cuando tienes activada la bandera USE
<c>doc</c>. La documentación puede ser encontrada en el directorio
<path>/usr/share/doc/openafs-*/</path>. Al momento de escribir este
documento, esta documentación está aún en fase de desarrollo. Puede,
sin embargo, documentar características nuevas de OpenAFS que no son
incluidas en la documentación de IBM sobre AFS.
</p>

</body>   
</section>
</chapter>

<chapter>
<title>Instalación del cliente</title>
<section>
<title>Construyendo al cliente</title>
<body>

<pre caption="Instalando openafs">
# <i>emerge net-fs/openafs</i>
</pre>

<p>
Luego de una compilación exitosa, estás listo para seguir.
</p>

</body>
</section>
<section>
<title>Instalación de un cliente de navegación-global simple</title>

<body>

<p>Si no eres parte de una celda OpenAFS específica a la cual que
quieres acceder, y solamente quieres navegar las particiones
compartidas OpenAFS disponibles de manera global, entonces solo
instala OpenAFS, no modifiques la configuración para nada, y arranca
<path>/etc/init.d/openafs-client</path>.
</p>
         
</body>
</section>
<section>
<title>Accediendo a una celda OpenAFS específica</title>
<body>
  
<p>
Si necesitas acceder a una celda específica, digamos a la celda
de tu universidad o compañía, entonces es necesario hacer
algunos ajustes a la configuración.
</p>

<p>
Primero, necesitas actualizar
<path>/etc/openafs/CellServDB</path> con la base de datos de
servidores de tu celda. Normalmente, tu administrador te
ofrecerá esta información.
</p>
     
<p>
Luego, para poder ingresar a la celda OpenAFS, necesitas
especificar su nombre en <path>/etc/openafs/ThisCell</path>.
</p>
    
<pre caption="Ajustando CellServDB y ThisCell">
CellServDB:
>netlabs        #Nombre de la celda
10.0.0.1        #almacenamiento

ThisCell:
netlabs       
</pre>

<warn>
Utiliza solamente espacios dentro del archivo
<path>CellServDB</path>. El cliente muy probablemente fallará si
utilizas TABs.
</warn>

<p>
CellServDB le dice al cliente que servidor(es) necesita contactar para
una celda en particular. ThisCell debe ser bastante obvio. Normalmente
se utiliza un nombre que es único para tu organización.  Tu dominio
(oficial) es una buena elección.
</p>

<p>
Para un inicio rápido, puedes iniciar
<path>/etc/init.d/openafs/client</path> y utilizar <c>klog</c> para
autenticarte y empezar a utilizar tu acceso a la celda. Para
autenticarte de manera automática en tu celda, consulta la sección
adecuada más abajo.
</p>

</body>
</section>
<section>
<title>Ajustando el caché</title>
<body>

<note>
Desafortunadamente los clientes AFS necesitan un sistema de archivos
ext2/3 para que su caché funcione correctamente. Existen algunos
problemas cuando se utilizan otros sistemas de archivos (e.g. utilizar
reiserfs no es una buena idea).
</note>

<p>
Puedes hospedar tu caché en un sistema de archivos ya existente (si
es ext2/3), o quizás prefieras crear una partición separada para
ello. La ubicación por defecto del caché es
<path>/var/cache/openafs</path>, pero puedes cambiarla editando
<path>/etc/openafs/cacheinfo</path>. El tamaño estándar del caché es
de 200MB, pero más no hará ningún daño.
</p>

</body>
</section>
<section>
<title>Iniciando AFS en el arranque</title>
<body>

<p>
El siguiente comando creará los enlaces apropiados para que el cliente
afs se inicie durante el arranque del sistema.
</p>

<warn>
Siempre debes tener activo el servidor AFS cuando trates de iniciar un
cliente afs. Si el servidor está fuera de línea tu sistema no
arrancará hasta que llegue a un límite de tiempo. (y esto es un
tiempo muy, muy largo).
</warn>

<pre caption="Agregando AFS al nivel de ejecución por defecto">
# <i>rc-update add openafs-server default</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Instalación del servidor</title>
<section>
<title>Construyendo el servidor</title>
<body>

<note>
¡Todos los comandos deben ser escritos en una sola linea!
En este documento están, algunas veces, divididos en dos
líneas para hacerlos más fáciles de leer.
</note>

<p>
Si aún no lo has hecho, el siguiente comando instalará todos los
binarios necesarios para construir un servidor <e>y</e> cliente AFS.
</p>

<pre caption="Instalando openafs">
# <i>emerge net-fs/openafs</i>
</pre>

</body>
</section>

<section>
<title>Iniciando el servidor AFS</title>    
<body>

<p>
Necesitas ejecutar el comando <c>bosserver</c> para inicializar el
Servidor Basic OverSeer (BOS), que monitorea y controla otros procesos
del servidor AFS. Tómalo como si fuera el init del sistema. Incluye la
bandera <c>-noauth</c> para desactivar la comprobación de
autorización, ya que no has añadido al usuario administrador todavía.
</p>

<warn>
Deshabilitar la comprobación de autenticación compromete
gravemente la seguridad de la celda. Debes completar todos los
siguientes pasos subsecuentemente de manera ininterrumpida y no
debes dejar desatendida la máquina en ningún momento hasta que
reinicies el servidor BOS con la comprobación de autorización
habilitada. Bueno, eso es lo que la documentación sobre AFS dice
:).
</warn>

<pre caption="Inicializando el servidor Basico OverSeer (supervisor básico)">
# <i>bosserver -noauth &amp;</i>
</pre>

<p>
Verifica que el Servidor BOS creó
<path>/etc/openafs/server/CellServDB</path> y
<path>/etc/openafs/server/ThisCell</path>
</p>

<pre caption="Revise si CellServDB y ThisCell han sido creados">
# <i>ls -al /etc/openafs/server/</i>
-rw-r--r--    1 root     root           41 Jun  4 22:21 CellServDB
-rw-r--r--    1 root     root            7 Jun  4 22:21 ThisCell
</pre>

</body>    
</section>

<section>
<title>Definiendo nombre de celda y membrecía para los procesos del servidor</title>
<body>

<p>
Ahora asígnale un nombre a tu celda.
</p>

<impo>
Hay algunas restricciones en el formato del nombre. Dos de las
más importantes son que el nombre no puede incluir mayúsculas
y tiene que ser menor a 64 caracteres. Recuerda que el nombre
de tu celda estará bajo <path>/afs</path>, así que quizás
desees escoger un nombre corto.
</impo>

<note>
En la demás instrucciones de esta guía, sustituye el argumento
&lt;nombre servidor&gt; por el nombre calificado completo (como por
ejemplo<b> afs.gentoo.org</b>) de la máquina en la que estás
instalando OpenAFS. Cambia también el argumento &lt;nombre celda&gt; por
el nombre completo de tu celda (como <b>gentoo</b>).
</note>

<p>
Ejecuta el comando <c>bos setcellname</c> para definir el nombre de la
celda:
</p>

<pre caption="Asignando el nombre de la celda">
# <i>bos setcellname &lt;nombre servidor&gt; &lt;nombre celda&gt; -noauth</i>
</pre>

</body>
</section>

<section>
<title>Iniciando el proceso de servidor de base de datos</title>
<body>

<p>
Ahora, utiliza el comando <c>bos create</c> para crear las entradas de
los cuatro procesos servidores de base de datos en el archivo
<path>/etc/openafs/BosConfig</path>. Los cuatro procesos corren
únicamente en las máquinas servidoras de base de datos.
</p>

<table>
<tr>
  <ti>kaserver</ti>
  <ti>
    El servidor de autenticación mantiene la base de datos de
    autenticación. Este puede ser reemplazado por un demonio kerberos
    5. Si alguien quiere intentarlo siéntase libre de agregarlo a este
    documento :)
  </ti> 
</tr>
<tr>
   <ti>buserver</ti>
   <ti>El servidor de respaldo mantiene la base de datos de respaldo</ti>
</tr>
<tr>
   <ti>ptserver</ti>
   <ti>El servidor de protección mantiene la base de datos de
   protección</ti>
</tr>
<tr>
   <ti>vlserver</ti>
   <ti>
     El servidor de localización de volumen mantiene la base de
     datos de localización de volumen(VLDB). Por cierto, es muy importante.
   </ti>
</tr>
</table>    

<pre caption="Creando los registros para los procesos de bases de datos">
# <i>bos create &lt;nombre servidor&gt; kaserver \
simple /usr/libexec/openafs/kaserver \
-cell &lt;nombre celda&gt; -noauth</i>
# <i>bos create &lt;nombre servidor&gt; buserver \
simple /usr/libexec/openafs/buserver \
-cell &lt;nombre celda&gt; -noauth</i>
# <i>bos create &lt;nombre servidor&gt; ptserver \
simple /usr/libexec/openafs/ptserver \
-cell &lt;nombre celda&gt; -noauth</i>
# <i>bos create &lt;nombre servidor&gt; \
vlserver simple /usr/libexec/openafs/vlserver \
-cell &lt;nombre celda&gt; -noauth</i>
</pre>

<p>
Puedes comprobar que todos los servidores están funcionando
con el comando <c>bos status</c>:
</p>

<pre caption="Revisar que estén corriendo todos los servidores">
# <i>bos status &lt;nombre servidor&gt; -noauth</i>
Instance kaserver, currently running normally.
Instance buserver, currently running normally.
Instance ptserver, currently running normally.
Instance vlserver, currently running normally.
</pre>

</body>
</section>

<section>
<title>Inicializando la seguridad de la celda</title>
<body>

<p>
Es hora de inicializar los mecanismos de seguridad de la
celda. Empezaremos creando las dos siguientes entradas iniciales en la
base de datos de autenticación: La cuenta administrativa principal,
llamada <b>admin</b> por convención, y una entrada para el proceso del
servidor AFS, llamado <c>afs</c>. Ningún usuario ingresa al sistema
bajo la identidad <b>afs</b>, pero el módulo del Servicio de Entrega
de Tickets (TGS) del Servidor de Autenticación utiliza esta cuenta
para encriptar todos los tickets que entrega a clientes AFS. Esto
suena muy parecido a Kerberos :)
</p>

<p>
Entrando al modo interactivo de <c>kas</c>
</p>

<pre caption="Entrando al modo interactivo">
# <i>kas -cell &lt;nombre celda&gt; -noauth</i>
ka&gt; <i>create afs</i>
initial_password:
Verifying, please re-enter initial_password:
ka&gt; <i>create admin</i>
initial_password:
Verifying, please re-enter initial_password:
ka&gt; <i>examine afs</i>

User data for afs
key (0) cksum is 2651715259, last cpw: Mon Jun  4 20:49:30 2001
password will never expire.
An unlimited number of unsuccessful authentications is permitted.
entry never expires.  Max ticket lifetime 100.00 hours.
last mod on Mon Jun  4 20:49:30 2001 by &lt;none&gt;
permit password reuse
ka&gt; <i>setfields admin -flags admin</i>
ka&gt; <i>examine admin</i>
 
User data for admin (ADMIN)
key (0) cksum is 2651715259, last cpw: Mon Jun  4 20:49:59 2001
password will never expire.
An unlimited number of unsuccessful authentications is permitted.
entry never expires.  Max ticket lifetime 25.00 hours.
last mod on Mon Jun  4 20:51:10 2001 by &lt;none&gt;
permit password reuse
ka&gt;
</pre>

<p>
Ejecuta el comando <c>bos adduser</c> para añadir el
usuario <b>admin</b> a <path>/etc/openafs/server/UserList</path>.
</p>

<pre caption="Agregando al usuario admin al UserList">
# <i>bos adduser &lt;nombre servidor&gt; admin -cell &lt;nombre celda&gt; -noauth</i>
</pre>

<p>
Utiliza el comando <c>bos addkey</c> para definir la llave de
encriptación del servidor AFS
en <path>/usr/afs/etc/KeyFile</path>
</p>

<note>
Si el sistema solicita una llave de entrada, usa la contraseña que
ingresaste al crear la entrada afs con <b>kas</b>
</note>

<pre caption="Ingresando la contraseña">
# <i>bos addkey  &lt;nombre servidor&gt; -kvno 0 -cell &lt;nombre celda&gt; -noauth</i>
input key:
Retype input key:
</pre>

<p>
Con el comando <c>pts createuser</c> crea una entrada para el
usuario admin en la Base de Datos de Protección
</p>

<note>
Por defecto el servidor de protección asigna AFS UID 1 al
usuario <b>admin</b>, porque es el primer usuario cuya entrada
se crea. Si el archivo de contraseñas local (<path>/etc/passwd</path> o
equivalente) ya tiene una entrada para <b>admin</b> que le
asigna un UID distinto, utiliza el argumento <c>-id</c> para
crear UID que sean iguales.
</note>

<pre caption="Creación del registro en la base de datos de protección para el usuario">
# <i>pts createuser -name admin -cell &lt;nombre celda&gt; [-id &lt;AFS UID&gt;] -noauth</i>
</pre>

<p>
Ejecuta el comando <c>pts adduser</c> para hacer al
usuario <b>admin</b> miembro del grupo system:administrators, y
el comando <c>pts membership</c> para verificar la membresía.
</p>

<pre caption="Hacer a admin miembro del grupo de administradores y verificación">
# <i>pts adduser admin system:administrators -cell &lt;nombre celda&gt; -noauth</i>
# <i>pts membership admin -cell &lt;nombre celda&gt; -noauth</i>
Groups admin (id: 1) is a member of:
system:administrators
</pre>

</body>
</section>
<section>
<title>(re-)iniciando apropiadamente el servidor AFS</title>
<body>
  
<p>
En este momento, una autenticación adecuada es posible, y el
servidor OpenAFS puede ser iniciado de forma normal. Nota que la
autenticación también requiere un cliente OpenAFS corriendo
(configúralo como se indica en el capítulo anterior).
<!-- Left out because deemed confusing>
Continuing without this step is possible, but in that case a
quick restart of the server is required, as demonstrated at the
end of this section.
<-->
</p>
  
<pre caption="Apangando bosserver">
# <i>bos shutdown &lt;nombre servidor&gt; -wait -noauth</i>
# <i>killall bosserver</i>
</pre>
  
<pre caption="Inicialización normal del servidor (y cliente) OpenAFS">
# <i>/etc/init.d/openafs-server start</i>
# <i>/etc/init.d/openafs-client start</i>
</pre>
  
<pre caption="Agregando el servidor AFS al nivel de ejecución por defecto">
# <i>rc-update add openafs-server default</i>
</pre>
  
<pre caption="Obteniendo un token como usuario administrador">
# <i>klog admin</i>
</pre>
  
<!-- Left out because deemed confusing>
<p>
Si decides no reiniciar OpenAFS sin la bandera -noauth, puedes
simplemente realizar en cambio el siguiente procedimiento:
</p>

<pre caption="Reinicie todos los procesos de servidor AFS">
# <i>bos restart &lt;nombre servidor&gt; -all -cell &lt;nombre celda&gt; -noauth</i>
</pre>
<!-->

</body>
</section>

<section>
<title>Iniciando el Servidor de Archivos, el Servidor de Volumen y Salvager</title>
<body>

<p>
Arranca el proceso <c>fs</c>, que consiste en el Servidor de
Archivos, el Servidor de Volumen y Salvager (procesos
fileserver, volserver y salvager).
</p>

<pre caption="Iniciando el proceso fs">
# <i>bos create &lt;nombre servidor&gt; fs \
fs /usr/libexec/openafs/fileserver /usr/libexec/openafs/volserver /usr/libexec/openafs/salvager \
-cell &lt;nombre celda&gt; -noauth</i>
</pre>

<p>
Es hora de verificar que todos los procesos estén en ejecución:
</p>

<pre caption="Verificando que todos los procesos estén corriendo">
# <i>bos status &lt;nombre servidor&gt; -long -noauth</i>
Instance kaserver, (type is simple) currently running normally.
Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
Last exit at Mon Jun  4 21:07:17 2001
Command 1 is '/usr/libexec/openafs/kaserver'

Instance buserver, (type is simple) currently running normally.
Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
Last exit at Mon Jun  4 21:07:17 2001
Command 1 is '/usr/libexec/openafs/buserver'

Instance ptserver, (type is simple) currently running normally.
Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
Last exit at Mon Jun  4 21:07:17 2001
Command 1 is '/usr/libexec/openafs/ptserver'

Instance vlserver, (type is simple) currently running normally.
Process last started at Mon Jun  4 21:07:17 2001 (2 proc starts)
Last exit at Mon Jun  4 21:07:17 2001
Command 1 is /usr/libexec/openafs/vlserver'

Instance fs, (type is fs) currently running normally.
Auxiliary status is: file server running.
Process last started at Mon Jun  4 21:09:30 2001 (2 proc starts)
Command 1 is '/usr/libexec/openafs/fileserver'
Command 2 is '/usr/libexec/openafs/volserver'
Command 3 is '/usr/libexec/openafs/salvager'
</pre>

<p>
Tu siguiente acción depende de si alguna vez has ejecutado un servidor
de archivos AFS en la celda.
</p>

<p>
En caso que estés instalando el primer servidor AFS de la celda,
crea el primer volumen AFS <b>root.afs</b>
</p>

<note>
En el argumento "nombre partición", sustituye el nombre de una
de las particiones de la máquina Servidor AFS. Cualquier sistema de
archivos montado en un directorio llamado <path>/vicepx</path>, donde
x está en el rango a-z, será considerado y utilizado como una
partición del servidor AFS. A diferencia del caché (que solo soporta
ext2/3), estas particiones pueden tener cualquier sistema de archivos
unix. Tip: el servidor revisa cada punto de montaje
<path>/vicepx</path> y si encuentra algún sistema de archivos montado
ahí lo utiliza, de otra forma lo ignora. Este comportamiento puede ser
modificado si creas un archivo llamado <path>AlwaysAttach</path> en el
directorio en cuestión.
</note>

<pre caption="Creación del volumen root.afs">
# <i>vos create &lt;nombre servidor&gt; &lt;nombre partición&gt; root.afs -cell &lt;nombre celda&gt; -noauth</i>
</pre>

<p>
Si hay máquinas servidoras de archivos AFS y volúmenes ya
creados en la celda, utiliza los comandos <c>vos sncvldb</c>
y <c>vos syncserv</c> para sincronizar el VLDB (Base de Datos de
Localización de Volumen) con el estado actual de la localización
de los volúmenes. Esto copiará toda la información necesaria a
tu nuevo servidor.
</p>

<p>
Si el comando falla con el mensaje "partition /vicepa does not
exist on the server", asegúrate que la partición está montada
antes de levantar los servidores OpenAFS, o monta el directorio
y reinicia los procesos utilizando<c>/usr/afs/bin/bos restart
&lt;nombre servidor&gt; -all -cell &lt;nombre celda&gt; -noauth</c>.
</p>

<pre caption="Sincronice el VLDB">
# <i>/usr/afs/bin/vos syncvldb &lt;nombre servidor&gt; -cell &lt;nombre celda&gt; -verbose -noauth</i>
# <i>/usr/afs/bin/vos syncserv &lt;nombre servidor&gt; -cell &lt;nombre celda&gt; -verbose -noauth</i> 
</pre>

</body>
</section>

<section>
<title>Iniciando la parte servidor del servidor de actualizaciones</title>
<body>

<pre caption="Iniciando el servidor de actualización">
# <i>bos create &lt;nombre servidor&gt; \
upserver simple "/usr/libexec/openafs/upserver \
-crypt /etc/openafs/server -clear /usr/libexec/openafs" \
-cell &lt;nombre celda&gt; -noauth</i>
</pre>

</body>
</section>

<section>
<title>Configurando el Nivel Superior del espacio de archivos AFS</title>
<body>

<p>
Primero necesitas definir algunos ACLs, de manera que
cualquier usuario pueda ver <path>/afs</path>.
</p>

<note>
La configuración por defecto del cliente OpenAFS tiene
<b>dynroot</b> activado. Esta opción convierte <path>/afs</path> en
un directorio virtual compuesto por el contenido de tu archivo
<path>/etc/openafs/CellServDB</path>. Como tal, el siguiente comando
no funcionará, debido a que necesita un directorio AFS real. Puede
desactivar dynroot de manera temporal al definir
<b>ENABLE_DYNROOT</b> en <b>no</b> en
<path>/etc/conf.d/openafs-client</path>. No olvides reiniciar el
cliente luego de modificar los parámetros.
</note>

<pre caption="Configure las listas de control de acceso">
# <i>fs setacl /afs system:anyuser rl</i>
</pre>

<p>
Ahora necesitas crear el volumen raíz, montarlo como solo lectura en
<path>/afs/&lt;nombre celda&gt;</path> y lectura-escritura en
<path>/afs/.&lt;nombre celda&gt;</path>.
</p>

<pre caption="Preparando el volumen raíz">
# <i>vos create &lt;nombre servidor&gt;&lt;nombre partición&gt; root.cell</i>
# <i>fs mkmount /afs/&lt;nombre celda&gt; root.cell </i>
# <i>fs setacl /afs/&lt;nombre celda&gt; system:anyuser rl</i>
# <i>fs mkmount /afs/.&lt;nombre celda&gt; root.cell -rw</i>
</pre>

<pre caption="Agregando los volúmenes inferiores">
# <i>vos create &lt;nombre servidor&gt; &lt;nombre partición&gt; &lt;MiVolumen&gt;</i>
# <i>fs mkmount /afs/&lt;nombre celda&gt;/&lt;nombre partición&gt; &lt;MiVolumen&gt;</i>
# <i>fs mkmount /afs/&lt;nombre celda&gt;/.&lt;miPuntoDeMontaje&gt; &lt;MiVolumen&gt; -rw</i>
# <i>fs setquota /afs/&lt;nombre celda&gt;/.&lt;miPuntoDeMontaje&gt; -max &lt;quotum&gt;</i>
</pre>

<p>
Finalmente, ¡terminaste!. Ahora debes tener un servidor de
archivos AFS funcionando en tu red local. ¡¡Es hora de tomar una
gran taza de café e imprimir la documentación sobre AFS!!
</p>

<note>
Es muy importante para el correcto funcionamiento de servidor
AFS que todos los relojes de todos los sistemas estén
sincronizados. Esto lo puedes conseguir instalando un servidor
ntp en una máquina (por ejemplo el servidor AFS) y sincronizar
los relojes como clientes ntp. Esto también puede ser hecho por
el cliente AFS.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Administración básica</title>
<section>
<title>Renuncia de responsabilidad</title>
<body>

<p>
OpenAFS es una tecnología extensa. Por favor lee la documentación de
AFS para mayor información. Nosotros solo listamos una pequeña lista
de tareas administrativas en este capítulo.
</p>

</body>
</section>

<section>
<title>Configurando PAM para obtener una ficha AFS al ingresar</title>
<body>

<p>
Para poder utilizar AFS necesitas autenticarte con el servidor KA si
utilizas una implementación AFS Kerberos 4, o con un servidor Kerberos
5 KDC si utilizas MIT, Heimdal o ShiShi Kerberos 5. Sin embargo, para
poder ingresar a una máquina también necesitarás una cuenta de
usuario, que puede ser local mediante <path>/etc/passwd</path>, NIS, LDAP
(OpenLDAP), o una base de datos Hesiod. PAM permite a Gentoo atar la
autenticación de ingreso al sistema y de AFS a la cuenta del usuario.
</p>

<p>
Necesitarás actualizar <path>/etc/pam.d/system-auth</path> que es
utilizado por las demás configuraciones. "use_first_pass" indica que
primero se revisará el ingreso al sistema, e "ignore_root" evita que
el usuario root sea autenticado de manera que pueda ingresar al
sistema si el AFS o la red falla.
</p>

<pre caption="/etc/pam.d/system-auth">
auth       required     pam_env.so
auth       sufficient   pam_unix.so likeauth nullok
auth       sufficient   pam_afs.so.1 use_first_pass ignore_root
auth       required     pam_deny.so

account    required     pam_unix.so

password   required     pam_cracklib.so retry=3
password   sufficient   pam_unix.so nullok md5 shadow use_authtok
password   required     pam_deny.so

session    required     pam_limits.so
session    required     pam_unix.so
</pre>

<p>
Para hacer que <c>sudo</c> mantenga la ficha del usuario real y prevenir a los
usuarios locales ganar acceso AFS cambia /etc/pam.d/su de la siguiente
manera:
</p>

<pre caption="/etc/pam.d/su">
<comment># Aquí usuarios con uid &gt; 100 se consideran miembros del AFS y usuarios con 
# uid &lt;= 100 son ignorados por pam_afs.</comment>
auth       sufficient   pam_afs.so.1 ignore_uid 100

auth       sufficient   pam_rootok.so

<comment># Si quieres restringir más a los usuarios de utilizar el comando su, crea el archivo,
# /etc/security/suauth.allow que es solo con permisos de escritura por el superusuario
# y añade a los usuarios que se les permite hacer "su" a ese archivo, uno por línea
#auth       required     /lib/security/pam_listfile.so item=ruser \
#       sense=allow onerr=fail file=/etc/security/suauth.allow

# Descomenta esta linea para permitir que los usuarios del grupo 
# wheel puedan hacer "su" sin utilizar passwd.
#auth       sufficient   pam_wheel.so use_uid trust

# Alternativamente a lo anterior, puedes implementar una lista de usuarios 
# que no necesitan dar una contraseña con una lista.
#auth       sufficient   pam_listfile.so item=ruser \
#       sense=allow onerr=fail file=/etc/security/suauth.nopass

# Comenta las siguiente lineas para permitir a cualquier usuario, incluso a
# aquellos fuera del grupo 'wheel', poder hacer "su"</comment>
auth       required     pam_wheel.so use_uid

auth       required     pam_stack.so service=system-auth

account    required     pam_stack.so service=system-auth

password   required     pam_stack.so service=system-auth

session    required     pam_stack.so service=system-auth
session    optional     pam_xauth.so

<comment># Aquí prevenimos que la ficha del id real del usuario sea dejada atrás</comment>
session    optional     pam_afs.so.1 no_unlog
</pre>

</body>
</section>
</chapter>
</guide>
