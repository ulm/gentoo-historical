<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/hb-install-system.xml,v 1.18 2005/04/09 12:16:30 yoswink Exp $ -->

<sections>

<version>2.4</version>
<date>2005-04-09</date>
 
<section>
<title>Chrooting</title>
<subsection>
<title>Opcional: Seleccionando servidores réplica</title>
<body>

<p>
Para poder descargar el código fuente rápidamente se recomienda seleccionar
un servidor réplica rápido. Portage comprobará en su archivo 
<path>make.conf</path> la variable GENTOO_MIRRORS y utilizará los servidores
que se especifican allí. Puede navegar en nuestra 
<uri link="/main/en/mirrors.xml">lista de réplicas</uri> y buscar un servidor
(o servidores) que estén cerca de su localización (ya que estos suelen 
resultar los más rápidos), pero no nosotros le facilitamos una bonita 
herramienta llamada <c>mirrorselect</c> la cual proporciona una 
interfaz amigable para seleccionar los servidores réplicas que quiera.
</p>

<pre caption="Utilizando mirrorselect para la variable GENTOO_MIRRORS">
# <i>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<warn>
No seleccione ningún servidor con IPv6. Nuestros stages no soportan 
actualmente IPv6.
</warn>

<p>
Otra importante configuración es la variable SYNC en <path>make.conf</path>. 
Esta variable contiene el servidor rsync que quiere utilizar para actualizar
su árbol Portage (la colección de ebuilds, scripts que contienen toda la 
información que Portage necesita para descargar e instalar software). Aunque
puede introducir manualmente el servidor SYNC, <c>mirrorselect</c> puede
encargarse también de esto:
</p>

<pre caption="Seleccionando un servidor rsync utilizando mirrorselect">
# <i>mirrorselect -i -r -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Después de ejecutar <c>mirrorselect</c> es recomendable que compruebe sus 
configuraciones en <path>/mnt/gentoo/etc/make.conf</path>.
</p>

</body>
</subsection>
<subsection>
<title>Copiar la información DNS</title>
<body>

<p>
Aún queda una cosa que hacer antes de entrar en el nuevo entorno,
copiar la información sobre los DNS en <path>/etc/resolv.conf</path>. 
Necesita hacer esto para asegurarse de que la red continúe funcionando 
después de entrar en el nuevo entorno. <path>/etc/resolv.conf</path> 
contiene los servidores de nombres para su red.
</p>

<pre caption="Copiando los DNS">
<comment>(La opción "-L" es necesaria para asegurarnos que no copiamos un enlace simbólico)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title> Montando el sistema de archivos proc</title>
<body>

<p>
Monte el sistema de ficheros <path>/proc</path> en 
<path>/mnt/gentoo/proc</path> para permitir a la instalación
utilizar la información proporcionada por el kernel incluso dentro
del entorno chroot. 
</p>

<pre caption="Montando /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Entrando al nuevo entorno</title>
<body>

<p>
Ahora que todas las particiones están inicializadas y el sistema base
instalado, es hora de entrar en nuestro nuevo entorno de instalación
<e>chrooting</e>. Esto significa pasar desde el actual
entorno de instalación (CD de instalación u otro medio) hacia tu
entorno de instalación (o sea, las particiones inicializadas).
</p>

<p>
El cambio de raíz se hace en tres pasos. Primero cambiamos la raíz
desde <path>/</path> (en el medio de instalación) a <path>/mnt/gentoo</path>
(en tus particiones) usando <c>chroot</c>. Después crearemos un nuevo entorno
usando <c>env-update</c>, el cual, en esencia crea las variables de entorno.
Finalmente, cargamos esas variables en memoria tecleando <c>source</c>.
</p>

<pre caption = "Entrando al nuevo entorno">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
¡Enhorabuena! Estás dentro de tu nuevo entorno Gentoo Linux.
Por supuesto aún no hemos terminado, todavía quedan unas cuantas
secciones ;)
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Actualizando el árbol Portage</title>
<body>

<p>
Debería actualizar ahora su árbol Portage a la última versión. <c>emerge --sync</c>
hará esto por nosotros. 
</p>

<pre caption="Actualizando el árbol Portage">
# <i>emerge --sync</i>
</pre>

<p>
Si está dentrás de un firewall que bloquea el tráfico rsync, puede utilizar
<c>emerge-webrsync</c> el cual descargará e instalará una imagen de portage
para su sistema.
</p>

<p>
Si ha advertido que está disponible una nueva versión de Portage y debe
actualizarlo, puede ignorar esta advertencia sin miedo. El Portage
será actualizado durante la instalación.
</p>

</body>
</subsection>
<subsection>
<title>Eligiendo el perfil adecuado</title>
<body>

 <p>
Primero, una pequeña definición:
 </p>

 <p>
Un perfil es la piedra inicial de cualquier sistema Gentoo. No solamente especifica 
unos valores predeterminados para CHOST, CFLAGS,  y otras variables 
importantes , también bloquea del sistema ciertos rangos de versiones de algunos 
paquetes. Son mantenidos por los desarrolladores de  Gentoo.
</p>

 <p>
Tiempo atrás, los perfiles raramente los tocaba el usuario. Sin embargo, ahora
los usuarios de x86, hppa y alpha puede elegir entre dos perfiles, uno para los kernel 
2.4 y otro para la serie 2.6. Este requisito ha sido impuesto para la integración de los
kernels 2.6.
</p>

<p>
Se puede ver el perfil actualmente utilizado con el siguiente comando:
</p>

<pre caption="Comprobando el pérfil del sistema">
 # <i>ls -l /etc/make.profile</i>
 lrwxrwxrwx  1 root root 48 Mar  7 11:55 /etc/make.profile ->
       ../usr/portage/profiles/default-linux/x86/2005.0
</pre>
 
<p>
Si está utilizando una de las tres arquitecturas mencionadas anteriormente, verá 
un perfil adicional al que se muestra en el enlace simbólico 
<path>make.profile</path>:
</p>
  	 
 <pre caption="Comprobando si existen perfiles adicionales">
 # <i>ls -F /etc/make.profile/</i>
 2.4/  packages  parent  virtuals
 </pre>

 <p>
Como puede ver en el ejemplo anterior, hay un subdirectorio 2.4. Esto implica
que el perfil actual utiliza los kernel 2.6. Si quiere cambiar a un sistema basado
en 2.4 necesita volver a crear el enlace <path>make.profile</path>:
 </p>

 <pre caption="Volviendo a crear el enlace a un pérfil">
# <i>ln -snf /usr/portage/profiles/default-linux/x86/2005.0/2.4 /etc/make.profile</i>
 </pre>
  	 
 </body>
 </subsection>
<subsection id="configure_USE">
<title>Configurando la variable USE</title>
<body>

<p>
<c>USE</c> es una de las variables más importantes que Gentoo proporciona a 
sus usuarios. Muchos programas pueden ser compilados con o sin soporte 
opcional para ciertas cosas. Por ejemplo, algunos programas pueden ser 
compilados con soporte gtk,o con soporte qt. Otros programas pueden ser 
compilados con o sin soporte SSL. Algunos programas pueden ser compilados 
con soporte framebuffer en lugar de soporte X11 (servidor X).
</p>

<p>
Muchas distribuciones compilan sus paquetes con el mayor soporte posible,
aumentando el tamaño de los programas y su tiempo de carga, sin mencionar 
una cantidad enorme de dependencias. Con Gentoo puedes definir con que 
opciones debe ser compilado un paquete. Ahí es donde actúa la variable 
<c>USE</c>.
</p>

<p>
En la variable <c>USE</c> definimos palabras clave que son mapeadas a 
opciones de compilación. Por ejemplo <e>ssl</e> compilará los programas 
que lo requieran con soporte ssl.<e>-X</e> quitara el soporte para el servidor 
X (nótese el signo menos delante). <e>gnome gtk -kde -qt</e> compilará tus 
programas con soporte para gnome y gtk, pero sin soporte para kde (y qt), 
haciendo tu sistema completamente compatible con GNOME.
</p>

<p>
Los valores por defecto de la variable <c>USE</c> se encuentran en 
<path>make.defaults</path>, archivos de su perfil. Encontrará los archivos 
<path>make.defaults</path> en el directorio al cual apunte 
<path>/etc/make.profile</path> y todos sus directorios padres. El valor 
predeterminado de configuración de la variable <c>USE</c> es la suma de 
todas las configuraciones de <c>USE</c> en todos los archivos 
<path>make.defaults</path>. Lo que modifique en <path>/etc/make.conf</path> 
se calcula contra estos valores. Si pone algún valor en su <c>USE</c>, es 
añadido a la lista por defecto. Si elimina algo en su variable <c>USE</c>, 
poniéndole un signo menos delante, es eliminado de la lista por defecto 
(si estaba en ella claro). <e>Nunca</e> cambie nada en 
<path>/etc/make.profile</path> ya que se sobreescribirá cuando actualice Portage!
</p>

<p>
Puede encontrar una descripción más amplia sobre la variable <c>USE</c> 
en la segunda parte del Manual de Gentoo <uri
link="?part=2&amp;chap=1">Capítulo 1: Variables USE</uri>. Encontrará
una descripción más extensa sobre las opciones de la variable USE en su sistema, 
en <path>/usr/portage/profiles/use.desc</path>.
</p>

<pre caption="Viendo las opciones disponibles">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Puede desplazarse arriba y abajo utilizando sus teclas de flechas y salir pulsando 'q')</comment>
</pre>

<p>
Como ejemplo, te mostramos unas opciones <c>USE</c> para un sistema basado 
en KDE con DVD, ALSA y soporte para grabar CD's.
</p>

<pre caption="Abriendo /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Configurando la variable USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

</body>
</subsection>
<subsection>
<title>Opcional: Locales para GLIBC</title>
<body>

 <p>
Probablemente querrá utilizar solamente una o dos configuraciones locales 
en su sistema. Después de compilar <c>glibc</c> se crea un amplio conjunto 
de variables locales. En este punto puede activar la variable USE 
<c>userlocales</c> y especificar solamente las variables locales que necesite
en <path>/etc/locales.build</path>. Solamente haga esto si conoce que locales
debe utilizar. Esto no funcionará para el bootstraping, pero cuando glibc se
recompile posteriormente, lo hará.
</p>
<pre caption="Activando la variable USE 'userlocales' para glibc">
<i>mkdir /etc/portage</i>
echo "sys-libs/glibc userlocales" >> /etc/portage/package.use
</pre>

<p>
Ahora puede especificar las variable locales que quiere utilizar:
</p>

<pre caption="Abriendo /etc/locales.build">
 # <i>nano -w /etc/locales.build</i>
</pre>

<p>
Las siguientes "locales" son un ejemplo para tener, al mismo tiempo, los idiomas: 
Inglés (Estados unidos) y Español (España) con sus respectivos formatos 
(por ejemplo UTF-8).
</p>

<pre caption="Especificando sus locales">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
es_ES/ISO-8859-15
es_ES@euro/ISO-8859-15
</pre>

</body>
</subsection>
</section>
<section>
<title>Diferencias entre stage1, stage2 y stage3</title>
<body>

<p>
Ahora toma asiento y reflexiona sobre los pasos previos. Te hemos pedido que
seleccionaras el <e>stage1</e>, <e>stage2</e> o <e>stage3</e> y advertido
que tu elección es importante para los futuros pasos de la instalación. Bien, esta
es la primera vez que tu elección define los siguientes pasos.
</p>

<ul>
<li>
  Si eliges <e>stage1</e>, debes seguir <e>los dos</e> pasos de
  este capítulo (empezando con <uri link="#doc_chap3">Pasando desde stage1
  a stage2</uri>)
</li>
<li>
  Si eliges el <e>stage2</e> puedes saltarte el primer paso
  y empezar inmediatamente con el segundo (<uri link="#doc_chap4">Pasando
  desde stage2 a stage3</uri>)
</li>
<li>
  Si elige <e>stage3</e> puede saltarse este paso y continuar con la siguiente 
  sección: <uri link="?part=1&amp;chap=7">Configurando el Kernel</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Pasando del stage1 a stage2</title>
<subsection>
<title>Introducción a la instalación de la base del sistema (bootstrap)</title>
<body>

<p>
¿Así que quiere compilar todo desde cero? Muy bien, vamos a ello :)
</p>

<p>
En este paso, instalaremos la base del sistema (en inglés conocido con el 
verbo <e>bootstrap</e>). 
Tardará bastante tiempo, pero el resultado es un sistema que está optimizado 
específicamente para su máquina y sus necesidades desde la base.
</p>

<p>
Instalar la base del sistema implica : compilar la librería GNU C, la 
colección de compiladores GNU y otros programas del sistema.
</p>

<p>
Antes de empezar a instalar la base del sistema, quizá quiera descargar 
primero todo el código fuente necesario. Si no quiere hacer esto, continué
con <uri link="#bootstrap">Instalando la base del sistema (bootstrap)</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Descargar primero el código fuente</title>
<body>

<p>
Si no ha copiado todo el código fuente anteriormente, el script
bootstrap descargará todos los archivos necesarios. Si quiere descargar 
primero el código fuente y después instalar la base del sistema (por si
no quiere tener la conexión a Internet abierta durante la compilación) 
use la opción <e>-f</e> del script bootstrap, la cual descargará todo el 
código fuente  (la letra 'f' viene del verbo ingles fetch = "ir a buscar").
</p>

<pre caption = "Descargando el código fuente necesario">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Instalando la base del sistema (bootstrap)</title>
<body>

<p>
Bien, coja el teclado y teclee los siguientes comandos para empezar
la instalación. Mientras, distráigase con alguna cosa porque este paso 
tardará un ratito largo.
</p>

<pre caption = "Instalando la base del sistema">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Siga con <uri link="#doc_chap4">Pasando de stage2 a stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Pasando desde stage2 a stage3</title>
<subsection>
<title>Introducción</title>
<body>

<p>
Si está leyendo esta sección, significa que tiene un sistema con la 
instalación de la base realizada (ya sea porque lo hizo anteriormente o porque
esté usando el <e>stage2</e>). Es el momento de compilar todos los
paquetes del sistema.
</p>

<p>
¿<e>Todos</e> los paquetes del sistema? Realmente no. En este paso compilará
los paquetes del sistema para los cuales no hay otra alternativa a usar.
Algunos paquetes del sistema tienen varias alternativas (como los
gestores de registro del sistema) y Gentoo da la oportunidad de
elegir, no queremos forzarle a usar uno.
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Viendo que va a suceder</title>
<body>

<p>
Si quiere saber que paquetes serán instalados, ejecute <c>emerge
--pretend --emptytree system</c>. Esto le mostrará un listado con todos los 
paquetes que serán compilados. Como esta lista es algo extensa, puede 
usar un paginador como <c>less</c> o <c>more</c> para moverse por ella.
</p>

<pre caption = "Ver que hará 'emerge system'">
# <i>emerge --pretend --emptytree system | less</i>
</pre>

<p>
Tenga en cuenta que, si no ha tocado la configuración por defecto de 
CFLAGS/CXXFLAGS, utilizar <c>emerge --pretend --newuse system</c> es 
suficiente: esto volverá a compilar las aplicaciones que se vean
afectadas por algun cambio en los parámetros USE (comparando con las
USE que nosotros utilizamos para crear el stage2). Si tampoco ha tocado 
la configuración de la variable USE flag, 
¿Por qué está llevando a cabo una instalación desde el stage2?
</p>

</body>
</subsection>
<subsection>
<title>Opcional: Descargando el código fuente</title>
<body>

<p>
Si lo desea,  <c>emerge</c> puede descargar todo el código fuente 
antes de continuar (por si no quiere tener le conexión activa mientras 
compilas el sistema). Puede usar la opción <e>--fetchonly</e> de <c>emerge</c> 
la cual descargará todo el código fuente por usted.
</p>

<pre caption = "Descargando el código fuente">
# <i>emerge --fetchonly --emptytree system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Compilando el sistema</title>
<body>

<p>
Para empezar a compilar el sistema, ejecuta  <c>emerge --emptytree system</c>. 
Ahora puede hacer cualquier cosa para mantener su mente ocupada 
(como leer), porque este paso tardará un buen rato en terminar.
</p>

<pre caption = "Compilando el Sistema">
# <i>emerge --emptytree system</i>
</pre>

<p>
De nuevo, si no ha tocado la configuración predeterminada de CFLAGS y CXXFLAGS, 
utilizar  <c>--newuse</c> es suficiente.
</p>

<p>
Puede, por ahora, ignorar tranquilamente cualquier aviso sobre la 
actualización de los archivos de configuración (y la ejecución de 
<c>etc-update</c>). Cuando su sistema Gentoo esté completamente
instalado y funcionando, por favor lea nuestra documentación sobre
<uri link="?part=2&amp;chap=4#doc_chap1">Protección de archivos 
de configuración</uri>.
</p>

<p>
Cuando la compilación haya concluido, continúe con <uri
link="?part=1&amp;chap=7">Configurando el Kernel</uri>.
</p>

</body>
</subsection>
</section>

</sections>
