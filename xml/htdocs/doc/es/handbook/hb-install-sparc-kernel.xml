<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/hb-install-sparc-kernel.xml,v 1.3 2006/05/22 21:55:54 yoswink Exp $ -->

<sections>

<version>2.7</version>
<date>2006-01-06</date>

<section>
<title>Zona horaria</title>
<body>

<p>
Primero necesita seleccionar su zona horaria para que su sistema sepa dónde
está localizado. Busque su zona horaria en
<path>/usr/share/zoneinfo</path>, luego cópielo a <path>/etc/localtime</path>.
Por favor, evite las zonas horarias <path>/usr/share/zoneinfo/Etc/GMT*</path>
ya que los nombres no indican las zonas esperadas. Por ejemplo,
<path>GMT-8</path> es realmente GMT+8.
</p>

<pre caption="Configurar la Zona Horaria">
# <i>ls /usr/share/zoneinfo</i>
<comment>(Suponga que quiere usar GMT)</comment>
# <i>cp /usr/share/zoneinfo/GMT /etc/localtime</i>
</pre>
</body>
</section>

<section>
<title>Instalar las fuentes</title>
<subsection>
<title>Elegir un núcleo</title>
<body>

<p>
El punto alrededor del cual se construyen todas las distribuciones es
el núcleo (kernel) de Linux. Es la capa entre los programas de usuario y el
hardware del sistema. Gentoo proporciona a sus usuarios varias fuentes del
núcleo. Una lista completa está disponible en la <uri
link="/doc/es/gentoo-kernel.xml">Guía Gentoo del Núcleo</uri>.
</p>

<p>
Para los sistemas basados en sparc tenemos <c>sparc-sources</c> (fuentes del
núcleo optimizadas para usuarios de SPARC) y <c>vanilla-sources</c> (las fuentes
predeterminadas del núcleo creadas por los desarrolladores del núcleo de Linux).
</p>

<p>
Escoja sus fuentes del núcleo e instálelas usando <c>emerge</c>.
</p>

<p>
En el siguiente ejemplo, instalaremos <c>sparc-sources</c>. Desde luego,
substituya las fuentes del núcleo con aquella de su preferencia, esto es un
ejemplo. El parámetro <c>USE="-doc"</c> es necesario para evitar la instalación
de xorg-x11 u otras dependencias en este momento. El parámetro
<c>USE="symlink"</c> no es necesario en una instalación nueva, pero asegura la
correcta creación del enlace simbólico<path>/usr/src/linux</path>:
</p>

<pre caption="Instalar las fuentes del núcleo">
# <i>USE="-doc symlink" emerge sparc-sources</i>
</pre>

<p>
Cuando vea en <path>/usr/src</path> verá un enlace simbólico llamado
<path>linux</path> apuntando a las fuentes de su núcleo. En este caso,
asumimos que la fuentes del kernel instaladas apuntan a
<c>sparc-sources-2.4.31</c>. Su versión podría ser distinta, así
que por favor tenga esto presente:
</p>

<pre caption="Ver el enlace a las fuentes del núcleo">
# <i>ls -l /usr/src/linux</i>
lrwxrwxrwx    1 root     root        12 Oct 13 11:04 /usr/src/linux -&gt; linux-2.4.31-sparc
</pre>

<p>
Ahora vamos a configurar y compilar las fuentes del núcleo.
</p>
</body>
</subsection>
</section>

<section>
<title>Configuración manual</title>
<subsection>
<title>Introducción</title>
<body>

<p>
Configurar manualmente un núcleo frecuentemente se ve como el procedimiento
más difícil que tiene que realizar un usuario de Linux. Nada mas lejos de la
verdad -- después de configurar un par de núcleos no recordará si fue difícil ;)
</p>

<p>
Sin embargo, una cosa <e>es</e> cierta: debe conocer su sistema cuando empiece
a configurar su núcleo manualmente. Se puede recolectar mucha información
instalando pciutils (<c>emerge pciutils</c>) el cual contiene <c>lspci</c>.
Ahora será capaz de utilizar <c>lspci</c> en el entorno enjaulado (chrooted).
Puede ignorar tranquilamente los avisos sobre <e>pcilib</e> (como pcilib:
cannot open /sys/bus/pci/devices) que <c>lspci</c> le muestre. Alternativamente,
puede ejecutar <c>lspci</c> desde un entorno <e>no-enjaulado</e>. Los
resultados son los mismos. También puede ejecutar <c>lsmod</c> para ver qué
módulos del núcleo usa el CD de instalación (puede proporcionarle buenos
consejos sobre qué habilitar).
</p>

<p>
Ahora vaya al directorio de sus fuentes y ejecute <c>make menuconfig</c>. Esto
abrirá un menú de configuración basado en ncurses.
</p>

<pre caption="Invocar a menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Le darán la bienvenida varias secciones de configuración. Listaremos primero
algunas opciones que debe activar (de otro modo Gentoo no funcionará, o no
funcionará adecuadamente sin configuración adicional).
</p>
</body>
</subsection>

<subsection>
<title>Activar las opciones necesarias</title>
<body>

<p>
Primero que nada, active el uso de código y drivers en desarrollo y
experimentales. Esto es necesario, porque algunos drivers o código
importante no se verán:
</p>

<pre caption="Seleccionar código/drivers experimentales">
Code maturity level options ---&gt;
  [*] Prompt for development and/or incomplete code/drivers
</pre>

<p>
Vaya ahora a <c>File Systems</c> y seleccione soporte para los
sistemas de ficheros que use. <e>No</e> los compile como módulos, de
otro modo su sistema Gentoo no será capaz de montar sus particiones.
También seleccione <c>Virtual memory</c> y el <c>/proc file
system</c>. Si utiliza un núcleo 2.4, necesita seleccionar <c>/dev
file system</c> y <c>Automatically mount at boot</c>:
</p>

<pre caption="Seleccionar los sistemas de ficheros necesarios">
<comment>(Con núcleos 2.4.x)</comment>
File systems ---&gt;
  [*] Virtual memory file system support (former shm fs)
  [*] /proc file system support
  [*] /dev file system support (EXPERIMENTAL)
  [*]   Automatically mount at boot
  [ ] /dev/pts file system for Unix98 PTYs

<comment>(Con núcleos 2.6.x)</comment>
File systems ---&gt;
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [*] Virtual memory file system support (former shm fs)

<comment>(Seleccione una o mas de las siguientes opciones según las necesite su
sistema)</comment>
  &lt; &gt; Reiserfs support
  &lt;*&gt; Ext3 journalling file system support
  &lt; &gt; JFS filesystem support
  &lt;*&gt; Second extended fs support
  &lt; &gt; XFS filesystem support
</pre>

<p>
Si está usando PPPoE para conectarse a Internet o está usando un módem dial-up,
necesitará las siguientes opciones en el núcleo:
</p>

<pre caption="Seleccionar los drivers PPPoE necesarios">
<comment>(Con un núcleo 2.4.x)</comment>
Network device support ---&gt;
  &lt;*&gt; PPP (point-to-point protocol) support
  &lt;*&gt;   PPP support for async serial ports
  &lt;*&gt;   PPP support for sync tty ports

<comment>(Con un núcleo 2.6.x)</comment>
Device Drivers ---&gt;
  Networking support ---&gt;
    &lt;*&gt; PPP (point-to-point protocol) support
    &lt;*&gt;   PPP support for async serial ports
    &lt;*&gt;   PPP support for sync tty ports
</pre>

<p>
Las dos opciones de compresión no lo afectan pero no son necesarias, ni para la
opción<c>PPP over Ethernet</c>, tal vez sólo sea usada por <c>rp-pppoe</c>
cuando configure un núcleo en modo PPPoE.
</p>

<p>
Si lo requiere, no olvide incluir el soporte en el núcleo para su tarjeta
ethernet.
</p>

<p>
Ahora active el soporte de bus adecuado:
</p>

<pre caption="Activar el SBUS/UPA">
Console drivers ---&gt;
  Frame-buffer support ---&gt;
    [*] SBUS and UPA framebuffers
      [*] Creator/Creator3D support <comment>(Sólo para "UPA slot adapter" usado en muchas Ultras)</comment>
    [*] CGsix (GX,TurboGX) support  <comment>(Sólo para "SBUS slot adapter" usado en muchas SPARCStations)</comment>
</pre>

<p>
Desde luego que debe habilitar el soporte para OBP:
</p>

<pre caption="Activar el soporte para OBP">
Misc Linux/SPARC drivers ---&gt;
  [*]  /dev/openprom device support
</pre>

<p>
También tendrá que habilitar el soporte a drivers específicos SCSI:
</p>

<pre caption="Activar el soporte de dispositivos específicos SCSI">
SCSI support ---&gt;
  SCSI low-level drivers ---&gt;
    &lt;*&gt; Sparc ESP Scsi Driver             <comment>(Sólo para el adaptador SCSI integrado SPARC ESP)</comment>
    &lt;*&gt; PTI Qlogic, ISP Driver            <comment>(Sólo para controladoras SCSI SBUS de PTI o QLogic)</comment>
    &lt;*&gt; SYM53C8XX Version 2 SCSI support  <comment>(Sólo para adaptador SCSI integrado Ultra 60)</comment>
</pre>

<p>
Para dar soporte a su tarjeta de red, seleccione una de las siguientes:
</p>

<pre caption="Activar el soporte de red">
Network device support ---&gt;
  Ethernet (10 or 100Mbit) ---&gt;
    &lt;*&gt; Sun LANCE support                   <comment>(Sólo para SPARCStation, sistemas antiguos Ultra y como opción Sbus)</comment>
    &lt;*&gt; Sun Happy Meal 10/100baseT support  <comment>(Sólo para Ultra; también soporta "qfe" quad-ethernet en PCI y Sbus)</comment>
    &lt;*&gt; DECchip Tulip (dc21x4x) PCI support <comment>(Para algunas Netras, como la N1)</comment>
  Ethernet (1000Mbit) ---&gt;
    &lt;*&gt; Broadcom Tigon3 support <comment>(Netra modernas, máquinas Sun Fire)</comment>
</pre>

<p>
Si tiene una máquina con 4 puertos ethernet (10/100 o 10/100/1000), el orden de
los puertos es diferente del que usa Solaris. Puede usar <c>sys-apps/ethtool</c>
o <c>mii-tool</c> para chequear el estatus del puerto.
</p>

<p>
Cuando haya terminado de configurar el núcleo, continúe con <uri
link="#compiling">Compilar e instalar</uri>. Sin embargo, luego de haber
compilado el núcleo, revise su tamaño:
</p>

<pre caption="Chequear el tamaño del núcleo">
# <i>ls -lh vmlinux</i>
-rw-r--r--    1 root     root         2.4M Oct 25 14:38 vmlinux
</pre>

<p>
Si el tamaño del fichero (descomprimido) es mayor que 2,5 MB (para Sparc32) o
3,5 MB (para Sparc64), reconfigure el núcleo hasta que este no exceda estos
límites. Una forma de lograr esto es compilando la mayor parte de los drivers
del núcleo como módulos. Ignorar esto puede que resulte en un núcleo incapaz
de arrancar.
</p>

<note>
Si usa el núcleo 2.6.3 o superior, entonces los núcleos sparc64 puede ser gasta
de 7,5 MB.
</note>

<p>
También, si el núcleo es ligeramente más grande, puede intentar reducirlo
usando el comando <c>strip</c>:
</p>

<pre caption="Reducir el tamaño del núcleo">
# <i>strip -R .comment -R .note vmlinux</i>
</pre>

</body>
</subsection>
<subsection id="compiling">
<title>Compilar e instalar</title>
<body>

<p>
Ahora que ya está configurado el núcleo, es hora de compilarlo e instalarlo.
Salga de la configuración y comience con el proceso de compilación:
</p>

<pre caption="Compilar el núcleo">
<comment>(Para un núcleo 2.4, sparc32)</comment>
# <i>make dep &amp;&amp; make clean vmlinux modules modules_install</i>

<comment>(Para un núcleo 2.4, sparc64)</comment>
# <i>make dep &amp;&amp; make clean vmlinux image modules modules_install</i>

<comment>(Para un núcleo 2.6, sparc32)</comment>
# <i>make &amp;&amp; make modules_install</i>

<comment>(Para un núcleo 2.6, sparc64)</comment>
# <i>make &amp;&amp; make image modules_install</i>
</pre>

<p>
Cuando el núcleo ha terminado de compilar, copie la imagen del núcleo a
<path>/boot</path>. Recuerde reemplazar <path>&lt;kernel-version&gt;</path> con
el nombre y versión de su núcleo verdadero.
</p>

<pre caption="Instalar el núcleo">
<comment>(Para un núcleo 2.4, sparc32)</comment>
# <i>cp vmlinux /boot/&lt;kernel-version&gt;</i>

<comment>(Para un núcleo 2.4, sparc64)</comment>
# <i>cp arch/sparc64/boot/image /boot/&lt;kernel-version&gt;</i>

<comment>(Para un núcleo 2.6, sparc32)</comment>
# <i>cp arch/sparc/boot/image /boot/&lt;kernel-version&gt;</i>

<comment>(Para un núcleo 2.6, sparc64)</comment>
# <i>cp arch/sparc64/boot/image /boot/&lt;kernel-version&gt;</i>
</pre>

<p>
Ahora continúe con <uri link="#kernel_modules">Instalar módulos separados del
núcleo</uri>.
</p>
</body>
</subsection>
</section>

<section id="kernel_modules">
<title>Instalar módulos separados del núcleo</title>
<subsection>
<title>Configurar los módulos</title>
<body>

<p>
Debe listar los módulos que quiera cargar automáticamente en
el fichero <path>/etc/modules.autoload.d/kernel-2.4</path> (o
<path>kernel-2.6</path>). Puede añadir opciones adicionales a los módulos si
lo desea.
</p>

<p>
Para ver todos los módulos disponibles, ejecute el comando <c>find</c>. No
olvide sustituir "&lt;versión del núcleo &gt;" con la versión del núcleo que
acaba de compilar:
</p>

<pre caption="Ver todos los módulos disponibles">
# <i>find /lib/modules/&lt;versión del núcleo&gt;/ -type f -iname '*.o' -or -iname '*.ko'</i>
</pre>

<p>
Por ejemplo, para cargar automáticamente el módulo <c>3c59x.o</c>,
edite el fichero <path>kernel-2.4</path> o <path>kernel-2.6</path> y
escriba el nombre del módulo ahí.
</p>

<pre caption="Editar /etc/modules.autoload.d/kernel-2.4">
<comment>(Ejemplo para núcleos 2.4)</comment>
# <i>nano -w /etc/modules.autoload.d/kernel-2.4</i>
</pre>

<pre caption="/etc/modules.autoload.d/kernel-2.4 o kernel-2.6">
3c59x
</pre>

<p>
Continúe la instalación con <uri link="?part=1&amp;chap=8">Configurar su
sistema</uri>
</p>

</body>
</subsection>
</section>
</sections>
