<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<sections>

<version>1.1</version>
<date>2005-06-14</date>

<section>
<title>Módulos de Red</title>
<body>

<p>
Ahora tenemos soporte para guiones de red, lo cual significa que podemos
facilmente añadir soporte para nuevos tipos de interfaces y módulos de 
configuración mientras mantenemos la compatibilidad con los actuales.
</p>

<p>
Los módulos se cargan por defecto si el paquete que los requiere está instalado.
Si especifica un modulo aquí que no tiene su paquete instalado, entonces
obtendrá un error acerca del paquete que necesita instalar. Lo ideal sería
que solamente use la configuración con módulos si tiene dos o
más paquetes que proporcionen el mismo servicio y necesita marcar su 
preferencia de uno sobre los otros.
</p>

<pre caption="Preferencias en los módulos">
<comment># Preferir iproute2 sobre ifconfig</comment>
modules=( "iproute2" )

<comment># También se puede especificar otros módulos para una interfaz
# En este caso preferimos a udhcpc sobre dhcpcd</comment>
modules_eth0=( "udhcpc" )

<comment># También podemos especificar modulos que no queremos utilizar -
# por ejemplo, puede querer utilizar un suplicante o linux-wlang-ng
# para controlar la configuración inalámbrica, pero querer seguir
# configurando la red por ESSID asociado.</comment>
modules=( "!iwconfig" )
</pre>
</body>
</section>

<section>
<title>Manejadores de interfaces</title>
<body>

<p>
Proporcionamos dos manejadores de interfaces: ifconfig e iproute2.
Hará falta uno de estos para cualquier tipo de configuración
de red.
</p>

<p>
El ifconfig es utilizado por defecto en Gentoo y se incluye en el
perfil del sistema. El iproute2 es un paquete más potente y flexible pero
no se incluye por defecto.
</p>

<pre caption="Para instalar iproute2">
# <i>emerge sys-apps/iproute2</i>

<comment># Para preferir iproute2 sobre ifconfig si ambos están instalados</comment>
modules=( "iproute2" )
</pre>

<p>
Ya que ifconfig e iproute2 hacen cosas muy parecidas, nos permitimos
usar la misma configuración básica para ambos. Los ejemplos a
continuación funcionarán sin importar cuál módulo tenga instalado.
</p>

<pre caption="Ejemplos de ifconfig e iproute2">
config_eth0=( "192.168.0.2/24" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0" )

<comment># También podemos especificar la dirección de difusión</comment>
config_eth0=( "192.168.0.2/24 brd 192.168.0.255" )
config_eth0=( "192.168.0.2 netmask 255.255.255.0 broadcast 192.168.0.255" )
</pre>
</body>
</section>

<section id="dhcp">
<title>DHCP</title>
<body>

<p>
El DHCP es un medio para obtener información de red (dirección IP,
servidores DNS, puerta de enlace, etc) de un servidor DHCP. Si existe
un servidor DHCP en su red, apenas tendrá que decirle a cada cliente que 
utilice DHCP y el servidor se encargará de configurar el resto. Por
supuesto, tendrá que configurar otras cosas la red inalámbrica, el
ppp, etc. u otros si hacen falta antes de poder utilizar DHCP.
</p>

<p>
DHCP puede ser proporcionado por: dhclient, dhcpcd, dhclient, pump or udhcpc. 
Cada módulo DHCP tiene sus propios pros y contras - aquí tiene un pequeño 
resumen:
</p>

<table>
  <tr>
    <th>Módulo DHCP</th>
    <th>Paquete</th>
    <th>Pros</th>
    <th>Contras</th>
  </tr>
  <tr>
    <ti>dhclient</ti>
    <ti>net-misc/dhcp</ti>
    <ti>
        Creado por la ISC, la misma gente que hacen el software dns BIND<br />
	Muy configurable
    </ti>
    <ti>
        Configuración excesivamente complicada<br />
	Software bastante hinchado<br />
	No se puede obtener servidores NTP desde DHCP<br />
	No envía el nombre de host por defecto
    </ti>
  </tr>
  <tr>
    <ti>dhcpcd</ti>
    <ti>net-misc/dhcpcd</ti>
    <ti>
        Durante largo tiempo ha sido la opción por defecto de Gentoo<br />
	No depende de herramientas externas
    </ti>
    <ti>
        Ya no es mantenido por los desarrolladores<br />
	Puede ser lento en ocasiones<br />
	No pasa a segundo plano si el lapso de arrendamiento es infinito
    </ti>
  </tr>
  <tr>
    <ti>pump</ti>
    <ti>net-misc/pump</ti>
    <ti>
        Ligero<br />
	No depende de herramientas externas
    </ti>
    <ti>
        Ya no es mantenido por los desarrolladores<br />
	No es fiable, especialmente a través de modems<br />
	No se puede obtener servidores de NIS desde DHCP
    </ti>
  </tr>
  <tr>
    <ti>udhcpc</ti>
    <ti>net-misc/udhcp</ti>
    <ti>
        Ligero - el cliente más pequeño de dhcp<br />
	Creado para sistemas embebidos
    </ti>
    <ti>
        No muy probado - ninguna distribución lo usa por defecto<br />
	No puede definir un tiempo de espera (timeout) mayor de 3 segundos
    </ti>
  </tr>
</table>
     
<p>
Si tiene más de un cliente DHCP instalado, hará falta
especificar cuál utilizar - sino, utilizaremos dhcpcd por
defecto, si está disponible.
</p>

<p>
Para enviar opciones específicas al módulo dhcp, utilizamos 
module_eth0="..." <e>(cambie "module" por el nombre del módulo dhcp
que vaya a utilizar - por ejemplo: dhcpcd_eth0)</e>.
</p>

<p>
Tratamos que el servicio DHCP sea relativamente agnóstico,
de manera que soportamos los siguientes comandos usando la variable
dhcp_eth0. Por defecto no se configuran ninguno de ellos.
</p>

<ul>
  <li>release - suelta la dirección IP para ser re-utilizada</li>
  <li>nodns - no sobre-escriba el /etc/resolv.conf</li>
  <li>nontp - no sobre-escriba el /etc/ntp.conf</li>
  <li>nonis - no sobre-escriba el /etc/yp.conf</li>
</ul>

<pre caption="Ejemplo de configuración DHCP en /etc/conf.d/net">
<comment># Solamente necesita hacerlo si tiene más de un módulo 
instalado</comment>
modules=( "dhcpcd" ) 

config_eth0=( "dhcp" )
dhcpcd_eth0="-t 10" <comment># Espera agotada (timeout) después de 10 
segundos</comment>
dhcp_eth0="release nodns nontp nonis" <comment># Solamente obtenga la 
dirección IP</comment>
</pre>

<note>
dhcpcd, udhcpc y pump envían el nombre de máquina al servidor DHCP por
defecto así que no necesita especificarlo más.
</note>
</body>
</section>

<section>
<title>Modem ADSL</title>
<body>

<p>
Primero necesitamos instalar el software ADSL.
</p>

<pre caption="Instalar el paquete rp-pppoe">
# <i>emerge net-dialup/rp-pppoe</i>
</pre>

<warn>
baselayout-1.11.x solamente soporta PPPOE.<br/>
Esperamos soportar PPPOA en futuras versiones.<br/>
</warn>

<p>
Ahora necesitamos configurar eth0 para que sea una interfaz ADSL e 
introducir nuestro nombre de usuario.
</p>

<pre caption="Configurar eth0 para ADSL">
config_eth0=( "adsl" )
user_eth0="nombre-usuario"
</pre>

<p>
Finalmente, necesitamos definir nuestro nombre de usuario y contraseña
en <path>/etc/ppp/pap-secrets</path>
</p>

<pre caption="ejemplo /etc/ppp/pap-secrets">
<comment># Ojo: el * es importante</comment>
"nombre-usuario"	*	"contraseña"
</pre>
</body>
</section>

<section id="apipa">
<title>APIPA Direccionamiento Privado Automático (Automatic Private IP Addressing)</title>
<body>

<p>
APIPA intenta encontrar una dirección libre en el rango
169.254.0.0-169.254.255.255 haciendo arping a direcciones aleatorias
en ese rango para el interfaz. Si no se obtiene respuesta, se asigna
esa dirección al interfaz.
</p>

<p>
Esto es útil solamente en redes donde no hay servidor DHCP y no hay
conexión directa al Internet y que todos los demás computadores
también usen APIPA.
</p>

<p>
Para soporte APIPA, haga emerge net-misc/iputils o net-analyzer/arping.
</p>

<pre caption="Configuración de APIPA en /etc/conf.d/net">
<comment># Intentar DHCP primero - y si falla, entonces usar APIPA</comment>
config_eth0=( "dhcp" )
fallback_eth0=( "apipa" )

<comment># Usar únicamente APIPA</comment>
config_eth0=( "apipa" )
</pre>
</body>
</section>

<section>
<title>Bonding</title>
<body>

<p>
Para unir enlaces con bonding/trunking haga emerge net-misc/ifenslave.
</p>

<p>
El "bonding" se utiliza para aumentar el ancho de banda hacia la red. Si
tiene dos interfaces que van a usar la misma red, puede unirlos (bond,
en inglés) para que las aplicaciones vean solo uno, pero que
en realidad usa ambos interfaces.
</p>

<pre caption="Configuración del bonding en /etc/conf.d/net">
<comment>Para unir dos interfaces</comment>
slaves_bond0="eth0 eth1 eth2"

<comment># Tal vez no quiera asignarle dirección IP al interfaz conjunto</comment>
config_bond0=( "null" )

<comment># Depend de eth0, eth1 y eth2, ya que podría requerir
configuración adicional</comment>
depend_bond0() {
	need net.eth0 net.eth1 net.eth2
}
</pre>
</body>
</section>

<section>
<title>Puentes (soporte para 802.1d)</title>
<body>

<p>
Para soportar puentes, haga emerge net-misc/bridge-utils.
</p>

<p>
Los puentes se usan para unir redes. Por ejemplo, puede tener un
servidor conectando al internet vía modem ADSL y una tarjeta
inalámbrica para que otros computadores se conecten al
internet por medio del modem ADSL. Se puede crear un puente para unir
ambos interfaces.
</p>

<pre caption="Configurando un puente en /etc/conf.d/net">
<comment># Configure el puente - para más detalles: "man btctl"</comment>
brctl_br0=( "setfd 0" "sethello 0" "stp off" )

<comment># Para agregar puertos al puente br0</comment>
bridge_br0="eth0 eth1"

<comment># Hará falta configurar los puertos a valores nulos para no
iniciar dhcp</comment>
config_eth0=( "null" )
config_eth1=( "null" )

<comment># Finalmente, déle una dirección al puente - para esto puede usar DHCP también</comment>
config_br0=( "192.168.0.1/24" )

<comment># Depend de eth0 y eth1 ya que pueden requerir configuración adicional</comment>
depend_br0() {
	need net.eth0 net.eth1
}
</pre>

<impo>
Para usar algunas configuraciones de puente, tal vez tenga que
consultar la documentación de <uri
link="?part=3&amp;chap=2#variable_name">Configuración por medio de
variables</uri>.
</impo>
</body>
</section>

<section>
<title>Dirección MAC</title>
<body>

<p>
No hace falta hacer emerge para poder cambiar la dirección MAC de un
interfaz a otra específica. Sin embargo, si necesita cambiarlo a
una dirección aleatoria o una dirección aleatoria de un tipo
determinado, entonces necesitará hacer emerge
net-analyzer/macchanger.
</p>

<pre caption="Ejemplo de cambio de una dirección MAC">
<comment># Establecer una dirección MAC de un interfaz</comment>
mac_eth0="00:11:22:33:44:55"

<comment># Para cambiar aleatoriamente solo los últimos 3 bytes</comment>
mac_eth0="random-ending"

<comment># Para cambiar aleatoriamente entre tipos de conexión
# físicamente iguales (por ejemplo: fibra óptica, cobre, inalámbrica),
# para todos los proveedores</comment>
mac_eth0="random-samekind"

<comment># Para cambiar aleatoriamente entre cualquier tipo físico de
# conexión (por ejemplo fibra óptica, cobre, inalámbrica),
# para todos los proveedores</comment>
mac_eth0="random-anykind"

<comment># Generación completamente aleatoria -
# ADVERTENCIA: algunas direcciones MAC generadas de esta manera
# tal vez NO se comporten de la forma esperada</comment>
mac_eth0="random-full"
</pre>
</body>
</section>

<section>
<title>Haciendo túneles</title>
<body>

<p>
No se requiere hacer emerge de paquete alguno para túneles, ya que el
manejador del interfaz se encarga de esto.
</p>

<pre caption="Configuración de túneles en /etc/conf.d/net">
<comment># Para túneles GRE</comment>
iptunnel_vpn0="mode gre remote 207.170.82.1 key 0xffffffff ttl 255"

<comment># Para túneles IPIP</comment>
iptunnel_vpn0="mode ipip remote 207.170.82.2 ttl 255"

<comment># Para configurar el interfaz</comment>
config_vpn0=( "192.168.0.2 peer 192.168.1.1" ) 
</pre>
</body>
</section>

<section>
<title>VLAN (soporte para 802.1q)</title>
<body>

<p>
Para soporte VLAN, haga emerge net-misc/vconfig.
</p>

<p>
Las redes virtuales son un grupo de dispositivos de red que se
comportan comno si estuviesen conectados a un solo segmento de red -
aunque no lo estén. Miembros de una VLAN solo pueden ver miembros de
la misma VLAN, aunque no compartan la misma red física.
</p>

<pre caption="Configuración de VLANs en /etc/conf.d/net">
<comment># Especificar los números de las VLAN para el interfaz así</comment>
<comment># Por favor asegurar que los ID de las VLANs
# NO tengan ceros a la izquierda</comment>
vlans_eth0="1 2"

<comment># También se puede configurar la VLAN</comment>
<comment># vea la página man de vconfig para más detalles</comment>
vconfig_eth0=( "set_name_type VLAN_PLUS_VID_NO_PAD" )
vconfig_vlan1=( "set_flag 1" "set_egress_map 2 6" )

<comment># Configure el interfaz como siempre</comment>
config_vlan1=( "172.16.3.1 netmask 255.255.254.0" )
config_vlan2=( "172.16.2.1 netmask 255.255.254.0" )
</pre>

<impo>
Para usar algunas configuraciones de VLAN, tal vez haga falta
consultar la documentación de <uri
link="?part=3&amp;chap=2#variable_name">Configuración por medio de
variables</uri>.
</impo>
</body>
</section>
</sections>
