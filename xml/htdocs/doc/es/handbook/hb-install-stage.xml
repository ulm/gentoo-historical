<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/hb-install-stage.xml,v 1.30 2006/12/30 20:28:20 chiguire Exp $ -->

<sections>

<abstract>
Las instalaciones Gentoo funcionan por medio de un archivo stage3. En
este capítulo describimos como descomprimir el archivo stage3 y
configurar Portage.
</abstract>

<version>7.4</version>
<date>2006-11-01</date>

<section>
<title>Instalando el Stage comprimido (tarball)</title>
<subsection>
<title>Ajustar la Fecha/Hora correcta</title>
<body>

<p>
Antes de continuar debes revisar la fecha y la hora y
actualizarlos. Â¡Un reloj mal configurado puede traer
resultados extraÃ±os a futuro!
</p>

<p>
Para comprobar la fecha/hora actual, ejecute el comando <c>date</c>:
</p>

<pre caption="Verificar la fecha/hora">
# <i>date</i>
Fri Mar 29 16:21:18 UTC 2005
</pre>

<p>
Si la fecha/hora estÃ¡ equivocada, actualÃ­cela con el comando <c>date
MMDDhhmmAAAA</c>, con la siguiente sintaxis (<b>M</b>es, <b>D</b>Ã­a,
<b>h</b>ora, <b>m</b>inuto y <b>A</b>Ã±o). En este punto, se deberÃ­a usar
la hora UTC. PodrÃ¡ utilizar su propia zona horaria mÃ¡s adelante. Por
ejemplo, para ajustar la fecha y hora a las 16:21 horas del 29 de
marzo del 2005:
</p>

<pre caption="Ajustar la fecha/hora UTC">
# <i>date 032916212005</i>
</pre>

</body>
</subsection>
<subsection>
<title>Realizando su propia elecciÃ³n</title>
<body>

<p>
El prÃ³ximo paso a llevar a cabo es instalar el tarball del archivo
<e>stage3</e> escogido en su sistema. Tiene la opciÃ³n de descargarlo
del Internet o, si ha arrancado con un CD de instalaciÃ³n Universal,
cÃ³pielo del mismo CD. Si tiene el CD Universal y el stage que quiere
utilizar estÃ¡ en el CD, descargarlo desde Internet es un gasto de ancho
de banda innecesario, ya que las los archivos son los mismos. En la
mayorÃ­a de las ocasiones, el comando <c>uname -m</c> puede
ayudarle a decidir que archivo stage tiene que descargar.
</p>

<ul>
  <li>
    <uri link="#doc_chap2">Por defecto: Descargar los Stages de Internet</uri>
  </li>
  <li>
    <uri link="#doc_chap3">Alternativa: Usar el Stage desde el CD de i
    instalaciÃ³n</uri>
  </li>
</ul>

</body>
</subsection>
</section>

<section>
<title>Por defecto: Utilizar un Stage desde Internet</title>
<subsection>
<title>Descargando el Stage comprimido (tarball)</title>
<body>

<p>
Vete al punto de montaje de Gentoo en el que has montado los sistemas
de archivo (probablemente <path>/mnt/gentoo</path>):
</p>

<pre caption="Ir al punto de montaje de Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Dependiendo del medio de instalaciÃ³n, tendremos un par de herramientas
disponibles para descargar el stage. Si disponemos de  <c>links</c>,
podremos navegar por <uri link="/main/en/mirrors.xml">la lista de
servidores rÃ©plica de Gentoo</uri> y escoger el mÃ¡s cercano a
nosotros.
</p>

<p>
Si no tiene <c>links</c>, deberÃ­a disponer de <c>lynx</c>. Si necesita
pasar a travÃ©s de un proxy, exporte las variables <c>http_proxy</c> y
<c>ftp_proxy</c>:
</p>

<pre caption="Configurar la informaciÃ³n del proxy para lynx">
# <i>export http_proxy="http://proxy.server.com:port"</i>
# <i>export ftp_proxy="http://proxy.server.com:port"</i>
</pre>

<p>
A partir de ahora asumiremos que tiene <c>links</c> a su disposiciÃ³n.
</p>

<p>
Luego entre en el directorio <path>releases/</path> seguido de su arquitectura
(por ejemplo <path>x86/</path> y la versiÃ³n de Gentoo (<path>2006.1/</path>)
para finalizar con el directorio de los stages <path>stages/</path>. AllÃ­
deberÃ­an aparecer todos los archivos de stage disponibles para tu arquitectura.
Seleccione uno y presione <c>D</c> para descargarlo. Cuando se haya descargado,
presione <c>Q</c> para cerrar el navegador.
</p>

<pre caption="Navegar por la lista de servidores rÃ©plica con links">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>

<comment>(Si necesita soporte para proxy con links:)</comment>
# <i>links -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Conviene asegurarse de que ha descargado un archivo <b>stage3</b> - las
instalaciones utilizando un stage1 o stage2 no reciben soporte.
</p>

<p>
Si quiere comprobar la integridad del tarball de stage que ha descargado,
utilice <c>md5sum</c> y compare la salida con la suma de comprobaciÃ³n
MD5 que proporciona el servidor rÃ©plica. Por ejemplo, para comprobar
la validez del tarball de stage de x86:
</p>

<pre caption="Ejemplo de comprobaciÃ³n de integridad del tarball de stage">
# <i>md5sum -c stage3-x86-2006.1.tar.bz2.DIGESTS</i>
stage3-x86-2006.1.tar.bz2: OK
</pre>

</body>
</subsection>

<subsection>
<title>Extraer el Stage comprimido</title>
<body>

<p>
Ahora desempaquetamos el stage descargado en sistema. Usaremos
<c>tar</c> para dicha labor y este es el mÃ©todo mÃ¡s fÃ¡cil.
</p>

<pre caption="Descomprimir el Stage">
# <i>tar xvjpf stage3-*.tar.bz2</i>
</pre>

<p>
AsegÃºrate de usar las mismas opciones <c>xvjpf</c>). La <c>x</c> se usa para
<e>Desempaquetar</e>, la <c>v</c> (<e>Verbose</e>)para ver que pasa durante el
proceso de extracciÃ³n (opcional), la <c>j</c> para <e>Descomprimir con
bzip2</e>, la <c>p</c> para <e>Preservar los permisos</e> y la <c>f</c> para
decir que extraemos un archivo, no la entrada estÃ¡ndar.
</p>

<note>
Algunos CDs de instalaciÃ³n de algunas arquitecturas (e.j. MIPS) e imÃ¡genes
de arranque funcionan sobre <c>tar</c>compilado con BusyBox el cual
actualmente no soporta la opciÃ³n <c>v</c>. Utilice en su lugar las
opciones <c>xjpf</c>
</note>

<p>
Ahora que el stage estÃ¡ instalado sigamos con <uri
link="#installing_portage">Instalando Portage</uri>.
</p>

</body>
</subsection>
</section>

<section>
<title>Alternativa: Usar el Stage desde el CD de instalaciÃ³n</title>
<subsection>
<title>Extraer el Stage comprimido (tarball)</title>
<body>

<impo test="contains('AMD64 x86', func:keyval('arch'))">
Si estÃ¡ utilizando una arquitectura <keyval id="arch"/> y utilizando
el LiveCD instalador, <e>no</e> dispondrÃ¡ de stages en su CD. DeberÃ¡
seguir las instrucciones sobre
<uri link="#doc_chap2">Utilizar un Stage desde Internet</uri>.
</impo>

<p>
Los Stages en el CD estÃ¡n situados en el directorio
<path>/mnt/cdrom/stages</path>.  Para ver una lista de los Stages disponibles,
usa <c>ls</c>:
</p>

<pre caption="Listar todos los stages disponibles">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Si el sistema responde con un error, tal vez necesite montar el CD-ROM primero:
</p>

<pre caption="Montar el CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Ahora en tu punto de montaje de Gentoo (Normalmente <path>/mnt/gentoo</path>):
</p>

<pre caption="Cambianr el directorio a /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Ahora extraeremos el Stage comprimido que hayas elegido. Usaremos
<c>tar</c>  para dicha labor. Â¡AsegÃºrese de usar las mismas
opciones <c>xvjpf</c>)! Una vez mÃ¡s recordamos, el parÃ¡metro <c>v</c>
es opcional y puede no ser soportado por algunas versiones de <c>tar</c>.
En el siguiente ejemplo, extraeremos el Stage comprimido
<path>stage3-&lt;subarch&gt;-2006.1.tar.bz2</path>. AsegÃºrese de
sustituir el nombre por el de su stage.
</p>

<pre caption="Descomprimir el stage">
# <i>tar xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2006.1.tar.bz2</i>
</pre>

<p>
Ahora que tenemos el stage instalado, continuaremos con <uri
link="#installing_portage">Instalando Portage</uri>.
</p>

</body>
</subsection>
</section>
<section id="installing_portage">
<title>Instalando Portage</title>
<subsection>
<title>Instalando una imagen de Portage</title>
<body>

<p>
Ahora tiene que instalar una imagen de Portage, es un conjunto de archivos
que informan a Portage sobre los programas que puede instalar, que perfiles
estÃ¡n disponibles, etc.
</p>

</body>
</subsection>
<subsection id="installing_from_Internet">
<title>Descargar e instalar una imagen de Portage</title>
<body>

<p>
Vaya al punto de montaje donde tiene montado su sistema de ficheros
(normalmente <path>/mnt/gentoo</path>):
</p>

<pre caption="SituÃ¡ndose en el punto de montaje de Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Ejecute <c>links</c> (o <c>lynx</c>) y vaya a <uri
link="/main/en/mirrors.xml">la lista de servidores rÃ©plica de Gentoo</uri>.
Elija un servidor cercano y abra el directorio <path>snapshots/</path>. De
allÃ­ descargue la Ãºltima imagen de Portage
(<path>portage-latest.tar.bz2</path>), seleccionÃ¡ndola y presionando
<c>D</c>.
</p>

<pre caption="Comprobar la lista de servidores rÃ©plica de Gentoo">
# <i>links http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Ahora salga del navegador presionando <c>Q</c>. Ahora dispone de una imagen
de Portage guardada en <path>/mnt/gentoo</path>.
</p>

<p>
Si quiere comprobar la integridad de la imagen descargada, utilice
<c>md5sum</c> y compare la salida con la suma de comprobaciÃ³n MD5 que
proporciona el servidor rÃ©plica.
</p>

<pre caption="Comprobar la integridad de una imagen de Portage">
# <i>md5sum -c portage-latest.tar.bz2.md5sum</i>
portage-latest.tar.bz2: OK
 </pre>

<p>
En el siguiente paso, vamos a descomprimir la imagen de Portage en su sistema
de ficheros. AsegÃºrese de utilizar los comandos exactos; la Ãºltima opciÃ³n es
una <c>C</c> mayÃºscula, no una <c>c</c>.
</p>

<pre caption="Descomprimir la imagen de Portage">
# <i>tar xvjf /mnt/gentoo/portage-latest.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

</body>
</subsection>
</section>

<section id="compile_options">
<title>Configurando las opciones de compilaciÃ³n</title>
<subsection>
<title>IntroducciÃ³n</title>
<body>

<p>
Para optimizar Gentoo, tendrÃ¡s que ajustar un par de variables que
afectarÃ¡n el comportamiento de Portage. Todas estas variables se
pueden fijar como variables de entorno (usando <c>export</c>) pero eso
no es permanente. Para mantener tu configuraciÃ³n, Portage dispone de
<path>/etc/make.conf</path>, un fichero de configuraciÃ³n para
Portage. Este es el fichero que editaremos ahora.
</p>

<note>
Una lista comentada de todas las posibles variables puede
encontrarse en <path>/mnt/gentoo/etc/make.conf.example</path>. Para
una instalaciÃ³n de Gentoo correcta lo Ãºnico que necesita es configurar
las variables que se mencionan en las siguientes lÃ­neas.
</note>

<p>
Usa tu editor favorito (en esta guÃ­a nosotros usaremos <c>nano</c>. AsÃ­ que
empezamos con la modificaciÃ³n de las variables.
</p>

<pre caption="Abrir /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Como probablemente te darÃ¡s cuenta, el fichero <path>make.conf.example</path>
estÃ¡ estructurado de una manera genÃ©rica: Las lÃ­neas comentadas empiezan con
"#", otras lÃ­neas definen variables usando la sintaxis
<c>VARIABLE="contenido"</c>. El fichero <path>make.conf</path> utiliza la misma
sintaxis. Discutiremos muchas de esas variables mÃ¡s adelante.
</p>

</body>
</subsection>
<subsection>
<title>CHOST</title>
<body>

<p>
La variable <c>CHOST</c> declara el objetivo de compilaciÃ³n en su sistema.
Esta variable ya deberÃ­a estar configurada correctamente. <brite>No la
edite</brite> ya que puede romper el sistema. Si la variable <c>CHOST</c> no
le parece correcta, entonces quizÃ¡ este utilizando un archivo stage3
incorrecto.
</p>

</body>
</subsection>
<subsection>
<title>CFLAGS y CXXFLAGS</title>
<body>

<p>
Las variables <c>CFLAGS</c> y <c>CXXFLAGS</c>, definen los parÃ¡metros
de optimizaciÃ³n para el compilador de C y C++ de <c>gcc</c>
respectivamente. Aunque generalmente se definen aquÃ­, tendrÃ¡s el
mÃ¡ximo rendimiento si optimizas estos parÃ¡metros para cada programa
por separado. La razÃ³n es que cada programa es diferente.
</p>

<p>
En el fichero <path>make.conf</path> deberÃ¡s definir los parÃ¡metros de
optimizaciÃ³n que pienses que vayan a hacer tu sistema el mejor <e>en
todas las situaciones</e>. No coloques parÃ¡metros experimentales en
esta variable; un nivel demasiado alto de optimizaciÃ³n puede hacer que
los programas se comporten mal (cuelgues, o incluso peor,
funcionamientos errÃ³neos).
</p>

<p>
No explicaremos todas las opciones posibles para la optimizaciÃ³n. Pero
si quieres conocerlas todas, lÃ©ete <uri
link="http://www.gnu.org/software/gcc/onlinedocs/">El manual en lÃ­nea
de GNU</uri> o la pÃ¡gina informaciÃ³n de <c>gcc</c> (<c>info gcc</c> -- Solo
en un sistema Linux funcional). El fichero <path>make.conf</path>
tambiÃ©n contiene una gran cantidad de ejemplos e informaciÃ³n; no
olvides leerlo tambiÃ©n.
</p>

<p>
La primera variable es el parÃ¡metro <c>-march=</c>, que especifica el nombre
de la arquitectura seleccionada. Las posibles opciones estÃ¡n descritas en el
fichero <path>make.conf</path> (como comentarios). Por ejemplo, para la
arquitectura x86 Athlon XP:
</p>

<pre caption="El parÃ¡metro march de GCC">
-march=athlon-xp
</pre>

<p>
Seguida de esta, estÃ¡ el parÃ¡metro <c>-O</c>, que especifica la clase
optimizaciÃ³n de <c>gcc</c>. Las clases posibles son <c>s</c> (para
tamaÃ±o optimizado), <c>0</c> (para no optimizar), <c>1</c>, <c>2</c>
or <c>3</c> para la optimizaciÃ³n de velocidad (cada clase tiene los
mismos parÃ¡metros que la primera, mÃ¡s algunos extras). Por ejemplo
para una optimizaciÃ³n de clase 2:
</p>

<pre caption="El parÃ¡metro O de GCC">
-O2
</pre>

<p>
Otros parÃ¡metros de optimizaciÃ³n bastante populares son los
<c>-pipe</c> (usando tuberÃ­as en lugar de ficheros temporales para la
comunicaciÃ³n entre las diferentes etapas de compilaciÃ³n).
 </p>

<p>
Cuidado con utilizar <c>-fomit-frame-pointer</c> (el cual no mantiene
el puntero de macro en un registro para las funciones que no lo necesiten)
pues podrÃ­a tener graves repercusiones en la depuraciÃ³n de errores en
aplicaciones.
</p>

<p>
Cuando definimos las variables <c>CFLAGS</c> y <c>CXXFLAGS</c>,
deberÃ­as combinar algunos parÃ¡metros de optimizaciÃ³n, como en el
ejemplo siguiente:
</p>

<pre test="contains('Alpha arm HPPA IA64 MIPS PPC PPC64 SPARC x86', func:keyval('arch'))" caption="Definir las variables CFLAGS y CXXFLAG">
CFLAGS="-march=athlon-xp -pipe -O2"
CXXFLAGS="${CFLAGS}"                  <comment># Utilice la misma configuraciÃ³n para las dos variables.</comment>
</pre>

<pre test="func:keyval('arch')='AMD64'" caption="Definir las variables CFLAGS y CXXFLAGS">
CFLAGS="-march=athlon-xp -pipe -O2"   <comment># Los usuarios de AMD64 que queiran un sistema nativo de 64 bits deberÃ¡n utilizar -march=athlon64</comment>

                                      <comment># Los usuarios de EM64T deberÃ¡n utilizar -march=nocona</comment>
CXXFLAGS="${CFLAGS}"                  <comment>#Utilice la misma configuraciÃ³n para las dos variables.</comment>
</pre>

</body>
</subsection>

<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Con la variable <c>MAKEOPTS</c> definimos cuantas compilaciones
paralelas pueden hacerse al mismo tiempo cuando instalamos un
paquete. El nÃºmero sugerido es la cantidad de CPUs de tu sistema, mÃ¡s uno
</p>

<pre caption="MAKEOPTS para un sistema normal de 1-CPU">
MAKEOPTS="-j2"
</pre>

</body>
</subsection>
<subsection>
<title>Â¡Preparados, listos, ya!</title>
<body>

<p>
Actualiza tu <path>/mnt/gentoo/etc/make.conf</path> con tus propios
parÃ¡metros y guarda los cambios (<c>nano</c> users would hit <c>Ctrl-X</c>).
. Ahora estamos listos para continuarcon
<uri link="?part=1&amp;chap=6">Instalando el sistema base de Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>
