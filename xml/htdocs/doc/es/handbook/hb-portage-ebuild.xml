<?xml version = '1.0' encoding = 'UTF-8' ?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/Attic/hb-portage-ebuild.xml,v 1.2 2005/03/09 20:07:25 chiguire Exp $ -->

<sections>

<version>1.3</version>
<date>2004-10-24</date>

<section>
<title>Emerge y Ebuild</title>
<body>

<p>
El programa <c>ebuild</c> es un interfaz de bajo nivel para el sistema Portage. Usando esta aplicación se pueden ejecutar acciones en un determinado ebuild. Por ejemplo, uno mismo puede instalar un paquete paso a paso.
</p>

<p>
El uso de <c>ebuild</c> está más bien enfocado a los desarrolladores; por tanto, se puede encontrar más información acerca de <c>ebuild</c> en el <uri link="/proj/en/devrel/handbook/handbook.xml">Manual del desarrollador</uri> (en inglés). Sin embargo, nos será muy útil conocer las etapas por las que pasa Portage durante el proceso de instalación de un determinado paquete, y cómo llamar a los pasos de post-configuración que algunos ebuilds permiten realizar.
</p>
</body>
</section>

<section>
<title>Instalación manual de software</title>
<subsection>
<title>Descargar y validar los programas fuente</title>
<body>

<p>
Cada vez que ejecutamos <c>ebuild</c> con un determinado fichero ebuild, se verifica que las sumas de control de todos los ficheros involucrados sean iguales a aquéllas que aparecen en el fichero acompañante <path>Manifest</path>  o en <path>files/digest-&lt;nombre>-&lt;versión></path>. Lo que tiene lugar tras la descarga de las fuentes.
</p>

<p>
Para descargar las fuentes usando <c>ebuild</c>, ejecutamos:
</p>

<pre caption="Descargando las fuentes">
# <i>ebuild ruta/al/ebuild fetch</i>
</pre>

<p>
Si la suma de control md5 (md5sum) del ebuild no coincide con la listada en el fichero <path>Manifest</path>, o la de una de las fuentes descargadas no coincide con el listado en el fichero <path>files/digest-&lt;paquete></path>, aparecerá un error similar a este:
</p>

<pre caption="Fallo en la suma de control del ebuild">
!!! File is corrupt or incomplete. (Digests do not match)
>>> our recorded digest: db20421ce35e8e54346e3ef19e60e4ee
>>>  your file's digest: f10392b7c0b2bbc463ad09642606a7d6
<comment>o</comment>
  !!! El fichero está corrompido o incompleto (Los resúmenes no coinciden)
  >>> nuestro resumen almacenado: db20421ce35e8e54346e3ef19e60e4ee
  >>>   el resumen de su fichero: f10392b7c0b2bbc463ad09642606a7d6
</pre>

<p>
La línea que sigue a este mensaje indicará el fichero problemático.
</p>

<p>
Si estamos seguros que tanto las fuentes descargadas como el propio ebuild son válidos, se puede regenerar el <path>Manifest</path> y el fichero <path>digest-&lt;paquete></path> usando la funcionalidad 'digest' de <c>ebuild</c>:
</p>

<pre caption="Regeneración de manifest y digest">
# <i>ebuild ruta/al/ebuild digest</i>
</pre>
</body>
</subsection>

<subsection>
<title>Descomprimiendo las fuentes</title>
<body>

<p>
Para descomprimir los programas fuente en <path>/var/tmp/portage</path> (o en cualquier otro directorio que se haya especificado en <path>/etc/make.conf</path>), se usa la funcionalidad 'unpack' de <c>ebuild</c>:
</p>

<pre caption="Descomprimiendo las fuentes">
# <i>ebuild ruta/al/ebuild unpack</i>
</pre>

<p>
Lo que ejecutará la función src_unpack() del ebuild (si no se ha definido dicha función simplemente se realizará una descompresión de las fuentes). En este paso también se aplican los parches necesarios.
</p>
</body>
</subsection>

<subsection>
<title>Compilando las fuentes</title>
<body>

<p>
El paso siguiente en el proceso de instalación es compilar las fuentes. La funcionalidad de compilar de <c>ebuild</c> se encarga de esta etapa ejecutando la función src_compile() en el ebuild. También incluye los pasos de configuración, si fuera pertinente.
</p>

<pre caption="Compilando las fuentes">
# <i>ebuild ruta/al/ebuild compile</i>
</pre>

<p>
Si quisiéramos cambiar las instrucciones de compilación deberíamos editar la función src_compile() del ebuild. Sin embargo, también se puede &quot;engañar&quot; a Portage para que crea que la aplicación <c>ebuild</c> ha acabado los pasos de compilación creando un fichero vacío llamado <path>.compiled</path> en el directorio de trabajo.
</p>

<pre caption="Informando a Portage de que se han acabado los trabajos de compilación">
# <i>touch .compiled</i>
</pre>
</body>
</subsection>

<subsection>
<title>Instalando los ficheros en una ubicación temporal</title>
<body>

<p>
En el próximo paso, Portage instalará todos los ficheros necesarios en una ubicación temporal. Este directorio contendrá entonces todos los ficheros que serán instalados en el sistema en producción. Esto se hace mediante la funcionalidad 'install' de <c>ebuild</c>, que ejecuta la función src_install() del ebuild:
</p>

<pre caption="Instalando los ficheros">
# <i>ebuild ruta/al/ebuild install</i>
</pre>
</body>
</subsection>

<subsection>
<title>Instalando los ficheros en el sistema de ficheros real</title>
<body>

<p>
El paso final es copiar todos los ficheros en el entorno de producción y registrarlos en la base de datos de Portage. El programa <c>ebuild</c> llama a este paso &quot;qmerge&quot; que puede descomponerse en los pasos siguientes:
</p>

<ul>
  <li>Ejecutar la función pkg_preinst() si se ha definido</li>
  <li>Copiar los ficheros en el sistema</li>
  <li>Registrar los ficheros en la base de datos de Portage</li>
  <li>Ejecutar la función pkg_postinst() si se ha definido</li>
</ul>

<p>
A través de la funcionalidad qmerge de <c>ebuild</c> realizamos estos pasos:
</p>

<pre caption="Instalando los ficheros en el entorno de producción">
# <i>ebuild ruta/al/ebuild qmerge</i>
</pre>
</body>
</subsection>

<subsection>
<title>Limpiando el directorio temporal</title>
<body>

<p>
Finalmente, se debe limpiar el directorio temporal usando la funcionalidad clean de <c>ebuild</c>:
</p>

<pre caption="Limpiando el directorio temporal">
# <i>ebuild ruta/al/ebuild clean</i>
</pre>
</body>
</subsection>
</section>

<section>
<title>Características adicionales de ebuild</title>
<subsection>
<title>Ejecutando todos los comandos relacionados con la instalación de una vez</title>
<body>

<p>
Usando la funcionalidad merge de <c>ebuild</c> se puede ejecutar los comandos fetch, unpack, compile, install y qmerge de una sola vez:
</p>

<pre caption="Instalando software">
# <i>ebuild ruta/al/ebuild merge</i>
</pre>
</body>
</subsection>

<subsection>
<title>Acciones de configuración de un paquete</title>
<body>

<p>
Algunas aplicaciones incluyen instrucciones para configurar posteriormente el paquete en nuestro sistema. Estas instrucciones pueden ser interactivas y por lo tanto no son ejecutadas automáticamente. Para ejecutar estos pasos de configuración, listados en la función config() (opcional) del ebuild, se usa la funcionalidad config de <c>ebuild</c>:
</p>

<pre caption="Configurar un paquete">
# <i>ebuild ruta/al/ebuild config</i>
</pre>
</body>
</subsection>

<subsection>
<title>Creando un paquete (RPM o no)</title>
<body>

<p>
Portage puede crear también el paquete binario de un ebuild o incluso un fichero RPM. Para crear estos archivos se usan las funcionalidades package o rpm de <c>ebuild</c>. Hay algunas diferencias entre ambas:
</p>

<ul>
<li>
    La funcionalidad package es muy similar a la funcionalidad merge, ya que ejecuta todos los pasos necesarios (descargar, descomprimir, compilar, instalar) antes de crear el paquete.
</li>
<li>
    La funcionalidad rpm crea un paquete RPM a partir de los ficheros creados <e>después</e> de haber ejecutado la funcionalidad install del <c>ebuild</c>.
</li>
</ul>

<pre caption="Creación de paquetes">
<comment>(Para un paquete binario compatible con Portage)</comment>
# <i>ebuild ruta/al/ebuild package</i>

<comment>(Para un paquete RPM)</comment>
# <i>ebuild ruta/al/ebuild rpm</i>
</pre>

<p>
Pero los ficheros RPM creados no contienen información a cerca de las dependencias del ebuid.
</p>
</body>
</subsection>
</section>

<section>
<title>Más información</title>
<subsection>
<body>

<p>
Están disponibles las siguientes páginas de man para más información relativa a Portage, la aplicación ebuild y los ficheros ebuild:
</p>

<pre caption="Man pages">
$ <i>man portage</i>  <comment>(el propio Portage)</comment>
$ <i>man emerge</i>   <comment>(el comando emerge)</comment>
$ <i>man ebuild</i>   <comment>(el comando ebuild)</comment>
$ <i>man 5 ebuild</i> <comment>(la sintaxis del fichero ebuild)</comment>
</pre>

<p>
También está disponible más información destinada al desarrollador en <uri link="/proj/en/devrel/handbook/handbook.xml">Developers Handbook</uri> (en inglés).
</p>
</body>
</subsection>
</section>
</sections>
