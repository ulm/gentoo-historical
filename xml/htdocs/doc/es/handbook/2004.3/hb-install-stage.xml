<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/2004.3/hb-install-stage.xml,v 1.1 2005/01/07 14:28:32 chiguire Exp $ -->

<sections>

<version>1.71</version>
<date>2004-12-21</date>

<section>
<title>Instalando el Stage comprimido (tarball)</title>
<subsection>
<title>Ajustando la Fecha/Hora correcta</title>
<body>

<p>
Antes de continuar debes revisar la fecha y la hora y
actualizarlos. ¡Un reloj mal configurado puede traer
resultados extraños a futuro!
</p>

<p>
Para comprobar la fecha/hora actual, ejecute el comando <c>date</c>:
</p>

<pre caption="Verificando la fecha/hora">
# <i>date</i>
Fri Oct 29 16:21:18 CEST 2004
</pre>

<p>
Si la fecha/hora está equivocada, actualícela con el comando <c>date
MMDDhhmmCCYY</c>, con la siguiente sintaxis (<b>M</b>es, <b>D</b>ía,
<b>h</b>ora, <b>m</b>inuto, siglo (<b>C</b>) y año (<b>Y</b>)). Por
ejemplo, para colocar la fecha y hora a las 16:21 horas del 29 de
Octubre del 2004:
</p>

<pre caption="Ajustando la fecha/hora">
# <i>date 102916212004</i>
</pre>
</body>
</subsection>

<subsection>
<title>Haciendo su propia elección</title>
<body>

<p>
El próximo paso a llevar a cabo es instalar el tarball del archivo
<e>stage</e> escogido en su sistema. Tiene la opción de descargarlo
del Internet o, si ha arrancado con un LiveCD Universal Gentoo,
cópielo del mismo CD. Si tiene el CD Universal y el stage que quiere
utilizar está en el CD, descargarlo desde internet es un gasto de ancho
de banda innecesario, ya que las los archivos son los mismos. En la 
mayoría de las ocasiones, el comando <c>uname -m</c> puede 
ayudarle a decidir que archivo stage tiene que descargar.
</p>

<ul>
<li><uri link="#doc_chap2">Por defecto: Descargar los Stages de Internet</uri></li>
<li><uri link="#doc_chap3">Alternativa: Usar el Stage de un LiveCD</uri></li>
</ul>
</body>
</subsection>
</section>

<section>
<title>Por defecto: Utilizar un Stage desde Internet</title>
<subsection>
<title>Descargando el Stage comprimido (tarball)</title>
<body>

<p>
Vete al punto de montaje de Gentoo en el que has montado los sistemas
de archivo (probablemente <path>/mnt/gentoo</path>):
</p>

<pre caption="Ir al punto de montaje de Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Dependiendo del medio de instalación, tendremos un par de herramientas 
disponibles para descargar el stage. Si disponemos de  <c>links2</c>,
podremos navegar por <uri link="/main/en/mirrors.xml">la lista de
servidores réplica de Gentoo</uri> y escoger el más cercano a
nosotros. Si no tiene <c>links2</c>, debería disponer de <c>lynks</c>. En
este caso, substituya el resto de instrucciones que hagan referencia a 
<c>links2</c> con <c>lynks</c>.
</p>

<p>
Luego entrar en el directorio <path>releases/</path> seguido
de tu arquitectura (por ejemplo <path>x86/</path> y la versión de
Gentoo (<path>2004.3/</path>) para finalizar con el directorio de los
stages <path>stages/</path>. Allí deberías ver todos los archivos de
las stages disponibles para tu arquitectura. Selecciona uno y presiona
<c>D</c> para descargarlo. Cuando se haya descargado, presiona
<c>Q</c> para cerrar el navegador.
</p>

<pre caption="Navegando por la lista de servidores réplica con links2">
<comment>(Sin proxy)</comment>   # <i>links2 http://www.gentoo.org/main/en/mirrors.xml</i>
<comment>(Con proxy)</comment>      # <i>links2 -http-proxy proxy.server.com:8080 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Si no disponemos de <c>lynx</c>, deberíamos tener<c>links2</c> a
nuestra disposición. <c>links2</c> es más potente que <c>lynx</c>,
pero tiene algunas desventajas. Una de ellas es que no escucha las
variables del proxy que hayamos declarado con anterioridad. Si
necesitamos configurar un proxy, usa <c>links2 -http-proxy
proxy.server.com:8080</c>. Tras esto, seguiremos los mismos pasos que
con  <c>lynx</c> ya que su manejo es igual.
</p>

<pre caption="Navegando por la lista de servidores réplica con links2">
<comment>(Sin proxy:)</comment>   # <i>links2 http://www.gentoo.org/main/es/mirrors.xml</i>
<comment>(Con proxy:)</comment>   # <i>links2 -http-proxy proxy.server.com:8080
http://www.gentoo.org/main/es/mirrors.xml</i>
</pre>

<p>
Si quiere comprobar la integridad del tarball de stage que ha descargado,
utilice <c>md5sum</c> y compare la salida con la suma de comprobación
MD5 que proporciona el servidor réplica. Por ejemplo, para comprobar
la validez del tarball de stage de x86:
</p>

<pre caption="Ejemplo de comprobación de integridad del tarball de stage">
# <i>md5sum -c stage1-x86-2004.3.tar.bz2.md5</i>
stage1-x86-2004.3.tar.bz2: OK
</pre>

</body>
</subsection>

<subsection>
<title>Extraer el Stage comprimido</title>
<body>

<p>
Ahora desempaquetamos el stage descargado en sistema. Usaremos el
<c>tar</c> de GNU para dicha labor y este es el método más fácil.
</p>

<pre caption="Descomprimiendo el Stage">
# <i>tar -xvjpf stage?-*.tar.bz2</i>
</pre>

<p>
Asegúrate de usar las mismas opciones <c>-xvjpf</c>). El <c>x</c> se usa para
<e>Desempaquetar</e>, el <c>v</c> para <e>Verbose</e> (Ok, si, es opcional),
el <c>j</c> para <e>Descomprimir con bzip2</e>, el <c>p</c> para <e>Preservar
los permisos</e> y el <c>f</c> para decir que extraemos un archivo, no
la entrada estándar.
</p>

<p>
¿Hecho?, OK, ahora estás preparado para proceder con la siguiente sección en <uri
link="#installing_portage">Configurando las opciones de compilación</uri>.
</p>
</body>
</subsection>
</section>

<section>
<title>Alternativa: Usar un Stage del LiveCD</title>
<subsection>
<title>Extraer el Stage comprimido (tarball)</title>
<body>

<p>
Los Stages en el CD están situados en el directorio <path>/mnt/cdrom/stages</path>. 
Para ver una lista de los Stages disponibles, usa <c>ls</c>:
</p>

<pre caption="Listar todos los stages disponibles">
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Si el sistema responde con un error, tal vez necesite montar el CD-ROM primero:
</p>

<pre caption="Montando el CD-ROM">
# <i>ls /mnt/cdrom/stages</i>
ls: /mnt/cdrom/stages: No such file or directory
# <i>mount /dev/cdroms/cdrom0 /mnt/cdrom</i>
# <i>ls /mnt/cdrom/stages</i>
</pre>

<p>
Ahora en tu punto de montaje de Gentoo (Normalmente <path>/mnt/gentoo</path>):
</p>

<pre caption="Cambiando el directorio a /mnt/gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Ahora extraeremos el Stage comprimido que hayas elegido. Usaremos el
<c>tar</c> de GNU para dicha labor. ¡Asegúrate de usar las mismas
opciones <c>-xvjpf</c>)! En el siguiente ejemplo, extraeremos el Stage
comprimido <path>stage3-&lt;subarch&gt;-2004.3.tar.bz2</path>. Asegúrate de
sustituir el nombre por el de tu Stage.
</p>

<pre caption="Descomprimiendo el Stage">
# <i>tar -xvjpf /mnt/cdrom/stages/stage3-&lt;subarch&gt;-2004.3.tar.bz2</i>
</pre>

<p>
Ahora que tenemos el stage instalado, continuaremos con <uri
link="#installing_portage">Instalando Portage</uri>.
</p>


</body>
</subsection>
</section>
<section id="installing_portage">
<title>Instalando Portage</title>
<subsection>
<title>Instalando una imagen de Portage</title>
<body>

<p>
Ahora tiene que instalar una imagen de Portage,  es un conjunto de archivos
que informan a Portage sobre los programas que puede instalar, que perfiles
están disponibles, etc.
</p>

<p>
Si está utilizando un LiveCD Universal, actualmente tiene a su disposición una
de imagen de Portage. Si no es así, necesitará descargarla de uno de nuestros
servidores.
</p>

<p>
Continué con la parte adecuada:
</p>

<ul>
  <li>
    <uri link="#installing_from_LiveCD">Descomprimiendo la imagen 
    del LiveCD</uri>
  </li>
  <li>
    <uri link="#installing_from_Internet">Descomprimiendo una imagen 
    descargada de Internet</uri>
  </li>
</ul>

</body>
</subsection>
<subsection id="installing_from_LiveCD">
<title>Descomprimiendo la imagen del LiveCD</title>
<body>

<p>
Para instalar la imagen, eche un vistazo a <path>/mnt/cdrom/snapshots/</path> 
para comprobar que imagen está disponible:
</p>

<pre caption="Comprobando el contenido de /mnt/cdrom/snapshots">
# <i>ls /mnt/cdrom/snapshots</i>
</pre>

<p>
Ahora extraeremos la imagen siguiendo el siguiente método. De nuevo, asegúrese 
de usar las opciones correctas para <c>tar</c>. También, la <c>-C</c> que es 
mayúscula <c>C</c>, no <c>c</c>. En el siguiente ejemplo usaremos 
<path>portage-20041022.tar.bz2</path> como el nombre de la imagen. 
Asegúrese de sustituirlo por el nombre de la imagen que tiene en su LiveCD.
</p>

<pre caption="Extrayendo la imagen de Portage">
# <i>tar -xvjf /mnt/cdrom/snapshots/portage-20041022.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

<p>
Continué con <uri link="#networklessornot">¿Instalación con o sin red?</uri>.
</p>

</body>
</subsection>
<subsection id="installing_from_Internet">
<title>Descomprimiendo una imagen descargada de Internet</title>
<body>

<p>
Vaya al punto de montaje donde tiene montado su sistema de ficheros
(normalmente <path>/mnt/gentoo</path>):
</p>

<pre caption="Situándose en el punto de montaje de Gentoo">
# <i>cd /mnt/gentoo</i>
</pre>

<p>
Ejecute <c>links2</c> (o <c>lynx</c>)  y vaya a  <uri 
link="/main/en/mirrors.xml">la lista de servidores réplica de Gentoo</uri>. 
Elija un servidor cercano y abra el directorio <path>snapshots/</path>. De allí
descargue la última imagen de Portage (por ejemplo 
<path>portage-20041202.tar.bz2</path>), seleccionándola y presionando 
<c>D</c>.
</p>

<pre caption="Comprobando la lista de servidores réplica de Gentoo">
# <i>links2 http://www.gentoo.org/main/en/mirrors.xml</i>
</pre>

<p>
Ahora salga del navegador presionando <c>Q</c>. Ahora dispone de una imagen 
de Portage guardada en  <path>/mnt/gentoo</path>. En el siguiente paso, vamos
a descomprimir la imagen de Portage en su sistema de ficheros:
</p>

<pre caption="Descomprimiendo la imagen de Portage">
# <i>tar -xvjf /mnt/gentoo/portage-20041202.tar.bz2 -C /mnt/gentoo/usr</i>
</pre>

</body>
</subsection>
<subsection id="networklessornot">
<title>¿Instalación con o sin red?</title>
<body>

<p>
Si esta llevando a cabo un instalación sin red, también necesita copiar
todo el código fuente desde el LiveCD Universal. Si no es así (si dispone 
de red) , debería saltarse este paso y continuar con  
<uri link="#compile_options">Configurando las opciones de compilación</uri>.
</p>

<pre caption="Copiando el código fuente">
# <i>mkdir /mnt/gentoo/usr/portage/distfiles</i>
# <i>cp /mnt/cdrom/distfiles/* /mnt/gentoo/usr/portage/distfiles/</i>
</pre>

</body>
</subsection>
</section>

<section id="compile_options">
<title>Configurando las opciones de compilación</title>
<subsection>
<title>Introducción</title>
<body>

<p>
Para optimizar Gentoo, tendrás que ajustar un par de variables que
afectarán el comportamiento de Portage. Todas estas variables se
pueden fijar como variables de entorno (usando <c>export</c>) pero eso
no es permanente. Para mantener tu configuración, Portage dispone de
<path>/etc/make.conf</path>, un fichero de configuración para
Portage. Este es el fichero que editaremos ahora.
</p>

<note>
Una lista comentada de todas las posibles variables puede 
encontrarse en <path>/mnt/gentoo/etc/make.conf.example</path>. Para 
una instalación de Gentoo correcta lo único que necesita es configurar
las variables que se mencionan en las siguientes líneas.
</note>

<p>
Usa tu editor favorito (en esta guía nosotros usaremos <c>nano</c>. Así que 
empezamos con la modificación de las variables.
</p>

<pre caption="Abriendo /etc/make.conf">
# <i>nano -w /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Como probablemente te darás cuenta, el fichero <path>make.conf</path>
está estructurado de una manera genérica: Las líneas comentadas
empiezan con "#", otras líneas definen variables usando la sintaxis
<c>VARIABLE="contenido"</c>. Discutiremos muchas de esas variables más
adelante.
</p>

<warn>
No haga ninguna modificación en la variable USE si va a ejecutar un instalación
stage3 con GRP. Puede modificar la variable USE después de tener instalados
los paquetes que desee.¡Los Gremlins serán avisados para asaltar su sistema
si ignora este aviso!.
</warn>

</body>
</subsection>

<subsection>
<title>CHOST</title>
<body>

<warn>Aunque puede ser interesante para los usuarios que no iniciaron
la instalación con el Stage 1, no deberían cambiar el parámetro
<c>CHOST</c> en el <path>make.conf</path> ya que pueden volver el
sistema inutilizable. De nuevo, sólo cambie esta variable si usa una
instalación desde el <e>stage1</e>.
</warn>

<p>
La variable <c>CHOST</c> define la arquitectura para la cual
<c>gcc</c> ha de compilar los programas. Las posibilidades son:
</p>

<table>
<tr>
  <th>Arquitectura</th>
  <th>Subarquitectura</th>
  <th>Valor del CHOST</th>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i386</ti>
  <ti>i386-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i486</ti>
  <ti>i486-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i586</ti>
  <ti>i586-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>x86</ti>
  <ti>i686 y superior (incl. athlon)</ti>
  <ti>i686-pc-linux-gnu</ti>
</tr>
<tr>
  <ti>alpha</ti>
  <ti></ti>
  <ti>alpha-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc</ti>
  <ti></ti>
  <ti>powerpc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>ppc64</ti>
  <ti></ti>
  <ti>powerpc64-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>sparc</ti>
  <ti></ti>
  <ti>sparc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>sparc64</ti>
  <ti></ti>
  <ti>sparc-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>(genérico)</ti>
  <ti>hppa-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa7000</ti>
  <ti>hppa1.1-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>hppa</ti>
  <ti>pa8000 y superior</ti>
  <ti>hppa2.0-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>mips</ti>
  <ti></ti>
  <ti>mips-unknown-linux-gnu</ti>
</tr>
<tr>
  <ti>amd64</ti>
  <ti></ti>
  <ti>x86_64-pc-linux-gnu</ti>
</tr>
</table>

<p>
Por favor, asegúrese de utilizar la configuración <e>correcta</e> para CHOST.
Por ejemplo, la configuración de CHOST para sparc64 continua siendo 
<c>sparc-unknown-linux-gnu</c> y <e>no</e> ¡<c>sparc64-unknown-linux-gnu</c>!
</p>

</body>
</subsection>
<subsection>
<title>CFLAGS y CXXFLAGS</title>
<body>

<p>
Las variables <c>CFLAGS</c> y <c>CXXFLAGS</c>, definen los parámetros
de optimización para el compilador de C y C++ de <c>gcc</c>
respectivamente. Aunque generalmente se definen aquí, tendrás el
máximo rendimiento si optimizas estos parámetros para cada programa
por separado. La razón es que cada programa es diferente.
</p>

<p>
En el fichero <path>make.conf</path> deberás definir los parámetros de
optimización que pienses que vayan a hacer tu sistema el mejor <e>en
todas las situaciones</e>. No coloques parámetros experimentales en
esta variable; un nivel demasiado alto de optimización puede hacer que los programas se comporten mal (cuelgues, o incluso peor, funcionamientos erróneos).
</p>

<p>
No explicaremos todas las opciones posibles para la optimización. Pero
si quieres conocerlas todas, léete <uri
link="http://www.gnu.org/software/gcc/onlinedocs/">El manual en línea
de GNU</uri> o la página información de <c>gcc</c> (<c>info gcc</c> -- Solo
en un sistema Linux funcional). El fichero <path>make.conf</path>
también contiene una gran cantidad de ejemplos e información; no
olvides leerlo también.
</p>

<p>
La primera variable es el parámetro <c>-march=</c>, que especifica el nombre 
de la arquitectura seleccionada. Las posibles opciones están descritas en el 
fichero <path>make.conf</path> (como comentarios). Por ejemplo, para la 
arquitectura x86 Athlon XP:
</p>

<pre caption="El parámetro march de GCC">
<comment># Los usuarios de AMD64 que quieran utilizar un sistema nativo de 64 bits no deben utilizar athlon-xp</comment>
-march=athlon-xp
</pre>

<p>
Seguida de esta, está el parámetro <c>-O</c>, que especifica la clase
optimización de <c>gcc</c>. Las clases posibles son <c>s</c> (para
tamaño optimizado), <c>0</c> (para no optimizar), <c>1</c>, <c>2</c>
or <c>3</c> para la optimización de velocidad (cada clase tiene los
mismos parámetros que la primera, más algunos extras). Por ejemplo
para una optimización de clase 2:
</p>

<pre caption="El parámetro O de GCC">
-O2
</pre>

<p>
Otros parámetros de optimización bastante populares son los
<c>-pipe</c> (usando tuberías en lugar de ficheros temporales para la
comunicación entre las diferentes etapas de compilación).
 </p>

 <p>
Cuidado con utilizar <c>-fomit-frame-pointer</c> (el cual no mantiene
el puntero de macro en un registro para las funciones que no lo necesiten) 
pues podría tener graves repercusiones en la depuración de errores en 
aplicaciones.
 </p>

<p>
Cuando definimos las variables <c>CFLAGS</c> y <c>CXXFLAGS</c>,
deberías combinar algunos parámetros de optimización, como en el
ejemplo siguiente:
</p>

<pre caption="Definiendo las variables CFLAGS y CXXFLAGS">
CFLAGS="-march=athlon-xp -pipe -O2"	<comment># Los usuarios de AMD64 no deben utilizar athlon-xp</comment>
CXXFLAGS="${CFLAGS}"                  <comment># Usa las mismas opciones para las dos variables</comment></pre>
</body>
</subsection>

<subsection>
<title>MAKEOPTS</title>
<body>

<p>
Con la variable <c>MAKEOPTS</c> definimos cuantas compilaciones
paralelas pueden hacerse al mismo tiempo cuando instalamos un
paquete. El número sugerido es la cantidad de CPUs de tu sistema, más uno
</p>

<pre caption="MAKEOPTS para un sistema normal de 1-CPU">
MAKEOPTS="-j2"
</pre>
</body>
</subsection>

<subsection>
<title>¡Preparados, listos, ya!</title>
<body>

<p>
Actualiza tu <path>/mnt/gentoo/etc/make.conf</path> con tus propios
parámetros y guarda los cambios. Ahora estamos listos para continuar
con <uri link="?part=1&amp;chap=6">Instalando el sistema base de Gentoo</uri>.
</p>
</body>
</subsection>
</section>
</sections>
