<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/2004.3/Attic/hb-working-behaviour.xml,v 1.1 2005/01/07 14:28:32 chiguire Exp $ -->

<sections>
<section>
<title>Protección de los Ficheros de Configuración</title>
<subsection>
<title>¿Protección?</title>
<body>

<p>
El Portage conoce el concepto de los "ficheros protegidos". Esto significa que,
cuando actualiza su software, no sobreescribirá inmediatamente ciertos ficheros
con versiones superiores, pero le informará que existe una nueva versión.
Por supuesto, esto es muy útil para los ficheros de configuración (aquellos
que se encuentran en <path>/etc</path>).
</p>

<p>
En vez de sobreescribir estos ficheros, creará un nuevo fichero llamado
<path>._cfg0000_&lt;nombre&gt;</path> siendo <path>&lt;nombre&gt;</path> el
nombre del fichero original. Depende entonces del usuario fusionar las
diferencias con el fichero existente. Puede usar el comando <c>etc-update</c>
que facilita esta operación. Hablaremos más tarde de <c>etc-update</c>.
</p>
</body>
</subsection>

<subsection>
<title>Declarando CONFIG_PROTECT</title>
<body>

<p>
El Portage no puede proteger fichero por fichero. En vez de eso, protege
directorios enteros, La variable <c>CONFIG_PROTECT</c> contiene todos los
directorios protegidos. Todos los subdirectorios de los directorios incluidos
están protegidos también. La variable <c>CONFIG_PROTECT</c> está definida en
<path>/etc/make.globals</path>, pero si quiere cambiarla, debe declararla en 
<path>/etc/make.conf</path> (para mantener la consistencia, el fichero
<path>/etc/make.conf</path> se usa para toda la configuración del Portage)
</p>

<pre caption="Una configuración ejemplo de CONFIG_PROTECT">
CONFIG_PROTECT="/etc /usr/share/config /usr/kde/3.1/share/config"
</pre>

<p>
Si desea proteger cierto directorio, pero no todos sus subdirectorios, puede
"desproteger" estos directorios, listándolos en la variable 
<c>CONFIG_PROTECT_MASK</c>, que tiene su valor por defecto definido en
<path>/etc/make.globals</path> pero debe ser alterado declarándola en
<path>/etc/make.conf</path>:
</p>

<pre caption="Una configuración ejemplo de CONFIG_PROTECT_MASK">
CONFIG_PROTECT_MASK="/etc/init.d"
</pre>

<p>
Se puede encontrar más información sobre la Protección de los Ficheros de
Configuración en la ayuda online de <c>emerge</c>:
</p>

<pre caption="Obteniendo información sobre la Protección de Ficheros de
Configuración">
# <i>emerge --help config</i>
</pre>
</body>
</subsection>

<subsection>
<title>etc-update</title>
<body>

<p>
<c>etc-update</c> es una herramienta que ayuda a fusionar los ficheros
<path>._cfg0000_&lt;nombre&gt;</path>. Facilita la fusión interactiva de la
configuración de la misma manera que puede auto-fusionar los cambios triviales.
</p>

<p>
Ejecutar <c>etc-update</c> es muy directo:
</p>

<pre caption="Ejecutando etc-update">
# <i>etc-update</i>
</pre>

<p>
Después de fusionar los cambios triviales, saldrá por pantalla una lista de
ficheros protegidos que tienen una actualización pendiente. Abajo se le
presentarán las distintas opciones:
</p>

<pre caption="Opciones del etc-update">
Please select a file to edit by entering the corresponding number.
              (-1 to exit) (-3 to auto merge all remaining files)
                           (-5 to auto-merge AND not use 'mv -i'): 
<comment>
Nota del traductor: Estas lineas por motivos aclaratorios se facilitan tal cual
aparecen en el etc-update. Su significado se proporcionará seguido, al igual
que en el resto de salidas del etc-update.
</comment>
</pre>

<pre caption="Traducción de las opciones del etc-update">
Por favor seleccione el fichero facilitando el correspondiente numero.
		  (-1 para salir) (-3 para auto-fusionar todos los ficheros restantes)
						  (-5 para auto-fusionar Y no usar 'mv -i'):
</pre>

<p>
Si escribe <c>-1</c>, <c>etc-update</c> saldrá sin ejecutar ningún cambio.
Si escribe <c>-3</c> o <c>-5</c>, <e>todos</e> los ficheros de configuración
listados serán sobreescritos con las nuevas versiones. Luego es muy importante
seleccionar los ficheros de configuración que no deben ser actualizados
automáticamente. Esto es tan fácil como introducir el numero listado a la
izquierda del fichero de configuración.
</p>

<p>
Como ejemplo, seleccionaremos el fichero <path>/etc/pear.conf</path>:
</p>

<pre caption="Actualizando un fichero de configuración específico">
Beginning of differences between /etc/pear.conf and /etc/._cfg0000_pear.conf
<comment>[...]</comment>
End of differences between /etc/pear.conf and /etc/._cfg0000_pear.conf
1) Replace original with update
2) Delete update, keeping original as is
3) Interactively merge original with update
4) Show differences again
</pre>

<p>
En castellano:
</p>

<pre caption="Traducción: Actualizando un fichero de configuración específico">
Inicio de las diferencias entre /etc/pear.conf y /etc/._cfg0000_pear.conf
<comment>[...]</comment>
Fin de las diferencias entre /etc/pear.conf y /etc/._cfg0000_pear.conf
1) Reemplazar el original con la actualización
2) Eliminar la actualización, dejando el original tal cual
3) Fusionar interactivamente el original con la actualización
4) Mostrar otra vez las diferencias
</pre>

<p>
Ahora puede ver las diferencias entre los dos ficheros. Si cree que la
configuración actualizada puede ser usada sin problemas, escriba <c>1</c>. Si
cree que el fichero de configuración actualizado no es necesario, o no
proporciona ninguna información nueva o útil, escriba <c>2</c>. Si quiere
actualizar interactivamente su configuración de fichero actual, escriba 
<c>3</c>. 
</p>

<p>
No es muy interesante extendernos sobre la fusión interactiva aquí. Para
una visión completa, listaremos los posibles comandos que puede usar mientras
está fusionando interactivamente dos ficheros. Se imprimirán dos lineas (la
original, y la propuesta) y un "prompt" donde podrá escribir uno de los
siguientes comandos:
</p>

<pre caption="Comandos disponibles para la fusión interactiva">
ed:     Edit then use both versions, each decorated with a header.
eb:     Edit then use both versions.
el:     Edit then use the left version.
er:     Edit then use the right version.
e:      Edit a new version.
l:      Use the left version.
r:      Use the right version.
s:      Silently include common lines.
v:      Verbosely include common lines.
q:      Quit.
</pre>

<p>
En castellano:
</p>

<pre caption="Traducción: Comandos disponibles para la fusión interactiva">ed:     Editar y usar ambas versiones, cada una con una cabecera.eb:     Editar y usar ambas versiones.el:     Editar y usar la versión de la izquierda.er:     Editar y usar la versión de la derecha.e:      Editar una nueva versión.l:      Usar la versión izquierda.r:      Usar la versión derecha.s:      Incluir las lineas comunes sin advertir.v:      Incluir las lineas comunes en modo detallado.q:      Salir.</pre>

<p>
Cuando haya acabado de actualizar los ficheros de configuración importantes,
puede actualizar automáticamente el resto de ficheros de configuración.
<c>etc-update</c> saldrá si no encuentra ningún fichero actualizable más.
</p>
</body>
</subsection>
</section>

<section>
<title>Opciones de Red</title>
<subsection>
<title>Réplicas (mirrors)</title>
<body>

<p>
Conforme Gentoo aumenta su popularidad, el uso de réplicas es muy apreciado.
El Portage usa tres variables para las réplicas: una para las réplicas de
rsync (que se usan para la sincronización del árbol del Portage), una para los
"distfiles" (que se usan para descargar código fuente) y una para los paquetes
precompilados.
</p>

<p>
Todas las réplicas de "distfiles" posibles están listadas en nuestra <uri 
link="/main/en/mirrors.xml">Página de Réplicas de Gentoo</uri>. También puede
usar <c>mirrorselect</c> que facilita la configuración de los mirrors para su
sistema. Pero primero permitanos chequear las las variables una por una...
</p>

<p>
La variable <c>SYNC</c> contiene la lista de réplicas rsync que quiere usar.
Por ejemplo, para usar 
<uri>rsync://rsync.namerica.gentoo.org/gentoo-portage</uri> como primera
opción, y <uri>rsync://rsync.samerica.gentoo.org/gentoo-portage</uri> como
segunda podría definir esto en el <path>/etc/make.conf</path>:
</p>

<pre caption="Definiendo SYNC en el /etc/make.conf">
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage
      rsync://rsync.samerica.gentoo.org/gentoo-portage"
</pre>

<p>
La variable <c>GENTOO_MIRRORS</c> contiene la lista de réplicas de "distfiles"
que quiere usar. Por ejemplo, para usar
<uri>ftp://ibiblio.org/pub/Linux/distributions/gentoo</uri> como primera opción
y <uri>http://www.gtlib.cc.gatech.edu/pub/gentoo</uri> como segunda, podría
definir esto en el <path>/etc/make.conf</path>:
</p>

<pre caption="Definiendo GENTOO_MIRRORS en el /etc/make.conf">
GENTOO_MIRRORS="ftp://ibiblio.org/pub/Linux/distributions/gentoo
                http://www.gtlib.cc.gatech.edu/pub/gentoo"
</pre>

<p>
La variable <c>PORTAGE_BINHOST</c> contiene una lista de réplicas de paquetes
precompilados que quiere usar. Por ejemplo, para usar
<uri>ftp://login:pass@grp.mirror.site/pub/grp/i686/athlon-xp</uri>, podría
definir esto en el <path>/etc/make.conf</path>:
</p>

<pre caption="Definiendo PORTAGE_BINHOST en el /etc/make.conf">
PORTAGE_BINHOST="ftp://login:pass@grp.mirror.site/pub/grp/i686/athlon-xp"
</pre>
</body>
</subsection>

<subsection>
<title>Mirrorselect</title>
<body>

<p>
Si desea usar <c>mirrorselect</c>, primero instálelo (si no lo ha hecho aún).
</p>

<pre caption="Instalando mirrorselect">
# <i>emerge mirrorselect</i>
</pre>

<p>
Ahora puede elegir entre que <c>mirrorselect</c> seleccione automáticamente
las réplicas para usted, o seleccionar las réplicas manualmente de una lista.
Para más información sobre como usar <c>mirrorselect</c>, sencillamente ejecute
<c>mirrorselect</c> desde la linea de comandos - le ofrecerá una rápida
descripción sobre <c>mirrorselect</c>.
</p>

<pre caption="Ejecutando mirrorselect">
# <i>mirrorselect</i>
</pre>
</body>
</subsection>

<subsection>
<title>Descargando</title>
<body>

<p>
El programa que usa el Portage para descargar archivos puede especificarse
configurando las variables <c>FETCHCOMMAND</c> y <c>RESUMECOMMAND</c>.
Existen diversos ejemplos en el <path>/etc/make.conf</path> y el
<path>/etc/make.globals</path>. El Portage usa <c>wget</c> por defecto:
</p>

<pre caption="FETCHCOMMAND y RESUMECOMMAND por defecto">
FETCHCOMMAND="/usr/bin/wget -t 5 --passive-ftp -P \${DISTDIR} \${URI}"
RESUMECOMMAND="/usr/bin/wget -c -t 5 --passive-ftp -P \${DISTDIR} \${URI}"
</pre>

<p>
La variable <c>${DISTDIR}</c> se sustituye con la ruta donde los ficheros
descargados se guardan (<path>/usr/portage/distfiles</path>), mientras la
variable <c>${URI}</c> se sustituye con el fichero que el Portage necesita
descargar.
</p>

<p>
Puesto que el portage usa <c>wget</c> por defecto, puede configurarlo para usar
proxies definiendo <c>http_proxy</c> y <c>ftp_proxy</c> (fíjese en las
minúsculas). Aunque puede hacer esto en el <path>/etc/make.conf</path> también,
le aconsejamos que use la solución más general puesto que las variables
<c>http_proxy</c> y <c>ftp_proxy</c> son usadas por otras herramientas
(<path>/etc/make.conf</path> se usa solo por el Portage). Por favor, lea el
capítulo <uri link="?part=2&amp;chap=6">Variables de entorno</uri> para saber
cómo declarar variables del sistema.
</p>
</body>
</subsection>

<subsection>
<title>Configurando rsync</title>
<body>

<p>
<c>rsync</c> es usado por <c>emerge sync</c> para actualizar su árbol del
Portage. Las tres variables usadas por el Portage para cambiar el
comportamiento de <c>rsync</c> son <c>RSYNC_EXCLUDEFROM</c>,
<c>RSYNC_RETRIES</c> y <c>RSYNC_TIMEOUT</c>.
</p>

<p>
Una forma de "proteger" los ebuilds de ser actualizados o eliminados por 
<c>emerge sync</c> es usar la variable <c>RSYNC_EXCLUDEFROM</c>. Esta debe ser
configurada con un fichero usado por <c>rsync</c> para excluir ciertos ficheros
y por defecto apunta a <path>/etc/portage/rsync_excludes</path>. <e>No</e> es
aconsejable usar este método, puesto que puede romper las dependencias si no se
tiene cuidado. Hablaremos más tarde sobre el <c>PORTDIR_OVERLAY</c>, que es el
método recomendado. Para más información, lea la página del manual de
<c>rsync</c>.
</p>

<pre caption="La variable RSYNC_EXCLUDEFROM">
RSYNC_EXCLUDEFROM="/etc/portage/rsync_excludes"
</pre>

<p>
Cuando <c>rsync</c> falla, reintentará un número determinado de veces antes de
cambiar al siguiente servidor de rsync disponible. El numero de reintentos está
definido en <c>RSYNC_RETRIES</c> y su valor por defecto es <c>3</c>:
</p>

<pre caption="La variable RSYNC_RETRIES">
RSYNC_RETRIES="3"
</pre>

<p>
Si está usando un servidor rsync (muy) lento, <c>rsync</c> puede dar un
time-out si no se recibe trafico. La cantidad de segundos de espera antes de
que salte el time-out se define en la variable <c>RSYNC_TIMEOUT</c> y está
definida por defecto a <c>180</c>:
</p>

<pre caption="La variable RSYNC_TIMEOUT">
RSYNC_TIMEOUT="180"
</pre>
</body>
</subsection>
</section>

<section>
<title>Las Rutas de los Directorios</title>
<subsection>
<title>Introducción</title>
<body>

<p>
Todo en el Portage es configurable, incluyendo los directorios usados para las
diferentes tareas y ficheros necesitados por el Portage. Para cambiar las
rutas por defecto (definidas en <path>/etc/make.globals</path>) necesita
definir las variables correcta en - como no :) - <path>/etc/make.conf</path>.
</p>

<warn>
Si altera la variable para apuntar a una ruta distinta, ¡<e>nunca</e> la acabe
con la <path>/</path> sobrante!
</warn>

</body>
</subsection>

<subsection>
<title>El árbol del Portage</title>
<body>

<p>
La ruta del árbol del Portage está definida en la variable <c>PORTDIR</c>. Su
valor por defecto es <path>/usr/portage</path>:
</p>

<pre caption="La variable PORTDIR">
PORTDIR="/usr/portage"
</pre>

<p>
Si quiere mantener un árbol del Portage junto al "oficial", necesita definir la
variable <c>PORTDIR_OVERLAY</c>. La(s) ruta(s) listadas en está variable no
altera(n) los efectos del <c>emerge sync</c>: los ebuilds en esa ruta no serán
actualizados o borrados, puesto que están a parte de su árbol del Portage.
</p>

<pre caption="La variable PORTDIR_OVERLAY">
PORTDIR_OVERLAY="/usr/local/portage"
</pre>

</body>
</subsection>
<subsection>
<title>Distfiles</title>
<body>

<p>
La ruta del código fuente descargado (también llamado(s) distfiles) está
definida en la variable <c>DISTDIR</c>. Por defecto apunta a 
<path>${PORTDIR}/distfiles</path>:
</p>

<pre caption="The variable DISTDIR">
DISTDIR="${PORTDIR}/distfiles"
</pre>

</body>
</subsection>
<subsection>
<title>Paquetes y RPMs</title>
<body>

<p>
La ruta de los paquetes precompilados se define en la variable <c>PKGDIR</c>.
Apunta por defecto a <path>${PORTDIR}/packages</path>:
</p>

<pre caption="La variable PKGDIR">
PKGDIR="${PORTDIR}/packages"
</pre>

<p>
La ruta de los RPMs (si, algunos paquetes están disponibles como RPMs) está
definida en la variable <c>RPMDIR</c>. Por defecto apunta a 
<path>${PORTDIR}/rpm</path>:
</p>

<pre caption="La variable RPMDIR">
RPMDIR="${PORTDIR}/rpm"
</pre>
</body>
</subsection>

<subsection>
<title>Ficheros Temporales del Portage</title>
<body>

<p>
El Portage usa una ruta temporal para compilar sus ebuilds. Esta está definida
en la variable <c>PORTAGE_TMPDIR</c>. Su valor por defecto es
<path>/var/tmp</path>:
</p>

<pre caption="La variable PORTAGE_TMPDIR">
PORTAGE_TMPDIR="/var/tmp"
</pre>

<p>
Por defecto, el Portage creará un directorio <path>portage</path> dentro de
<c>PORTAGE_TMPDIR</c>. Este se declara en la variable <c>BUILD_PREFIX</c>:
</p>

<pre caption="La variable BUILD_PREFIX">
BUILD_PREFIX="${PORTAGE_TMPDIR}/portage"
</pre>

<p>
Si pretende cambiar la ruta, asegúrese de que este directorio temporal reside
en una partición con suficiente espacio libre: cuando compile paquetes de
software muy grandes, el directorio puede crecer hacia los 2 Gb incluso más!
</p>
</body>
</subsection>

<subsection>
<title>Bitácora de sistema</title>
<body>

<p>
<c>PORT_LOGDIR</c> es una variable especial y desconfigurada por defecto.
Cuando la defina, el Portage creará un registro por ebuild en el directorio dado:
</p>

<pre caption="La variable PORT_LOGDIR">
PORT_LOGDIR="/var/log/portage"
</pre>
</body>
</subsection>
</section>

<section>
<title>Otras Opciones del Portage</title>
<subsection>
<title>Valor Nice</title>
<body>

<p>
El Portage soporta compilación con diferentes valores de "nice" (un valor de
prioridad). Si quiere que el Portage compile paquetes con un valor "nice" más
alto (que implica un sistema con mejor respuesta, pero también incrementa el
tiempo de compilación) puede definir la variable <c>PORTAGE_NICENESS</c> con un
número positivo:
</p>

<pre caption="La variable PORTAGE_NICENESS">
PORTAGE_NICENESS="3"
</pre>
</body>
</subsection>

<subsection>
<title>Paquetes con SLOTs y Limpieza Automatizada</title>
<body>

<p>
En diversas situaciones puede desear múltiples versiones diferentes de un
paquete (incluyendo las librerías) para que estén disponibles en su sistema. El
portage soporta esta característica mediante la definición de la variable 
<c>SLOT</c> en los ebuilds. Como usuario, no necesita saber como funcionan los
<c>SLOT</c>s, pero es importante que sepa como se soporta.
</p>

<p>
Si está instalando una nueva versión de un paquete, el Portage comprobará que
la variable <c>SLOT</c> está definida para ese paquete. Si ese es el caso, y la
variable <c>SLOT</c> es diferente para ambos paquetes (el nuevo y el viejo), el
Portage no tocará los paquetes antiguos.
</p>

<p>
No obstante, si la variable <c>SLOT</c> es la misma (como es normalmente el
caso), el paquete será eliminado por defecto. Para que el usuario pueda
interrumpir esta eliminación, el Portage hará una cuenta atrás de un
determinado número de segundos. Esta cantidad está definida en la variable
<c>CLEAN_DELAY</c> y su valor por defecto son <c>5</c> segundos:
</p>

<pre caption="La variable CLEAN_DELAY">
CLEAN_DELAY="5"
</pre>

<p>
Si no desea que el Portage elimine automáticamente las versiones antiguas (esto
se llama "cleaning" o limpieza) puede configurar la variable <c>AUTOCLEAN</c>
al valor <c>no</c>:
</p>

<pre caption="La variable AUTOCLEAN">
AUTOCLEAN="no"
</pre>
</body>
</subsection>

<subsection>
<title>Las Variables de Compilación</title>
<body>

<p>
Hemos hablado de muchas variables, pero no hemos acabado aún. La gente que ha
instalado Gentoo conocerá las variables <c>CHOST</c>, <c>CFLAGS</c> y
<c>CXXFLAGS</c>, usadas por el compilador para optimizar los paquetes.
</p>

<p>
Se puede encontrar más información sobre estas variables en las paginas info
del <c>gcc</c> o en línea en los <uri
link="http://www.gnu.org/software/gcc/onlinedocs/">Manuales Online de GCC</uri>.
</p>

<pre caption="Obteniendo información sobre CHOST, CFLAGS y CXXFLAGS">
# <i>info gcc</i>
<comment>(Seleccione "Invoking gcc")</comment>
<comment>(Seleccione "Optimize options")</comment>
</pre>

<p>
Si <c>DEBUGBUILD</c> está definida, Portage no hará un "strip" de los binarios
y las librerías para facilitar el "debugging". Esto ralentizará su sistema y
incrementará el tamaño de los ficheros.
</p>

<pre caption="La variable DEBUGBUILD">
<comment># No configure esta opción a "false"; en vez de eso elimine la linea. El Portage no</comment>
<comment># comprueba el valor, tan solo comprueba que la variable está definida.</comment>
DEBUGBUILD="true"
</pre>

<p>
La variable <c>MAKEOPTS</c> se usa por <c>make</c>, una herramienta para
facilitar la compilación de un paquete. Se define normalmente para indicarle a
<c>make</c> que ejecute diferentes compilaciones simultáneamente (especialmente
si dispone de un sistema multiprocesador, o está usando <c>distcc</c> como se
describió anteriormente).
</p>

<p>
Para que <c>make</c> ejecute tres compilaciones simultáneas, configure la
variable <c>MAKEOPTS</c> a <c>-j3</c>:
</p>

<pre caption="La variable MAKEOPTS">
MAKEOPTS="-j3"
</pre>

<p>
La variable <c>ROOT</c> no puede ser configurada en el 
<path>/etc/make.conf</path>, pero si como una variable de entorno. El Portage
comprobará está variable para averiguar donde necesita ser instalado el
paquete. Por supuesto, el valor por defecto es <path>/</path>. Por ejemplo, le
mostramos como instalar <c>gnumeric</c> en <path>/mnt/gentoo</path> en vez de
su sistema en ejecución:
</p>

<pre caption="La variable ROOT">
# <i>ROOT="/mnt/gentoo" emerge gnumeric</i>
</pre>
</body>
</subsection>

<subsection>
<title>Formato de la Salida</title>
<body>

<p>
Por defecto, el Portage colorea su salida para facilitar la legibilidad. Si no
es esto lo que desea, configure la variable <c>NOCOLOR</c> a <c>true</c>:
</p>

<pre caption="La variable NOCOLOR">
NOCOLOR="true"
</pre>

</body>
</subsection>
</section>
<section>
<title>Recursos</title>
<subsection>
<title>Las Páginas del Manual</title>
<body>

<p>
Si necesita una referencia rápida de todas las variables listadas, por favor
consulte la página del manual de <path>make.conf</path>:
</p>

<pre caption="Consultando la página del manual de make.conf">
# <i>man make.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Ejemplos Comentados</title>
<body>

<p>
El fichero <path>/etc/make.conf</path> contiene grandes cantidades de
comentarios, incluyendo ejemplos que puede encontrar interesantes. No obstante,
mucha gente no actualiza sus <path>/etc/make.conf</path> interactivamente y
consecuentemente pierde las actualizaciones de los ficheros. Puede encontrar la
versión más reciente del <path>/etc/make.conf</path> en nuestro
<uri
link="http://www.gentoo.org/cgi-bin/viewcvs.cgi/*checkout*/portage/cnf/make.conf?rev=HEAD&amp;cvsroot=gentoo-src&amp;content-type=text/plain">Repositorio
ViewCVS Online</uri>.
</p>

</body>
</subsection>
</section>
</sections>
