<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/handbook/hb-net-advanced.xml,v 1.3 2005/08/16 02:05:07 yoswink Exp $ -->

<sections>

<version>1.3</version>
<date>2005-08-14</date>

<section>
<title>Configuración Avanzada</title>
<body>

<p>
La variable config_eth0 es el corazón de la configuración de una 
interfaz. Es una lista de instrucciones de alto nivel para configurar
la interfaz (eth0 en este caso). Cada comando en la lista de instrucciones
se ejecuta de manera secuencial. La interfaz será evaluada como OK si, 
al menos, un comando funciona.
</p>

<p>
Aquí tiene una lista de instrucciones integradas:
</p>

<table>
  <tr>
    <th>Comando</th>
    <th>Descripción</th>
  </tr>
  <tr>
    <ti>null</ti>
    <ti>No hace nada</ti>
  </tr>
  <tr>
    <ti>noop</ti>
    <ti>
      Si la interfaz está funcionando y existe una dirección entonces aborta
      la configuración con éxito.
    </ti>
  </tr>
  <tr>
    <ti>una dirección IPv4 o IPv6</ti>
    <ti>Añade la dirección a la interfaz</ti>
  </tr>
  <tr>
    <ti>
      dhcp, adsl o apipa (o un comando propio perteneciente a un módulo 
      de terceras partes)
    </ti>
    <ti>
      Ejecuta el módulo que proporciona el comando. Por ejemplo "dhcp"
      ejecutará un módulo que proporcione dhcp, que pudiera ser uno 
      cualquiera de los siguientes: dhcpcd, udhcpc, dhclient o pump.
    </ti>
  </tr>
</table>

<p>
Si un comando falla, puede especificar un comando de retorno (fallback). 
El retorno tiene que coincidir exactamente con la estructura de la 
configuración.
</p>

<p>
Puede encadenar estos comandos. Aquí se muestran algunos ejemplo reales:
</p>

<pre caption="Ejemplos de configuración">
<comment># Añadir tres direcciones IPv4</comment>
config_eth0=(
	"192.168.0.2/24"
	"192.168.0.3/24"
	"192.168.0.4/24"
)

<comment># Añadir una dirección IPv4 y dos IPv6</comment>
config_eth0=(
	"192.168.0.2/24"
	"4321:0:1:2:3:4:567:89ab"
	"4321:0:1:2:3:4:567:89ac"
)

<comment># Mantener la dirección asignada por el kernel, a menos que la 
interfaz se caiga, entonces asignar otra vía DHCP. Si DHCP falla entonces
añadir una dirección estática determinada mediante APIPA</comment>

config_eth0=(
	"noop"
	"dhcp"
)
fallback_eth0=(
	"null"
	"apipa"
)
</pre>

<note>
Cuando se utiliza el módulo ifconfig y se añade más de una dirección, se
crean alias de interfaz para cada dirección extra. De esta manera los dos
ejemplos anteriores tendrán interfaces eth0, eth0:1 y eth0:2.
No se puede hacer nada especial con estas interfaces ya que el kernel y 
otros programas simplemente tratan eth0:1 y eth0:2 como eth0.
</note>

<impo>
¡La orden de retorno es importante! Si no especificamos la opción "null",
el comando "apipa" solamente sería ejecutado si el comando "noop" falla.
</impo>

<note>
<uri link="?part=4&amp;chap=3#apipa">APIPA</uri> y
<uri link="?part=4&amp;chap=3#dhcp">DHCP</uri> serán tratados más adelante.
</note>

</body>
</section>
<section>
<title>Dependencias de red</title>
<body>

<p>
Los scripts en <path>/etc/init.d</path> pueden depender de una interfaz de 
red específica o, simplemente, de net (red). "net" puede definirse en 
<path>/etc/conf.d/rc</path> ya que puede significar cosas distintas utilizando
la variable <c>RC_NET_STRICT_CHECKING</c>.
</p>

<table>
  <tr>
    <th>Valor</th>
    <th>Descripción</th>
  </tr>
  <tr>
    <ti>none</ti>
    <ti>El servicio net se considera siempre funcionando</ti>
  </tr>
  <tr>
    <ti>no</ti>
    <ti>
      Básicamente significa que al menos uno de los servicios net.* 
      sin contar net.lo debe estar funcionando. Esto podría ser usado
      por los usuarios de equipos portátiles que tienen una conexión 
      wifi y una estática y solamente quieren tener una activa
      para que el servicio net aparezca como funcionando.
    </ti>
  </tr>
  <tr>
    <ti>lo</ti>
    <ti>
      Es la misma que la opción 'no' pero net.lo también cuenta. Esto 
      puede ser útil para la gente que no le importa que alguna interfaz 
      en concreto se active durante el arranque.
    </ti>
  </tr>
  <tr>
    <ti>yes</ti>
    <ti>
      Con esto TODAS las interfaces de red DEBEN estar activas para que el
      servicio 'net' se considere funcionando.
    </ti>
  </tr>
</table>

<p>
Pero, ¿ y que pasa si net.br0 depende de net.eth0 y net.eth1?
net.eth1 podría ser un dispositivo wireless o ppp que necesita configurarse
antes de añadirse al puente.
Esto no puede hacerse en <path>/etc/init.d/net.br0</path> ya que es un 
enlaces simbólico a net.lo.
</p>

<p>
La respuesta es hacer nuestra propia función depend() en 
<path>/etc/conf.d/net</path>
</p>

<pre caption="dependencia de net.br0 en /etc/conf.d/net">
<comment># Puede utilizar cualquier tipo de dependencia (use, after, before) 
que puede encontrar en los actuales scripts</comment>

depend_br0() {
	need net.eth0 net.eth1
}
</pre>

<p>
Para una lectura más detallada sobre dependencias, consulte la sección
<uri link="?part=2&amp;chap=4#doc_chap4">
 "Guiones de Inicio"</uri> en el manual de Gentoo.
</p>

</body>
</section>

<section id="variable_name">
<title>Nombre de variables y valores</title>
<body>

<p>
Los nombre de variables son dinámicos. Normalmente sigue la estructura 
<c>variable_${interface|mac|essid|apmac}</c>. Por ejemplo, la variable 
<c>dhcpcd_eth0</c> guarda los valores para las opciones de dhcpcd para eth0
y <c>dhcpcd_essid</c> los valores para dhcpcd cuando cualquier interfaz se
conecta al essid "essid".
</p>

<p>
Sin embargo, no hay ninguna regla que indique que los nombre de las interfaces
sean ethx. De hecho, muchas interfaces wireless tienen nombres como wlanx, rax 
o ethx. También, algunas interfaces definidas por el usuario como pueden ser
puentes puede tener cualquier nombre, como foo. Para hacer la vida un poco más
interesante, los puntos de acceso wireless pueden tener nombres con caracteres
no alfanuméricos - esto es importante porque puede configurar los parámetros de
red por ESSID.
</p>

<p>
La desventaja de todo esto es que Gentoo usa variables bash para la red -
y bash no puede utilizar nada fuera de caracteres alfanuméricos ingleses.
Para solucionar esta limitación cambiamos cada carácter que no sea alfanumérico
inglés por un carácter "_".
</p>

<p>
Otra desventaja de bash es el contenido de las variables - algunos caracteres 
necesitan especificarse de manera especial. Esto se hace utilizando \ delante
del carácter. A continuación tenemos una lista de caracteres especiales que 
necesitamos indicar de esta manera. <c>"</c>,<c>'</c> y <c>\</c>.
</p>

<p>
En este ejemplo utilizamos ESSID wireless ya que puede contener un amplio
abanico de caracteres. Deberemos utilizar ESSID <c>My "\ NET</c>:
</p>

<pre caption="ejemplo de nombre para la variable">
<comment># Esto funciona, pero el dominio no es válido</comment>
dns_domain_My____NET="My \"\\ NET"

<comment># Lo que hay arriba configura el dominio dns a My "\ NET cuando una 
# tarjeta wireless se conecta a un AP cuyo ESSID es My "\ NET</comment>
</pre>

</body>
</section>
</sections>
