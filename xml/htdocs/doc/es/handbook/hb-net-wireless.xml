<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.0 -->

<sections>

<version>1.2</version>
<date>2005-08-02</date>

<section>
<title>Introducción</title>
<body>

<p>
Actualmente soportamos la configuración de redes inalámbricas con
wireless-tools o wpa_supplicant. Lo importante para recordar es que 
una red inalámbrica se configura de manera global y no por interfaz.
</p>

<p>
La mejor opción es wpa_supplicant, pero no soporta todos los controladores.
Para una lista completa de controladores soportados, lea la 
<uri link="http://hostap.epitest.fi/wpa_supplicant">página de 
wpa_supplicant</uri>. Además, actualmente wpa_supplicant sólo puede 
conectarse a SSIDs para los cuales haya sido configurado.
</p>

<p>
Los wireless-tools soportan casi todas las tarjetas y controladores, pero no
puede conectarse a PAs (puntos de acceso) con WPA solamente.
</p>

<warn>
Actualmente el controlador linux-wlan-ng no está soportado por
baselayout. Esto es debido a que linux-wlan-ng tiene su propio configurador
y su configuración es completamente diferente a las demás. Se rumora
que los desarrolladores de linux-wlan-ng están pensando en cambiar su
configuración a wireless-tools. Al suceder esto, podremos utilizar
linux-wlan-ng con baselayout.
</warn>
</body>
</section>

<section>
<title>WPA Supplicant</title>
<body>

<p>
El <uri link="http://hostap.epitest.fi/wpa_supplicant">WPA
Supplicant</uri> es un paquete que permite conectarse a puntos de
acceso habilitados con WPA. Su configuración está en estado cambiante,
por estar todavía en beta, pero generalmente funciona a la perfección.
</p>

<pre caption="Instalación de wpa_supplicant">
# <i>emerge net-wireless/wpa_supplicant</i>
</pre>

<impo>
Debe activar CONFIG_PACKET en su kernel para que funcione wpa_supplicant.
</impo>

<p>
Ahora debemos configurar <path>/etc/conf.d/net</path> para preferir
wpa_supplicant a wireless-tools (si ambos están instalados, wireless-tools
será usado por defecto).
</p>

<pre caption="Configurar /etc/conf.d/net para wpa_supplicant">
<comment># Preferimos wpa_supplicant sobre wireless-tools</comment>
modules=( "wpa_supplicant" )

<comment># Es importante decirle a wpa_supplicant cuál controlador
# debemos usar ya que todavía no adivina bien</comment>
wpa_supplicant_eth0="-Dmadwifi"
</pre>

<note>
Si está usando el controlador host-ap, hará falta colcoar el interfaz
en modalidad manejada antes de poder usarlo correctamente con
wpa_supplicant. Para esto puede usar <e>iwconfig_eth0="mode managed"</e> en
<c>/etc/conf.d/net</c>.
</note>

<p>
Eso fue sencillo, ¿verdad? Sin embargo, todavía nos queda configurar
wpa_supplicant, que es algo más difícil, dependiendo de cuán
seguros son los PAa a los cuales tratamos de conectarnos. A
continuación mostramos un ejemplo simplificado del archivo
<path>/etc/wpa_supplicant.conf.example</path>, parte del 
paquete wpa_supplicant.
</p>

<pre caption="Un ejemplo de /etc/wpa_supplicant.conf">
<comment># No cambie la siguiente línea, a riesgo que no funcione</comment>
ctrl_interface=/var/run/wpa_supplicant

<comment># Asegúrese que sólo root puede leer la configuración de WPA</comment>
ctrl_interface_group=0

<comment># Permítale a wpa_supplicant encargarse del barrido y selección de los PA</comment>
ap_scan=1

<comment># Caso sencillo: WPA-PSK, PSK como contraseña-frase ASCII,
# permitiendo todas las encriptaciones válidas</comment>
network={
	ssid="sencillo"
	psk="contrasenha-frase muy secreta"
	<comment># Mientras más alta la prioridad, más rápido nos conectaremos</comment>
	priority=5
}

<comment># Igual que el ejemplo anterior, pero barriendo por un SSID
# específico (para los PAs que rechazan transmitir el SSID)</comment>
network={
	ssid="segundo ssid"
	scan_ssid=1
	psk="contrasenha-frase muy secreta"
	priority=2
}

<comment># Solamente estamos usando WPA-PSK. Se aceptada cualquier encriptación válida</comment>
network={
	ssid="ejemplo"
	proto=WPA
	key_mgmt=WPA-PSK
	pairwise=CCMP TKIP
	group=CCMP TKIP WEP104 WEP40
	psk=06b4be19da289f475aa46a33cb793029d4ab3db7a23ee92382eb0106c72ac7bb
	priority=2
}

<comment># Conexión sin encriptar (sin WPA, o IEEE 802.1X)</comment>
network={
	ssid="prueba-noencriptada"
	key_mgmt=NONE
}

<comment># Conexión con clave WEP compartida (sin WPA, o IEEE 802.1X)</comment>
network={
	ssid="prueba-estatica-wep"
	key_mgmt=NONE
	wep_key0="abcde"
	wep_key1=0102030405
	wep_key2="1234567890123"
	wep_tx_keyidx=0
	priority=5
}

<comment># Conexión con clave WEP compartida (sin WPA, o IEEE 802.1X)
# usando autentificación con clave compartida IEEE 802.11</comment>
network={
	ssid="prueba-estatica-wep2"
	key_mgmt=NONE
	wep_key0="abcde"
	wep_key1=0102030405
	wep_key2="1234567890123"
	wep_tx_keyidx=0
	priority=5
	auth_alg=SHARED
}

<comment># Red IBSS/ad-hoc con WPA-None/TKIP</comment>
network={
	ssid="prueba adhoc"
	mode=1
	proto=WPA
	key_mgmt=WPA-NONE
	pairwise=NONE
	group=TKIP
	psk="contrasenha-frase secreta"
}
							
</pre>									
</body>
</section>

<section>
<title>Wireless Tools</title>

<subsection>
<title>Configuración inicial y modo manejado</title>
<body>

<p>
Los <uri link="http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html">
Wireless Tools</uri> proveen una manera genérica para configurar
los interfaces inalámbricos básicos hasta el nivel de seguridad
WEP. Aunque WEP es un sistema de seguridad débil, también es el
más prevalente.
</p>

<p>
La configuración de Wireless Tools es controlado por algunas variables
principales. El archivo ejemplo de configuración a continuación
deberá describir todo lo requerido. Algo para mantener presente es
que ninguna configuración significa "conectarse al punto de acceso sin
encriptación que tenga la señal más fuerte" - de manera que siempre
tratará de conectarse con lo que sea.
</p>

<pre caption="Instalando los wireless-tools">
# <i>emerge net-wireless/wireless-tools</i>
</pre>

<note>
Aunque pueda almacenar su configuración inalámbrica en
<path>/etc/conf.d/wireless</path>, esta guía le recomienda hacerlo en
<path>/etc/conf.d/net</path>.
</note>

<impo>
<b>Hará falta</b> consultar la documentación acerca de <uri
link="?part=4&amp;chap=2#variable_name">nombres de variables</uri>.
</impo>

<pre caption="Configuración ejemplo con iwconfig en /etc/conf.d/net">
<comment># Prefiera iwconfig sobre wpa_supplicant</comment>
modules=( "iwconfig" )

<comment># Configure las claves WEP para los PAs ESSID1 y ESSID2</comment>
<comment># Pueden configurarse hasta 4 claves WEP, pero solo una puede
# estar activa a la vez, así que tenemos un índice por defecto
# de [1] para la clave [1] y luego otra vez para cambiar la clave activa a [1]
# Hacemos esto en caso que defina otros ESSIDs para usar claves WEP que no sean 1
# El prefijar la clave con s: significa que es una clave ASCII,
# porque sino es una clave HEX
# enc open especifica seguridad abierta (máxima seguridad)
# enc restricted especifica seguridad restringida (menos segura)</comment>
key_ESSID1="[1] s:suclaveaqui key [1] enc open"
key_ESSID2="[1] aaaa-bbbb-cccc-dd key [1] enc restricted"

<comment># Los ejemplos a continuación solo funcionan una vez que se
# haya barrido para los PAs disponibles.</comment>

<comment># A veces se registra más de un PA, así que hará falta definir
# un órden de preferencia para conectarse</comment>
preferred_aps=( "ESSID1" "ESSID2" )
</pre>
</body>
</subsection>

<subsection>
<title>Afinamiento en la selección de puntos de acceso</title>
<body>

<p>
Puede agregar opciones adicionales para afinar la selección de puntos
de acceso, pero normalmente esto no hace falta.
</p>

<p>
Puede decidirse si conectarse solamente a PAs preferidos o no. Por
defecto, si falla todo lo configurado y nos podemos conectar a un PA
no encriptado, entonces se hará. Esto puede ser controlado con la
variable <c>associate_order</c> (órden asociado). Sigue una tabla de
valores y como estos ejercen este control.
</p>

<table>
  <tr>
    <th>Valor</th>
    <th>Descripción</th>
  </tr>
  <tr>
    <ti>any</ti>
    <ti>(cualquiera) Comportamiento por defecto</ti>
  </tr>
  <tr>
    <ti>preferredonly</ti>
    <ti>(solo preferidos) Solamente nos conectaremos a PAs
    visibles en la lista de preferidos</ti>
  </tr>
  <tr>
    <ti>forcepreferred</ti>
    <ti>(obligado a preferidos) Nos conectaremos obligatoriamente a los
    PAs en el órden preferido aunque no se encuentren en un barrido</ti>
  </tr>
  <tr>
    <ti>forcepreferredonly</ti>
    <ti>(solamente preferidos obligados) No barrer buscando PAs
    - solo tratar de conectar a cada uno en órden</ti>
  </tr>
  <tr>
    <ti>forceany</ti>
    <ti>(obligar a cualquiera) Igual que forcepreferred y conectar a
    cualquier otro disponible</ti>
  </tr>
</table>

<p>
Finalmente podemos hacer una lista negra de PAs (blacklist_aps) y
seleccionar un único PA (unique_ap). blacklist_aps funciona de manera
similar a preferred_aps. unique_ap es un valor si o no (yes o no) que
determina si un segundo interfaz inalámbrico se puede conectar al
mismo punto de acceso que el primer interfaz.
</p>

<pre caption="Ejemplo de blacklist_aps y de unique_ap">
<comment># A veces nunca queremos conectarnos a algunos PAs</comment>
blacklist_aps=( "ESSID3" "ESSID4" )

<comment># Si tiene más de una tarjeta inalámbrica, puede determinar
# que cada interfaz se asocie al mismo PA o no
# Los valores son "yes" y "no"
# El valor por defecto es "yes"</comment>
unique_ap="yes"
</pre>
</body>
</subsection>

<subsection>
<title>Modos Ad-Hoc y Master</title>
<body>

<p>
Si desea establecerse como un nodo Ad-Hoc al no lograr conectarse a
algún PA en modo manejado, puede hacerlo también.
</p>

<pre caption="Usar modo ad-hoc en caso de no conectar en modo manejado">
adhoc_essid_eth0="This Adhoc Node"
</pre>

<p>
Y ¿qué tal conectarse a redes Ad-Hoc o funcionar en modo Master para
convertirse en PA? ¡Aquí tenemos un configuración justo para eso! Tal
vez tenga que especificar alguna clave WEP como se muestra arriba.
</p>

<pre caption="Ejemplo de configuración ad-hoc/master">
<comment># Establezca el modo - que puede ser manejado (por defecto), ad-hoc o master
# No todos los manejadores soportan todos los modos</comment>
mode_eth0="ad-hoc"

<comment># Establezca el ESSID del interfaz
# En modo manejado, esto obliga el interfaz intentar conectarse al
# ESSID especificado solamente</comment>
essid_eth0="This Adhoc Node"

<comment># Usamos el canal 3 si no se establece otro</comment>
channel_eth0="9"
</pre>

<impo>
A continuación citamos la documentación wavelan de BSD encontrado en 
<uri link="http://www.netbsd.org/Documentation/network/wavelan.html">
la documentación de NetBSD</uri><br/><br/>
Existen 14 canales posibles; Se nos informa que los canales 1-11 son
legales para Norteamérica , los canales 1-13 para la mayor parte de
Europa, los canales 10-13 para Francia y sólo el canal 14 para el
Japón. En caso de duda, por favor refiérase a la documentación que
acompaña la tarjeta o el PA. Asegúrese que el canal que selecciona es
el mismo del PA (o de la otra tarjeta en caso de ser red ad-hoc). Para
las tarjetas vendidas en Norteamérica y la mayor parte de Europa, es
el canal 3 por defecto; en Francia el 11 y en el Japón es el 14.
</impo>
</body>
</subsection>

<subsection>
<title>Solucionando problemas con Wireless Tools</title>
<body>

<p>
Existen más variables que sirven para ayudar a configurar y operar una
red inalámbrica por problemas ambientales o del manejador. Aquí
presentamos una tabla de otras cosas para intentar.
</p>

<table>
  <tr>
    <th>Variable</th>
    <th>Valor por defecto</th>
    <th>Descripción</th>
  </tr>
  <tr>
    <ti>iwconfig_eth0</ti>
    <ti/>
    <ti>Vea la página man de iwconfig para detalles acerca de qué
    enviar a iwconfig</ti>
  </tr>
  <tr>
    <ti>iwpriv_eth0</ti>
    <ti/>
    <ti>Vea la página man de iwpriv para detalles acerca de qué enviar
    a iwpriv</ti>
  </tr>
  <tr>
    <ti>sleep_scan_eth0</ti>
    <ti>0</ti>
    <ti>
      La cantidad en segundos a dormir antes de intentar un
      barrido. Esto hace falta cuando el manejador/firmware requiere
      de más tiempo para activarse antes de poder usarlos.
    </ti>
  </tr>
  <tr>
    <ti>sleep_associate_eth0</ti>
    <ti>5</ti>
    <ti>
      La cantidad en segundos a esperar para que el interfaz se asocie
      con el PA antes de continuar al siguiente.
    </ti>
  </tr>
  <tr>
    <ti>associate_test_eth0</ti>
    <ti>MAC</ti>
    <ti>
      Algunos manejadores no resetean la dirección MAC asociada a una
      inválida cuando pierden la señal o intentan asociarse.<br/>
      Algunos manejadores no resetean el nivel de calidad cuando
      pierden la señal o intentan asociarse.<br/>
      La configuraciones válidas son  MAC, quality y all.
    </ti>
  </tr>
  <tr>
    <ti>scan_mode_eth0</ti>
    <ti/>
    <ti>
      Algunos manejadores tienen que hacer el barrido en modo ad-hoc,
      así que, si falla el barrido, intente configurar aquí como ad-hoc.
    </ti>
  </tr>
  <tr>
    <ti>iwpriv_scan_pre_eth0</ti>
    <ti/>
    <ti>
      Envía algunos comandos iwpriv al interfaz antes del barrido<br/>
      Vea la página man de iwpriv para más detalles.
    </ti>
  </tr>
  <tr>
    <ti>iwpriv_scan_post_eth0</ti>
    <ti/>
    <ti>
      Envía algunos comandos iwpriv al interfaz después del barrido<br/>
      Vea la página man de iwpriv para más detalles.
    </ti>
  </tr>
</table>
</body>
</subsection>

</section>

<section>
<title>Definiendo la configuración de la red por ESSID</title>
<body>

<p>
Cuando se conecta a ESSI1 requiere una dirección IP estática y cuando
se conecta a ESSID2, requiere DHCP. De hecho, casi todos las variables
de módulo pueden cambiarse por ESSID. A continuación mostramos cómo se
hace.
</p>

<note>
Esto funciona sin importar si usa WPA Supplicant o Wireless Tools.
</note>

<impo>
<b>Necesitará</b> consultar la documentación <uri
link="?part=4&amp;chap=2#variable_name">variable name</uri>.
</impo>

<pre caption="Reemplazar configuración de red por ESSID">
config_ESSID1=( "192.168.0.3/24 brd 192.168.0.255" )
routes_ESSID1=( "default via 192.168.0.1" )

config_ESSID2=( "dhcp" )
fallback_ESSID2=( "192.168.3.4/24" )
fallback_route_ESSID2=( "default via 192.168.3.1" )

<comment># Podemos definir servidores DNS y otras cosas también</comment>
<comment># NOTA: DHCP reemplazará esta configuración si no se
le pide que no lo haga</comment>
dns_servers_ESSID1=( "192.168.0.1" "192.168.0.2" )
dns_domain_ESSID1="algun.dominio"
dns_search_domains_ESSID1="busque.eneste.dominio busque.enaquel.dominio"

<comment># Reemplace usando la dirección MAC del PA
# Esto es muy útil si usa distintas ubicaciones con el mismo ESSID</comment>
config_001122334455=( "dhcp" )
dhcpcd_001122334455="-t 10"
dns_servers_001122334455=( "192.168.0.1" "192.168.0.2" )
</pre>
</body>
</section>
</sections>
