<?xml version='1.0' encoding='UTF-8'?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/quick-samba-howto.xml,v 1.1 2006/02/16 12:06:26 chiguire Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<guide link="/doc/es/quick-samba-howto.xml" lang="es">
<title>Guía Gentoo Samba3/CUPS/ClamAV</title>
<author title="Autor">
  <mail link="daff at dword dot org">Andreas "daff" Ntaflos</mail>
</author>
<author title="Autor">
  <mail link="joshua@sungentoo.homeunix.com">Joshua Preston</mail>
</author>
<author title="Traductor">
  <mail link="rlazo.paz@gmail.com">Rodrigo Lazo</mail>
</author>
<author title="Traductor">
  <mail link="warp3r@gmail.com">Jordi Molina</mail>
</author>

<abstract>
Preparar, instalar y configurar un servidor Samba bajo Gentoo para compartir
impresoras y archivos sin necesidad de instalar controladores, al mismo tiempo
que se provee un barrido de virus automáticamente.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->
<license/>

<version>1.12</version>
<date>2005-03-26</date>

<chapter>
<title>Introducción a esta guía</title>
<section>
<title>Propósito</title>
<body>

<p>
Esta guía está diseñada para ayudarte en la transición de una red con
muchos clientes distintos hablando diferentes idiomas a otra con
múltiples clientes diferentes que se comunican con un lenguaje común. 
El objetivo final es ayudarte a crear un ambiente de coexistencia de
distintas arquitecturas y tecnologías para que trabajen juntas de una
manera productiva.
</p>

<p>
Si sigues las líneas trazadas en esta Guía, estás deben ayudarte a dar
un importante paso adelante hacía la coexistencia amigable entre
Windows, y virtualmente todas las variaciones de *nix conocidas.
</p>

<p>
Esta guía originalmente no empezó como tal, sino como un PUF
(Preguntas de Uso Frecuente). Tenía como intención explorar la
funcionalidad y el poder de un sistema Gentoo, portage y la
flexibilidad que entregan las banderas USE. Al igual que muchos otros
proyectos, se descubrió rápidamente lo que faltaba en el territorio
Gentoo: no existía ninguna guía Samba especialmente diseñada para los
usuarios de Gentoo; que son más demandantes que la mayoría; ellos
requieren desempeño, flexibilidad y personalización. Esto, sin
embargo, no significa que esta guía no tenga como objetivo otras
distribuciones; sino que está diseñada para trabajar con una versión
altamente personalizada de Samba.
</p>

<p>
Se describirá como compartir archivos e impresoras entre PCs Windows y
PCs *nix. También se demostrará el uso de la característica VFS
(Sistema de Archivos Virtual) de Samba para incorporar protección
automática contra virus. Como punto final, también se mostrará como
montar y manipular lo compartido.
</p>

<p>
Existen algunos temas que serán mencionados pero que escapan del
alcance de esta guía. Eso se hará notar cuando se presente el caso.
</p>

<p>
Esta guía está basada en una compilación y reunión del excelente COMO
proveido en los <uri link="http://forums.gentoo.org">Foros de
Gentoo</uri> por Andreas "daff" Ntaflos y una colección de
conocimientos de Joshua Preston.  Los enlaces a estas discusiones se
proveen más abajo como referencia:
</p>

<ul>
  <li>
    <uri link="http://forums.gentoo.org/viewtopic.php?t=110931">COMO
    CUPS+Samba: impresiones para Windows &amp; Linux (en inglés)</uri>
  </li>
</ul>

</body>
</section>
<section>
<title>Antes que utilices esta guía</title>
<body>

<p>
Existen muchas otras guías para configurar CUPS y/o Samba. Por favor,
leelas también, ya que te dirán cosas que están fuera de esta guía
(intencionalmente o no). Uno de tales documentos que es muy útil y
está muy bien escrito es la <uri
link="/doc/en/printing-howto.xml">Guía de Impresión Gentoo</uri>, ya
que discute problemas de configuración e instalación específicos de la
impresora que no se tratan aquí.
</p>

</body>
</section>
<section>
<title>Pequeño vistazo general</title>
<body>

<p>
Luego de presentar varias banderas USE, la siguiente lista muestra
todos los tópicos cubiertos como son presentados:
</p>

<ul>
  <li>En el servidor Samba:
    <ul>
      <li>Instalación y configuración de ClamAV</li>
      <li>Instalación y configuración de Samba</li>
      <li>Instalación y configuración de CUPS</li>
      <li>Cómo agregar impresoras a CUPS</li>
      <li>Cómo añadir los manejadores PS para los clientes
      Windows</li>
    </ul>
  </li>
  <li>En los clientes Unix:
    <ul>
      <li>Instalación y configuración de CUPS</li>
      <li>Configurar una impresora por defecto</li>
      <li>Montaje de información compartida Windows o Samba</li>
    </ul>
  </li>
  <li>En los clientes Windows:
    <ul>
       <li>Configuración de la impresora</li>
       <li>Accediendo a la información compartida por Samba</li>
    </ul>
  </li>
</ul>

</body>
</section>
<section>
<title>Requerimientos</title>
<body>

<p>
Necesitaremos lo siguiente:
</p>

<ul>
  <li>net-fs/samba</li>
  <li>app-antivirus/clamav</li>
  <li>net-print/cups</li>
  <li>net-print/foomatic</li>
  <li>net-print/hpijs (si tienes una impresora HP)</li>
  <li>Un núcleo apropiado (de preferencia 2.4.24+ o 2.6.x)</li>
  <li>Una impresora (PS o no-PS, quizás no MUY nueva o
  estrafalaria)</li>
  <li>
    Una conexión a red funcionando (casa/oficina/etc que consista en
    más de una máquina)
  </li>
</ul>

<p>
El principal paquete que utilizaremos es net-fs/samba. Sin embargo,
necesitarás un núcleo con soporte para smbfs activado, de manera que
puedas montar lo compartido por otra máquina a través de samba o
Windows. CUPS también será instalado si es que aún no lo está. Además
utilizaremos app-antivirus/clamav, pero otros antivirus también deben
funcionar con pocas modificaciones para que trabajen con Samba. El
ebuild de samba proveido por Gentoo tiene soporte para todo tipo de
tecnologías de escaneo de virus, como Sophos, FProt, Fsav, Trend,
Icap, Nai, ...
</p>

</body>
</section>
</chapter>

<chapter>
<title>Llegando a conocer Samba</title>
<section>
<title>Las banderas USE</title>
<body>

<p>
Antes de instalar nada, démosle una mirada a las varias banderas USE
que tiene disponibles Samba.
</p>

<pre caption="Samba utiliza las siguientes variables USE:">
kerberos mysql xml acl cups ldap pam readline python oav libclamav
</pre>

<p>
Dependiendo de la topología de red y de los requerimientos específicos
del servidor, las banderas USE mostradas más abajo serán definidas
para incluir o no cierto soporte al momento de instalar Samba.
</p>

<table>
<tr>
  <th><b>Bandera USE</b></th>
  <th>Descripción</th>
</tr>
<tr>
  <th><b>kerberos</b></th>
  <ti>
    Incluye soporte para Kerberos. El servidor necesitará esta opción
    si va a trabajar sobre un dominio o Directorio Activo ya
    existente. Revisa la nota más abajo para mayor información.
  </ti>
</tr>
<tr>
  <th><b>mysql</b></th>
  <ti>
    Esto permitirá que Samba utilice MySQL para la autenticación de
    contraseñas. Almacenará ACLs, nombres de usuario, contraseñas, etc
    en la base de datos en ves de hacerlo en un archivo de texto
    plano. Si Samba necesita realizar autenticación de contraseñas, si
    funciona como un servidor de validación de contraseñas o un
    Controlador Primario de Dominio (PDC).
  </ti>
</tr>
<tr>
  <th><b>xml</b></th>
  <ti>
    Esta bandera USE permitirá a Samba proveer un soporte en la base
    de datos de contraseñas, almacenando la información en forma de
    archivos XML, por la misma razón listada en la descripción de la
    bandera USE mysql.
  </ti>
</tr>
<tr>
  <th><b>acl</b></th>
  <ti>
    Habilita las Listas de Control de Acceso. El soporte ACL en Samba
    utiliza una partición ext2/ext3 parchada, o XFS de SGI para
    funcionar de manera adecuada ya que extiende los permisos de
    acceso sobre archivos y directorios para hacerlos más detallados;
    mucho más que el esquema habitual *nix de GID/UID.
  </ti>
</tr>
<tr>
  <th><b>cups</b></th>
  <ti>
    Activa el soporte para el Sistema Común de Impresión Unix. Esto
    provee una interfaz de manera que se pueda compartir la impresora
    local CUPS con otros sistemas de la red.
  </ti>
</tr>
<tr>
  <th><b>ldap</b></th>
  <ti>
    Activa el soporte para el Protocolo de Acceso de Directorio Ligero
    (LDAP). Si Samba va a utilizar Active Directory, se debe activar
    esta opción. Se necesitaría en caso que Samba deba autenticarse o
    proveer autenticación hacía un Servidor de Directorio/Dominio
    Activo. Se debe utilizar junto con la bandera USE kerberos para
    que funcione apropiadamente.
  </ti>
</tr>
<tr>
  <th><b>pam</b></th>
  <ti>
    Añade el soporte para los módulos extensibles de autenticación
    (PAM). Esto permite que los usuarios se autentiquen en tu servidor
    Samba, que se requiere si los usuarios tienen que ingresar al
    sistema de tu servidor. Se recomienda utilizar conjuntamente la
    bandera USE kerberos.
  </ti>
</tr>
<tr>
  <th><b>readline</b></th>
  <ti>
    Enlaza Samba con libreadline. Es altamente recomendado y no
    deberías desactivarla.
  </ti>
</tr>
<tr>
  <th><b>oav</b></th>
  <ti>
    Provee revisión durante el acceso de lo compartido por Samba
    utilizando el demonio FRISK F-Prot, Kaspersky AntiVirus,
    OpenAntiVirus.org ScannerDaemon, Sophos Sweep (SAVI), Symantec
    CarrierScan, y Trend Micro (VSAPI).
  </ti>
</tr>
<tr>
  <th><b>libclamav</b></th>
  <ti>
    Utiliza la librería ClamAV en vez del demonio clamd.
  </ti>
</tr>
</table>

<p>
Un par de cosas que valen la pena ser mencionadas acerca de las
banderas USE y las diferentes funcionalidades incluidas en Samba:
</p>

<ul>
  <li>
    ACLS en ext2/3 son implementadas a través de atributos extendidos
    (EAs). EA y las opciones ACL del núcleo para ext2 y/o ext3
    necesitarán ser activadas (dependiendo de cual sistema de archivos
    estás utilizando - ambas pueden ser utilizadas).
  </li>
  <li>
    Aunque las funcionalidades Directorio Activo, ACL y PDC están más
    allá del alcance de esta Guía, puede que encuentres útiles estos
    enlaces en caso que desees utilizarlas:
    <ul>
      <li><uri>http://www.bluelightning.org/linux/samba_acl_howto/</uri></li>
      <li><uri>http://open-projects.linuxcare.com/research-papers/winbind-08162000.html</uri></li>
      <li><uri>http://www.wlug.org.nz/HowtoSamba3AndActiveDirectory</uri></li>
    </ul>
  </li>
</ul>

</body>
</section>
</chapter>

<chapter>
<title>Instalación del Software del Servidor</title>
<section>
<title>Emergiendo Samba</title>
<body>

<p>
Antes de nada: asegúrate que todos los nombres de los anfitriones
(hostnames) sean resueltos de manera correcta, ya sea teniendo un
servidor de nombres de dominios (DNS) en tu red o las entradas
apropiadas en el archivo <path>/etc/hosts</path>. <c>cupsaddsmb</c>
usualmente se queja si los nombres de los anfitriones no apuntan a la
máquina correcta.
</p>

<p>
Ahora deberías ser capaz de decir que necesitas exactamente de Samba
para tu caso en particular. La configuración utilizada en esta Guía es
la siguiente:
</p>

<ul>
  <li>oav</li>
  <li>cups</li>
  <li>readline</li>
  <li>pam</li>
</ul>

<p>
Para optimizar el desempeño, tamaño y tiempo de compilación, las
banderas USE son incluidas o excluidas específicamente.
</p>

<pre caption="Emerge Samba">
# <i>echo "net-fs/samba oav readline cups pam" &gt;&gt; /etc/portage/package.use</i>
# <i>emerge net-fs/samba</i>
</pre>

<note>
Las siguientes arquitecturas necesitarán añadir <e>~</e> a sus
<e>KEYWORDS</e>: x86, ppc, sparc, hppa, ia64 y alpha
</note>

<p>
Esto emergerá Samba y CUPS (si CUPS no está instalado todavía).
</p>

</body>
</section>

<section>
<title>Emergiendo ClamAV</title>
<body>

<p>
Debido a que la bandera USE <e>oav</e> sólo provee una interfaz para
la revisión en busca de algún virus durante el acceso, el antivirus en
sí debe ser emergido. El antivirus elegido en esta guía es ClamAV.
</p>

<pre caption="Emerge Clamav">
# <i>emerge app-antivirus/clamav</i>
</pre>

</body>
</section>
<section>
<title>Emergiendo foomatic</title>
<body>

<pre caption="Emerge foomatic">
# <i>emerge net-print/foomatic</i>
</pre>

</body>
</section>
<section>
<title>Emergiendo net-print/hpijs</title>
<body>

<p>
Sólo necesitarás este paquete si utilizas una impresora HP.
</p>

<pre caption="Emerge hpijs">
# <i>emerge net-print/hpijs</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configuración del servidor</title>
<section>
<title>Configurando Samba</title>
<body>

<p>
El archivo de configuración principal de Samba es
<path>/etc/samba/smb.conf</path>. Está dividido en secciones indicadas
por [nombreseccion]. Los comentarios son o bien # o ;. Un archivo
<path>smb.conf</path> de ejemplo está incluido más abajo con
comentarios y sugerencias para su modificación. Si requieres más
detalles, mira la página del manual de <path>smb.conf</path>, el
archivo instalado <path>smb.conf.example</path>, el sitio Web de Samba
o cualquiera de los numerosos libros acerca de Samba disponibles.  
</p>

<pre caption="Un ejemplo de /etc/samba/smb.conf">
[global]
<comment># Reemplaza MIGRUPODETRABAJO con tu grupo de trabajo/dominio</comment>
workgroup = <comment>MIGRUPODETRABAJO</comment>

<comment># Por supuesto que esto no tiene ningún uso REAL más que dar a
# conocer a todos que ¡tu máquina no es Windows!
# %v imprime la versión de Samba que utilizas.</comment>
server string = Samba Server %v
<comment># Vamos a utilizar cups, así que necesitamos ponerlo aquí ;-)</comment>
printcap name = cups
printing = cups
load printers = yes
<comment># Queremos un archivo de bitácora y no lo queremos más largo que 50kb.</comment>
log file = /var/log/samba/log.%m
max log size = 50
<comment># Configuremos algunas opciones para nuestras interfaces...</comment>
socket options = TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF=8192
<comment># Esta es una buena idea, lo que vamos a hacer es conectar el
# servidor samba a nuestra red local.
# Por ejemplo, si eth0 es nuestro dispositivo de red local</comment>
interfaces = lo <i>eth0</i>
bind interfaces only = yes
<comment># Ahora especificaremos a quienes permitiremos interactuar,
# después de todo somos muy conscientes con la seguridad, ¡ya que esta 
# configuración no utiliza contraseñas!</comment>
hosts allow = 127.0.0.1 <i>192.168.1.0/24</i>
hosts deny = 0.0.0.0/0
<comment># Otras opciones para esto son USER, DOMAIN, ADS, y SERVER
# Por defecto es user</comment>
security = share
<comment># ¡No hay contraseñas, así que vamos a utilizar una cuenta invitada!</comment>
guest account = samba
guest ok = yes
<comment># Ahora implementaremos el antivirus en tiempo real.
# NOTA: Al poner esto en nuestra sección [Global], somos capaces
# de revisar TODO lo compartido, puedes opcionalmente mover esto 
# a un lugar específico y sólo revisar ese sitio en especial.</comment>

<comment># Para Samba 3.x. Esto activa la revisión en tiempo real de ClamAV.</comment>
vfs object = vscan-clamav
vscan-clamav: config-file = /etc/samba/vscan-clamav.conf

<comment># ¡Ahora configuraremos la información de los manejadores de la impresora!</comment>
[print$]
comment = Printer Drivers
path = /etc/samba/printer <comment># en esta ruta está la estructura del manejador</comment>
guest ok = yes
browseable = yes
read only = yes
<comment># Modifica esto a "username,root" si no deseas que root sea el único
# administrador de la impresora</comment>
write list = <i>root</i>

<comment># Ahora configuraremos una impresora a compartir, aunque su nombre es 
# arbitrario debe ser consiste para ambos Samba y CUPS</comment>
[HPDeskJet930C]
comment = HP DeskJet 930C Network Printer
printable = yes
path = /var/spool/samba
public = yes
guest ok = yes
<comment># Modifica esto a "username,root" si no deseas que root sea el único
# administrador de la impresora</comment>
printer admin = <i>root</i>

<comment># Ahora configuraremos cómo compartiremos las impresoras.  Debe ser
# browseable, printable, public.</comment>
[printers]   
comment = All Printers
browseable = no 
printable = yes   
writable = no
public = yes   
guest ok = yes
path = /var/spool/samba
<comment># Modifica esto a "username,root" si no deseas que root sea el único
# administrador de la impresora</comment>
printer admin = <i>root</i>

<comment># Ahora crearemos un nuevo espacio compartido en el cual se pueda leer/escribir
# desde cualquier lugar. Es algo así como un compartido temporal público, en el que 
# cualquiera puede hacer lo que quiera.</comment>
[public]
comment = Public Files
browseable = yes
public = yes
create mode = 0766
guest ok = yes
path = /home/samba/public
</pre>

<warn>
Si quieres utilizar la cuenta invitada de Samba para realizar todo lo
concerniente a la impresión desde los clientes Windows no definas
<c>guest only = yes</c> en la sección <c>[global]</c>. La cuenta
invitada parece causar problemas cuando se ejecuta <c>cupsaddsmb</c>;
usualmente cuando se quieren conectar desde máquinas Windows.

Mira más abajo, también, cuando nos referimos a <c>cupsaddsmb</c> y
los problemas que pueden surgir. Utiliza un usuario de impresión
dedicado, como <c>printeruser</c> o <c>printer</c> o <c>printme</c> o
cualquier otro. No hace ningún daño y de seguro te protegerá de muchos
problemas.
</warn>

<warn>
Activar la revisión durante el acceso de ClamAV en la sección
<c>[global]</c> reducirá el desempeño de su servidor Samba de manera
dramática.
</warn>

<p>
Ahora creemos los directorios requeridos en una configuración mínima
de Samba para compartir la impresora instalada a través de la red.
</p>

<pre caption="Crear los directorios">
# <i>mkdir /etc/samba/printer</i>
# <i>mkdir /var/spool/samba</i>
# <i>mkdir /home/samba/public</i>
</pre>

<p>
Se requiere al menos un usuario de samba para instalar los
controladores de la impresora y permitir a los usuarios conectarse a
la misma. Los usuarios deben existir en el archivo
<path>/etc/passwd</path> del sistema.
</p>

<pre caption="Creando los usuarios">
# <i>smbpasswd -a root</i> 

<comment>(En caso que otro usuario sea el administrador de la impresora)</comment>
# <i>smbpasswd -a username</i>
</pre>

<p>
Las contraseñas no necesitan ser iguales que las del sistema
especificadas en <path>/etc/passwd</path>.
</p>

<p>
También necesitarás actualizar <path>/etc/nsswitch.conf</path> para
que los sistemas Windows puedan ser encontrados fácilmente utilizando
NetBIOS:
</p>

<pre caption="Editando /etc/nsswitch.conf">
# <i>nano -w /etc/nsswitch.conf</i>
<comment>(Edita los anfitriones: line)</comment>
hosts: files dns <i>wins</i>
</pre>


</body>
</section>
<section>
<title>Configurando ClamAV</title>
<body>

<p>
El archivo de configuración especificado para ser utilizando en
<path>smb.conf</path> es
<path>/etc/samba/vscan-clamv.conf</path>. Aunque las opciones están
definidas en sus valores por defecto, la acción a tomar al encontrar
un archivo infectado quizás necesite ser cambiada.
</p>

<pre caption="/etc/samba/vscan-clamav.conf">
[samba-vscan]
<comment>; configuración en tiempo de ejecución para vscan-samba utilizando
; clamd. Todas las opciones están en sus valores por defecto</comment>

<comment>; no revisar archivos más grandes de X bytes. Si se define a 0 (por defecto),
; se deshabilita esta característica (i.e. se revisan todos los archivos)</comment>
max file size = 0

<comment>; registrar todos los accesos a los archivos (yes/no). Si lo defines en yes, 
; todos los accesos serán registrados. Si está en no (por defecto), sólo los accesos 
; a archivos infectados serán registrado</comment>
verbose file logging = no

<comment>; si lo defines a yes (por defecto), un archivo será revisado durante 
; su apertura</comment>
scan on open = yes
<comment>; si lo defines a yes, un archivo será revisado durante su cierre 
; (por defecto yes)</comment>
scan on close = yes

<comment>; si la comunicación a clamd falla, ¿debería ser denegado el acceso al archivo?
; (por defecto: yes)</comment>
deny access on error = yes

<comment>; si el demonio falla por un error menor (corrupción, etc.),
; ¿debe negarse el acceso?
; (por defecto: yes)</comment>
deny access on minor error = yes

<comment>; ¿enviar un mensaje de advertencia a través del servicio Windows Messenger
; cuando se encuentre un virus?
; (por defecto: yes)</comment>
send warning message = yes

<comment>; qué hacer con un archivo infectado
; quarantine: tratar de moverlo a un directorio de cuarentena; borrarlo si lo anterior falla
; delete:     eliminar el archivo infectado
; nothing:    nada</comment>
infected file action = <comment>delete</comment>

<comment>; donde colocar los archivos infectados - ¡de verdad vas a querer cambiarlo!
; ¡tiene que estar en el mismo dispositivo físico que la unidad compartida!</comment>
quarantine directory  = /tmp
<comment>; prefijo de los archivos en cuarentena</comment>
quarantine prefix = vir-

<comment>; ya que Windows intenta abrir un archivo varias veces en un tiempo (muy) corto
; samba-vscan utiliza el mecanismo archivo abierto recientemente para evitar
; múltiples escaneadas de un mismo archivo. Esta opción especifica el máximo número de
; elementos en la lista. (por defecto: 100)</comment>
max lru files entries = 100

<comment>; una entrada en la lista es invalidada luego que supera su periodo de 
; vida (en segundos).(Por defecto: 5)</comment>
lru file entry lifetime = 5

<comment>; nombre del socket de clamd (por defecto: /var/run/clamd)</comment>
clamd socket name = /tmp/clamd

<comment>; número de puerto al cual escucha ScannerDaemon</comment>
oav port = 8127
</pre>

<p>
Es, generalmente, una buena idea iniciar la revisión de virus
inmediatamente. Añádelo al nivel de ejecución <e>default</e> y luego
inicia el servicio <c>clamd</c> de inmediato. El servicio consta de
dos procesos: freshclam que mantiene las definiciones de la base de
datos de virus actualizadas mientras que clamd es el demonio
anti-virus en sí. Primero, quizás, quieras definir las rutas a los
archivos de bitácora de manera que encaje con tus necesidades.
</p>

<pre caption="Revisando la ubicación de las bitácoras">
# <i>vim /etc/clamd.conf</i>
<comment>(Revisa la línea "LogFile /var/log/clamd.log")</comment>
# <i>vim /etc/freshclam.conf</i>
<comment>(Revisa la línea "UpdateLogFile /var/log/freshclam.log")</comment>
# <i>vim /etc/conf.d/clamd</i>
<comment>(Define "START_CLAMD=yes" y "START_FRESHCLAM=yes")</comment>
</pre>

<p>
Ahora, inicia el anti-virus.
</p>

<pre caption="Añadir clamd a la rutina de arranque e iniciarlo">
# <i>rc-update add clamd default</i>
# <i>/etc/init.d/clamd start</i>
</pre>

</body>
</section>
<section>
<title>Configurando CUPS</title>
<body>

<p>
Esto es un poquito más complicado. El archivo de configuración
principal de CUPS es <path>/etc/cups/cupsd.conf</path>. Tiene una
estructura similar al archivo de Apache <path>httpd.conf</path>, así
que es posible que lo encuentres familiar. Resaltadas en el ejemplo
están las directivas que necesitarás cambiar:
</p>

<pre caption="/etc/cups/cupsd.conf">
ServerName <i>PrintServer</i>          <comment># el nombre de tu servidor de impresión</comment>
ServerAdmin <i>root@PrintServer</i>    <comment># quién recibirá los correos relacionados,e.g. tu</comment>

AccessLog /var/log/cups/access_log <comment># probablemente no necesitarás cambiarlo</comment>
ErrorLog  /var/log/cups/error_log  <comment># igual que el caso de arriba</comment>

LogLevel  debug <comment># sólo será así durante la instalación y pruebas, luego debe 
		# ser cambiado a 'info'</comment>

MaxClients 100 <comment># Yo tuve que definirlo en 1000000000 o cerca porque algún tiempo atrás,
               # parecía existir una falla en la interfaz web de CUPS,
               # haciendo creer que estaba siendo víctima de un ataque de denegación de servicio
               # cuando intentaba configurar una impresora a través de la interfaz web. raro.</comment>

BrowseAddress @IF(<i>eth0</i>) <comment># cámbialo a tu interfaz de red local</comment> 

&lt;Location /&gt;
Order Deny,Allow
Deny From All
Allow From <i>192.168.1.*</i>  <comment># la dirección de tu red interna
                        # eg 192.168.1.* permitirá cualquier conexión desde una máquina en la red
                        # 192.168.1.0. Cámbialo para que se ajuste a tu configuración</comment>
&lt;/Location&gt;

&lt;Location /admin&gt;
AuthType Basic
AuthClass System
Allow From <i>192.168.1.*</i>  <comment># lo mismo que arriba permitirá a cualquier máquina
                        # en la red 192.168.1.0 conectarse y realizar 
                        # tareas administrativas luego de autenticarse</comment>
Order Deny,Allow
Deny From All
&lt;/Location&gt;
</pre>

<p>
Edita <path>/etc/cups/mime.convs</path> para quitar los comentarios de
algunas lineas. Los cambios en <path>mime.convs</path> y
<path>mime.types</path> son necesarios para permitir a CUPS imprimir
archivos de Microsoft Office.
</p>

<pre caption="/etc/cups/mime.convs">
<comment>(La siguiente línea está próxima al final del archivo. Descomentala)</comment>
application/octet-stream        application/vnd.cups-raw        0       
</pre>

<p>
Edita <path>/etc/cups/mime.types</path> para descomentar algunas lineas.
</p>

<pre caption="/etc/cups/mime.types">
<comment>(La siguiente línea está próxima al final del archivo. Descomentala)</comment>
application/octet-stream 
</pre>

<p>
CUPS tiene que comenzar a funcionar al inicio del sistema, también lo
arrancaremos de inmediato.
</p>

<pre caption="Configurando el servicio CUPS" >
<comment>(Para incluir CUPS en la rutina de inicio)</comment>
# <i>rc-update add cupsd default</i>
<comment>(Para iniciar o reiniciar CUPS de inmediato)</comment>
# <i>/etc/init.d/cupsd restart</i>
</pre>

</body>
</section>
<section>
<title>Instalando una impresora para y con CUPS</title>
<body>

<p>
Antes de nada, ve a <uri
link="http://linuxprinting.org">LinuxPrinting.Org</uri> para buscar y
descargar el archivo PPD correcto para tu impresora y CUPS. Para
hacerlo, haz click en el enlace al listado impresoras (Printer
Listings) en la izquierda. Selecciona el fabricante de tu impresora y
el modelo en el menú desplegable, eg HP y DeskJet 930C. Haz click en
"mostrar" (show). En la página que aparece haz click en el enlace de
"manejador recomendado" (recommended driver) luego de haber leído las
varias notas e información que brinda. Luego descarga el archivo PPD
de la página siguiente, después de haber leído nuevamente las notas e
información que da. Quizás tengas que seleccionar el fabricante y el
modelo de tu impresora nuevamente. Leer la <uri
link="http://www.linuxprinting.org/cups-doc.html">guía de inicio
rápido de CUPS</uri>es también muy útil cuando se trabaja con CUPS.
</p>

<p>
Ahora tienes un archivo PPD para CUPS que trabaja con tu
impresora. Colócalo en <path>/usr/share/cups/model</path>. El PPD para
tu HP DeskJet 930C ha sido nombrado
<path>HP-DeskJet_930C-hpijs.ppd</path>. Ahora debes instalar la
impresora. Esto puede ser hecho a través de la interfaz web de CUPS o
utilizando la línea de comandos. Una vez que esté ejecutándose CUPS la
interfaz web puede ser encontrada en
<path>http://PrintServer:631</path>.
</p>

<pre caption="Instalando la impresora a través de la línea de comandos">
# <i>lpadmin -p HPDeskJet930C -E -v usb:/dev/ultp0 -m HP-DeskJet_930C-hpijs.ppd</i>
</pre>

<p>
Recuerda ajustarlo a tu configuración. Asegúrate de tener el nombre(el
argumento <c>-p</c>) correcto (¡el nombre que definiste durante la
configuración de Samba!) y colocar bien el <c>usb:/dev/usb/blah</c>,
<c>parallel:/dev/blah</c> o el dispositivo que utilices para tu
impresora.
</p>

<p>
Ahora debes ser capaz de acceder a tu impresora desde la interfaz web
y además debes poder imprimir la página de prueba.
</p>

</body>
</section>
<section>
<title>Instalando los manejadores Windows de la impresora</title>
<body>

<p>
Ahora que la impresora está trabajando es momento de instalar los
manejadores que puedan utilizar los clientes Windows. Samba 2.2
introdujo esta funcionalidad. Navegando en el servidor de impresoras
en el vecindario de la red (Network Neighbourhood), haz click derecho
en compartir impresora (printershare) y selecciona conectar (connect)
lo cual descargará los manejadores adecuados automágicamente al
cliente que se conecte, evitando la molestia de instalar los
manejadores de impresión manualmente.
</p>

<p>
Hay dos conjuntos de manejadores de impresora para este
propósito. Primero, los manejadores Adobe PS que los puedes conseguir
desde <uri
link="http://www.adobe.com/support/downloads/main.html">Adobe</uri>
(Manejadores de impresora PostScript). Segundo, existen los
manejadores CUPS PS, que pueden ser obtenidos desde la <uri
link="http://www.cups.org/software.php">página de CUPS</uri>
seleccionando "manejador para Windows CUPS" (CUPS Driver for Windows)
del menú desplegable. No hay una diferencia aparente entre la
funcionalidad de ambos, pero los manejadores Adobe PS necesitan ser
descomprimidos en un sistema Windows ya que son binarios
Windows. También, el procedimiento en general de encontrar y copiar
los archivos correctos es un poco más molesto. Los manejadores CUPS
parecen soportar algunas opciones que no soportan los de Adobe.
</p>

<p>
Esta guía utiliza los manejadores de CUPS para Windows. El archivo
descargado se llama <path>cups-samba-5.0rc2.tar.gz</path>. Extrae los
archivos que están contenidos dentro de un directorio.
</p>

<pre caption="Extrae los manejadores y ejecuta el instalador">
# <i>tar -xzf cups-samba-5.0rc2.tar.gz</i>
# <i>cd cups-samba-5.0rc2</i>
<comment>(Sólo utiliza este guión si CUPS está alojado en /usr/share/cups)</comment>
# <i>./cups-samba.install</i>
</pre>

<p>
<path>cups-samba.ss</path> es un archivo TAR que contiene tres
archivos: <path>cups5.hlp</path>, <path>cupsdrvr5.dll</path> y
<path>cupsui5.dll</path>. Estos son los manejadores en sí.
</p>

<warn>
El guión <c>cups-samba.install</c> quizás no funcione para todos los
*nixes (ie FreeBSD) debido a que casi todo lo que no es parte del
sistema base es instalado en algún lugar bajo el prefijo
<path>/usr/local</path>. Este no parece ser el caso de la mayoría de
las cosas que instalas en un ambiente GNU/Linux. Sin embargo, si tu
instalación de CUPS está en otro lugar distinto a
<path>/usr/share/cups/</path> ve el siguiente ejemplo:
</warn> 

<p>
Asumamos que tu instalación de CUPS reside bajo
<path>/usr/local/share/cups/</path> y deseas instalar los manejadores
ahí. Haz lo siguiente:
</p>

<pre caption="Instalando manualmente los manejadores">
# <i>cd /path/you/extracted/the/CUPS-driver/tarball/into</i>
# <i>tar -xf cups-samba.ss</i>
<comment>(Esto extrae los archivos a usr/share/cups/drivers bajo el DIRECTORIO ACTUAL)</comment>
# <i>cd usr/share/cups/drivers</i>
<comment>(¡sin / al final!)</comment>
# <i>cp cups* /usr/local/share/cups/drivers</i>
</pre>

<p>
Ahora utiliza el guión <c>cupsaddsmb</c> proveido por la distribución
de CUPS. Su página del manual es una lectura interesante.
</p>

<pre caption="Ejecuta cupsaddsmb">
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -v HPDeskJet930C</i>
<comment>(En vez de HPDeskJet930C podrías también especificar "-a", lo cual 
"exportará todas las impresoras conocidas".)</comment>
# <i>cupsaddsmb -H PrintServer -U root -h PrintServer -a</i>
</pre>

<warn>
La ejecución de este comando es la causa común de la mayoría de los
problemas. Lo que se puede ver leyendo<uri
link="http://forums.gentoo.org/viewtopic.php?t=110931">las entradas en
este hilo</uri>.
</warn>

<p>
Aquí están los errores más comunes que pueden suceder:
</p>

<ul>
  <li>
    El nombre de la máquina dado como parámetro para <c>-h</c> y
    <c>-H</c> (<c>PrintServer</c>) usualmente no es resuelto
    correctamente y no identifica el servidor de impresión para la
    interacción CUPS/Samba. Si un error como <b>Warning: No PPD file
    for printer "CUPS_PRINTER_NAME" - skipping!</b> (Advertencia: No
    hay archivo PPD para la impresora "CUPS_PRINTER_NAME" -
    ¡saltando!) ocurre, la primera cosa que debes hacer es sustituir
    <c>PrintServer</c> con <c>localhost</c> e intentarlo nuevamente.
  </li>
  <li>
    El comando falla con <b>NT_STATUS_UNSUCCESSFUL</b>. Este mensaje
    de error es bastante común, pero puede ser activado por distintos
    problemas. Es, desafortunadamente, de poca ayuda. Una cosa que
    puedes intentar es definir temporalmente <c>security = user</c> en
    tu <path>smb.conf</path>. Luego/Si la instalación se completa
    exitosamente, debes redefinirlo a share, o al valor que tenía
    anteriormente.
  </li>
</ul>

<p>
Esto debe instalar la estructura de directorios adecuada del manejador
bajo <path>/etc/samba/printer</path>. Eso será
<path>/etc/samba/printer/W32X86/2/</path>. Los archivos contenidos
deben ser los 3 archivos del manejador y el archivo PPD, renombrado
como ElNombreDeTuImpresora.ppd (el nombre que le diste a tu impresora
cuando la instalaste).
</p>

<p>
Sin ningún otro error o complicación pendiente, tus manejadores debe
estar ahora instalados.
</p>

</body>
</section>
<section>
<title>Finalizando la instalación</title>
<body>

<p>
Por último, configuremos nuestros directorios.
</p>

<pre caption="Últimos cambios necesarios">
# <i>mkdir /home/samba</i>
# <i>mkdir /home/samba/public</i>
# <i>chmod 755 /home/samba</i>
# <i>chmod 755 /home/samba/public</i>
</pre>

</body>
</section>
<section>
<title>Probando nuestra configuración Samba</title>
<body>

<p>
Es seguro que queremos probar nuestro archivo de configuración para
asegurarnos que está formateado de manera correcta y que todas
nuestras opciones tienen, al menos, la sintaxis correcta. Para hacerlo
ejecutamos <c>testparm</c>.
</p>

<pre caption="Ejecutando testparm">
<comment>(Por defecto, testparm revisa /etc/samba/smb.conf)</comment>
# <i>/usr/bin/testparm</i>
Load smb config files from /etc/samba/smb.conf
Processing section &quot;[printers]&quot;
Global parameter guest account found in service section!
Processing section &quot;[public]&quot;
Global parameter guest account found in service section!
Loaded services file OK.
Server role: ROLE_STANDALONE
Press enter to see a dump of your service definitions
 ...
 ...
</pre>

</body>
</section>
<section>
<title>Iniciando el servicio Samba</title>
<body>

<p>
Ahora configuraremos Samba para que se inicie con el sistema; luego la
ejecutaremos.
</p>

<pre caption="Configurando el servicio Samba">
# <i>rc-update add samba default</i>
# <i>/etc/init.d/samba start</i>
</pre>

</body>
</section>
<section>
<title>Revisando nuestro servicio</title>
<body>

<p>
También sería prudente revisar nuestras bitácoras al mismo tiempo. De
igual forma queremos echar un vistazo a lo que Samba está
compartiendo utilizando <c>smbclient</c>.
</p>

<pre caption="Revisando lo compartido con smbclient">
# <i>smbclient -L localhost</i>
Password:
<comment>(Debes ver una ENORME lista de servicios aquí.)</comment>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configuración de los clientes</title>
<section>
<title>Configuración de la impresora para los clientes basados en *nix</title>
<body>

<p>
Sin importar la variación o distribución, la única cosa necesaria es
CUPS. Haz lo mismo, o equivalente, en cualquier otro cliente
UNIX/Linux/BSD.
</p>

<pre caption="Configurando un sistema Gentoo">
# <i>emerge cups</i>
# <i>nano -w /etc/cups/client.conf</i>
ServerName <i>PrintServer</i>      <comment># your printserver name</comment>
</pre>

<p>
Eso debe ser todo. Nada más es necesario.
</p>

<p>
Si sólo utilizas una impresora, la misma será tu impresora por
defecto. Si tu servidor de impresión maneja varias impresoras, tu
administrador debe haber definido una impresora por defecto en el
servidor. Si quieres definir una impresora por defecto distinta para
ti, utiliza el comando <c>lpoptions</c>.
</p>

<pre caption="Definiendo tu impresora por defecto">
<comment>(Lista las impresoras disponibles)</comment>
# <i>lpstat -a</i>
<comment>(Salida de ejemplo, la tuya será diferente)</comment>
HPDeskJet930C accepting requests since Jan 01 00:00
laser accepting requests since Jan 01 00:00
<comment>(Define HPDeskJet930C como tu impresora por defecto)</comment>
# <i>lpoptions -d HPDeskJet930C</i>
</pre>

<pre caption="Printing in *nix">
<comment>(Especifica la impresora a ser utilizada)</comment>
# <i>lp -d HPDeskJet930C anything.txt</i>
<comment>(Utiliza tu impresora por defecto)</comment>
# <i>lp foobar.whatever.ps</i>
</pre>

<p>
Sólo apunta tu navegador web a <c>http://printserver:631</c> en el
cliente si deseas manejar tus impresoras y sus trabajos desde una
interfaz web bonita. Reemplaza <c>printserver</c> con el nombre de la
<e>máquina</e> que actúa como tu servidor de impresión, no el nombre
que le diste al servidor de impresión cups si es que utilizaste
distintos.
</p>

</body>
</section>
<section>
<title>Montando ficheros compartidos por Windows o Samba en
GNU/Linux</title>
<body>

<p>
Ahora es tiempo de configurar nuestro núcleo para que soporte
smbfs. Dado que asumo que todos hemos compilado un núcleo al menos una
vez, necesitaremos asegurarnos que todas las opciones adecuadas sean
seleccionadas. En nombre de la simplicidad, hazlo módulo para
facilitar el uso. Es la opinión del autor que los módulos del núcleo
son una buena opción y deben ser utilizados siempre que sea posible.
</p>

<pre caption="Opciones del núcleo relevantes" >
CONFIG_SMB_FS=m
CONFIG_SMB_UNIX=y
</pre>

<p>
Luego haz una instalación del módulo; insertándolo con:
</p>

<pre caption="Cargando los módulos del núcleo">
# <i>modprobe smbfs</i>
</pre>

<p>
Una vez que los módulos son cargados, montar lo compartido por Windows
o Samba es posible. Utiliza <c>mount</c> para lograrlo, como se
detalla aquí:
</p>

<pre caption="Montando un compartido Windows/Samba">
<comment>(La sintaxis para montar un compartido por Windows/Samba es:
  mount -t smbfs [-o username=xxx,password=xxx] //server/share /mnt/point
So no estamos utilizando contraseñas o no son necesitadas)</comment>

# <i>mount -t smbfs //PrintServer/public /mnt/public</i>

<comment>(Si necesitamos contraseña)</comment>
# <i>mount -t smbfs -o username=USERNAME,password=PASSWORD //PrintServer/public /mnt/public</i>
</pre>

<p>
Luego de montar la información compartida, debes poder acceder a ella
como si estuviese en un disco local.
</p>

</body>
</section>
<section>
<title>Configuración de la impresora para los clientes Windows NT/2000/XP</title>
<body>

<p>
Eso es sólo un par clicks. Navega a <path>\\PrintServer</path> y haz
click derecho en la impresora (HPDeskJet930C) y luego en conectar. Esto
descargará los manejadores al cliente Windows y ahora cada una de las
aplicaciones (como Word o Acrobat) ofrecerán HPDeskJet930C como una
impresora disponible desde la cual imprimir. :-)
</p>

</body>
</section>
</chapter>

<chapter>
<title>Notas Finales</title>
<section>
<title>Un Adiós</title>
<body>

<p>
Bueno, eso debe ser todo. ¡Ahora debes tener un exitoso ambiente de
impresión que es amigable tanto para Windows como par *nix además de
archivos compartidos libres de virus!.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Enlaces y Recursos</title>
<section>
<title>Enlaces</title>
<body>

<p>
Aquí están algunos enlaces que te ayudarán a configurar y solucionar
problemas con tu instalación:
</p>

<ul>
  <li><uri link="http://www.cups.org/">CUPS Homepage</uri></li>
  <li><uri link="http://www.samba.org/">Samba Homepage</uri></li>
  <li><uri link="http://linuxprinting.org/">LinuxPrinting dot Org</uri></li>
  <li>
    <uri
    link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/">COMO
    de Impresión Samba de Kurt Pfeifle</uri> (Este COMO realmente
    cubre <e>CUALQUIER PARTE</e> y <e>TODO</e> lo que he escrito aquí,
    además de MUCHO más acerca de CUPS y Samba, y soporte de impresión
    por red en general. Una lectura muy interesante, con muchísimos
    detalles).
  </li>
  <li><uri link="http://www.freebsddiary.org/cups.php">Tema CUPS del diario de FreeBSD</uri></li>
</ul>

</body>
</section>
<section>
<title>Solucionando Problemas</title>
<body>

<p>
Revisa <uri
link="http://www.linuxprinting.org/kpfeifle/SambaPrintHOWTO/Samba-HOWTO-Collection-3.0-PrintingChapter-11th-draft.html#37">esta
página</uri> del manual de Kurt Pfeifle "Soporte de impresión en Samba
3.0". ¡Hay mucho consejos útiles ahí! Asegúrate de revisar este
primero, ¡antes de hacer preguntas y referirte a problemas! Quizás la
solución que estás buscando está ahí.
</p>

</body>
</section>
</chapter>
</guide>
