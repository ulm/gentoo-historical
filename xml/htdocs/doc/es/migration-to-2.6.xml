<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/migration-to-2.6.xml,v 1.1 2004/12/04 16:41:10 chiguire Exp $ -->

<guide link="/doc/es/migration-to-2.6.xml" lang="es">

<title>La guía completa de migración al kernel Gentoo Linux 2.6</title>

<author title="Autor">
	<mail link="dsd@gentoo.org">Daniel Drake</mail>
</author>
<author title="Contribuyente">
	<mail link="sergey_zlodey@mail.ru">Sergey Galkin</mail>
</author>
<author title="Contribuyente">
	<mail link="svyatogor@gentoo.org">Sergey Kuleshov</mail>
</author>
<author title="Editor">
	<mail link="neysx@gentoo.org">Xavier Neys</mail>
</author>
<author title="Editor">
        <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor Es">
    <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
 </author>
<author title="Editor-Es Adjunto">
    <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
 </author>

<abstract>
Este documento le asistirá en el proceso de migrar del kernel Linux 2.4
a Linux 2.6, de devfs a udev y de OSS a ALSA.
</abstract>

<version>0.1.4</version>
<date>2004-11-28</date>

<chapter>
<title>Introducción</title>

<section>
<title>El estado de este documento</title>
<body>

<p>
Los procesos de migración descritos en este documento no constituyen
cambios de naturaleza menor. Este documento se encuentra en sus
primeras etapas y tal vez le falte algunos detalles, pero lo principal
está cubierto. Si intenta hacer esta migración, por favor <uri
link="http://bugs.gentoo.org">repórtenos</uri> cualquier problema que
encuentre para así poder refinar esta guía.
</p>

<p>
Estamos planificando hacer que el kernel Linux 2.6 sea el kernel por
defecto para el lanzamiento de Gentoo 2005.0 (solo para algunas
arquitecturas). Al mismo tiempo, intentaremos animar a todos los
usuarios de esas arquitecturas a actualizarse a Linux 2.6, ya que
muchos de ellos estarán corriendo 2.4. Sus opiniones acerca de este
documento serán muy apreciadas para hacer que su versión final esté en
buena forma para la migración en masa.
</p>
</body>
</section>

<section>
<title>¿Qué hay de nuevo en Linux 2.6?</title>
<body>

<p>
Esta pregunta no tiene respuesta fácil. Linux 2.6 es el resultado de
más de 2 años de rápido desarrollo y estabilización de nuevas
características. Es estructuralmente muy diferente a su contraparte
versión 2.4. Algunos de los cambios más importantes están listados a
continuación:
</p>

<ul>
  <li>
    Mejoras en el planificador de tareas (scheduler) y por ende la
    interactividad: se siente mucho más fluido en sistemas de
    escritorio y aguanta mucho mejor bajo carga que el kernel 2.4
</li>
  <li>
    Escalabilidad: Linux ahora escala mucho mejor, hacia arriba y
    hacia abajo, en sistemas pequeños o encastrados y en sistemas con
    muchos procesadores
  </li>
  <li>Desempeño: el rendimiento de aplicaciones comunes ha sido muy mejorado
  </li>
  <li>
    Soporte de hardware: Linux ahora soporta muchas más arquitecturas
    y dispositivos de hardware que cualquier otro sistema operativo.
</li>
</ul>

<p>
Joseph Pranevich ha escrito (en inglés) un documento muy detallado <uri
link="http://www.kniggit.net/wwol26.html">The Wonderful World Of Linux
2.6</uri>, el cual tal vez le interese leer. Si está interesado en más
detalles técnicos, puede referirse a <uri
link="http://www.linux.org.uk/~davej/docs/post-halloween-2.6.txt">El
documento post-halloween</uri>, pero tenga en cuenta que ya está algo
desactualizado.
</p>
</body>
</section>

<section>
<title>¿Qué es udev?</title>
<body>

<p>
En el pasado, Gentoo ha instruido a sus usuarios que utilicen
<e>devfs</e> para manejar el directorio <path>/dev</path>, que
contiene una serie de interfaces de dispositivos que permiten que las
aplicaciones del sistema se comuniquen con el hardware (a través del
kernel).</p>

<p>
Mientras que <e>devfs</e> es un buen concepto, tiene algunos problemas
internos y ahora está marcado como obsoleto para el kernel Linux 2.6.
</p>

<p>
<e>udev</e> es una manera nueva de manejar los nodos correspondientes
a dispositivos. Resuelve problemas inherentes a manejadores de
dispositivos anteriores y además trata de resolver algunos otros
problemas.
</p>

<p>
Tal vez lo anterior no signifique mucho, pero no tema, los
desarrolladores que tan duro trabajan se han esforzado en hacer que la
migración desde devfs sea muy fácil.
</p>
</body>
</section>

<section>
<title>¿Qué es ALSA?</title>
<body>

<p>
Con Linux 2.4 es probable que haya usado los manejadores del OSS (open
sound system, sistema de sonido abierto) para potenciar su tarjeta de
sonido. El OSS ha sido reemplazado por unos manejadores nuevos y
mejores: ALSA.
</p>

<p>
ALSA, que significa Advanced Linux Sound Architecture, o Arquitectura
de Sonido Avanzado para Linux, es un nuevo conjunto de manejadores con
un API nuevo y mejor, presente en el kernel 2.6. Es compatible con las
anteriores aplicaciones OSS, ¡siempre que seleccione las opciones
adecuadas de configuración en el kernel!
</p>

<note>
Si no tiene hardware de sonido/audio, puede saltarse las instrucciones
relacionadas con ALSA de este documento.
</note>
</body>
</section>
</chapter>

<chapter>
<title>Preparación</title>
<section>
<title>Actualice su sistema</title>
<body>

<p>
Algunos de los cambios traídos con el Linux 2.6 también requieren
algunos cambios en las aplicaciones del sistema base. Antes de
continuar, debe asegurarse que su sistema esté más o menos actualizado
y para estar perfectamente seguro, debe actualizar todos los paquetes
de world y system que estén disponibles.
</p>

<p>
En particular, asegúrese de tener las últimas versiones estables de
los siguientes paquetes:
</p>

<ul>
  <li><c>sys-apps/baselayout</c></li>
  <li><c>sys-apps/util-linux</c></li>
  <li>
    <c>sys-kernel/genkernel</c> (únicamente si desea utilizar
    genkernel en vez de configuración manual)
</li>
</ul>

<pre caption="Actualizando todos los paquetes en world">
# <i>emerge sync</i>
# <i>emerge -ua world</i>
</pre>
</body>
</section>

<section>
<title>modutils vs module-init-tools</title>
<body>

<p>
<c>sys-apps/modutils</c> es el paquete que provee las herramientas
como <c>modprobe</c>, <c>rmmod</c> y <c>insmod</c> para Linux 2.4.
</p>

<p>
Linux 2.6 presenta un nuevo formato de módulo, por ende, requiere
nuevas herramientas para manejar módulos. Estos conforman el paquete
<c>sys-apps/module-init-tools</c>.
</p>

<p>
Ahora debe desinstalar modutils e instalar module-init-tools:
</p>

<pre caption="Cambiando de modutils a module-init-tools">
# <i>emerge unmerge sys-apps/modutils</i>
# <i>emerge module-init-tools</i>
</pre>

<note>
No se preocupe, aunque haya hecho unmerge modutils, module-init-tools
suministra compatibilidad con Linux 2.4, para que todavía pueda
arrancar Linux 2.4 y manejar los módulos de ese kernel.
</note>

<note>
Es posible, por las razones esbozadas anteriormente, que
module-init-tools ya esté instalado y funcionando con su kernel Linux
2.4. En este caso, no hace falta preocuparse, ya que su sistema ya
está preparado para manejar módulos de Linux 2.6.
</note>
</body>
</section>

<section>
<title>Instalando udev</title>
<body>

<p>
No hay configuración involucrada aquí. Sencillamente use <c>emerge</c>
para instalar udev:
</p>

<pre caption="Instalando udev">
# <i>emerge -a udev</i>
</pre>
</body>
</section>

<section>
<title>Revisando los nodos de dispositivos esenciales</title>
<body>

<p>
Al arrancar el sistema, este requiere unos nodos de dispositivos
esenciales. Como udev no está incluido en el kernel, no se activa
inmediatamente. Para compensar, asegúrese de tener algunos nodos de
dispositivos esenciales en el disco.
</p>

<p>
Nuestros archivos de instalación stage habrán creado los dispositivos
requeridos durante la instalación inicial. Sin embargo, algunos
usuarios han reportado que esto no es así. Usaremos esta oportunidad
para revisar la existencia de dichos archivos, y si no, crearlos.
</p>

<p>
Como su manejador de dispositivos existente estará montado en
<path>/dev</path>, no tendremos acceso directamente, de manera que
montaremos la partición raíz con bind en otra ubicación y tendremos
acceso al directorio <path>/dev</path> allí.
</p>

<pre caption="Montando la partición raíz con bind y listando los dispotitivos estáticos">
# <i>mkdir -p /mnt/temp</i>
# <i>mount -o bind / /mnt/temp</i>
# <i>cd /mnt/temp/dev</i>
# <i>ls -l console null</i>
</pre>

<p>
Si el anterior comando <e>ls</e> reportó que los dispositivos
<c>console</c> o <c>null</c> no existen, los crearemos como se muestra
a continuación:
</p>

<pre caption="Creando los nodos faltantes para console y null">
# <i>mknod -m 660 console c 5 1</i>
# <i>mknod -m 660 null c 1 3</i>
</pre>

<p>
Ahora debe desmontar su partición raíz, aunque no haya tenido que
crear los dispositivos:
</p>

<pre caption="Desmontando la partición raíz (montada con bind)">
# <i>umount /mnt/temp</i>
# <i>rmdir /mnt/temp</i>
</pre>
</body>
</section>

<section>
<title>Instalando las herramientas ALSA</title>
<body>

<p>
ALSA requiere la instalación de algunos paquetes para que las demás
aplicaciones puedan hacer uso del API ALSA. Estos paquetes le
permitirán controlar el mezclador y el nivel del volumen. Las
herramientas requeridas son las siguientes:
</p>

<pre caption="Instalando las herramientas ALSA y las librerías">
# <i>emerge -a alsa-lib alsa-utils alsa-tools alsa-headers alsa-oss</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Instalando las fuentes Linux 2.6</title>

<section>
<title>Escogiendo e instalando un kernel</title>
<body>

<p>
Lo primero es instalar las fuentes de un kernel 2.6 de su
escogencia. Los dos kernels 2.6 soportados por Gentoo son
<e>gentoo-dev-sources</e> (para máquinas de escritorio) y
<e>hardened-dev-sources</e> (para servidores). Hay otras disponibles,
vea la <uri link="/doc/es/gentoo-kernel.xml">Guía Gentoo del Kernel
Linux</uri> para más alternativas.
</p>

<p>
En esta guía usaremos <c>gentoo-dev-sources</c> como ejemplo. Instale
sus fuentes de kernel escogidas con <c>emerge</c>:
</p>

<pre caption="Instalando gentoo-dev-sources">
# <i>emerge -a gentoo-dev-sources</i>
These are the packages that I would merge, in order:
Calculating dependencies ...done!
[ebuild  N    ] sys-kernel/gentoo-dev-sources-2.6.9-r2

Do you want me to merge these packages? [Yes/No] <i>y</i>
</pre>
</body>
</section>

<section>
<title>Actualizando el enlace simbólico /usr/src/linux</title>
<body>

<p>
Varios herramientas Gentoo cuentan con que <path>/usr/src/linux</path>
sea un enlace simbólico a las fuentes de kernel que está usando (o
contra las cuales desea compilar).
</p>

<p>
Actualizaremos nuestro <path>/usr/src/linux</path> para que apunte a
las fuentes que acabamos de instalar. Continuando nuestro ejemplo:
</p>

<pre caption="Actualizando el enlace simbólico /usr/src/linux">
# <i>cd /usr/src</i>
# <i>ln -sfn linux-2.6.9-gentoo-r2 linux</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Problemas conocidos con la migración a Linux 2.6</title>
<section>
<body>

<p>
Antes de comenzar a configurar el kernel, intentaré detallar algunos
de los errores más comunes que hace la gente al migrar hacia Linux
2.6, ya que algunos de estos puntos influenciarán la manera que
configuremos el kernel nuevo.
</p>

<note>
No todos estos puntos son relevantes en esta etapa, pero los detallaré
acá, todos en el mismo lugar, para que pueda consultarlos luego con
calma.
</note>
</body>
</section>

<section>
<title>No usar "make oldconfig" con un archivo .config de 2.4</title>
<body>

<note>
Si no entiende lo que significa esto, no se preocupe, no hará este
error si sigue al pie de la letra el resto de esta guía.
</note>

<p>
Se le hará muchas preguntas, ya que han habido muchos cambios. Muchos
que intentan un <c>make oldconfig</c> a partir de un .config de 2.4
terminan con un kernel que no funciona (no escribe nada a la pantalla,
no funciona el teclado, etc.). Por favor, ahórrese la molestia y use
el tradicional método <c>menuconfig</c> sólo esta vez.
</p>
</body>
</section>

<section>
<title>No usar ide-scsi para quemar CDs/DVDs</title>
<body>

<p>
En Linux 2.4, la única manera de obtener buenos resultados en el
quemado de CDs/DVDs era activando (¡qué feo!) la emulación
<c>ide-scsi</c>. Agradecemos que la capa IDE en Linux 2.6 ha sido
extendida para soportar mucho mejor a los quemadores de CDs/DVDs.
</p>

<p>
No hace falta activar opciones adicionales para habilitar el quemado
de CDs. Sólo asegúrese de <e>no</e> activar <c>ide-scsi</c> como
acostumbraba.
</p>
</body>
</section>

<section>
<title>El altavoz del PC es ahora una opción configurable</title>
<body>

<p>
No conseguirá sus pitidos normales de consola (o respuesta alguna del
altavoz del PC) si no activa específicamente la nueva opción <c>CONFIG_INPUT_PCSPKR</c>):
</p>

<pre caption="Ubicación de la opción PC speaker">
Device Drivers  ---&gt;
 Input device support  ---&gt;
  [*] Misc
   &lt;*&gt;   PC Speaker support
</pre>

<note>
Por el altavoz del PC o "PC speaker", nos referimos al altavo
analógico que pita una vez al arrancar el sistema. No hacemos
referencia al hardware normal de sonido utilizado para escuchar
música, etc.
</note>
</body>
</section>

<section>
<title>El nuevo manejador de dispositivos en bloque USB es
problemático a veces</title>
<body>

<p>
Muy recientemente, un nuevo manejador de dispositivos de bloque USB ha
sido agregado al kernel. Al momento de escribir esto, este manejador
("ub") está en etapas tempranas y algunos usuarios lo encuentran poco
fiable. Si tiene problemas accesando su disco duro USB, su disco flash
USB, su lector de tarjetas USB o cámara digital USB, podría intentar
regresando al antiguo manejador estilo SCSI:
</p>

<pre caption="Desactivando ub">
Device Drivers  ---&gt;
 Block devices  ---&gt;
  &lt; &gt; Low Performance USB Block driver
</pre>

<note>
El antiguo manejador estilo SCSI (USB Mass Storage support) está
activado por defecto. Se encuentra bajo "Device Drivers --&gt; USB
support", pero generalmente no hará efecto mientras ub también esté presente.
</note>
</body>
</section>

<section>
<title>usbdevfs ha sido renombrado a usbfs</title>
<body>

<p>
Si ha modificado su archivo <path>/etc/fstab</path> para personalizar
la manera que se monta el sistema de dispositivos USB, tal vez tenga
que cambiar el tipo del sistema de archivos de <e>usbdevfs</e> a
<e>usbfs</e>.
</p>

<note>
Los kernels 2.4 recientes también le permitirán usar "usbfs" al igual
que "usbdevfs", de forma que se conserva la compatibilidad anterior.
</note>
</body>
</section>

<section>
<title>No le haga renice a X</title>
<body>

<p>
Si es un usuario de escritorio con 2.4, puede haber modificado su
sistema para correr X con una prioridad mayor, ya que en algunos casos
mejora el desempeño del escritorio.
</p>

<p>
Han habido muchos cambios en el programador (scheduler) de 2.6 que
cambian este comportamiento. Si continua corriendo X a una prioridad
más alta, hará justo lo que está supuesto de hacer (ejecutar el
<e>servidor de pantalla</e> a una prioridad muy alta) con
consecuencias negativas como sonido entrecortado y tiempos de carga
muy lentos para las aplicaciones, ya que el CPU pasa demasiado tiempo
sirviendo X y sólo X.
</p>

<p>
En Linux 2.6, ya no se requiere hacer un renice a las aplicaciones de
escritorio para obtener una interactividad mejorada. Por favor,
deshágase de sus hacks de "nice".
</p>
</body>
</section>

<section>
<title>El archivo de configuración de X11 ahora debe usar /dev/input/mice</title>
<body>

<p>
Uno de los cambios introducido por la configuración por defecto de
udev es una organización distinta de los nodos para el
ratón. Previamente, habría tenido nodos como <path>/dev/psaux</path> y
<path>/dev/mouse</path>. Ahora, tendrá nodos como
<path>/dev/input/mouse0</path>, <path>/dev/input/mouse1</path> y un
nodo colectivo <path>/dev/input/mice</path> donde se combinan los
movimientos de todos los ratones.
</p>

<p>
Como las configuraciones viejas de X típicamente hacía referencia a
<path>/dev/mouse</path> o <path>/dev/psaux</path> podrá recibir un
error al iniciar X, similar al mostrado a continuación:
</p>

<pre caption="Error común al iniciar X por primera vez en un sistema udev">
(EE) xf86OpenSerial: Cannot open device /dev/mouse
	No such file or directory.
(EE) Mouse0: cannot open input device
(EE) PreInit failed for input device "Mouse0"
No core pointer
</pre>

<p>
Para corregir esto, abra su archivo de configuración de X11 en un
editor y actualice la sección del ratón en <e>InputDevice</e> para
usar el dispositivo <path>/dev/input/mice</path>. A continuación un
ejemplo:
</p>

<pre caption="Abriendo su archivo de configuración X11">
# <i>nano -w /etc/X11/xorg.conf</i>
</pre>

<note>
Si todavía usa XFree86, su archivo de configuración será el
<path>/etc/X11/XF86Config</path>.
</note>

<pre caption="Ejemplo del ratón en la sección InputDevice">
Section "InputDevice"
	Identifier  "Mouse0"
	Driver      "mouse"
	Option      "Protocol" "auto"
	Option      "Device" "/dev/input/mice"
EndSection
</pre>
</body>
</section>
</chapter>

<chapter id="conf">
<title>Configurando, construyendo e instalando el kernel</title>
<section>
<body>

<p>
Así como en Linux 2.4, tiene dos opciones para manejar la construcción
de su nuevo kernel.
</p>

<ol>
  <li>
    El método por defecto es la configuración manual. Esto puede
    parecer desalentador pero es la manera preferida si uno conoce su
    sistema. Si desea configurar el kernel manualmente, continue con
    el <uri link="#manual">siguiente capítulo</uri>.
  </li>
  <li>
    lLa opción alternativa es usar nuestra herramienta
    <c>genkernel</c>, que automáticamente configura, compila e instala
    el kernel. Si desea usar <c>genkernel</c>, salte el siguiente
    capítulo y proceda con <uri link="#genkernel">usando genkernel</uri>.
  </li>
</ol>
</body>
</section>
</chapter>

<chapter id="manual">
<title>Por defecto: Configuración manual</title>
<section>
<title>Configurando el kernel</title>
<body>

<p>
Ahroa configuraremos el kernel. Inicie menuconfig de la manera usual:
</p>

<pre caption="Invocando menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Probablemente estará familiarizado con el uso de menuconfig con la
configuración de los kernel 2.4. Afortunadamente el interfaz casi no
ha cambiado, pero observará una organización mejor de las opciones del
kernel además de <e>muchas</e> opciones nuevas que no estaban
presentes en 2.4.
</p>

<p>
Asegúrese de activar las siguientes opciones importantes del kernel:
</p>

<pre caption="Opciones requeridas del kernel">
File systems ---&gt;
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [*] Virtual memory file system support (former shm fs)

<comment>(las siguientes son requeridas para udev):</comment>
General setup  ---&gt;
 [*] Support for hot-pluggable devices

Device Drivers  ---&gt;
 Block devices  ---&gt;
  &lt;*&gt; RAM disk support
  
<comment>(las siguientes se requieren para ALSA):</comment>
Device Drivers  ---&gt;
 Sound  ---&gt;
  &lt;*&gt; Sound card support
  Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   &lt;M&gt; Sequencer support
   &lt;M&gt; OSS Mixer API
   [*] OSS Sequencer API

<comment>(y ¡no se olvide seleccionar su tarjeta de sonido de los submenus!)</comment>
</pre>

<warn>
Previamente habrá incluido el soporte para el sistema de archivos
<path>/dev</path> (ahora marcado como OBSOLETO). No active el soporte
para devfs. Hemos instalado udev, que usaremos en vez de devfs de
ahora en adelante.
</warn>

<p>
También acuérdese de activar el soporte para los sistemas de archivo
que usa y para el hardware de su sistema. Asegúrese de activas soporte
para el controlador IDE de su tarjeta madre si quiere aprovechar
acceso rápido a los discos con DMA. Refiérase a la sección <uri
link="/doc/en/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurando
el Kernel</uri> del <uri link="/doc/en/handbook/index.xml">Manual
Gentoo</uri> para consejos adicionales.
</p>
</body>
</section>

<section>
<title>Construyendo el kernel</title>
<body>

<p>
Ahora que hemos configurado el kernel, podemos comenzar el proceso de compilación:
</p>

<pre caption="Compilando las fuentes del kernel">
# <i>make &amp;&amp; make modules_install</i>
</pre>

<note>
Tal vez recuerde haber tenido que correr <c>make dep</c> con las
fuentes de Linux 2.4. Esto ya no es necesario.
</note>

<p>
Espere que termine la compilación (y observe qué más legible es la
salida del proceso de compilación).
</p>
</body>
</section>

<section>
<title>Instalando el kernel</title>
<body>

<p>
El siguiente paso es monta su partición <path>/boot</path> para copiar
la imagen del kernel. Luego debe actualizar manualmente la
configuración de su gestor de arranque.
</p>

<pre caption="Instalando el kernel">
# <i>mount /boot</i>
# <i>cp arch/i386/boot/bzImage /boot/bzImage-2.6.9-gentoo-r2</i>
# <i>cp System.map /boot/System.map-2.6.9-gentoo-r2</i>
</pre>

<p>
Note que las instrucciones anteriores son solamente ejemplos, debe
seguir su procedimiento usual para actualizar el kernel, usando como
referencia las instrucciones en el <uri
link="/doc/en/handbook/index.xml">Manual Gentoo</uri> (vea el capítulo <uri
link="/doc/en/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurando
el Kernel</uri>).
</p>

<p>
Cuando actualice su configuración del gestor de arranque, no elimine
la entrada antigua al kernel 2.4. Así puede cambiar fácilmente entre
las dos en caso que algo no funcione.
</p>

<p>
Ahora continue con la sección <uri link="#modules">Configuración de Módulos</uri>.
</p>
</body>
</section>
</chapter>

<chapter id="genkernel">
<title>Alternativa: Usando genkernel</title>
<section>
<body>

<p>
Si prefiere usar genkernel en vez de configurar su kernl manualmente,
le contentará escuchar que usando genkernel para producir kernels 2.6
es muy similar al proceso para producir los kernels 2.4 previos.
</p>

<p>
Debe invocar genkernel como en el ejemplo:
</p>

<pre caption="Invocando genkernel con algunos argumentos comunes">
# <i>genkernel --udev --menuconfig --bootloader=grub all</i>
</pre>

<p>
En el ejemplo anterior, nos aprovechamos de las características de
genkernel para abrir menuconfig para permitirle personalizar la
configuración del kernel (si así lo desea) y para actualizar el gestor
de arranque grub luego de la compilación.
</p>

<p>
Debe escoger los argumentos de genkernel que le convengan, pero ¡no se
olvide incluir el argumento <c>--udev</c>! Consulte la <uri
link="/doc/en/genkernel.xml">Guía Gentoo Linux de Genkernel</uri> y el
capítulo <uri
link="/doc/en/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurando
el the Kernel</uri> del <uri link="/doc/en/handbook/index.xml">Manual
Gentoo</uri> para más información.
</p>
</body>
</section>
</chapter>

<chapter id="modules">
<title>Configuración de Módulos</title>

<section>
<title>Instalando módulos externos</title>
<body>

<p>
Muchos usuarios adicionalmente confiarán en módulos del kernel
construidos afuera del árbol de fuentes del kernel. Algunos ejemplos
comunes son los manejadores gráficos binarios de ATI y NVidia. Ahora
debe instalarlos, porque compilarán contra las fuentes 2.6 apuntados
por <path>/usr/src/linux</path>. Este es el caso típico de <c>emerge
paquete</c> para todos los módulos externos que acostumbra usar con el 2.4.
</p>

<p>
De nuevo refiérase a capítulo <uri
link="/doc/en/handbook/handbook-x86.xml?part=1&amp;chap=7">Configurando el
Kernel</uri> del <uri link="/doc/en/handbook/index.xml">Manual
Gentoo</uri> para más información.
</p>
</body>
</section>

<section>
<title>Autocargando los módulos</title>
<body>

<p>
Tal vez haya decidido compilar algunos componentes del kernel como
módulos (en vez de directamente en el kernel) y le gustaría que se
cargasen automáticamente al arrancar, tal como lo hizo con
2.4. Si ha instalado algún módulo externo del árbol portage
(descrito anteriormente), tal vez quiera cargarlos automáticamente
también.
</p>

<p>
Esto se hace de manera similar a como se hizo con 2.4. Sencillamente
abra su archivo <path>/etc/modules.autoload.d/kernel-2.6</path> en un
editor de textos y escriba los nombres de los módulos que desea cargar automáticamente.
</p>

<pre caption="Abriendo la lista de módulos autocargados en nano">
# <i>nano -w /etc/modules.autoload.d/kernel-2.6</i>
</pre>

<pre caption="Ejemplo de lista con módulos autocargados para 3c59x y nvidia">
# /etc/modules.autoload.d/kernel-2.6:  kernel modules to load when system boots.
#
# Note that this file is for 2.6 kernels.
#
# Add the names of modules that you'd like to load when the system
# starts into this file, one per line.  Comments begin with # and
# are ignored.  Read man modules.autoload for additional details.

3c59x
nvidia
</pre>
</body>
</section>

<section>
<title>Configurando los módulos ALSA</title>
<body>

<p>
Habrá notado que escogimos compilar ALSA como módulos. Ahora podemos
configurar su comportamiento fácilmente. Sin embargo, también
necesitamos configurar cuáles módulos hemos de cargar. Abra el archivo
<path>/etc/modules.d/alsa</path> en su editor de textos:
</p>

<pre caption="Abriendo /etc/modules.d/alsa en nano">
# <i>nano -w /etc/modules.d/alsa</i>
</pre>

<p>
Ahora busque la sección marcada <e>IMPORTANT</e>. En la mayoría de los
casos, apenas hará falta descomentar y modificar los alias snd-card-0
y snd-slot-0.
</p>

<pre caption="Sección del archivo /etc/modules.d/alsa como ejemplo">
## IMPORTANT:
## You need to customise this section for your specific sound card(s)
## and then run `update-modules' command.
## Read alsa-driver's INSTALL file in /usr/share/doc for more info.
##
##  ALSA portion

#   My laptop uses the snd-maestro3 driver
alias snd-card-0 snd-maestro3

##  OSS/Free portion

# Generally all you need to do is uncomment this line:
alias sound-slot-0 snd-card-0
</pre>

<p>
Para mayor información acerca de cuál manejador escoger y usar,
consulte la <uri link="/doc/en/alsa-guide.xml">Guía Gentoo Linux de
ALSA</uri>. Recuerde que en este archivo los manejadores se prefijan
con <e>snd-</e>.
</p>

<p>
Finalmente, agregue el guión <c>alsasound</c> para ser ejecutado al
arrancar:
</p>

<pre caption="Agregando alsasound al nivel de ejecución default">
# <i>rc-update add alsasound boot</i>
</pre>
</body>
</section>
</chapter>

<chapter>
<title>Arrancando en Linux 2.6</title>
<section>
<body>

<p>
Ahora, es hora de arrancar en Linux 2.6. Cierre todas sus aplicaciones
y reinice la máquina:
</p>

<pre caption="Reiniciando">
# <i>modules-update</i>
# <i>umount /boot</i>
# <i>reboot</i>
</pre>

<p>
Al reiniciar, si siguió este documento correctamente hasta ahora,
podrá optar por cargar Linux 2.4 o Linux 2.6 desde el gestor de
arranque. Escoja Linux 2.6.
</p>

<p>
Una vez arrancado el sistema, revise que todo esté funcionando. Si ha
cometido alguna equivocación en la configuración del kernel, no se
preocupe, regrese a <uri link="#conf">Configurando, construyendo e
instalando el kernel</uri>, realice su cambio, recompile e instale la
nueva imagen del kernel, reinicie e ¡inténtelo de nuevo!
</p>
</body>
</section>

<section>
<title>Ponga a sonar sus canales ALSA</title>
<body>

<p>
Por defecto, los canales ALSA están silenciados, así que no escuchará
nada cuando vaya a reproducir algún sonido. Hará falta aumentar el
volumen ahora. Ejecute el programa <c>alsamixer</c> desde una consola
y use las flechas del teclado para ubicarse y ajustar los volúmenes y
la tecla M (de mute) para activar y desactivar el sonido. Lea la <uri
link="/doc/en/alsa-guide.xml">Guía Gentoo Linux de ALSA</uri> para la
documentación más completa y para otras formas de hacer esto.
</p>

<note>
El guión alsasound que colocamos en el nivel de ejecución default
guardará los niveles de volumen del mezclador al apagar y los
restaurará al reiniciar. ¡No hará falta ajustar los volúmenes cada vez
que arranque!
</note>
</body>
</section>
</chapter>

<chapter>
<title>Archivos de cabecera y NPTL</title>
<section>
<body>

<p>
Ya debe estar corriendo Linux 2.6 y esperemos que sin mayores
problemas. Ahora toca actualizar los archivos de cabecera Linux y
hacer emerge otra vez del glibc para que las aplicaciones del
userspace puedan aprovechar las nuevas características de Linux 2.6.
</p>

<pre caption="Actualizando a linux26-headers">
# <i>emerge unmerge linux-headers</i>
# <i>emerge linux26-headers</i>
</pre>

<p>
Después de actualizar el paquete de archivos de cabecera, debería
recompilar el glibc. Hay una nueva característica que tal vez le
interese, NPTL. NPTL es un modelo nuevo de hilo de ejecución que
presenta creaciones y destrucciones mucho más rápidas. Esto tal vez no
haga mucha diferencia en la mayoría de los sistemas, pero tal vez
desee activarlo como parte del proceso de migración. Para hacer esto,
modifique el archivo <path>/etc/make.conf</path> y agregue <e>nptl</e>
a sus parámetros USE.
</p>

<warn>
Le advertimos que con los glibc estables actuales no podrá arrancar un
kernel 2.4 luego de compilar glibc con USE="nptl". ¡Precaución!
</warn>

<p>
Ahora haga emerge glibc (debería hacer esto, aunque no haya activado NPTL).
</p>

<pre caption="Reinstalando glibc con los nuevos archivos de cabecera">
# <i>emerge -a glibc</i>
</pre>

<p>
Si ha activado NPTL. los binarios existentes no lo usarán hasta que
sean recompilados. Sin embargo, todos los binarios creados desde este
momento <e>sw</e> usarán NPTL. Tal vez quiera recompilar todos los
binarios en este momento, por ejemplo:
</p>

<pre caption="Recompilando todos los paquetes del sistema">
# <i>emerge -e world</i>
</pre>

<p>
Alternativamente, puede dejar que su sistema se convierta
"naturalmente" a usar NPTL, a medida que vaya actualizando sus
paquetes a sus últimas versiones cuando éstos sean lanzados.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Comentarios de cierre</title>
<section>
<title>¿Problemas?</title>
<body>

<p>
Con la increíble cantidad de trabajo invertida en Linux 2.6, a veces
luce inevitable que algunas cosas que funcionaban perfectamente, ahora
no lo hacen como antes.
</p>

<p>
Si tiene algún problema con su kernel 2.6 y puede confirmar que no
existía en Linux 2.4, por favor reporte un bug con nosotros en nuestro
<uri link="http://bugs.gentoo.org">Bugzilla</uri>. Lo investigaremos y
si encontramos que es un problema con las fuentes originales del
kernel, le pediremos que lo reporte al bugzilla central del kernel.
</p>
</body>
</section>

<section>
<title>Conclusión</title>
<body>

<p>
Tenemos la esperanza que acaba de completar una migración sin
sobresaltos y esté disfrutando de los beneficios que Linux 2.6 nos
trae, por encima del 2.4. Como mencionamos al inicio, estamos buscando
opiniones acerca de este documento, aunque solo sea para avisar que le
fue perfectamente. Por favor envíenos <mail
link="dsd@gentoo.org">correo</mail> con sus opiniones para que podamos
darle forma perfecta para cuando venga Gentoo 2005.0. ¡Gracias!
</p>
</body>
</section>
</chapter>
</guide>
