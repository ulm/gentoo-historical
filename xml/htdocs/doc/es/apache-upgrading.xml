<?xml version='1.0' encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/apache-upgrading.xml,v 1.4 2006/05/30 11:53:54 chiguire Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/es/apache-upgrading.xml" lang="es">
<title>Actualizar Apache</title>

<author title="Autor">
  <mail link="vericgar@gentoo.org">Michael Stewart</mail>
</author>
<author title="Traductor">
  <mail link="enrique@barbeito.org">Enrique Barbeito García</mail>
</author>

<abstract>
Este documento describe el método que los usuarios finales deberían seguir para
actualizar sin ningún riesgo sus instalaciones de Apache.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.3</version>
<date>2005-09-29</date>

<chapter>
<title>Introducción</title>
<section>
<body>

<p>
El estado de Apache y sus módulos en Gentoo se estaba volviendo penoso. Había
ciertos problemas que causaron inconvenientes en el soporte e hicieron difícil
el trabajo del grupo de Apache:
</p>

<ul>
  <li>
    La configuración que venía en Gentoo era terriblemente distinta a la que la
    mayoría de usuarios esperan
  </li>
  <li>
    Muchos módulos usaban código parecido pero todos hacían las cosas a su
    manera
  </li>
  <li>
    La mayoría de los módulos no estaban mantenidos demasiado bien - debido
    principalmente al gran número de ellos disponible
  </li>
  <li>Los módulos no tenían una configuración estándar</li>
  <li>
    Algunos módulos podían soportar ambas versiones de Apache pero los
    ebuilds no lo controlaban
  </li>
  <li>
    Las opciones disponibles en Apache no estaban disponibles para los usuarios
    de Gentoo (por ejemplo, los MPMs --Módulos de MultiProcesamiento--)
  </li>
  <li>Los bugs para Apache se estaban acumulando</li>
</ul>

<p>
¿La solución? El grupo de Apache fue ampliado, se unieron nuevos miembros que
trabajaron juntos para crear una eclass, actualizar todos los módulos y
arreglar varios fallos.
</p>

<p>
Este documento detalla el modo de actualizar sin estropear su sistema. Si es 
desarrollador o le gustaría saber qué hemos cambiado, o cómo tienen que
modificarse los ebuilds para aprovecharse de nuestra eclass, revise el <uri 
link="apache-developer.xml">Apache Developer Reference</uri>.
</p>

</body>
</section>
</chapter>

<chapter id="upgrade">
<title>Instrucciones para la actualización</title>
<section>
<body>

<p>
Hemos hecho muchos cambios en cómo Apache funciona en Gentoo. Cada paquete que
está relacionado directamente con Apache, necesita ser actualizado y algunas
cosas que funcionaban anteriormente dejarán de hacerlo.
</p>

<p>
Lo primero que necesita es calcular qué paquetes tiene que actualizar. Puede
hacerlo mediante la herramienta <c>equery</c> que forma parte del paquete
<c>app-portage/gentoolkit</c>.
</p>

<pre caption="Buscar paquetes para actualizar">
$ <i>equery depends net-www/apache</i>
[ Searching for packages depending on net-www/apache... ]
dev-db/phpmyadmin-2.5.6
dev-php/mod_php-4.3.10
dev-php/phpsysinfo-2.1-r2
net-www/mod_bandwidth-2.0.5
net-www/mod_layout-4.0.1a
net-www/mod_ldap_userdir-1.1.4
net-www/mod_loopback-1.04
net-www/mod_mp3-0.40
net-www/mod_random-2.0
net-www/mod_throttle-3.1.2-r1
net-www/mod_watch-3.18
www-apps/viewcvs-0.9.2_p20030430
</pre>

<impo>
Los paquetes que tiene instalados pueden ser considerablemente distintos;
asegúrese de ejecutar este comando usted mismo.
</impo>

<warn>
Hay algunos módulos y paquetes que dependen de Apache y que todavía no han sido
actualizados. Por favor, <uri link="http://bugs.gentoo.org">busque en
bugzilla</uri> cualquier paquete crítico que utilice con Apache.
</warn>

<p>
Muchas aplicaciones web no están afectadas de ningún modo mientras que la
mayoría utilizan la eclass <c>webapp</c> la cual se preocupa de instalarlas
adecuadamente. Puede que quiera comprobar y ver si hay una nueva versión.
</p>

<p>
Ya que hemos añadido nuevos parámetros USE, tal vez quiera revisarlos e incluir
en <path>/etc/portage/package.use</path> las líneas apropiadas. Para más
detalles, vea los <uri link="#use">parámetros USE soportados por Apache</uri>
</p>

<pre caption="Revisar las configuraciones de parámetros USE y reconstruir">
<comment>(Comprobar los parámetros USE y actualizaciones necesarias)</comment>
# <i>emerge --pretend --verbose --update --newuse --deep apache subversion \
mod_php mod_bandwidth mod_layout mod_ldap_userdir mod_loopback mod_mp3 \ 
mod_random mod_throttle mod_watch</i>

<comment>(Actualizar los paquetes)</comment>
# <i>emerge --verbose --update --newuse --deep apache subversion mod_php \
mod_bandwidth mod_layout mod_ldap_userdir mod_loopback mod_mp3 mod_random \
mod_throttle mod_watch</i>

<comment>(Puede ser más fácil actualizar todo el sistema en vez de lo
anterior)</comment>
# <i>emerge --ask --verbose --update --newuse --deep world</i>
</pre>

<p>
Ahora tiene que reconfigurar Apache y sus módulos. Empiece usando
<c>etc-update</c> o <c>dispatch-conf</c> para actualizar los ficheros
<path>/etc/init.d</path> y <path>/etc/conf.d</path>. Notará que sus ficheros de
configuración de Apache no se verán en las actualizaciones - esto es debido a
que todos los ficheros de configuración se han movido.
</p>

<p>
Si ha hecho cambios en los anteriores <path>apache.conf</path> y
<path>commonapache.conf</path> originales, tendrá entonces que migrar sus
modificaciones a <path>/etc/apache{|2}/httpd.conf</path>. También han cambiado
las ubicaciones de la configuración para los módulos y hosts virtuales -- ahora
se encuentran en <path>/etc/apache2/modules.d</path> y
<path>/etc/apache2/vhosts.d</path> respectivamente.
</p>

<p>
Cuando haya terminado de migrar sus modificaciones al nuevo fichero de
configuración, tendrá entonces que eliminar los antiguos ficheros de
configuración (o moverlos a un lugar seguro). El nuevo
<path>/etc/init.d/apache{|2}</path> comprueba que no existan estos ficheros y
no le permite iniciar Apache a menos que los haya eliminado, indicándole así
que lo ha reconfigurado utilizando las nuevas rutas.
</p>

<note>
Muchos módulos que, por defecto, solían estar habilitados ahora no lo están. Si
son módulos de Apache incorporados, entonces descomente las línea apropiada en
httpd.conf. Si son módulos externos, compruebe sus ficheros .conf para ver si
hay <c>IfDefine</c> y añada el nombre a <path>/etc/conf.d/apache{|2}</path>
para habilitarlo.
</note>

<p>
Ahora puede reiniciar Apache.
</p>

<pre caption="Reiniciar Apache">
# <i>/etc/init.d/apache stop</i>
# <i>/etc/init.d/apache start</i>
</pre>

<p>
Si se topa con algún problema revise la <uri 
link="/doc/es/apache-troubleshooting.xml">Solución de problemas de Apache</uri>
y si ello no le soluciona la duda, por favor, informe de ello en el <uri 
link="http://bugs.gentoo.org">Bugzilla de Gentoo</uri>. Cerciórese de incluir
los módulos que tiene habilitados y, en el caso de utilizar Apache 2, con qué
parámetros USE para MPM lo compiló (si utilizó alguno). También puede
conectarse al canal <path>#gentoo-apache</path> de
<path>irc.freenode.net</path> para obtener ayuda.
</p>

</body>
</section>
</chapter>

<chapter id="use">
<title>Parámetros USE soportados por Apache</title>
<section>
<body>


<p>
Hay parámetros USE que son locales para Apache y sus módulos. Además, Apache
soporta otros muchos parámetros USE genéricos como, por ejemplo, <c>ssl</c>,
pero el efecto que tienen en éste no difiere demasiado del efecto que tienen
en otros paquetes, por lo que no se han incluido en la siguiente lista. Ejecute
<c>emerge --verbose --pretend apache</c> para ver el listado completo de
parámetros USE soportados.
</p>

<table>
<tr>
  <th>Parámetro USE</th>
  <th>Paquetes</th>
  <th>Descripción</th>
</tr>
<tr>
  <ti>apache2</ti>
  <ti>depend.apache eclass (todos los módulos)</ti>
  <ti>
    Se debería fijar siempre si se usa la rama 2.0 de Apache. No se debería
    fijar si se utiliza la 1.3. La eclass lo emplea para determinar a qué
    versión de Apache depende.</ti>
</tr>
<tr>
  <ti>mpm-leader</ti>
  <ti>apache-2*</ti>
  <ti>
    Crea el MPM <uri
    link="http://httpd.apache.org/docs-2.0/mod/leader.html">leader</uri></ti>
</tr>
<tr>
  <ti>mpm-metux</ti>
  <ti>apache-2*</ti>
  <ti>Crea el MPM <uri link="http://www.metux.de/mpm/">metux</uri></ti>
</tr>
<tr>
  <ti>mpm-peruser</ti>
  <ti>apache-2*</ti>
  <ti>
    Crea el MPM <uri link="http://www.telana.com/peruser.php">peruser</uri>
  </ti>
</tr>
<tr>
  <ti>mpm-prefork</ti>
  <ti>apache-2*</ti>
  <ti>
    Crea el MPM <uri
    link="http://httpd.apache.org/docs-2.0/mod/prefork.html">prefork</uri></ti>
</tr>
<tr>
  <ti>mpm-threadpool</ti>
  <ti>apache-2*</ti>
  <ti>
    Crea el MPM <uri
    link="http://httpd.apache.org/docs-2.0/mod/threadpool.html">threadpool</uri></ti>
</tr>
<tr>
  <ti>mpm-worker</ti>
  <ti>apache-2*</ti>
  <ti>
    Crea el MPM <uri
    link="http://httpd.apache.org/docs-2.0/mod/worker.html">worker</uri></ti>
</tr>
<tr>
  <ti>no-suexec</ti>
  <ti>apache</ti>
  <ti>
    Inhabilita la creación del módulo suexec (para aquellos que no quieren
    tener en sus sistemas un binario suid potencialmente inseguro)
  </ti>
</tr>
<tr>
  <ti>static-modules</ti>
  <ti>apache</ti>
  <ti>
    Enlaza estáticamente los módulos con el binario apache, por lo que no es
    necesario un LoadModule para cargar los módulos base en Apache.
  </ti>
</tr>
<tr>
  <ti>lingerd</ti>
  <ti>apache-1*</ti>
  <ti>
    Añade soporte para <uri   
    link="http://www.iagora.com/about/software/lingerd/">lingerd</uri>
  </ti>
</tr>
<tr>
  <ti>no-htdocs</ti>
  <ti>gentoo-webroot-default</ti>
  <ti>
    Inhabilita la instalación del webroot por defecto en
    <path>/var/www/localhost</path> por lo que no sobreescribe los ficheros
    personales. En su lugar, el webroot se instala en
    <path>/usr/share/doc/gentoo-webroot-default-*/webroot/</path>.
  </ti>
</tr>
</table>

<note>
Mientras hayan muchos parámetros USE mpm-* activos, estos se excluirán
mutuamente. Debería habilitar uno y solo uno de ellos. (Si no habilita ninguno,
mpm-prefork o mpm-worker serán usados, dependiendo de si el parámetro USE
threads está establecido)
</note>

</body>
</section>
</chapter>

</guide>
