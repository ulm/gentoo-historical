<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/alsa-guide.xml,v 1.6 2005/03/30 13:23:36 chiguire Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/es/alsa-guide.xml" lang="es">
<title>Guía ALSA para Gentoo Linux</title>
<author title="Autor">
  <mail link="zu@pandora.be">Vincent Verleye</mail>
</author>
<author title="Autor">
  <mail link="g2boojum@gentoo.org">Grant Goodyear</mail>
</author>
<author title="Autor">
  <mail link="agenkin@gentoo.org">Arcady Genkin</mail>
</author>
<author title="Autor">
  <mail link="eradicator@gentoo.org">Jeremy Huddleston</mail>
</author>
<author title="Editor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Editor">
  <mail link="bennyc@gentoo.org">Benny Chuang</mail>
</author>
<author title="Editor">
  <mail link="blubber@gentoo.org">Tiemo Kieft</mail>
</author>
<author title="Editor">
  <mail link="erwin@gentoo.org">Erwin</mail>
</author>
<author title="Editor Es">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es">
    <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
 </author>
<author title="Editor Es">
    <mail link="yoswink@gentoo.org">José Luis Rivero</mail>
 </author>
<author title="Traductor">
  <mail link="linux_blues@yahoo.es">LinuxBlues</mail>
</author>

<abstract>
Esta guía muestra como configurar la Arquitectura Avanzada de Sonido Linux
(ALSA) en Gentoo. Como complemento a la Guía de Configuración del Escritorio
de Gentoo, esta guía pretende proporcionar más información a este respecto.
</abstract>

<license/>

<version>1.5.11</version>
<date>2005-03-06</date>

<chapter>
<title>Arquitectura Avanzada de Sonido Linux</title>
<section>
<title>¿Qué es ALSA?</title>
<body>

<p>
ALSA es la <e>Arquitectura Avanzada de Sonido Linux</e>, un proyecto dedicado
al desarrollo de un subsistema de sonido de alta calidad. Ha reemplazado a OSS
(<e>Sistema de Sonido Abierto</e>) como subsistema de sonido por defecto en la
serie de kernels 2.6.
</p>

<p>
ALSA proporciona un soporte eficiente para todo tipo de interfaz de audio,
está completamente modularizada, es SMP y de hilo-seguro y proporciona una
librería de alta calidad en espacio de usuario llamada <e>alsa-lib</e>
para hacer más sencilla la programación de aplicaciones. También provee
compatibilidad con la anterior capa OSS.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Instalando ALSA</title>
<section>
<title>Parámetros USE</title>
<body>

<p>
Gentoo proporciona parámetro USE <c>alsa</c>, que se debe añadir en <path>/etc/make.conf</path> para permitir a los paquetes disponibles compilarse con soporte ALSA. Si se tiene <c>oss</c> en la variable USE también, ALSA se compilará con compatibilidad con la anterior capa OSS.
</p>

</body>
</section>
<section>
<title>Módulos del Núcleo (Kernel)</title>
<body>

<p>
Primero, antes de continuar, hay que asegurarse de que el núcleo tiene <e>Sound Card
Support</e> (Soporte de Tarjeta de Sonido) habilitado. Si se usó <c>genkernel</c> para
construir el kernel, entonces lo estará automáticamente. De no ser así, ha de reconfigurarse
el núcleo.  Adicionalmente, hay que asegurarse de que <e>Open Sound System</e> está
deshabilitado en la configuración del núcleo. Si no, el sistema tratará de usar esos
controladores en lugar de ALSA. Si se presenta el mensaje 'sound card not detected'
y se estas seguro de que se tiene el controlador correcto, esta es probablemente la razón.
</p>

<warn>
Si se usa un núcleo 2.6, pueden usarse los controladores proporcionados en el
núcleo, pero se recomienda usar media-sound/alsa-driver, dado que están más
actualizados que los proporcionados en el núcleo. Si se desean usar los
proporcionados en el núcleo, puede evitarse el resto de la sección y continuar
con <uri link="#alsa-utils">Instalando las utilidades ALSA</uri>.
</warn>

<p>
El primer paso para instalar los controladores de sonido es conocer la
tarjeta de sonido de la que se dispone. De no saberlo, un truco sencillo
es buscar "audio" en la salida del comando <c>lspci</c>. Puede instalarse
esta utilidad con <c>emerge pciutils</c>.
</p>

<pre caption="Encontrando el tipo de tarjeta de sonido">
# <i>lspci | grep -i audio</i>
Multimedia audio controller: VIA Technologies, Inc. VT82C686 AC97 Audio Controller (rev 64).
</pre>

<p>
Ahora se visita la <uri link="http://www.alsa-project.org/alsa-doc">Matriz de tarjetas
ALSA</uri> y se busca la tarjeta de sonido. En el ejemplo anterior debe irse al
fabricante "VIA". Lo cual mostrará una tabla con el conjunto de chips conocido del
fabricante. El conjunto de chips del ejemplo anterior es "via82c686"; el enlace
"Details" informa de que el controlador se llama <path>via82xx</path>. Esta es toda
la información que necesitas.
</p>

<p>
Basándose en esta información puede instalarse el <c>alsa-driver</c> para nuestra
tarjeta. Primero se edita <path>/etc/make.conf</path> y se <e>añade</e> una opción
nueva, llamada ALSA_CARDS, al mismo. En esta variable se indica el controlador de la
tarjeta de sonido que se desea usar:
</p>

<pre caption="Editando ALSA_CARDS en /etc/make.conf">
ALSA_CARDS="via82xx"
</pre>

<warn>
De disponer de más de una tarjeta de sonido, han de separarse con una coma en la variable
ALSA_CARDS.  Ej: ALSA_CARDS="via82xx,emu10k1"
</warn>

<p>
De querer compatibilidad con OSS (se recomienda encarecidamente), debe añadirse 'oss' a los
parámetros USE en <path>/etc/make.conf</path>. Ahora puede instalarse <c>alsa-driver</c>:
</p>

<pre caption="Instalando los controladores ALSA">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Siempre que se (re)compile el código del núcleo, es posible que los controladores
ALSA sean borrados. Por tanto, hay que advertir que será necesario ejecutar
<c>emerge alsa-driver</c> de nuevo, cada vez que se (re)compile el núcleo. Nótese que
esto compilará los controladores para el núcleo en /usr/src/linux, NO para el núcleo en
ejecución.
</impo>

</body>
</section>
<section id="alsa-utils">
<title>Instalando las utilidades ALSA</title>
<body>

<p>
Si con la compatibilidad OSS del núcleo no es suficiente, puede instalarse
<c>alsa-oss</c>. Esto proporcionará el ejecutable 'aoss', que puede usarse
así:
</p>

<pre caption="Más compatibilidad con la capa OSS">
# <i>emerge alsa-oss</i>
# <i>aoss mpg123 music.mp3</i>
</pre>

<p>
Ahora han de instalarse las utilidades ALSA en el sistema (esto es obligatorio):
</p>

<pre caption="Instalando las utilidades ALSA">
# <i>emerge alsa-utils</i>
</pre>

<p>
Con las utilidades instaladas, es el momento de configurar ALSA...
</p>

</body>
</section>
</chapter>
<chapter>
<title>Configurando ALSA</title>
<section>
<title>Cargar los módulos del núcleo automáticamente</title>
<body>

<p>
De usarse un núcleo modular (como cuando se usa <c>genkernel</c>), ha de
editarse <path>/etc/modules.d/alsa</path> para que se inicien los módulos
necesarios al inicio. Para la tarjeta de sonido de nuestro ejemplo:
</p>

<pre caption="/etc/modules.d/alsa">
alias snd-card-0 snd-via82xx
<comment># The following is only needed when you want OSS compatibility</comment>
alias sound-slot-0 snd-via82xx
alias /dev/mixer snd-mixer-oss
alias /dev/dsp snd-pcm-oss
alias /dev/midi snd-seq-oss
</pre>

<p>
Ahora se ejecuta <c>modules-update</c> para guardar los cambios hechos al
fichero <path>alsa</path> en <path>/etc/modules.conf</path>:
</p>

<pre caption="Ejecutando modules-update">
# <i>modules-update</i>
</pre>

</body>
</section>
<section>
<title>Verificando los dispositivos</title>
<body>

<p>
Esto debe hacerse automáticamente en instalaciones recientes, pero de tener
problemas, comprueba que los dispositivos ALSA y sus permisos están configurados
correctamente por el gestor de /dev. De usarse DevFS, comprueba <path>/etc/devfsd.conf</path>
</p>

<pre caption="/etc/devfsd.conf">
# ALSA/OSS stuff
# Comment/change these if you want to change the permissions on
# the audio devices
LOOKUP          snd          MODLOAD ACTION snd
LOOKUP          dsp          MODLOAD
LOOKUP          mixer        MODLOAD
LOOKUP          midi         MODLOAD
REGISTER        sound/.*     PERMISSIONS root.audio 660
REGISTER        snd/.*       PERMISSIONS root.audio 660
</pre>

</body>
</section>
<section>
<title>Activar ALSA al inicio</title>
<body>

<p>
Para activar el soporte ALSA al inicio, ha de añadirse el macro <c>alsasound</c> al nivel
de ejecución de inicio:
</p>

<pre caption="Añadiendo alsasound al nivel de ejecución de inicio">
# <i>rc-update add alsasound boot</i>
# <i>/etc/init.d/alsasound start</i>
</pre>

</body>
</section>
<section>
<title>Quitando el silencio de canales</title>
<body>

<p>
Por defecto, todos los canales de sonido están silenciados. Para corregir esto,
ejecuta <c>amixer</c>:
</p>

<pre caption="Ejecutando amixer">
# <i>amixer</i>
</pre>

<p>
Si <c>amixer</c> muestra mucha información, entonces puede quitarse el silenciado
de canales. De mostrar un error, hay que asegurarse de que el módulo de la tarjeta
de sonido esté cargado.
</p>

<p>
Ahora ha de darse volumen a los canales <e>Master</e> y <e>PCM</e>. Si esto no es suficiente,
ha de darse volumen también a los canales <e>Center</e> y <e>Surround</e>.
</p>

<pre caption="Quitando el silencio de canales">
<comment>(Si se prefiere un método ncurses:)</comment>

# <i>alsamixer</i>

<comment>(o)</comment>

# <i>amixer set Master 100% unmute</i>
# <i>amixer set PCM 100% unmute</i>
<comment>(Sólo si con lo anterior no es suficiente:)</comment>
# <i>amixer set Center 100% unmute</i>
# <i>amixer set Surround 100% unmute</i>
# <i>amixer set Headphone 100% unmute</i>
</pre>


<p>
Para comprobar que el sonido funciona, reproducir un archivo (wav, usando
<c>aplay</c>), mp3 (usando <c>mpg123</c> o incluso <c>mplayer</c>) o 
cualquier otro fichero de audio para ello.
</p>

</body>
</section>
</chapter>
<chapter>
<title>Activando el soporte MIDI</title>
<section>
<title>Instalando los paquetes necesarios</title>
<body>

<p>
Algunas tarjetas de sonido incluyen sintetizadores MIDI. Para usarlos, debe
instalarse primero el paquete <c>awesfx</c>:
</p>

<pre caption="Instalando el paquete awesfx">
# <i>emerge awesfx</i>
</pre>

<p>
De disponer de una colección de fuentes de sonido (catálogo de instrumentos
MIDI), ha de colocarse en <path>/usr/share/sfbank</path>. Por ejemplo, la SBLive
tiene un catálogo llamado <path>8MBGMSFX.SF2</path> o <path>CT4GMSFX.SF2</path>.
</p>

<p>
Después de copiar la fuente de sonido, se selecciona usando <c>asfxload</c>:
</p>

<pre caption="Cargando la fuente de sonido">
# <i>asfxload /usr/share/sfbank/8MBGMSFX.SF2</i>
</pre>

<p>
Debe ejecutarse este comando cada vez que se inicia el sistema, por tanto, es
recomendable añadirlo a <path>/etc/conf.d/local.start</path> también.
</p>

<p>
Si no hay fuentes de sonido en el CD de controladores de la tarjeta, pueden
descargarse algunas de <uri>http://www.parabola.demon.co.uk/alsa/awe64.html</uri>.
</p>

</body>
</section>
<section>
<title>Sintetizador virtual Timidity++</title>
<body>

<p>
Si la tarjeta de sonido no dispone de sintetizador (o no se quiere usar
el mismo), puede usarse <c>timidity++</c> que proporciona un sintetizador
virtual.
</p>

<pre caption="Instalando Timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Para que timidity reproduzca sonidos, necesita una fuente de sonido. De no disponer
de una, puede instalarse <c>timidity-eawpatches</c> o <c>timidity-shompatches</c>
que proporcionan algunas fuentes de sonido. Se pueden tener varias configuraciones
de fuentes de sonido y se puede tener una propia en <path>/usr/share/timidity/</path>.
Para elegir la configuración de timidity, debe usarse la herramienta <e>timidity-update</e>
proporcionada en el paquete timidity++.
</p>

<pre caption="Instalando fuentes de sonido">
# <i>emerge timidity-eawpatches</i>
# <i>timidity-update -g -s eawpatches</i>

<comment>(o)</comment>

# <i>emerge timidity-shompatches</i>
# <i>timidity-update -g -s shompatches</i>
</pre>

<p>
No hay que olvidar añadir <c>timidity</c> al nivel de ejecución default.
</p>

<pre caption="Añadiendo timidity al nivel de ejecución default">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

</body>
</section>
<section>
<title>Comprobando el soporte MIDI</title>
<body>

<p>
Puedes usar <c>aplaymidi</c> de las utilidades ALSA para comprobar
la configuración MIDI.
</p>

<p>
Para ver los puertos de salida MIDI disponibles en el sistema, se usa la
opción <c>-l</c>:
</p>

<pre caption="Viendo los puertos de salida MIDI">
# <i>aplaymidi -l</i>
</pre>

<p>
Si todo parece correcto, intentaremos reproducir un fichero MIDI para
asegurarnos de que todo funciona. Con la opción <c>-p</c> definimos el
puerto MIDI a usar.
</p>

<pre caption="Reproduciendo un fichero MIDI">
# <i>aplaymidi -p 65:0 "Final Fantasy 7 - Aerith' Theme.mid"</i>
</pre>

</body>
</section>
</chapter>
<chapter>
<title>Comentarios finales</title>
<section>
<title>Herramientas y Microcódigo</title>
<body>

<p>
Algunas tarjetas de sonido específicas pueden beneficiarse de ciertas
herramientas proporcionadas por los paquetes <c>alsa-tools</c> y
<c>alsa-firmware</c>. De necesitar <c>alsa-tools</c>, hay que asegurarse
de definir la variable ALSA_TOOLS en <path>/etc/make.conf</path> con las
herramientas requeridas. Por ejemplo:
</p>

<pre caption="Seleccionando las herramientas ALSA en /etc/make.conf">
ALSA_TOOLS="as10k1 ac3dec"
</pre>

<p>
Después se instalan los paquetes <c>alsa-tools</c> (y/o <c>alsa-firmware</c>):
</p>

<pre caption="Instalando las herramientas ALSA">
# <i>emerge alsa-tools</i>
</pre>

</body>
</section>
<section>
<title>Activando el soporte para el joystick (mando de juegos)</title>
<body>

<p>
Si la tarjeta de sonido dispone de una conexión para joystick, podría
interesarnos activar el soporte para el joystick. De ser así, verifiquemos
si el controlador de la tarjeta de sonido tiene el parámetro de joystick
. Ejecutemos <c>modinfo</c> con respecto al módulo del núcleo. Por
ejemplo, para <c>snd-via82xx</c>:
</p>

<pre caption="Ejecutando modinfo">
# <i>modinfo snd-via82xx</i>
filename:    /lib/modules/2.4.22-ck2/snd-via82xx.o
description: "VIA VT82xx audio"
author:      "Jaroslav Kysela &lt;perex@suse.cz&gt;"
license:     "GPL"
parm:        index int array (min = 1, max = 8), description "Index value for
             VIA 82xx bridge."
parm:        id string array (min = 1, max = 8), description "ID string for VIA
             82xx bridge."
parm:        enable int array (min = 1, max = 8), description "Enable audio part
             of VIA 82xx bridge."
parm:        mpu_port long array (min = 1, max = 8), description "MPU-401 port.
             (VT82C686x only)"
<i>parm:        joystick int array (min = 1, max = 8), description "Enable
             joystick. (VT82C686x only)"</i>
parm:        ac97_clock int array (min = 1, max = 8), description "AC'97 codec
             clock (default 48000Hz)."
parm:        dxs_support int array (min = 1, max = 8), description "Support for
             DXS channels (0 = auto, 1 = enable, 2 = disable, 3 = 48k only, 4 =
             no VRA)
</pre>

<p>
Si tiene el parámetro <c>joystick</c>, añadimos <c>joystick=1</c> a la línea
de <c>options</c> en <path>/etc/modules.d/alsa</path>. Por ejemplo:
</p>

<pre caption="Añadiendo el parámetro joystick">
alias snd-card-0 snd-via82xx
options snd-via82xx joystick=1
</pre>

</body>
</section>
<section>
<title>Recursos</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org">The ALSA Project</uri></li>
  <li><uri link="http://www.djcj.org">ALSA Howto's and FAQs</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>

</body>
</section>
</chapter>
</guide>
