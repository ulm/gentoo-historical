<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/alsa-guide.xml,v 1.19 2007/02/22 12:38:09 chiguire Exp $ -->

<guide link="/doc/es/alsa-guide.xml" lang="es">
<title>Guía ALSA para Gentoo Linux</title>

<author title="Autor">
  <mail link="fox2mike@gentoo.org">Shyam Mani</mail>
</author>
<author title="Autor">
  <mail link="nightmorph@gentoo.org">Joshua Saddler</mail>
</author>
<author title="Contribuyente">
  <mail link="flameeyes@gentoo.org">Diego Pettenò</mail>
</author>
<author title="Traductor">
  <mail link="LinuxBlues@gentoo-es.org">Fernando M. Bueno</mail>
</author>
<author title="Traductor">
  <mail link="anpereir@gentoo.org">Andrés Pereira</mail>
</author>
<author title="Traductor">
  <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>

<abstract>
Esta guía muestra cómo configurar ALSA en Gentoo.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>2.17</version>
<date>2007-02-17</date>

<chapter>
<title>Introducción</title>
<section>
<title>¿Qué es ALSA?</title>
<body>

<p>
ALSA es la <e>Arquitectura Avanzada de Sonido Linux</e>, proporciona
audio y MIDI (<e>Interfaz Digital de Instrumentos Musicales </e>) al
sistema operativo Linux. ALSA es el subsistema de sonido por defecto
en la serie de núcleos 2.6, ha reemplazado a OSS (<e>Sistema de Sonido
Abierto</e>) que fue el subsistema de sonido usado en la serie de
núcleos 2.4.
</p>

<p>
Las principales características de ALSA incluyen un soporte eficiente
de todo tipo de interfaz de audio, desde tarjetas de sonido para el
consumidor hasta equipos de sonido profesionales, controladores
completamente modularizados, SMP y seguridad en los hilos,
compatibilidad con el anterior subsistema de sonido OSS y la librería
en espacio de usuario <c>alsa-lib</c> para hacer más sencillo el
desarrollo de aplicaciones.
</p>
</body>
</section>

<section>
<title>ALSA en Gentoo</title>
<body>

<p>
Una de las principales características de Gentoo consiste en
proporcionar al usuario el máximo control posible sobre cómo se
instala y configura el sistema. ALSA en Gentoo sigue el mismo
principio. Hay dos formas de obtener soporte operativo de ALSA en el
sistema. Las veremos detalladamente en el siguiente capítulo.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Instalando ALSA</title>
<section>
<title>Opciones</title>
<body>

<warn>
Los métodos que se muestran a continuación se excluyen entre sí. No se
puede tener ALSA compilado en el kernel y usar
<c>media-sound/alsa-driver</c>. Esto <e>fallará</e>.
</warn>

<p>
Las dos opciones son:
</p>

<ol>
  <li>Usar ALSA proporcionado por el núcleo. Este es el método
  preferido/recomendado.</li>
  <li>Usar el paquete Gentoo <c>media-sound/alsa-driver</c>.</li>
</ol>

<p>
Los manejadores proporcionados por el núcleo y por el paquete
<c>alsa-driver</c> pueden variar un poco; pueder ser que ciertas
características y arreglos encontrados en uno no se encuentren todavía
en el otro. Los desarrolladores originales están al tanto de esto,
pero ambos manejadores efectivamente son ramas separadas el proyecto
ALSA: no son completamente iguales. Debería estar al tanto que podrían
funcionar de manera ligeramente diferente, así que, si uno no
funciona, entonces pruebe el otro. Examinaremos ambos antes de decidir
cuál usaremos.
</p>

<p>
Si se va a usar ALSA proporcionado por el núcleo, los pros y los contras son:
</p>

<table>
<tr>
  <th>ALSA en el núcleo</th>
  <th>Pros y contras</th>
</tr>
<tr>
  <th>+</th>
  <ti>
  No hace falta instalar nada, los controladores están integrados en el núcleo.
  </ti>
</tr>
<tr>
  <th>+</th>
  <ti>Asunto solucionado de una sola vez, no hay que repetir emerges.</ti>
</tr>
<tr>
  <th>-</th>
  <ti>
  Puede ser una versión un poco diferente que la de <c>alsa-driver</c>.
  </ti>
</tr>
</table>

<p>
Y, si se va a usar alsa-driver,
</p>

<table>
<tr>
  <th>alsa-driver</th>
  <th>Pros y contras</th>
</tr>
<tr>
  <th>+</th>
  <ti>Tal vez la versión más recientes de los controladores del proyecto ALSA.</ti>
</tr>
<tr>
  <th>+</th>
  <ti>Útil si tiene intención de desarrollar controladores de audio.</ti>
</tr><tr>
  <th>-</th>
  <ti>
  Cada recompilación del núcleo requiere un re-emerge de <c>alsa-driver</c>.
  </ti>
</tr>
<tr>
  <th>-</th>
  <ti>
  Necesita opciones deshabilitadas en el núcleo para funcionar correctamente.
  </ti>
</tr>
</table>
</body>
</section>

<section>
<title>Así que ...</title>
<body>

<p>
Las diferencias entre el manejador <c>alsa-driver</c> y la versión del
núcleo son bastante sutiles. Como no hay diferencias enormes, esta
guía transitará el proceso de como usar la versión del núcleo
<e>primero</e> ya que son más sencillos de usar. Sin embargo, si
llegara a tener problemas, intente cambiar a <c>alsa-driver</c>. Antes
de reportar problemas relacionados con sonido al <uri
link="https://bugs.gentoo.org">Bugzilla de Gentoo</uri>, por favor
trate de reproducirlos usando <c>alsa-driver</c> y luego reporte el
fallo, sin importar el resultado.
</p>
</body>
</section>

<section id="lspci">
<title>Antes de proceder</title>
<body>

<p>
Cualquiera que sea el método elegido para instalar, se necesita saber
los controladores que usa la tarjeta de sonido. En la mayoría de los
casos, las tarjetas de sonido (integradas o no) son de tipo PCI y
<c>lspci</c> nos ayudará a obtener toda la información necesaria. Si aún
no se tiene instalado, hay que hacer un <c>emerge sys-apps/pciutils</c> para
obtener <c>lspci</c>. En caso de que se tenga una tarjeta de sonido USB,
<c>lsusb</c> que viene en el paquete <c>sys-apps/usbutils</c> <e>puede</e>
que sea de ayuda. Para las tarjetas ISA, hay que usar
<c>sys-apps/isapnptools</c>. Las siguientes páginas <e>puede</e> que sirvan
de ayuda a los usuarios con tarjetas de sonido ISA:
</p>

<ul>
  <li>
  <uri link="http://www.roestock.demon.co.uk/isapnptools/">La página de ISAPNPTOOLS</uri>
  </li>
  <li>
  <uri link="http://www2.linuxjournal.com/article/3269">Artículo de PnP en LinuxJournal</uri>
  </li>
  <li>
  <uri link="http://www.tldp.org/HOWTO/Sound-HOWTO/x320.html">COMO de Sonido de TLDP</uri>
  </li>
</ul>

<note>
Para facilitar el uso/explicación, asumiremos en esta guía que el usuario
posee una tarjeta de sonido PCI.
</note>

<p>
Ahora, vamos a averiguar los detalles de la tarjeta de sonido.
</p>

<pre caption="Detalles de la tarjeta de Sonido">
# <i>lspci -v | grep -i audio</i>
0000:00:0a.0 Multimedia audio controller: Creative Labs SB Live! EMU10k1 (rev 06)
</pre>

<p>
Ahora sabemos que la tarjeta de sonido es una Sound Blaster Live! y
que el fabricante de la tarjeta es Creative Labs. Buscamos en la <uri
link="http://www.alsa-project.org/alsa-doc/">Matriz de tarjetas
ALSA</uri> y elegimos Creative Labs en el menú. Después en la matriz
de tarjetas de Creative Labs podemos ver que la SB Live! usa el módulo
<c>emu10k1</c>. Esta es toda la información que necesitamos por
ahora. Si se está interesado en obtener información detallada,
pulsamos en el enlace "Details" y nos llevará a la página específica
de <c>emu10k1</c>.
</p>

<p>
Si tiene intenciones de usar MIDI, entonces agregue el parámetro USE <c>midi</c> al archivo <path>/etc/make.conf</path> antes de hacer emerge a los paquetes ALSA. Más adelante en esta guía mostraremos como configurar el <uri link="#midi">soporte para MIDI</uri>.
</p>

<pre caption="Soporte para MIDI en /etc/make.conf">
<comment>(Si desea MIDI)</comment>
USE="midi"

<comment>(Si no requiere soporte MIDI)</comment>
USE="-midi"
</pre>
</body>
</section>

<section id="kernel">
<title>Usando ALSA proporcionado por el núcleo</title>
<body>

<p>
Si se es una persona a la que le gusta mantener las cosas sencillas,
como a mí, esta es la forma de proceder.
</p>

<note>
Desde la edición 2005.0, Gentoo Linux usa la versión 2.6 del núcleo
por defecto. A menos que se esté usando el perfil 2.4,
<c>gentoo-sources</c> será un núcleo 2.6 en la <e>mayoría</e> de
arquitecturas. Por favor, comprueba que tu núcleo es de la serie
2.6. Este método <e>no</e> funcionará con un núcleo 2.4.
</note>

<p>
Vamos a configurar el núcleo para habilitar ALSA.
</p>

<impo>
Los usuarios de <c>genkernel</c> deberían ejecutar ahora <c>genkernel
--menuconfig all</c> y luego seguir las instrucciones de <uri
link="#doc_chap2_pre3">Opciones del núcleo para ALSA</uri>.
</impo>

<pre caption="Código fuente del núcleo">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<note>
El anterior ejemplo asume que el enlace simbólico
<path>/usr/src/linux</path> apunta al código fuente del núcleo que se
quiere usar. Hay que asegurarse de ello antes de proceder.
</note>

<p>
Ahora vamos a ver algunas de las opciones que hay que habilitar en el
núcleo 2.6 para proporcionar soporte ALSA para nuestra tarjeta de
sonido.
</p>

<p>
Por favor nótese que para una mayor facilidad, todos los ejemplos
muestra el soporte ALSA construido de manera modular. Es aconsejable
hacer lo mismo, pues permitirá usar <c>alsaconf</c>, que permitirá
facilidades a la hora de configurar la tarjeta de sonido. Por favor,
asegúrese de <e>no</e> evitar la sección <uri
link="#alsa-config">Configuración</uri> en esta guía. Aún así, si se
prefiere tenerlo integrado en el núcleo, hay que asegurarse de cambiar
las opciones adecuadamente.
</p>

<pre caption="Opciones del núcleo para ALSA">
Device Drivers  ---&gt;
   Sound  ---&gt;

<comment>(Ésto necesita estar habilitado)</comment>
&lt;M&gt; Sound card support

<comment>(Hay que asegurarse de que OSS no está habilitado)</comment>
Open Sound System   ---&gt;
   &lt; &gt; Open Sound System (DEPRECATED)

<comment>(Damos un paso atrás y volvemos a ALSA)</comment>
Advanced Linux Sound Architecture  ---&gt;
   &lt;M&gt; Advanced Linux Sound Architecture
   <comment>(Hay que seleccionar esto si se quiere un secuenciador MIDI)</comment>
   &lt;M&gt; Sequencer support
   <comment>(Soporte al viejo estilo de /dev/mixer* y /dev/dsp*. Recomendado.)</comment>
   &lt;M&gt; OSS Mixer API
   &lt;M&gt; OSS PCM (digital audio) API

<comment>
(Ahora se tiene una lista de dispositivos para los que habilitar el
soporte. Normalmente se tiene sólo un dispositivo de sonido. Si se
tiene más de una tarjeta de sonido, hay que habilitarlas todas).
</comment>

<comment>
(Principalmente para pruebas y desarrollo, no es necesario para
usuarios normales, a menos que se sepa lo que se está haciendo).
</comment>

Generic devices  ---&gt;
<comment>(Para tarjetas de sonido ISA)</comment>
ISA devices   ---&gt;
<comment>(Si se tiene una Gravis, debería seleccionarse esta opción)</comment>
   &lt;M&gt; Gravis UltraSound Extreme

<comment>(Damos un paso atrás y vamos los dispositivos PCI. La mayoría de tarjetas de sonido
son dispositivos PCI)</comment>
PCI devices   ---&gt;
   <comment>(Ahora seleccionamos el controlador emu10k1 para nuestra tarjeta)</comment>
   &lt;M&gt; Emu10k1 (SB Live!, Audigy, E-mu APS)
   <comment>(Con una tarjeta Intel sería)</comment>
   &lt;M&gt; Intel/SiS/nVidia/AMD/ALi AC97 Controller
   <comment>(O si se tiene una VIA)</comment>
   &lt;M&gt; VIA 82C686A/B, 8233/8235 AC97 Controller

<comment>(Damos otro paso atrás, en caso de tener una tarjeta de sonido USB)</comment>
USB Devices   ---&gt;
</pre>

<p>
Ahora que se han habilitado las opciones necesarias, se puede
(re)compilar el núcleo y el soporte ALSA para la tarjeta debería
funcionar en cuanto se reinicie con el nuevo núcleo. No se debe
olvidar de actualizar su configuración de GRUB para utilizar
el núcleo que acaba de compilar. Ahora se puede seguir con las
<uri link="#alsa-utilities">Utilidades ALSA</uri> para ver si
todo está funcionando como debería.
</p>
</body>
</section>

<section id="alsa-driver">
<title>Utilizando el paquete del controlador ALSA</title>
<body>

<p>
Si se ha decidido seguir el camino <c>alsa-driver</c>. Vamos a empezar.
Hay algunas cosas que hacer para asegurarse de que sólo los controladores
para la tarjeta de sonido que se tiene se compilan. Aunque no es
realmente necesario, evita compilar muchos controladores innecesarios.
</p>

<p>
Si no se tiene idea de los controladores que la tarjeta de sonido
puede necesitar hay que consultar la sección <uri
link="#lspci">lspci</uri> de esta guía. Una vez se tenga el nombre del
controlador (<c>emu10k1</c> en nuestro ejemplo), editamos
<path>/etc/make.conf</path> y añadimos la variable <c>ALSA_CARDS</c>.
</p>

<pre caption="Añadir ALSA_CARDS a make.conf">
<comment>(Para una tarjeta de sonido)</comment>
ALSA_CARDS="emu10k1"
<comment>(Para más de una, se separan los nombres con espacios)</comment>
ALSA_CARDS="emu10k1 via82xx"
</pre>

<p>
Si se ha compilado el kernel y se quiere usar <c>alsa-driver</c>, hay
que asegurarse de lo siguiente antes de proceder, de lo contrario
<c>alsa-driver</c> fallará. La siguiente lista muestra una forma de
hacer todas las comprobaciones.
</p>

<note>
Los usuarios de <c>genkernel</c> pueden proceder a la sección
<uri link="#doc_chap2_pre6">Instalando alsa-driver</uri> ya que su
configuración está sincronizada por defecto con aquella que se muestra
más abajo.
</note>

<ol>
  <li>
    <c>CONFIG_SOUND</c> está puesto. (Soporte del sistema básico de sonido
    habilitado)
  </li>
  <li>
    <c>CONFIG_SOUND_PRIME</c> no está puesto. (Soporte integrado de OSS
    deshabilitado)
  </li>
  <li>
  <c>CONFIG_SND</c> no está puesto. (Soporte integrado de ALSA deshabilitado)
  </li>
  <li>
    <path>/usr/src/linux</path> apunta al núcleo al que se le quiere poner
    soporte ALSA.
  </li>
</ol>

<pre caption="Comprobación de .config">
<comment>(Asumiendo que el enlace simbólico linux apunta al núcleo correcto)</comment>
# <i>cd /usr/src/linux</i>
# <i>grep SOUND .config</i>
<comment>(1. es cierto)</comment>
CONFIG_SOUND=y
<comment>(2. es cierto)</comment>
CONFIG_SOUND_PRIME is not set
# <i>grep SND .config</i>
<comment>(y 3. es cierto)</comment>
CONFIG_SND is not set
</pre>

<p>
Ahora todo lo que se ha de hacer es teclear la palabra mágica ... y
no, no es abracadabra.
</p>

<pre caption="Instalar alsa-driver">
# <i>emerge alsa-driver</i>
</pre>

<impo>
Hay que recordar que tendrá que ejecutar <c>emerge alsa-driver</c>
después de cada (re)compilación del núcleo, dado que los controladores
anteriores se eliminan. Para facilitar esta tarea, tal vez quiera
instalar el paquete <c>module-rebuild</c>, que mantendrá una lista de
los paquetes de módulos y puede reconstruirlos. Primero ejecute
<c>module-rebuild populate</c> para crear la lista y luego de cada
(re)compilación del núcleo, ejecute <c>module-rebuild rebuild</c> para
reconstruir los módulos externos.
</impo>
</body>
</section>
</chapter>

<chapter>
<title>Configurando/Comprobando ALSA</title>
<section id="alsa-utilities">
<title>Utilidades ALSA</title>
<body>

<p>
<c>alsa-utils</c> forma parte integrante de ALSA dado que tiene muchos
programas que son muy útiles, incluyendo las macros de inicio de
ALSA. Por tanto recomendamos encarecidamente que se instalen las
<c>alsa-utils</c>.
</p>

<pre caption="Instalar las alsa-utils">
# <i>emerge alsa-utils</i>
</pre>

<note>
Si se ha activado ALSA en el <uri link="#kernel">núcleo</uri> <e>y</e>
no se ha compilado ALSA como módulos, hay que seguir con la sección
<uri link="#initscript">Macro de inicio ALSA</uri>. Todo lo que queda
por hacer para configurar ALSA es muy sencillo, dada la utilidad
<c>alsaconf</c> proporcionada por las <c>alsa-utils</c>.
</note>
</body>
</section>

<section id="alsa-config">
<title>Configuración</title>
<body>

<p>
Versiones recientes de <c>udev</c> (<c>>=udev-103</c>) proporcionan
una cierta autoconfiguración a nivel del núcleo para la tarjeta de
sonido. Si es posible, trate de permitir que el núcleo configure
automáticamente la tarjeta de sonido. Si no, use <c>alsaconf</c> para
hacerlo, tal como se muestra a continuación.
</p>

<note>
Por favor cierre cualquier programa que <e>podría</e> tener acceso a
la tarjeta de sonido mientras ejecutemos <c>alsaconf</c>.
</note>

<p>
Otra manera de configurar la tarjeta de sonido es ejecutar
<c>alsaconf</c> desde una terminal como usuario root.
</p>

<pre caption="Ejecutar alsaconf">
# <i>alsaconf</i>
</pre>

<p>
Ahora se verá una interfaz de menús que probará automáticamente los
dispositivos e intentará buscar la tarjeta de sonido. Solicitará que
se seleccione la tarjeta de sonido desde una lista. Una vez se haya
hecho, pedirá permiso para modificar con los cambios necesarios
<path>/etc/modules.d/alsa</path>. Ajustará los niveles de sonido a
niveles óptimos, ejecutará <c>modules-update</c> e iniciará el
servicio <path>/etc/init.d/alsasound</path>. Una vez <c>alsaconf</c>
haya concluído, se podrá configurar la macro de inicio de ALSA.
</p>
</body>
</section>

<section id="initscript">
<title>Macro de inicio ALSA</title>
<body>

<p>
Ya tenemos todo configurado. Cualquiera que sea el método elegido para
instalar ALSA, se necesita que algo cargue los módulos o inicie ALSA y
restaure los niveles de volumen cuando se inicia el sistema. La macro
de inicio de ALSA maneja todo esto y se llama <c>alsasound</c>. Hay
que añadirla al nivel de ejecución "boot".
</p>

<pre caption="Añadir ALSA al nivel de ejecución boot">
# <i>rc-update add alsasound boot</i>
 * alsasound added to runlevel boot
 * rc-update complete.
</pre>

<p>
Hay que comprobar el archivo <path>/etc/conf.d/alsasound</path> para
asegurarse de que la variable SAVE_ON_STOP está como yes. Con ello, se
guardan los ajustes de volumen cuando se apaga el sistema.
</p>
</body>
</section>

<section>
<title>El grupo audio</title>
<body>

<p>
Antes de realizar pruebas, hay que hacer una <e>importante</e> última
cosa que necesita ser configurada. La regla de oro en un SO *nix: No
use la cuenta root a menos que sea necesario. Esto es válido aquí
también ;) ¿Cómo? Bueno, la mayor parte de las veces debería estar en
el sistema como un usuario normal y le gustaría escuchar música o
acceder a su tarjeta de sonido. Para que esto suceda, necesita estar
en el grupo "audio". En este punto, agregaremos usuarios al grupo
audio para que así no tengan problemas cuando quieran acceder a los
dispositivos de sonido. Aquí usaremos <c>gpasswd</c> y necesita estar
como superusario para que esto funcione.
</p>

<pre caption="Agregar usuarios al grupo audio">
<comment>(Subsituya el &lt;nombre de usuario&gt; con su nombre)</comment>
# <i>gpasswd -a &lt;nombre de usuario&gt; audio </i>
Adding user &lt;nombre de usuario&gt; to group audio
</pre>
</body>
</section>

<section>
<title>Comprobación del volumen</title>
<body>

<p>
Hemos completado todas las configuraciones y pre-requisitos, vamos a
lanzar ALSA. Si se ejecutó <c>alsaconf</c>, se puede evitar este paso,
dado que <c>alsaconf</c> hizo todo esto por nosotros.
</p>

<pre caption="Iniciar el servicio">
# <i>/etc/init.d/alsasound start</i>
</pre>

<p>
Ahora que todo se ha configurado, necesitamos comprobar el volumen
dado que, en algunos casos, se encuentra silenciado. Usaremos
<c>alsamixer</c> para este propósito.
</p>

<pre caption="Iniciar alsamixer">
<comment>(Se abre en una consola. Sólo se muestran los ajustes requeridos)</comment>
# <i>alsamixer</i>
</pre>

<impo>
Si experimenta problemas al iniciar <c>alsamixer</c> y obtiene errores como:
alsamixer: function snd_ctl_open failed for default: No such file or directory,
esto normalmente es un problema con udev al configurar los dispositivos.
Se ejecuta <c>killall udevd; udevstart</c> para recargar las  entradas en
<path>/dev</path> y a continuación se inicia <c>alsamixer</c>. Con ello se
debería haber resuelto el problema.
</impo>

<p>
Así es como el Mezclador ALSA <e>debería</e> aparecer la primera vez
que se ejecuta. Hay que prestar atención a los canales Master y PCM,
los cuales tienen una MM debajo. Esto significa que están
silenciados. Si se intenta reproducir algo con el <c>alsamixer</c> en
este estado, no podrá escucharse nada por los altavoces.
</p>

<figure link="/images/docs/alsa-mixermuted.png" short="AlsaMixer silenciado" caption="Ventana principal del mezclador Alsa, silenciado"/>

<p>
Ahora debemos quitar el silenciado de los canales, y ajustar los
volúmenes adecuadamente.
</p>

<warn>
Ambos Master <e>y</e> PCM necesitan eliminar el silenciado y ajustarse
a volúmenes audibles si se quiere obtener algún sonido por los
altavoces.
</warn>

<ul>
  <li>
  Para moverse entre canales, se usan los cursores izquierdo y derecho. (&lt;-
  &amp; -&gt;)
  </li>
  <li>
  Para quitar el silenciado, nos movemos a un canal, por ejemplo Master y
  pulsamos la tecla <e>m</e>.
  </li>
  <li>
  Para incrementar y decrementar los niveles de volumen, se usan los cursores
  arriba y abajo, respectivamente
  </li>
</ul>

<note>
Hay que tener cuidado cuando se ajusten los valores de graves (Bass) y
agudos (Treble). 50 es normalmente un buen valor para ambos. Valores
demasiado altos de graves pueden causar <e>distorsión</e> en altavoces
no diseñados para ello.
</note>

<p>
Después de hacer todo esto, el mezclador ALSA debería mostrarse como
el siguiente. Hay que fijarse en los 00 en lugar de los MM y en los
niveles de volumen para tener los ajustes óptimos.
</p>

<figure link="/images/docs/alsa-mixerunmuted.png" short="AlsaMixer no silenciado" caption="Mezclador Alsa listo para reproducir"/>
</body>
</section>

<section>
<title>¡Comprobación de sonido!</title>
<body>

<p>
Finalmente. Algo de música. Si todo lo anterior está perfecto, se
debería poder escuchar buena música ahora. Una forma rápida de
comprobarlo es usar una utilidad de línea de comandos como
<c>media-sound/madplay</c>. Puede usarse también algo más conocido
como <c>mpg123</c>. Si se es un fan de ogg, se puede usar
<c>ogg123</c> proporcionado por <c>media-sound/vorbis-tools</c>.  Se
puede usar cualquier reproductor con el que uno esté cómodo.  Como
siempre, se <c>emerge</c> lo que se necesite.
</p>

<pre caption="Obtener los programas">
<comment>(Instalar la aplicación deseada)</comment>
# <i>emerge madplay mpg123</i>
<comment>(Para reproducir archivos .ogg)</comment>
# <i>emerge vorbis-tools</i>
</pre>

<p>
Y después a escuchar nuestra banda sonora preferida ...
</p>

<pre caption="Reproducir música">
# <i>madplay -v /mnt/shyam/Music/Paul\ Oakenfold\ -\ Dread\ Rock.mp3</i>
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Dread Rock
         Artist: Paul Oakenfold
          Album: Matrix Reloaded
           Year: 2003
          Genre: Soundtrack
                 Soundtrack
 00:04:19 Layer III, 160 kbps, 44100 Hz, joint stereo (MS), no CRC

# <i>ogg123 Paul\ Oakenfold\ -\ Dread\ Rock.ogg</i>
Audio Device:   Advanced Linux Sound Architecture (ALSA) output

Playing: Paul Oakenfold - Dread Rock.ogg
Ogg Vorbis stream: 2 channel, 44100 Hz
Genre: Soundtrack
Transcoded: mp3;160
Title: Dread Rock
Artist: Paul Oakenfold
Date: 2003
Album: Matrix Reloaded
Time: 00:11.31 [04:28.75] of 04:40.06  (200.6 kbps)  Output Buffer  96.9%
</pre>
</body>
</section>

<section>
<title>ALSA y USE</title>
<body>

<p>
Ahora se puede agregar el parámetro USE <c>alsa</c> al archivo
<path>/etc/make.conf</path> para asegurarnos de que las aplicaciones
que lo requieran sean compiladas con soporte a ALSA. Algunas
arquitecturas como x86 y amd64 tienen el parámetro activado por
defecto.
</p>
</body>
</section>

<section>
<title>¿Problemas?</title>
<body>

<p>
Si por algún motivo no puede escuchar sonido, lo primero que se ha de
hacer es comprobar los ajustes del <uri
link="#doc_chap3_pre6">alsamixer</uri>. El 80% de los problemas
consiste en canales silenciados o bajo volumen. También puede
comprobarse con la aplicación de sonido del gestor de ventanas para
verificar que todos los volúmenes están configurados a un nivel
audible.
</p>

<p>
<path>/proc</path> es nuestro amigo. Y en este caso,
<path>/proc/asound</path> es nuestro mejor amigo. Vamos a ver toda la
información que puede proporcionarnos.
</p>

<pre caption="Información en /proc/asound">
<comment>(Primero, si /proc/asound/cards muestra nuestra tarjeta, ALSA está
usando nuestra tarjeta de sonido correctamente.)</comment>
# <i>cat /proc/asound/cards</i>
0 [Live           ]: EMU10K1 - Sound Blaster Live!
                     Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

<comment>(Si se tiene ALSA integrada en el núcleo, tal y como yo hago y
uno se pregunta cuál es la versión de alsa que se usa a diferencia de
alsa-driver, ésto mostrará la versión de ALSA que se ejecuta)</comment>
# <i>cat /proc/asound/version</i>
Advanced Linux Sound Architecture Driver Version 1.0.8 (Thu Jan 13 09:39:32 2005 UTC).

<comment>(detalles de emulación OSS ALSA)</comment>
# <i>cat /proc/asound/oss/sndstat</i>
Sound Driver:3.8.1a-980706 (ALSA v1.0.8 emulation code)
Kernel: Linux airwolf.zion 2.6.11ac1 #2 Wed May 4 00:35:08 IST 2005 i686
Config options: 0

Installed drivers:
Type 10: ALSA emulation

Card config:
Sound Blaster Live! (rev.6, serial:0x80271102) at 0xb800, irq 11

Audio devices:
0: EMU10K1 (DUPLEX)

Synth devices: NOT ENABLED IN CONFIG

Midi devices:
0: EMU10K1 MPU-401 (UART)

Timers:
7: system timer

Mixers:
0: SigmaTel STAC9721/23
</pre>

<p>
El otro problema común al que los usuarios pueden enfrentarse es el temible
error "Unknown symbol in module". Se muestra un ejemplo del mismo a
continuación.
</p>

<pre caption="Error: Unknown symbol in module">
# <i>/etc/init.d/alsasound start</i>
 * Loading ALSA modules ...
 *   Loading: snd-card-0 ...                                              [ ok ]
 *   Loading: snd-pcm-oss ...
WARNING: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg) FATAL: Error inserting
snd_pcm_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-pcm-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-mixer-oss ...
FATAL: Error inserting snd_mixer_oss
(/lib/modules/2.6.12-gentoo-r6/kernel/sound/core/oss/snd-mixer-oss.ko): Unknown
symbol in module, or unknown parameter (see dmesg)
                                                                          [ !! ]
 *   Loading: snd-seq ...                                                 [ ok ]
 *   Loading: snd-emu10k1-synth ...                                       [ ok ]
 *   Loading: snd-seq-midi ...                                            [ ok ]
 * Restoring Mixer Levels ...                                             [ ok ]
</pre>

<p>
Y cuando se consulta <c>dmesg</c> tal y como se nos ha sugerido, veremos algo
así:
</p>

<pre caption="mensaje dmesg">
<comment>(Sólo se muestran las partes relevantes)</comment>
# <i>dmesg | less</i>
ACPI: PCI Interrupt 0000:02:06.0[A] -> Link [APC3] -> GSI 18 (level, low) -> IRQ 209
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
snd_pcm_oss: Unknown symbol snd_unregister_oss_device
snd_pcm_oss: Unknown symbol snd_register_oss_device
snd_pcm_oss: Unknown symbol snd_mixer_oss_ioctl_card
snd_pcm_oss: Unknown symbol snd_oss_info_register
snd_mixer_oss: Unknown symbol snd_unregister_oss_device
snd_mixer_oss: Unknown symbol snd_register_oss_device
snd_mixer_oss: Unknown symbol snd_mixer_oss_notify_callback
snd_mixer_oss: Unknown symbol snd_oss_info_register
</pre>

<p>
El problema anterior está causado porque se cambia de <c>alsa-driver</c> a ALSA
incluído en el núcleo, dado que cuando se desinstala <c>alsa-driver</c>, los
archivos de configuración de los módulos están protegidos y, por tanto, quedan
tal cual estaban. Así pues, cuando se cambia a los controladores del núcleo,
ejecutar <c>modprobe</c> nos dará una mezcla de módulos de <c>alsa-driver</c>
y los incorporados en el núcleo, causando los errores anteriores.
</p>

<p>
La solución es muy sencilla. Únicamente debemos eliminar el directorio que está
causando el problema después de desinstalar <c>alsa-driver</c>. ¡Hay que
asegurarse de eliminar la versión del núcleo correcta y no la actual!
</p>

<pre caption="Eliminar los módulos alsa-driver">
# <i>rm -rf /lib/modules/$(uname -r)/alsa-driver</i>
</pre>

<p>
Otra razón por la que aparecen mensajes de error similares a los ya
mencionados anteriormente podría ser por un fichero en
<path>/etc/modules.d</path> que proporciona el parámetro <c>device_mode</c>
cuando este no se necesita. Confirme que este es realmente el problema y
averigüe qué fichero es el culpable.
</p>

<pre caption="Confirmar y buscar la cadena device_mode">
<comment>(Revise dmesg para confirmar)</comment>
# <i>dmesg | grep device_mode</i>
snd: Unknown parameter `device_mode'
<comment>(Ahora, vaya al origen del problema)</comment>
# <i>grep device_mode /etc/modules.d/*</i>
</pre>

<p>
Normalmente se trata de un fichero llamado <path>alsa</path> que contiene la
línea <c>options snd device_mode=0666</c>. Borre esta línea y reinicie el
servicio alsasound, esto debería encargarse del problema.
</p>
</body>
</section>
</chapter>

<chapter>
<title>Otras cosas de ALSA</title>
<section id="midi">
<title>Configurando el soporte MIDI</title>
<body>

<p>
Primero revisemos si hemos activado el parámetro USE <c>midi</c> en el
archivo <path>/etc/make.conf</path>.
</p>

<pre caption="Soporte MIDI en /etc/make.conf">
USE="midi"
</pre>

<p>
Si anteriormente no activó el parámetro USE <c>midi</c>, hágalo ahora
en el archivo <path>/etc/make.conf</path>. Debe también re-instalar
cualquier paquete ALSA que haga uso del parámetro <c>midi</c>, tal
como <c>alsa-lib</c>, <c>alsa-utils</c> y <c>alsa-driver</c>.
</p>

<p>
Si la tarjeta de sonido es una de las que proporcionan un sintetizador
MIDI y se quiere escuchar algunos archivos .mid, se debe instalar
<c>awesfx</c> que es básicamente un conjunto de utilidades para el
controlador AWE32. Si no se dispone de un sintentizador hardware,
siempre se puede usar uno virtual. En la sección <uri
link="#vsynth">Sintetizador virtual</uri> se proporciona toda la
información necesaria para ello.
</p>

<pre caption="Instalar awesfx">
# <i>emerge awesfx</i>
</pre>

<note>
Se necesitará copiar el catálogo de instrumentos midi, o fuente de
sonido (SF2), desde el CD de controladores de la tarjeta o desde una
instalación de Windows en <path>/usr/share/sounds/sf2/</path>. Por
ejemplo, el archivo de la fuente de sonido para la SBLive! de Creative
sería 8MBGMSFX.SF2.
</note>

<p>
Después de copiar el archivo o los archivos de fuentes de sonido se
podrán reproducir archivos midi como se muestra. Se puede añadir el
comando <c>asfxload</c> a <path>/etc/conf.d/local.start</path>, para
que se cargue la fuente de sonido cada vez que se inicia el sistema.
</p>

<note>
Las rutas <path>/mnt</path> mencionadas pueden <e>no</e> ser las
mismas en otros sistemas. Sólo son un ejemplo. Será necesario
modificarlas y adapatarlas a cada caso.
</note>

<pre caption="Cargar las fuentes de sonido">
<comment>(Primero, se copia la fuente de sonido)</comment>
# <i>cp /mnt/win2k/Program\ Files/CreativeSBLive2k/SFBank/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(O consígala de su CD de SoundBlaster)</comment>
# <i>cp /mnt/cdrom/AUDIO/ENGLISH/SFBANK/8MBGMSFX.SF2 /usr/share/sounds/sf2/</i>
<comment>(Después la cargamos)</comment>
# <i>asfxload /usr/share/sounds/sf2/8MBGMSFX.SF2</i>
</pre>

<p>
Ahora se pueden reproducir archivos midi usando un programa como
<c>aplaymidi</c>. Se debe ejecutar <c>aplaymidi -l</c> para obtener
una lista de los puertos disponibles y elegir uno de ellos para
reproducir el archivo.
</p>

<pre caption="Reproducir MIDI">
<comment>(Se comprueban los puertos)</comment>
# <i>aplaymidi -l</i>
 Port    Client name                      Port name
 64:0    EMU10K1 MPU-401 (UART)           EMU10K1 MPU-401 (UART)
 65:0    Emu10k1 WaveTable                Emu10k1 Port 0
 65:1    Emu10k1 WaveTable                Emu10k1 Port 1
 65:2    Emu10k1 WaveTable                Emu10k1 Port 2
 65:3    Emu10k1 WaveTable                Emu10k1 Port 3
<comment>(Se selecciona un puerto y se reproduce un archivo mid)</comment>
# <i> aplaymidi --port=65:0 /mnt/shyam/music/midi/mi2.mid</i>
</pre>
</body>
</section>

<section id="vsynth">
<title>Sintetizadores virtuales</title>
<body>

<p>
Si la tarjeta de sonido no dispone de un sintetizador en hardware, se
puede usar uno virtual como <c>timidity++</c>. Su instalación es muy
sencilla.
</p>

<pre caption="Instalar timidity++">
# <i>emerge timidity++</i>
</pre>

<p>
Para que timidity reproduzca sonidos, necesita una fuente de
sonido. Existen unos pocos paquetes de fuentes de sonido en, como
<c>timidity-freepats</c> y <c>timidity-eawpatches</c>. Se pueden tener
instaladas múltiples configuraciones de fuentes de sonido y puede
colocar sus propias fuentes en <path>/usr/share/timidity/</path>. Para
cambiar entre distintas configuraciones de timidity, utilice
<c>eselect</c>.
</p>

<pre caption="Cambiando de configuración">
# <i>eselect timidity list</i>
# <i>eselect timidity set eawpatches</i>
</pre>

<p>
No hay que olvidar poner <c>timidity</c> en el nivel de ejecución
default.
</p>

<pre caption="Añadir timidity al nivel de ejecución default">
# <i>rc-update add timidity default</i>
# <i>/etc/init.d/timidity start</i>
</pre>

<p>
Ahora podemos ir a la sección <uri link="#doc_chap4_pre3">Reproduciendo MIDI</uri>.
</p>
</body>
</section>

<section>
<title>Herramientas y microcódigo (firmware)</title>
<body>

<p>
Algunas tarjetas de sonido específicas pueden beneficiarse de ciertas
herramientas proporcionadas por los paquetes <c>alsa-tools</c> y
<c>alsa-firmware</c>. Puede instalar cualquiera de los dos paquetes
con <c>emerge</c>.
</p>

<pre caption="Instalación de ALSA Tools">
# <i>emerge alsa-tools</i>
</pre>

<p>
Si no se define la variable ALSA_TOOLS, se compilarán todas las
herramientas disponibles. Ahora se instala <c>alsa-tools</c> (y/o
<c>alsa-firmware</c>):
</p>

<pre caption="Instalar las herramientas ALSA">
# <i>emerge alsa-tools</i>
</pre>
</body>
</section>

<section>
<title>Múltiples tarjetas de sonido</title>
<body>

<p>
Se puede tener más de una tarjeta de sonido en el sistema
simultáneamente, pero solo si ha construido el soporte en el núcleo de
manera modular (o si ha usado el controlador <c>alsa-driver</c>). Solo
hace falta especificar cual debe ser iniciado primero en
<path>/etc/modules.d/alsa</path>. Las tarjetas están identificadas por
los nombres de sus controladores en este archivo. El 0 corresponde a
la primera tarjetas, el 1 al segundo, etc. A continuación, un ejemplo
de un sistema con dos tarjetas de sonido.
</p>

<pre caption="Dos tarjetas de sonido en /etc/modules.d/alsa">
options snd-emu10k1 index=0
options snd-via82xx index=1
</pre>

<p>
O, si tiene dos tarjetas que utilizan el mismo controlador,
especifíquelas en la misma línea separando los números con una coma. A
continuación un ejemplo de us sistema con tres tarjetas de sonido, dos
de las cuales son las mismas tarjetas Intel High Definition Audio.
</p>

<pre caption="Multiple sound cards in /etc/modules.d/alsa">
options snd-ymfpci index=0
options snd-hda-intel index=1,2
</pre>
</body>
</section>

<section>
<title>Plugins</title>
<body>

<p>
Quizás desee instalar algunos plugins para activar características
adicionales. <c>alsa-plugins</c> es una colección de plugins útiles,
que incluye: salida PulseAudio, un convertidor de tasas de muestreo,
jack (un servidor de audio de baja latencia) y un codificador que
permite sacar audio de 6 canales a través de una conexión digital
S/PDIF (optical o coaxial). Puede seleccionar cual plugin instalar
agregando los correspondientes parámetros USE al archivo
<path>/etc/portage/package.use</path>.
</p>

<pre caption="Instalando los alsa-plugins">
# <i>emerge -avt alsa-plugins</i>
</pre>
</body>
</section>

<section>
<title>Quisiéramos dar un gran agradecimiento a ...</title>
<body>

<p>
Todos aquellos que contribuyeron a la versión anterior de la guía
Gentoo ALSA: Vincent Verleye, Grant Goodyear, Arcady Genkin, Jeremy
Huddleston, John P. Davis, Sven Vermeulen, Benny Chuang, Tiemo Kieft y
Erwin.
</p>
</body>
</section>

<section>
<title>Referencias</title>
<body>

<ul>
  <li><uri link="http://www.alsa-project.org/">El proyecto ALSA</uri></li>
  <li><uri link="http://linux-sound.org">Linux Sound/MIDI Software</uri></li>
</ul>
</body>
</section>
</chapter>
</guide>
