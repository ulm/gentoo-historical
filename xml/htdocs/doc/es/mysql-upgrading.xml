<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/mysql-upgrading.xml,v 1.2 2005/10/20 21:35:56 chiguire Exp $ -->

<guide link="/doc/es/mysql-upgrading.xml" lang="es">
<title>Guía de actualización a MySQL 4.1.x</title>

<author title="Autor">
  <mail link="citizen428@gentoo.org">Michael Kohl</mail>
</author>
<author title="Autor">
  <mail link="vivo@gentoo.org">Francesco Riosa</mail>
</author>
<author title="Traductor">
  <mail link="enrique@barbeito.org">Enrique Barbeito García</mail>
</author>
<author title="Editor Es">
<mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
</author>
<author title="Editor Es">
<mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>

<abstract>
El equipo de MySQL se enorgullece de anunciar que MySQL 4.1 ya se encuentra en
el árbol inestable (~arch) de Gentoo. Ya que el equipo espera poder estabilizar
este ebuild dentro de poco, e aquí un modo de actualización para aquellos
dispuestos a probar.
</abstract>

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/2.5 -->
<license/>

<version>1.3</version>
<date>2005-11-18</date>

<chapter>
<title>Actualizar desde versiones antiguas de MySQL</title>
<section>
<body>

<p>
Los usuarios que actualicen desde una versión anterior (&lt;4.0.24) de MySQL
tendrán, primero, que instalar MySQL 4.0.25. Si usted ya está utilizando una
versión reciente, puede saltarse esta sección y continuar con la siguiente.
</p>

<pre caption="Actualización simple">
# <i>emerge -av --buildpkg "&lt;mysql-4.1"</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Hacer una copia de seguridad de sus datos actuales</title>
<section>
<body>

<p>
Una de las tareas más importantes que todo administrador de bases de datos
tiene que llevar a cabo es la de respaldar los datos. Allá vamos:
</p>

<pre caption="Volcado de todas las bases de datos">
# <i>mysqldump \</i>
  <i>-uroot \</i>
  <i>-p$PASSWORD \</i>
  <i>-hlocalhost \</i>
  <i>--all-databases \</i>
  <i>--all \</i>
  <i>--opt \</i>
  <i>--allow-keywords \</i>
  <i>--flush-logs \</i>
  <i>--hex-blob \</i>
  <i>--master-data \</i>
  <i>--max_allowed_packet=16M \</i>
  <i>--quote-names \</i>
  <i>--result-file=BACKUP_MYSQL_4.0.SQL</i>
</pre>

<p>
Ahora debería tener un fichero llamado <path>BACKUP_MYSQL_4.0.SQL</path> que,
más tarde, pueda utilizar para regenerar sus datos. Los datos estarán descritos
en el dialecto MySQL del lenguaje SQL (Structured Query Language).
</p>

<p>
También es ahora un buen momento para comprobar si la copia de seguridad que ha
creado funciona.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Actualizar desde versiones recientes de MySQL</title>
<section>
<body>

<p>
Si se ha saltado el primer paso, ahora tiene que crear un paquete de respaldo
(del servidor de bases de datos, no de los datos) de la actual versión
instalada.
</p>

<pre caption="Paquete de respaldo binario">
# <i>quickpkg dev-db/mysql</i>
</pre>

<p>
Ahora es el momento de eliminar la actual versión y todos sus datos:
</p>

<pre caption="Desinstalar MySQL">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>tar cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
</pre>

<note>
Deberían haber ahora dos copias de seguridad: un fichero SQL, portable entre
varias versiones de MySQL, y otro que le permitirá restaurar rápidamente su
servidor de base de datos. Esto posteriormente se cubrirá con mayor detalle en
este documento.
</note>

<p>
Una vez se haya librado de su antigua instalación de MySQL, puede instalar la
nueva versión. Tenga en cuenta que se necesita <c>revdep-rebuild</c> para
reconstruir las dependencias de MySQL.
</p>

<pre caption="Actualizar los binarios">
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
</pre>

<p>
Ahora configure la reciente versión instalada de MySQL y reinicie el demonio:
</p>

<pre caption="Configurar MySQL 4.1">
# <i>ebuild /var/db/pkg/dev-db/mysql-4.1.&lt;micro_version&gt;/mysql-4.1.&lt;micro_version&gt;.ebuild config</i>
# <i>/etc/init.d/mysql start</i>
</pre>

<p>
Por último, puede importar la copia de seguridad que creó en el paso #2:
</p>

<pre caption="Importar la copia de seguridad de los datos SQL">
# <i>cat BACKUP_MYSQL_4.0.SQL \</i>
     <i>| mysql \</i>
     <i>-uroot \</i>
     <i>-p$PASSWORD \</i>
     <i>-hlocalhost \</i>
     <i>--max_allowed_packet=16M</i>

# <i>mysql_fix_privilege_tables \</i>
     <i>--defaults-file=/etc/mysql/my.cnf \</i>
     <i>--user=root \</i>
     <i>--password=$PASSWORD</i>
</pre>

<p>
Si ahora reinicia su demonio de MySQL y todo va como se espera, ¡tendrá una
completa instalación funcional de la versión 4.1.x! :-)
</p>

<pre caption="Reiniciar el demonio de MySQL">
# <i>/etc/init.d/mysql restart</i>
</pre>

<p>
Si se topa con algún problema durante el proceso de instalación, por favor,
envíenoslo a nuestro <uri link="https://bugs.gentoo.org">Bugzilla</uri>.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Recuperar la antigua instalación de MySQL 4.0</title>
<section>
<body>

<p>
Si no está a gusto con MySQL 4.1, es posible volver a la versión 4.0.
</p>

<pre caption="Volver al pasado">
# <i>/etc/init.d/mysql stop</i>
# <i>emerge -C mysql</i>
# <i>rm -rf /var/lib/mysql/ /var/log/mysql</i>
# <i>emerge --usepkgonly "&lt;mysql-4.1"</i>
# <i>tar -xjpvf mysql.[tag] -C /</i>
# <i>/etc/init.d/mysql start</i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Actualización directa, no soportada, peligrosa</title>
<section>
<body>

<p>
Bajo ciertas condiciones, es posible actualizar directamente a la siguiente
versión más reciente de MySQL. Si sabe lo que está haciendo y piensa que lo
siguiente puede aplicarse a su caso concreto, aquí tiene un pequeño truco que
hace posible actualizar directamente a MySQL 4.1.
</p>

<pre caption="Actualización directa">
# <i>quickpkg dev-db/mysql</i>
# <i>/etc/init.d/mysql stop</i>
# <i>tar -cjpvf ~/mysql.$(date +%F_%H-%M).tar.bz2 /etc/mysql/my.cnf /var/lib/mysql/</i>
# <i>ls -l ~/mysql.*</i>
# <i>export MYSQL_STRAIGHT_UPGRADE=1</i>
# <i>emerge -av "&gt;mysql-4.1"</i>
# <i>unset MYSQL_STRAIGHT_UPGRADE</i>
# <i>dispatch-conf</i>
# <i>revdep-rebuild</i>
# <i>/etc/init.d/mysql start</i>
# <i>mysql_fix_privilege_tables --defaults-file=/etc/mysql/my.cnf \</i>
     <i>-uroot --password=$PASSWORD</i>
# <i>mysql --database=mysql -uroot -p$PASSWORD &lt; /tmp/new_pieces.sql</i>
# <i>/etc/init.d/mysql restart</i> # sólo para estar seguro
</pre>

<p>
Buena suerte y si algo falla, ¡no diga que no le advertimos! ;-)
</p>

</body>
</section>
</chapter>

</guide>
