<?xml version='1.0' encoding="UTF-8"?> 
<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/es/printing-howto.xml,v 1.6 2005/05/26 15:28:29 chiguire Exp $ -->
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/es/printing-howto.xml" lang="es"> 

<title>Guía de Impresión Gentoo</title> 

<author title="Autor"><!-- zhen@gentoo.org -->
  John P. Davis
</author>
<author title="Editor">
  <mail link="wleggette@gate.net">Wesley Leggette</mail>
</author>
<author title="Editor">
  <mail link="carl@gentoo.org">Carl Anderson</mail>
</author>
<author title="Editor">
  <mail link="lanius@gentoo.org">Heinrich Wendel</mail>
</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Copyeditor">
  <mail link="phil@thenexusproject.org">Phil Bordelon</mail>
</author>
<author title="Editor">
  <mail link="bass@gentoo.org">José Alberto Suárez López</mail>
</author>
<author title="Editor Es">
    <mail link="chiguire@gentoo.org">John Christian Stoddart</mail>
 </author>
<author title="Editor Es">
    <mail link="yoswink@gentoo.org">José Luis Rivero</mail>
</author>
<author title="Traductor">
  <mail link="LinuxBlues@gentoo-es.org">Fernando M. Bueno</mail>
</author>

<abstract>
Una guía extensa para imprimir en Gentoo Linux, este documento cubre tanto la impresión local como remota.
</abstract> 

<license/>

<version>1.23</version>
<date>2005-05-23</date>

<chapter> 
<title>Instalando CUPS y foomatic</title> 
<section>
<body> 

<p>
Configurar la impresión bajo Gentoo Linux es relativamente sencillo, gracias
a la ayuda de grandes programas como CUPS (Sistema Común de Impresión Unix) y
foomatic. Ambos programas se encuentran en el árbol Portage y son muy fáciles
de configurar por el usuario final.
</p> 

<p>
Por favor, téngase en cuenta que cups es independiente del escritorio, por lo
que se pueden seguir estos pasos para configurar la impresión bajo GNOME o KDE.
Hay otras opciones, como la configuración de impresión KDE, pero pienso que
CUPS es el más fácil de configurar y el más escalable.
</p>

<p>
Antes de emerger CUPS, es una buena idea añadir los parámetros USE necesarios
en <path>/etc/make.conf</path>.
</p>

<pre caption = "Editando /etc/make.conf">
<comment>Añade cups, foomaticdb, ppds y usb (si se está usando una conexión
USB para la impresora) a la lista de parámetros USE que tengas.</comment>
USE="cups foomaticdb ppds usb otros_parámetros"
</pre>

<p>
Para más información acerca de los parámetros USE, se puede consultar el capítulo <uri
link="http://www.gentoo.org/doc/es/handbook/handbook-x86.xml?part=2&amp;chap=2">Los parámetros USE</uri> del handbook Gentoo.
</p>

<pre caption = "Emergiendo los paquetes necesarios">
# <i>emerge cups</i>
# <i>emerge foomatic </i>
</pre>

</body>
</section>
</chapter>

<chapter>
<title>Configurando los módulos del núcleo</title> 
<section>
<title>General</title>
<body>

<p>
Ahora que se han instalado los paquetes necesarios, es el momento de
instalar la impresora.
</p>

<p>
Dependiendo del tipo de conexión que use la impresora, será necesario
habilitar o bien la impresión a través del puerto paralelo o bien la
impresión a través del puerto USB en el núcleo (kernel).
</p>

<note>
Esto únicamente se necesita para la impresión local, si se quiere imprimir
a través de samba, se puede pasar a la siguiente sección.
</note>

<note>
Si no estás seguro de cómo compilar el núcleo, puedes encontrar
instrucciones específicas en <uri link="http://www.insflug.org/COMOs/Kernel-Como/Kernel-Como.html">Kernel-Como</uri> (no está suficientemente actualizada) o bien en <uri link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">Kernel Howto</uri> (actualmente no disponible, por encontrarse en revisión). Hay que asegurarse de encontrar la sección en la que se explica
cómo compilar e instalar nuevos módulos sin tener que recompilar todo el kernel o reiniciar
el ordenador. Ésto nos ahorrará muchísimo tiempo.
</note>

</body>
</section>
<section>
<title>Módulos USB</title>
<body>

<p>
Para habilitar la impresión USB, se va a <c>USB support</c> y se habilita
<c>Support for USB</c> y <c>USB Printer support</c>. Habilitándolos como
módulos se instalarán en el directorio de módulos usbcore.o y printer.o
Sugiero usar módulos porque así no se necesita reiniciar el ordenador.
Los usuarios de núcleos 2.6 encontrarán estas opciones en <c>Device Drivers</c>.
</p>

<p>
Después de que el kernel se haya compilado, y de haber reiniciado la computadora
en caso de ser necesario, es el momento de cargar los módulos:
</p>

<pre caption = "Cargando los módulos USB">
# <i>modprobe usbcore</i> 

<comment>(Para usuarios del núcleo 2.4:)</comment>
# <i>modprobe printer</i>
<comment>(Para usuarios del núcleo 2.6:)</comment>
# <i>modprobe usblp</i>
</pre> 

<p>
Después de haber cargado los módulos satisfactoriamente, se conecta la
impresora y se consulta <c>dmesg</c> para comprobar si se ha detectado.
</p> 

<pre caption = "Comprobando los mensajes del núcleo">
# <i>dmesg | tail</i>
</pre> 

<p>
Debe aparecer algo como ésto:
</p>

<pre caption = "Mensaje dmesg">
hub.c: USB new device connect on bus2/2, assigned device number 2 
printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104
</pre>

</body>
</section> 
<section>
<title>Módulos del puerto paralelo</title>
<body>

<p>
Para añadir soporte al puerto paralelo, nos dirigimos a <c>Parallel port support</c>
y habilitamos tanto <c>Parallel port support</c> como <c>PC-style hardware</c>.
Dependiendo de la impresora también se puede activar <c>Multi-IO cards (parallel and serial)</c>,
<c>Support for foreign hardware</c> e <c>IEEE 1284 transfer mode</c>. Después
vamos a <c>Character devices</c> y habilitamos <c>Parallel Printer Support</c>.
Los usuarios de núcleos 2.6 encontrarán estas opciones bajo <c>Device Drivers</c>.
</p>

<p>
Después de comppilar el núcleo, nos aseguramos de que la impresora está
conectada y reiniciamos la computadora. Ahora es el momento de cargar los
módulos necesarios:
</p>

<pre caption = "Cargando los módulos del puerto paralelo">
# <i>modprobe lp</i> <comment>(Sólo para usuarios de núcleos 2.6)</comment>
# <i>modprobe parport</i> 
# <i>modprobe parport_pc</i>
</pre> 

<p>
Después de haber cargado los módulos satisfactoriamente, se comprueba
<path>/var/log/messages</path> para ver si la impresora se ha detectado.
</p> 

<note>
Si se está usando algo distinto a sysklogd, la bitácora del núcleo será diferente.
</note>

<pre caption = "Comprobando la bitácora del núcleo">
# <i>tail /var/log/messages</i>
</pre> 

<p>
Debe verse algo como ésto:
</p>

<pre caption = "Mensaje /var/log/messages">
lp0: using parport0 (polling).
</pre>

</body>
</section>
<section>
<title>Comprobación de bajo nivel</title>
<body>

<p>
Antes de configurar la impresora con CUPS, podemos comprobarla con algunos
sencillos comandos de bajo nivel. 
</p>

<note>
Algunas impresoras (especialmente las <uri link="http://pnm2ppa.sourceforge.net">basadas en PPA</uri> como las series 720, 820 y 1000 de HP, no aceptan una fuente ASCII. Si se tiene
una de estas impresoras, ha de recordarse que se tiene una impresora <e>basada en PPA</e>
y que esta prueba no será superada, aunque la impresora funcione correctamente.
</note> 

<note>
Algunas impresoras (por ejemplo, las HP LaserJet) necesitan un ^L (Control-L)
al final del archivo para comenzar a imprimir. Sin el ^L cat funciona, pero
la impresora absorve los datos sin hacer absolutamente nada. 
</note>

<pre caption = "Comprobar la impresora usando cat">
# <i>touch test.txt</i>
# <i>echo "Hola Mundo" > test.txt</i>
# <i>cat test.txt > /dev/usb/lp0 </i>

<comment> De forma alternativa, para impresoras por el puerto paralelo: </comment>
# <i>cat test.txt > /dev/lp0 </i>
</pre>

</body>
</section>
</chapter>			

<chapter>
<title>Controladores especiales para la impresora</title> 
<section>
<body> 

<p>
Antes de usar foomatic para generar un archivo PPD, puede ser necesario
localizar controladores de terceras partes para la impresora. Por ejemplo,
Epson proporciona <uri link="http://www.epkowa.co.jp/english/linux_e/linux.html">algunos  controladores</uri> para sistemas operativos de código
abierto. De cualquier forma, como ocurre con Epson, esos controladores no
son de código abierto.
</p>

<p>
Los siguientes controladores se encuentran disponibles como ebuilds en Portage:
gimp-print, omni, hpijs, pnm2ppa.
</p>

<p>
Para la mayoría de impresoras tipo HP Inkjet, pueden usarse los controladores
estándar de Linux. Se puede visitar <uri link="http://www.linuxprinting.org/printer_list.cgi">soporte de impresoras linuxprinting.org</uri>
para encontrar información acerca del modelo específico de impresora. Hay que
asegurarse de leer toda la documentación proporcionada con cualquier
controlador que se descargue y la información acerca de su licencia.
</p> 

<p>
Si se usa impresora HP Inkjet, es necesario emerger el controlador de
impresión <c>hpijs</c>. Este controlador maneja toda la interpretación
Postscript necesaria para hacer funcionar a una impresora HP. El
controlador <c>hpijs</c> funciona sólo con impresoras HP Inkjet, pero
está disponible en Portage para facilitar las cosas. La documentación
de HP para el controlador puede encontrarse en <path>/usr/share/doc/hpijs-&lt;version&gt;</path>.
El autor recomienda <e>encarecidamente</e> leerla.
</p>

<p>
Si se está usando una impresora basada en PPA, es necesario emerger
el controlador de impresión <c>pnm2ppa</c>.
</p>

<pre caption="Emergiendo hpijs">
# <i>emerge hpijs</i>
</pre>

<note>
Si se está usando una impresora HP Laserjet, puede estar soportada directamente
con el sistema de impresión GNOME. Si se está usando una impresora HP Inkjet,
no se necesita instalar este controlador especial.
</note>

</body>
</section>
</chapter>

<chapter>
<title>Configuración del archivo PPD</title>
<section>
<body>

<p>
Ahora es el momento de configurar la impresora y CUPS. Para que la impresora
interprete Postscript correctamente, CUPS necesita un archivo PPD (Definición
Postscript de Impresora). La forma más sencilla de generar un PPD es a través
de foomatic.
</p>

<note>
Otra forma sería descargar el archivo PPD desde <uri link="http://www.linuxprinting.org">LinuxPrinting.org</uri>
y colocarlo en <path>/usr/share/cups/model</path>. Si se hace así, puede evitarse el
resto de esta sección y continuar con <uri link="#doc_chap5">Configuración de CUPS</uri>.
</note>

<p>
Es necesario saber tres cosas para poder hacer funcionar el siguiente comando;
se necesita la ID de la impresora, el dispositivo de la impresora, y el
controlador de la impresora (este sería hpijs si se necesitó instalar este
controlador especial, como se mencionó antes). Tanto el ID de la impresora
como el controlador se pueden saber con <c>grep</c> desde la base de datos de
foomatic, y el dispositivo de la impresora es el nodo al que se conecta la
impresora (por ejemplo, <path>file:/dev/lp0</path>, <path>file:/dev/usb/lp0</path> o para
impresoras samba <path>smb://user:password@server/share</path>).
</p>

<p>
Antes de usar <c>foomatic-configure</c>, hay que iniciar el servicio <c>cupsd</c>.
</p>

<pre caption = "Iniciando cupsd">
# <i>/etc/init.d/cupsd start</i>
</pre>

<pre caption = "Uso general de foomatic">
<comment>(Rellenar con el modelo de impresora en $printer_model y la ID en $printer_ID)</comment>
<comment>(Usar la salida de los dos primeros grep para rellenar el último comando foomatic-configure)</comment>
# <i>grep $printer_model /usr/share/foomatic/db/source/printer/* </i>
# <i>grep $printer_ID /usr/share/foomatic/db/source/driver/* </i>
# <i>foomatic-configure -s cups -p $printer_model_number -c file:$print_device_path -n queue name -d driver </i>
</pre>

<p>
Si hacer grep para encontrar el controlador no funciona, siempre se puede buscar
la impresora en <uri link="http://www.linuxprinting.org">LinuxPrinting.org</uri> para ver los  controladores con los que pueda funcionar. Entonces se elige uno de esos controladores
y se instala:
</p>

<pre caption="Instalando un controlador PPD">
<comment>(Si se tienen varias impresoras, hay que usar nombres de cola diferentes.
De otra manera, un nombre de cola fácil de recordar, como "default" bastará).</comment>
# <i>foomatic-configure -s cups -p &lt;printer model&gt; -c file:&lt;printer device&gt; -n &lt;queue name&gt; -d &lt;driver&gt;</i>
</pre>

<p>
Ahora, daremos un ejemplo mucho más específico. El siguiente código asume que
se tiene una Epson Stylus Color 980. Por supuesto, puede reemplazarse con el
modelo de impresora que se tenga.
</p>

<pre caption="Uso específico de foomatic con una Stylus Color 980">
# <i>grep "Stylus Color 980" /usr/share/foomatic/db/source/printer/* </i>
<comment> Ahora hay que mirar la línea: </comment>
/usr/share/foomatic/db/source/printer/Epson-Stylus_Color_980.xml:   &lt;model>Stylus Color 980&lt;/model>
<comment> Epson-Stylus_Color_980 es el ID de la impresora. </comment>

# <i>grep Epson-Stylus_Color_980 /usr/share/foomatic/db/source/driver/* </i>
/usr/share/foomatic/db/source/driver/gimp-print-ijs.xml:  &lt;printer>&lt;id>printer/Epson-Stylus_Color_980&lt;/id>&lt;/printer>
<comment> Aquí, el controlador de la impresora es gimp-print-ijs.</comment>

# <i>foomatic-configure -s cups -p Epson-Stylus_Color_980 -c file:/dev/lp0 -n Epson -d gimp-print-ijs </i>
</pre>

</body> 
</section>
</chapter> 

<chapter> 
<title>Configuración de CUPS</title> 
<section>
<body> 

<p>
Cuando la impresora ya esté configurada, lo que debe configurarse ahora es CUPS
para que maneje las colas de impresión. Se puede acceder a CUPS con un navegador
web en el puerto 631 del servidor de impresión.
</p>

<p>
CUPS incorpora un fichero de configuración para el daemon que debe ser modificado
para permitir un nombrado del dispositivo tipo URI. Se abre <path>/etc/cups/cupsd.conf</path>
con un editor de textos y se modifica <c>FileDevice</c> con un <c>Yes</c>:
</p>

<pre caption="Cambiando FileDevice a Yes">
# <i>nano -w /etc/cups/cupsd.conf</i>
<comment>(Se busca #FileDevice No y se cambia a Yes)</comment>
</pre>

<p>
Ahora, si no se quiere que cada anfitrión en la red pueda ver y usar la impresora
(por ejemplo, cuando el sistema está conectado directamente a internet), se busca
la línea que indica <c>Port 631</c> y se reemplaza por <c>Listen 127.0.0.1:631</c>.
</p>

<p>
Para aquellos que necesiten configurar los clientes para que usen el nuevo
servidor de impresión, ha de editarse el archivo <path>/etc/cups/client.conf</path>
en la máquina cliente y modificar el parámetro <c>ServerName</c> para que
apunte al nombre de red del servidor de impresión.
</p>

<pre caption = "Añadiendo CUPS al nivel de ejecución default y reiniciarlo">
# <i>rc-update add cupsd default</i>
# <i>/etc/init.d/cupsd restart</i>
</pre>

<p>
El daemon CUPS debe estar ejecutándose, así pues, abrimos nuestro navegador y le
inidicamos <uri>http://localhost:631</uri> y abrimos <c>Administrar impresoras</c>.
Aquí podremos encontrar nuestra impresora recién instalada, configurarla o
imprimir una página de prueba. Hay que asegurarse de adecuar el tamaño de
página (Page Size) por defecto, al tamaño de página que vaya a usarse (por
ejemplo, A4 en lugar de carta [Letter]).
</p> 

<note>
Si la impresora no funciona por cualquier motivo, vamos al directorio donde
le dijimos a CUPS que almacenase su bitácora, y buscamos <c>error_log</c>.
</note>

</body> 
</section>
</chapter>

<chapter>
<title>Configurando los programas para imprimir mediante CUPS.</title>
<section>
<title>General</title>
<body>

<p>
La mayoría de programas actuales tienen una interfaz nativa cups, por lo que
no se necesitará modificar nada, únicamente se ha de tratar de imprimir desde
el programa.
</p>

</body>
</section>
<section>
<title>El GIMP</title>
<body>

<p>
Para poder imprimir documentos usando El Gimp, se debe (re)instalar el paquete
<c>gimp</c> con el parámetro USE "gimpprint" habilitado. Con ello se instalará
<c>gimp-print</c>, de no haberse instalado ya.
</p>

<pre caption="Emergiendo gimp con capacidad para imprimir">
<comment>(Asegurarse de tener el USE="gimpprint" habilitado)</comment>
# <i>emerge gimp</i>
</pre>

<p>
Ahora, abrimos con El GIMP cualquier imagen que tengamos, o sólo una imagen en
blanco, realmente no importa, porque lo único que estamos buscando se encuentra
en el menú <c>Archivo</c>. Click derecho sobre la imagen y vamos a
<c>Archivo/Imprimir...</c> El diálogo para imprimir debe aparecer, y cuando lo
haga, haremos click en Nueva Impresora...
Si la impresora todavía no aparece en la lista, tecleamos el nombre de la impresora
y seleccionamos el tipo de impresora. Bien, todo está listo para imprimir con El
GIMP. Hay que jugar con las configuraciones y disfrutar con ello.
</p>

</body>
</section>
</chapter>

<chapter>
<title>Configurar Windows para que use la impresora CUPS</title>
<section>
<title>Instalando el soporte requerido</title>
<body>

<p>
Para que Windows sea capaz de usar CUPS, se necesita instalar el soporte IPP.
Windows 2000 y XP deben incluir soporte IPP por defecto, los usuarios de
Windows 98 y ME deben consultar <uri link="http://support.microsoft.com/default.aspx?scid=kb;es-es;294439">cómo instala y utiliza el cliente de impresión de protocolo Internet (IP)</uri>.
</p>

</body>
</section>
<section>
<title>Instalando la impresora CUPS</title>
<body>

<p>
Se ejecuta el Asistente para <c>agregar impresoras</c> y se elige
<c>Impresora de red</c>. Cuando nos solicite la dirección URL de la impresora,
le proporcionamos la URL tal y como se ha definido anteriormente.
</p>

<pre caption="Ejemplo de dirección URL de la impresora">
<comment>(Este es un ejemplo)</comment>
http://192.168.1.1:631/printers/Epson
</pre>

<p>
¡Eso es todo!
</p>

</body>
</section>
</chapter>

<chapter>
<title>Usar Linux como un servidor de impresión compatible con Windows</title>
<section>
<body>

<p>
Linux es un gran servidor de impresión, una vez más, es un excelente servidor
para cualquier propósito. Si se quiere tener la impresora como una impresora
compartida en una red Windows, lo primero que se ha de hacer es editar
<path>/etc/samba/smb.conf</path> para ajustar la configuración. El archivo <path>smb.conf</path>
contiene todos los parámetros para hacer que el servidor de impresión Linux
le parezca un servidor Windows NT a cualquier otra máquina con Windows.
Incluimos un ejemplo básico de <path>smb.conf</path> a continuación. Debe editarse
para adaptarse al entorno de red.
</p>

<pre caption = "Ejemplo de smb.conf">
[global]

workgroup = YOUR_WORKGROUP
server string = Gentoo Linux Server
encrypt passwords = True
security = user
smb passwd file = /etc/samba/private/smbpasswd
log file = /var/log/samba/log.%m
socket options = IPTOS_LOWDELAY TCP_NODELAY
domain master = Yes
local master = Yes
preferred master = Yes
os level = 65
dns proxy = No
name resolve order = lmhosts host bcast
bind interfaces only = True
interfaces = eth0
hosts deny = ALL
hosts allow = 192.168.1.4 127.0.0.1 (list of allow hosts here) 
debug level = 1
create mask = 0644
directory mask = 0755
level2 oplocks = True
read raw = no
write cache size = 262144

[printers]
comment = All Printer
path = /var/spool/samba
browseable = no
</pre>

<p>
La mayoría de controladores Windows son controladores PCL. Los trabajos
enviados desde Windows deben parecerle a CUPS un <c>application/octet-stream</c>
y deben imprimirse como un archivo sin formato. Por lo que, de usar CUPS,
se debe abrir el archivo <path>/etc/cups/mime.types</path> y se debe descomentar
la siguiente línea:
</p>

<pre caption="Quitando el comentario a la línea en /etc/cups/mime.types">
application/octet-stream
</pre>

<p>
Se ha de hacer lo mismo con la siguiente línea en <path>/etc/cups/mime.convs</path>:
</p>

<pre caption="Quitando el comentario a la línea en /etc/cups/mime.convs">
application/octet-stream application/vnd.cups-raw   0 -
</pre>

<p>
Ahora que se ha configurado samba, se reinicia samba, vamos a la máquina
Windows y añadimos una impresora de red. Un pastelito ¿no?
</p>

</body>
</section>
</chapter>
</guide>
