<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/vi/handbook/hb-install-ppc-kernel.xml,v 1.1 2005/04/02 19:16:06 neysx Exp $ -->

<sections>

<version>1.12</version>
<date>2004-12-12</date>

<section>
<title>Múi giờ</title>
<body>

<p>
Trước hết bạn cần chọn múi giờ để hệ thống của bạn biết nó nằm ở nơi
nào. Hãy tìm múi giờ của bạn trong <path>/usr/share/zoneinfo</path>,
sau đó tạo một liên kết biểu tượng đến <path>/etc/localtime</path>
bằng <c>ln</c>:
</p>

<pre caption="Đặt thông tin múi giờ">
# <i>ls /usr/share/zoneinfo</i>
<comment>(Giả sử bạn muốn dùng Asia/Saigon)</comment>
# <i>ln -sf /usr/share/zoneinfo/Asia/Saigon /etc/localtime</i>
</pre>

</body>
</section>
<section>
<title>Cài đặt từ mã nguồn</title>
<subsection>
<title>Chọn kernel</title>
<body>

<p>
Lõi của mọi bản phân phối là Linux kernel. Nó là một lớp nằm giữa
các chương trình và phần cứng hệ thống. Gentoo cung cấp cho người dùng
vài bộ mã nguồn kernel. Danh sách đầy đủ kèm mô tả nằm trong  <uri
link="/doc/en/gentoo-kernel.xml">Gentoo Kernel Guide</uri>.
</p>

<p>
PPC có thể chọn <c>development-sources</c> hoặc
<c>gentoo-dev-sources</c> (cả hai là kernel 2.6). Kernel sau cho phép
thực hiện cài đặt không mạng. Ngoài ra còn có một bản kernel 2.6 đặc
biệt cho Pegasos: <c>pegasos-dev-sources</c>.  Vậy hãy <c>emerge</c>
mã nguồn kernel vào:
</p>

<pre caption="Cài đặt mã nguồn kernel">
# <i>emerge gentoo-dev-sources</i>
</pre>

<p>
Hãy xem trong <path>/usr/src</path>, bạn sẽ thấy một symlink tên là
<path>linux</path> trỏ đến mã nguồn kernel của bạn:
</p>

<pre caption="Xem liên kết mã nguồn kernel">
# <i>ls -l /usr/src/linux</i>
lrwxrwxrwx    1 root     root           12 Jul 10 10:55 /usr/src/linux -&gt; linux-2.6.9
</pre>

<p>
Nếu không đúng như vậy (nghĩa là symlink trỏ đến mã nguồn kernel
khác), hãy đổi lại cho đúng:
</p>

<pre caption="Thay đổi liên kết mã nguồn kernel">
# <i>rm /usr/src/linux</i>
# <i>cd /usr/src</i>
# <i>ln -s linux-2.6.9 linux</i>
</pre>

<p>
Giờ là lúc để cấu hình và biên dịch mã nguồn kernel. Bạn có thể dùng
<c>genkernel</c> để tạo ra một kernel tổng quát như kernel dùng bởi
LiveCD. Tuy nhiên chúng tôi giải thích cách cấu hình "bằng tay" trước
vì nó là cách tốt nhất để tối ưu hệ thống của bạn.
</p>

<p>
Giờ hãy tiếp tục với <uri link="#manual">Cấu hình bằng tay</uri>. 
</p>

</body>
</subsection>
</section>
<section id="manual">
<title>Mặc định: Cấu hình bằng tay</title>
<subsection>
<title>Giới thiệu</title>
<body>

<p>
Cấu hình kernel bằng tay thường bị xem là một quá trình khó khăn mà
người dùng Linux phải thực hiện. Điều đó không đúng -- sau khi cấu
hình một vài kernel, bạn thậm chí không nhớ khó là gì ;)
</p>

<p>
Tuy nhiên, có một điều <e>đúng</e>: bạn phải hiểu hệ thống của bạn khi
bạn cấu hình kernel bằng tay. Hầu hết các thông tin có thể được thu
thập bằng cách xem <path>/proc/pci</path> (hoặc dùng <c>lspci</c> nếu
có). Bạn cũng có thể chạy <c>lsmod</c> để xem những kernel module nào
LiveCD dùng (nó có thể cung cấp những gợi ý hay những cái gì cần bật).
</p>

<p>
Giờ hãy chuyển vào thư mục mã nguồn kernel và chạy <c>make
menuconfig</c>. Nó sẽ khởi động menu cấu hình kernel.
</p>

<pre caption="Chạy menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Bạn sẽ được chào mừng bằng vô số các mục cấu hình. Chúng ta sẽ liệt kê
một số tùy chọn bạn phải kích hoạt (nếu không có Gentoo sẽ không hoạt
động, hoặc không hoạt động đúng với vài tinh chỉnh bổ sung).
</p>

</body>
</subsection>
<subsection>
<title>Kích hoạt các tùy chọn bắt buộc</title>
<body>

<p>
Đầu tiên hãy cho phép sử dụng code/driver thử nghiệm. Bạn cần nó, nếu
không vài code/driver quan trọng sẽ không xuất hiện:
</p>

<pre caption="Chọn code/driver thử nghiệm">
Code maturity level options ---&gt;
  [*] Prompt for development and/or incomplete code/drivers
</pre>

<p>
Giờ vào phần <c>File Systems</c> và chọn những loại hệ tập tin bạn
dùng. <e>Đừng</e> biên dịch chúng là module, nếu không hệ thống Gentoo
sẽ không thể mount các phân vùng của bạn. Ngoài ra hãy chọn <c>Virtual
memory</c>:
</p>

<pre caption="Selecting necessary file systems">
File systems ---&gt;
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [ ] /dev file system support (OBSOLETE)
    [ ]   Automatically mount at boot
    [*] Virtual memory file system support (former shm fs)

<comment>(Chọn những tùy chọn sau tùy theo hệ thống của bạn)</comment>
  &lt;*&gt; Reiserfs support
  &lt;*&gt; Ext3 journalling file system support
  &lt;*&gt; Second extended fs support
  &lt;*&gt; XFS filesystem support
</pre>

<p>
Nếu bạn dùng PPPoE để kết nối Internet hoặc dùng modem quay số, bạn sẽ
cần những tùy chọn sau trong kernel:
</p>

<pre caption="Chọn driver PPPoE cần thiết">
Device Drivers ---&gt;
  Networking support ---&gt;
    &lt;*&gt; PPP (point-to-point protocol) support
    &lt;*&gt;   PPP support for async serial ports
    &lt;*&gt;   PPP support for sync tty ports
</pre>

<p>
Hai tùy chọn nén không phương hại nhưng không phải nhất thiết không
cần, cũng như thế với tùy chọn <c>PPP over Ethernet</c>, nó có thể chỉ
cần bởi <c>rp-pppoe</c> khi cấu hình để dùng PPPoE kernel mode.
</p>

<p>
Nếu bạn cần nó, đừng quên thêm hỗ trợ card mạng vào kernel.
</p>

<p>
Tắt ADB raw keycode:
</p>

<pre caption="Tắt ADB raw keycode">
Macintosh Device Drivers ---&gt;
  [ ] Support for ADB raw keycodes
</pre>

<p>
Chọn hỗ trợ RTC phù hợp (<e>tắt</e> tùy chọn <c>Enhanced RTC</c>):
</p>

<pre caption="Chọn hỗ trợ RTC phù hợp">
Character devices ---&gt;
  [ ] Enhanced RTC

General setup ---&gt;
  [*] Support for /dev/rtc
</pre>

<p>
Hệ thống OldWorld cần hỗ trợ HFS để có thể chép kernel đã biên dịch
sang phân vùng MacOS.
</p>

<pre caption="Kích hoạt hỗ trợ HFS">
File Systems ---&gt;
  [*] HFS Support
</pre>

<p>
Khi bạn hoàn tất cấu hình kernel, hãy tiếp tục với <uri 
link="#compiling">Biên dịch và cài đặt</uri>.
</p>

</body>
</subsection>
<subsection id="compiling">
<title>Compiling and Installing</title>
<body>

<p>
Bạn đã cấu hình kernel xong, đã đến lúc biên dịch và cài đặt kernel.
Hãy thoát trình cấu hình và chạy:
</p>

<pre caption="Biên dịch kernel">
# <i>make all &amp;&amp; make modules_install</i>
</pre>

<p>
Khi đã biên dịch kernel xong, hãy chép nó vào <path>/boot</path>.
</p>

<pre caption="Cài đặt kernel">
<comment>Thay 2.6.9 bằng phiên bản kernel của bạn</comment>
(Apple/IBM)  # <i>cp vmlinux /boot/kernel-2.6.9</i>
(Pegasos)    # <i>cp arch/ppc/boot/images/zImage.chrp /boot/kernel-2.6.9</i>
</pre>

<p>
Đừng quên chép system map:
</p>

<pre caption="Chép system map">
# <i>cp System.map /boot/System.map-2.6.9</i>
</pre>

<p>
Tốt nhất bạn nên chép tập tin cấu hình kernel vào <path>/boot</path>,
để phòng hờ :)
</p>

<pre caption="Sao lưu cấu hình kernel">
# <i>cp .config /boot/config-2.6.9</i>
</pre>

<p>
Giờ hãy tiếp tục với <uri link="#kernel_modules">Cài đặt các module
riêng lẻ</uri>.
</p>

</body>
</subsection>
</section>
<section id="kernel_modules">
<title>Cài đặt các module kernel riêng lẻ</title>
<subsection>
<title>Cấu hình module</title>
<body>

<p>
Bạn nên liệt kê danh sách module bạn muốn nạp tự động trong
<path>/etc/modules.autoload.d/kernel-2.6</path>.  Bạn có thể thêm các
tùy chọn bổ sung cho các module bạn muốn luôn.
</p>

<p>
Để xem mọi module hiện có, hãy chạy lệnh <c>find</c>. Đừng quên thay
thế "&lt;phiên bản kernel&gt;" với phiên bản kernel bạn đã biên dịch:
</p>

<pre caption="Xem mọi module hiện có">
# <i>find /lib/modules/&lt;phiên bản kernel&gt;/ -type f -iname '*.o' -or -iname '*.ko'</i>
</pre>

<p>
Ví dụ, để tự động nạp module <c>3c59x.o</c>, hãy sửa tập tin
<path>kernel-2.6</path> và nhập vào tên module.
</p>

<pre caption="Sửa /etc/modules.autoload.d/kernel-2.6">
# <i>nano -w /etc/modules.autoload.d/kernel-2.6</i>
</pre>

<pre caption="/etc/modules.autoload.d/kernel-2.6">
3c59x
</pre>

<p>
Giờ hãy chạy <c>modules-update</c> để lưu các thay đổi vào tập tin
<path>/etc/modules.conf</path>:
</p>

<pre caption="Chạy modules-update">
# <i>modules-update</i>
</pre>

<p>
Từ 2004.3, chúng tôi đề nghị dùng udev thay vì devfs. Để bảo đảm hệ
thống sẽ hoạt động, bạn nên emerge udev.
</p>
<pre caption="Emerge udev">
# <i>emerge udev</i>
</pre>
<p>
Hãy tiếp tục cài đặt với <uri link="?part=1&amp;chap=8">Cấu hình hệ
thống của bạn</uri>.
</p>

</body>
</subsection>
</section>
</sections>
