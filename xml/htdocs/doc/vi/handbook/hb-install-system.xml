<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/vi/handbook/hb-install-system.xml,v 1.1 2005/03/26 18:35:50 swift Exp $ -->

<sections>

<version>1.63</version>
<date>2004-12-26</date>

<section>
<title>Chroot</title>
<subsection>
<title>Tùy chọn: Chọn Mirror</title>
<body>

<p>
Nếu bạn khởi động từ Gentoo LiveCD, bạn có thể dùng
<c>mirrorselect</c> để cập nhật các mirror nhanh nhất cho Portage và
mã nguồn vào <path>/etc/make.conf</path> (dĩ nhiên cần kết nối mạng):
</p>

<pre caption="Chọn mirror nhanh">
# <i>mirrorselect -a -s4 -o |grep 'GENTOO_MIRRORS=' &gt;&gt; /mnt/gentoo/etc/make.conf</i>
</pre>

<p>
Nếu vì lý do nào đó <c>mirrorselect</c> không hoạt động, đừng tuyệt
vọng. Bước này là tùy chọn, nếu không được thì vẫn còn các giá trị mặc
định để dùng.
</p>

</body>
</subsection>
<subsection>
<title>Chép thông tin DNS</title>
<body>

<p>
Còn một việc cần làm trước khi vào môi trường mới. Đó là chép thông
tin DNS vào <path>/etc/resolv.conf</path>. Bạn cần làm điều này để đảm
bảo mạng sẽ vẫn hoạt động kể cả khi đã vào môi trường mới.
<path>/etc/resolv.conf</path> chứa nameserver của mạng bạn đang dùng.
</p>

<pre caption="Chép thông tin DNS">
<comment>(Tùy chọn "-L" là cần thiết để đảm bảo bạn không chép
symbolic link)</comment>
# <i>cp -L /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
</pre>

</body>
</subsection>
<subsection>
<title>Mount hệ tập tin proc</title>
<body>

<p>
Mount hệ tập tin <path>/proc</path> vào <path>/mnt/gentoo/proc</path>
để bảo đảm những thông tin do kernel cung cấp vẫn có thể được dùng
trong môi trường chroot.
</p>

<pre caption="Mount /proc">
# <i>mount -t proc none /mnt/gentoo/proc</i>
</pre>

</body>
</subsection>
<subsection>
<title>Chuyển sang môi trường mới</title>
<body>

<p>
Giờ mọi phân vùng đã được khởi động và môi trường nền đã được cài đặt,
đã đến lúc chuyển sang môi trường mới bằng cách <e>chroot</e> vào nó.
Điều này nghĩa là bạn thay đổi từ môi trường cài đặt hiện thời (LiveCD
hoặc phương tiện cài đặt khác) sang hệ thống được cài đặt (gồm các
phân vùng đã được khởi động).
</p>

<p>
Chroot được thực hiện qua ba bước. Đầu tiên chúng ta sẽ thay đổi thư
mục gốc từ <path>/</path> (trên phương tiện cài đặt) sang
<path>/mnt/gentoo</path> (phân vùng của bạn) bằng <c>chroot</c>. Sau
đó chúng ta sẽ tạo môi trường mới bằng <c>env-update</c> (tạo các biến
môi trường). Cuối cùng, chúng ta nạp các biến môi trường này vào bằng
lệnh <c>source</c>.
</p>

<pre caption = "Chroot vào môi trường mới">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>env-update</i>
 * Caching service dependencies...
# <i>source /etc/profile</i>
</pre>

<p>
Chúc mừng bạn! Bạn đã vào trong môi trường Gentoo Linux của chính bạn.
Dĩ nhiên nó vẫn chưa hoàn chỉnh. Đó là lý do tại sao vẫn còn vài phần
để đọc trong tài liệu này :-)
</p>

</body>
</subsection>
<subsection>
<title>Cập nhật Portage tree</title>
<body>

<p>
Nếu bạn có kết nối Internet và không muốn cài các gói biên dịch sẵn
(còn gọi là các gói GRP), bạn nên cập nhật Portage tree sang phiên bản
mới nhất. <c>emerge --sync</c> sẽ thực hiện điều này cho bạn. Những
người dùng khác <e>chỉ</e> nên chạy <c>emerge --metadata</c> để tạo
cache database mà Portage vẫn thường dùng sau lệnh <c>emerge
--sync</c>.
</p>

<pre caption="Cập nhật Portage tree">
<comment>(Dành cho những người có kết nối Internet và không muốn dùng
các gói GRP)</comment>
# <i>emerge --sync</i>

<comment>(Dành cho những người dùng còn lại)</comment>
# <i>emerge --metadata</i>
</pre>

<p>
Nếu bạn được cảnh báo rằng phiên bản Portage mới đã có và bạn nên cập
nhật Portage, vậy thì hãy bỏ qua thông báo đó. Portage sẽ được cập
nhật sau trong quá trình cài đặt này.
</p>

</body>
</subsection>
<subsection id="configure_USE">
<title>Cấu hình biến USE</title>
<body>

<warn>
Đừng thay đổi biến USE nếu bạn cài đặt kiểu GRP. Bạn có thể thay đổi
biến USE sau khi đã cài đặt các gói bạn cần. Gremlins sẽ tấn công bạn
nếu bạn bỏ qua cảnh báo này!
</warn>

<p>
<c>USE</c> là một trong những biến mạnh nhất mà Gentoo cung cấp cho
người dùng. Vài chương trình có thể được biên dịch với một vài tính
năng. Ví dụ, vài chương trình có thể được biên dịch để hỗ trợ gtk,
hoặc qt. Vài chương trình khác có thể được biên dịch để hỗ trợ hoặc
không hỗ trợ SSL. Vài chương trình có thể được biên dịch để hỗ trợ
framebuffer (svgalib) thay vì X11 (X-server).
</p>

<p>
Hầu hết các bản phân phối tự biên dịch các phần mềm với nhiều tính
năng nhất có thể, làm tăng kích thước chương trình và tăng thời gian
khởi động, chưa kể bị phụ thuộc vào một lượng đáng kể các thư viện
khác. Với Gentoo bạn có thể định nghĩa tùy chọn nào nên sử dụng. Đây
chính là vai trò của <c>USE</c>.
</p>

<p>
Trong biến <c>USE</c>, bạn định nghĩa những từ khóa tương ứng với các
tùy chọn biên dịch. Ví dụ, <e>ssl</e> sẽ biên dịch hỗ trợ ssl trong
các chương trình có hỗ trợ ssl. <e>-X</e> sẽ loại bỏ hỗ trợ X-server
(chú ý dấu trừ phía trước). <e>gnome gtk -kde -qt</e> sẽ biên dịch
chương trình của bạn với hỗ trợ gnome (và gtk), không hỗ trợ kde (và
qt), giúp hệ thống của bạn tùy biến riêng cho GNOME.
</p>

<p>
Thiết lập <c>USE</c> mặc định được đặt trong
<path>make.defaults</path> của profile của bạn. Bạn sẽ tìm
<path>make.defaults</path> trong thư mục mà
<path>/etc/make.profile</path> trỏ đến và mọi thư mục cha của nó.
Thiết lập <c>USE</c> mặc định là tổng hợp của mọi thiết lập <c>USE</c>
trong mọi tập tin <path>make.defaults</path>. Những gì bạn lưu trong
<path>/etc/make.conf</path> sẽ được tính toán dựa trên các thiết lập
mặc định. Nếu bạn thêm vài thứ vào <c>USE</c>, nó sẽ được thêm vào
danh sách mặc định. Nếu bạn loại bỏ vài thứ khỏi <c>USE</c> (bằng cách
đặt dấu trừ trước từ khóa), nó sẽ bị loại bỏ khỏi danh sách mặc định
(nếu nó có trong danh sách mặc định). <e>Không bao giờ</e> thay thế
bất cứ gì bên trong thư mục <path>/etc/make.profile</path>; nội dung
thư mục này luôn luôn được ghi đè khi cập nhật Portage!
</p>

<p>
Mô tả đầy đủ về <c>USE</c> nằm trong phần hai của tài liệu này, <uri
link="?part=2&amp;chap=2">USE flag</uri>. Mô tả về các USE flag nằm
trên hệ thống bạn, tại <path>/usr/portage/profiles/use.desc</path>. 
</p>

<pre caption="Xem các USE flag hiện có">
# <i>less /usr/portage/profiles/use.desc</i>
<comment>(Bạn có thể cuộn bằng phím mũi tên, thoát bằng cách nhấn 'q')</comment>
</pre>

<p>
Trong ví dụ sau, chúng tôi hiển thị thiết lập <c>USE</c> cho hệ thống
dựa trên KDE với DVD, ALSA, và hỗ trợ ghi CD:
</p>

<pre caption="Mở /etc/make.conf">
# <i>nano -w /etc/make.conf</i>
</pre>

<pre caption="Thiết lập USE">
USE="-gtk -gnome qt kde dvd alsa cdr"
</pre>

<p>
Bạn thường chỉ dùng một hoặc hai locale trên hệ thống. Cho đến giờ,
khi biên dịch <c>glibc</c>, toàn bộ các locale sẽ được tạo. Bạn có thể
kích hoạt cờ <c>userlocales</c> và xác định những locale bạn cần trong
<path>/etc/locales.build</path>. Chỉ làm thế nếu bạn biết locale nào cần
chọn.
</p>

<pre caption="Activate the userlocales USE flag especially for glibc">
# <i>mkdir /etc/portage</i>
# <i>echo "sys-libs/glibc userlocales" >> /etc/portage/package.use</i>
</pre>

<p>
Giờ hãy xác định locale bạn có thể sẽ dùng:
</p>

<pre caption="Mở /etc/locales.build">
# <i>nano -w /etc/locales.build</i>
</pre>

<p>
Locale English (United States) và German (Germany) với dạng thức đi
kèm (như UTF-8) sẽ được dùng trong ví dụ.
</p>

<pre caption="Xác định locale">
en_US/ISO-8859-1
en_US.UTF-8/UTF-8
de_DE/ISO-8859-1
de_DE@euro/ISO-8859-15
</pre>

</body>
</subsection>
<subsection>
<title>Tùy chọn: Biên dịch phân tán</title>
<body>

<p>
Nếu bạn thích dùng nhiều hệ thống cùng lúc để biên dịch cho hệ thống
của bạn, bạn hãy xem qua <uri link="/doc/en/distcc.xml">DistCC
Guide</uri>. Bằng cách dùng <c>distcc</c> bạn có thể tận dụng sức mạnh
xử lý của nhiều hệ thống để hỗ trợ cài đặt.
</p>

</body>
</subsection>
</section>
<section>
<title>Những khác biệt giữa Stage1, Stage2 và Stage3</title>
<body>

<p>
Giờ hãy ngồi xuống và nghĩ về những bước đã làm. Chúng tôi đã yêu cầu
bạn chọn <e>stage1</e>, <e>stage2</e> hoặc <e>stage3</e> và đã cảnh
báo bạn rằng sự lựa chọn của bạn rất quan trọng đối với những bước cài
đặt kế tiếp. Đây là chỗ đầu tiên nơi sựa lựa chọn của bạn xác định
những bước kế tiếp.
</p>

<ul>
<li>
  Nếu bạn chọn <e>stage1</e>, bạn phải theo <e>cả hai</e> bước trong
  chương này (bắt đầu với <uri link="#doc_chap3">Tiến hành từ Stage1
  sang Stage2</uri>)
</li>
<li>
  Nếu bạn chọn <e>stage2</e>, bạn chỉ có thể bỏ qua bước đầu tiên và
  bắt đầu bằng bước thứ hai (<uri link="#doc_chap4">Tiến hành từ
  Stage2 sang Stage3</uri>)
</li>
<li>
  Nếu bạn chọn <e>stage3</e> (hoặc có, hoặc không có GRP), bạn sẽ bỏ
  qua cả hai bước và bắt đầu với <uri link="?part=1&amp;chap=7">Cấu
  hình Kernel</uri>
</li>
</ul>

</body>
</section>
<section>
<title>Tiến hành từ Stage1 sang Stage2</title>
<subsection>
<title>Giới thiệu Bootstrap</title>
<body>

<p>
Vậy là bạn sẽ biên dịch mọi thứ từ con số không, đồng ý nhé :-)
</p>

<p>
Ở bước này, chúng ta sẽ <e>bootstrap</e> hệ thống Gentoo. Sẽ mất nhiều
thời gian, nhưng kết quả là một hệ thống được tối ưu từ gốc, phù hợp
với máy của bạn và nhu cầu của bạn.
</p>

<p>
<e>Bootstrap</e> nghĩa là xây dựng thư viện GNU C, trình biên dịch GNU
và một số chương trình cốt lõi khác.
</p>

<p>
Trước khi bắt đầu bootstrap, bạn có thể cần tải về những mã nguồn cần
thiết. Nếu bạn không muốn làm điều này, bạn có thể tiếp tục với <uri
link="#bootstrap">Bootstrapping the System</uri>.
</p>

</body>
</subsection>
<subsection>
<title>Tùy chọn: Tải mã nguồn về trước</title>
<body>

<p>
Nếu bạn chưa chép mã nguồn qua thì bootstrap script sẽ tải về những mã
nguồn cần thiết. Nó sẽ làm mà không hỏi gì cả, nhưng chỉ có thể làm
khi có kết nối mạng :-) Nếu bạn muốn tải mã nguồn về trước và
bootstrap hệ thống sau (ví dụ, vì bạn không có kết nối internet trong
quá trình biên dịch), hãy dùng tùy chọn <e>-f</e> của bootstrap
script để lấy (fetch, nên mới có chữ <e>f</e>) mã nguồn về cho bạn.
</p>

<pre caption = "Tải về mã nguồn cần thiết">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh -f</i>
</pre>

</body>
</subsection>
<subsection id="bootstrap">
<title>Bootstrap hệ thống</title>
<body>

<p>
Ok. Hãy lấy bạn phím và nện vào lệnh kế tiếp để bắt đầu bootstrap. Sau
đó hãy tự thư giãn bằng cái gì đó khác vì bước này sẽ mất nhiều thời
gian.
</p>

<pre caption = "Bootstrap hệ thống">
# <i>cd /usr/portage</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Khi bạn đặt USE flag <c>nptl</c>, chạy lại <c>bootstrap.sh</c> có thể
thất bại với thông báo <c>linux-headers</c> block <c>linux26-headers</c>.
Nếu bạn nhận được lỗi này, hãy xóa <c>linux-headers</c> và thử lại:
</p>

<pre caption="Xóa linux-headers khỏi hệ thống">
# <i>emerge -C linux-headers</i>
# <i>emerge --oneshot --nodeps linux26-headers</i>
# <i>scripts/bootstrap.sh</i>
</pre>

<p>
Giờ hãy chuyển sang bước kế, <uri link="#doc_chap4">Tiến hành từ
Stage2 sang Stage3</uri>.
</p>

</body>
</subsection>
</section>
<section>
<title>Tiến hành từ Stage2 sang Stage3</title>
<subsection>
<title>Giới thiệu</title>
<body>

<p>
Nếu bạn đọc phần này thì bạn đã bootstrap hệ thống xong (hoặc bạn đã
bootstrap hệ thống trước đây, hoặc bạn đang dùng <e>stage2</e>). Vậy
đây là lúc để xây dựng toàn bộ phần mềm trên hệ thống.
</p>

<p>
<e>Toàn bộ</e> gói hệ thống? Không, không hẳn như vậy. Ở bước này, bạn
sẽ xây dựng những gói phần mềm hệ thống buộc phải có và không có giải
pháp thay thế. Vài gói hệ thống có vài giải pháp thay thế (như system
logger) và vì Gentoo là sự lựa chọn, chúng tôi sẽ không gây áp lực lên
bạn.
</p>

</body>
</subsection>
<subsection>
<title>Tùy chọn: Xem những gì sẽ làm</title>
<body>

<p>
Nếu bạn muốn biết những gói nào sẽ được cài đặt, hãy chạy <c>emerge
--pretend system</c>. Nó sẽ hiển thị mọi gói sẽ được cài. Vì danh sách
này khá lớn, bạn nên dùng những chương trình như <c>less</c> hoặc
<c>more</c> để có thể cuộn lên/xuống khi xem.
</p>

<pre caption = "Xem 'emerge system' sẽ làm gì">
# <i>emerge --pretend system | less</i>
</pre>

</body>
</subsection>
<subsection>
<title>Tùy chọn: Tải mã nguồn về</title>
<body>

<p>
Nếu bạn muốn <c>emerge</c> để tải về mã nguồn trước khi tiếp tục (ví
dụ vì bạn không muốn giữ kết nối internet trong quá trình biên dịch),
bạn có thể dùng tùy chọn <e>--fetchonly</e> của <c>emerge</c> để lấy
mã nguồn về.
</p>

<pre caption = "Lấy mã nguồn về">
# <i>emerge --fetchonly system</i>
</pre>

</body>
</subsection>
<subsection>
<title>Xây hệ thống</title>
<body>

<p>
Để bắt đầu xây dựng hệ thống, hãy thực hiện <c>emerge system</c>. Sau
đó hãy làm gì đó khác, vì bước này mất nhiều thời gian.
</p>

<pre caption = "Xây hệ thống">
# <i>emerge system</i>
</pre>

<p>
Bạn có thể an tâm bỏ qua những cảnh báo về các tập tin cấu hình cần
cập nhật (và chạy <c>etc-update</c>). Khi hệ thống Gentoo đã được cài
đặt xong và đã khởi động lại, hãy đọc tài liệu <uri
link="?part=3&amp;chap=2#doc_chap3">Cấu hình bảo vệ tập tin</uri>.
</p>

<p>
Khi tiến trình xây dựng đã hoàn tất, hãy tiếp tục với <uri
link="?part=1&amp;chap=7">Cấu hình Kernel</uri>.
</p>

</body>
</subsection>
</section>

</sections>
