<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/vi/handbook/hb-install-ppc-bootloader.xml,v 1.5 2005/12/12 13:34:21 neysx Exp $ -->
<!-- $OldHeader: /var/www/www.gentoo.org/raw_cvs/gentoo/xml/htdocs/doc/en/handbook/hb-install-ppc-bootloader.xml,v 1.27 2005/06/14 10:18:25 swift Exp $ -->

<sections>

<version>2.4</version>
<date>2005-05-12</date>

<section>
<title>Chọn lựa</title>
<subsection>
<title>Giới thiệu</title>
<body>

<p>
Kernel của bạn đã được cấu hình, biên dịch và các tập tin cấu hình cần
thiết đã sẵn sàng. Giờ là lúc để cài đặt chương trình để khởi động
kernel khi bạn khởi động hệ thống. Chương trình đó gọi là
<e>bootloader</e>. Nhưng trước hết, hãy xem xét các tùy chọn của
bạn...
</p>

<p>
Có vài bootloader cho Linux/PPC. Chúng ta có <uri link="#yaboot">yaboot</uri>
(dành cho máy NewWorld Apple và IBM) và <uri link="#bootx">BootX</uri>
(dành cho máy OldWorld Apple). Pegasos không cần bootloader,
nhưng chúng tôi có <uri link="#bootcreator">BootCreator</uri> để tạo
bootmenu SmartFirmware.
</p>

</body>
</subsection>
</section>
<section id="yaboot">
<title>Mặc định: Dùng yaboot</title>
<subsection>
<title>Giới thiệu</title>
<body>

<impo>
Bạn chỉ có thể dùng yaboot với các hệ thống NewWorld Apple và IBM
thôi!
</impo>

<p>
Trước hết chúng ta phải tạo các tập tin <path>/dev</path> trong hệ
thống của mình. Điều này cần thiết cho quá trình cài đặt bootloader.
Nó được thực hiện bằng cách "bind" (gắn) hệ tập tin <path>/dev</path>
từ CD Cài đặt:
</p>

<pre caption="Mount (bind) hệ tập tin /dev">
# <i>exit </i> # this will exit the chroot
# <i>mount -o bind /dev /mnt/gentoo/dev</i>
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>/usr/sbin/env-update &amp;&amp; source /etc/profile </i>
</pre>
    
<p>
Có hai cách để cấu hình yaboot trên hệ thống. Bạn có thể dùng
<c>yabootconfig</c> sẵn có để tự động thiết lập yaboot. Nếu vì vài lý
do nào đó bạn không muốn chạy <path>/etc/yaboot.conf</path> hoặc bạn
đang cài đặt Gentoo trên G5 (không phải lúc nào <c>yabootconfig</c>
cũng chạy trên G5), bạn có thể chỉ cần hiệu chỉnh tập tin mẫu đã cài
đặt trên hệ thống.
</p>

<note>
Bạn có thể cần sửa yaboot.conf nếu dùng genkernel. Các đối số do
genkernel đưa ra cần được thêm vào thành một tùy chọn trong phần
kernel image. Phần liên quan trong yaboot.conf như sau:
</note>

<pre caption="Thêm đối số boot vào yaboot.conf">
<comment>#################
## This section can be duplicated if you have more than one kernel or set of
## boot options - replace 2.6.9 with your kernel-version
#################</comment>
image=/boot/kernel-2.6.9
  label=Linux
  root=/dev/ram0    <comment># Nếu dùng genkernel, nó là /dev/ram0</comment>
  partition=3
  sysmap=/boot/System.map-2.6.9
  append="real_root=/dev/hda3 init=/linuxrc"  <comment># Thêm tham số vào dòng này</comment>
  read-only
<comment>##################</comment>
</pre>

<ul>
  <li><uri link="#yabootconfig">Mặc định: Dùng yabootconfig</uri></li>
  <li>
    <uri link="#manual_yaboot">Thay thế: Cấu hình yaboot bằng tay</uri>
  </li>
</ul>

</body>
</subsection>
<subsection id="yabootconfig">
<title>Mặc định: Dùng yabootconfig</title>
<body>

<p>
<c>yabootconfig</c> sẽ tự động dò tìm các phân vùng trên hệ thống và
sẽ thiết lập chế độ kết hợp khởi động kép và khởi động cả ba Linux,
Mac OS, và Mac OS X.
</p>

<p>
Để dùng <c>yabootconfig</c>, ổ đĩa của bạn phải có một phân vùng
bootstrap, và <path>/etc/fstab</path> phải được cấu hình với những
phân vùng Linux. Cả hai phải được thực hiện hoàn tất trong những bước
trên. Để bắt đầu, phải đảm bảo bạn đã cài đặt <c>yaboot</c> bản mới
nhất.
</p>

<pre caption = "Cài đặt yaboot với GRP">
# <i>emerge --usepkg --update yaboot</i>
</pre>

<p>
Bây giờ hãy thoát chroot và chạy <c>yabootconfig --chroot
/mnt/gentoo</c>. Chương trình sẽ chạy và nó sẽ xác nhận vị trí phân
vùng bootstrap. Hãy nhấn <c>Y</c> nếu nó đúng. Nếu không, hãy kiểm tra
cẩn thận <path>/etc/fstab</path>. Sau đó <c>yabootconfig</c> sẽ quét
thiết lập hệ thống, tạo <path>/etc/yaboot.conf</path> và chạy
<c>mkofboot</c> cho bạn. <c>mkofboot</c> được dùng để định dạng phân
vùng bootstrap, và cài đặt cấu hình tập tin cấu hình yaboot vào đó.
Sau bước này, hãy trở về chroot.
</p>
<pre caption="Vào chroot">
# <i>chroot /mnt/gentoo /bin/bash</i>
# <i>/usr/sbin/env-update &amp;&amp; source /etc/profile</i>
</pre>

<p>
Bạn có thể muốn kiểm tra nội dung <path>/etc/yaboot.conf</path>. Nếu
bạn thay đổi <path>/etc/yaboot.conf</path> (như đặt hệ điều hành mặc
định), hãy nhớ chạy lại <c>ybin -v</c> để áp dụng các thay đổi vào
phân vùng Apple_Bootstrap.
</p>

<p>
Hãy tiếp tục với <uri link="#reboot">Khởi động lại hệ thống</uri>.
</p>

</body>
</subsection>
<subsection id="manual_yaboot">
<title>Thay thế: Cấu hình yaboot bằng tay</title>
<body>

<p>
Trước hết hãy đảm bảo bạn đã cài đặt <c>yaboot</c> mới nhất:
</p>

<pre caption = "Cài đặt yaboot">
# <i>emerge --usepkg --update yaboot</i>
</pre>

<p>
Bên dưới là tập tin <path>yaboot.conf</path>. Hãy sửa lại nó theo ý
thích. Người dùng G5 nên chú ý rằng đĩa của họ là Serial ATA và được
Linux kernel xem như là đĩa SCSI (vì thế hãy thay thế
<path>/dev/hda</path> bằng <path>/dev/sda</path>).
</p>

<pre caption = "/etc/yaboot.conf">
<comment>## /etc/yaboot.conf
##
## chạy: "man yaboot.conf" để biết chi tiết. Đừng thay đổi nếu không cần!!
## xem thêm: cấu hình mẫu /usr/share/doc/yaboot/examples.
##
## Với menu khởi động kép, thêm một trong những cái sau:
## bsd=/dev/hdaX, macos=/dev/hdaY, macosx=/dev/hdaZ

## phân vùng bootstrap:</comment>

boot=/dev/hda2

<comment>## ofboot là cách openfirmware để xác định phân vùng bootstrap.
## Nếu không xác định, yaboot sẽ gặp lỗi trên G5 và vài máy G4 (trừ khi
## bạn truyền các đối số cần thiết cho chương trình mkofboot/ybin).
## hd:X nghĩa là /dev/sdaX (hoặc /dev/hdaX).
## 
## Người dùng G5 nên thêm dòng này (bỏ dấu ghi chú)!!

#ofboot=hd:2

## hd: is open firmware speak for hda</comment>
device=hd:

delay=5
defaultos=macosx
timeout=30
install=/usr/lib/yaboot/yaboot
magicboot=/usr/lib/yaboot/ofboot

<comment>#################
## Phần này có thể trùng lắp nếu bạn có nhiều kernel hoặc nhiều tập tùy
## chọn khởi động - hãy thay 2.6.9 bằng phiên bản kernel của bạn
#################</comment>
image=/boot/kernel-2.6.9
  label=Linux
  root=/dev/hda3
  partition=3
  sysmap=/boot/System.map-2.6.9
  read-only
<comment>##################

## Người dùng G5 và một số người dùng G4 nên đặt 
##   macos=hd:13
##   macosx=hd:12
## thay vì các giá trị trong ví dụ.</comment>
macos=/dev/hda13
macosx=/dev/hda12
enablecdboot
enableofboot
</pre>

<p>
Một khi đã hoàn tất <path>yaboot.conf</path> theo ý bạn, hãy chạy
<c>mkofboot -v</c> để cài đặt các thiết lập trong phân vùng bootstrap.
<e>Đừng quên thực hiện điều này!</e> Hãy xác nhận khi <c>mkofboot</c>
hỏi bạn tạo hệ tập tin mới.
</p>

<p>
Nếu mọi thứ đều ổn và bạn dùng cùng tùy chọn như trong ví dụ trên, lần
sau khởi động bạn sẽ có menu khởi động với năm mục chọn. Nếu bạn cập
nhật tập tin cấu hình yaboot sau đó, bạn sẽ cần chạy <c>ybin -v</c> để
cập nhật phân vùng bootstrap - <c>mkofboot</c> chỉ cần cho lần đầu
thiết lập.
</p>

<p>
Thông tin chi tiết về yaboot đặt tại <uri
link="http://penguinppc.org/bootloaders/yaboot">yaboot project</uri>.
Bây giờ hãy tiếp tục với <uri link="#reboot">Khởi động lại hệ thống</uri>.
</p>

</body>
</subsection>
</section>
<section id="bootx">
<title>Thay thế: BootX</title>
<body>

<impo>
BootX chỉ có thể chạy với máy OldWorld Apple!
</impo>

<p>
Vì BootX khởi động Linux từ trong MacOS, kernel sẽ cần được chép từ
phân vùng Linux sang phân vùng MacOS. Trước hết hãy mount phân vùng
MacOS vào, bên ngoài chroot. Dùng <c>mac-fdisk -l</c> để tìm mã số
phân vùng MacOS, sda6 được dùng trong ví dụ dưới đây. Khi đã mount
xong, hãy chép kernel vào thư mục hệ thống để BootX có thể tìm ra.
</p>

<pre caption="Chép kernel vào phân vùng MacOS">
# <i>exit</i>
cdimage ~# <i>mkdir /mnt/mac</i>
cdimage ~# <i>mount /dev/sda6 /mnt/mac -t hfs</i>
cdimage ~# <i>cp /mnt/gentoo/usr/src/linux/vmlinux "/mnt/mac/System Folder/Linux Kernels"</i>
</pre>

<p>
Nếu dùng genkernel, kernel nằm ở một vị trí khác và cũng cần chép
initrd luôn.
</p>

<pre caption="Chép kernel và initrd của Genkernel qua phân vùng MacOS">
# <i>exit</i>
cdimage ~# <i>mkdir /mnt/mac</i>
cdimage ~# <i>mount /dev/sda6 /mnt/mac -t hfs</i>
cdimage ~# <i>cp /mnt/gentoo/boot/kernel-* "/mnt/mac/System Folder/Linux Kernels"</i>
cdimage ~# <i>cp /mnt/gentoo/boot/initrd-* "/mnt/mac/System Folder"</i>
</pre>

<p>
Sau khi đã chép kernel xong, hãy unmount toàn bộ hệ tập tin và nhập
vào lệnh ma thuật mà bạn đã mong chờ từ lâu: <c>reboot</c>.
</p>

<pre caption="Unmount toàn bộ phân vùng và khởi động lại">
cdimage ~# <i>cd /</i>
cdimage ~# <i>umount /mnt/gentoo/proc /mnt/gentoo /mnt/mac</i>
cdimage ~# <i>reboot</i>
</pre>

<p>
Nhớ lấy đĩa CD ra, nếu không hệ thống sẽ lại khởi động từ CD lần nữa
thay vì MacOS.
</p>

<p>
Giờ hệ thống của bạn đã vào MacOS, hãy mở BootX control panel. Chọn
<c>Options</c> và bỏ chọn <c>Used specified RAM disk</c> nếu không
dùng genkernel. Nếu dùng genkernel, nhớ bảo đảm initrd của genkernel
được chọn thay vì initrd của CD Cài đặt. Nếu không dùng genkernel, có
một tùy chọn để xác định đĩa gốc (root) và phân vùng gốc. Hãy điền
những giá trị này cho phù hợp.
</p>

<p>
BootX có thể được cấu hình để khởi động Linux. Nếu bạn làm thế, trước
hết bạn sẽ thấy khởi động vào MacOS, sau đó, trong quá trình khởi
động, BootX sẽ nạp và khởi động Linux. Xem <uri
link="http://penguinppc.org/bootloaders/bootx/">BootX home page</uri>
để biết chi tiết.
</p>

<p>
Một khi đã khởi động bản cài đặt Gentoo của bạn, hãy hoàn tất việc cài
đặt với <uri link="?part=1&amp;chap=11">Hoàn tất cài đặt Gentoo</uri>.
</p>

</body>
</section>
<section id="bootcreator">
<title>Thay thế: BootCreator</title>
<body>

<impo>
BootCreator sẽ tạo một bootmenu SmartFirmware dễ thương, viết bằng
Forth cho Pegasos.
</impo>

<p>
Trước hết bảo đảm là bạn đã cài bản <c>bootcreator</c> mới nhất trên
hệ thống:
</p>

<pre caption = "Cài đặt  bootcreator">
# <i>emerge --usepkg --update bootcreator</i>
</pre>

<p>
Chép tập tin <path>/etc/bootmenu.example</path> vào
<path>/etc/bootmenu</path> và sửa lại theo ý thích:
</p>

<pre caption = "Sửa tập tin cấu hình bootcreator">
# <i>cp /etc/bootmenu.example /etc/bootmenu</i>
# <i>nano -w /etc/bootmenu</i>
</pre>

<p>
Bên dưới là tập tin <path>/etc/bootmenu</path> hoàn chỉnh. Hãy thay
đổi nó theo ý bạn.
</p>

<pre caption = "Tập tin cấu hình bootcreator">
<comment>#
# Example description file for bootcreator 1.1
#</comment>

[VERSION]
1

[TITLE]
Boot Menu

[SETTINGS]
AbortOnKey = false
Timeout    = 9
Default    = 1

[SECTION]
Local HD -> Morphos      (Normal)
ide:0 boot2.img ramdebug edebugflags="logkprintf"

[SECTION]
Local HD -> Linux 2.6.10 (Normal)
ide:0 linux-2.6.10 video=radeonfb:1024x768@70 root=/dev/hda3

</pre>

<p>
Cuối cùng <path>bootmenu</path> phải được chuyển cho Forth và chép vào
phân vùng khởi động, để SmartFirmware có thể đọc nó, do vậy bạn gọi
<c>bootcreator</c>:
</p>

<pre caption = "Cài đặt bootmenu">
# <i>bootcreator /etc/bootmenu /boot/menu</i>
</pre>

<note>
Chú ý xem thiết lập SmartFirmware khi khởi động lại, đảm bảo
<path>menu</path> phải được nạp mặc định.
</note>

<p>
Giờ bạn có thể tiếp tục cài đặt với <uri link="#reboot">Khởi động lại
hệ thống</uri>.
</p>


</body>
</section>
<section id="reboot">
<title>Khởi động lại hệ thống</title>
<subsection>
<body>

<p>
Hãy thoát khỏi môi trường chroot và unmount toàn bộ các phân vùng. Sau
đó gõ lệnh bạn đã đợi từ lâu: <c>reboot</c>.
</p>

<pre caption="Thoát khỏi chroot, unmount toàn bộ phân vùng và khởi
động lại">
# <i>exit</i>
cdimage ~# <i>cd</i>
cdimage ~# <i>umount /mnt/gentoo/boot /mnt/gentoo/proc /mnt/gentoo</i>
cdimage ~# <i>reboot</i>
</pre>

<p>
Một khi đã khởi động bản cài đặt Gentoo của bạn, hãy hoàn tất việc cài
đặt với <uri link="?part=1&amp;chap=11">Hoàn tất cài đặt Gentoo</uri>.
</p>

</body>
</subsection>
</section>
</sections>
