<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE sections SYSTEM "/dtd/book.dtd">

<!-- The content of this document is licensed under the CC-BY-SA license -->
<!-- See http://creativecommons.org/licenses/by-sa/1.0 -->

<!-- $Header: /var/cvsroot/gentoo/xml/htdocs/doc/vi/handbook/hb-install-mips-kernel.xml,v 1.1 2005/04/02 19:16:06 neysx Exp $ -->

<sections>

<version>1.6</version>
<date>2004-09-01</date>

<section>
<title>Múi giờ</title>
<body>

<p>
Trước hết bạn cần chọn múi giờ để hệ thống của bạn biết nó nằm ở nơi
nào. Hãy tìm múi giờ của bạn trong <path>/usr/share/zoneinfo</path>,
sau đó tạo một liên kết biểu tượng đến <path>/etc/localtime</path>
bằng <c>ln</c>:
</p>

<pre caption="Đặt thông tin múi giờ">
# <i>ls /usr/share/zoneinfo</i>
<comment>(Giả sử bạn muốn dùng Asia/Saigon)</comment>
# <i>ln -sf /usr/share/zoneinfo/Asia/Saigon /etc/localtime</i>
</pre>

</body>
</section>
<section>
<title>Cài đặt từ mã nguồn</title>
<subsection>
<title>Chọn kernel</title>
<body>

<p>
Lõi của mọi bản phân phối là Linux kernel. Nó là một lớp nằm giữa
các chương trình và phần cứng hệ thống. Gentoo cung cấp cho người dùng
vài bộ mã nguồn kernel. Danh sách đầy đủ kèm mô tả nằm trong  <uri
link="/doc/en/gentoo-kernel.xml">Gentoo Kernel Guide</uri>.
</p>

<p>
Hệ thống MIPS có thể chọn <c>mips-sources</c> (kernel mặc định cho
MIPS) hoặc (<c>mips-prepatch-sources</c> (kernel sắp phát hành).
</p>

<p>
Hãy chọn kernel cho bạn và cài đặt bằng <c>emerge</c>. Sau đây là ví
dụ cài đặt <c>mips-sources</c>, bạn hãy thay bằng kernel của bạn:
</p>

<pre caption="Cài đặt mã nguồn kernel">
# <i>emerge mips-sources</i>
</pre>

<p>
Hãy xem trong <path>/usr/src</path>, bạn sẽ thấy một symlink tên là
<path>linux</path> trỏ đến mã nguồn kernel của bạn:
</p>

<pre caption="Xem liên kết mã nguồn kernel">
# <i>ls -l /usr/src/linux</i>
lrwxrwxrwx    1 root     root           12 Oct 13 11:04 /usr/src/linux -&gt; linux-2.4.24
</pre>

<p>
Nếu không đúng như vậy (nghĩa là symlink trỏ đến mã nguồn kernel
khác), hãy đổi lại cho đúng:
</p>

<pre caption="Thay đổi liên kết mã nguồn kernel">
# <i>rm /usr/src/linux</i>
# <i>cd /usr/src</i>
# <i>ln -s linux-2.4.24 linux</i>
</pre>

<p>
Giờ là lúc để cấu hình và biên dịch mã nguồn kernel. 
</p>

</body>
</subsection>
</section>
<section>
<title>Cấu hình bằng tay</title>
<subsection>
<title>Giới thiệu</title>
<body>

<p>
Cấu hình kernel bằng tay thường bị xem là một quá trình khó khăn mà
người dùng Linux phải thực hiện. Điều đó không đúng -- sau khi cấu
hình một vài kernel, bạn thậm chí không nhớ khó là gì ;)
</p>

<p>
Tuy nhiên, có một điều <e>đúng</e>: bạn phải hiểu hệ thống của bạn khi
bạn cấu hình kernel bằng tay. Hầu hết các thông tin có thể được thu
thập bằng cách xem <path>/proc/pci</path> (hoặc dùng <c>lspci</c> nếu
có). Bạn cũng có thể chạy <c>lsmod</c> để xem những kernel module nào
LiveCD dùng (nó có thể cung cấp những gợi ý hay những cái gì cần bật).
</p>

<p>
Giờ hãy chuyển vào thư mục mã nguồn kernel và chạy <c>make
menuconfig</c>. Nó sẽ khởi động menu cấu hình kernel.
</p>

<pre caption="Chạy menuconfig">
# <i>cd /usr/src/linux</i>
# <i>make menuconfig</i>
</pre>

<p>
Bạn sẽ được chào mừng bằng vô số các mục cấu hình. Chúng ta sẽ liệt kê
một số tùy chọn bạn phải kích hoạt (nếu không có Gentoo sẽ không hoạt
động, hoặc không hoạt động đúng với vài tinh chỉnh bổ sung).
</p>

</body>
</subsection>
<subsection>
<title>Kích hoạt các tùy chọn bắt buộc</title>
<body>

<p>
Đầu tiên hãy cho phép sử dụng code/driver thử nghiệm. Bạn cần nó, nếu
không vài code/driver quan trọng sẽ không xuất hiện:
</p>

<pre caption="Chọn code/driver thử nghiệm">
Code maturity level options ---&gt;
  [*] Prompt for development and/or incomplete code/drivers
</pre>

<p>
Giờ vào phần <c>File Systems</c> và chọn những loại hệ tập tin bạn
dùng. <e>Đừng</e> biên dịch chúng là module, nếu không hệ thống Gentoo
sẽ không thể mount các phân vùng của bạn. Ngoài ra hãy chọn <c>Virtual
memory</c>, <c>/proc file system</c>, <c>/dev file system</c> +
<c>Automatically mount at boot</c>:
</p>

<pre caption="Chọn các hệ tập tin cần thiết">
<comment>(Với kernel 2.4.x)</comment>
File systems ---&gt;
  [*] Virtual memory file system support (former shm fs)
  [*] /proc file system support
  [*] /dev file system support (EXPERIMENTAL)
  [*]   Automatically mount at boot
  [ ] /dev/pts file system for Unix98 PTYs

<comment>(Với kernel 2.6.x)</comment>
File systems ---&gt;
  Pseudo Filesystems ---&gt;
    [*] /proc file system support
    [*] /dev file system support (OBSOLETE)
    [*]   Automatically mount at boot
    [*] Virtual memory file system support (former shm fs)

<comment>(Chọn những tùy chọn sau tùy theo hệ thống của bạn)</comment>
  &lt;*&gt; Reiserfs support
  &lt;*&gt; Ext3 journalling file system support
  &lt;*&gt; JFS filesystem support
  &lt;*&gt; Second extended fs support
  &lt;*&gt; XFS filesystem support
</pre>

<p>
Nếu bạn dùng PPPoE để kết nối Internet hoặc dùng modem quay số, bạn sẽ
cần những tùy chọn sau trong kernel:
</p>

<pre caption="Chọn driver PPPoE cần thiết">
<comment>(Với kernel 2.4.x)</comment>
Network device support ---&gt;
  &lt;*&gt; PPP (point-to-point protocol) support
  &lt;*&gt;   PPP support for async serial ports
  &lt;*&gt;   PPP support for sync tty ports

<comment>(Với kernel 2.6.x)</comment>
Device Drivers ---&gt;
  Networking support ---&gt;
    &lt;*&gt; PPP (point-to-point protocol) support
    &lt;*&gt;   PPP support for async serial ports
    &lt;*&gt;   PPP support for sync tty ports
</pre>

<p>
Hai tùy chọn nén không phương hại nhưng không phải nhất thiết không
cần, cũng như thế với tùy chọn <c>PPP over Ethernet</c>, nó có thể chỉ
cần bởi <c>rp-pppoe</c> khi cấu hình để dùng PPPoE kernel mode.
</p>

<p>
Nếu bạn cần nó, đừng quên thêm hỗ trợ card mạng vào kernel.
</p>

<p>
Nếu bạn dùng hệ thống Indy/Indigo2, bạn cần kích hoạt hỗ trợ SGI IP22.
</p>

<pre caption="Kích hoạt SGI IP22">
Machine selection ---&gt;
  [*] Support for SGI IP22 (Indy/Indigo2)
</pre>

<p>
Nếu bạn dùng Irix, bạn cần chọn tùy chọn sau:
</p>

<pre caption="Hỗ trợ IRIX Binary">
General setup ---&gt;
  [*] Include IRIX binary compatibility
</pre>

<p>
Nếu bạn có card ISA/EISA trên máy SGI Indigo2, hãy bật hỗ trợ cho nó.
</p>

<pre caption="Bật hỗ trợ ISA/EISA cho SGI Indigo2">
General setup ---&gt;
  [*] Indigo-2 (IP22) EISA bus support
  [*]   ISA bus support
</pre>

<p>
Nếu bạn có cổng song song SGI, bạn cần bật hỗ trợ nó. Nếu bạn có cổng
song song ISA, bạn nên chọn "PC-style hardware" thay vì cái trên.
</p>

<pre caption="Bật hỗ trợ SGI Parallel Port">
Parallel port support  ---&gt;
  &lt;*&gt; Parallel port support
  &lt;*&gt;   SGI Indy/Indigo2 hardware (EXPERIMENTAL) (NEW)
  &lt;*&gt;   IEEE 1284 transfer modes (NEW)
</pre>

<p>
Nếu bạn muốn dùng Indigo2 ISA slot, hãy bật hỗ trợ plug and play.
</p>

<pre caption="Bật hỗ trợ PnP cho ISA">
Plug and Play configuration  ---&gt;
  &lt;*&gt; Plug and Play support
  &lt;*&gt;   ISA Plug and Play support
</pre>

<p>
Đừng quên bật hỗ trợ SCSI và dùng driver SGI WD93C93:
</p>

<pre caption="Bật hỗ trợ driver WD93C93">
SCSI low-level drivers  ---&gt;
  &lt;*&gt; SGI WD93C93 SCSI Driver
</pre>

<p>
Với card mạng, bạn có thể cần hỗ trợ SGI Seeq ethernet controller:
</p>

<pre caption="Bật hỗ trợ SGI Seeq">
Network device support  ---&gt;
  Ethernet (10 or 100Mbit)  ---&gt;
    [*] Ethernet (10 or 100Mbit)
    [*]   SGI Seeq ethernet controller support
</pre>

<p>
Đừng quên bật hỗ trợ serial console và SGI Zilog85C30:
</p>

<pre caption="Bật hỗ trợ SGI Zilog85C30">
Character devices ---&gt;
  [*] Non-standard serial port support
  [*]   SGI Zilog85C30 serial support
</pre>

<p>
Ngoài ra đừgn quên bật hỗ trợ Indy/I2 Watchdog cũng như DS1286 RTC:
</p>

<pre caption="Bật hỗ trợ Watchdog và RTC">
Character Devices ---&gt;
  [*] SGI DS1286 RTC support
  Watchdog Cards  ---&gt;
    [*] Watchdog Timer Support
    &lt;*&gt;   Indy/I2 Hardware Watchdog
</pre>

<p>
Bạn cũng cần bật hỗ trợ phân vùng SGI :)
</p>

<pre caption="Bật hỗ trợ phân vùng SGI">
File Systems ---&gt;
  Partition Types ---&gt;
    [*] Advanced partition selection
    [*]   SGI partition support
</pre>

<p>
Nếu bạn có card SGI Newport (XL Gfx) và muốn dùng nó, hãy bật hỗ trợ
cho nó:
</p>

<pre caption="Bật hỗ trợ SGI Newport Card">
Console drivers  ---&gt;
  &lt;*&gt; SGI Newport Console support (NEW)
</pre>

<p>
Nếu bạn muốn hỗ trợ âm thanh trên Indy/Indigo2, hãy bật nó lên:
</p>

<pre caption="Bật hỗ trợ SGI HAL2">
Sound  ---&gt;
  &lt;*&gt; Sound card support
  &lt;*&gt;   SGI HAL2 sound (EXPERIMENTAL)
</pre>

<p>
Khi bạn hoàn tất cấu hình kernel, hãy tiếp tục với <uri 
link="#compiling">Biên dịch và cài đặt</uri>.
</p>

</body>
</subsection>
<subsection id="compiling">
<title>Biên dịch và cài đặt</title>
<body>

<p>
Bạn đã cấu hình kernel xong, đã đến lúc biên dịch và cài đặt kernel.
Hãy thoát trình cấu hình và chạy <c>make dep &amp;&amp; make bzImage modules 
modules_install</c>:
</p>

<pre caption="Biên dịch kernel">
<comment>(Với kernel 2.4)</comment>
# <i>make dep &amp;&amp; make bzImage modules modules_install</i>

<comment>(Với kernel 2.6)</comment>
# <i>make &amp;&amp; make modules_install</i>
</pre>

<p>
Khi đã biên dịch kernel xong, hãy chép nó vào <path>/boot</path>.
</p>

<pre caption="Cài đặt kernel">
# <i>cp vmlinux /boot/kernel-2.4.24</i>
# <i>cp System.map /boot/System.map-2.4.24</i>
</pre>

<p>
Tốt nhất bạn nên chép tập tin cấu hình kernel vào <path>/boot</path>,
để phòng hờ :)
</p>

<pre caption="Sao lưu cấu hình kernel">
# <i>cp .config /boot/config-2.4.24</i>
</pre>

<p>
Nếu hệ thống của bạn không khởi động ELF kernel, hãy biên dịch bằng
<c>make vmlinux.ecoff</c> thay vì <c>make vmlinux</c>. Kernel image sẽ
nằm trong <path>arch/mips/boot/vmlinux.ecoff</path> thay vì
<path>vmlinux</path>.
</p>

</body>
</subsection>
</section>
<section id="kernel_modules">
<title>Cài đặt các module kernel riêng lẻ</title>
<subsection>
<title>Cấu hình module</title>
<body>

<p>
Bạn nên liệt kê danh sách module bạn muốn nạp tự động trong
<path>/etc/modules.autoload.d/kernel-2.4</path> (hoặc
<path>kernel-2.6</path>).  Bạn có thể thêm các tùy chọn bổ sung cho
các module bạn muốn luôn.
</p>

<p>
Để xem mọi module hiện có, hãy chạy lệnh <c>find</c>. Đừng quên thay
thế "&lt;phiên bản kernel&gt;" với phiên bản kernel bạn đã biên dịch:
</p>

<pre caption="Xem mọi module hiện có">
# <i>find /lib/modules/&lt;phiên bản kernel&gt;/ -type f -iname '*.o' -or -iname '*.ko'</i>
</pre>

<p>
Ví dụ, để tự động nạp module <c>3c59x.o</c>, hãy sửa tập tin
<path>kernel-2.4</path> hoặc <path>kernel-2.6</path> và nhập vào tên
module.
</p>

<pre caption="Sửa /etc/modules.autoload.d/kernel-2.4">
<comment>(Ví dụ cho kernel 2.4)</comment>
# <i>nano -w /etc/modules.autoload.d/kernel-2.4</i>
</pre>

<pre caption="/etc/modules.autoload.d/kernel-2.4 hoặc kernel-2.6">
3c59x
</pre>

<p>
Giờ hãy chạy <c>modules-update</c> để lưu các thay đổi vào tập tin
<path>/etc/modules.conf</path>:
</p>

<pre caption="Chạy modules-update">
# <i>modules-update</i>
</pre>

<p>
Hãy tiếp tục cài đặt với <uri link="?part=1&amp;chap=8">Cấu hình hệ
thống của bạn</uri>.
</p>

</body>
</subsection>
</section>
</sections>
