<?xml version='1.0' encoding='euc-jp'?>
<guide> 
<title>Gentoo プリンティング ガイド</title> 
<author title="Author"><mail link="davisjp@muc.edu"> 
	John P. Davis</mail>
</author>
<author title="Copyeditor"><mail link="sunflare@gentoo.org">Phil Bordelon</mail>
</author> 
 
<abstract>A comprehensive printing guide for Gentoo Linux.  This document covers both local and network printing.</abstract> 
 
<version>1.0.2</version> 
<date>8 August 2002</date> 
 
<chapter> 
<title>CUPS を使用したローカルなプリンティングシステム</title> 
<section> 
	<title>CUPS を使用したプリンティングシステムの導入方法</title> 
<body> 
 
<p>現時点(2002/8/8)で portage tree には必要なパッケージが揃ってるので Gentoo Linux でプリンティングシステムを構築することは比較的簡単です。 
必要なのはプリンタ(ソフトウェア側)の設定とプリンタが Postscript を正確に解釈しているかを確認することです。まず始めに、必要となるソフトウェアのインストール方法です。 </p> 
 
<note>以下は GNOME2 の環境を想定した設定方法です。
CUPS は独立した環境変数をもっているため KDE においても同様の設定方法で動くでしょう。 KDE の設定ガイドは作成予定です。</note> 
 
<pre> 
# <c>emerge net-print/cups</c>  
# <c>emerge gnome-base/gnome-print</c> 
# <c>emerge gnome-base/libgnomeprint</c> 
# <c>emerge media-gfx/gimp-print</c> 
# <c>emerge net-print/gimp-print-cups</c> 
</pre> 
 
<p>これで、これらのパッケージは適切な依存関係を保ったままインストールされるので、次はプリンタ自身のインストールをします。 </p>

	<note>このドキュメントは、主に HP(Hewlett Packard) 社の USB 接続のプリンタ設定について取り扱っていますが、パラレルポート接続の場合においてもそれほど変わりません。  
	しかし、HP 社以外のプリンタについて書かれているわけではないので、HP 社以外のプリンタを使用する場合は、専用のドライバを探してインストールする必要があります。</note>
	
<p>USB 接続のプリンタをサポートしているカーネルを使っていない場合、USB 接続のプリンタをサポートするカーネルを作成してください。 "USB core support" と "USB printer support" をモジュールにするかカーネルに組み込むなどして有効にする必要があります。 
個人の好みによりますが、私の環境では <c> lsmod </c> を使えるため、両方ともモジュール化しています。 </p> 
 
	<impo>パラレルポート接続のプリンタを使用している場合は、カーネルオプションにおいて "USB printer support" の代わりに "parallel port" が有効になっている事を確認してください。</impo> 
 
	<note>カーネルの再構築の方法が分からない場合は、公式な <uri link="http://www.tldp.org/HOWTO/Kernel-HOWTO.html">Linux Kernel-HOWTO</uri> を参照してください。 </note>
 
<p>適切なカーネルオプションが有効になったカーネルをインストールした後、新しいカーネルが、プリンタを適切に扱い、認識することを確認します。 一度システムを再起動させ、その後にプリンタのモジュールを読み込みます。 </p> 
 
	<note>USB のサポートをカーネルに組み込んだ場合は、USB モジュールを読み込む必要はありません。 パラレルポート接続のプリンタを使用している場合は、代わりの適切なモジュールが必要です。</note> 
 
<pre> 
# <c>insmod usbcore</c> 
# <c>insmod printer</c> 
</pre> 
 
<p>モジュールの読み込みに成功したらプリンタを接続してみます。そして <path>/var/log/messages</path> をチェックして、プリンタが認識されていることを確認してください。 </p> 
 
<pre> 
# <c>tail /var/log/messages</c> 
</pre> 
 
<p>このようなメッセージを見られるはずです: </p>
   
<pre>
<c>hub.c: USB new device connect on bus2/2, assigned device number 2 </c> 
<c>printer.c: usblp0: USB bidirectional printer dev 2 if 0 alt 1 proto 2 vid 0x03F0 pid 0x1104 </c>
</pre>    
 
	<note>パラレル接続のプリンタを使用している場合、再起動する前にプリンタが接続されていることを確認してください。 再起動後 <c>dmesg</c> を実行してカーネルがプリンタを認識している形跡を探してください。</note> 
 
<p>CUPS を使用したプリンタの設定の前に <i>cat</i> を使ってプリンタのテストをすることができます。</p> 

<pre>
# <c>touch test.txt</c>
# <c>echo "Hello World" > test.txt</c>
# <c>cat test.txt > /dev/usb/lp0 </c>

<i> Alternatively, for parallel port printers: </i>
# <c>cat test.txt > /dev/lp0 </c>
</pre>

</body> 
</section> 
 
<section> 
	<title>PPD ファイルの設定</title> 
<body> 
<p>プリンタと CUPS の設定をします。 HP 社のインクジェットプリンタを使用しているなら、<c>hpijs</c> (プリンタドライバ)をインストールする必要があります。 
このドライバは HP 社のプリンタを動かすために必要な全ての Postscript の解釈、処理をします。 HP 社のプリンタを使用していないのなら、他の代りのドライバが必要になるでしょう。</p> 
 
<note>この <c>hpijs</c> (プリンタドライバ)は HP 社のインクジェットプリンタ向けです。 HP 社のレーザージェットプリンタを使用しているなら、すでに "GNOME printing system" によってサポートが得られています。 
HP 社のインクジェットプリンタを使用していないのなら下記の設定過程は飛ばしてください。</note> 
 
<pre> 
# <c>emerge net-print/hpijs</c> 
</pre> 
 
	<impo>HP 社からの <c>hpijs</c> (プリンタドライバ)向のドキュメントは <path>/usr/share/doc/hpijs-1.1</path> にあります。 <i>高度</i>で詳細な説明が載っています。 </impo> 
 
<p> プリンタが Postscript を正確に解釈するために CUPS は PPD (Printer Postscript Definition) ファイルを必要とします。 PPD を生成する一番簡単な方法は foomatic を介すことです。 
foomatic の設定スクリプトは <uri link="http://www.linuxprinting.org/download/foomatic">ここ</uri> で得られます。 Gentoo の為の開発版 ebuild がありますが、現在の Portage tree には取り込まれていません。 
いったん foomatic をインストールし、設定したなら、以下のコマンドを実行してプリンタを設定し、PPD ファイルを正しい場所に移動させてください。 この例では HP 社のプリンタの hpijs ドライバを使っています。 </p>

<note>プリンタ ID についてですが、foomatic は <path>/usr/share/foomatic/db/source/printer</path> にあるデータベースからの ID を期待します。 
あなたはプリンタ ID を見付け、そしてそれを正確な名前で使わなければなりません。 この場合十分に気をつけることを心掛けてください。 </note>

<pre>
# <c>foomatic-configure -s cups -p printer ID -c print_device -n queue name -d hpijs </c>
# <c>mv /etc/foomatic/your.new.ppd /etc/cups/ppd </c>
</pre>
 
	<impo>HP 社のプリンタを使っていない場合でもなお foomatic を使って PPD ファイルを作成することができます。 より詳細な情報は <uri link="http://www.linuxprinting.org/foomatic/USAGE">foomatic のドキュメント</uri> 
	と <uri link="http://www.linuxprinting.org">linuxprinting.org</uri> を参照してください。</impo>

</body> 
</section> 
 
<section> 
	<title>CUPS の設定</title> 
<body> 
<p>プリンタ自身の設定が済んだなら、次はプリンタのキューを操作する為に CUPS の設定が必要です。 CUPS でウェブブラウザのポート番号631を通してプリンタ機器にアクセスすることができます。これはとても便利です。 </p>

	<impo>CUPS はデーモンの為の作りつけの設定ファイルを持っていますが、それを修正したほうが良いでしょう(しなければならない訳ではありません)。 それをちらっと見たくなったら <path>/etc/cups/cupsd.conf</path> を見てください。</impo>
	
<pre>
# <c>rc-update add cupsd default</c>
# <c>/etc/init.d/cupsd start</c>
</pre>

<p>今 CUPS デーモンが走っているはずなので、好きなブラウザを開いて <uri link="http://localhost:631">ここ</uri> をクリックしてください。 </p> 
<p>うまくいけば CUPS の設定画面を見ることができるでしょう。  
そのページの上部の <i>administration</i> タブをクリックして root のパスワード、又は <i>lp</i> グループに入っているユーザー名を入力してください。 
一度ユーザー認証を済ませたなら <i>printers</i> セクションの下の <i>Add Printer</i> タブをクリックしてください。 そして必要となるプリンタの名前、説明、場所を入力してください。 
プリンタの名前は foomatic の為に指定したプリンタのキューの名前と全く同じ名前にしてください。 今、接続デバイス名を選択してください。 
プリンタの製造元を選択し、続けてください。次のページであなたのプリンタを一覧の中から選択してください。 </p>

<p>設定はこれで終りです。 プリンタの名前をクリックしてテストページのプリントを試してください。 プリンタの設定は完璧です。</p>

<note>もしなんらかの原因でプリンタが動かない場合は教えられた CUPS のログが保管されるディレクトリへ行き、<i>error_log</i> に目を通してください。 </note>
 
</body> 
</section>
</chapter>

<chapter>
	<title>CUPS を使用して GIMP、 OpenOffice.org1.0、Abiword でプリントする為の設定</title>
<section>
	<title>The GIMP</title>
<body>
<p>まずはじめに GIMP の設定をしましょう。なぜなら GIMP はクールで、その価値があるからです。 GIMP を立ち上げて既存のファイルを開くか、新規にファイルを作成してください。<i>File</i> メニューを探しさえすればよいので、これはそんなに問題じゃないですね。
画像上で右クリックして <i>File/Print</i> へ行ってください。プリントする為のダイアログが現れると思いますが、そこで新しいプリンタをクリックしてください。 
あなたのプリンタがまだ一覧にないのならプリンタの名前を入力して、そのプリンタを選択してください。 さあ、今 GIMP からプリントする為の設定をしましょう。 設定を巧みに使って楽しんでください。</p>
</body>
</section>

<section>
	<title>OpenOffice.org1.0</title>
<body>	
<p>OpenOffice.org1.0 でプリントすることは全然難しくありません。 <path>OpenOffice.org1.0/program </path>へ行き、 <c>spadmin</c> を走らせてください。 
新規にプリンタを作成すると <i>Choose a Driver</i> という画面が現れるので <i>import</i> をクリックし、プリンタの PPD ファイルのある場所を指定してください。 私達の場合 <path>/etc/cups/ppd</path> にあると思います。 
標準のプリントコマンドとプリンタの名前を使い、それを標準に設定し、プリントする準備は整いました。 OpenOffice.org1.0 を立ち上げてプリント画面に行って、あなたのプリンタを選択してください。 テストページをプリントして終りです。 </p>
</body>
</section>

<section>
	<title>Abiword</title>
<body>

	<warn>Abiword は CUPS-1.1.15-r2 と使用すると segfault したりクラッシュしたりします。 CUPS を .14 シリーズに戻すことでこの問題は改善されるので、.14 シリーズに戻すことをお勧めします。</warn>

<p>Abiword はサポート予定にあります。</p>
</body>
</section>

<p>ローカルなプリンティングシステムは仕上りました。 次はネットワークサポートの追加へ移りましょう。 </p>

</chapter>

<chapter>
	<title>CUPS と SAMBA を使用したネットワークプリンティングシステム</title>
<section>
	<title>Linux マシンから Windows のプリンタでプリントする場合</title>
<body>
<p>プリントのオプションを有効にするには、まず SAMBA が隣り合った二つのコンピュータのネットワークの為にインストールされてなければなりません。  </p>

<pre>
# <c>emerge net-fs/samba</c>
</pre>

<note>SAMBA に関するより詳細な情報は公式の "<uri link="http://www.tldp.org/HOWTO/SMB-HOWTO.html">SAMBA HOWTO</uri>" を参照してください。</note>

<p> まず初めに <i>foomatic</i> を使ってリモートプリンタの為の PPD ファイルを作成してください。 あなたのプリンタが Linux で動くことを確認するか、<uri link="http://www.linuxprinting.org/printer_list.cgi">linuxprinting.org</uri>のプリンタのデータベースの中に名前があるか調べることを忘れないでください。 
<i>foomatic</i> にプリンタが何で、どこにあるのか教えましょう。そして作成された PPD ファイルを正しい場所へ移しましょう。 </p>

<pre>
# <c>foomatic-configure -s cups -p printer ID -c smb://user:password@server/share -n queue name -d hpijs </c> 
# <c>mv /etc/foomatic/your.new.ppd /etc/cups/ppd </c>
</pre>

<p> <uri link="http://localhost:631">ここ</uri>をクリックして CUPS の設定画面を開いてください。 
前述の手順を踏んでプリンタを追加してください。 ただしプリンタのポートを聞かれたら、<i>smb://user:password@server/share</i> を指定してください。
ここが CUPS で Windows マシンのプリンタを使う為のポイントです。 </p>
</body>
</section>

<section>
	<title>Linux を Windows の共用プリントサーバーとして使う</title>
<body>

<p>Linux は素晴らしいプリントサーバーになります。そしてまた、素晴らしいどのようなサーバーにもなります。 まず最初にしなくてはならないことは、設定するために <path>/etc/samba/smb.conf</path> を編集することです。 
この <i>smb.conf</i> ファイルは Linux マシンを Windows マシンの為の Windows NT サーバーと同じようにするためのすべての設定を含んでいます。 
下記はとても実用的な <i>smb.conf</i> の例です。 あなたのネットワーク環境に合わせて、必要に応じて編集してください。 </p>

<pre>
<c>[global]</c>

      <c>workgroup = YOUR_WORKGROUP</c>
      <c>server string = Gentoo Linux Server</c>
      <c>encrypt passwords = True</c>
      <c>security = user</c>
      <c>smb passwd file = /etc/samba/private/smbpasswd</c>
      <c>log file = /var/log/samba/log.%m</c>
      <c>socket options = IPTOS_LOWDELAY TCP_NODELAY</c>
      <c>domain master = Yes</c>
      <c>local master = Yes</c>
      <c>preferred master = Yes</c>
      <c>os level = 65</c>
      <c>dns proxy = No</c>
      <c>name resolve order = lmhosts host bcast</c>
      <c>bind interfaces only = True</c>
      <c>interfaces = eth0</c>
      <c>hosts deny = ALL</c>
      <c>hosts allow = 192.168.1.4 127.0.0.1 (list of allow hosts here) </c>
      <c>debug level = 1</c>
      <c>create mask = 0644</c>
      <c>directory mask = 0755</c>
      <c>level2 oplocks = True</c>
      <c>read raw = no</c>
      <c>write cache size = 262144</c>

<c>[printers]</c>
      <c>comment = All Printer</c>
      <c>path = /var/spool/samba</c>
      <c>browseable = no </c>
   
</pre>

<p>SAMBA の設定はこれで済みました。 samba を再起動させて Windows マシンへ行き、ネットワークプリンタをインストールしてください。 ケーキを召し上がってはいかがですか？</p>
</body>
</section>
</chapter>
</guide>
