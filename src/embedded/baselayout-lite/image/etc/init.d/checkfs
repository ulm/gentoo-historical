#!/sbin/runscript
# Copyright 1999-2005 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo/src/embedded/baselayout-lite/image/etc/init.d/Attic/checkfs,v 1.2 2005/03/06 06:28:08 iggy Exp $

depend() {
	need checkroot modules
}

start() {
	local retval=0

	### REMOVED: raid/evms/lvm support

	if [ -f /fastboot ] || [ -n ${CDBOOT} ] ; then
		rm -f /fastboot
	else
		ebegin "Checking all filesystems"
		if [ -f /forcefsck ] ; then
			ewarn "A full fsck has been forced"
			fsck -C -R -A -a -f
			retval=$?
			rm -f /forcefsck
		else
			fsck -C -T -R -A -a
			retval=$?
		fi
		if [ ${retval} -eq 0 ] ; then
			eend 0
		elif [ ${retval} -ge 1 && ${retval} -le 3 ] ; then
			ewend 1 "Filesystem errors corrected."
			# Everything should be ok, so return a pass
			return 0
		else
			eend 2 "Fsck could not correct all errors, manual repair needed"
			/sbin/sulogin ${CONSOLE}
		fi
	fi
}

# vim:ts=4
