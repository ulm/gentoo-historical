#!/sbin/runscript
# Copyright 1999-2005 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo/src/embedded/baselayout-lite/image/etc/init.d/Attic/domainname,v 1.2 2005/03/06 06:28:08 iggy Exp $

depend() {
	need checkroot hostname
	before bootmisc
}

checkconfig_dns() {
	if [ -f /etc/dnsdomainname ] ; then
		ewarn "You should stop using /etc/dnsdomainname and use /etc/conf.d/domainname"
		export DNSDOMAIN=$(</etc/dnsdomainname)
	fi
	[ -z ${DNSDOMAIN} ] && return 1

	if ! touch /etc/resolv.conf 2> /dev/null ; then
		ewarn "Unable to set domain in resolv.conf (ro root?)"
		return 1
	else
		return 0
	fi
}

start() {
	local retval=0
	local retval2=0

	if checkconfig_dns ; then
		ebegin "Setting DNS domainname to ${DNSDOMAIN}"
		resolv=$(grep -v '^[:space:]*domain' /etc/resolv.conf)
		[ ${OVERRIDE} -eq "1" ] \
			&& resolv="${resolv}"$'\n'"domain ${DNSDOMAIN}" \
			|| resolv="domain ${DNSDOMAIN}"$'\n'"${resolv}"
		echo "${resolv}" > /etc/resolv.conf
		retval2=$?
		eend ${retval2} "Failed to set the DNS domainname"
	fi

	return $((retval + retval2))
}


# vim:ts=4
