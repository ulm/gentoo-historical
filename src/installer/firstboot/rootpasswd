TEMP_FILE="/tmp/1234567.tmp"

# Set data
FIRST_PASSWORD=""
SECOND_PASSWORD=""
ONE_PASS=0

# Loop while the passwords don't match
while 	[ "$FIRST_PASSWORD" != "$SECOND_PASSWORD" ] || \
		[ "$FIRST_PASSWORD" == "" ]; do
		
	# If the passwords are not identical, then show a warning
	if 	[ "$FIRST_PASSWORD" != "$SECOND_PASSWORD" ] && \
		[ "$FIRST_PASSWORD" != "" ]; then
		dialog 	--backtitle "Gentoo Linux" --title " Root Password " \
			--infobox "\nYour passwords did not match, please try again." \
			5 51
		sleep 5
		
		# Reset data
		FIRST_PASSWORD=""
		SECOND_PASSWORD=""
		ONE_PASS=0
	fi

	# Loop while the user didn't enter the password
	while [ "$FIRST_PASSWORD" == "" ]; do
		if [ $ONE_PASS -eq 0 ]; then
			dialog	 --no-cancel --backtitle "Gentoo Linux" \
				--title " Root Password " \
				--passwordbox "Please enter root password:" \
				8 60 2> $TEMP_FILE
		else
			dialog	--no-cancel --backtitle "Gentoo Linux" \
				--title " Root Password " \
				--passwordbox "You MUST enter a root password:" \
				8 60 2> $TEMP_FILE
		fi
		FIRST_PASSWORD=$(cat $TEMP_FILE)
		rm -f $TEMP_FILE
		ONE_PASS=1
	done
	
	# Loop while the user didn't enter the password
	while [ "$SECOND_PASSWORD" == "" ]; do
		dialog	--no-cancel --backtitle "Gentoo Linux" \
			--title " Root Password " \
			--passwordbox "Please re-enter root password for verification:" \
			8 60 2> $TEMP_FILE
	
		SECOND_PASSWORD=$(cat $TEMP_FILE)
		rm -f $TEMP_FILE
	done
done

# Set the root password
echo "root:$PASSWORD" | chpasswd
