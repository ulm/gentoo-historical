#! /bin/sh /usr/share/dpatch/dpatch-run
## 80_javaxpcom.dpatch by  <glandium@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Force creation of Makefiles in extensions/java, even when javaxpcom is 
## DP: disabled. Don't build the jars if DEB_NO_JAR is defined.

@DPATCH@

=== allmakefiles.sh
==================================================================
--- xulrunner/allmakefiles.sh	(revision 134)
+++ xulrunner/allmakefiles.sh	(local)
@@ -1353,7 +1353,7 @@
 "
 fi
 
-if [ "$MOZ_JAVAXPCOM" ]; then
+if [ "1" ]; then
     MAKEFILES_javaxpcom="
         extensions/java/Makefile
         extensions/java/xpcom/Makefile
=== extensions/java/xpcom/build/Makefile.in
==================================================================
--- xulrunner/extensions/java/xpcom/build/Makefile.in	(revision 138)
+++ xulrunner/extensions/java/xpcom/build/Makefile.in	(local)
@@ -76,6 +76,7 @@
 OUTPUT_DIR = $(CURDIR)/_javagen/org/mozilla/xpcom
 endif
 
+ifndef DEB_NO_JAR
 _javagen/org/mozilla/xpcom/.iface_done:
 	@if test ! -d _javagen/org/mozilla/xpcom; then \
 		touch .done; \
@@ -106,4 +107,4 @@
 
 libs:: $(JARFILE) $(JARFILE_SRC)
 	$(INSTALL) $(IFLAGS1) $^ $(DIST)/bin
-
+endif
=== extensions/java/xpcom/interfaces/Makefile.in
==================================================================
--- xulrunner/extensions/java/xpcom/interfaces/Makefile.in	(revision 138)
+++ xulrunner/extensions/java/xpcom/interfaces/Makefile.in	(local)
@@ -61,7 +61,9 @@
 		$(NULL)
 
 # install jars into SDK
+ifndef DEB_NO_JAR
 SDK_LIBRARY = $(JARFILE) $(JARFILE_SRC)
+endif
 
 GARBAGE += $(JARFILE) $(JARFILE_SRC) $(GEN_JAVA_SRCS) java.files .done
 GARBAGE_DIRS += _javagen org
@@ -76,6 +78,7 @@
 OUTPUT_DIR = $(CURDIR)/_javagen/org/mozilla/xpcom
 endif
 
+ifndef DEB_NO_JAR
 _javagen/org/mozilla/xpcom/.iface_done: $(JAVA_SRCS) $(DEPTH)/extensions/java/xpcom/tools/genifaces/GenerateJavaInterfaces$(BIN_SUFFIX)
 	@if test ! -d _javagen/org/mozilla/xpcom; then \
 		touch .done; \
@@ -121,3 +124,4 @@
 # Build the implementation Java classes, which depend on these interfaces
 export::
 	$(MAKE) -C ../src jarfile
+endif
=== extensions/java/xpcom/src/Makefile.in
==================================================================
--- xulrunner/extensions/java/xpcom/src/Makefile.in	(revision 138)
+++ xulrunner/extensions/java/xpcom/src/Makefile.in	(local)
@@ -105,6 +105,7 @@
 SEP = :
 endif
 
+ifndef DEB_NO_JAR
 _javagen/org/mozilla/xpcom/internal/.iface_done: $(JAVA_SRCS)
 	@if test ! -d _javagen/org/mozilla/xpcom/internal; then \
 		touch .done; \
@@ -138,3 +138,4 @@
 	$(INSTALL) $(IFLAGS1) $^ $(DIST)/bin
 install:: $(JARFILE)
 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(mozappdir)
+endif
