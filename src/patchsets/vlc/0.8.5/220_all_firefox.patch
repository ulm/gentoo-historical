Index: vlc-0.8.5/configure.ac
===================================================================
--- vlc-0.8.5.orig/configure.ac
+++ vlc-0.8.5/configure.ac
@@ -5003,9 +5003,21 @@ AC_ARG_ENABLE(mozilla,
 AC_ARG_WITH(mozilla-sdk-path,
   [    --with-mozilla-sdk-path=PATH path to mozilla sdk])
 
-if test "${enable_mozilla}" = "yes" 
+if test x"${enable_mozilla}" != "xno" && test x"${enable_mozilla}" != "x"
 then
-  if test "${with_mozilla_sdk_path}" = ""
+  if test x"${enable_mozilla}" != "xyes"; then
+     PKG_CHECK_MODULES([MOZILLA], [${enable_mozilla}-plugin])
+     VLC_ADD_CPPFLAGS([mozilla], [$MOZILLA_CFLAGS -DHAVE_MOZILLA_CONFIG_H])
+     VLC_ADD_LDFLAGS([mozilla], [$MOZILLA_LIBS])
+     xpidl_path=`pkg-config --variable=libdir ${enable_mozilla}-plugin`
+     build_pic=yes
+     AC_PATH_PROG(XPIDL, xpidl, no, ${xpidl_path})
+     if test "${XPIDL}" = "no"; then
+       AC_MSG_ERROR([Please install the Mozilla development tools, xpidl was not found.])
+     fi
+     XPIDL_INCL="-I`pkg-config --variable=idldir ${enable_mozilla}-xpcom`"
+     mozilla="true"
+  elif test "${with_mozilla_sdk_path}" = ""
   then
     AC_PATH_PROG(MOZILLA_CONFIG, mozilla-config, no)
     if test "${MOZILLA_CONFIG}" = "no"
Index: vlc-0.8.5/mozilla/vlcshell.cpp
===================================================================
--- vlc-0.8.5.orig/mozilla/vlcshell.cpp
+++ vlc-0.8.5/mozilla/vlcshell.cpp
@@ -47,10 +47,8 @@
 #include <npapi.h>
 #include <npruntime.h>
 
-/* This is from mozilla java, do we really need it? */
-#if 0
+/* This is from mozilla java, needed for jref type */
 #include <jri.h>
-#endif
 
 #include "vlcplugin.h"
 #include "vlcruntime.h"
