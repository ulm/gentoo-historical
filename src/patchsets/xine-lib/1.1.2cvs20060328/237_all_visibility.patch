Index: xine-lib-1.1.2cvs20060328/configure.ac
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/configure.ac
+++ xine-lib-1.1.2cvs20060328/configure.ac
@@ -1927,6 +1927,16 @@ dnl WARNING! Do not move this check behi
 dnl (the alignment test macro does not like variables in the CFLAGS)
 AC_C_ATTRIBUTE_ALIGNED
 
+CC_ATTRIBUTE_VISIBILITY_DEFAULT([
+		AC_DEFINE([EXPORTED],
+			[__attribute__((visibility("default")))],
+			[Mark a symbol as being exported if visibility is changed])
+		VISIBILITY_FLAG="-fvisibility=hidden"
+	], [
+		AC_DEFINE([EXPORT], [], [Dummy mark as being exported])
+	])
+AC_SUBST([VISIBILITY_FLAG])
+
 dnl Common cflags for all platforms
 CFLAGS="-DNDEBUG -D_REENTRANT -D_FILE_OFFSET_BITS=64 -DXINE_COMPILE \$(MULTIPASS_CFLAGS) $CFLAGS"
 DEBUG_CFLAGS="-D_REENTRANT -D_FILE_OFFSET_BITS=64 -DXINE_COMPILE $DEBUG_CFLAGS"
Index: xine-lib-1.1.2cvs20060328/m4/attributes.m4
===================================================================
--- /dev/null
+++ xine-lib-1.1.2cvs20060328/m4/attributes.m4
@@ -0,0 +1,159 @@
+# Functions to check for attributes support in compiler
+
+AC_DEFUN([CC_ATTRIBUTE_CONSTRUCTOR], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((constructor))],
+		[cc_cv_attribute_constructor],
+		[AC_COMPILE_IFELSE([
+			void ctor() __attribute__((constructor));
+			void ctor() { };
+			],
+			[cc_cv_attribute_constructor=yes],
+			[cc_cv_attribute_constructor=no])
+		])
+	
+	if test "x$cc_cv_attribute_constructor" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_CONSTRUCTOR], 1, [Define this if the compiler supports the constructor attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_FORMAT], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((format(printf, n, n)))],
+		[cc_cv_attribute_format],
+		[AC_COMPILE_IFELSE([
+			void __attribute__((format(printf, 1, 2))) printflike(const char *fmt, ...) { }
+			],
+			[cc_cv_attribute_format=yes],
+			[cc_cv_attribute_format=no])
+		])
+	
+	if test "x$cc_cv_attribute_format" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_FORMAT], 1, [Define this if the compiler supports the format attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_FORMAT_ARG], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((format_arg(printf)))],
+		[cc_cv_attribute_format_arg],
+		[AC_COMPILE_IFELSE([
+			void __attribute__((format_arg(printf, 1))) gettextlike(const char *fmt) { }
+			],
+			[cc_cv_attribute_format_arg=yes],
+			[cc_cv_attribute_format_arg=no])
+		])
+	
+	if test "x$cc_cv_attribute_format_arg" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_FORMAT_ARG], 1, [Define this if the compiler supports the format_arg attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_INTERNAL], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((visibility("internal")))],
+		[cc_cv_attribute_internal],
+		[AC_COMPILE_IFELSE([
+			void __attribute__((visibility("internal"))) internal_function() { }
+			],
+			[cc_cv_attribute_internal=yes],
+			[cc_cv_attribute_internal=no])
+		])
+	
+	if test "x$cc_cv_attribute_internal" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_INTERNAL], 1, [Define this if the compiler supports the internal visibility attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_VISIBILITY_DEFAULT], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((visibility("default")))],
+		[cc_cv_attribute_visibility_default],
+		[AC_COMPILE_IFELSE([
+			void __attribute__((visibility("default"))) external_function() { }
+			],
+			[cc_cv_attribute_visibility_default=yes],
+			[cc_cv_attribute_visibility_default=no])
+		])
+	
+	if test "x$cc_cv_attribute_visibility_default" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_VISIBILITY_DEFAULT], 1, [Define this if the compiler supports the default visibility attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_NONNULL], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((nonnull()))],
+		[cc_cv_attribute_nonnull],
+		[AC_COMPILE_IFELSE([
+			void some_function(void *foo, void *bar) __attribute__((nonnull()));
+			void some_function(void *foo, void *bar) { }
+			],
+			[cc_cv_attribute_nonnull=yes],
+			[cc_cv_attribute_nonnull=no])
+		])
+	
+	if test "x$cc_cv_attribute_nonnull" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_NONNULL], 1, [Define this if the compiler supports the nonnull attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_ATTRIBUTE_UNUSED], [
+	AC_CACHE_CHECK([if compiler supports __attribute__((unused))],
+		[cc_cv_attribute_unused],
+		[AC_COMPILE_IFELSE([
+			void some_function(void *foo, __attribute__((unused)) void *bar);
+			],
+			[cc_cv_attribute_unused=yes],
+			[cc_cv_attribute_unused=no])
+		])
+	
+	if test "x$cc_cv_attribute_unused" = "xyes"; then
+		AC_DEFINE([SUPPORT_ATTRIBUTE_UNUSED], 1, [Define this if the compiler supports the unused attribute])
+		$1
+	else
+		true
+		$2
+	fi
+])
+
+AC_DEFUN([CC_FUNC_EXPECT], [
+	AC_CACHE_CHECK([if compiler has __builtin_expect function],
+		[cc_cv_func_expect],
+		[AC_COMPILE_IFELSE([
+			int some_function()
+			{
+				int a = 3;
+				return (int)__builtin_expect(a, 3);
+			}
+			],
+			[cc_cv_func_expect=yes],
+			[cc_cv_func_expect=no])
+		])
+	
+	if test "x$cc_cv_func_expect" = "xyes"; then
+		AC_DEFINE([SUPPORT__BUILTIN_EXPECT], 1, [Define this if the compiler supports __builtin_expect() function])
+		$1
+	else
+		true
+		$2
+	fi
+])
Index: xine-lib-1.1.2cvs20060328/src/libfaad/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libfaad/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libfaad/Makefile.am
@@ -54,6 +54,7 @@ xineplug_decode_faad_la_SOURCES = \
 	xine_decoder.c
 
 xineplug_decode_faad_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
+xineplug_decode_faad_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_faad_la_LIBADD = $(XINE_LIB)
 
 noinst_HEADERS = \
Index: xine-lib-1.1.2cvs20060328/src/libfaad/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libfaad/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libfaad/xine_decoder.c
@@ -473,7 +473,7 @@ static decoder_info_t dec_info_audio = {
   1                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_AUDIO_DECODER, 15, "faad", XINE_VERSION_CODE, &dec_info_audio, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/liba52/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/liba52/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/liba52/Makefile.am
@@ -30,6 +30,7 @@ else
 xineplug_decode_a52_la_LIBADD = $(XINE_LIB)
 endif
 
+xineplug_decode_a52_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_a52_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 noinst_HEADERS = \
Index: xine-lib-1.1.2cvs20060328/src/liba52/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/liba52/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/liba52/xine_decoder.c
@@ -857,7 +857,7 @@ static decoder_info_t dec_info_audio = {
   5                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_AUDIO_DECODER | PLUGIN_MUST_PRELOAD, 15, "a/52", XINE_VERSION_CODE, &dec_info_audio, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libffmpeg/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libffmpeg/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libffmpeg/Makefile.am
@@ -29,16 +29,19 @@ xineplug_decode_ff_la_SOURCES = xine_dec
 # dlsym()ing the necessary function. Therefore we must allow more exported
 # symbols and cannot use @XINE_PLUGIN_MIN_SYMS@
 xineplug_decode_ff_la_LDFLAGS = -avoid-version -module
+xineplug_decode_ff_la_CFLAGS = $(VISIBILITY_FLAG)
 else
 AM_CPPFLAGS = $(ff_cppflags) $(ZLIB_CPPFLAGS) -I$(top_srcdir)/src/libffmpeg/libavutil
 xineplug_decode_ff_la_SOURCES = xine_decoder.c audio_decoder.c video_decoder.c \
                                 mpeg_parser.c
 xineplug_decode_ff_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
+xineplug_decode_ff_la_CFLAGS = $(VISIBILITY_FLAG)
 endif
 
 xineplug_decode_ff_la_LIBADD = $(MLIB_LIBS) $(XINE_LIB) -lm $(ZLIB_LIBS) \
 	$(link_ffmpeg) $(THREAD_LIBS)
 
+xineplug_decode_dvaudio_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_dvaudio_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 xineplug_decode_dvaudio_la_SOURCES = dvaudio_decoder.c
 xineplug_decode_dvaudio_la_LIBADD  = $(XINE_LIB)
Index: xine-lib-1.1.2cvs20060328/src/libffmpeg/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libffmpeg/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libffmpeg/xine_decoder.c
@@ -143,7 +143,7 @@ void init_once_routine(void) {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_DECODER | PLUGIN_MUST_PRELOAD, 18, "ffmpegvideo", XINE_VERSION_CODE, &dec_info_ffmpeg_video, init_video_plugin },
   { PLUGIN_VIDEO_DECODER, 18, "ffmpeg-wmv8", XINE_VERSION_CODE, &dec_info_ffmpeg_wmv8, init_video_plugin },
Index: xine-lib-1.1.2cvs20060328/src/libmpeg2/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libmpeg2/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libmpeg2/Makefile.am
@@ -27,6 +27,7 @@ xineplug_decode_mpeg2_la_SOURCES = \
 	libmpeg2_accel.c
 
 xineplug_decode_mpeg2_la_LIBADD = $(MLIB_LIBS) $(XINE_LIB)
+xineplug_decode_mpeg2_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_mpeg2_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 noinst_HEADERS = vlc.h mpeg2.h xvmc.h xvmc_vld.h mpeg2_internal.h idct_mlib.h vis.h \
Index: xine-lib-1.1.2cvs20060328/src/libmpeg2/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libmpeg2/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libmpeg2/xine_decoder.c
@@ -177,7 +177,7 @@ static decoder_info_t dec_info_mpeg2 = {
   7                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_DECODER, 18, "mpeg2", XINE_VERSION_CODE, &dec_info_mpeg2, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libreal/audio_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libreal/audio_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libreal/audio_decoder.c
@@ -677,6 +677,10 @@ static void dispose_class (audio_decoder
 /*
  * some fake functions to make real codecs happy 
  */
+void *__builtin_vec_new(unsigned long size) EXPORTED;
+void __builtin_vec_delete(void *mem) EXPORTED;
+void __pure_virtual(void) EXPORTED;
+
 void *__builtin_vec_new(unsigned long size) {
   return malloc(size);
 }
@@ -758,7 +762,7 @@ static decoder_info_t dec_info_audio = {
   5                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_AUDIO_DECODER | PLUGIN_MUST_PRELOAD, 15, "realadec", XINE_VERSION_CODE, &dec_info_audio, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libreal/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libreal/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libreal/Makefile.am
@@ -6,8 +6,10 @@ lib_LTLIBRARIES = xineplug_decode_real.l
 
 xineplug_decode_real_la_SOURCES = xine_decoder.c
 xineplug_decode_real_la_LIBADD = $(XINE_LIB) $(DYNAMIC_LD_LIBS)
+xineplug_decode_real_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_real_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_decode_real_audio_la_SOURCES = audio_decoder.c
 xineplug_decode_real_audio_la_LIBADD = $(XINE_LIB) $(DYNAMIC_LD_LIBS)
+xineplug_decode_real_audio_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_real_audio_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
Index: xine-lib-1.1.2cvs20060328/src/libreal/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libreal/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libreal/xine_decoder.c
@@ -560,6 +560,10 @@ static void dispose_class (video_decoder
 /*
  * some fake functions to make real codecs happy 
  */
+void *__builtin_vec_new(uint32_t size) EXPORTED;
+void __builtin_vec_delete(void *mem) EXPORTED;
+void __pure_virtual(void) EXPORTED;
+
 void *__builtin_vec_new(uint32_t size) {
   return malloc(size);
 }
@@ -639,7 +643,7 @@ static decoder_info_t dec_info_real = {
   7                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_DECODER | PLUGIN_MUST_PRELOAD, 18, "real", XINE_VERSION_CODE, &dec_info_real, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libspucc/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspucc/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libspucc/Makefile.am
@@ -6,6 +6,7 @@ lib_LTLIBRARIES = xineplug_decode_spucc.
 
 xineplug_decode_spucc_la_SOURCES =  cc_decoder.c xine_decoder.c
 xineplug_decode_spucc_la_LIBADD = $(XINE_LIB)
+xineplug_decode_spucc_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_spucc_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 noinst_HEADERS = cc_decoder.h
Index: xine-lib-1.1.2cvs20060328/src/libspucc/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspucc/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libspucc/xine_decoder.c
@@ -362,7 +362,7 @@ static decoder_info_t spudec_info = {
   1                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_SPU_DECODER, 16, "spucc", XINE_VERSION_CODE, &spudec_info, &init_spu_decoder_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libspucmml/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspucmml/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libspucmml/Makefile.am
@@ -6,4 +6,5 @@ lib_LTLIBRARIES = xineplug_decode_spucmm
 
 xineplug_decode_spucmml_la_SOURCES = xine_decoder.c
 xineplug_decode_spucmml_la_LIBADD  = $(XINE_LIB)
+xineplug_decode_spucmml_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_spucmml_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
Index: xine-lib-1.1.2cvs20060328/src/libspucmml/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspucmml/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libspucmml/xine_decoder.c
@@ -542,7 +542,7 @@ static decoder_info_t spudec_info = {
   1                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_SPU_DECODER, 16, "spucmml", XINE_VERSION_CODE, &spudec_info, &init_spu_decoder_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libspudec/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspudec/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libspudec/Makefile.am
@@ -9,7 +9,6 @@ if HAVE_DVDNAV
 xineplug_decode_spu_la_SOURCES = \
 	spu.c \
 	xine_decoder.c
-AM_CPPFLAGS = $(DVDNAV_CFLAGS)
 xineplug_decode_spu_la_LIBADD = $(XINE_LIB) $(DVDNAV_LIBS) $(THREAD_LIBS)
 
 else
@@ -23,6 +22,7 @@ xineplug_decode_spu_la_LIBADD = $(XINE_L
 
 endif
 
+xineplug_decode_spu_la_CFLAGS = $(DVDNAV_CFLAGS) $(VISIBILITY_FLAG)
 xineplug_decode_spu_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 noinst_HEADERS = spu.h
Index: xine-lib-1.1.2cvs20060328/src/libspudec/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspudec/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libspudec/xine_decoder.c
@@ -397,7 +397,7 @@ static decoder_info_t dec_info_data = {
   5                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_SPU_DECODER, 16, "spudec", XINE_VERSION_CODE, &dec_info_data, &init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libspudvb/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspudvb/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libspudvb/Makefile.am
@@ -6,4 +6,5 @@ lib_LTLIBRARIES = xineplug_decode_spudvb
 
 xineplug_decode_spudvb_la_SOURCES = xine_decoder.c
 xineplug_decode_spudvb_la_LIBADD  = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_decode_spudvb_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_spudvb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
Index: xine-lib-1.1.2cvs20060328/src/libspudvb/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libspudvb/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libspudvb/xine_decoder.c
@@ -869,7 +869,7 @@ static decoder_info_t spudec_info = {
   1				/* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
 /* type, API, "name", version, special_info, init_function */
   {PLUGIN_SPU_DECODER, 16, "spudvb", XINE_VERSION_CODE, &spudec_info,
    &init_spu_decoder_plugin},
Index: xine-lib-1.1.2cvs20060328/src/libsputext/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libsputext/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libsputext/Makefile.am
@@ -8,8 +8,10 @@ lib_LTLIBRARIES = $(sputext_decoder)
 
 xineplug_dmx_sputext_la_SOURCES = demux_sputext.c
 xineplug_dmx_sputext_la_LIBADD  = $(XINE_LIB)
+xineplug_dmx_sputext_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_dmx_sputext_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_decode_sputext_la_SOURCES = xine_decoder.c 
 xineplug_decode_sputext_la_LIBADD  = $(XINE_LIB)
+xineplug_decode_sputext_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_sputext_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
Index: xine-lib-1.1.2cvs20060328/src/libxineadec/gsm610.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libxineadec/gsm610.c
+++ xine-lib-1.1.2cvs20060328/src/libxineadec/gsm610.c
@@ -289,7 +289,7 @@ static decoder_info_t dec_info_audio = {
   9                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_AUDIO_DECODER, 15, "gsm610", XINE_VERSION_CODE, &dec_info_audio, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/libxineadec/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libxineadec/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libxineadec/Makefile.am
@@ -4,8 +4,6 @@ EXTRA_DIST = fooaudio.c
 
 libdir = $(XINE_PLUGINDIR)
 
-AM_CFLAGS = -DNSF_PLAYER
-
 SUBDIRS = gsm610 nosefart
 
 lib_LTLIBRARIES = \
@@ -13,13 +11,14 @@ lib_LTLIBRARIES = \
 	xineplug_decode_nsf.la
 
 xineplug_decode_gsm610_la_SOURCES = gsm610.c
+xineplug_decode_gsm610_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_gsm610_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 xineplug_decode_gsm610_la_LIBADD = \
 	$(XINE_LIB) \
 	$(top_builddir)/src/libxineadec/gsm610/libgsm610.la
 
 xineplug_decode_nsf_la_SOURCES = nsf.c
-#xineplug_decode_nsf_la_CFLAGS = -DNSF_PLAYER
+xineplug_decode_nsf_la_CFLAGS = $(VISIBILITY_FLAG) -DNSF_PLAYER
 xineplug_decode_nsf_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 xineplug_decode_nsf_la_LIBADD = \
 	$(XINE_LIB) \
Index: xine-lib-1.1.2cvs20060328/src/libxineadec/nsf.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libxineadec/nsf.c
+++ xine-lib-1.1.2cvs20060328/src/libxineadec/nsf.c
@@ -286,7 +286,7 @@ static decoder_info_t dec_info_audio = {
 
 /* The plugin catalog entry. This is the only information that this plugin
  * will export to the public. */
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* { type, API version, "name", version, special_info, init_function }, */
   { PLUGIN_AUDIO_DECODER, 15, "nsf", XINE_VERSION_CODE, &dec_info_audio, &init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/video_out/Makefile.am
@@ -95,82 +95,100 @@ lib_LTLIBRARIES = $(xshm_module) $(xv_mo
 xineplug_vo_out_xshm_la_SOURCES = yuv2rgb.c yuv2rgb_mmx.c yuv2rgb_mlib.c \
 	video_out_xshm.c $(X11OSD)
 xineplug_vo_out_xshm_la_LIBADD = $(MLIB_LIBS) $(X_LIBS) -lXext $(X_PRE_LIBS) -lX11 $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_xshm_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_xshm_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_xv_la_SOURCES = $(X11OSD) deinterlace.c video_out_xv.c
 xineplug_vo_out_xv_la_LIBADD = $(XV_LIB) $(X_LIBS) -lXext $(X_PRE_LIBS) -lX11 $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_xv_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_xv_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_xvmc_la_SOURCES = deinterlace.c video_out_xvmc.c
 xineplug_vo_out_xvmc_la_LIBADD = $(XVMC_LIB) $(XV_LIB) $(X_LIBS) -lXext $(X_PRE_LIBS) -lX11 $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_xvmv_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_xvmc_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_xxmc_la_SOURCES = $(X11OSD) deinterlace.c video_out_xxmc.c\
 				xvmc_mocomp.c xvmc_vld.c xxmc.h
 xineplug_vo_out_xxmc_la_LIBADD = $(XXMC_LIB) $(XV_LIB) $(X_LIBS) -lXext $(X_PRE_LIBS) -lX11 $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_xxmc_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_xxmc_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_opengl_la_SOURCES = yuv2rgb.c yuv2rgb_mmx.c yuv2rgb_mlib.c \
 	video_out_opengl.c myglext.h $(X11OSD)
 xineplug_vo_out_opengl_la_LIBADD = $(MLIB_LIBS) $(OPENGL_LIBS) $(GLUT_LIBS) \
 	$(GLU_LIBS) $(X_LIBS) -lXext $(X_PRE_LIBS) -lX11 $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_opengl_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_opengl_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_syncfb_la_SOURCES = video_out_syncfb.c 
 xineplug_vo_out_syncfb_la_LIBADD = $(X_LIBS) $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_syncfb_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_syncfb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_pgx64_la_SOURCES = video_out_pgx64.c
 xineplug_vo_out_pgx64_la_LIBADD = $(X_LIBS) $(SUNDGA_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_pgx64_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_pgx64_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_pgx32_la_SOURCES = video_out_pgx32.c
 xineplug_vo_out_pgx32_la_LIBADD = $(X_LIBS) $(SUNDGA_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_pgx32_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_pgx32_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_vidix_la_SOURCES = video_out_vidix.c $(X11OSD)
 xineplug_vo_out_vidix_la_LIBADD =  $(X_LIBS) \
 	$(top_builddir)/src/video_out/vidix/libvidix.la \
 	$(top_builddir)/src/video_out/libdha/libdha.la $(THREAD_LIBS)
+xineplug_vo_out_vidix_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_vidix_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_aa_la_SOURCES =  video_out_aa.c
 xineplug_vo_out_aa_la_LIBADD = $(AALIB_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_aa_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_aa_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_caca_la_SOURCES = yuv2rgb.c yuv2rgb_mmx.c yuv2rgb_mlib.c \
 	video_out_caca.c
 xineplug_vo_out_caca_la_LIBADD = $(CACA_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_caca_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_caca_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_fb_la_SOURCES = yuv2rgb.c yuv2rgb_mmx.c yuv2rgb_mlib.c \
 	video_out_fb.c
 xineplug_vo_out_fb_la_LIBADD = $(MLIB_LIBS) $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_fb_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_fb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_directfb_la_SOURCES = video_out_directfb.c $(X11OSD)
 xineplug_vo_out_directfb_la_LIBADD = $(DIRECTFB_LIBS) $(X_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_directfb_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_directfb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_sdl_la_SOURCES = video_out_sdl.c
 xineplug_vo_out_sdl_la_LIBADD = $(SDL_LIBS) $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_sdl_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_sdl_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_stk_la_SOURCES = video_out_stk.c 
 xineplug_vo_out_stk_la_LIBADD = $(LIBSTK_LIBS) $(THREAD_LIBS)
+xineplug_vo_out_stk_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_stk_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_directx_la_SOURCES = yuv2rgb.c yuv2rgb_mmx.c video_out_directx.c 
 xineplug_vo_out_directx_la_CPPFLAGS = $(DIRECTX_CPPFLAGS)
 xineplug_vo_out_directx_la_LIBADD = $(DIRECTX_VIDEO_LIBS) $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_directx_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_directx_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_none_la_SOURCES =  video_out_none.c
 xineplug_vo_out_none_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_vo_out_none_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_none_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_vo_out_macosx_la_SOURCES = video_out_macosx.m
 xineplug_vo_out_macosx_la_CPPFLAGS = $(X_CFLAGS) $(MLIB_CFLAGS)
+xineplug_vo_out_macosx_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_vo_out_macosx_la_LIBADD = $(MLIB_LIBS) $(OPENGL_LIBS) $(GLUT_LIBS) \
 	$(GLU_LIBS) $(X_LIBS) $(XINE_LIB) $(THREAD_LIBS)
 # The "-Wl,-framework -Wl,Cocoa" is needed for libtool versions before
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_aa.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_aa.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_aa.c
@@ -337,7 +337,7 @@ static vo_info_t vo_info_aa = {
   XINE_VISUAL_TYPE_AA
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "aa", XINE_VERSION_CODE, &vo_info_aa, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_caca.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_caca.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_caca.c
@@ -338,7 +338,7 @@ static vo_info_t vo_info_caca = {
   XINE_VISUAL_TYPE_CACA
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "caca", XINE_VERSION_CODE, &vo_info_caca, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_directfb.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_directfb.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_directfb.c
@@ -1776,7 +1776,7 @@ static vo_info_t vo_info_directfb_x11 = 
 
 /*********/
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, VIDEO_OUT_DRIVER_IFACE_VERSION, "DirectFB",
     XINE_VERSION_CODE, &vo_info_directfb_fb, init_class_fb },
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_directx.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_directx.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_directx.c
@@ -1273,7 +1273,7 @@ static vo_info_t vo_info_win32 = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "vo_directx", XINE_VERSION_CODE, &vo_info_win32, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_fb.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_fb.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_fb.c
@@ -1133,7 +1133,7 @@ static vo_info_t vo_info_fb =
 };
 
 /* exported plugin catalog entry */
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "fb", XINE_VERSION_CODE, &vo_info_fb, fb_init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_none.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_none.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_none.c
@@ -306,7 +306,7 @@ static vo_info_t vo_info_none = {
   XINE_VISUAL_TYPE_NONE     /* Visual type */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "none", XINE_VERSION_CODE, &vo_info_none, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_opengl.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_opengl.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_opengl.c
@@ -1992,7 +1992,7 @@ static vo_info_t vo_info_opengl = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "opengl", XINE_VERSION_CODE, &vo_info_opengl, opengl_init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_pgx32.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_pgx32.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_pgx32.c
@@ -890,7 +890,7 @@ static void *pgx32_init_class(xine_t *xi
   return class;
 }
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   {PLUGIN_VIDEO_OUT, 21, "pgx32", XINE_VERSION_CODE, &vo_info_pgx32, pgx32_init_class},
   {PLUGIN_NONE, 0, "", 0, NULL, NULL}
 };
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_pgx64.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_pgx64.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_pgx64.c
@@ -1514,7 +1514,7 @@ static void *pgx64_init_class(xine_t *xi
   return class;
 }
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   {PLUGIN_VIDEO_OUT, 21, "pgx64", XINE_VERSION_CODE, &vo_info_pgx64, pgx64_init_class},
   {PLUGIN_NONE, 0, "", 0, NULL, NULL}
 };
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_sdl.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_sdl.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_sdl.c
@@ -608,7 +608,7 @@ static vo_info_t vo_info_sdl = {
   XINE_VISUAL_TYPE_X11, /* visual type supported by this plugin */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "sdl", XINE_VERSION_CODE, &vo_info_sdl, init_class },
   { PLUGIN_NONE, 0, "" , 0 , NULL, NULL}
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_stk.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_stk.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_stk.c
@@ -484,7 +484,7 @@ static vo_info_t vo_info_stk = {
     XINE_VISUAL_TYPE_FB,  /* visual type supported by this plugin */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
     /* type, API, "name", version, special_info, init_function */
     { PLUGIN_VIDEO_OUT, 21, "stk", XINE_VERSION_CODE, &vo_info_stk, init_class },
     { PLUGIN_NONE, 0, "" , 0 , NULL, NULL}
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_syncfb.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_syncfb.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_syncfb.c
@@ -1115,7 +1115,7 @@ static vo_info_t vo_info_syncfb = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "SyncFB", XINE_VERSION_CODE, &vo_info_syncfb, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_vidix.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_vidix.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_vidix.c
@@ -1308,7 +1308,7 @@ static vo_info_t vo_info_vidixfb = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
 #ifdef HAVE_X11
   { PLUGIN_VIDEO_OUT, 21, "vidix", XINE_VERSION_CODE, &vo_info_vidix, vidix_init_class },
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_xshm.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_xshm.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_xshm.c
@@ -1299,7 +1299,7 @@ static vo_info_t vo_info_xshm = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_VIDEO_OUT, 21, "xshm", XINE_VERSION_CODE, &vo_info_xshm, xshm_init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_xv.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_xv.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_xv.c
@@ -1606,7 +1606,7 @@ static vo_info_t vo_info_xv = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "xv", XINE_VERSION_CODE, &vo_info_xv, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_xvmc.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_xvmc.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_xvmc.c
@@ -1796,7 +1796,7 @@ static vo_info_t vo_info_xvmc = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "xvmc", XINE_VERSION_CODE, &vo_info_xvmc, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/video_out/video_out_xxmc.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/video_out/video_out_xxmc.c
+++ xine-lib-1.1.2cvs20060328/src/video_out/video_out_xxmc.c
@@ -2645,7 +2645,7 @@ static vo_info_t vo_info_xxmc = {
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_VIDEO_OUT, 21, "xxmc", XINE_VERSION_CODE, &vo_info_xxmc, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_cdda.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_cdda.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_cdda.c
@@ -2724,7 +2724,7 @@ static void *init_plugin (xine_t *xine, 
   return this;
 }
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "CD", XINE_VERSION_CODE, NULL, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_dvb.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_dvb.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_dvb.c
@@ -3205,7 +3205,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "DVB", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_dvd.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_dvd.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_dvd.c
@@ -1906,7 +1906,7 @@ static void *init_class (xine_t *xine, v
 }
 
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "DVD", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_file.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_file.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_file.c
@@ -913,7 +913,7 @@ static void *init_plugin (xine_t *xine, 
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "FILE", XINE_VERSION_CODE, NULL, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_gnome_vfs.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_gnome_vfs.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_gnome_vfs.c
@@ -389,7 +389,7 @@ static input_info_t input_info_gnomevfs 
 	100                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
 	{ PLUGIN_INPUT | PLUGIN_NO_UNLOAD, 17, "gnomevfs", XINE_VERSION_CODE,
 		&input_info_gnomevfs, init_input_class },
 	{ PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_http.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_http.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_http.c
@@ -1057,7 +1057,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "http", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_mms.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_mms.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_mms.c
@@ -477,7 +477,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "mms", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_net.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_net.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_net.c
@@ -543,7 +543,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT, 17, "tcp", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_pnm.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_pnm.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_pnm.c
@@ -299,7 +299,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT, 17, "pnm", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_pvr.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_pvr.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_pvr.c
@@ -1571,7 +1571,7 @@ static void *init_plugin (xine_t *xine, 
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "pvr", XINE_VERSION_CODE, NULL, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_rtp.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_rtp.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_rtp.c
@@ -777,7 +777,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT, 17, "rtp", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_rtsp.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_rtsp.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_rtsp.c
@@ -311,7 +311,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT, 17, "rtsp", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_smb.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_smb.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_smb.c
@@ -537,7 +537,7 @@ static input_info_t input_info_smb = {
   0                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
 	{ PLUGIN_INPUT, 17, "smb", XINE_VERSION_CODE, &input_info_smb,
 		init_input_class },
 	{ PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_stdin_fifo.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_stdin_fifo.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_stdin_fifo.c
@@ -383,7 +383,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_INPUT, 17, "stdin", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/input_v4l.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_v4l.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_v4l.c
@@ -1945,7 +1945,7 @@ static void *init_radio_class (xine_t *x
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "v4l_radio", XINE_VERSION_CODE, NULL, init_radio_class },
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "v4l_tv", XINE_VERSION_CODE, NULL, init_video_class },
Index: xine-lib-1.1.2cvs20060328/src/input/input_vcd.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/input_vcd.c
+++ xine-lib-1.1.2cvs20060328/src/input/input_vcd.c
@@ -1113,7 +1113,7 @@ static void *init_class (xine_t *xine, v
  * exported plugin catalog entry
  */
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_INPUT | PLUGIN_MUST_PRELOAD, 17, "VCDO", XINE_VERSION_CODE, NULL, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/input/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/input/Makefile.am
@@ -73,66 +73,82 @@ lib_LTLIBRARIES = \
 
 xineplug_inp_file_la_SOURCES = input_file.c
 xineplug_inp_file_la_LIBADD = $(XINE_LIB)
+xineplug_inp_file_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_file_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_dvd_la_SOURCES = input_dvd.c media_helper.c
 xineplug_inp_dvd_la_LIBADD = $(XINE_LIB) $(link_dvdnav) $(THREAD_LIBS)
+xineplug_inp_dvd_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_dvd_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_net_la_SOURCES = input_net.c net_buf_ctrl.c
 xineplug_inp_net_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_net_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_net_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_mms_la_SOURCES = input_mms.c net_buf_ctrl.c mms.c mmsh.c http_helper.c
 xineplug_inp_mms_la_LIBADD = $(XINE_LIB) @LIBICONV@ $(THREAD_LIBS)
+xineplug_inp_mms_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_mms_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_vcdo_la_SOURCES = input_vcd.c media_helper.c
 xineplug_inp_vcdo_la_LIBADD = $(XINE_LIB)
+xineplug_inp_vcdo_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_vcdo_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_stdin_fifo_la_SOURCES = input_stdin_fifo.c net_buf_ctrl.c
 xineplug_inp_stdin_fifo_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_stdin_fifo_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_stdin_fifo_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_rtp_la_SOURCES = input_rtp.c net_buf_ctrl.c
 xineplug_inp_rtp_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_rtp_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_rtp_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_http_la_SOURCES = input_http.c net_buf_ctrl.c http_helper.c
 xineplug_inp_http_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_http_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_http_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_pnm_la_SOURCES = input_pnm.c net_buf_ctrl.c pnm.c
 xineplug_inp_pnm_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_pnm_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_pnm_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_dvb_la_SOURCES = input_dvb.c net_buf_ctrl.c
 xineplug_inp_dvb_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_dvb_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_dvb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_rtsp_la_SOURCES = input_rtsp.c net_buf_ctrl.c
 xineplug_inp_rtsp_la_LIBADD = $(XINE_LIB) $(THREAD_LIBS) libreal/libreal.la librtsp/librtsp.la
+xineplug_inp_rtsp_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_rtsp_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_cdda_la_SOURCES = input_cdda.c media_helper.c sha1.c sha1.h base64.c base64.h
 xineplug_inp_cdda_la_LIBADD = $(XINE_LIB)
+xineplug_inp_cdda_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_cdda_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_v4l_la_SOURCES = input_v4l.c
 xineplug_inp_v4l_la_LIBADD = $(ALSA_LIBS) $(XINE_LIB)
+xineplug_inp_v4l_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_v4l_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_gnome_vfs_la_SOURCES = input_gnome_vfs.c net_buf_ctrl.c
 xineplug_inp_gnome_vfs_la_LIBADD = $(GNOME_VFS_LIBS) $(XINE_LIB) $(THREAD_LIBS)
+xineplug_inp_gnome_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_gnome_vfs_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_smb_la_SOURCES = input_smb.c
 xineplug_inp_smb_la_LIBADD = $(LIBSMBCLIENT_LIBS) $(XINE_LIB)
+xineplug_inp_smb_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_smb_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_inp_pvr_la_SOURCES = input_pvr.c
 xineplug_inp_pvr_la_LIBADD = $(XINE_LIB)
+xineplug_inp_pvr_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_inp_pvr_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 include_HEADERS = input_plugin.h
Index: xine-lib-1.1.2cvs20060328/src/libxineadec/gsm610/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libxineadec/gsm610/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libxineadec/gsm610/Makefile.am
@@ -14,6 +14,7 @@ libgsm610_la_SOURCES = \
 	short_term.c \
 	table.c
 
+libgsm610_la_CFLAGS = $(VISIBILITY_FLAG)
 libgsm610_la_LDFLAGS = -avoid-version -module
 
 noinst_HEADERS = \
Index: xine-lib-1.1.2cvs20060328/src/libxineadec/nosefart/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libxineadec/nosefart/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libxineadec/nosefart/Makefile.am
@@ -1,7 +1,5 @@
 include $(top_srcdir)/misc/Makefile.common
 
-AM_CFLAGS = -DNSF_PLAYER
-
 noinst_LTLIBRARIES = libnosefart.la
 
 libnosefart_la_SOURCES = \
@@ -17,7 +15,7 @@ libnosefart_la_SOURCES = \
 	nsf.c \
 	vrcvisnd.c	
 
-libnosefart_la_LDFLAGS = -avoid-version -module
+libnosefart_la_CFLAGS = $(VISIBILITY_FLAG) -DNSF_PLAYER
 
 noinst_HEADERS = \
 	dis6502.h \
Index: xine-lib-1.1.2cvs20060328/src/input/libreal/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/libreal/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/input/libreal/Makefile.am
@@ -10,7 +10,7 @@ libreal_la_SOURCES = \
   rmff.c \
   sdpplin.c
 
-libreal_la_LDFLAGS = -avoid-version -module
+libreal_la_CFLAGS = $(VISIBILITY_FLAG)
 
 noinst_HEADERS = \
   real.h \
Index: xine-lib-1.1.2cvs20060328/src/libflac/decoder_flac.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libflac/decoder_flac.c
+++ xine-lib-1.1.2cvs20060328/src/libflac/decoder_flac.c
@@ -400,7 +400,7 @@ static decoder_info_t dec_info_audio = {
   5                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "flac", XINE_VERSION_CODE, NULL, demux_flac_init_class },
   { PLUGIN_AUDIO_DECODER, 15, "flacdec", XINE_VERSION_CODE, &dec_info_audio, init_plugin },
Index: xine-lib-1.1.2cvs20060328/src/libflac/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libflac/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libflac/Makefile.am
@@ -1,7 +1,5 @@
 include $(top_srcdir)/misc/Makefile.common
 
-AM_CFLAGS = $(LIBFLAC_CFLAGS)
-
 if HAVE_FLAC
 flac_module = xineplug_flac.la
 endif
@@ -12,6 +10,7 @@ lib_LTLIBRARIES = $(flac_module)
 
 xineplug_flac_la_SOURCES = demux_flac.c decoder_flac.c
 xineplug_flac_la_LIBADD = $(LIBFLAC_LIBS) $(XINE_LIB)
+xineplug_flac_la_CFLAGS = $(LIBFLAC_CFLAGS) $(VISIBILITY_FLAG)
 xineplug_flac_la_LDFLAGS = -avoid-version -module -lFLAC @XINE_PLUGIN_MIN_SYMS@
 
 noinst_HEADERS = demux_flac.h
Index: xine-lib-1.1.2cvs20060328/src/libmusepack/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libmusepack/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/libmusepack/Makefile.am
@@ -11,5 +11,6 @@ lib_LTLIBRARIES = xineplug_decode_mpc.la
 xineplug_decode_mpc_la_SOURCES = huffsv46.c huffsv7.c idtag.c mpc_decoder.c \
 	mpc_reader.c requant.c streaminfo.c synth_filter.c xine_decoder.c
 xineplug_decode_mpc_la_LIBADD = $(XINE_LIB)
+xineplug_decode_mpc_la_CFLAGS = $(VISIBILITY_FLAG)
 xineplug_decode_mpc_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
Index: xine-lib-1.1.2cvs20060328/src/libmusepack/xine_decoder.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/libmusepack/xine_decoder.c
+++ xine-lib-1.1.2cvs20060328/src/libmusepack/xine_decoder.c
@@ -459,7 +459,7 @@ static decoder_info_t dec_info_audio = {
   5                    /* priority        */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* { type, API version, "name", version, special_info, init_function }, */
   { PLUGIN_AUDIO_DECODER, 15, "mpc", XINE_VERSION_CODE, &dec_info_audio, &init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_asf.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_asf.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_asf.c
@@ -2336,7 +2336,7 @@ demuxer_info_t demux_info_asf = {
   10                       /* priority */
 };
  
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "asf", XINE_VERSION_CODE, &demux_info_asf, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_avi.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_avi.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_avi.c
@@ -2354,7 +2354,7 @@ demuxer_info_t demux_info_avi = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "avi", XINE_VERSION_CODE, &demux_info_avi, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_elem.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_elem.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_elem.c
@@ -305,7 +305,7 @@ demuxer_info_t demux_info_elem = {
   0                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "elem", XINE_VERSION_CODE, &demux_info_elem, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_fli.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_fli.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_fli.c
@@ -398,7 +398,7 @@ demuxer_info_t demux_info_fli = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "fli", XINE_VERSION_CODE, &demux_info_fli, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_flv.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_flv.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_flv.c
@@ -343,7 +343,7 @@ demuxer_info_t demux_info_flv = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "flashvideo", XINE_VERSION_CODE, &demux_info_flv, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_iff.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_iff.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_iff.c
@@ -1334,7 +1334,7 @@ demuxer_info_t demux_info_iff = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "iff", XINE_VERSION_CODE, &demux_info_iff, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_image.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_image.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_image.c
@@ -264,7 +264,7 @@ demuxer_info_t demux_info_image = {
   11                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "image", XINE_VERSION_CODE, &demux_info_image, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_matroska.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_matroska.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_matroska.c
@@ -2731,7 +2731,7 @@ demuxer_info_t demux_info_matroska = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "matroska", XINE_VERSION_CODE, &demux_info_matroska, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_mng.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_mng.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_mng.c
@@ -378,7 +378,7 @@ demuxer_info_t demux_info_mng = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   { PLUGIN_DEMUX, 26, "mng", XINE_VERSION_CODE, &demux_info_mng, (void*)init_plugin},
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
 };
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg_block.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_mpeg_block.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg_block.c
@@ -1563,7 +1563,7 @@ demuxer_info_t demux_info_mpeg_block = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "mpeg_block", XINE_VERSION_CODE, &demux_info_mpeg_block, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_mpeg.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg.c
@@ -1267,7 +1267,7 @@ demuxer_info_t demux_info_mpeg = {
   9                        /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "mpeg", XINE_VERSION_CODE, &demux_info_mpeg, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg_pes.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_mpeg_pes.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_mpeg_pes.c
@@ -1676,7 +1676,7 @@ demuxer_info_t demux_info_mpeg_pes = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "mpeg_pes", XINE_VERSION_CODE, &demux_info_mpeg_pes, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_nsv.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_nsv.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_nsv.c
@@ -689,7 +689,7 @@ demuxer_info_t demux_info_nsv = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "nsv", XINE_VERSION_CODE, &demux_info_nsv, demux_nsv_init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_ogg.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_ogg.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_ogg.c
@@ -2124,7 +2124,7 @@ demuxer_info_t demux_info_ogg = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "ogg", XINE_VERSION_CODE, &demux_info_ogg, ogg_init_class },
   { PLUGIN_DEMUX, 26, "anx", XINE_VERSION_CODE, &demux_info_anx, anx_init_class },
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_pva.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_pva.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_pva.c
@@ -524,7 +524,7 @@ demuxer_info_t demux_info_pva = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "pva", XINE_VERSION_CODE, &demux_info_pva, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_qt.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_qt.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_qt.c
@@ -3090,7 +3090,7 @@ demuxer_info_t demux_info_qt = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "quicktime", XINE_VERSION_CODE, &demux_info_qt, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_rawdv.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_rawdv.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_rawdv.c
@@ -447,7 +447,7 @@ demuxer_info_t demux_info_raw_dv = {
   1                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "rawdv", XINE_VERSION_CODE, &demux_info_raw_dv, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_real.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_real.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_real.c
@@ -1655,7 +1655,7 @@ demuxer_info_t demux_info_real = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "real", XINE_VERSION_CODE, &demux_info_real, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_slave.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_slave.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_slave.c
@@ -437,7 +437,7 @@ demuxer_info_t demux_info_slave = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "slave", XINE_VERSION_CODE, &demux_info_slave, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_ts.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_ts.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_ts.c
@@ -2204,7 +2204,7 @@ demuxer_info_t demux_info_ts = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "mpeg-ts", XINE_VERSION_CODE, &demux_info_ts, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_yuv4mpeg2.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_yuv4mpeg2.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_yuv4mpeg2.c
@@ -498,7 +498,7 @@ demuxer_info_t demux_info_yuv4mpeg2 = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "yuv4mpeg2", XINE_VERSION_CODE, &demux_info_yuv4mpeg2, init_plugin },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/demux_yuv_frames.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/demux_yuv_frames.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/demux_yuv_frames.c
@@ -276,7 +276,7 @@ demuxer_info_t demux_info_yuv_frames = {
   0                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */
   { PLUGIN_DEMUX, 26, "yuv_frames", XINE_VERSION_CODE, &demux_info_yuv_frames, init_class },
   { PLUGIN_NONE, 0, "", 0, NULL, NULL }
Index: xine-lib-1.1.2cvs20060328/src/demuxers/group_audio.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/group_audio.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/group_audio.c
@@ -105,7 +105,7 @@ demuxer_info_t demux_info_mod = {
 };
 #endif
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "aac",       XINE_VERSION_CODE, &demux_info_aac,       demux_aac_init_plugin },
   { PLUGIN_DEMUX, 26, "ac3",       XINE_VERSION_CODE, &demux_info_ac3,       demux_ac3_init_plugin },
Index: xine-lib-1.1.2cvs20060328/src/demuxers/group_games.c
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/group_games.c
+++ xine-lib-1.1.2cvs20060328/src/demuxers/group_games.c
@@ -79,7 +79,7 @@ demuxer_info_t demux_info_vmd = {
   10                       /* priority */
 };
 
-plugin_info_t xine_plugin_info[] = {
+plugin_info_t xine_plugin_info[] EXPORTED = {
   /* type, API, "name", version, special_info, init_function */  
   { PLUGIN_DEMUX, 26, "wve",      XINE_VERSION_CODE, &demux_info_eawve,    demux_eawve_init_plugin},
   { PLUGIN_DEMUX, 26, "idcin",    XINE_VERSION_CODE, &demux_info_idcin,    demux_idcin_init_plugin },
Index: xine-lib-1.1.2cvs20060328/src/demuxers/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/demuxers/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/demuxers/Makefile.am
@@ -52,62 +52,77 @@ lib_LTLIBRARIES = $(ogg_module) $(asf_mo
 
 xineplug_dmx_ogg_la_SOURCES = demux_ogg.c
 xineplug_dmx_ogg_la_LIBADD =  $(VORBIS_LIBS) $(SPEEX_LIBS) $(THEORA_LIBS) $(OGG_LIBS) $(XINE_LIB)
+xineplug_dmx_ogg_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_ogg_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_avi_la_SOURCES = demux_avi.c
 xineplug_dmx_avi_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_avi_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_avi_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mpeg_block_la_SOURCES = demux_mpeg_block.c
 xineplug_dmx_mpeg_block_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_mpeg_block_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mpeg_block_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mpeg_la_SOURCES = demux_mpeg.c
 xineplug_dmx_mpeg_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_mpeg_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mpeg_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mpeg_elem_la_SOURCES = demux_elem.c
 xineplug_dmx_mpeg_elem_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_mpeg_elem_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mpeg_elem_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mpeg_pes_la_SOURCES = demux_mpeg_pes.c
 xineplug_dmx_mpeg_pes_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_mpeg_pes_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mpeg_pes_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mpeg_ts_la_SOURCES = demux_ts.c
 xineplug_dmx_mpeg_ts_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_mpeg_ts_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mpeg_ts_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_qt_la_SOURCES = demux_qt.c
 xineplug_dmx_qt_la_LIBADD = $(XINE_LIB) $(ZLIB_LIBS)
+xineplug_dmx_qt_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_qt_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_asf_la_SOURCES = demux_asf.c
 xineplug_dmx_asf_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_asf_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_asf_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_fli_la_SOURCES = demux_fli.c
 xineplug_dmx_fli_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_fli_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_fli_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_yuv4mpeg2_la_SOURCES = demux_yuv4mpeg2.c
 xineplug_dmx_yuv4mpeg2_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_yuv4mpeg2_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_yuv4mpeg2_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_real_la_SOURCES = demux_real.c
 xineplug_dmx_real_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_real_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_real_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_rawdv_la_SOURCES = demux_rawdv.c
 xineplug_dmx_rawdv_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_rawdv_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_rawdv_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_mng_la_SOURCES = demux_mng.c
 xineplug_dmx_mng_la_LIBADD = $(XINE_LIB) $(ZLIB_LIBS) $(MNG_LIBS)
+xineplug_dmx_mng_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_mng_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_pva_la_SOURCES = demux_pva.c
 xineplug_dmx_pva_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_pva_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_pva_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_games_la_SOURCES = group_games.c demux_eawve.c \
@@ -116,6 +131,7 @@ xineplug_dmx_games_la_SOURCES = group_ga
 				demux_film.c demux_smjpeg.c demux_4xm.c \
 				demux_vmd.c
 xineplug_dmx_games_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_games_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_games_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_audio_la_SOURCES = group_audio.c demux_aud.c demux_aiff.c \
@@ -125,34 +141,42 @@ xineplug_dmx_audio_la_SOURCES = group_au
 				demux_aac.c demux_mod.c demux_flac.c \
 				demux_mpc.c demux_dts.c demux_shn.c
 xineplug_dmx_audio_la_LIBADD = $(XINE_LIB) $(LIBMODPLUG_LIBS)
+xineplug_dmx_audio_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_audio_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_yuv_frames_la_SOURCES = demux_yuv_frames.c
 xineplug_dmx_yuv_frames_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_yuv_fames_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_yuv_frames_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_slave_la_SOURCES = demux_slave.c
 xineplug_dmx_slave_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_slave_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_slave_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_image_la_SOURCES = demux_image.c
 xineplug_dmx_image_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_images_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_image_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_nsv_la_SOURCES = demux_nsv.c
 xineplug_dmx_nsv_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_nsv_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_nsv_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_matroska_la_SOURCES = demux_matroska.c ebml.c
 xineplug_dmx_matroska_la_LIBADD = $(XINE_LIB) $(ZLIB_LIBS)
+xineplug_dmx_matroska_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_matroska_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_iff_la_SOURCES = demux_iff.c
 xineplug_dmx_iff_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_iff_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_iff_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 xineplug_dmx_flv_la_SOURCES = demux_flv.c
 xineplug_dmx_flv_la_LIBADD = $(XINE_LIB)
+xineplug_dmx_flv_la_CFLAGS = $(VISIBILITY_FLAG) $(AM_CFLAGS)
 xineplug_dmx_flv_la_LDFLAGS = -avoid-version -module @XINE_PLUGIN_MIN_SYMS@
 
 include_HEADERS = demux.h
Index: xine-lib-1.1.2cvs20060328/src/input/librtsp/Makefile.am
===================================================================
--- xine-lib-1.1.2cvs20060328.orig/src/input/librtsp/Makefile.am
+++ xine-lib-1.1.2cvs20060328/src/input/librtsp/Makefile.am
@@ -8,6 +8,7 @@ librtsp_la_SOURCES = \
   rtsp.c \
   rtsp_session.c
 
+librtsp_la_CFLAGS = $(VISIBILITY_FLAG)
 librtsp_la_LDFLAGS = -avoid-version -module
 
 noinst_HEADERS = \
