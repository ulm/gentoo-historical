https://bugs.gentoo.org/384553

--- emacs-21.4-orig/src/xfns.c
+++ emacs-21.4/src/xfns.c
@@ -8546,7 +8546,7 @@
 {
   xassert (png_ptr != NULL);
   image_error ("PNG error: %s", build_string (msg), Qnil);
-  longjmp (png_ptr->jmpbuf, 1);
+  longjmp (png_jmpbuf (png_ptr), 1);
 }
 
 
@@ -8704,7 +8704,7 @@
 
   /* Set error jump-back.  We come back here when the PNG library
      detects an error.  */
-  if (setjmp (png_ptr->jmpbuf))
+  if (setjmp (png_jmpbuf (png_ptr)))
     {
     error:
       if (png_ptr)
