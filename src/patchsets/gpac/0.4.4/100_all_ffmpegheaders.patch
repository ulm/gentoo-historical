Index: gpac-0.4.4/configure
===================================================================
--- gpac-0.4.4.orig/configure
+++ gpac-0.4.4/configure
@@ -93,6 +93,7 @@ X11_PATH="/usr/X11R6"
 OSS_CFLAGS=""
 OSS_LDFLAGS=""
 is_64="no"
+FFMPEG_CFLAGS=""
 
 #Configure Usage
 if test x"$1" = x"-h" -o x"$1" = x"--help" ; then
@@ -615,6 +616,16 @@ elif $cc -o $TMPO $TMPC -I$local_inc -L$
 has_ffmpeg="local"
 fi
 
+cat > $TMPC << EOF
+#include <stddef.h>
+#include <libavcodec/avcodec.h>
+int main( void ) { return 0; }
+EOF
+
+if $cc -o $TMPO $TMPC -lz -lavcodec -lavformat 2> /dev/null  ; then
+FFMPEG_CFLAGS="-DNEW_FFMPEG_LAYOUT=1"
+has_ffmpeg="system"
+fi
 
 #look for vorbis support
 cat > $TMPC << EOF
@@ -1276,6 +1287,7 @@ echo "CONFIG_OGG=$has_ogg" >> config.mak
 echo "CONFIG_VORBIS=$has_vorbis" >> config.mak
 echo "CONFIG_THEORA=$has_theora" >> config.mak
 echo "CONFIG_FFMPEG=$has_ffmpeg" >> config.mak
+echo "FFMPEG_CFLAGS=$FFMPEG_CFLAGS" >> config.mak
 echo "CONFIG_OSS_AUDIO=$has_oss_audio" >> config.mak
 echo "CONFIG_ALSA=$has_alsa" >> config.mak
 echo "DISABLE_SVG=$disable_svg" >> config.mak
Index: gpac-0.4.4/modules/ffmpeg_in/Makefile
===================================================================
--- gpac-0.4.4.orig/modules/ffmpeg_in/Makefile
+++ gpac-0.4.4/modules/ffmpeg_in/Makefile
@@ -2,7 +2,7 @@ include ../../config.mak
 
 vpath %.c $(SRC_PATH)/modules/ffmpeg_in
 
-CFLAGS= $(OPTFLAGS) -Wall -I$(SRC_PATH)/include
+CFLAGS= $(OPTFLAGS) -Wall -I$(SRC_PATH)/include $(FFMPEG_CFLAGS)
 
 ifeq ($(DEBUGBUILD), yes)
 CFLAGS+=-g
Index: gpac-0.4.4/modules/ffmpeg_in/ffmpeg_in.h
===================================================================
--- gpac-0.4.4.orig/modules/ffmpeg_in/ffmpeg_in.h
+++ gpac-0.4.4/modules/ffmpeg_in/ffmpeg_in.h
@@ -56,7 +56,11 @@
 
 
 /*include FFMPEG APIs*/
+#if NEW_FFMPEG_LAYOUT
+#include <libavformat/avformat.h>
+#else
 #include <ffmpeg/avformat.h>
+#endif
 
 /*FFMPEG decoder module */
 typedef struct 
