Index: flac-1.1.4/include/FLAC/export.h
===================================================================
--- flac-1.1.4.orig/include/FLAC/export.h
+++ flac-1.1.4/include/FLAC/export.h
@@ -57,8 +57,8 @@
 
 #if defined(FLAC__NO_DLL) || !defined(_MSC_VER)
 
-#ifdef SUPPORT_ATTRIBUTE_VISIBILITY
-#define FLAC_API __attribute__((visibility("default")))
+#if defined(FLAC_API_EXPORTS) && SUPPORT_ATTRIBUTE_VISIBILITY
+#define FLAC_API __attribute__((visibility("protected")))
 #else
 #define FLAC_API
 #endif
Index: flac-1.1.4/include/FLAC++/export.h
===================================================================
--- flac-1.1.4.orig/include/FLAC++/export.h
+++ flac-1.1.4/include/FLAC++/export.h
@@ -38,7 +38,7 @@
 
 #if defined(FLAC__NO_DLL) || !defined(_MSC_VER)
 
-#ifdef SUPPORT_ATTRIBUTE_VISIBILITY
+#if defined(FLACPP_API_EXPORTS) && SUPPORT_ATTRIBUTE_VISIBILITY
 #define FLACPP_API __attribute__((visibility("default")))
 #else
 #define FLACPP_API
Index: flac-1.1.4/src/libFLAC/Makefile.am
===================================================================
--- flac-1.1.4.orig/src/libFLAC/Makefile.am
+++ flac-1.1.4/src/libFLAC/Makefile.am
@@ -45,7 +45,7 @@ CPUCFLAGS = -maltivec -mabi=altivec -DFL
 endif
 endif
 
-AM_CFLAGS = $(DEBUGCFLAGS) $(CPUCFLAGS) @OGG_CFLAGS@
+AM_CFLAGS = $(DEBUGCFLAGS) $(CPUCFLAGS) @OGG_CFLAGS@ -DFLAC_API_EXPORTS
 
 libFLAC_la_LIBADD = 
 libFLAC_la_CFLAGS = $(AM_CFLAGS)
Index: flac-1.1.4/src/libFLAC++/Makefile.am
===================================================================
--- flac-1.1.4.orig/src/libFLAC++/Makefile.am
+++ flac-1.1.4/src/libFLAC++/Makefile.am
@@ -44,6 +44,7 @@ EXTRA_DIST = \
 	libFLAC++.m4
 
 # see 'http://www.gnu.org/software/libtool/manual.html#Libtool-versioning' for numbering convention
+libFLAC___la_CXXFLAGS = -DFLACPP_API_EXPORTS
 libFLAC___la_LDFLAGS = -version-info 6:1:0
 libFLAC___la_LIBADD = ../libFLAC/libFLAC.la
 
