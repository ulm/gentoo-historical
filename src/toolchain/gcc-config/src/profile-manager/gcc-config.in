#!/bin/bash
# Copyright 1999-2005 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo/src/toolchain/gcc-config/src/profile-manager/Attic/gcc-config.in,v 1.7 2006/06/21 02:41:54 eradicator Exp $
# Author: Jeremy Huddleston <eradicator@gentoo.org>

. /etc/init.d/functions.sh

hasq() {
	local x

	local me=${1}
	shift

	for x in "${@}"; do
		if [[ "${x}" == "${me}" ]]; then
			return 0
		fi
	done
	return 1
}

print_usage() {
	cat << FOO
Usage: ${0##*/} [<options>]
WARNING: gcc-config is deprecated and is just a frontend to the compiler
         eselect module.  In the future, gcc-config will be removed
         from portage.  Please see 'eselect compiler help'.  This wrapper
         accepts all options that are available to gcc-config-1.x, but you
         have more options available to you through eselect-compiler.
FOO
}

parse_options() {
	local opt
	while [[ ${#} -gt 0 ]]; do
		opt=${1}
		shift
		case ${opt} in
			-l|--list-profiles)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="list-profiles"
				fi
			;;
			--help|-h|--usage)
				ACTION="usage"
			;;
			--get-current-profile|-c)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="show"
					TARGET="${1}"
					shift
				fi
			;;
			--get-bin-path|-B)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="getval"
					TARGET="BINPATH"
				fi
			;;
			--get-lib-path|-L)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="getval"
					TARGET="LDPATH"
				fi
			;;
			--get-stdcxx-incdir|-X)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="getval"
					TARGET="STDCXX_INCDIR"
				fi
			;;
			*)
				if [[ -n "${ACTION}" ]]; then
					ACTION="error"
					eerror "Invalid usage."
				else
					ACTION="set"
					NEW_PROFILE="${opt}"
				fi
			;;
		esac
	done
}

## START PROGRAM ##

NEW_PROFILE=""
ACTION=""

parse_options ${@}

case ${ACTION} in
	list-profiles)
		eselect compiler list
	;;
	getval)
		eselect compiler getval ${TARGET}
	;;
	show)
		eselect compiler show ${TARGET}
	;;
	set)
		ewarn "gcc-config is deprecated and is just a frontend to the compiler"
		ewarn "eselect module.  In the future, gcc-config will be removed"
		ewarn "from portage.  Please see 'eselect compiler help'"

		eselect compiler set ${NEW_PROFILE}
	;;
	usage)
		print_usage
		exit 0
	;;
	*)
		print_usage
		exit 1
	;;
esac
